
/**
 * The code below uses open source software. Please visit the URL below for an overview of the licenses:
 * http://js.api.here.com/v3/3.1.63.0/HERE_NOTICE
 */

(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var m,ba=[];function ca(a){return function(){return ba[a].apply(this,arguments)}}function da(a,b){return ba[a]=b}function ea(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function fa(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:ea(a)}}function ha(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}
function ia(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ja=ia(this),ka="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function la(a,b){if(b)a:{var c=ja;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ka(c,a,{configurable:!0,writable:!0,value:b})}}
la("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.Wx=f;ka(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.Wx};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});
la("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=ja[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&ka(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ma(ea(this))}})}return a});function ma(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
la("globalThis",function(a){return a||ja});function na(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}la("Array.prototype.keys",function(a){return a?a:function(){return na(this,function(b){return b})}});
function oa(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{Fu:e,Mx:f}}return{Fu:-1,Mx:void 0}}la("Array.prototype.find",function(a){return a?a:function(b,c){return oa(this,b,c).Mx}});var pa;
if("function"==typeof Object.setPrototypeOf)pa=Object.setPrototypeOf;else{var qa;a:{var ra={a:!0},sa={};try{sa.__proto__=ra;qa=sa.a;break a}catch(a){}qa=!1}pa=qa?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ta=pa;la("Object.setPrototypeOf",function(a){return a||ta});
la("Promise",function(a){function b(g){this.o=0;this.qf=void 0;this.Uh=[];this.Wu=!1;var h=this.cp();try{g(h.resolve,h.reject)}catch(k){h.reject(k)}}function c(){this.He=null}function d(g){return g instanceof b?g:new b(function(h){h(g)})}if(a)return a;c.prototype.dt=function(g){if(null==this.He){this.He=[];var h=this;this.et(function(){h.gz()})}this.He.push(g)};var e=ja.setTimeout;c.prototype.et=function(g){e(g,0)};c.prototype.gz=function(){for(;this.He&&this.He.length;){var g=this.He;this.He=[];
for(var h=0;h<g.length;++h){var k=g[h];g[h]=null;try{k()}catch(l){this.ty(l)}}}this.He=null};c.prototype.ty=function(g){this.et(function(){throw g;})};b.prototype.cp=function(){function g(l){return function(n){k||(k=!0,l.call(h,n))}}var h=this,k=!1;return{resolve:g(this.WC),reject:g(this.zr)}};b.prototype.WC=function(g){if(g===this)this.zr(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof b)this.lD(g);else{a:switch(typeof g){case "object":var h=null!=g;break a;case "function":h=
!0;break a;default:h=!1}h?this.VC(g):this.Zt(g)}};b.prototype.VC=function(g){var h=void 0;try{h=g.then}catch(k){this.zr(k);return}"function"==typeof h?this.mD(h,g):this.Zt(g)};b.prototype.zr=function(g){this.fx(2,g)};b.prototype.Zt=function(g){this.fx(1,g)};b.prototype.fx=function(g,h){if(0!=this.o)throw Error("Cannot settle("+g+", "+h+"): Promise already settled in state"+this.o);this.o=g;this.qf=h;2===this.o&&this.ZC();this.iz()};b.prototype.ZC=function(){var g=this;e(function(){if(g.UB()){var h=
ja.console;"undefined"!==typeof h&&h.error(g.qf)}},1)};b.prototype.UB=function(){if(this.Wu)return!1;var g=ja.CustomEvent,h=ja.Event,k=ja.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof g?g=new g("unhandledrejection",{cancelable:!0}):"function"===typeof h?g=new h("unhandledrejection",{cancelable:!0}):(g=ja.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g));g.promise=this;g.reason=this.qf;return k(g)};b.prototype.iz=function(){if(null!=this.Uh){for(var g=
0;g<this.Uh.length;++g)f.dt(this.Uh[g]);this.Uh=null}};var f=new c;b.prototype.lD=function(g){var h=this.cp();g.Kl(h.resolve,h.reject)};b.prototype.mD=function(g,h){var k=this.cp();try{g.call(h,k.resolve,k.reject)}catch(l){k.reject(l)}};b.prototype.then=function(g,h){function k(q,r){return"function"==typeof q?function(v){try{l(q(v))}catch(w){n(w)}}:r}var l,n,p=new b(function(q,r){l=q;n=r});this.Kl(k(g,l),k(h,n));return p};b.prototype.catch=function(g){return this.then(void 0,g)};b.prototype.Kl=function(g,
h){function k(){switch(l.o){case 1:g(l.qf);break;case 2:h(l.qf);break;default:throw Error("Unexpected state: "+l.o);}}var l=this;null==this.Uh?f.dt(k):this.Uh.push(k);this.Wu=!0};b.resolve=d;b.reject=function(g){return new b(function(h,k){k(g)})};b.race=function(g){return new b(function(h,k){for(var l=fa(g),n=l.next();!n.done;n=l.next())d(n.value).Kl(h,k)})};b.all=function(g){var h=fa(g),k=h.next();return k.done?d([]):new b(function(l,n){function p(v){return function(w){q[v]=w;r--;0==r&&l(q)}}var q=
[],r=0;do q.push(void 0),r++,d(k.value).Kl(p(q.length-1),n),k=h.next();while(!k.done)})};return b});la("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&c.push([d,b[d]]);return c}});la("Array.prototype.entries",function(a){return a?a:function(){return na(this,function(b,c){return[b,c]})}});la("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&c.push(b[d]);return c}});
la("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}});la("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}});
la("String.prototype.includes",function(a){return a?a:function(b,c){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==(this+"").indexOf(b,c||0)}});
la("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}});function ua(a){return a?a:Array.prototype.fill}la("Int8Array.prototype.fill",ua);la("Uint8Array.prototype.fill",ua);la("Uint8ClampedArray.prototype.fill",ua);la("Int16Array.prototype.fill",ua);la("Uint16Array.prototype.fill",ua);la("Int32Array.prototype.fill",ua);
la("Uint32Array.prototype.fill",ua);la("Float32Array.prototype.fill",ua);la("Float64Array.prototype.fill",ua);var va="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a};la("Object.assign",function(a){return a||va});la("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}});
la("Array.prototype.findIndex",function(a){return a?a:function(b,c){return oa(this,b,c).Fu}});var wa=this||self;function xa(a,b,c,d){a=a.split(".");d=d||wa;a[0]in d||"undefined"==typeof d.execScript||d.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||void 0===b)d=d[e]&&d[e]!==Object.prototype[e]?d[e]:d[e]={};else if(!c&&ya(b)&&ya(d[e]))for(var f in b)b.hasOwnProperty(f)&&(d[e][f]=b[f]);else d[e]=b}function za(){}
function Aa(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}function Ca(a){var b=Aa(a);return"array"==b||"object"==b&&"number"==typeof a.length}function ya(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function Da(a){return Object.prototype.hasOwnProperty.call(a,Ea)&&a[Ea]||(a[Ea]=++Fa)}var Ea="closure_uid_"+(1E9*Math.random()>>>0),Fa=0;function Ga(a,b,c){return a.call.apply(a.bind,arguments)}
function Ha(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function Ia(a,b,c){Ia=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ga:Ha;return Ia.apply(null,arguments)}
function Ja(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function t(a,b){xa(a,b,!0,void 0)}function u(a,b){function c(){}c.prototype=b.prototype;a.g=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.$D=function(d,e,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[e].apply(d,g)}};function La(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function Ma(a){for(var b in a)return!1;return!0}function Na(a){var b={},c;for(c in a)b[c]=a[c];return b}var Pa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qa(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Pa.length;f++)c=Pa[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function Ra(a,b){if(Error.captureStackTrace)Error.captureStackTrace(this,Ra);else{var c=Error().stack;c&&(this.stack=c)}a&&(this.message=String(a));b&&(this.bE=b)}u(Ra,Error);Ra.prototype.name="CustomError";var Sa=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function Ua(){return Object.create(x,void 0)}var z=Ia,Va=String,Wa=globalThis.Object.freeze||function(a){return a};function Xa(a){for(var b=Object.keys(a),c=b.length,d;c--;)d=a[b[c]],ya(d)&&Xa(d);return Wa(a)}function Ya(a){var b=Aa(a);if("object"==b||"array"==b){if(Za(a.clone))return a.clone();b="array"==b?[]:{};for(var c in a)a.hasOwnProperty(c)&&(b[c]=Ya(a[c]));return b}return a}var A=[].pop(),x=/x/.exec(""),$a="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function B(a,b,c,d,e){if(!(b=a instanceof b)&&c)throw new C(c,d,ab(e)?e:a);return b}function bb(a,b){if(!0===(B(a,b)&&a.constructor===b))throw new TypeError("Illegal constructor "+cb(b));}function Za(a){return"function"==Aa(a)}function db(a,b,c,d,e){if(!(b=eb(a)===b)&&c)throw new C(c,d,ab(e)?e:a);return b}function fb(a,b,c,d){return db(a,"Array",b,c,d)}t("H.lang.isArray",fb);function ab(a){return a!==A}function gb(a){return"string"===typeof a}t("H.lang.isString",gb);
var hb=parseInt,ib=parseFloat,E=isNaN;function jb(a){return a===+a}t("H.lang.isNumber",jb);t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(a){return"number"===typeof a&&0===a%1});function kb(a){return!E(+a)}function eb(a){var b=Object[$a[0]][$a[6]].call(a).match(/^\[object (\w+)\]$/);return b?b[1]:typeof a}var lb=[];function mb(a){0>lb.indexOf(a)&&lb.push(a)}mb(lb);
function cb(a,b,c,d){var e="",f=2>arguments.length,g;f&&(b={H:globalThis.H},c="",d=lb.slice());nb(b,!0,function(h,k){try{if(g=h[k],k=ob(h,g),!(ya(g)&&g.window===g&&g.self===g||ya(g)&&0<g.nodeType&&Za(g.cloneNode))&&ya(g)){if(g===a)return e=c+"."+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=cb(a,g,c+"."+k,d)))return!0}}catch(l){}});f&&(e=e?e.substr(1).replace("."+$a[0]+".","#"):"~"+(Za(a)?pb(a)+"()":eb(a)));return e}
function ob(a,b){var c=[];nb(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(qb)[0]}function qb(a,b){return b.length-a.length}var rb=Object[$a[0]][$a[2]];function nb(a,b,c){var d;if(a){for(e in a)if((!b||rb.call(a,e))&&c(a,e,!0))return;for(d=$a.length;d--;){var e=$a[d];if((!b||rb.call(a,e))&&c(a,e,!1))break}}}function pb(a){return(a=/^\s*function ([^\( ]+)/.exec(a))?a[1]:"anonymous"}function sb(a,b,c){c[b]="#"+b}var tb=!!globalThis.__karma__;
function ub(){throw Error("unimplemented method");}function C(a,b,c){var d=arguments.length,e;b=b!==A?+b:b;b!==A&&((e=/^.*?\(([^\)]+)/.exec((""+a).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?(e=e[1].replace(/\s+/g,""),e=Va(e).split(","!==A?",":" ")):e=[],e.forEach(sb),e=e[b]||"#"+b);var f=a?cb(a):"";d=2<d?Va(c):"";if(e||d)f+=" (Argument "+(e||"")+(d?" "+d:"")+")";d=Error(f);Object.setPrototypeOf(d,C.prototype);return d}u(C,Error);t("H.lang.InvalidArgumentError",C);C.prototype.name="InvalidArgumentError";
function vb(a,b){var c=[];a&&c.push(cb(a));1<arguments.length&&c.push(""+b);c=Error(c.join(" "));Object.setPrototypeOf(c,vb.prototype);return c}u(vb,Error);t("H.lang.IllegalOperationError",vb);vb.prototype.name="IllegalOperationError";function xb(a){a&&"function"==typeof a.l&&a.l()};function yb(){0!=zb&&(Ab[Da(this)]=this);this.jh=this.jh;this.ee=this.ee}var zb=0,Ab={};yb.prototype.jh=!1;yb.prototype.l=function(){if(!this.jh&&(this.jh=!0,this.disposeInternal(),0!=zb)){var a=Da(this);if(0!=zb&&this.ee&&0<this.ee.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Ab[a]}};
yb.prototype.ac=function(a,b){this.jh?void 0!==b?a.call(b):a():(this.ee||(this.ee=[]),this.ee.push(void 0!==b?Ia(a,b):a))};yb.prototype.disposeInternal=function(){if(this.ee)for(;this.ee.length;)this.ee.shift()()};function Bb(a,b){return-1!=a.indexOf(b)};var Cb;a:{var Db=wa.navigator;if(Db){var Eb=Db.userAgent;if(Eb){Cb=Eb;break a}}Cb=""};function Fb(a){Fb[" "](a);return a}Fb[" "]=za;var Gb=Bb(Cb,"Gecko")&&!(Bb(Cb.toLowerCase(),"webkit")&&!Bb(Cb,"Edge"))&&!(Bb(Cb,"Trident")||Bb(Cb,"MSIE"))&&!Bb(Cb,"Edge"),Hb=Bb(Cb.toLowerCase(),"webkit")&&!Bb(Cb,"Edge");var Ib=function(){if(!wa.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{wa.addEventListener("test",za,b),wa.removeEventListener("test",za,b)}catch(c){}return a}();function Jb(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.zk=!1}Jb.prototype.stopPropagation=function(){this.zk=!0};Jb.prototype.preventDefault=function(){this.defaultPrevented=!0};function Kb(a,b){Jb.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key="";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType="";this.vj=null;a&&this.Fm(a,b)}u(Kb,Jb);var Lb={2:"touch",3:"pen",4:"mouse"};
Kb.prototype.Fm=function(a,b){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(Gb){a:{try{Fb(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=
d.screenY||0):(this.offsetX=Hb||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=Hb||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||"";this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=
a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:Lb[a.pointerType]||"";this.state=a.state;this.vj=a;a.defaultPrevented&&Kb.g.preventDefault.call(this)};Kb.prototype.stopPropagation=function(){Kb.g.stopPropagation.call(this);this.vj.stopPropagation?this.vj.stopPropagation():this.vj.cancelBubble=!0};Kb.prototype.preventDefault=function(){Kb.g.preventDefault.call(this);var a=this.vj;a.preventDefault?a.preventDefault():a.returnValue=!1};var Mb="closure_listenable_"+(1E6*Math.random()|0);function Nb(a){return!(!a||!a[Mb])};var Ob=0;function Pb(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.wm=e;this.key=++Ob;this.ii=this.Jl=!1}function Qb(a){a.ii=!0;a.listener=null;a.proxy=null;a.src=null;a.wm=null};function Rb(a){this.src=a;this.nb={};this.pl=0}m=Rb.prototype;m.add=function(a,b,c,d,e){var f=a.toString();a=this.nb[f];a||(a=this.nb[f]=[],this.pl++);var g=Sb(a,b,d,e);-1<g?(b=a[g],c||(b.Jl=!1)):(b=new Pb(b,this.src,f,!!d,e),b.Jl=c,a.push(b));return b};m.remove=function(a,b,c,d){a=a.toString();if(!(a in this.nb))return!1;var e=this.nb[a];b=Sb(e,b,c,d);return-1<b?(Qb(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.nb[a],this.pl--),!0):!1};
function Tb(a,b){var c=b.type;if(!(c in a.nb))return!1;var d=a.nb[c],e=Sa(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Qb(b),0==a.nb[c].length&&(delete a.nb[c],a.pl--));return f}m.ia=function(a){a=a&&a.toString();var b=0,c;for(c in this.nb)if(!a||c==a){for(var d=this.nb[c],e=0;e<d.length;e++)++b,Qb(d[e]);delete this.nb[c];this.pl--}return b};m.Kp=function(a,b,c,d){a=this.nb[a.toString()];var e=-1;a&&(e=Sb(a,b,c,d));return-1<e?a[e]:null};
m.bq=function(a,b){var c=void 0!==a,d=c?a.toString():"",e=void 0!==b;return La(this.nb,function(f){for(var g=0;g<f.length;++g)if(!(c&&f[g].type!=d||e&&f[g].capture!=b))return!0;return!1})};function Sb(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.ii&&f.listener==b&&f.capture==!!c&&f.wm==d)return e}return-1};var Ub="closure_lm_"+(1E6*Math.random()|0),Vb={},Wb=0;function Xb(a,b,c,d,e){if(d&&d.once)return Yb(a,b,c,d,e);if(Array.isArray(b)){for(var f=0;f<b.length;f++)Xb(a,b[f],c,d,e);return null}c=Zb(c);return Nb(a)?a.pd.add(String(b),c,!1,ya(d)?!!d.capture:!!d,e):$b(a,b,c,!1,d,e)}
function $b(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=ya(e)?!!e.capture:!!e,h=ac(a);h||(a[Ub]=h=new Rb(a));c=h.add(b,c,d,g,f);if(c.proxy)return c;d=bc();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)Ib||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(cc(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");Wb++;return c}
function bc(){function a(c){return b.call(a.src,a.listener,c)}var b=dc;return a}function Yb(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)Yb(a,b[f],c,d,e);return null}c=Zb(c);return Nb(a)?a.pd.add(String(b),c,!0,ya(d)?!!d.capture:!!d,e):$b(a,b,c,!0,d,e)}
function ec(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)ec(a,b[f],c,d,e);return null}d=ya(d)?!!d.capture:!!d;c=Zb(c);if(Nb(a))return a.pd.remove(String(b),c,d,e);if(!a)return!1;if(a=ac(a))if(b=a.Kp(b,c,d,e))return fc(b);return!1}
function fc(a){if("number"===typeof a||!a||a.ii)return!1;var b=a.src;if(Nb(b))return Tb(b.pd,a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(cc(c),d):b.addListener&&b.removeListener&&b.removeListener(d);Wb--;(c=ac(b))?(Tb(c,a),0==c.pl&&(c.src=null,b[Ub]=null)):Qb(a);return!0}function cc(a){return a in Vb?Vb[a]:Vb[a]="on"+a}function gc(a,b){var c=a.listener,d=a.wm||a.src;a.Jl&&fc(a);return c.call(d,b)}
function dc(a,b){return a.ii?!0:gc(a,new Kb(b,this))}function ac(a){a=a[Ub];return a instanceof Rb?a:null}var hc="__closure_events_fn_"+(1E9*Math.random()>>>0);function Zb(a){if("function"===typeof a)return a;a[hc]||(a[hc]=function(b){return a.handleEvent(b)});return a[hc]};var kc,lc,mc,nc,oc,pc,qc,rc,sc;t("H.util.Event",Jb);Jb.prototype.stopPropagation=Jb.prototype.stopPropagation;Jb.prototype.stopPropagation=Jb.prototype.stopPropagation;Jb.prototype.CAPTURING_PHASE=1;Jb.prototype.CAPTURING_PHASE=Jb.prototype.CAPTURING_PHASE;Jb.prototype.AT_TARGET=2;Jb.prototype.AT_TARGET=Jb.prototype.AT_TARGET;Jb.prototype.BUBBLING_PHASE=3;Jb.prototype.BUBBLING_PHASE=Jb.prototype.BUBBLING_PHASE;Jb.prototype.eventPhase=0;Jb.prototype.eventPhase=Jb.prototype.eventPhase;function tc(a,b,c){tc.g.constructor.call(this,a,c);this.message=b}u(tc,Jb);t("H.util.ErrorEvent",tc);function uc(a,b,c){uc.g.constructor.call(this,a,c);this.data=b}u(uc,Jb);t("H.util.DataEvent",uc);function G(){yb.call(this);this.pd=new Rb(this);this.my=this;this.er=null}u(G,yb);G.prototype[Mb]=!0;m=G.prototype;m.Ib=function(){return this.er};m.ea=function(a){this.er=a};m.addEventListener=function(a,b,c,d){Xb(this,a,b,c,d)};m.removeEventListener=function(a,b,c,d){ec(this,a,b,c,d)};
m.dispatchEvent=function(a){var b,c=this.Ib();if(c)for(b=[];c;c=c.Ib())b.push(c);c=this.my;var d=a.type||a;if("string"===typeof a)a=new Jb(a,c);else if(a instanceof Jb)a.target=a.target||c;else{var e=a;a=new Jb(d,c);Qa(a,e)}e=!0;if(b)for(var f=b.length-1;!a.zk&&0<=f;f--){var g=a.currentTarget=b[f];e=g.Kf(d,!0,a)&&e}a.zk||(g=a.currentTarget=c,e=g.Kf(d,!0,a)&&e,a.zk||(e=g.Kf(d,!1,a)&&e));if(b)for(f=0;!a.zk&&f<b.length;f++)g=a.currentTarget=b[f],e=g.Kf(d,!1,a)&&e;return e};
m.disposeInternal=function(){G.g.disposeInternal.call(this);this.pd&&this.pd.ia(void 0);this.er=null};m.Kf=function(a,b,c){a=this.pd.nb[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.ii&&f.capture==b){var g=f.listener,h=f.wm||f.src;f.Jl&&Tb(this.pd,f);d=!1!==g.call(h,c)&&d}}return d&&!c.defaultPrevented};m.Kp=function(a,b,c,d){return this.pd.Kp(String(a),b,c,d)};m.bq=function(a,b){return this.pd.bq(void 0!==a?String(a):void 0,b)};t("H.util.EventTarget",G);G.prototype.ea=G.prototype.ea;G.prototype.setParentEventTarget=G.prototype.ea;G.prototype.Ib=G.prototype.Ib;G.prototype.getParentEventTarget=G.prototype.Ib;G.prototype.addEventListener=G.prototype.addEventListener;G.prototype.addEventListener=G.prototype.addEventListener;G.prototype.removeEventListener=G.prototype.removeEventListener;G.prototype.removeEventListener=G.prototype.removeEventListener;G.prototype.dispatchEvent=G.prototype.dispatchEvent;
G.prototype.dispatchEvent=G.prototype.dispatchEvent;G.prototype.l=G.prototype.l;G.prototype.dispose=G.prototype.l;G.prototype.ac=G.prototype.ac;G.prototype.addOnDisposeCallback=G.prototype.ac;G.prototype.mz=G.prototype.Kf;
G.prototype.Kf=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?"AT_TARGET":b?"CAPTURING_PHASE":(d=!0,"BUBBLING_PHASE")];if(!d||"pointerenter"!==(e=c.type)&&"pointerleave"!==e)c.eventPhase=g,f=G.prototype.mz.apply(this,arguments),d&&this.Ib&&null===this.Ib()&&delete c.eventPhase;return f};G.prototype.bx=function(a){for(var b,c=this;c&&(b=c.Ib())&&b!==a;)c=b;b||c.ea(a)};G.prototype.setRootParentEventTarget=G.prototype.bx;function vc(a){a=a||{};var b=a.callback;this.Vb=a.label;Za(b)&&(this.callback=b);this.tb=!!a.disabled;vc.g.constructor.call(this)}u(vc,G);t("H.util.ContextItem",vc);vc.prototype.Hp=function(){return this.Vb};vc.prototype.getLabel=vc.prototype.Hp;vc.prototype.we=function(a){this.Vb!==a&&(this.Vb=a,this.dispatchEvent("update"));return this};vc.prototype.setLabel=vc.prototype.we;vc.prototype.lq=function(){return this.tb};vc.prototype.isDisabled=vc.prototype.lq;
vc.prototype.za=function(a){a!==this.tb&&(this.tb=a,this.dispatchEvent("update"));return this};vc.prototype.setDisabled=vc.prototype.za;var wc=new vc;vc.SEPARATOR=wc;var xc=Math,yc=xc.min,Ac=xc.max,Bc=xc.round,Cc=xc.floor,Dc=xc.ceil,Ec=xc.abs,Fc=xc.log,Gc=xc.sqrt,Hc=xc.pow,Ic=xc.exp,Jc=xc.sin,Kc=xc.asin,Mc=xc.cos,Nc=xc.tan,Oc=xc.atan,Pc=xc.atan2,Qc=xc.LN2,Rc=xc.PI,Sc=Rc/2,Tc=Rc/4,Uc=2*Rc,Vc=3*Rc,Wc=Rc/180,Xc=180/Rc,Yc=1/0,Zc=Hc(-2,53),$c=$c||function(a){return Fc(a)/Qc};function ad(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}function bd(a,b,c){b-=c=c||0;a-=c;return a-Cc(a/b)*b+c}t("H.math.normalize",bd);function cd(a,b,c){return(a-=0)>c?c:a<b?b:a}
t("H.math.clamp",cd);function dd(a,b,c,d){(d-=0)||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}var ed={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t("H.math.CoverType",ed);
function fd(a,b,c,d,e,f){var g=c.length,h=g,k=c[0],l=0,n=0,p=0;d=d/2||0;var q=f||2;f=q*(e?0:1)+1;for(var r=q-2;1!=l&&h>f;){h-=r;var v=c[--h];q=c[--h];var w=c[h?h-r-1:(g+(h-r-1))%g];var y=c[h?h-r-2:(g+(h-r-2))%g];if(q>=a-d&&q<=a+d&&v>=b-d&&v<=b+d||y>=a-d&&y<=a+d&&w>=b-d&&w<=b+d)l=1;else if(!l&&q===a)y===a&&(v<b&&w>b||v>b&&w<b)||(k<=a&&y>a||k>=a&&y<a)&&(v>=b?++n:++p),l=dd(b,v,w,d)&&Gc(Hc((a-y)*(v-w)-(b-w)*(q-y),2)/(Hc(q-y,2)+Hc(v-w,2)))<=d?2:0;else if(!l&&dd(a,q,y,d)){if(q<a&&y>a||q>a&&y<a)k=v+(a-q)/
(y-q)*(w-v),n+=k>b,p+=k<b;l=dd(b,v,w,d)&&Gc(Hc((a-y)*(v-w)-(b-w)*(q-y),2)/(Hc(q-y,2)+Hc(v-w,2)))<=d?2:0}k=q}!l&&e&&0!==p&&0!==n%2&&(l=3);return l}function gd(a,b){return fd(a.x,a.y,b,0,!0)!==ed.NONE}t("H.math.isPointInsidePolygon",gd);function hd(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&ab(a[0].x);b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}t("H.math.flatten",hd);function id(a){wa.setTimeout(function(){throw a;},0)};function jd(a,b){this.wB=100;this.Oy=a;this.zg=b;this.bn=0;this.Am=null}jd.prototype.get=function(){if(0<this.bn){this.bn--;var a=this.Am;this.Am=a.next;a.next=null}else a=this.Oy();return a};jd.prototype.put=function(a){this.zg(a);this.bn<this.wB&&(this.bn++,a.next=this.Am,this.Am=a)};function kd(){this.po=this.Gi=null}kd.prototype.add=function(a,b){var c=ld.get();c.set(a,b);this.po?this.po.next=c:this.Gi=c;this.po=c};kd.prototype.remove=function(){var a=null;this.Gi&&(a=this.Gi,this.Gi=this.Gi.next,this.Gi||(this.po=null),a.next=null);return a};var ld=new jd(function(){return new md},function(a){return a.reset()});function md(){this.next=this.scope=this.up=null}md.prototype.set=function(a,b){this.up=a;this.scope=b;this.next=null};
md.prototype.reset=function(){this.next=this.scope=this.up=null};function nd(){var a=document;var b="IFRAME";"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)};var od;
function pd(){var a=wa.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!Bb(Cb,"Presto")&&(a=function(){var e=nd();e.style.display="none";document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.close();var g="callImmediate"+Math.random(),h="file:"==f.location.protocol?"*":f.location.protocol+"//"+f.location.host;e=Ia(function(k){if(("*"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},this);f.addEventListener("message",e,
!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if("undefined"!==typeof a&&!Bb(Cb,"Trident")&&!Bb(Cb,"MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.jt;c.jt=null;e()}};return function(e){d.next={jt:e};d=d.next;b.port2.postMessage(0)}}return function(e){wa.setTimeout(e,0)}};function qd(a,b){rd||sd();td||(rd(),td=!0);ud.add(a,b)}var rd;function sd(){if(wa.Promise&&wa.Promise.resolve){var a=wa.Promise.resolve(void 0);rd=function(){a.then(vd)}}else rd=function(){var b=vd;"function"!==typeof wa.setImmediate||wa.Window&&wa.Window.prototype&&!Bb(Cb,"Edge")&&wa.Window.prototype.setImmediate==wa.setImmediate?(od||(od=pd()),od(b)):wa.setImmediate(b)}}var td=!1,ud=new kd;function vd(){for(var a;a=ud.remove();){try{a.up.call(a.scope)}catch(b){id(b)}ld.put(a)}td=!1};function wd(a){this.o=xd;this.qf=void 0;this.Yg=this.Ke=this.og=null;this.um=this.qp=!1;if(a!=za)try{var b=this;a.call(void 0,function(c){yd(b,zd,c)},function(c){yd(b,Ad,c)})}catch(c){yd(this,Ad,c)}}var xd=0,zd=2,Ad=3;function Bd(){this.next=this.context=this.Th=this.pk=this.Ef=null;this.Dl=!1}Bd.prototype.reset=function(){this.context=this.Th=this.pk=this.Ef=null;this.Dl=!1};var Cd=new jd(function(){return new Bd},function(a){a.reset()});
function Dd(a,b,c){var d=Cd.get();d.pk=a;d.Th=b;d.context=c;return d}function Ed(a){if(a instanceof wd)return a;var b=new wd(za);yd(b,zd,a);return b}function Fd(a){return new wd(function(b,c){c(a)})}function Gd(){var a,b,c=new wd(function(d,e){a=d;b=e});return new Hd(c,a,b)}wd.prototype.then=function(a,b,c){return Id(this,"function"===typeof a?a:null,"function"===typeof b?b:null,c)};wd.prototype.$goog_Thenable=!0;
wd.prototype.cancel=function(a){if(this.o==xd){var b=new Jd(a);qd(function(){Kd(this,b)},this)}};function Kd(a,b){if(a.o==xd)if(a.og){var c=a.og;if(c.Ke){for(var d=0,e=null,f=null,g=c.Ke;g&&(g.Dl||(d++,g.Ef==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.o==xd&&1==d?Kd(c,b):(f?(d=f,d.next==c.Yg&&(c.Yg=d),d.next=d.next.next):Ld(c),Md(c,e,Ad,b)))}a.og=null}else yd(a,Ad,b)}function Nd(a,b){a.Ke||a.o!=zd&&a.o!=Ad||Od(a);a.Yg?a.Yg.next=b:a.Ke=b;a.Yg=b}
function Id(a,b,c,d){var e=Dd(null,null,null);e.Ef=new wd(function(f,g){e.pk=b?function(h){try{var k=b.call(d,h);f(k)}catch(l){g(l)}}:f;e.Th=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof Jd?g(h):f(k)}catch(l){g(l)}}:g});e.Ef.og=a;Nd(a,e);return e.Ef}wd.prototype.KD=function(a){this.o=xd;yd(this,zd,a)};wd.prototype.LD=function(a){this.o=xd;yd(this,Ad,a)};
function yd(a,b,c){if(a.o==xd){a===c&&(b=Ad,c=new TypeError("Promise cannot resolve to itself"));a.o=1;a:{var d=c,e=a.KD,f=a.LD;if(d instanceof wd){Nd(d,Dd(e||za,f||null,a));var g=!0}else{if(d)try{var h=!!d.$goog_Thenable}catch(l){h=!1}else h=!1;if(h)d.then(e,f,a),g=!0;else{if(ya(d))try{var k=d.then;if("function"===typeof k){Pd(d,k,e,f,a);g=!0;break a}}catch(l){f.call(a,l);g=!0;break a}g=!1}}}g||(a.qf=c,a.o=b,a.og=null,Od(a),b!=Ad||c instanceof Jd||Qd(a,c))}}
function Pd(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Od(a){a.qp||(a.qp=!0,qd(a.hz,a))}function Ld(a){var b=null;a.Ke&&(b=a.Ke,a.Ke=b.next,b.next=null);a.Ke||(a.Yg=null);return b}wd.prototype.hz=function(){for(var a;a=Ld(this);)Md(this,a,this.o,this.qf);this.qp=!1};
function Md(a,b,c,d){if(c==Ad&&b.Th&&!b.Dl)for(;a&&a.um;a=a.og)a.um=!1;if(b.Ef)b.Ef.og=null,Rd(b,c,d);else try{b.Dl?b.pk.call(b.context):Rd(b,c,d)}catch(e){Sd.call(null,e)}Cd.put(b)}function Rd(a,b,c){b==zd?a.pk.call(a.context,c):a.Th&&a.Th.call(a.context,c)}function Qd(a,b){a.um=!0;qd(function(){a.um&&Sd.call(null,b)})}var Sd=id;function Jd(a){Ra.call(this,a)}u(Jd,Ra);Jd.prototype.name="cancel";function Hd(a,b,c){this.promise=a;this.resolve=b;this.reject=c};function Td(){}t("H.util.ICancelable",Td);Td.prototype.cancel=function(){};Td.prototype.cancel=Td.prototype.cancel;function Ud(a,b,c){this.type=a;this.data=b;this.Er=Gd();this.resolve=z(this.resolve,this);this.reject=z(this.reject,this);this.priority=Vd;c!==A&&(this.priority=c);this.Gp().add(this)}var Vd=1,Wd={UD:0,XD:Vd,SD:2};m=Ud.prototype;m.then=function(a,b,c){return this.Er.promise.then(a,b,c)};m.resolve=function(a){this.state=3;this.Er.resolve(a)};m.reject=function(a){this.state=5;this.Er.reject(a)};m.state=0;m.cancel=function(){3>this.state&&(this.Xi(),this.Gp().remove(this),this.state=4)};
Ud.prototype.cancel=Ud.prototype.cancel;function Xd(a){var b;this.tg={};for(b in Wd)this.tg[Wd[b]]=[];this.Jk=a;this.Jk.addEventListener("allocatable",z(this.Qt,this))}t("H.util.JobManager",Xd);var Yd=Object.keys(Wd).map(function(a){return Wd[a]}).sort().reverse();Xd.prototype.add=function(a){B(a,Ud,this.add,0);this.tg[a.priority].push(a);this.Qt()};Xd.prototype.contains=function(a){return-1<this.tg[a.priority].indexOf(a)};
Xd.prototype.remove=function(a){var b=a.priority,c=this.tg[b].indexOf(a);if(-1<c)return this.tg[b].splice(c,1),!0;a.Bs&&this.Jk.am(a.Bs);return!1};Xd.prototype.Qt=function(){Yd.forEach(function(a){this.tg[a]=this.tg[a].filter(function(b){var c;if((c=this.Jk.Go(b))!==x){var d=z(this.Jk.am,this.Jk,c,b);b.Bs=c;b.then(d,d);b.state=b.Pt(c)?1:5}else return!0},this)},this)};function Zd(a,b,c){var d=[],e=arguments.length;a&&d.push(cb(a));1<e&&(e=2<e&&fb(c)?" out of ["+c[0]+"..."+c[1]+"]":"",d.push("("+b+e+")"));d=Error(d.join(" "));Object.setPrototypeOf(d,Zd.prototype);return d}u(Zd,Error);t("H.lang.OutOfRangeError",Zd);Zd.prototype.name="OutOfRangeError";function $d(a){if(globalThis.document){var b=document.createElement("canvas");b.width=b.height=1;return b.getContext("2d",{willReadFrequently:a})}return null}function ae(){return window.devicePixelRatio||1}t("H.util.getPixelRatio",ae);var be=/^rgba\(([^,]+),([^,]+),([^,]+),([^)]+)\)$/;
function ce(a){var b=de[a],c=globalThis.RegExp;b||(globalThis.Uint8ClampedArray||(globalThis.Uint8ClampedArray=function(d){return d instanceof Number?Array(d):d.map(function(e){return cd(Bc(e),0,255)})}),"none"===a?b=new Uint8ClampedArray([0,0,0,0]):(ee.fillStyle="black",ee.fillStyle=a,be.test(ee.fillStyle)?b=new Uint8ClampedArray([c.$1,c.$2,c.$3,255*c.$4]):(ee.clearRect(0,0,1,1),ee.fillRect(0,0,1,1),b=ee.getImageData(0,0,1,1).data)),de[a]=b);return b}function fe(a){return"none"!==a&&0<ce(a)[3]}
var de=Ua(),ge=!!globalThis.VBArray;t("H.util.eval",function(a){return eval(a)});function he(a,b){return a!==A?a:b}function ie(a){return/^<svg/.test(a)?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a):a}t("H.util.provide",function(a){var b=wa.$jscomp;if(b&&("function"!=typeof b.Iz?0:b.Iz()))throw Error("goog.provide cannot be used within a module.");xa(a,void 0,void 0)});function je(a){this.yd=0<+a?xc.round(a):0}
je.prototype.next=function(a){if(9007199254740992===this.yd)throw new Zd(a,this.yd,[0,9007199254740991]);return this.yd++};var ke=new je,le=z(ke.next,ke);function me(){return!0}function ne(){return!1}function oe(){}var pe=Wa([]),qe=Wa({});function re(a){return"CANVAS"===a.tagName?[a]:a.getElementsByTagName("CANVAS")}function se(a,b,c){var d;b=a.ownerDocument===b?a.cloneNode(!0):b.importNode(a,!0);if(c)for(a=re(a),c=re(b),d=c.length;d--;)c[d].getContext("2d").drawImage(a[d],0,0);return b}
var ee=$d(!0),te=$d(!1);function ue(a){var b=a.complete,c=0<a.naturalWidth;if(b&&!c&&ge)try{te.drawImage(a,0,0),c=!0}catch(d){}return b&&c}var ve=globalThis.BlobBuilder||globalThis.WebKitBlobBuilder||globalThis.MozBlobBuilder;function we(a,b){b=b||"";if(ve){var c=new ve;c.append(a);a=c.getBlob(b)}else a=new Blob([a],{type:b});return a}var xe=globalThis.navigator.userAgent;lc=/\bedg\b/i.test(xe);mc=/\bfirefox\b/i.test(xe);nc=!lc&&/\bchrome\b/i.test(xe);oc=!nc&&!lc&&/\bsafari\b/i.test(xe);pc=/\bandroid\b/i.test(xe);
qc=/\bmac os\b/i.test(xe);rc=/\bwindows\b/i.test(xe);sc=/\blinux\b/i.test(xe);function ye(a,b){if(!B(a,Element)){ze.innerHTML=a;a=ze.firstElementChild;if(!a)throw new C(ye,0,"No element data");ze.removeChild(a);var c=!0;ze.innerHTML=""}this.Wo=0!==re(a).length;this.Lt=c?a:se(a,globalThis.document,this.Wo);b&&(c="onAttach",c in b&&db(a=b[c],"Function",ye,1,c)&&(this.Oq=a),c="onDetach",c in b&&db(a=b[c],"Function",ye,1,c)&&(this.Sq=a))}t("H.map.DomIcon",ye);var ze=document.createElement("DIV");ye.prototype.Oq=null;ye.prototype.Sq=null;
ye.prototype.cu=function(a){return se(this.Lt,a,this.Wo)};ye.prototype.Wo=!1;function Ae(a){Ae.g.constructor.call(this);void 0!==a&&(this.data=a)}u(Ae,G);t("H.map.Feature",Ae);Ae.prototype.getData=function(){return this.data};Ae.prototype.getData=Ae.prototype.getData;Ae.prototype.disposeInternal=function(){Ae.g.disposeInternal.call(this);delete this.data};function Be(){}t("H.map.provider.Invalidations",Be);Be.MARK_INITIAL=Zc;Be.prototype.update=function(a,b){b!==Ce.NONE&&(this.Kd=a,b&Ce.SPATIAL&&(this.jx=a),b&Ce.VISUAL&&(this.Ox=a),b&Ce.ADD&&(this.Ys=a),b&Ce.REMOVE&&(this.Fw=a),b&Ce.Z_ORDER&&(this.Sx=a),b&Ce.VOLATILITY&&(this.Px=a))};Be.prototype.update=Be.prototype.update;Be.prototype.mA=function(){return this.Kd};Be.prototype.getMark=Be.prototype.mA;Be.prototype.Kd=Zc;Be.prototype.iB=function(a){return this.Kd>a};Be.prototype.isAny=Be.prototype.iB;
Be.prototype.Ox=Zc;Be.prototype.Kh=function(a){return this.Ox>a};Be.prototype.isVisual=Be.prototype.Kh;Be.prototype.jx=Zc;Be.prototype.rq=function(a){return this.jx>a};Be.prototype.isSpatial=Be.prototype.rq;Be.prototype.Ys=Zc;Be.prototype.Qu=function(a){return this.Ys>a};Be.prototype.isAdd=Be.prototype.Qu;Be.prototype.Fw=Zc;Be.prototype.Lm=function(a){return this.Fw>a};Be.prototype.isRemove=Be.prototype.Lm;Be.prototype.Sx=Zc;Be.prototype.tq=function(a){return this.Sx>a};Be.prototype.isZOrder=Be.prototype.tq;
Be.prototype.Px=Zc;Be.prototype.nB=function(a){return this.Px>a};Be.prototype.isVolatility=Be.prototype.nB;var Ce={NONE:0,VISUAL:1,SPATIAL:2,ADD:4,REMOVE:8,Z_ORDER:16,VOLATILITY:32};Be.Flag=Ce;function I(a){bb(this,I);I.g.constructor.call(this,a?a.data:A);this.Sj=De.next();if(a){var b="min";jb(a[b])&&(this.yb=a[b]);b="max";jb(a[b])&&(this.Pc=a[b]);b="visibility";b in a&&(this.Jd=!!a[b]);b="volatility";b in a&&(this.no=!!a[b]);b="zIndex";b in a&&(this.Hi=+a[b]||0);b="provider";b in a&&!B(a[b],J)&&(this.D=a[b],this.qa(Ce.ADD))}}u(I,Ae);t("H.map.Object",I);var De=new je(1),Ee={ANY:31,OVERLAY:1,SPATIAL:2,MARKER:4,DOM_MARKER:8,GROUP:16};I.Type=Ee;I.prototype.wb=function(){return this.Sj};
I.prototype.getId=I.prototype.wb;I.prototype.Zr=function(a){if(!jb(a)&&!gb(a))throw new C(this.Zr,0,"id must be a number or a string");this.gi=a;return this};I.prototype.setRemoteId=I.prototype.Zr;I.prototype.DA=function(){return this.gi};I.prototype.getRemoteId=I.prototype.DA;I.prototype.yb=-1/0;I.prototype.Pc=1/0;I.prototype.ju=function(a){var b=this.Pc;if(a)for(a=this;a=a.Na;)b=yc(b,a.Pc);return b};I.prototype.getMax=I.prototype.ju;
I.prototype.lu=function(a){var b=this.yb;if(a)for(a=this;a=a.Na;)b=Ac(b,a.yb);return b};I.prototype.getMin=I.prototype.lu;I.prototype.Jd=!0;I.prototype.Yb=function(a){var b=this.Jd;(a=!!a)!==b&&(this.Jd=a,this.invalidate(Ce.VISUAL));return this};I.prototype.setVisibility=I.prototype.Yb;I.prototype.Vd=function(a){for(var b=this,c;(c=b.Jd)&&a&&(b=b.Na););return c};I.prototype.getVisibility=I.prototype.Vd;I.prototype.no=!1;I.prototype.tm=function(a){for(var b=this,c;!(c=b.no)&&a&&(b=b.Na););return c};
I.prototype.getVolatility=I.prototype.tm;I.prototype.dx=function(a){var b=this.no;b!==!!a&&(this.no=!b,this.invalidate(Ce.VOLATILITY));return this};I.prototype.setVolatility=I.prototype.dx;I.prototype.Hi=A;I.prototype.uu=function(){return this.Hi};I.prototype.getZIndex=I.prototype.uu;I.prototype.ui=function(a){a!==this.Hi&&(this.Ik(),this.Hi=a,this.invalidate(Ce.Z_ORDER));return this};I.prototype.setZIndex=I.prototype.ui;I.prototype.so=A;
I.prototype.Ve=function(){var a=this.so,b,c;if(!a){var d=+((b=this.Hi)!==A);(a=this.Na)?(a=a.Ve().slice(),a[0]|=d):a=[d];a.push(b||0,0>(c=this.cs)?this.Sj:c);this.so=a}return a};I.prototype.getZInfo=I.prototype.Ve;I.prototype.Ik=function(){this.so=A};function Fe(a,b,c){var d,e;if(!c||a[0]|b[0]){var f=a.length;var g=b.length;var h=yc(f,g);var k=1;for(e=1+ +c;k<h;k+=e)if(d=a[k]-b[k])return d}return c?0:f-g}I.compareZInfo=Fe;function Ge(a,b){return a.ot(b)}I.compareZOrder=Ge;
I.prototype.ot=function(a){return this.to-a.to||Fe(this.Ve(),a.Ve(),!1)};I.prototype.compareZOrder=I.prototype.ot;m=I.prototype;m.previousSibling=x;m.nextSibling=x;m.cs=-1;m.Na=x;m.rA=function(){return this.Na};I.prototype.getParentGroup=I.prototype.rA;I.prototype.qd=function(){for(var a=this,b;b=a.Na;)a=b;return a};I.prototype.getRootGroup=I.prototype.qd;I.prototype.contains=function(a){return this===a};I.prototype.contains=I.prototype.contains;
I.prototype.ea=function(a){if(this.Na)throw new vb(this.ea,"Not allowed for a child of a group");I.g.ea.call(this,a)};I.prototype.setParentEventTarget=I.prototype.ea;I.prototype.draggable=I.prototype.draggable=!1;I.prototype.D=x;I.prototype.Qp=function(){return this.D};I.prototype.getProvider=I.prototype.Qp;
I.prototype.ti=function(a,b){var c=this.D,d;if(d=c!==a){if(b&&(c&&!B(c,J)||a&&!B(a,J)))throw new vb(b,"Only LocalObjectProvider allows an object transfers");b=this.type!==Ee.GROUP;c&&(this.invalidate(Ce.REMOVE),b&&c.Oa(this));if(this.D=a)b&&a.Y(this),this.Wf=x,this.invalidate(Ce.ADD)}return d};I.prototype.Wf=x;I.prototype.Mc=function(){return this.Wf||(this.Wf=new Be)};I.prototype.getInvalidations=I.prototype.Mc;I.prototype.qa=function(a){var b=this.D,c;(c=!!b)&&b.invalidateObject(this,a);return c};
I.prototype.invalidate=I.prototype.qa;I.prototype.disposeInternal=function(){this.Na&&this.Na.Oa(this);I.g.disposeInternal.call(this)};I.prototype.setData=function(a){this.data=a;return this};I.prototype.setData=I.prototype.setData;
I.prototype.ye=function(a){if(a&&!Za(a))throw new C(I.prototype.ye,0,"opt_callback must be a function");a=He(this,a?a(this.data):this.data,!!a);a=Za(this.V)?{type:"Feature",properties:a,geometry:this.V().ye()}:{type:"FeatureCollection",features:pe};this.gi&&(a.id=this.gi);return a};I.prototype.toGeoJSON=I.prototype.ye;
function He(a,b,c){if(null===b||b===A)return null;if(0<=Object.keys(b).length&&"[object Object]"!==Object.prototype.toString.call(b))throw Error(Ie(a,c));try{return JSON.stringify(b),b}catch(d){throw Error(Ie(a,c));}}function Ie(a,b){return"Object Remote-Id: "+a.gi+" - "+(b?"The value returned by the callback is not a valid JSON object and cannot be set as Feature properties.":"The given object data is not a valid JSON object and cannot be set as Feature properties.")}
I.prototype.P=function(){return{id:this.Sj,properties:{min:this.lu(),max:this.ju(),zIdx:this.Hi,sIdx:this.cs,parent:this.Na?this.Na.wb():0,visible:this.Vd(),"volatile":this.tm()},type:"Feature"}};I.prototype.forWorkerMessage=I.prototype.P;function Je(a,b){var c;var d=a;var e=b||[];if(a!==Ke.NONE){b=c=e.length;if(-1===Le.indexOf(d))throw new C(Je,0,a);if(!e)throw new C(Je,1,e);for(;c--;)if(E(e[c]))throw new C(Je,1,e);d===Ke.RECT&&3<b&&(e=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]],d=Ke.POLYGON);if(d===Ke.CIRCLE&&2<b&&(a=e[2],0<a)){d=e[0];var f=e[1];c=yc(2*Dc(a),40);var g=360/c;for(e=[];c--;){var h=g*c*Wc;e.push(d+Jc(h)*a,f+Mc(h)*a)}d=Ke.POLYGON}if(d!==Ke.POLYGON||!b||e.length%2)throw new C(Je,1,e);this.mw=e}}t("H.map.HitArea",Je);
var Ke={NONE:0,RECT:1,CIRCLE:2,POLYGON:3};Je.ShapeType=Ke;var Le=[Ke.RECT,Ke.CIRCLE,Ke.POLYGON];Je.prototype.Cm=function(a,b,c){return this.mw?fd(a,b,this.mw,c,!0):ed.NONE};Je.prototype.hitTest=Je.prototype.Cm;function Me(a,b,c){var d=cd(+a,-90,90);if(b&&E(d))throw new C(b,c,a);return d}function Ne(a,b,c){var d=+a;if(-180>d||180<d)d=ad(d+180,360)-180;if(b&&E(d))throw new C(b,c,a);return d}function Oe(a,b,c){var d;if(a!==A&&E(d=+a)&&b)throw new C(b,c,a);return d}function Pe(a,b){return 0>a!==0>b&&180<Ec(b-a)}t("H.geo.isDBC",Pe);function Qe(){bb(this,Qe)}t("H.geo.AbstractGeometry",Qe);Qe.prototype.getBoundingBox=Qe.prototype.C;Qe.prototype.equals=Qe.prototype.da;Qe.prototype.$b="";Qe.prototype.Jc="";Qe.prototype.toString=function(){return this.xf([this.$b.toUpperCase()," "]).join("")};Qe.prototype.toString=Qe.prototype.toString;Qe.prototype.ye=function(){return{type:this.Jc,coordinates:this.wf()}};Qe.prototype.toGeoJSON=Qe.prototype.ye;Qe.prototype.P=function(){return{type:this.$b,coordinates:this.Pd(),boundingBox:this.C().P()}};
Qe.prototype.forWorkerMessage=Qe.prototype.P;function Re(a,b,c){this.lat=Me(a,Re,0);this.lng=Ne(b,Re,1);c!==A&&(this.alt=Oe(c,Re,2))}u(Re,Qe);t("H.geo.Point",Re);Re.prototype.da=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};Re.prototype.equals=Re.prototype.da;Re.prototype.ib=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*Wc;var c=a.lat*Wc;a=1.274200158E7*Kc(yc(1,Gc(Hc(Jc((b-c)/2),2)+Mc(b)*Mc(c)*Hc(Jc((this.lng*Wc-a.lng*Wc)/2),2))))}return a};
Re.prototype.distance=Re.prototype.ib;
Re.prototype.oo=function(a,b,c){var d;if(c){if(d=b/6371000.79){b=a*Wc;a=Wc*this.lat;var e=Jc(a);c=Jc(d);var f=Mc(d);d=Wc*this.lng;var g=Mc(a);a=Kc(g*Mc(b)*c+e*f);b=Pc(Jc(b)*g*c,f-e*Jc(a));b=(d+b+Rc)%(2*Rc)-Rc;b*=Xc;e=new Re(a*Xc,(b+540)%360-180)}return e||this}a=(a%360+360)%360;if(0===(a+90)%180)return a=this.lng+b/(6371000.79*Uc*Mc(this.lat*Wc))*(270===a?-360:360),new Re(this.lat,(a+540)%360-180);if(b/=6371000.79)a*=Wc,e=this.lat*Wc,c=this.lng*Wc,d=e+b*Mc(a),f=d-e,g=Fc(Nc(d/2+Tc)/Nc(e/2+Tc)),g=E(f/
g)?Mc(e):f/g,a=b*Jc(a)/g,Ec(d)>Sc&&(d=0<d?Rc-d:-(Rc+d)),d=new Re(d*Xc,((c+a+Vc+(Ec(e+f)>Sc?Rc:0))%Uc-Rc)*Xc);return d||this};Re.prototype.walk=Re.prototype.oo;Re.prototype.C=function(){return new K(this.lat,this.lng,this.lat,this.lng)};Re.prototype.getBoundingBox=Re.prototype.C;function Se(a,b,c){var d=ya(a)&&!(E(a.lat=Me(a.lat))||E(a.lng=Ne(a.lng))||a.alt!==A&&E(a.alt=Oe(a.alt)));if(!d&&b)throw new C(b,c,a);return d}Re.validate=Se;
function Te(a){if(!a)throw new C(Te,0,a);return new Re(a.lat,a.lng,a.alt)}Re.fromIPoint=Te;m=Re.prototype;m.$b="Point";m.xf=function(a){a.push("(",this.lng," ",this.lat,")");return a};m.Jc="Point";m.wf=function(){return[this.lng,this.lat,this.alt||0]};m.Pd=function(){return[this.lat,this.lng,this.alt||0]};function Ue(a,b){this.w=+a;this.h=+b}t("H.math.Size",Ue);function Ve(a){bb(this,Ve);Ve.g.constructor.call(this);this.ha=We(this,a,this.constructor,0)}u(Ve,Qe);t("H.geo.MultiGeometry",Ve);Ve.prototype.splice=function(a,b,c){a=[a];b!==A&&a.push(b);c&&(b=We(this,c,this.splice,2),a=a.concat(b));this.J=x;return this.ha.splice.apply(this.ha,a)};Ve.prototype.splice=Ve.prototype.splice;Ve.prototype.Cd=function(a){var b=this.ha.length;if(!(0<=a&&a<b))throw new Zd(this.Cd,a,[0,b-1]);this.J=x;return this.ha.splice(a,1)[0]};Ve.prototype.removeAt=Ve.prototype.Cd;
Ve.prototype.remove=function(a){a=this.ha.indexOf(a);if(0<=a){var b=this.ha.splice(a,1)[0];this.J=x}return b||x};Ve.prototype.remove=Ve.prototype.remove;Ve.prototype.Yz=function(){return this.ha};Ve.prototype.getGeometries=Ve.prototype.Yz;Ve.prototype.push=function(a){var b=We(this,[a],this.push,0)[0];this.J&&(this.J=this.J.xd(a.C()));this.ha.push(b)};Ve.prototype.push=Ve.prototype.push;
Ve.prototype.C=function(){var a;if(!(a=this.J)){a=x;var b,c;if(this.ha.length)for(a=this.ha[0].C(),c=1;c<this.ha.length;c++)if(b=this.ha[c].C())a=a?a.xd(b):b}return this.J=a};Ve.prototype.getBoundingBox=Ve.prototype.C;Ve.prototype.J=x;function We(a,b,c,d){var e,f=[];if(!fb(b))throw new C(c,d);for(e=0;e<b.length;e++)if(a.sq(b[e]))f.push(a.tw(b[e]));else throw new C(c,d);return f}Ve.prototype.tw=function(a){return a};
Ve.prototype.da=function(a){var b=this===a,c;if(!b&&(b=B(a,this.constructor))){var d=this.ha;a=a.ha;for(b=(c=d.length)===a.length;b&&c--;)b=d[c].da(a[c])}return b};Ve.prototype.equals=Ve.prototype.da;Ve.prototype.xf=function(a){var b=this.ha,c=b.length,d,e,f=!1;if(c){a.push("(");for(d=0;d<c;d++)(e=0<d&&f)&&a.push(","),b[d].xf(a),"EMPTY"===a[a.length-1]?a.splice(-1-+e,1+ +e):f=!0;f?a.push(")"):a.splice(-1,1,"EMPTY")}else a.push("EMPTY");return a};
Ve.prototype.Pd=function(){for(var a=[],b=this.ha,c=b.length;c--;)a[c]=b[c].Pd();return a};Ve.prototype.P=function(){var a=Ve.g.P.call(this);a.type=this.$b;return a};Ve.prototype.wf=function(){for(var a=[],b=this.ha,c=b.length;c--;)a[c]=b[c].wf();return a};function Xe(a){Xe.g.constructor.call(this,a)}u(Xe,Ve);t("H.geo.MultiPoint",Xe);Xe.prototype.sq=function(a){return Se(a)};Xe.prototype.tw=function(a){return B(a,Re)?a:Te(a)};Xe.prototype.$b="Multi"+Re.prototype.$b;Xe.prototype.Jc="Multi"+Re.prototype.Jc;function L(a,b){this.x=+a;this.y=+b}t("H.math.Point",L);L.prototype.set=L;L.prototype.set=L.prototype.set;L.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new L(this.x,this.y);return a};L.prototype.clone=L.prototype.clone;L.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};L.prototype.add=L.prototype.add;L.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};L.prototype.sub=L.prototype.sub;L.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};
L.prototype.scale=L.prototype.scale;L.prototype.round=function(){this.x=Bc(this.x);this.y=Bc(this.y);return this};L.prototype.round=L.prototype.round;L.prototype.floor=function(){this.x=Cc(this.x);this.y=Cc(this.y);return this};L.prototype.floor=L.prototype.floor;L.prototype.ceil=function(){this.x=Dc(this.x);this.y=Dc(this.y);return this};L.prototype.ceil=L.prototype.ceil;L.prototype.da=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};L.prototype.equals=L.prototype.da;
L.prototype.mu=function(a,b){var c=b.x-a.x,d=b.y-a.y;var e=a;if(c||d)e=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d),e=0>=e?a:1<=e?b:new L(a.x+e*c,a.y+e*d);return e};L.prototype.getNearest=L.prototype.mu;L.prototype.ib=function(a){return Gc(Hc(this.x-a.x,2)+Hc(this.y-a.y,2))};L.prototype.distance=L.prototype.ib;function Ye(a){if(!a)throw Error("invalid argument");return a instanceof L?a:new L(a.x,a.y)}L.fromIPoint=Ye;function Ze(a,b){var c;bb(this,Ze);Ze.g.constructor.call(this,b);this.X(a);b&&"icon"in b&&(c=b.icon);this.ve(c||this.Ep())}u(Ze,I);t("H.map.AbstractMarker",Ze);Ze.prototype.V=function(){return this.im};Ze.prototype.getGeometry=Ze.prototype.V;Ze.prototype.X=function(a){var b=this.im;B(a,Re)||B(a,Xe)?this.im=a:(Se(a,this.X,0),this.im=Te(a));b&&this.qa(Ce.SPATIAL);return this};Ze.prototype.setGeometry=Ze.prototype.X;Ze.prototype.C=function(){return this.im.C()};Ze.prototype.jc=function(){return this.icon};
Ze.prototype.getIcon=Ze.prototype.jc;Ze.prototype.ve=function(a){var b=this.icon,c=!b;if(b!==a){if(!this.Xu(a)){if(c)throw new C(this.constructor,1,a);throw new C(this.ve,0,a);}this.icon=a;c||this.qa(Ce.VISUAL)}return this};Ze.prototype.setIcon=Ze.prototype.ve;Ze.prototype.Ep=function(){var a=this.Ty;a||(a=this.constructor.prototype.Ty=this.rt($e));return a};
var $e={svg:'<svg xmlns="http://www.w3.org/2000/svg" width="38" height="47" viewBox="0 0 38 47"><g fill="none"><path fill="#0F1621" fill-opacity=".4" d="M15 46c0 .317 1.79.574 4 .574s4-.257 4-.574c0-.317-1.79-.574-4-.574s-4 .257-4 .574z"></path><path fill="#01b6b2" d="M33.25 31.652A19.015 19.015 0 0 0 38 19.06C38 8.549 29.478 0 19 0S0 8.55 0 19.059c0 4.823 1.795 9.233 4.75 12.593L18.975 46 33.25 31.652z"></path><path fill="#6A6D74" fill-opacity=".5" d="M26.862 37.5l4.714-4.77c3.822-3.576 5.924-8.411 5.924-13.62C37.5 8.847 29.2.5 19 .5S.5 8.848.5 19.11c0 5.209 2.102 10.044 5.919 13.614l4.719 4.776h15.724zM19 0c10.493 0 19 8.525 19 19.041 0 5.507-2.348 10.454-6.079 13.932L19 46 6.079 32.973C2.348 29.495 0 24.548 0 19.04 0 8.525 8.507 0 19 0z"></path></g></svg>',size:new Ue(38,
47),anchor:new L(19,45),hitArea:new Je(Ke.POLYGON,[19,46,2,27,0,18,5,6,19,0,32,5,38,15,36,27,19,47])};Ze.prototype.P=function(){var a=Ze.g.P.call(this),b=this.jc(),c=b.lc(),d=b.Cb;a.geometry=this.V().P();c&&(b=a.properties.icon={id:b.uid},b.size={w:c.w,h:c.h},b.offset=[c.w/2-(d?d.x:0),c.h/2-(d?d.y:0)]);return a};Ze.prototype.forWorkerMessage=Ze.prototype.P;function af(a,b){af.g.constructor.call(this,a,b)}u(af,Ze);t("H.map.DomMarker",af);af.prototype.type=Ee.DOM_MARKER;af.prototype.to=2;af.prototype.rt=function(a){var b=new ye(a.svg,a);a=a.anchor;b.Lt.style.margin=-a.y+"px 0 0 -"+a.x+"px";return b};af.prototype.Xu=function(a){return B(a,ye)};function bf(a,b,c,d){this.left=+a;this.top=+b;this.right=+c;this.bottom=+d}t("H.math.Rect",bf);bf.prototype.set=bf;bf.prototype.set=bf.prototype.set;bf.prototype.Nc=function(){return this.ml||(this.ml=new L(this.left,this.top))};bf.prototype.getTopLeft=bf.prototype.Nc;bf.prototype.Lc=function(){return this.Si||(this.Si=new L(this.right,this.bottom))};bf.prototype.getBottomRight=bf.prototype.Lc;bf.prototype.Rl=function(a,b){return this.left<=a&&this.right>=a&&this.top<=b&&this.bottom>=b};
bf.prototype.containsXY=bf.prototype.Rl;function cf(a,b){return new bf(a.x,a.y,b.x,b.y)}bf.fromPoints=cf;bf.prototype.clone=function(){return new bf(this.left,this.top,this.right,this.bottom)};bf.prototype.clone=bf.prototype.clone;t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);var df;function ef(a,b){if(globalThis.URL)return(new globalThis.URL(a,b)).toString();if(!a||!ff(a))return a;if(!b||ff(b))throw new TypeError("Failed to construct 'URL': Invalid base URL");df||(df=document.createElement("a"),mb(df));var c=df;c.href=b;"/"!==a[0]?a=c.href.replace(/\/[^\/]*$/,"/")+a:((b=c.origin)||(b=c.protocol+"//"+c.host),a=b+a);return a}function ff(a){var b=!1;"string"===typeof a&&(b=!(-1<a.search(/^(http|https|data|blob):/)||"//"===a.substr(0,2)));return b};function gf(a,b){gf.g.constructor.call(this);if(b&&ff(b))throw new C(gf,1,"Base URL must be absolute");this.o=hf.INIT;this.Ia=null;this.kd=b}u(gf,G);t("H.map.render.Style",gf);gf.prototype.load=gf.prototype.load;gf.prototype.getState=function(){return this.o};gf.prototype.getState=gf.prototype.getState;gf.prototype.F=function(a){this.o=a};gf.prototype.setState=gf.prototype.F;gf.prototype.Kc=function(){return this.kd};gf.prototype.getBaseUrl=gf.prototype.Kc;gf.prototype.Qd=function(){return Ya(this.Ia)};
gf.prototype.getConfig=gf.prototype.Qd;gf.prototype.Gz=function(){return this.Ia};gf.prototype.getConfigReference=gf.prototype.Gz;gf.prototype.Dg=function(a){this.Ia=a};gf.prototype.setConfig=gf.prototype.Dg;gf.prototype.Hc=function(a){this.Ia=null;this.F(hf.ERROR);this.bq(jf)?this.dispatchEvent(new tc(jf,a,this)):console.error(a)};gf.prototype.dispatchError=gf.prototype.Hc;gf.prototype.disposeInternal=function(){gf.g.disposeInternal.call(this);this.Ia=null};
var jf="error",kf={zf:"change",Hs:jf},hf={ERROR:-1,INIT:0,LOADING:1,READY:2};gf.State=hf;var lf={PROVIDES_BY_VIEWPORT:1,PROVIDES_RASTERS:2,PROVIDES_SPATIALS:4,PROVIDES_OVERLAYS:8,PROVIDES_MARKERS:16,PROVIDES_DOM_MARKERS:32,PROVIDES_GEOJSON:64,PROVIDES_OMV:128,CROP_LINES_BY_TILE:256,CROP_POLYGONS_BY_TILE:512,HAS_VOLATILE_DATA:1024};t("H.map.provider.Capabilities",lf);lf.PROVIDES_WEBGL_RENDERABLE_OBJECTS=lf.PROVIDES_SPATIALS|lf.PROVIDES_OVERLAYS|lf.PROVIDES_MARKERS;function mf(a,b){var c,d=arguments.length,e,f;for(c=1;c<d;c++)if((e=arguments[c])&&e!==a&&e!==g){var g=e;for(f in e){var h=e[f];a[f]!==h&&(nf(h)?nf(a[f])?a[f]=mf(a[f],h):a[f]=Ya(h):void 0!==h&&(a[f]=Ya(h)))}}return a}t("H.util.webgl.mergeObjects",mf);var of=Ua();function pf(a,b,c){var d=c[a];return b&&d in b&&0>$a.indexOf(d)?(b=b[d],++a<c.length?pf(a,b,c):b):of}
var qf=pf.bind(null,0),rf={polygons:1,lines:1,"pattern-lines":1,points:1,text:1,raster:1,custom_icons:1,overlays:1},sf={data:1,draw:1,enabled:1,filter:1,properties:1},tf=Object.keys(sf);function uf(a,b,c,d,e,f){var g=d[a],h=c[g];if(++a<d.length){var k=b[g]||{};for(c=tf.length;c--;){var l=tf[c];if("draw"!==l||!f){var n=h[l];n!==A&&(k[l]=Ya(n))}}uf(a,k,h,d,e,f)}else e?k=Ya(h):(k=h,delete c[g]);b[g]=b[g]?mf(b[g],k):k}var vf=uf.bind(null,0);function wf(a,b){a in rf&&(b[a]=1)}
function xf(a,b,c){var d,e,f;for(d in a)if(sf[d]){if("draw"===d){var g=a[d];for(e in g){var h=g[e];(f=h.style)?(h.style=b+f,wf(f,c)):(delete g[e],g[b+e]=h,wf(e,c))}}}else xf(a[d],b,c)}
function yf(a,b){var c={},d,e,f,g;b+="_";a=mf({},a);if(d=a.styles)for(e in d){var h=d[e];delete d[e];d[b+e]=h;if(f=h.mix)for(gb(f)&&(f=[f]),g=f.length;g--;)wf(f[g],c),f[g]=b+f[g];if(g=h.base)f||(f=h.mix=[]),f.unshift(b+g),delete h.base,wf(g,c);wf(e,c)}else d=a.styles={};if(h=a.layers)for(e in h)f=h[e],delete h[e],(g=f.data)&&!g.layer&&(g.layer=e),h[b+e]=f,xf(f,b,c);for(e in c)d[b+e]={base:e};return a}
function zf(a,b){var c=a.sources,d=Object.keys(c)[0],e=mf(c[d],{uid:b});c=a.layers;var f;a.sources={};a.sources[b]=e;for(f in c)a=c[f],a.data?a.data.source===d&&(a.data.source=b):a.data={source:b}}function Af(a,b){var c;var d=a.textures;a=a.fonts;for(c in d){var e=d[c];e.url&&(e.url=ef(e.url,b))}for(c in a)if(e=a[c],fb(e))for(d=0;d<e.length;d++){var f=e[d];f.url=f.url&&ef(f.url,b)}else f=e,f.url=f.url&&ef(f.url,b)}function Bf(a,b){return"function(){return "+("feature."+a+(b||""))+";}"}
function Cf(a){return Bf("style."+a,void 0)}function Df(a,b,c,d){a={base:a,blend:b,blend_order:c};d&&(a.clean_depth=!!d);return a}function Ef(a){var b={};b["translucent-"+(a?"extruded-":"")+"polygons"]={color:Cf("fillColor"),order:1,interactive:!0,extrude:a};return b}function Ff(a,b,c,d){a={data:{source:a,layer:b}};c&&(a.draw=c);d&&(a.filter=d);return a}function nf(a){return ya(a)&&!fb(a)};function Gf(){var a=Gf.pv;a||(a=this,Gf.pv=a,mb(Gf.pv),G.call(a),this.zg());return a}u(Gf,G);m=Gf.prototype;m.disposeInternal=function(){Gf.g.disposeInternal.call(this);this.zg()};m.zg=function(){this.EB=10;this.FB=6;this.ki=Ua();this.Cr=Ua();this.Hr=0};m.Go=function(a){a=a.type;var b=this.ki[a]||0;if(this.Hr<this.EB&&b<this.FB){var c=++this.tB;this.Hr++;this.ki[a]=b+1;this.Cr[c+""]=a;return c}return x};
m.am=function(a){var b=this.Cr[a];if(!ab(b)||!this.ki[b])throw new vb(this.am,"Unknown requestId");this.Hr--;this.ki[b]--;this.ki[b]||delete this.ki[b];delete this.Cr[a];this.dispatchEvent("allocatable")};m.tB=-1;function Hf(a,b){b=b||{};"status"in b&&(this.status=+b.status);"statusText"in b&&(this.statusText=b.statusText);this.ok=200<=this.status&&300>this.status;this.Su=!1;a?"string"===typeof a?this.Mo=a:(b=globalThis.ArrayBuffer)&&b.prototype.isPrototypeOf(a)?this.Bf=a:b&&a.buffer?this.Bf=a.buffer:globalThis.Blob.prototype.isPrototypeOf(a)&&(this.Gl=a):this.Mo=""}t("H.net.Response",Hf);Hf.prototype.type="default";Hf.prototype.type=Hf.prototype.type;Hf.prototype.status=200;Hf.prototype.status=Hf.prototype.status;
Hf.prototype.statusText="OK";Hf.prototype.statusText=Hf.prototype.statusText;function If(a){if(a.Su)return Fd(new TypeError("Already read"));a.Su=!0}Hf.error=function(){Hf.op||(Hf.op=new Hf(null,{status:0,statusText:""}),Hf.op.type="error");return Hf.op};Hf.error=Hf.error;
Hf.prototype.text=function(){var a=If(this);if(!a)if(this.Mo)a=Ed(this.Mo);else if(this.Bf){a=new Uint8Array(this.Bf);var b=a.length,c=Array(b),d;for(d=0;d<b;d++)c[d]=String.fromCharCode(a[d]);a=Ed(c.join(""))}else a=this.Gl?Jf(this.Gl):Fd("Unsupported response body");return a};Hf.prototype.json=function(){return this.text().then(globalThis.JSON.parse)};
Hf.prototype.blob=function(){var a,b=If(this);b||(this.Gl?a=this.Gl:this.Bf&&(a=new Blob([this.Bf],{type:"application/octet-stream"})));return b||Ed(a)};Hf.prototype.arrayBuffer=function(){return this.Bf?If(this)||Ed(this.Bf.slice(0)):this.blob().then(Hf.xy)};Hf.xy=function(a){var b=new FileReader;b.readAsArrayBuffer(a);return new wd(function(c,d){b.onload=function(){c(b.result)};b.onerror=function(){d(b.error)}})};
function Jf(a){var b=new FileReader;b.readAsText(a);return new wd(function(c,d){b.onload=function(){c(b.result)};b.onerror=function(){d(b.error)}})}!tb&&globalThis.Response&&globalThis.Response.error&&(Hf=globalThis.Response,mb(Hf.prototype));function Kf(a,b,c){function d(){var n=z(l.Wh,l),p=+k.timeout||0;Lf?(Mf(l,"timeout",n),e.timeout=p):p&&(l.Rx=setTimeout(function(){e.abort();l.Wh({type:"timeout"})},p));Mf(l,"error",n);Mf(l,"load",n);e.send(k.data)}var e,f,g,h=c&&c.headers||{},k={},l=this;if(!Za(b))throw new C(Kf,1,"function required");a+="";Qa(h,Nf.headers,h);Qa(k,Nf,c||{});k.headers=h;this.it=b;this.I=e=new XMLHttpRequest;b=k.method;try{e.open(b,a,!0);for(f in h)h.hasOwnProperty(f)&&(g=h[f])&&e.setRequestHeader(f,g);e.withCredentials=
!!k.withCredentials;d()}catch(n){this.Wh({type:"cors"})}}t("H.net.Xhr",Kf);var Nf={method:"GET",headers:{},data:null},Of="withCredentials"in new XMLHttpRequest,Lf="timeout"in new XMLHttpRequest;function Mf(a,b,c){Of?a.I.addEventListener(b,c):a.I["on"+b]=c}function Pf(a,b,c){Of?a.I.removeEventListener(b,c):a.I["on"+b]=null}Kf.prototype.abort=function(){this.I&&(this.I.abort(),this.I&&this.Wh({type:"abort"}))};Kf.prototype.abort=Kf.prototype.abort;
Kf.prototype.Wh=function(a){var b=a.type;a=this.I;var c;this.Rx&&clearTimeout(this.Rx);"load"===b?a instanceof XMLHttpRequest&&200!==a.status&&(c="network"):c=4===a.readyState&&0===a.status&&"error"==b?"cors":"error"!=b?b:"network";b=this.Wh;Pf(this,"timeout",b);Pf(this,"error",b);Pf(this,"load",b);a=0===a.status||c&&"network"!==c?Hf.error():new Hf(a.responseText||null,a);c=this.it;delete this.Wh;delete this.it;delete this.I;c(a)};function Qf(a,b,c,d){if(!Rf[a])throw new C(Qf,0,"Mime type is not supported");this.LB=a;a=d?Na(d):{};"crossOrigin"in a||(a.crossOrigin="anonymous");this.Fa=a;Sf.href=b.toString();Ud.call(this,Sf.protocol+"//"+Sf.hostname,b,c)}u(Qf,Ud);Qf.prototype.Pt=function(){this.br=Rf[this.LB].call(this);return!0};Qf.prototype.Xi=function(){this.br&&(this.br.abort(),delete this.br)};
var Rf={"application/json":function(){var a=this,b=Tf(this.Fa),c=b.headers;b.headers=c=c?Na(c):{};c.Accept="application/json";return new Kf(this.data,function(d){200<=d.status&&300>d.status?a.resolve(d.json()):a.reject(d)},b)},"text/plain":function(){var a=this;return new Kf(this.data,function(b){200<=b.status&&300>b.status?a.resolve(b.text()):a.reject(b)},Tf(this.Fa))},image:function(){var a=globalThis.document.createElement("img"),b=this,c=this.data;a.onload=z(this.resolve,this,a);a.onerror=function(){b.reject(Hf.error())};
a.crossOrigin=this.Fa.crossOrigin;a.src=c;return{abort:function(){a.onerror=a.onload=null;ge&&ue(a)||a.removeAttribute("src")}}}};
(function(){try{var a=new XMLHttpRequest;a.open("get","/",!0)}catch(b){a={}}"response"in a&&(Rf.arraybuffer=function(){var b=new XMLHttpRequest,c=this,d=this.Fa,e=d.headers,f;b.open("GET",this.data);Uf(b,d);b.responseType="arraybuffer";if(e)for(f in e)b.setRequestHeader(f,e[f]);b.onerror=b.ontimeout=function(){c.reject(Hf.error())};b.onload=function(){c.resolve(new Hf(b.response))};b.send();return b})})();var Vf=new Xd(new Gf);Qf.prototype.Gp=function(){return Vf};var Sf=globalThis.document.createElement("a");
function Tf(a){var b=Na(a);delete b.crossOrigin;Uf(b,a);return b}function Uf(a,b){a.withCredentials="use-credentials"===b.crossOrigin};function Wf(a,b){Wf.g.constructor.call(this,a,b);if(gb(a))Xf.test(a)&&-1===a.indexOf("import:")?(this.xc=a,b||(this.fB=ff(this.xc)?A:this.xc)):this.ro=a;else if(ya(a))this.Dg(Ya(a));else throw new C(Wf,0,"invalid style configuration");}u(Wf,gf);t("H.map.render.webgl.Style",Wf);
Wf.prototype.load=function(){var a=this,b=this.Kc();this.xc?(this.F(hf.LOADING),(new Qf("text/plain",this.xc)).then(function(c){var d={};return Yf(c,b,!1,(d[b]=!0,d))}).then(function(c){return a.Dg(c)},function(c){return a.Hc(c.message)}),delete this.xc):this.ro&&(this.F(hf.LOADING),Yf(this.ro,b).then(function(c){return a.Dg(c)},function(c){return a.Hc(c.message)}),delete this.ro)};Wf.prototype.load=Wf.prototype.load;
Wf.prototype.$w=function(a,b,c){var d;Zf(this);a=$f(this,a,this.$w,c);for(c=0;c<a.length;c++){var e=a[c].xb.draw;for(d in e){var f=e[d];nf(f)&&(f.interactive=!!b)}}ag(this)};Wf.prototype.setInteractive=Wf.prototype.$w;
Wf.prototype.setProperty=function(a,b,c){var d,e=a.split("."),f=0,g=e.length;Zf(this);if(!ab(b))throw new C(this.setProperty,1,"value");if(d=bg(this.Ia,e)){if(!(d.parent instanceof Object)||d.parent instanceof Array)if(c)e.pop(),e=bg(this.Ia,e),d.parent=e.parent[e.Gn]={};else throw new C(this.setProperty,0,a+" property is not primitive type");d.parent[d.Gn]=b}else{for(d=this.Ia;f!==g-1;)d[e[f]]={},d=d[e[f++]];d[e[f]]=b}cg(this)&&ag(this)};Wf.prototype.setProperty=Wf.prototype.setProperty;
Wf.prototype.Pp=function(a){Zf(this);return(a=bg(this.Ia,a.split(".")))?Ya(a.node):void 0};Wf.prototype.getProperty=Wf.prototype.Pp;Wf.prototype.removeProperty=function(a){Zf(this);(a=bg(this.Ia,a.split(".")))&&a.parent&&a.parent.hasOwnProperty(a.Gn)&&(delete a.parent[a.Gn],cg(this)&&ag(this))};Wf.prototype.removeProperty=Wf.prototype.removeProperty;
Wf.prototype.wj=function(a,b,c){var d;Zf(this);var e=this.Ia;var f=e.layers;var g=$f(this,a,this.wj,!1);a=g.length;for(d={};a--;)vf(d,f,g[a].id,!!b,!!c);c={};g=Object.keys(e);for(a=g.length;a--;){var h=g[a];var k=e[h];c[h]=k===f?d:Ya(k)}b||ag(this);return c};Wf.prototype.extractConfig=Wf.prototype.wj;Wf.prototype.gk=function(a){Zf(this);if(!ya(a))throw new C(this.gk,0,"config");this.Dg(mf(this.Ia,a))};Wf.prototype.mergeConfig=Wf.prototype.gk;Wf.prototype.Xb=ca(0);
Wf.prototype.toString=function(){return this.getState()===hf.READY?globalThis.H.gl.yaml.dump(this.Ia,{lineWidth:120}):""};Wf.prototype.disposeInternal=function(){Wf.g.disposeInternal.call(this);delete this.ro;delete this.xc};function cg(a){var b=a.Ia,c;if(ya(b)){var d;if(d=a.rs){b=b&&b.sources;d=!1;for(var e in b)if(b[e].type===a.rs){d=!0;break}d=!(b?d:1)}d&&(c="invalid source, the only valid type is "+a.rs)}else c="invalid style configuration";c&&a.Hc(c);return!c}
function ag(a){a.dispatchEvent(new Jb("change",a))}function Zf(a){if(a.getState()!==hf.READY)throw new vb(a.gk,"style is not ready yet");}
function $f(a,b,c,d){var e=[],f=fb(b)?b:[b],g,h;void 0===d&&(d=!0);for(f=f.sort().reverse();g=f.pop();){b=String(g).split(".");a:{var k=a.Ia;for(var l=b.length;l--&&!sf[b[l]];);if(k&&0>l&&(k=qf(k.layers,b),nf(k)))break a;k=of}if(k===of)throw new C(c,0,'Unresolvable layer ID "'+g+'"');e.push({id:b,xb:k});if(d)for(h in k)!sf[h]&&nf(k[h])&&f.push(g+"."+h)}return e}function bg(a,b){var c=0,d;for(d=b.length;c!==d;){var e=b[c++];var f=a;a=f[e];if(!a)break}return c===d?{node:a,parent:f,Gn:e}:void 0}
var Xf=/^(http[s]?)?.*\.ya?ml/i;
function Yf(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?{}:d;try{var e=globalThis.H.gl.yaml.load(a,{json:!0})}catch(f){return Promise.reject(f)}return e&&(a=e["import"],gb(a)&&(a=[a]),c&&b&&dg(e,b),delete e["import"],fb(a)&&a.length)?(c=a.reduce(function(f,g){var h=b?ef(g,b):g;d[h]||(d[h]=!0,f.push((new Qf("text/plain",h)).then(function(k){return Yf(k,h,!0,d)})));return f},[]),Promise.all(c).then(function(f){var g={};f.forEach(function(h){return h&&mf(g,h)});mf(g,e);return g})):Promise.resolve(e)}
function dg(a,b){function c(g){g.url&&(g.url=ef(g.url,b))}var d=a&&a.fonts;if(d)for(var e in d)fb(d[e])?d[e].forEach(c):c(d[e]);if(a=a&&a.textures)for(var f in a)c(a[f])}Wf.normalize=dg;Wf.prototype.Dg=function(a){Wf.g.Dg.call(this,a);cg(this)&&(this.F(hf.READY),ag(this))};Wf.prototype.Qd=function(){return Wf.g.Qd.call(this)};Wf.prototype.getConfig=Wf.prototype.Qd;Wf.prototype.Kc=function(){return this.fB||Wf.g.Kc.call(this)};Wf.prototype.getBaseUrl=Wf.prototype.Kc;function eg(a,b,c){this.Da=a;this.uid=b;this.opacity=c;this.an=this.Da&lf.PROVIDES_BY_VIEWPORT?"function(){return sources[$source].isInMinMaxRange(feature, $zoom) && feature.ref.effectiveVisibility;}":A;this.ag={}}
eg.prototype.Je=function(){this.Da&lf.PROVIDES_RASTERS&&(this.ag["tile_layer_"+this.uid]=Ff(this.uid,"_default",{"translucent-raster":{color:[1,1,1,this.opacity],order:0}}));if(this.Da&lf.PROVIDES_SPATIALS){var a={"translucent-pattern-lines":{color:Cf("strokeColor"),width:Cf("lineWidth * $meters_per_pixel"),join:Cf("lineJoin"),cap:Cf("lineCap"),tail_cap:Cf("lineTailCap"),head_cap:Cf("lineHeadCap"),miter_limit:Cf("miterLimit"),order:"function() { return 2 + feature.effectiveZIdx / 2; }",interactive:!0,
dash:Cf("lineDash"),extrude:!0,dash_phase:Cf("lineDashOffset")}};var b=this.ag,c="polygon_layer_"+this.uid;var d=Ff(this.uid,"polygons",void 0,this.an);d.flat={filter:"function(){return !feature.height && !feature.min_height;}",draw:Ef(!1)};d.extruded={filter:"function(){return feature.height || feature.min_height;}",draw:Ef(!0)};b[c]=d;this.ag["outline_layer_"+this.uid]=Ff(this.uid,"outlines",a,this.an);this.ag["polyline_layer_"+this.uid]=Ff(this.uid,"polylines",a,this.an)}this.Da&lf.PROVIDES_OVERLAYS&&
(this.ag["overlay_layer_"+this.uid]=Ff(this.uid,"overlays",{"translucent-overlays":{color:[1,1,1,this.opacity],order:8190,interactive:!0}}));this.Da&lf.PROVIDES_MARKERS&&(this.ag["marker_layer_"+this.uid]=Ff(this.uid,"markers",{markers:{sprite:Bf("icon.id"),offset:Bf("icon.offset"),collide:!1,priority:8191,elevate_by_altitude:!0,interactive:!0,stick:{color:Bf("icon.stick_color"),height:Bf("icon.stick_height")}}},this.an));return this.ag};function fg(a){this.Da=a}
fg.prototype.Je=function(){var a={};this.Da&lf.PROVIDES_RASTERS&&(a={"translucent-raster":Df("raster","inlay",1)});if(this.Da&lf.PROVIDES_WEBGL_RENDERABLE_OBJECTS){var b=!!(this.Da&lf.CROP_LINES_BY_TILE),c={"translucent-polygons":Df("polygons","inlay",2),"translucent-extruded-polygons":Df("polygons","translucent",3),"translucent-pattern-lines":Df("pattern-lines","translucent",4),"translucent-overlays":Df("overlays","inlay",5),markers:Df("custom_icons","overlay",6,!1)};c["translucent-polygons"].crop_by_tile=!!(this.Da&
lf.CROP_POLYGONS_BY_TILE);c["translucent-pattern-lines"].crop_by_tile=b;c.markers.suppress_fade=!0;c.markers.stick=!0;Qa(a,c)}return a};function gg(a,b,c,d,e){this.Da=a;this.uid=b;this.Bv=c;this.Kq=d;this.tileSize=e}gg.prototype.Je=function(){var a={};a[this.uid]=this.Da&lf.PROVIDES_BY_VIEWPORT?hg(this,"ObjectSource",!1,{progressiveUpdate:!0,has_volatile_data:!!(this.Da&lf.HAS_VOLATILE_DATA)}):this.Da&lf.PROVIDES_RASTERS?hg(this,"RemoteRasterTileSource",!0,{url:""}):hg(this,"ObjectTileSource",!0,{tile_size:this.tileSize});return a};function hg(a,b,c,d){a={type:b,uid:a.uid,tiled:c,max_zoom:a.Kq};d&&Qa(a,d);return a};function ig(a,b,c,d,e,f){this.Da=a;this.uid=b;this.Bv=c;this.Kq=d;this.opacity=e;this.tileSize=f}ig.prototype.Je=function(){if(this.Da&lf.PROVIDES_DOM_MARKERS&&!(this.Da&lf.PROVIDES_MARKERS))return{};var a=new gg(this.Da,this.uid,this.Bv,this.Kq,this.tileSize);var b=new fg(this.Da);var c=new eg(this.Da,this.uid,this.opacity);a=a.Je();b=b.Je();c=c.Je();return{sources:a,styles:b,layers:c}};var jg={FEATURE:1,SOURCE:2,PROVIDER:3};t("H.map.provider.PickingMode",jg);function kg(a,b,c){kg.g.constructor.call(this,a);this.oldValue=c;this.newValue=b}u(kg,Jb);t("H.util.ChangeEvent",kg);function M(a){var b=""+le(),c;M.g.constructor.call(this);a=a||{};this.min=a.min||0;this.max=a.max||22;if(c=a.uri){if(/_/.test(c))throw new C(M,0,"uri "+c);}else c=b;this.uri=c||b;this.uid=b;a.getCopyrights&&db(a.getCopyrights,"Function",M)&&(this.getCopyrights=a.getCopyrights);this.Db=this.Db.bind(this);this.kq=!0;this.ub=a.engineType||lg;if(this.ub===mg.HARP&&!H.map.render.harp)throw new C(M,0,"HARP engine is not supported, module not found");}u(M,G);t("H.map.provider.Provider",M);m=M.prototype;
m.j={Li:"configchange",Ca:"update"};m.hb=function(a,b){this.dispatchEvent(new uc(this.j.Ca,b,a))};m.Db=function(a){a=new kg(this.j.Li,a&&a.newValue,a&&a.oldValue);this.dispatchEvent(a)};m.disposeInternal=function(){G.prototype.disposeInternal.call(this);this.Xa&&(this.Xa.removeEventListener("change",this.Db),this.Xa.l(),delete this.Xa)};m.U=function(){return null};M.prototype.getCopyrights=M.prototype.U;
M.prototype.getCapabilities=function(){var a=0;this.qr()&&(a|=lf.PROVIDES_BY_VIEWPORT);this.providesRasters()&&(a|=lf.PROVIDES_RASTERS);this.providesSpatials()&&(a|=lf.PROVIDES_SPATIALS);this.providesOverlays()&&(a|=lf.PROVIDES_OVERLAYS);this.providesMarkers()&&(a|=lf.PROVIDES_MARKERS);this.providesDomMarkers()&&(a|=lf.PROVIDES_DOM_MARKERS);this.providesGeoJSON()&&(a|=lf.PROVIDES_GEOJSON);this.providesOMV()&&(a|=lf.PROVIDES_OMV);return a};M.prototype.getCapabilities=M.prototype.getCapabilities;
M.prototype.qr=ne;M.prototype.Ak=ne;M.prototype.providesRasters=M.prototype.Ak;M.prototype.me=ne;M.prototype.providesSpatials=M.prototype.me;M.prototype.sr=ne;M.prototype.providesOverlays=M.prototype.sr;M.prototype.Vc=ne;M.prototype.providesMarkers=M.prototype.Vc;M.prototype.Uc=ne;M.prototype.providesDomMarkers=M.prototype.Uc;M.prototype.rr=ne;M.prototype.providesGeoJSON=M.prototype.rr;M.prototype.Wc=ne;M.prototype.providesOMV=M.prototype.Wc;M.prototype.Qz=function(){return this.ub};
M.prototype.getEngineType=M.prototype.Qz;M.prototype.dD=function(a){this.ub=a};M.prototype.setEngineType=M.prototype.dD;M.prototype.yk=oe;M.prototype.preprocessData=M.prototype.yk;M.prototype.Rc=1;M.prototype.Eg=function(a){a=cd(a,0,1);E(a)&&(a=1);this.Rc!==a&&(this.Rc=a,this.kq&&ng(this),this.Db(),this.hb())};M.prototype.qA=function(){return this.Rc};M.prototype.getOpacityInternal=M.prototype.qA;
M.prototype.Wa=function(a,b){var c=this;if(this.ub===mg.WEBGL&&!B(a,Wf)||this.ub===mg.HARP&&!B(a,H.map.render.harp.Style))throw a=Object.entries(mg).find(function(d){return d[1]===c.ub}),new C(this.Wa,0,"Invalid style for engineType "+a);this.Xa&&(this.Xa.removeEventListener("change",this.Db),this.Xa.removeEventListener(jf,this.Db),this.Xa.l());this.Xa=a;this.Xa.addEventListener("change",this.Db);this.Xa.addEventListener(jf,this.Db);b||this.Db();this.kq=!1};M.prototype.setStyleInternal=M.prototype.Wa;
M.prototype.kb=function(){this.Xa||ng(this);return this.Xa};M.prototype.getStyleInternal=M.prototype.kb;function ng(a){if(a.ub===mg.WEBGL){var b=new ig(a.getCapabilities(),a.uid,a.min,a.max,a.Rc,a.tileSize);a.Xa=new Wf(b.Je())}else a.ub===mg.HARP&&H.map.render.harp&&(a.Xa=new H.map.render.harp.Style({}));a.kq=!0}
M.prototype.pu=function(){var a=this.getCapabilities(),b=jg.FEATURE;a&lf.PROVIDES_BY_VIEWPORT?b=jg.SOURCE:a&lf.PROVIDES_RASTERS?b=null:a&lf.PROVIDES_WEBGL_RENDERABLE_OBJECTS&&(b=jg.PROVIDER);return b};M.prototype.getPickingMode=M.prototype.pu;M.prototype.Vz=function(){return!1};M.prototype.getFeatureProxy=M.prototype.Vz;function og(){}function pg(a){return yc(1,Ac(0,.5-Fc(Nc(Tc+Sc*a/180))/Rc/2))}og.prototype.Tm=function(a,b,c){c?(c.x=b/360+.5,c.y=pg(a)):c=new L(b/360+.5,pg(a));return c};og.prototype.latLngToPoint=og.prototype.Tm;og.prototype.Re=function(a,b){return this.Tm(a.lat,a.lng,b)};og.prototype.geoToPoint=og.prototype.Re;function qg(a){return 0>=a?90:1<=a?-90:Xc*(2*Oc(Ic(Rc*(1-2*a)))-Sc)}
og.prototype.Ya=function(a,b,c){c?(c.lat=qg(b),c.lng=360*(1===a?1:ad(a,1))-180):c=new Re(qg(b),360*(1===a?1:ad(a,1))-180);return c};og.prototype.xyToGeo=og.prototype.Ya;og.prototype.yn=function(a,b){return this.Ya(a.x,a.y,b)};og.prototype.pointToGeo=og.prototype.yn;var rg=new og;t("H.geo.mercator",rg);function sg(a,b){this.projection=a||rg;this.Ii=0;this.kl=this.exp=Fc(b||256)/Qc;tg(this);this.y=this.x=0}t("H.geo.PixelProjection",sg);var ug=Ec(24)+Ec(-8);sg.prototype.Fn=rg;sg.prototype.projection=sg.prototype.Fn;sg.prototype.x=0;sg.prototype.x=sg.prototype.x;sg.prototype.y=0;sg.prototype.y=sg.prototype.y;sg.prototype.w=Hc(2,ug);sg.prototype.w=sg.prototype.w;sg.prototype.YA=Hc(2,ug);sg.prototype.h=sg.prototype.YA;
sg.prototype.Ua=function(a){if(E(a))throw new C(this.Ua,0,a);var b=this.x/this.w;var c=this.y/this.h;this.Ii=a;this.kl=this.exp+a;tg(this);this.x=b*this.w;this.y=c*this.h};sg.prototype.rescale=sg.prototype.Ua;function tg(a){a.kl>ug&&(a.kl=ug);a.w=Hc(2,a.kl);a.h=Hc(2,a.kl)}sg.prototype.vu=function(){return this.Ii||0};sg.prototype.getZoomScale=sg.prototype.vu;sg.prototype.Fb=function(a,b){a=this.projection.Tm(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};
sg.prototype.geoToPixel=sg.prototype.Fb;sg.prototype.tk=function(a,b){return this.projection.Ya((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};sg.prototype.pixelToGeo=sg.prototype.tk;sg.prototype.Ya=function(a,b,c){return this.projection.Ya((a+this.x)/this.w,(b+this.y)/this.h,c)};sg.prototype.xyToGeo=sg.prototype.Ya;sg.prototype.vq=function(a,b,c){a=this.projection.Tm(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};sg.prototype.latLngToPixel=sg.prototype.vq;
sg.prototype.bi=function(a){return new L(a.x*this.w-this.x,a.y*this.h-this.y)};sg.prototype.pointToPixel=sg.prototype.bi;function vg(a){a=a||{};vg.g.constructor.call(this);this.min=0;this.max=22;this.Ry=this.dark=!!a.dark;a.min&&this.Tr(a.min);a.max&&this.Rr(a.max);this.pixelProjection=new sg(a.projection,a.minWorldSize);a.provider&&(this.D=a.provider,this.hb=z(this.hb,this),this.D.addEventListener(M.prototype.j.Ca,this.hb,!1,this),this.Db=z(this.Db,this),this.D.addEventListener(M.prototype.j.Li,this.Db,!1,this))}u(vg,G);t("H.map.layer.Layer",vg);vg.prototype.min=0;vg.prototype.min=vg.prototype.min;
vg.prototype.max=22;vg.prototype.max=vg.prototype.max;vg.prototype.j={Ca:"update",Li:"configchange",Os:"minchange",Ns:"maxchange"};vg.prototype.Qp=function(){return this.D};vg.prototype.getProvider=vg.prototype.Qp;vg.prototype.mB=function(a){return this.min<=a&&a<=this.max};vg.prototype.isValid=vg.prototype.mB;
function wg(a,b,c){var d=a[b],e="min"===b,f=e?a.Tr:a.Rr;if(c!==d)if(e?c<=a.max:c>=a.min)a[b]=c,a.hb(),a.Db(),a.dispatchEvent(new kg(e?a.j.Os:a.j.Ns,c,d));else throw new C(f,0,"Invalid condition min <= max");return a}vg.prototype.Tr=function(a){return wg(this,"min",+a)};vg.prototype.setMin=vg.prototype.Tr;vg.prototype.Rr=function(a){return wg(this,"max",+a)};vg.prototype.setMax=vg.prototype.Rr;vg.prototype.hb=function(){this.dispatchEvent(this.j.Ca)};
vg.prototype.Db=function(a){a=new kg(this.j.Li,a&&a.newValue,a&&a.oldValue);this.dispatchEvent(a)};vg.prototype.disposeInternal=function(){vg.g.disposeInternal.call(this)};vg.prototype.U=function(){return null};vg.prototype.getCopyrights=vg.prototype.U;function K(a,b,c,d){xg(this,Me(a,K,0),Ne(b,K,1),Me(c,K,2),Ne(d,K,3))}u(K,Qe);t("H.geo.Rect",K);K.prototype.$b="Polygon";K.prototype.xf=function(a){var b=this.fa,c=this.W,d=this.ga,e=this.ca;a.push("(","(",c," ",b,",",e," ",b,",",e," ",d,",",c," ",d,",",c," ",b,")",")");return a};K.prototype.da=function(a){var b=this===a;!b&&B(a,K)&&(b=this.fa===a.fa&&this.W===a.W&&this.ga===a.ga&&this.ca===a.ca);return b};K.prototype.equals=K.prototype.da;
K.prototype.clone=function(){return new K(this.fa,this.W,this.ga,this.ca)};K.prototype.clone=K.prototype.clone;function xg(a,b,c,d,e){a.W=c;a.ca=e;b<d&&(c=b,b=d,d=c);a.fa=b;a.ga=d;a.ml=a.Si=a.Df=null;return a}K.prototype.Nc=function(){this.ml||(this.ml=new Re(this.fa,this.W));return this.ml};K.prototype.getTopLeft=K.prototype.Nc;K.prototype.Lc=function(){this.Si||(this.Si=new Re(this.ga,this.ca));return this.Si};K.prototype.getBottomRight=K.prototype.Lc;K.prototype.OA=function(){return this.fa};
K.prototype.getTop=K.prototype.OA;K.prototype.Cz=function(){return this.ga};K.prototype.getBottom=K.prototype.Cz;K.prototype.iA=function(){return this.W};K.prototype.getLeft=K.prototype.iA;K.prototype.EA=function(){return this.ca};K.prototype.getRight=K.prototype.EA;K.prototype.vb=function(){this.Df||(this.Df=new Re(this.ga+(this.fa-this.ga)/2,yg(this.W,this.nc())));return this.Df};K.prototype.getCenter=K.prototype.vb;K.prototype.nc=function(){return zg(this.W,this.ca)};K.prototype.getWidth=K.prototype.nc;
K.prototype.yh=function(){return this.fa-this.ga};K.prototype.getHeight=K.prototype.yh;K.prototype.pc=function(){return this.W>this.ca};K.prototype.isCDB=K.prototype.pc;K.prototype.Jm=function(){return!this.nc()&&!this.yh()};K.prototype.isEmpty=K.prototype.Jm;K.prototype.C=function(){return new K(this.fa,this.W,this.ga,this.ca)};K.prototype.getBoundingBox=K.prototype.C;
K.prototype.Ql=function(a,b,c){var d=this.vb();c||(a=Me(a,this.Ql,0),b=Ne(b,this.Ql,1));b=this.cf(a,b,c);a=b.vb();return a.lat===d.lat&&a.lng===d.lng&&this.yh()===b.yh()&&this.nc()===b.nc()};K.prototype.containsLatLng=K.prototype.Ql;K.prototype.Ff=function(a,b){b||Se(a,this.Ff,0);return this.Ql(a.lat,a.lng,b)};K.prototype.containsPoint=K.prototype.Ff;
K.prototype.Xo=function(a,b){var c=this.vb();if(!b&&!B(a,K))throw new C(this.Xo,0,a);b=this.xd(a,b);a=b.vb();return a.lat===c.lat&&a.lng===c.lng&&this.yh()===b.yh()&&this.nc()===b.nc()};K.prototype.containsRect=K.prototype.Xo;K.prototype.cf=function(a,b,c,d){if(!c){if(E(a=Me(a)))throw new C(this.cf,0,a);if(E(b=Ne(b)))throw new C(this.cf,1,b);}return Ag(this.fa,this.W,this.ga,this.ca,a,b,a,b,d)};K.prototype.mergeLatLng=K.prototype.cf;
K.prototype.xv=function(a,b,c){b||Se(a,this.xv,0);return this.cf(a.lat,a.lng,b,c)};K.prototype.mergePoint=K.prototype.xv;K.prototype.xd=function(a,b,c){if(!b&&!B(a,K))throw new C(this.xd,0,a);return Ag(this.fa,this.W,this.ga,this.ca,a.fa,a.W,a.ga,a.ca,c)};K.prototype.mergeRect=K.prototype.xd;K.prototype.ce=function(a,b,c,d,e,f){e||(a=Me(a,this.ce,0),b=Ne(b,this.ce,1),c=Me(c,this.ce,2),d=Ne(d,this.ce,3));return Ag(this.fa,this.W,this.ga,this.ca,a,b,c,d,f)};K.prototype.mergeTopLeftBottomRight=K.prototype.ce;
K.prototype.Vf=function(a,b){var c=this.W<=this.ca,d=a.W<=a.ca,e=this.W<a.ca,f=a.W<this.ca;if(!b&&!B(a,K))throw new C(this.Vf,0,a);return this.ga<=a.fa&&a.ga<=this.fa&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};K.prototype.intersects=K.prototype.Vf;function zg(a,b){a=b-a;return a+(0>a?360:0)}function yg(a,b){a+=b/2;return a-(180<a?360:0)}
function Ag(a,b,c,d,e,f,g,h,k){c=yc(c,g);a=Ac(a,e);e=zg(b,d);var l=yg(b,e);g=zg(f,h);var n=yg(f,g)-l;n+=0>n-1E-6?360:0;if(180>n-1E-6){l=b;var p=h}else n=360-n,l=f,p=d;n=n+e/2+g/2;360<=n+5E-7?(l=-180,p=180):n-5E-7<e?(l=b,p=d):n-5E-7<g&&(l=f,p=h);return k?xg(k,a,l,c,p):new K(a,l,c,p)}K.merge=Ag;function Bg(a,b,c){c||(Se(a,Bg,0),Se(b,Bg,1));return new K(a.lat,a.lng,b.lat,b.lng)}K.fromPoints=Bg;
function Cg(a,b){var c=1,d=a.length,e=null;if(!Ca(a))throw new C(Cg,0,a);if(0<d){var f=a[0];for(e=Bg(f,f,b);c<d;c++)f=a[c],e.cf(f.lat,f.lng,b,e)}return e}K.coverPoints=Cg;function Dg(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new C(Dg,0,a);if(0<d)for(e=new K(a[0],a[1],a[0],a[1]);c<d;c+=3)e.cf(a[c],a[c+1],b,e);return e}K.coverLatLngAlts=Dg;
function Eg(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new C(Eg,0,a);if(0<d)for(e=new K(a[0].fa,a[0].W,a[0].ga,a[0].ca);c<d;c++)e.xd(a[c],b,e);return e}K.coverRects=Eg;
K.prototype.Nw=function(a,b){var c=this.W,d=this.fa,e=this.ca,f=this.ga,g=this.vb().lng;Se(a,this.Nw,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?xg(b,d,a,f,e):new K(d,a,f,e)};K.prototype.resizeToCenter=K.prototype.Nw;K.prototype.Jc="Polygon";
K.prototype.wf=function(){return[[this.W,this.fa,0],[this.ca,this.fa,0],[this.ca,this.ga,0],[this.W,this.ga,0],[this.W,this.fa,0]]};K.prototype.P=function(){return this.Pd()};K.prototype.Pd=function(){return[this.fa,this.W,this.ga,this.ca]};function Fg(a,b){b=b||{};if(!a)throw new C(Fg,0,a);this.tileSize=a.tileSize;this.yx={};vg.call(this,{min:void 0!==b.min?b.min:a.min,max:void 0!==b.max?b.max:a.max,minWorldSize:this.tileSize,projection:b.Fn,dark:b.dark,provider:a})}u(Fg,vg);t("H.map.layer.BaseTileLayer",Fg);Fg.prototype.Cj=function(a,b){var c=this.pixelProjection;if(!B(a,K))throw new C(this.Cj,0,a);if(!E(b)){var d=c.vu();c.Ua(b)}a=cf(c.Fb(a.Nc()),c.Fb(a.Lc()));!E(d)&&c.Ua(d);return a};Fg.prototype.geoRectToRect=Fg.prototype.Cj;
Fg.prototype.Fh=function(a,b){var c=Hc(2,Cc(b)),d=this.tileSize;if(!B(a,bf))throw new C(this.Fh,0,a);if(E(b=+b))throw new C(this.Fh,1,b);b=Cc(a.left/d);b===c&&--b;var e=Cc(a.right/d);e===c&&--e;return new bf(b,cd(Cc(a.top/d),0,c-1),e,cd(Cc(a.bottom/d),0,c-1))};Fg.prototype.getTileBounds=Fg.prototype.Fh;Fg.prototype.Pa=function(a,b,c,d){return this.D.requestTile(a,b,c,d)};Fg.prototype.requestTile=Fg.prototype.Pa;Fg.prototype.Ld=function(a,b,c){this.D.cancelTile(a,b,c)};Fg.prototype.cancelTile=Fg.prototype.Ld;
Fg.prototype.U=function(a,b){return this.D.getCopyrights?this.D.getCopyrights(a,b):null};Fg.prototype.getCopyrights=Fg.prototype.U;function Gg(a,b,c,d,e){d=Cc(d);var f=Hc(2,d),g=b.left,h=b.top,k=b.right;c=k+(c?f+(k===b.left?0:1):1);var l=b.bottom,n=[];if(e){var p=g+(1+k-g)/2+e.x/a.tileSize-.5;var q=h+(1+l-h)/2+e.y/a.tileSize-.5}for(;g<c;){for(h=b.top;h<=l;)a=g%f,n.push([a,h,d,e?Ec(p-g)+Ec(q-h):0]),h++;g++}return n}
Fg.prototype.Pj=function(a,b,c,d,e,f){var g,h=[],k,l=this.D;f=null!=f?f:"__default__";var n=l.requestTile;if(!B(a,bf))throw new C(this.Pj,0,a);if(E(c=+c))throw new C(this.Pj,1,c);d||(g={});b=Gg(this,a,b,c,e);if(a=b.length)for(d||b.sort(Hg),c=a;c--;)e=b[c],d||(g[l.Td.apply(l,e)]=!0),e[3]=+d,(k=n.apply(l,e))&&h.push(k);if(!d){d=g;var p;g=this.yx[f]||{};for(p in g)g.hasOwnProperty(p)&&g[p]&&!d[p]&&this.D.cancelTileByKey(p);this.yx[f]=d}return{total:a,tiles:h}};Fg.prototype.getProviderTiles=Fg.prototype.Pj;
function Hg(a,b){return b[3]-a[3]};function Ig(a,b){Ig.g.constructor.call(this,a,b)}u(Ig,Fg);t("H.map.layer.MarkerTileLayer",Ig);var Jg={markers:[],total:0,requested:0};function Kg(a,b,c,d,e){var f=Cc(c);a.pixelProjection.Ua(f);b=a.Fh(a.Cj(b),f);c=a.Pj(b,b.left>b.right,~~c,d,e);a=c.tiles;c=c.total;d=a.length;e=[];var g;for(g=0;g<d;g++)for(b=a[g],f=b.data.length;f--;)e.push(b.data[f]);return{markers:e,total:a.length,requested:c}}Ig.prototype.pe=function(a,b,c,d){return this.D.providesDomMarkers()?Jg:Kg(this,a,b,c,d)};
Ig.prototype.requestMarkers=Ig.prototype.pe;Ig.prototype.oe=function(a,b,c,d){return this.D.providesDomMarkers()?Kg(this,a,b,c,d):Jg};Ig.prototype.requestDomMarkers=Ig.prototype.oe;function Lg(a,b,c,d,e,f){var g,h,k=a.length,l,n;if(k)for(g=[];k--;){var p=a[k];var q=p.length;var r=0;for(l=1;l<q;l++)if(n=Mg(p[l-1],p[l],c,b,d,e)){var v=n[0];var w=n[1];r&&r.da(v)?h.push(w):g.push(h=n);r=w;f&&(l=q,k=0)}}else g=a;return g}t("H.math.clipping.clipStrips",Lg);
function Mg(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var l=a;g=h;a=b;h=k;b=l;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;l=f;f=-c;c=-l}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new L(h,-b),new L(g,-a)]:[new L(g,-a),new L(h,-b)]}
function Ng(a,b,c){a=Og(a,!0);b=Og(b,!1);var d,e;var f={};var g=d=1;switch(~~(1*(c||0))){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.lj=new Pg(b.x,b.y,null,Qg(b));a.lj=new Pg(a.x,a.y,null,Qg(a));for(g=b;g.next;g=g.next)if(!g.mb)for(d=a;d.next;d=d.next)if(!d.mb){var k=Rg(g.next);var l=Rg(d.next);if(e=Sg(g,k,d,l,f)){e=f.qy;var n=f.ry;var p=f.OD;var q=f.PD;e=new Pg(p,q,null,null,null,null,!0,0,0,e);Tg(e,g,k);k=new Pg(p,q,null,null,null,null,!0,0,0,n);Tg(k,d,l);e.Mq=
k;k.Mq=e}}f=gd(b,Ug(a));c&&(f=!f);for(g=b;g;g=g.next)g.mb&&(g.mq=f,f=!f);f=gd(a,Ug(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.mb&&(d.mq=f,f=!f);Vg(b);for(Vg(a);(a=Wg(b))!=b;){for(c=null;!a.mo;a=a.Mq){for(f=a.mq;;){c=new Pg(a.x,a.y,c);c.artificial=a.mb||a.Tu;a.mo=1;a=f?a.next:a.Bd;if(!a)break;if(a.mb){a.mo=1;break}}if(!a)break}c.Nq=r||null;var r=c}return r}}t("H.math.clipping.clipPolygon",Ng);
function Pg(a,b,c,d,e,f,g,h,k,l){this.x=a;this.y=b;this.next=c||null;this.Bd=d||null;this.Nq=e||null;this.Mq=f||null;this.mb=!!g;this.mq=!!h;this.mo=k||0;this.alpha=l||0;d&&(d.next=this);c&&(c.Bd=this);this.Tu=!1;this.lj=null}function Rg(a){for(;a&&a.mb;)a=a.next;return a}function Qg(a){if(a)for(;a.next;)a=a.next;return a}function Wg(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.mb||b.mb&&b.mo))}return b}function Vg(a){var b=Qg(a);b.Bd.next=a;a.Bd=b.Bd}
function Sg(a,b,c,d,e,f){var g,h=b.x-a.x,k=b.y-a.y;var l=d.x-c.x;var n=d.y-c.y;var p=h*n-k*l;if(!p)return 0;l=((c.x-a.x)*n-(c.y-a.y)*l)/p;p=(k*(c.x-a.x)-h*(c.y-a.y))/p;if(0>l||1<l||0>p||1<p)return 0;0===l?g=a:1===l?g=b:0===p?g=c:1===p&&(g=d);if(g&&!f)return g.x+=2.480549651603763E-5,g.y+=7.321997314118067E-5,g.lj&&(g.lj.x=g.x,g.lj.y=g.y),Sg(a,b,c,d,e);e.OD=a.x+l*h;e.PD=a.y+l*k;e.qy=l;e.ry=p;return 1}function Ug(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}
function Tg(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.Bd=b.Bd;a.next.Bd=a;a.Bd.next=a}function Og(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=new Pg(a[e].x,a[e].y,d);c.Tu=b;if(c.next=d)d.Bd=c;d=c}return d};function Xg(a,b,c,d,e,f){bb(this,Xg);this.Ph=a||10;this.yj=null;this.Zi=d||0;this.$i=e||0;this.Ck=b||1;this.Dk=c||1;this.Qx=!!f;this.flush()}function Yg(a){var b=a.yj;if(a.Qx&&!b){var c=a.head;if(c.entries||c[0]||c[1]||c[2]||c[3])b=[c],b=Zg([b,b,b,b],[c[6],c[7],c[4],c[5]]),a.yj=b}return b}
function Zg(a,b){var c,d,e,f,g=0;for(c=3;0<=c;c--){var h=c+4;var k=0<c%3;var l=[];var n=b[c];var p=a[c];for(d=p.length;d--;){var q=p[d];if(e=q.entries)for(f=e.length;f--;){var r=e[f].Nf(c);if(k?r>n:r<n)n=r}for(f=4;f--;)(e=q[f])&&(k?e[h]>n:e[h]<n)&&l.push(e)}g+=l.length;b[c]=n;a[c]=l}g&&(b=Zg(a,b));return b}function $g(a,b,c){var d,e;if(a.Qx&&(d=a.yj))for(e=3;0<=e;e--){var f=b.Nf(e);if(e%3?f>=d[e]:f<=d[e])if(c)d[e]=f;else{a.yj=null;break}}}m=Xg.prototype;
m.remove=function(a){var b,c,d,e=!1;a&&(b=a.node)&&b.ol===this&&(c=b.entries)&&0<=(d=c.indexOf(a))&&(c.splice(d,1),this.Ml(b),$g(this,a,!1),e=!0);return e};m.flush=function(){var a=new ah(A,NaN,this.Zi-this.Ck,this.$i-this.Dk,this.Zi+this.Ck,this.$i+this.Dk);a.ol=this;this.head=this.root=a;this.yj=null};m.jd=function(a){var b=this.head,c;if(a){var d=a;if(d!==b)for(b=d;d=d.parent;)if(d.entries||1<d.fb)b=d}else for(;!b.entries&&2>(c=b.fb);)if(c)b=d;else break;this.head=b};
m.mb=function(a,b,c,d,e,f){var g=[],h=this.head,k=this.root;a<=h[5]&&b<=h[6]&&(e?c>=h[7]:c>h[7])&&(f?d>=h[4]:d>h[4])&&bh(this,h,g,a,b,c,d,f||d>=k[6],e||c>=k[5]);return g};
function bh(a,b,c,d,e,f,g,h,k){var l=b.entries,n=b[7],p=b[4],q=b[5],r=b[6],v=b[8],w=b[9],y;if(l){var D=l.length;if(e>p||d>n||g<r||f<q)for(;D--;){n=l[D];p=n.Nf(3);q=n.Nf(0);r=n.Nf(1);var F=n.Nf(2);F>=e&&r>=d&&(q<g||h&&q==g)&&(p<f||k&&p==f)&&c.push(n)}else for(;D--;)c.push(l[D])}if(f>v||k&&f==v)e<w&&(y=b[1])&&bh(a,y,c,d,e,f,g,h,k),(g>w||h&&g==w)&&(y=b[3])&&bh(a,y,c,d,e,f,g,h,k);d<v&&(e<w&&(y=b[0])&&bh(a,y,c,d,e,f,g,h,k),(g>w||h&&g==w)&&(y=b[2])&&bh(a,y,c,d,e,f,g,h,k))}m.ze=ca(2);var ch=0;
function ah(a,b,c,d,e,f){this.Eo=b;a&&(this.parent=a,this.ol=a.ol,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}m=ah.prototype;m.fb=0;m.th=function(a){return this[a]||(++this.fb,this[a]=new ah(this,a))};m.removeChild=function(a){var b=a.Eo;this[b]===a&&(delete this[b],delete a.parent,--this.fb)};m.ze=ca(1);m.Qg=function(a){(this.entries||(this.entries=[])).push(a);a.node=this};
function dh(a,b,c,d,e){var f=a[5],g=a[6];return a[7]<=b&&a[4]<=c&&(f>d||f===d&&f===a.ol.root[5])&&(g>e||g===e&&g===a.ol.root[6])};function eh(a,b,c,d,e,f){eh.g.constructor.apply(this,arguments)}u(eh,Xg);eh.prototype.Ml=function(a){for(var b,c,d=this.head;a;){if(!(b=a.entries)||!b.length)if(b&&delete a.entries,!a.fb&&(c=a.parent)){c.removeChild(a);d===a&&(d=c);a=c;continue}break}this.head!==d&&(this.head=d,this.jd())};function fh(a,b,c,d,e){if(dh(a.root,b,c,d,e))return a.Ub(a.root,b,c,d,e,a.Ph);throw Error("Coordinates out of bounds");}
eh.prototype.Mu=function(a,b,c,d){if(a>c){var e=a;a=c;c=e}b>d&&(e=b,b=d,d=e);return fh(this,a,b,c,d)};eh.prototype.Yd=function(a,b){return fh(this,a,b,a,b)};eh.prototype.Ub=function(a,b,c,d,e,f){var g=a[8],h=a[9],k=0,l=0;f&&(d<g||(k=+(b>=g)))&&(e<h||(l=+(c>=h)))?b=this.Ub(a.th(k|l<<1),b,c,d,e,f-1):(a.Qg(b=new gh(b,c,d,e)),$g(this,b,!0),this.jd(a));return b};function gh(a,b,c,d){this.id=ch++;this[0]=b;this[1]=c;this[2]=d;this[3]=a}gh.prototype.Nf=function(a){return this[a]};function hh(a){this.Ae=new eh(+a||10,180,90,0,0,!0);this.Ll=[];this.jq=!1;this.Cf=this.Mg=this.J=null}t("H.geo.QuadTree",hh);m=hh.prototype;m.ic=0;m.pc=function(){return this.jq};
m.C=function(){var a,b;if(!this.J){var c=[];!this.Mg&&(a=Yg(this.Ae))&&(this.Mg=new K(-a[0],a[3],-a[2],a[1]));(b=this.Mg)&&c.push(b);var d,e,f;if(!this.Cf&&(f=(e=this.Ll).length)){a=90;var g=360;var h=-90;for(d=0;f--;){var k=e[f];a=yc(a,k[0]);g=yc(g,k[3]);h=Ac(h,k[2]);d=Ac(d,k[1])}this.Cf=new K(-a,g,-h,d-360)}(b=this.Cf)&&c.push(b);if(b=c[0])c[1]&&(b=b.xd(c[1],!0)),this.J=b}return this.J};
m.Ub=function(a,b,c,d,e){e?(e=new gh(d,-a,b+360,-c),this.Ll.push(e),this.jq=!0,this.Cf&&this.Cf.ce(a,b,c,d,!0,this.Cf)):(e=fh(this.Ae,b,-a,d,-c),this.Mg&&this.Mg.ce(a,b,c,d,!0,this.Mg));++this.ic;this.J=null;return e};m.Yd=function(a){var b=a.lng;a=a.lat;return this.Ub(a,b,a,b,!1)};m.Ku=function(a){var b=a.Nc(),c=a.Lc();return(a=a.pc())?this.Ub(b.lat,c.lng,c.lat,b.lng,a):this.Ub(b.lat,b.lng,c.lat,c.lng,a)};hh.prototype.insertBoundingBox=hh.prototype.Ku;
hh.prototype.Mu=function(a,b,c,d){if(b<d)var e=b;else e=d,d=b;a<c?b=c:(b=a,a=c);return this.Ub(b,e,a,d,180<d-e)};hh.prototype.remove=function(a){var b;if(a.node){var c=this.Ae.remove(a);this.Mg=null}else if(a=(b=this.Ll).indexOf(a),c=0<=a)b.splice(a,1),this.jq=0<b.length,this.Cf=null;c&&(--this.ic,this.J=null);return c};hh.prototype.remove=hh.prototype.remove;
function ih(a,b,c,d,e,f,g){a=a.Ll;var h=a.length,k=[],l;if(h){var n=c+360;for(l=e+360;h--;){var p=a[h];jh(p,b,c,d,e,f,g)?k.push(p):jh(p,b,n,d,l,f,g)&&k.push(p)}}return k}function jh(a,b,c,d,e,f,g){var h=a[3],k=a[0],l=a[1];a=a[2];return(f?k<=d:k<d)&&(g?h<=e:h<e)&&a>=b&&l>=c}function kh(a,b){var c,d,e;if(c=b.length){var f=a.length;for(d={};f--;)d[a[f].id]=1;for(;c--;)(e=b[c]).id in d||a.push(e)}}
hh.prototype.Gm=function(a,b,c){var d=this.Ae,e=a.Nc(),f=a.Lc(),g=-e.lat;e=e.lng;var h=-f.lat;f=f.lng;!b&&g===h||!c&&e===f?a=[]:a.pc()?(a=d.mb(-180,g,f,h,c,b),kh(a,d.mb(e,g,180,h,!1,b)),kh(a,ih(this,g,f,h,e+360,b,c))):(a=d.mb(e,g,f,h,c,b),kh(a,ih(this,g,e,h,f,b,c)));return a};hh.prototype.intersectBoundingBox=hh.prototype.Gm;var lh=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],mh="undefined"!==typeof BigInt?BigInt:Number;
function nh(a){var b=mh(0),c=mh(0),d=[];a.split("").forEach(function(e){e=mh(lh[e.charCodeAt(0)-45]);b|=(e&mh(31))<<c;(e&mh(32))===mh(0)?(d.push(b),b=mh(0),c=mh(0)):c+=mh(5)});if(0<c)throw Error("Invalid encoding");return d}function oh(a){a&mh(1)&&(a=~a);a>>=mh(1);return+a.toString()}
function ph(a){var b=void 0===a.precision?5:a.precision,c=void 0===a.il?0:a.il,d=void 0===a.jl?0:a.jl;a=a.kr;var e=Math.pow(10,b),f=Math.pow(10,d);if(0>b||15<b)throw Error("precision out of range. Should be between 0 and 15");if(0>d||15<d)throw Error("thirdDimPrecision out of range. Should be between 0 and 15");if(0>c||7<c||4===c||5===c)throw Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");b=qh(1)+qh(d<<7|c<<4|b);var g=[],h=mh(0),k=mh(0),l=mh(0);a.forEach(function(n){var p=mh(Math.round(n[0]*
e));g.push(rh(p-h));h=p;p=mh(Math.round(n[1]*e));g.push(rh(p-k));k=p;c&&(n=mh(Math.round(n[2]*f)),g.push(rh(n-l)),l=n)});return[].concat(b instanceof Array?b:ha(fa(b)),g instanceof Array?g:ha(fa(g))).join("")}function qh(a){var b="";for(a=mh(a);31<a;)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[a&mh(31)|mh(32)],a>>=mh(5);return b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[a]}function rh(a){a=mh(a);var b=0>a;a<<=mh(1);b&&(a=~a);return qh(a)}
function sh(a){return ph({kr:a.polyline,precision:a.precision,il:a.thirdDim,jl:a.thirdDimPrecision})}t("H.util.flexiblePolyline.encode",sh);
function th(a){a=nh(a);if(1!==+a[0].toString())throw Error("Invalid format version");var b=+a[1].toString();b={precision:b&15,il:b>>4&7,jl:b>>7&15};for(var c=Math.pow(10,b.precision),d=Math.pow(10,b.jl),e=b.il,f=0,g=0,h=0,k=[],l=2;l<a.length;){var n=oh(a[l+1])/c;f+=oh(a[l])/c;g+=n;e?(h+=oh(a[l+2])/d,k.push([f,g,h]),l+=3):(k.push([f,g]),l+=2)}if(l!==a.length)throw Error("Invalid encoding. Premature ending reached");a=Object.assign({},b,{kr:k});return{polyline:a.kr,precision:a.precision,thirdDim:a.il,
thirdDimPrecision:a.jl}}t("H.util.flexiblePolyline.decode",th);function N(a){N.g.constructor.call(this);a&&uh(a,N,0);this.S=a||[];this.gd=vh(this,0,this.S.length)}u(N,Qe);t("H.geo.LineString",N);function vh(a,b,c){a=a.S;var d=0;b=Ac(b,0);c=yc(c,a.length);c-=2;for(b+=1;b<c;)d+=Pe(a[b],a[b+=3]);return d}N.prototype.tr=function(a,b,c){wh(this,a,b,c,this.tr)};N.prototype.pushLatLngAlt=N.prototype.tr;function wh(a,b,c,d,e){var f=a.S.length;b=Me(b,e);c=Ne(c,e);a.S.push(Me(b,e),Ne(c,e),d===A?0:Oe(d,e));f&&(a.gd+=Pe(a.S[f-2],c));delete a.J;delete a.ur}
N.prototype.Zk=function(a,b,c){c&&uh(c,this.Zk,2);void 0===b&&(b=this.S.length);b&&(this.gd-=vh(this,a-3,a+b+3));var d=c?this.S.splice.apply(this.S,[a,b].concat(c)):this.S.splice(a,b);c&&(this.gd+=vh(this,a-3,a+c.length+3));b&&!c&&(this.gd+=vh(this,a-3,a-3));delete this.J;delete this.ur;return d};N.prototype.spliceLatLngAlts=N.prototype.Zk;N.prototype.Lu=function(a,b,c,d){this.Zk(a,0,[b,c,d])};N.prototype.insertLatLngAlt=N.prototype.Lu;N.prototype.Ew=function(a){this.Zk(a,3)};
N.prototype.removeLatLngAlt=N.prototype.Ew;N.prototype.sg=function(a){wh(this,a.lat,a.lng,a.alt,this.sg)};N.prototype.pushPoint=N.prototype.sg;N.prototype.Yd=function(a,b){this.Lu(3*a,b.lat,b.lng,b.alt)};N.prototype.insertPoint=N.prototype.Yd;N.prototype.Fk=function(a){this.Ew(3*a)};N.prototype.removePoint=N.prototype.Fk;N.prototype.xj=function(a,b){var c=this.S,d=3*a;a=c[d];var e=c[d+1];c=c[d+2];b&&(b.lat=a,b.lng=e,b.alt=c);return b||new Re(a,e,c)};N.prototype.extractPoint=N.prototype.xj;
N.prototype.dz=function(a,b,c){var d=this.S;b=b||0;c=he(c,d.length/3);for(var e=3*b;b<c;)a(d[e++],d[e++],d[e++],b++)};N.prototype.eachLatLngAlt=N.prototype.dz;N.isDBC=Pe;N.prototype.Dp=function(a){var b=this.gd;a&&(a=this.S,b+=Pe(a[a.length-2],a[1]));return b};N.prototype.getDBCs=N.prototype.Dp;N.prototype.Nj=function(){return this.S.length/3};N.prototype.getPointCount=N.prototype.Nj;N.prototype.fA=function(){return this.S};N.prototype.getLatLngAltArray=N.prototype.fA;N.prototype.J=x;
N.prototype.C=function(){var a;if(!(a=this.J)){a=this.S;var b=a.length,c=3,d,e,f=x;if(3<=b){var g=d=a[0];var h=e=a[1];for(f=new K(g,h,d,e);c<b;c+=3){g=a[c-3];h=a[c-2];d=a[c];e=a[c+1];if(h>e&&180<e-h||h<e&&-180>h-e||e<h&&180>Ec(e-h)){var k=h;h=e;e=k}g<d&&(k=g,g=d,d=k);Ag(f.fa,f.W,f.ga,f.ca,g,h,d,e,f)}}a=this.J=f}return a};N.prototype.getBoundingBox=N.prototype.C;N.prototype.$A=function(){return this.J!==x};N.prototype.hasBoundingBox=N.prototype.$A;
function uh(a,b,c){for(var d=a.length,e=!(d%3),f;e&&d;)e=!(E(a[--d]=Oe((f=a[d])===A?0:f))||E(a[--d]=Ne(a[d]))||E(a[--d]=Me(a[d])));if(!e&&b)throw new C(b,c,a);}function xh(a){var b=new N,c=0,d=a.length;if(d%2)throw new C(xh,0,a);for(;c<d;)wh(b,a[c++],a[c++],0,xh);return b}N.fromLatLngArray=xh;N.prototype.da=function(a){var b=this===a,c;if(!b&&(b=B(a,N))){var d=this.S;a=a.S;for(b=(c=d.length)===a.length;b&&c--;)b=d[c]==a[c]}return b};N.prototype.equals=N.prototype.da;
function yh(a,b){return a.vo-b.vo}
function zh(a,b){var c=a.S,d=-2,e=[],f;var g=a.ur;if(!g){g=a.ur=new hh;var h=0;var k=a.S;var l=k.length;for(f=0;f<l;f+=3){var n=k[f];var p=k[f+1];if(f){var q=g.Mu(q,r,n,p);q.vo=h++}q=n;var r=p}}g=g.Gm(b).sort(yh);k=g.length;for(b=0;b<k;b++){h=g[b];h=h.vo;l=3*h;if(h>d+1){var v=[c[l],c[l+1]];e.push(v)}d=h;v.push(c[l+3],c[l+4])}if(a.gd){c=[];d=e.length;for(b=0;b<d;b++)if(v=e[b],g=v.length){k=[];for(a=0;a<g;a+=2)h=v[a],l=v[a+1],k.push(h,l),f=v[a-1],a&&Pe(l,f)&&(c.push(k),k=[],f+=0>f?360:-360,k.push(v[a-
2],f,h,l));c.push(k)}e=c}return e}m=N.prototype;m.$b="LineString";m.xf=function(a,b){var c=this.S,d=c.length,e;if(d){a.push("(");for(e=0;e<d;e+=3)e&&a.push(","),a.push(c[e+1]," ",c[e]);b&&(c[0]!==c[d-3]||c[1]!==c[d-2])&&a.push(",",c[1]," ",c[0]);a.push(")")}else a.push("EMPTY");return a};m.Jc="LineString";m.wf=function(){var a=[],b=this.S,c=b.length,d;for(d=0;d<c;d+=3)a.push([b[d+1],b[d],b[d+2]]);return a};
m.Pd=function(){var a=this.S,b;if(this.C().pc()){a=a.slice();var c=1;for(b=a.length;c<b;c+=3)0>a[c]&&(a[c]+=360)}return a};m.ED=function(a){a=void 0===a?5:a;for(var b=this.S,c=b.length,d=[],e=0;e<c;e+=3)d.push([b[e],b[e+1],b[e+2]]);return sh({polyline:d,precision:a,thirdDim:2,thirdDimPrecision:a})};N.prototype.toFlexiblePolyline=N.prototype.ED;
function Ah(a){var b=th(a);a=b.polyline;var c=b.thirdDim;b=2===c||3===c;c=0===c;if(!a)throw new C(Ah,0,"data");if(b||c){c=a.length;var d=Array(3*c);for(var e=0,f=0;e<c;e++){var g=a[e];d[f++]=g[0];d[f++]=g[1];d[f++]=b?g[2]:0}}if(!d)throw new C(Ah,0,"only ABSENT, ALTITUDE or ELEVATION are supported as type of the 3rd dimension");return new N(d)}N.fromFlexiblePolyline=Ah;function P(a,b){var c;P.g.constructor.call(this);B(a,N,P,0);if(b!==A&&fb(b,P,1)){for(c=0;c<b.length;c++)B(b[c],N,P,1,"index "+c);this.bb=b}else this.bb=[];this.Eb=a;this.Uj=[]}u(P,Qe);t("H.geo.Polygon",P);function Bh(a){var b=P,c=N,d=a.fa,e=a.W,f=a.ga,g=a.ca;e=[d,e,A,d,g,A,f,g,A,f,e,A];180<=a.nc()&&(e.splice(9,0,f,a=a.vb().lng,A),e.splice(3,0,d,a,A));return new b(new c(e))}P.fromRect=Bh;var Ch={NORTH:90,SOUTH:-90};P.Direction=Ch;P.prototype.jf=Ch.NORTH;
P.prototype.ax=function(a){this.jf!==a&&(this.J=x,this.Uj.length=0,this.jf=a);return this};P.prototype.setPoleCovering=P.prototype.ax;P.prototype.wA=function(){return this.jf};P.prototype.getPoleCovering=P.prototype.wA;P.prototype.Sz=function(){return this.Eb};P.prototype.getExterior=P.prototype.Sz;P.prototype.Yw=function(a){if(!B(a,N))throw new C(this.Yw,0,a);this.Eb=a;this.J=x};P.prototype.setExterior=P.prototype.Yw;P.prototype.cA=function(){return this.bb};P.prototype.getInteriors=P.prototype.cA;
P.prototype.io=function(a,b,c){var d=arguments.length,e;for(e=2;e<d;e++)B(arguments[e],N,this.io,e);var f=this.bb.splice.apply(this.bb,arguments);for(e=2;e<d;e++)arguments[e]=A;this.Uj.splice.apply(this.Uj,arguments);return f};P.prototype.spliceInteriors=P.prototype.io;P.prototype.JC=function(a){return this.io(a,1)[0]};P.prototype.removeInteriorAt=P.prototype.JC;P.prototype.IC=function(a){a=this.bb.indexOf(a);return 0>a?A:this.io(a,1)[0]};P.prototype.removeInterior=P.prototype.IC;
P.prototype.Aw=function(a){if(!B(a,N))throw new C(this.Aw,0,a);this.bb.push(a)};P.prototype.pushInterior=P.prototype.Aw;P.prototype.C=function(){var a=this.J;a||(this.J=a=Dh(this.Eb,this.jf));return a};P.prototype.getBoundingBox=P.prototype.C;m=P.prototype;m.bu=function(a){var b=this.bb.length;if(0>a||a>=b)throw new Zd(this.bu,a,[0,b-1]);(b=this.Uj[a])||(this.Uj[a]=b=Dh(this.bb[a],this.jf));return b};
function Dh(a,b){var c,d,e;if(e=a.C())(c=a.Dp(!0))&&(d=a.Nj())&&(e=e.xd(Cg([a.xj(0),a.xj(d-1)],!0),!0)),360===e.nc()&&1===c%2&&(e=e.cf(b,0));return e}m.$b="Polygon";m.xf=function(a){var b=this.bb,c=b.length,d;if(this.Eb.Nj()){a.push("(");this.Eb.xf(a,!0);for(d=0;d<c;d++)b[d].Nj()&&(a.push(","),b[d].xf(a,!0));a.push(")")}else a.push("EMPTY");return a};m.Jc="Polygon";
m.wf=function(){var a,b=[],c=this.bb,d=this.Eb.wf();d[0].toString()!==d[d.length-1].toString()&&d.push(d[0]);b.push(d);for(a=0;a<c.length;a++)d=c[a].wf(),d[0].toString()!==d[d.length-1].toString()&&d.push(d[0]),b.push(d);return b};m.P=function(){var a=P.g.P.call(this);this.C().pc()&&(a.type="Multi"+a.type);return a};m.Pd=function(){var a=[],b=this.bb,c=b.length;for(a.push(this.Eb.Pd());c--;)a[c+1]=b[c].Pd();return this.C().pc()?[a]:a};
m.da=function(a){var b=!1;if(B(a,P)){var c=a.bb,d=this.bb.length;b=c.length;var e=0;for(b=this.Eb.da(a.Eb)&&d===b;b&&e<d;)b=b&&this.bb[e].da(c[e]),e++}return b};P.prototype.equals=P.prototype.da;function Eh(a,b,c,d){var e=a.bb,f=Fh.bind(null,b,c);return fd(b,c,a.Eb.S,0,!0,3)!==ed.NONE?void 0===d||d?!e.some(f):!0:!1}function Fh(a,b,c){return fd(a,b,c.S,0,!0,3)===ed.SURFACE}
function Gh(a,b){b=b.S;a=a.Eb.S;var c,d,e=b.length-3,f=a.length-3,g={};for(c=0;c<e;c+=3){var h=b[c];var k=b[c+1];var l=b[c+3];var n=b[c+4];for(d=0;d<f;d+=3){var p=a[d];var q=a[d+1];var r=a[d+3];var v=a[d+4];if(Sg(new Pg(k,h),new Pg(n,l),new Pg(q,p),new Pg(v,r),g,!0))return!0}}return!1}
function Hh(a,b){var c=b.Eb,d=b.bb,e=d.length,f=c.S,g=f.length,h=a.Eb.S,k=h.length;if(Gh(a,c))return!0;for(c=0;c<g;c+=3)if(Eh(a,f[c],f[c+1]))return!0;for(c=0;c<k;c+=3)if(Eh(b,h[c],h[c+1]))return!0;for(c=0;c<e;c++)if(Gh(a,d[c]))return!0;return!1};function Ih(a){Ih.g.constructor.call(this,a)}u(Ih,Ve);t("H.geo.MultiPolygon",Ih);Ih.prototype.sq=function(a){return B(a,P)};Ih.prototype.$b="Multi"+P.prototype.$b;Ih.prototype.Jc="Multi"+P.prototype.Jc;function Jh(a,b,c){this.paths=this.Sc=a;b!==A&&(this.interiorsIndex=this.Vj=b);c!==A&&(this.outlinesIndex=this.un=c)}Jh.prototype.Vj=Yc;Jh.prototype.interiorsIndex=Jh.prototype.Vj;Jh.prototype.un=Yc;Jh.prototype.outlinesIndex=Jh.prototype.un;var Kh=Xa(new Jh([])),Lh=Wa([]);function Mh(a){var b;if(a){var c=B(a,Mh);for(b in a)if(b in this){var d=a[b];d!==this[b]&&("fillColor"===b||0<(d=+d))&&(this[b]=d)}a=c?a.Oc:!!(fe(this.fillColor)&&this.width&&this.width);a||(this.Oc=a)}Wa(this)}t("H.map.ArrowStyle",Mh);Mh.prototype.Oc=!0;Mh.prototype.fillColor="rgba(255,255,255,.75)";Mh.prototype.width=1.2;Mh.prototype.length=1.6;Mh.prototype.frequency=5;Mh.prototype.cu=function(){return new Mh(this)};
Mh.prototype.da=function(a){var b=this===a;!b&&a&&(b=a.width===this.width&&a.fillColor===this.fillColor&&a.length===this.length&&a.frequency===this.frequency);return b};Mh.prototype.equals=Mh.prototype.da;function Q(a){var b;if(a){var c=Nh;for(b=B(a,Q);c--;){var d=Oh[c];if(a.hasOwnProperty(d)){var e=a[d];if(b)this[d]=e;else{if((e=Ph[c](e))===Qh)throw new C(Q,0,d+": "+a[d]);e!==this[d]&&e!==A&&(this[d]=e)}}}c=b?a.Yj:this.lineWidth&&fe(this.strokeColor);c||(this.Yj=c);c=b?a.Oc:fe(this.fillColor);c||(this.Oc=c);c=b?a.Wj:"none"!==this.strokeColor&&this.lineWidth;c||(this.Wj=c)}Wa(this)}t("H.map.SpatialStyle",Q);Q.prototype.Oc=!0;Q.prototype.Yj=!0;Q.prototype.Wj=!0;var Oh="strokeColor fillColor lineWidth lineCap lineJoin miterLimit lineDash lineDashOffset lineDashImage lineHeadCap lineTailCap".split(" ");
Q.prototype.strokeColor="rgba(0,85,170,.6)";Q.prototype.strokeColor=Q.prototype.strokeColor;Q.prototype.fillColor="rgba(0,85,170,.4)";Q.prototype.fillColor=Q.prototype.fillColor;Q.prototype.lineWidth=2;Q.prototype.lineWidth=Q.prototype.lineWidth;Q.prototype.lineCap="round";Q.prototype.lineCap=Q.prototype.lineCap;Q.prototype.lineJoin="miter";Q.prototype.lineJoin=Q.prototype.lineJoin;Q.prototype.miterLimit=1;Q.prototype.miterLimit=Q.prototype.miterLimit;Q.prototype.xB=pe;Q.prototype.lineDash=Q.prototype.xB;
Q.prototype.lineDashOffset=0;Q.prototype.lineDashOffset=Q.prototype.lineDashOffset;Q.prototype.yB=A;Q.prototype.lineDashImage=Q.prototype.yB;Q.prototype.zB=A;Q.prototype.lineHeadCap=Q.prototype.zB;Q.prototype.AB=A;Q.prototype.lineTailCap=Q.prototype.AB;var Nh=Oh.length;Q.prototype.da=function(a){var b=this===a;if(!b&&a){for(b=0;b<Nh;b++){var c=Oh[b];if(this[c]!==a[c])break}b=b===Nh}return b};Q.prototype.equals=Q.prototype.da;Q.prototype.du=function(a){if(a){var b={};Qa(b,this,a)}else b=this;return new Q(b)};
Q.prototype.getCopy=Q.prototype.du;
var Qh=Wa({}),Ph=[function(a){return a?Va(a):Qh},function(a){return a?Va(a):Qh},function(a){return 0<=a&&100>=a?+a:Qh},function(a){a=Va(a);return"butt"===a||"square"===a||"round"===a||"arrow-head"===a||"arrow-tail"===a?a:Qh},function(a){return"round"===a||"bevel"===a||"miter"===a?a:Qh},function(a){return 0<a&&100>=a?+a:Qh},function(a){return a&&a.every&&a.every(kb)?a:Qh},function(a){return E(+a)?Qh:+a},function(a){return a===A||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||Object.values(Rh).includes(a)?
a:Qh},function(a){return ab(a)?Ph[3](a):A},function(a){return ab(a)?Ph[3](a):A}],Sh=new Image;Sh.src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g id="arrow"><path style="fill:#ff0000" d="M 0,0 32,64 2,128 128,64 Z"/></g></svg> ');var Th=new Image;Th.src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><circle style="fill:#ffffff" cx="64" cy="64" r="64" /></svg>');
var Rh={ARROW:Sh,CIRCLE:Th};Q.DashImage=Rh;Q.MAX_LINE_WIDTH=100;var Uh=new Q;Q.DEFAULT_STYLE=Uh;var Vh="fillColor strokeColor lineWidth lineCap lineJoin miterLimit lineDashOffset lineDash lineTailCap lineHeadCap".split(" ");Q.prototype.P=function(){for(var a={},b=Vh.length,c;b--;)c=Vh[b],a[c]=this[c];return a};Q.prototype.forWorkerMessage=Q.prototype.P;function Wh(a,b){var c;Wh.g.constructor.call(this,b);b&&this.Bb(b.style);a&&(this.We=!0);b&&(c=b.arrows)&&this.Vw(c)}u(Wh,I);t("H.map.Spatial",Wh);Wh.prototype.type=Ee.SPATIAL;Wh.prototype.to=0;Wh.prototype.style=Uh;Wh.prototype.K=function(){return this.style};Wh.prototype.getStyle=Wh.prototype.K;Wh.prototype.Bb=function(a){var b=!0;a?this.style=B(a,Q)?a:new Q(a):this.style?delete this.style:b=!1;b&&this.invalidate(Ce.VISUAL);return this};Wh.prototype.setStyle=Wh.prototype.Bb;
Wh.prototype.zz=function(){return this.Tg};Wh.prototype.getArrows=Wh.prototype.zz;Wh.prototype.Vw=function(a){var b=this.Tg,c=!1;!a&&b?(delete this.Tg,c=!0):!a||b&&b.da(a)||(this.Tg=new Mh(a),c=!0);c&&"none"!==this.style.strokeColor&&this.qa(1);return this};Wh.prototype.setArrows=Wh.prototype.Vw;function Xh(a,b){var c=!1,d=!1,e;if(b.length){for(c=0;c<b.length;c++)if(b[c]!==Kh){d=!0;break}b=a.style;c=d?b.Yj||b.Oc&&a.We||(e=a.Tg||!1)&&b.Wj&&e.Oc:b.Oc}return c&&a.Vd(!0)}Wh.prototype.We=!1;
Wh.prototype.jB=function(){return this.We};Wh.prototype.isClosed=Wh.prototype.jB;Wh.prototype.getGeometriesForTile=Wh.prototype.xh;Wh.prototype.Ip=function(){return A};Wh.prototype.getLabels=Wh.prototype.Ip;function Yh(a,b){Yh.g.constructor.call(this,a,b)}u(Yh,Wh);t("H.map.GeoShape",Yh);Yh.prototype.getBoundingBox=Yh.prototype.C;function Zh(a,b,c,d){var e=[],f=b.length,g;for(g=0;g<f;g++){var h=b[g];if(h.length){var k=e,l=k.push,n=void 0,p=a,q=c,r=d,v=[],w=h.length,y=0;p.Dt=0;for(n=n||0;y<w;)v.push($h(p,h[y++],h[y++],n,r));q&&v.push($h(p,h[0],h[1],n,r));l.call(k,v)}}return e}function $h(a,b,c,d,e){var f=a.Dt;f&&180<Ec(f-c)&&(c+=0>f?-360:360);a.Dt=c;return e.vq(b,c+d)}
function ai(a,b,c){for(var d=b,e,f=a.length+b,g,h;d--;){b=a[d];g=b.length;for(e=Array(g);g--;)h=b[g],e[g]=new L(h.x+c,h.y);a[--f]=e}};function bi(a,b){var c=b&&(+b.extrusion||+b.extrude)||0,d=b&&+b.elevation||0,e=0;bi.g.constructor.call(this,!0,b);0<d&&(e+=d,this.If=d);0<c&&(e+=c,this.nh=c);if(2047<e)throw new Zd(bi,e,[0,2047]);B(a,N)?this.X(new P(a)):this.X(a)}u(bi,Yh);t("H.map.Polygon",bi);var ci=new P(new N([0,0,0,0,0,0,0,0,0]));bi.prototype.nh=0;bi.prototype.If=0;bi.prototype.Gb=ci;bi.MAX_EXTRUDE_HEIGHT=2047;
bi.prototype.Pr=function(a){var b=+a;if(b!==a)throw new C(this.Pr,0,a);if(0>b||2047<this.If+b)throw new Zd(this.Pr,this.If+b,[0,2047]);this.nh=b;this.qa(Ce.SPATIAL)};bi.prototype.setExtrusion=bi.prototype.Pr;bi.prototype.Tz=function(){return this.nh};bi.prototype.getExtrusion=bi.prototype.Tz;bi.prototype.Or=function(a){var b=+a;if(b!==a)throw new C(this.Or,0,a);if(0>b||2047<this.nh+b)throw new Zd(this.Or,this.nh+b,[0,2047]);this.If=b;this.qa(Ce.SPATIAL)};bi.prototype.setElevation=bi.prototype.Or;
bi.prototype.Oz=function(){return this.If};bi.prototype.getElevation=bi.prototype.Oz;bi.prototype.V=function(){return this.Gb};bi.prototype.getGeometry=bi.prototype.V;bi.prototype.X=function(a){if(B(a,P))var b=!1;else B(a,Ih,this.X,0),b=!0;this.Uf=b;b=this.Gb;this.Gb=a;b!==ci&&this.qa(Ce.SPATIAL);return this};bi.prototype.setGeometry=bi.prototype.X;bi.prototype.C=function(){return this.V().C()};bi.prototype.getBoundingBox=bi.prototype.C;
bi.prototype.xh=function(a){var b,c=this.V(),d,e;if(this.Uf){c=c.ha;var f=0;for(e=c.length;f<e;f++)if(d=di(this,c[f],a,c[f].jf))b||(b=[]),b.push(d)}else d=this.jf,d===A&&(d=this.Uf?Ch.NORTH:this.V().jf),(d=di(this,c,a,d))&&(b=[d]);return b};bi.prototype.getGeometriesForTile=bi.prototype.xh;
function di(a,b,c,d){var e,f,g=0,h=!0;if(e=ei(a,b.Eb,c,d,b.C())){var k=new Jh(e);var l=b.bb;if(f=l.length)for(k.Vj=k.Sc.length;g<f;g++)if(e=ei(a,l[g],c,d,b.bu(g)))k.Sc=k.Sc.concat(e);f=k.Sc.length;for(g=0;g<f;g++)if(k.Sc[g]!==Lh){h=!1;break}h&&(k=g%2?Kh:A)}return k}
function ei(a,b,c,d,e){var f=c.Qj(),g=e,h=g.nc();var k=[[]];var l=b.S;var n=[],p=l.length,q,r=!1;for(q=0;q<p;q+=3){var v=l[q];var w=l[q+1];r||180!=Ec(w)||(n.push(v),n.push(w),n.push(v),n.push(-w),r=!0);n.push(v);n.push(w)}l=n;360>h&&-180==g.W&&(g=new K(g.fa,180,g.ga,g.ca));360>h&&180==g.ca&&(g=new K(g.fa,g.W,g.ga,-180));if(g.pc()){h=l;v=h.length;l=-1;for(n=0;n<v-2;n+=2)if(Pe(h[n+1],h[n+3])){l=n+2;break}-1===l&&Pe(h[v-1],h[1])&&(l=v);-1!==l&&(p=h[l-2],n=h[l-1],q=h[l%v],r=h[(l+1)%v],180!==Ec(p)&&180!==
Ec(q)&&(w=Ec(q-p),v=Ec(r-n),v+=180<v?-360:0,r=Ec(180-r),r+=180<r?-360:0,v&&r&&(w/=Ec(v)/Ec(r),p=q+(q>p?-w:w),n=0<n?180:-180,h.splice(l,0,p,n,p,-n))));l=h}k[0]=fi([].concat(l),g.W);360>g.nc()&&g.Ff(new Re(g.fa,180))&&(l=fi([].concat(l),g.ca),k.push(l));g=c.qm();a=Zh(a,k,!0,g);if(360===e.nc()&&1===b.Dp(!0)%2){b=a;a=c.Qj();b[0][1].x>b[0][b[0].length-1].x&&(b[0]=b[0].reverse());l=[];h=b[0].length-1;for(k=0;k<h;k++)n=b[0][k],l[k]=new L(n.x-2*g.w,n.y),l[k+h]=new L(n.x-g.w,n.y),l[k+2*h]=new L(n.x,n.y),l[k+
3*h]=new L(n.x+g.w,n.y),l[k+4*h]=new L(n.x+2*g.w,n.y);b[0]=l;k=g.vq(d,0);k.y=2*a[d===Ch.NORTH?"top":"bottom"];d=k.clone();k.x=b[0][b[0].length-1].x+1;d.x=b[0][0].x-1;b[0].push(k,d);a=b}d=f.left;b=f.top;k=f.right;f=f.bottom;if(Lg(a,d,b,k,f,!0).length){if(!c.om().Xo(e)){c=a;e=[new L(d,b),new L(k,b),new L(k,f),new L(d,f)];f=[];for(a=c.length;a--;)if(d=Ng(e,c[a]))for(b=gi(d),f.push(b);d.Nq;)d=d.Nq,b=gi(d),f.push(b);a=f}}else c=hi(d,b,a[0]),a[1]&&(c=c!==hi(d,b,a[1])),a=c?[Lh]:A;return a}
function hi(a,b,c){var d,e,f;var g=d=c[0].x;var h=e=c[0].y;var k=1;for(f=c.length;k<f;k++){var l=c[k].x;var n=c[k].y;l>d?d=l:l<g&&(g=l);n>e?e=n:n<h&&(h=n)}return g<=a&&a<=d&&h<=b&&b<=e&&gd({x:a,y:b},hd(c.concat(c[0])))}function gi(a){var b=[],c=a;do{var d=Bc(100*(c.rC?c.rC:c.x))/100;var e=Bc(100*(c.sC?c.sC:c.y))/100;if(!f||.01<Gc(Hc(f.x-d,2)+Hc(f.y-e,2))){var f=new L(d,e);b.push(f)}c=c.next}while(c&&c!==a);return b}bi.prototype.Ti=x;
function fi(a,b){var c,d=Number.POSITIVE_INFINITY,e=-1,f=a.length;for(c=0;c<f;c+=2){var g=Ec(a[c+1]-b);g+=180<g?360-g:g;g<d&&(d=g,e=c)}return 0<c?(b=a.splice(e,a.length-e),b.concat(a)):a}
bi.prototype.P=function(){var a=bi.g.P.call(this),b=this.V(),c=this.Uf?b.ha:[b],d,e=a.properties;var f=a.geometry=b.P();e.style=this.K().P();e.height=this.nh+this.If;e.min_height=this.If;if(this.C().pc()&&(f.type="MultiPolygon",this.Uf)){var g=[];c.forEach(function(h,k){d=f.coordinates[k];h.C().pc()?g=g.concat(d):g.push(d)});f.coordinates=g}return a};bi.prototype.forWorkerMessage=bi.prototype.P;function ii(a,b,c){ii.g.constructor.call(this,ci,c);this.ao(a);this.Yr(b);c&&this.ow in c&&this.Xr(c[this.ow])}u(ii,bi);t("H.map.Circle",ii);ii.prototype.ao=function(a){(a=Te(a)).da(this.Df)||(this.Df=a,ji(this))};ii.prototype.setCenter=ii.prototype.ao;ii.prototype.vb=function(){return this.Df};ii.prototype.getCenter=ii.prototype.vb;ii.prototype.Yr=function(a){if(E(a=cd(a,0,6371000.79*Rc/2)))throw new C(this.Yr,0,a);this.wr!==a&&(this.wr=a,ji(this))};ii.prototype.setRadius=ii.prototype.Yr;
ii.prototype.CA=function(){return this.wr};ii.prototype.getRadius=ii.prototype.CA;ii.prototype.Bn=60;ii.prototype.Xr=function(a){if(!jb(a))throw new C(this.Xr,0,a);this.Bn!==(a=cd(Bc(a),4,360))&&(this.Bn=a,ji(this))};ii.prototype.setPrecision=ii.prototype.Xr;ii.prototype.ow="precision";ii.prototype.zA=function(){return this.Bn};ii.prototype.getPrecision=ii.prototype.zA;ii.prototype.X=function(){return this};ii.prototype.setGeometry=ii.prototype.X;
ii.prototype.V=function(){this.Gb===ci&&ii.g.X.call(this,ki(this));return this.Gb};ii.prototype.getGeometry=ii.prototype.V;function ji(a){a.Gb!==x&&ii.g.X.call(a,ki(a))}function ki(a){var b=a.Df,c=b.lat,d=a.wr,e=0,f=new N;if(90===Ec(c))for(c=b.oo(0,d,!0).lat;360>e;e+=120)f.tr(c,e-180,A);else for(a=a.Bn,a=360/a;360>e;e+=a)f.sg(b.oo(e,d,!0));b=new P(f);0>c&&b.ax(Ch.SOUTH);return b};function li(a){var b=mi[a];if(!b)if(a in ni)b=mi[a]=a;else{b=oi.length;var c="",d=a.substr(0,1).toUpperCase()+a.substr(1),e="",f=!1;pi&&(e=pi+d,f=e in ni);for(;b--&&!f;)c=oi[b],e=c+d,f=e in ni;f&&(pi=c);if(b=f?e:null)mi[a]=b;else throw Error("Could not find any variant of CSS property ["+a+"]");}return b}t("H.dom.cssPrefixer.prefix",li);var oi=["O","Ms","ms","Moz","Webkit"],mi={},pi="",ni=document.createElement("span").style;t("H.util.events.listenOnce",Yb);t("H.util.events.dispatchEvent",function(a,b){return a.dispatchEvent(b)});t("H.util.events.fireListeners",function(a,b,c,d){if(Nb(a))c=a.Kf(b,c,d);else{var e=!0;if(a=ac(a))if(b=a.nb[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.ii&&(f=gc(f,d),e=e&&!1!==f)}c=e}return c});t("H.util.events.listen",Xb);t("H.util.events.unlisten",ec);var qi=gc;
gc=function(a,b){var c,d,e=!0;var f=b[b.currentTarget===b.target?"AT_TARGET":a.capture?"CAPTURING_PHASE":(c=!0,"BUBBLING_PHASE")];if(!c||"pointerenter"!==(d=b.type)&&"pointerleave"!==d)b.eventPhase=f,e=qi(a,b),c&&a.src&&a.src.Ib&&null===a.src.Ib()&&delete b.eventPhase;return e};function ri(a,b,c,d,e){b&&(this.ff=b);ab(c)&&(this.Jo=!!c);this.Jo&&d&&(this.Ko=new Ue(d.w,d.h));ab(e)&&(this.Hk={crossOrigin:e});switch(si[eb(a)]){case 2:this.eb=a;ti(this,1);break;case 1:if(ue(a)){this.eb=a;ui(this);ti(this,1);break}a=a.src;case 0:if(a){a=ie(a);this.Dm=new Qf("image",a,A,this.Hk);this.Dm.then(z(this.eC,this),z(this.dC,this));break}default:throw ti(this,-1),new C(ri,0,"No image data");}}ri.prototype.o=0;ri.prototype.getState=function(){return this.o};
function ti(a,b){a.o=b;delete a.Dm;a.ff&&a.ff(b,a)}ri.prototype.Jo=!0;function ui(a){if(a.Jo){var b=a.eb,c=vi(a),d=c&&c.w||+b.width,e=c&&c.h||+b.height,f=ae();if(B(b,globalThis.HTMLCanvasElement))c=b;else{c=b.ownerDocument.createElement("canvas");c.width=Dc(d*f);c.height=Dc(e*f);var g=c.getContext("2d");g.scale(f,f);g.drawImage(b,0,0,d,e);lc&&(g.clearRect(0,0,d,e),g.drawImage(b,0,0,d,e))}a.eb=c}}ri.prototype.getData=function(){return this.eb||x};var si={String:0,HTMLImageElement:1,HTMLCanvasElement:2};
m=ri.prototype;m.Ko=x;m.lc=function(){return 1===this.o?vi(this):x};function vi(a){var b=a.Ko,c;if(!b){var d=a.eb;b=d.naturalWidth||d.width;if(0===b&&ge&&1===si[eb(d)]){var e=!0;if(c=d.parentNode)var f=d.nextSibling;document.body.appendChild(d)}a.Ko=b=new Ue(d.naturalWidth||d.width,d.naturalHeight||d.height);e&&(c?c.insertBefore(d,f):document.body.removeChild(d))}return b}m.eC=function(a){this.eb=a;ui(this);ti(this,1)};m.dC=function(){ti(this,-1)};m.cancel=function(){this.Dm&&this.Dm.cancel()};function wi(a,b){var c,d="anonymous";this.uid=xi.next();wi.g.constructor.call(this);if(b){var e="size";if(e in b){var f=b[e];if(!f||isNaN(f.w)||isNaN(f.h))throw new C(wi,1,e);this.fo=new Ue(f.w,f.h)}e="anchor";if(e in b){f=b[e];if(!f||isNaN(f.x)||isNaN(f.y))throw new C(wi,1,e);this.Cb=new L(f.x,f.y)}e="hitArea";e in b&&(f=b[e],B(f,Je,wi,1),this.Bm=b[e]);e="asCanvas";e in b&&(c=b[e]);e="crossOrigin";e in b&&(d=b[e]);f=b.stickHeight;f===+f&&0<f&&(this.rD=f);e="stickColor";f=b[e];e in b&&gb(f)&&(this.qD=
f)}a=new ri(a,z(this.Wg,this),c,this.fo,d);b=this.o=a.getState();0!==b?this.Wg(b,a):this.Fl=a}u(wi,G);t("H.map.Icon",wi);var xi=new je;wi.State={ERROR:-1,LOADING:0,READY:1};wi.prototype.getState=function(){return this.o};wi.prototype.getState=wi.prototype.getState;wi.prototype.Wg=function(a,b){this.eb=b.getData();if(1===a){var c=this.fo;c||(c=this.fo=b.lc());this.Cb||(this.Cb=new L(c.w/2|0,c.h))}this.Fl&&(this.o=a,delete this.Fl,this.dispatchEvent("statechange"))};wi.prototype.eb=x;
wi.prototype.Se=function(){return this.eb};wi.prototype.getBitmap=wi.prototype.Se;wi.prototype.lc=function(){return this.fo||x};wi.prototype.getSize=wi.prototype.lc;wi.prototype.Cb=x;wi.prototype.zp=function(){return this.Cb};wi.prototype.getAnchor=wi.prototype.zp;wi.prototype.Bm=x;wi.prototype.Zz=function(){return this.Bm};wi.prototype.getHitArea=wi.prototype.Zz;
wi.prototype.disposeInternal=function(){wi.g.disposeInternal.call(this);this.eb?(this.eb.removeAttribute("src"),delete this.eb):(this.Fl.cancel(),delete this.Fl)};function yi(a,b){yi.g.constructor.call(this,a,b)}u(yi,Ze);t("H.map.Marker",yi);yi.prototype.type=Ee.MARKER;yi.prototype.to=1;yi.prototype.qa=function(a){if(a!==Ce.VISUAL||1===this.rw||1===this.icon.getState())var b=yi.g.qa.call(this,a);return b||!1};yi.prototype.invalidate=yi.prototype.qa;m=yi.prototype;m.rw=0;m.Xu=function(a){return B(a,wi)};m.pq=!1;m.Mv=function(){this.qa(Ce.VISUAL)};
m.ve=function(a){var b=this.icon;this.pq&&(b.removeEventListener("statechange",this.Mv,!1,this),delete this.pq);b&&(this.rw=b.getState());yi.g.ve.call(this,a);0===a.getState()&&(this.pq=!0,Yb(a,"statechange",this.Mv,!1,this));return this};yi.prototype.setIcon=yi.prototype.ve;yi.prototype.rt=function(a){return new wi(a.svg,a)};yi.prototype.P=function(){var a=this.getIcon(),b=a.rD||0,c=yi.g.forWorkerMessage.call(this),d=c.properties.icon;d&&0<b&&Qa(d,{stick_color:a.qD,stick_height:b});return c};
yi.prototype.forWorkerMessage=yi.prototype.P;t("H.map.Style",Wf);Wf.State=hf;t("H.util.Disposable",yb);yb.prototype.ac=yb.prototype.ac;yb.prototype.addOnDisposeCallback=yb.prototype.ac;t("H.util.dispose",xb);yb.prototype.l=yb.prototype.l;yb.prototype.dispose=yb.prototype.l;yb.prototype.disposeInternal=yb.prototype.disposeInternal;yb.prototype.disposeInternal=yb.prototype.disposeInternal;function zi(a,b,c,d){zi.g.constructor.call(this);this.ld=a;this.ja=d;this.element=a.appendChild(this.createElement(a.ownerDocument));this.Vk(b,c)}u(zi,yb);zi.prototype.B=function(){return this.element};zi.prototype.Vk=function(a,b){this.size?(this.size.w=a,this.size.h=b):this.size=new Ue(a,b);this.cx(this.element,this.element.style,a,b,this.ja)};zi.prototype.setSize=zi.prototype.Vk;m=zi.prototype;m.lc=function(){return this.size};m.jb=function(){return this.ja};m.Yu=!0;
m.Yb=function(a){a!==this.Yu&&(this.element.style.display=a?"block":"none",this.Yu=a)};m.opacity=1;m.Dd=function(a){this.opacity!==a&&(this.Eg(a),this.opacity=a)};m.Ue=function(){return this.opacity};m.ui=function(a){this.element.style.zIndex=a};zi.prototype.setZIndex=zi.prototype.ui;zi.prototype.uu=function(){return+this.element.style.zIndex};zi.prototype.Qe=function(){};zi.prototype.clear=function(){};
zi.prototype.disposeInternal=function(){this.clear();this.ld.removeChild(this.element);this.Vk(0,0);delete this.element;delete this.ld;zi.g.disposeInternal.call(this)};zi.prototype.disposeInternal=zi.prototype.disposeInternal;zi.prototype.Cw=0;zi.prototype.Un=function(){++this.Cw};zi.prototype.release=function(){--this.Cw||this.l()};var Ai={PENDING:0,ACTIVE:1,DONE:2};t("H.map.render.RenderState",Ai);function Bi(a,b){var c=b||{},d=c.contextType;c=c.contextAttributes;Bi.g.constructor.call(this,b);db(a,"Function",Bi,0,"invalid render callback");if(d){if(-1===Ci.indexOf(d))throw new C(Bi,1,"invalid context type");this.jj=d}c&&(this.ij=c);this.Ar=a}u(Bi,vg);t("H.map.layer.CanvasLayer",Bi);var Ci=["2d","webgl","webgl2","experimental-webgl"];m=Bi.prototype;m.jj="2d";m.uh=function(){return this.jj};m.getContextAttributes=function(){return this.ij};
m.L=function(a,b){this.Tl&&this.Tl.canvas===a||(this.Tl=a.getContext(this.jj,this.ij));return this.Ar(this.Tl,b)};m.disposeInternal=function(){Bi.g.disposeInternal.call(this);delete this.Tl};function Di(a,b){Di.g.constructor.call(this,b);db(a,"Function",Di,0,"invalid render callback");this.Ar=a}u(Di,vg);t("H.map.layer.DomLayer",Di);Di.prototype.L=function(a,b){return this.Ar(a,b)};function Ei(a,b){Fg.call(this,a,b)}u(Ei,Fg);t("H.map.layer.TileLayer",Ei);Ei.prototype.xg=function(a,b,c,d,e){if(!B(a,K))throw new C(this.xg,0,a);if(E(b=+b))throw new C(this.xg,1,b);b=Cc(b);this.pixelProjection.Ua(b);a=this.Cj(a);var f=this.Fh(a,b);return this.Pj(f,a.left>a.right,b,c,d,e)};Ei.prototype.requestTiles=Ei.prototype.xg;function Fi(a){bb(this,Fi);Fi.g.constructor.call(this,a);if(a&&"tileSize"in a){var b=Fc(+a.tileSize)/Qc;if(isNaN(b)||b%1||0>b||30<b)throw new C(Fi,0,"tileSize: "+a.tileSize);this.tileSize=+a.tileSize}}u(Fi,M);t("H.map.provider.TileProvider",Fi);function Gi(a,b){return $c(a)-8-Bc($c(b))}Fi.getZoomLevelOffset=Gi;Fi.prototype.requestTile=Fi.prototype.Pa;Fi.prototype.cancelTile=Fi.prototype.Ld;Fi.prototype.cancelTileByKey=Fi.prototype.Yi;Fi.prototype.createTileInternal=Fi.prototype.nd;
Fi.prototype.Td=function(a,b,c){return this.uri.concat("_",a,"_",b,"_",c)};Fi.prototype.getTileKey=Fi.prototype.Td;Fi.prototype.tileSize=256;Fi.prototype.tileSize=Fi.prototype.tileSize;function Hi(a,b,c,d){this.key="";this.x=a;this.y=b;this.z=c;this.data=d;this.valid=!0}t("H.map.provider.Tile",Hi);function Ii(a,b,c,d){a-=c;b-=d;return a*a+b*b}function Ji(a,b,c){return Ki(a,b*b,c||0,0,a.length-1)}t("H.math.simplifyDP",Ji);
function Ki(a,b,c,d,e){var f=0,g=d,h=a[d].x,k=a[d].y,l=a[e].x,n=a[e].y,p=d+1,q=Ii(h,k,l,n);if(q)for(;p<e;){var r=a[p++];var v=r.x;r=r.y;var w=((v-h)*(l-h)+(r-k)*(n-k))/q;v=0>w?Ii(v,r,h,k):1<w?Ii(v,r,l,n):Ii(v,r,h+w*(l-h),k+w*(n-k));v>f&&(f=v,g=p-1)}else for(;p<e;)r=a[p++],v=r.x,r=r.y,v=Ii(v,r,h,k),v>f&&(f=v,g=p-1);f>=b||0<c&&g-d?(--c,1<g-d?(d=Ki(a,b,c,d,g),d.splice(d.length-1,1)):d=[a[d]],d=1<e-g?d.concat(Ki(a,b,c,g,e)):d.concat(a.slice(g,e+1))):d=[a[d],a[e]];return d};function Li(a,b,c,d,e,f,g,h){Li.g.constructor.call(this,b,c,d,null);this.key=a;this.zd=h;this.ed=e;this.na=f;this.di={};this.zL=g;this.Wm=Dc(Q.MAX_LINE_WIDTH/2*this.na+1)}u(Li,Hi);t("H.map.provider.SpatialTile",Li);Li.prototype.yg=Zc;Li.prototype.xr=Zc;Li.prototype.pf=Zc;function Mi(a){return a.zd.getInvalidations(Ee.SPATIAL)}
function Ni(a){var b=Mi(a),c=b.Kd,d=a.yg,e=d===c,f;if(!(e||b.Qu(d)||b.rq(d))){e=a.Ig;var g=a.di;if(b.Lm(d))for(f=e.length;f--;){var h=e[f];if(h.Mc().Lm(d)){e.splice(f,1);var k=k||Oi(a,h.wb())}}if(b.tq(d)){for(f=e.length;f--;)if(h=e[f],h.Mc().tq(d)){var l=1;if((h=g[h.wb()])&&h.xm){k=1;break}}l&&e.sort(Pi)}if(!k&&b.Kh(d))for(f=e.length;f--;)if(e[f].Mc().Kh(d)){var n=1;break}a.xr!==d||n||(a.xr=c,a.pf!==d||k||(a.pf=c));a.yg=c;e=!0}return e}
Li.prototype.Ih=function(){var a=Mi(this),b=a.Kd,c=this.pf,d=c===b;d||(this.zd.zw&&!a.Kh(c)?d=!0:Ni(this)&&(d=this.pf===b));return d};Li.prototype.isCanvasValid=Li.prototype.Ih;Object.defineProperty(Li.prototype,"valid",{get:function(){return this.Ih()},set:oe,configurable:!0});function Qi(a,b){this.hm=a;this.xm=b}function Oi(a,b){a=a.di;var c=a[b];if(c)return delete a[b],c.xm}Li.prototype.Ig=pe;
function Ri(a){var b=Mi(a),c=a.yg,d=a.Ig,e;if(!Ni(a)){for(e=d.length;e--;){var f=d[e];var g=f.Mc();(g.Lm(c)||g.rq(c))&&Oi(a,f.wb())}a.Ig=a.zd.requestSpatialsByTile(a,!1,!1).sort(Pi);a.yg=b.Kd}}function Pi(a,b){return Fe(a.Ve(),b.Ve(),!1)}Li.prototype.ab=function(){return this.Ig};Li.prototype.getObjects=Li.prototype.ab;Li.prototype.MA=function(){return this.ed};Li.prototype.getTileSize=Li.prototype.MA;var Si={};
Li.prototype.Qj=function(){var a=this.ed+"_"+this.na,b=Si[a];if(!b){b=-this.Wm;var c=this.ed-b;b=Si[a]=new bf(b,b,c,c)}return b};Li.prototype.getPxClipRect=Li.prototype.Qj;Li.prototype.om=function(){var a=this.sz;if(!a){var b=this.qm();a=0;var c=this.ed;this.z&&(c-=a+=this.Qj().top);a=this.sz=Bg(b.tk(new L(a,a)),b.tk(new L(c,c)))}return a};Li.prototype.getGeoClipRect=Li.prototype.om;
Li.prototype.qm=function(){var a=this.DC;if(!a){var b=this.ed;a=this.DC=new sg(A,b);a.Ua(this.z);a.x=this.x*b;a.y=this.y*b}return a};Li.prototype.getPxProj=Li.prototype.qm;Li.prototype.jb=function(){return this.na};Li.prototype.getPixelRatio=Li.prototype.jb;Li.prototype.Jn=function(){var a=this.data;a&&(this.data=null,this.pf=Zc);return a};Li.prototype.releaseCanvas=Li.prototype.Jn;Li.prototype.Kn=function(){this.di={};delete this.Ig;this.yg=Zc};Li.prototype.releaseData=Li.prototype.Kn;
Li.prototype.L=function(a){var b=a.getContext("2d"),c,d,e,f,g=0;Ri(this);if(this.pf<this.yg){var h=this.Ig;if(c=h.length){a.width=a.height=this.ed;b.clearRect(0,0,this.ed,this.ed);var k=this.di;for(d=0;d<c;d++){var l=h[d];var n=l.wb();if(f=(e=k[n])?e.hm:l.getGeometriesForTile(this)){if(e)l.Mc().Kh(this.pf)&&(e.xm=Xh(l,f)),e=e.xm;else{e=Xh(l,f);var p;var q=f;for(var r=l.We?2:0,v=q.length;v--;){var w=q[v];if(w!==Kh){var y=w.Sc;for(p=y.length;p--;)w=y[p],4<w.length&&(y[p]=Ji(w,.6,r))}}this.di[n]=new Qi(f,
e)}if(e){b.save();q=l.We?this.KC:this.LC;for(n=0;n<f.length;n++)q.call(this,l,f[n],l.K(),b);if(f=l.getLabels(this))for(l=b,n=f.length;n--;)for(r=f[n],q=r.size,l.font=q+"px "+r.font,l.fillStyle=r.color,l.textAlign="center",l.translate(r.x,r.y),l.rotate(r.angle),q=r.lineHeight||1.375*q,v=r.lines,r=v.length;r--;)l.fillText(v[r],0,r*q);b.restore()}g|=+e}}}this.data=g?a:null;this.xr=this.pf=this.yg}else this.data&&(g=1);return 0<g};Li.prototype.render=Li.prototype.L;Li.prototype.data=null;
Li.prototype.LC=function(a,b,c,d){var e;c.Yj&&(Ti(d,c,this.na),Ui(b,d,!1,!0,!1,this.ed,this.Wm));c.Wj&&(e=a.Tg)&&e.Oc&&(Vi(d,e),Wi(this,d,b,e,c.lineWidth))};
Li.prototype.KC=function(a,b,c,d){var e=c.Oc,f=c.Yj,g,h=this.ed,k=this.Wm;if(b===Kh)e&&(Vi(d,c),d.fillRect(0,0,h,h));else{f&&Ti(d,c,this.na);if(c.Wj&&(g=a.Tg)){var l=c.lineWidth;g.Oc||(g=null)}a=b.un;if(a===Yc){if(f||e)Vi(d,c),Ui(b,d,!0,f,e,h,this.Wm);g&&(Vi(d,g),Wi(this,d,b,g,l,0))}else e&&(Vi(d,c),Ui(b,d,!0,!1,e,h,k,0,a)),f&&Ui(b,d,!1,f,!1,h,k,a),g&&(Vi(d,g),Wi(this,d,b,g,l,a))}};
function Ui(a,b,c,d,e,f,g,h,k){var l=a.Sc,n=-g;g=f+g;h=h||0;k===A&&(k=l.length);if(e&&a===Kh)b.fillRect(0,0,f,f);else if(k>h){b.beginPath();for(f=h;f<k;f++){var p=l[f];var q=p.length;if(p===Lh)b.moveTo(n,n),b.lineTo(n,g),b.lineTo(g,g),b.lineTo(g,n);else{var r=p[0];b.moveTo(r.x,r.y);for(h=1;h<q;h++)r=p[h],b.lineTo(r.x,r.y)}c&&b.closePath()}c&&e&&b.fill(a.Vj!==Yc?"evenodd":"nonzero");d&&b.stroke()}}
function Ti(a,b,c){var d;a.strokeStyle=b.strokeColor;a.lineWidth=b.lineWidth*c;a.lineCap=b.lineCap;a.lineJoin=b.lineJoin;a.miterLimit=b.miterLimit;a.setLineDash&&(d=b.lineDash)!==pe&&(a.setLineDash(d),a.lineDashOffset=b.lineDashOffset)}function Vi(a,b){a.fillStyle=b.fillColor}
function Wi(a,b,c,d,e,f){var g=e*d.width/2;e=e*d.length/2;var h=e/2;d=2*e*d.frequency;var k=Gc(Hc(e,2)+Hc(g,2));a=a.ed-k;a=new bf(k,k,a,a);c=c.Sc;var l,n,p,q,r,v,w,y=Rc/2;f=f||0;for(k=c.length;k-- >f;){var D=0;var F=c[k];if(n=l=F.length){var O=F;n=O.length;for(p=0;--n;)p+=O[n].ib(O[n-1]);n=(O=p)>=d}if(n)for(n=yc(Cc(O/d),1E3),n=O/(n+1),p=n/2;--l;){for(q=(r=F[l]).ib(v=F[l-1]);p<=D+q;){var R=r.x+(v.x-r.x)*(w=(p-D)/q);w=r.y+(v.y-r.y)*w;a.Rl(R,w)&&(b.save(),b.translate(R,w),b.rotate(-Oc((v.y-r.y)/(r.x-
v.x))+(r.x<v.x?y:-y)),b.beginPath(),b.moveTo(-g,-e),b.lineTo(0,e),b.lineTo(g,-e),b.lineTo(0,-h),b.closePath(),b.fill(),b.restore());p+=n}D+=q}}}var Xi=[];
Li.prototype.Ma=function(a,b,c){for(var d=this.Ig,e=d.length,f,g,h,k,l,n,p=pe,q,r=this.na;e--;)if(g=d[e],g.Vd(!0)&&(h=this.di[g.wb()])&&(k=h.hm)){f=g.K();n="none"!==f.fillColor&&g.We;q="none"===f.strokeColor?0:f.lineWidth*r;for(f=k.length;f--;){l=k[f];var v;if(!(v=n&&l===Kh)&&(v=n||q)){var w;v=a;var y=b,D=n,F=q,O=l.Vj,R=l.un,Ta=R!==Yc,aa=l.Sc,wb=aa.length,Ba=0,Oa=0,ic=!1;for(l=0;l<wb;l++){var jc=aa[l];var Ka=l>=R;var zc=!Ka&&l>=O;if(jc===Lh&&D)zc?Ba++:Oa++;else{var Lc=jc.length;Xi.length=2*Lc;for(w=
0;w<Lc;w++){var dp=jc[w];Xi[2*w]=dp.x;Xi[2*w+1]=dp.y}w=D&&!Ka;Ka=Ta&&!Ka?0:F;if(w||Ka)if(Ka=fd(v,y,Xi,Ka,w),Ka===ed.EDGE||Ka===ed.VERTEX){ic=!0;break}else if(Ka===ed.SURFACE)if(zc)Ba++;else if(Oa++,O===Yc)break}}v=ic||0<Oa&&!(Ba%2)}if(v){p===pe&&(p=[]);p.push(g);break}}if(c&&p.length)break}return p};var Yi,Zi=function(){function a(){}for(var b=globalThis,c,d,e,f=Va("o ms moz webkit ").split(void 0!==A?void 0:" "),g=5;g--&&!c;)c=f[g],c=(d=b[c+(c?"R":"r")+"equestAnimationFrame"])&&!E(d.call(window,a))&&(e=b[c+(c?"C":"c")+"ancelAnimationFrame"]);Yi=c?function(h){return d.call(b,h)}:function(h){return b.setTimeout(h,25)};return c?function(h){return e.call(b,h)}:function(h){return b.clearTimeout(h)}}(),$i=globalThis.performance&&globalThis.performance.now?function(){return globalThis.performance.now()}:
function(){return globalThis.Date.now()};function aj(){}t("H.util.ICache",aj);aj.prototype.add=function(){};aj.prototype.add=aj.prototype.add;aj.prototype.get=function(){};aj.prototype.get=aj.prototype.get;aj.prototype.dm=function(){};aj.prototype.drop=aj.prototype.dm;aj.prototype.forEach=function(){};aj.prototype.forEach=aj.prototype.forEach;aj.prototype.ia=function(){};aj.prototype.removeAll=aj.prototype.ia;aj.prototype.fi=function(){};aj.prototype.registerOnDrop=aj.prototype.fi;aj.prototype.ip=function(){};
aj.prototype.deRegisterOnDrop=aj.prototype.ip;function bj(a,b,c){this.nk=[];b&&this.fi(b);if(c&&!Za(c))throw new C(bj,2,c);this.Ne=0;this.filter=c;this.aa={};this.bk=this.ph=null;this.Sr(a)}t("H.util.Cache",bj);bj.prototype.add=function(a,b,c){var d,e;c=+c;if(!jb(c)||0>c)throw new C(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.aa[a])?(d.data!==b&&cj(this,d),this.Ne+=c-d.size,d.size=c,d.data=b,dj(this,d)):this.aa[a]=ej(this,{id:a,data:b,size:c,yd:null,lf:null},this.ph),fj(this);return e};bj.prototype.add=bj.prototype.add;
bj.prototype.fi=function(a){if(!Za(a))throw new C(this.fi,0,a);this.nk.push(a)};bj.prototype.registerOnDrop=bj.prototype.fi;bj.prototype.ip=function(a){this.nk=this.nk.filter(function(b){return b!==a})};bj.prototype.deRegisterOnDrop=bj.prototype.ip;bj.prototype.get=function(a,b){return(a=b?this.aa[a]:dj(this,this.aa[a]))&&a.data};bj.prototype.get=bj.prototype.get;bj.prototype.dm=function(a){var b;(b=this.aa[a])&&this.nf(b,!0)};bj.prototype.drop=bj.prototype.dm;
bj.prototype.forEach=function(a,b,c){var d;for(d in this.aa){var e=this.aa[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};bj.prototype.forEach=bj.prototype.forEach;bj.prototype.ia=function(a){var b;for(b in this.aa){var c=this.aa[b];(a?a(b,c.data,c.size):1)&&this.nf(this.aa[b],!0)}};bj.prototype.removeAll=bj.prototype.ia;bj.prototype.Sr=function(a){if(!(0<+a))throw new C(bj.prototype.Sr,0,a);this.vv=+a;fj(this);return this};bj.prototype.setMaxSize=bj.prototype.Sr;bj.prototype.nA=function(){return this.vv};
bj.prototype.getMaxSize=bj.prototype.nA;bj.prototype.Kz=function(){return this.Ne};bj.prototype.getCurrentSize=bj.prototype.Kz;function dj(a,b){b&&(a.ph=ej(a,b,a.ph));return b}function fj(a){for(;a.Ne>a.vv&&a.bk;)a.nf(a.bk,!0)}function ej(a,b,c){if(c!==b){(b.yd||b.lf)&&a.nf(b,!1);if(b.yd=c)b.lf=c.lf,c.lf=b;b.lf||(a.ph=b);b.yd||(a.bk=b);a.Ne+=b.size}return b}
bj.prototype.nf=function(a,b){var c=a.lf,d=a.yd;if(c||d||a==this.ph&&a==this.bk)c?c.yd=d:this.ph=d,d?d.lf=c:this.bk=c,this.Ne-=a.size,b&&(delete this.aa[a.id],cj(this,a));a.yd=a.lf=null;return a};function cj(a,b){for(var c=a.nk.length;c--;)a.nk[c].call(a,b.id,b.data,b.size)};function gj(a,b){var c=this;if(!Za(b))throw new C(gj,1,b);if(!Za(a.next||Za(a.cycle)))throw new C(gj,2,'Argument "mode" must implement H.util.AsyncQueue.Mode');this.Bk=[];this.ww=[];this.PB=a;this.process=b;this.BC=function(){hj(c)};this.nr=null;this.Qw=function(){c.nr||(c.nr=globalThis.setTimeout(c.BC,1))}}t("H.util.AsyncQueue",gj);gj.prototype.push=function(a,b){if(!Za(b))throw new C(this.push,1,b);a=ij(new jj,a,this.Qw,b);this.Bk.push(a);this.Qw();return a};gj.prototype.push=gj.prototype.push;
gj.prototype.Cn=function(){hj(this)};function hj(a){var b=a.ww,c=0,d=a.PB;d.vt();for(a.nr=null;c<b.length;){var e=b[c];e.Uu?b.splice(c,1):c++}for(;e=d.next(a.Bk,a.ww);)e.cancelled?e.done(null,"cancelled"):(b.push(e),a.process(e,e.data))}function jj(){ij(this,null,null,null)}gj.Task=jj;function ij(a,b,c,d){a.data=b;a.cancelled=!1;a.Uu=!1;a.ZB=c;a.$B=d;a.So=null;return a}jj.prototype.done=function(a,b){this.Uu=!0;this.ZB();this.$B(this,a,b)};jj.prototype.done=jj.prototype.done;
jj.prototype.cancel=function(){this.So&&this.So();this.cancelled=!0};jj.prototype.cancel=jj.prototype.cancel;jj.prototype.cD=function(a){this.So=a;return this};jj.prototype.setCancelFn=jj.prototype.cD;function kj(){}gj.Mode=kj;kj.prototype.next=function(){};kj.prototype.vt=function(){};function lj(a,b){lj.g.constructor.call(this,new mj(a),b)}u(lj,gj);t("H.util.SequentialQueue",lj);function mj(a){if(isNaN(a)||0>a)throw new C(lj,1,'Argument "maxTime" must be a positive number');this.IB=a;this.al=$i()}mj.prototype.next=function(a){return a.length&&$i()-this.al<this.IB?a=a.shift():null};mj.prototype.vt=function(){this.al=$i()};function nj(a,b){var c;nj.g.constructor.call(this,b);this.yw=a;this.na=a=b.pixelRatio;this.tileSize=c=1<<Bc($c((b.tileSize||256)*a));this.ts=Gi(c,a);this.je=z(this.je,this);this.Qq=z(this.Qq,this);this.rg=z(this.rg,this);this.kg=z(this.kg,this);this.ge=z(this.ge,this);this.yw.addEventListener(M.prototype.j.Ca,this.ge,!1,this);this.Zg=[];this.vf=new bj(b.tileCacheSize||256,this.je);this.fp=new bj(b.dataCacheSize||512,this.Qq);this.On=new lj(20,this.rg);this.pg={};this.ev=$i()}u(nj,Fi);
nj.prototype.ge=function(a){a=a.target;a.type===Ee.SPATIAL&&this.hb(a)};nj.prototype.Pa=function(a,b,c,d){var e=this.getTileKey(a,b,c),f;if(f=this.vf.get(e,d)){if(d||f.Ih())return f;d||this.vf.dm(e)}if((f=this.fp.get(e,d))&&(d||Ni(f)))return a=this.Zg.pop()||document.createElement("canvas"),f.L(a)||this.Zg.push(a),this.vf.add(e,f,1),f;d||((f=this.pg[e])?f.count++:(f=this.On.push([e,a,b,c],this.kg),f.count=1,this.pg[e]=f))};nj.prototype.requestTile=nj.prototype.Pa;nj.prototype.nd=function(){};
nj.prototype.createTileInternal=nj.prototype.nd;nj.prototype.Cn=function(){var a=$i();33<a-this.ev&&(this.On.Cn(),this.ev=a)};nj.prototype.Ld=function(a,b,c){this.Yi(this.getTileKey(a,b,c))};nj.prototype.cancelTile=nj.prototype.Ld;nj.prototype.Yi=function(a){var b;if(b=this.pg[a])b.count--,b.count||(b.cancel(),delete this.pg[a])};nj.prototype.cancelTileByKey=nj.prototype.Yi;m=nj.prototype;
m.rg=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];c=this.vf.get(c)||new Li(c,d,e,f,this.tileSize,this.na,f+this.ts,this.yw);d=c.data||this.Zg.pop()||document.createElement("canvas");c.L(d)||this.Zg.push(d);b.push(c);a.done(c)};m.kg=function(a,b){a=a.data[0];b&&this.vf.add(a,b,1);delete this.pg[a];this.hb()};m.je=function(a,b){b.data&&this.Zg.push(b.Jn());this.fp.add(a,b,1)};m.Qq=function(a,b){b.Kn()};
m.disposeInternal=function(){for(var a in this.pg)this.pg[a].cancel();this.vf.ia();this.fp.ia();this.Zg.length=0;nj.g.disposeInternal.call(this)};function oj(a,b){b=b?Na(b):{};b.tileSize=b.tileSize||256;b.pixelRatio=b.pixelRatio||ae();b.max=24;this.Hg=new nj(a,b);this.wi=new Ei(this.Hg);b.minWorldSize=this.Hg.tileSize;b.provider=a;oj.g.constructor.call(this,b);this.tileSize=this.wi.tileSize;this.mn=z(this.mn,this);this.Hg.addEventListener(this.Hg.j.Ca,this.mn);a.addEventListener(a.j.Ca,this.mn)}u(oj,vg);t("H.map.layer.ObjectLayer",oj);oj.prototype.mn=function(a){a.currentTarget!==this.Hg&&a.target.type===Ee.SPATIAL||this.hb()};
var pj={markers:pe,total:0};oj.prototype.pe=function(a,b,c){var d=this.D,e;return d.providesMarkers()&&(e=d.requestMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:pj};oj.prototype.requestMarkers=oj.prototype.pe;oj.prototype.oe=function(a,b,c){var d=this.D,e;return d.providesDomMarkers()&&(e=d.requestDomMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:pj};oj.prototype.requestDomMarkers=oj.prototype.oe;var qj={tiles:pe,total:0};
oj.prototype.xg=function(a,b,c,d){if(this.D.providesSpatials()){var e=this.wi.xg(a,b,c,d);c||(this.Hg.Cn(),e=this.wi.xg(a,b,!0,d))}else e=qj;return e};oj.prototype.requestTiles=oj.prototype.xg;oj.prototype.Pa=function(a,b,c,d){return this.wi.Pa(a,b,c,d)};oj.prototype.requestTile=oj.prototype.Pa;oj.prototype.Ld=function(a,b,c){this.wi.Ld(a,b,c)};oj.prototype.cancelTile=oj.prototype.Ld;var rj={overlays:pe,total:0};
oj.prototype.wg=function(a,b,c){var d=this.D,e=rj;d.providesOverlays&&d.providesOverlays()&&(a=d.requestOverlays(a,b,!0,c),b=a.length)&&(e={overlays:a,total:b});return e};oj.prototype.requestOverlays=oj.prototype.wg;oj.prototype.disposeInternal=function(){this.Hg.l();this.wi.l();this.D.dispose();oj.g.disposeInternal.call(this)};function sj(a,b,c,d,e,f){sj.g.constructor.call(this,isNaN(a)?15:a,b,c,d,e,f)}u(sj,Xg);sj.prototype.Ml=function(a){for(var b,c,d=this.head,e=a;e;){if(a=e.entries)if(b=a.length){if(2>b&&(c=e.parent)&&1===c.fb){c.removeChild(e);d===e&&(d=c);c.entries=a;e=a[0].node=c;continue}}else if(delete e.entries,c=e.parent)if(c.removeChild(e),d===e&&(d=c),1===c.fb){e=c.fb?c[0]||c[1]||c[2]||c[3]:null;continue}break}this.head!==d&&(this.head=d,this.jd())};
sj.prototype.Yd=function(a,b){if(dh(this.root,a,b,a,b))return this.Ub(this.root,a,b,this.Ph);throw Error("Coordinates out of bounds");};sj.prototype.Ub=function(a,b,c,d){var e=a.entries;if(d)if(a.fb)e=this.Tj(a,b,c,d);else if(e){e=e[0];var f=a.th(+(e[1]>=a[8])|+(e[0]>=a[9])<<1);f.entries=a.entries;delete a.entries;e.node=f;this.jd(f);e=this.Tj(a,b,c,d)}else a.Qg(e=new tj(b,c)),this.jd(a),$g(this,e,!0);else e||this.jd(a),a.Qg(e=new tj(b,c)),$g(this,e,!0);return e};
sj.prototype.Tj=function(a,b,c,d){return this.Ub(a.th(+(b>=a[8])|+(c>=a[9])<<1),b,c,d-1)};function tj(a,b){this.id=ch++;this[0]=b;this[1]=a}tj.prototype.Nf=function(a){return this[a%2]};function uj(){this.Ae=new sj(10,180,90,0,0,!0)}m=uj.prototype;m.ic=0;m.J=null;m.C=function(){var a=this.J,b;!a&&(b=Yg(this.Ae))&&(this.J=a=new K(-b[0],b[3],-b[2],b[1]));return a};m.Yd=function(a){++this.ic;this.J=null;return this.Ae.Yd(a.lng,-a.lat)};m.remove=function(a){if(a=this.Ae.remove(a))--this.ic,this.J=null;return a};m.Gm=function(a,b,c){var d=this.Ae,e=a.Nc(),f=a.Lc(),g=-e.lat;e=e.lng;var h=-f.lat;f=f.lng;return a.pc()?d.mb(-180,g,f,h,c,b).concat(d.mb(e,g,180,h,c,b)):d.mb(e,g,f,h,c,b)};function vj(a){vj.g.constructor.call(this,a)}u(vj,Ve);t("H.geo.MultiLineString",vj);vj.prototype.sq=function(a){return B(a,N)};vj.prototype.$b="Multi"+N.prototype.$b;vj.prototype.Jc="Multi"+N.prototype.Jc;function wj(a,b){wj.g.constructor.call(this,!1,b);this.X(a)}u(wj,Yh);t("H.map.Polyline",wj);wj.prototype.C=function(){return this.Gb.C()};wj.prototype.getBoundingBox=wj.prototype.C;wj.prototype.X=function(a){var b=this.X,c,d;if(B(a,vj)){var e=a.ha;if(c=e.length)for(d=0;d<c;d++)xj(e[d],b);else throw new C(b,0);}else xj(a,b);this.Uf=!!e;this.Gb=a;this.qa(Ce.SPATIAL);return this};wj.prototype.setGeometry=wj.prototype.X;wj.prototype.V=function(){return this.Gb};wj.prototype.getGeometry=wj.prototype.V;
wj.prototype.clip=function(a){var b=this.Gb;return zh(this.Uf?b.ha[0]:b,a)};wj.prototype.clip=wj.prototype.clip;wj.prototype.xh=function(a){var b=this.Gb;var c,d=[];if(this.Uf)for(b=b.ha,c=b.length;c--;)yj(this,b[c],a,d);else yj(this,b,a,d);return d.length?d:A};wj.prototype.getGeometriesForTile=wj.prototype.xh;function xj(a,b){if(!B(a,N)||2>a.Nj())throw new C(b,0);}
function yj(a,b,c,d){var e=zh(b,c.om());if(e.length&&(b=c.qm(),a=Zh(a,e,!1,b),e=a.length)){var f=c.Qj();b=b.w;c.x||ai(a,e,-b);c.x===(1<<c.z)-1&&ai(a,e,b);c=Lg(a,f.left,f.top,f.right,f.bottom,!1);c.length&&d.push(new Jh(c))}}wj.prototype.P=function(){var a=wj.g.P.call(this),b=a.properties;a.geometry=this.V().P();b.style=this.K().P();b.height=0;return a};wj.prototype.forWorkerMessage=wj.prototype.P;function zj(a,b,c){var d="anonymous",e=1;this.Wg=z(this.Wg,this);I.call(this,c);this.X(a);c&&(a="crossOrigin",a in c&&(d=c[a]),a="opacity",a in c&&(e=c[a]));this.Xw(b,d);this.Dd(e)}u(zj,I);t("H.map.Overlay",zj);zj.prototype.type=Ee.OVERLAY;zj.prototype.C=function(){return this.J};zj.prototype.getBoundingBox=zj.prototype.C;zj.prototype.si=function(a){B(a,K,this.si,0,a);return this.X(a)};zj.prototype.setBoundingBox=zj.prototype.si;zj.prototype.V=function(){return this.J};
zj.prototype.getGeometry=zj.prototype.V;zj.prototype.X=function(a){var b=this.J,c=!b;B(a,K,this.X,0,a);if(c||!b.da(a))this.J=a,c||this.qa(Ce.SPATIAL);return this};zj.prototype.setGeometry=zj.prototype.X;zj.prototype.Se=function(){return this.eb.getData()};zj.prototype.getBitmap=zj.prototype.Se;zj.prototype.Xw=function(a,b){var c=this.eb;c&&1!==c.getState()&&c.cancel();this.eb=new ri(a,this.Wg,!0,A,b);return this};zj.prototype.setBitmap=zj.prototype.Xw;
zj.prototype.Wg=function(a,b){this.eb=b;1===a&&this.qa(Ce.VISUAL)};zj.prototype.Ue=function(){return this.Rc};zj.prototype.getOpacity=zj.prototype.Ue;zj.prototype.Dd=function(a){var b=this.Rc,c=2>b;a-=0;if(0<=a&&1>=a)a!==b&&(this.Rc=a,c&&this.qa(Ce.VISUAL));else throw new C(this.Dd,0);return this};zj.prototype.setOpacity=zj.prototype.Dd;zj.prototype.P=function(){var a=zj.g.P.call(this);a.geometry=Bh(this.J).P();a.properties.overlay=!0;return a};zj.prototype.forWorkerMessage=zj.prototype.P;function Aj(a){var b;bb(this,Aj);Aj.g.constructor.call(this,a);this.Wf=a=[];for(b in Ee)a[Ee[b]]=new Be}u(Aj,M);t("H.map.provider.ObjectProvider",Aj);Aj.prototype.qr=me;Aj.prototype.providesByViewport=Aj.prototype.qr;Aj.prototype.Mc=function(a){return this.Wf[a||Ee.ANY]};Aj.prototype.getInvalidations=Aj.prototype.Mc;Aj.prototype.Hh=function(a,b){if(b!==Ce.NONE){var c=this.Wf[Ee.ANY];var d=c.Kd+1;c.update(d,b);c=this.Wf[a.type];c.update(d,b);a.Mc().update(d,b);this.hb(a)}};
Aj.prototype.invalidateObject=Aj.prototype.Hh;Aj.prototype.requestOverlays=Aj.prototype.wg;Aj.prototype.requestSpatials=Aj.prototype.Pn;Aj.prototype.requestSpatialsByTile=Aj.prototype.Qn;Aj.prototype.zw=!1;Aj.prototype.requestMarkers=Aj.prototype.pe;Aj.prototype.requestDomMarkers=Aj.prototype.oe;function S(a){var b={};this.Du=b.previousSibling=b.nextSibling=b;this.nD=new je;S.g.constructor.call(this,a);a&&"objects"in a&&this.hd(a.objects)}u(S,I);t("H.map.Group",S);S.prototype.type=Ee.GROUP;S.prototype.ti=function(a,b){this.lr=!0;a=S.g.ti.call(this,a,b);this.lr=!1;a&&this.forEach(Bj,!0);return a};S.prototype.setProvider=S.prototype.ti;function Bj(a,b,c){a.ti(c.D)}S.prototype.contains=function(a){var b=this===a;if(!b&&this.ah&&B(a,I))for(;!b&&a;)a===this?b=!0:a=a.Na;return b};
S.prototype.contains=S.prototype.contains;S.prototype.Ik=function(){this.so=A;this.forEach(Cj,!0)};S.prototype.resetZInfo=S.prototype.Ik;function Cj(a){a.Ik()}S.prototype.lr=!1;S.prototype.qa=function(a){var b=S.g.qa.call(this,a);b&&!this.lr&&(this.Xt=a,this.forEach(Dj,!0),delete this.Xt);return b};S.prototype.invalidate=S.prototype.qa;function Dj(a,b,c){a.qa(c.Xt)}
S.prototype.forEach=function(a,b,c){var d;if(this.ah){var e=this.Du;var f=e.nextSibling;for(d=0;f!==e;){var g=f.nextSibling;a.call(c,f,d++,this);b&&B(f,S)&&f.forEach(a,b,c);f=g}}};S.prototype.forEach=S.prototype.forEach;S.prototype.ab=function(a){var b=[];this.forEach(Ej,a,b);return b};S.prototype.getObjects=S.prototype.ab;S.prototype.C=function(){var a=null;this.ah&&this.forEach(function(b){b.C&&(b=b.C())&&(a=a?a.xd(b):b)});return a};S.prototype.getBoundingBox=S.prototype.C;
function Ej(a){this.push(a)}S.prototype.ah=0;S.prototype.Ez=function(){return this.ah};S.prototype.getChildCount=S.prototype.Ez;
S.prototype.Y=function(a){var b=this.Du,c=b.previousSibling;B(a,I,this.Y,0);if(a.contains(this))throw new vb(this.Y,"The new object contains the parent group");var d=a.tm(!0);var e=a.Na;if(e!==this){if(e){e=a.previousSibling;var f=a.nextSibling;e.nextSibling=f;f.previousSibling=e}a.Na=this;I.g.ea.call(a,this);c.nextSibling=a;a.previousSibling=c;a.nextSibling=b;b.previousSibling=a;this.ah++}a.cs=this.nD.next();a.Ik();b=a.ti(this.D,this.Y);a.tm(!0)!==d&&a.qa(Ce.VOLATILITY);b||a.qa(Ce.Z_ORDER);return a};
S.prototype.addObject=S.prototype.Y;S.prototype.hd=function(a){var b;fb(a,this.hd,0);var c=a.length;for(b=0;b<c;b++)this.Y(a[b])};S.prototype.addObjects=S.prototype.hd;S.prototype.Oa=function(a){if(!a||a.Na!==this)throw new vb(this.Oa,"object not found");var b=a.previousSibling,c=a.nextSibling;b.nextSibling=c;c.previousSibling=b;a.Na=null;I.g.ea.call(a,null);delete a.previousSibling;delete a.nextSibling;B(a.D,J)&&a.ti(null,this.Oa);this.ah--;return a};S.prototype.removeObject=S.prototype.Oa;
S.prototype.ug=function(a){var b;fb(a,this.ug,0);var c=a.length;for(b=0;b<c;b++)this.Oa(a[b])};S.prototype.removeObjects=S.prototype.ug;S.prototype.ia=function(){var a=this.ab();this.ug(a)};S.prototype.removeAll=S.prototype.ia;
S.prototype.ye=function(a){for(var b=this.ab(),c=0,d=b.length,e=[],f,g,h;c<d;c++)h=b[c],h instanceof S?(f=a?a(h.getData()):h.getData(),g=He(this,f,!!a),f={type:"Feature"},f.properties=g,h.gi&&(f.id=h.gi),f.geometry={},f.geometry.type="GeometryCollection",f.geometry.geometries=Fj(this,h.ab()),e.push(f)):e.push(h.ye(a));return{type:"FeatureCollection",features:e}};S.prototype.toGeoJSON=S.prototype.ye;
function Fj(a,b){for(var c=0,d=b.length,e,f=[];c<d;c++)e=b[c],e=e instanceof S?{type:"GeometryCollection",geometries:Fj(a,e.ab())}:e instanceof Ze||e instanceof zj||e instanceof wj||e instanceof bi?e.V().ye():{type:"FeatureCollection",features:pe},f.push(e);return f}S.prototype.P=function(){var a=S.g.P.call(this);a.type="Group";return a};S.prototype.forWorkerMessage=S.prototype.P;function J(a){a=a||{};J.g.constructor.call(this,a);this.Ag=a=new S({min:a.min,max:a.max});a.D=this;a.ea(this);a.qa(Ce.ADD);this.sk=new hh;this.xi=new hh;this.fk=new uj;this.kk=new hh;this.cm=new uj;this.$m=new hh}u(J,Aj);t("H.map.provider.LocalObjectProvider",J);J.prototype.getCapabilities=function(){return lf.PROVIDES_BY_VIEWPORT|lf.PROVIDES_WEBGL_RENDERABLE_OBJECTS|lf.PROVIDES_DOM_MARKERS|lf.CROP_LINES_BY_TILE};
J.prototype.kb=function(){if(!this.Vi&&(this.Vi=J.g.kb.call(this),this.Vi instanceof Wf)){var a=new ig(this.getCapabilities()|lf.HAS_VOLATILE_DATA,this.uid+"_vol",this.min,this.max,this.Rc,this.tileSize);this.Vi.gk(a.Je())}return this.Vi};J.prototype.getStyleInternal=J.prototype.kb;J.prototype.Wa=function(a,b){J.g.Wa.call(this,a,b);this.Vi=null};J.prototype.setStyleInternal=J.prototype.Wa;J.prototype.qd=function(){return this.Ag};J.prototype.getRootGroup=J.prototype.qd;
J.prototype.Hh=function(a,b){b&Ce.SPATIAL&&this.Y(a);J.g.Hh.call(this,a,b)};J.prototype.invalidateObject=J.prototype.Hh;J.prototype.Y=function(a){var b;B(a,I,this.Y,0);if(a.D!==this)throw new vb(this.Y,"foreign object");this.Oa(a);var c=a.type;if(c===Ee.MARKER)if((b=a.V())instanceof Re){var d=!0;c=this.fk}else c=this.kk;else c===Ee.DOM_MARKER?(b=a.V())instanceof Re?(d=!0,c=this.cm):c=this.$m:c=c===Ee.OVERLAY?this.sk:this.xi;d=d?c.Yd(b):c.Ku(a.C());d.As=a;a.ys=d};
J.prototype.Oa=function(a){var b;if(a)if(a.D!==this){if(B(a,I))throw new vb(this.Oa,"foreign object");}else if(b=a.ys){var c=a.type;c===Ee.MARKER?this.fk.remove(b)||this.kk.remove(b):c===Ee.DOM_MARKER?this.cm.remove(b)||this.$m.remove(b):c===Ee.OVERLAY?this.sk.remove(b):this.xi.remove(b);delete b.As;delete a.ys}};J.prototype.removeObject=J.prototype.Oa;
function Gj(a,b,c,d,e,f,g){g=g||[];if(b.ic)for(a=b!==a.fk&&b!==a.kk,e=!e,b=b.Gm(c,f,f),c=b.length,f=0;f<c;f++){var h=b[f].As;var k;if(k=void 0!==d){for(var l=Cc(d),n=h;(k=n.yb<=l&&n.Pc>=l)&&(n=n.Na););k=!k}k||!e&&!h.Vd(!0)||(a||1===h.jc().getState())&&g.push(h)}return g}J.prototype.sr=function(){return 0<this.sk.ic};J.prototype.providesOverlays=J.prototype.sr;J.prototype.wg=function(a,b,c){return Gj(this,this.sk,a,b,c,!1).filter(function(d){return d.Se()})};J.prototype.requestOverlays=J.prototype.wg;
J.prototype.me=function(){return 0<this.xi.ic};J.prototype.providesSpatials=J.prototype.me;J.prototype.Pn=function(a,b,c){return Gj(this,this.xi,a,b,c,!1)};J.prototype.requestSpatials=J.prototype.Pn;J.prototype.Qn=function(a,b){return Gj(this,this.xi,a.om(),a.zL,b,!1)};J.prototype.requestSpatialsByTile=J.prototype.Qn;J.prototype.Vc=function(){return 0<this.fk.ic+this.kk.ic};J.prototype.providesMarkers=J.prototype.Vc;J.prototype.pe=function(a,b,c){return Hj(this,a,b,c,!1)};
J.prototype.requestMarkers=J.prototype.pe;function Hj(a,b,c,d,e){var f=Gj(a,a.fk,b,c,d,e);Gj(a,a.kk,b,c,d,e,f);return f}J.prototype.Uc=function(){return 0<this.cm.ic+this.$m.ic};J.prototype.providesDomMarkers=J.prototype.Uc;J.prototype.oe=function(a,b,c){return Ij(this,a,b,c,!1)};J.prototype.requestDomMarkers=J.prototype.oe;function Ij(a,b,c,d,e){var f=Gj(a,a.cm,b,c,d,e);Gj(a,a.$m,b,c,d,e,f);return f}
function Jj(a,b,c){var d=c.V(),e,f=Kj.bind(null,a);a=Lj.bind(null,a);B(c,wj)?e=B(d,N)?f(d):d.ha.some(f):B(c,bi)?e=B(d,P)?a(d):d.ha.some(a):B(c,zj)&&(e=a(Bh(d)));e&&b.push(c)}function Kj(a,b){a:{var c=b.S;var d=Gh(a,b);if(!d){b=b.S.length;for(var e=0;e<b;e+=3)if(Eh(a,c[e],c[e+1])){a=!0;break a}}a=d}return a}function Lj(a,b){return Hh(a,b)}
function Mj(a,b,c){for(var d=a.length;d--;){var e=a[d],f=e.V();if(B(f,Xe)){f=f.ha;for(var g=f.length,h;g--;)if(h=f[g],Eh(b,h.lat,h.lng)){c.push(e);break}}else Eh(b,f.lat,f.lng)&&c.push(e)}}
J.prototype.ab=function(a,b,c,d,e){var f=this,g=a.C(),h=[],k=Ed(),l=1;if(g)for(;l&Ee.ANY;){if(l&d)switch(l){case Ee.MARKER:k=k.then(function(){return Hj(f,g,c,b,!0)}).then(function(n){return Mj(n,a,h)});break;case Ee.DOM_MARKER:k=k.then(function(){return Ij(f,g,c,b,!0)}).then(function(n){return Mj(n,a,h)});break;case Ee.SPATIAL:k=k.then(function(){return Gj(f,f.xi,g,c,b,!0)}).then(function(n){n.forEach(Jj.bind(null,a,h))});break;case Ee.OVERLAY:k=k.then(function(){return Gj(f,f.sk,g,c,b,!0)}).then(function(n){n.forEach(Jj.bind(null,
a,h))})}l<<=1}k.then(function(){return e(h)})};J.prototype.Of=function(a,b,c){c=c||qe;var d=c.zoom,e=c.visiblesOnly;c=c.types;var f=Ee.ANY;B(a,P,this.Of,0,"area");db(b,"Function",this.Of,1,"callback");db(d,"Number",this.Of,2,"options");this.ab(a,ab(e)?!!e:!0,d,ab(c)?c&f:f,b)};J.prototype.getObjectsWithin=J.prototype.Of;J.prototype.disposeInternal=function(){J.g.disposeInternal.call(this);this.Ag.ia()};function Nj(a,b,c,d){Nj.g.constructor.call(this,a,b,c);this.modifiers=d}u(Nj,kg);t("H.map.ChangeEvent",Nj);var Oj={SIZE:1,POSITION:2,HEADING:4,TILT:8,INCLINE:16,ZOOM:32,BOUNDS:64};Nj.Type=Oj;Nj.prototype.jy=Oj.SIZE;Nj.prototype.SIZE=Nj.prototype.jy;Nj.prototype.Qs=Oj.POSITION;Nj.prototype.POSITION=Nj.prototype.Qs;Nj.prototype.Is=Oj.HEADING;Nj.prototype.HEADING=Nj.prototype.Is;Nj.prototype.Ts=Oj.TILT;Nj.prototype.TILT=Nj.prototype.Ts;Nj.prototype.Js=Oj.INCLINE;Nj.prototype.INCLINE=Nj.prototype.Js;
Nj.prototype.Us=Oj.ZOOM;Nj.prototype.ZOOM=Nj.prototype.Us;Nj.prototype.Cs=Oj.BOUNDS;Nj.prototype.BOUNDS=Nj.prototype.Cs;function Pj(a,b){b=b||{};var c;if(!B(a,Element))throw new C(Pj,0,a);var d=a.ownerDocument.createElement("div");this.G=a;Pj.g.constructor.call(this);this.padding=new bf(0,0,0,0);this.center=new L(0,0);this.margin=0;this.element=d;d.style.zIndex=0;d.style.height=d.style.width="100%";d.style.direction="ltr";d.style.position="relative"===a.style.position?"absolute":"relative";this.resize();a.appendChild(d);(c=b.padding)!==A&&this.Vr(c.top,c.right,c.bottom,c.left);this.Qr((c=b.margin)!==A?c:0)}u(Pj,G);
t("H.map.ViewPort",Pj);Pj.prototype.j={Ca:"update",Pi:"sync"};Pj.prototype.Qr=function(a){if(this.margin!==+a){if(E(this.margin=+a))throw new C(this.Qr,0,a);this.Ce();this.dispatchEvent(this.j.Ca)}};Pj.prototype.setMargin=Pj.prototype.Qr;Pj.prototype.Vr=function(a,b,c,d){var e=this.padding;if(e.top!==a||e.right!==b||e.bottom!==c||e.left!==d){if(E(a+b+c+d))throw new C(this.Vr);e.top=a;e.right=b;e.bottom=c;e.left=d;this.Ce();this.dispatchEvent(this.j.Ca)}};Pj.prototype.setPadding=Pj.prototype.Vr;
Pj.prototype.Ce=function(){var a=this.padding;this.center.set((this.width+a.left-a.right)/2<<0,(this.height+a.top-a.bottom)/2<<0)};Pj.prototype.resize=function(){var a=this.G.offsetWidth,b=this.G.offsetHeight;if(this.width!==a||this.height!==b)this.WB=new Ue(this.width,this.height),this.width=a,this.height=b,this.Ce(),this.dispatchEvent(this.j.Ca)};Pj.prototype.resize=Pj.prototype.resize;Pj.prototype.pb=function(a){this.dispatchEvent(new Nj(this.j.Pi,this.WB,a,Oj.SIZE))};
Pj.prototype.synchronize=Pj.prototype.pb;Pj.prototype.disposeInternal=function(){this.G.removeChild(this.element);delete this.G;delete this.element;Pj.g.disposeInternal.call(this)};Pj.prototype.Hd=ub;Pj.prototype.startInteraction=Pj.prototype.Hd;Pj.prototype.ud=ub;Pj.prototype.interaction=Pj.prototype.ud;Pj.prototype.hc=ub;Pj.prototype.endInteraction=Pj.prototype.hc;function Qj(){}t("H.util.ICapturable",Qj);Qj.prototype.capture=function(){};Qj.prototype.capture=Qj.prototype.capture;function Rj(a,b){var c=a.B(),d=c.ownerDocument;Rj.g.constructor.call(this);this.s=a;this.G=c=c.appendChild(Sj(d,"DIV","position:absolute;bottom:0;right:0;left:0px;z-index:1;direction:ltr;pointer-events:none;height:40px-webkit-touch-callout: none;-webkit-user-select:none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select:none;",null,"H_imprint"));this.Hl=Sj(d,"DIV","margin: 0 0 16px 16px;display:inline-block;",'<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>',
"H_logo");c.appendChild(this.Hl);c=c.appendChild(Sj(d,"DIV","right:0;bottom:0;position:absolute;background-color:rgba(255,255,255,.8);color:#0F1621;padding:2px 16px",null,"H_copyright"));this.jo=c.appendChild(Sj(d,"A","color:inherit; margin:0px 8px; text-decoration:none; pointer-events:all;","Terms of use"));this.jo.target="_blank";this.jo.tabIndex=1;this.Vl=c.appendChild(Sj(d,"SPAN","margin:0px 8px"));this.cg=c.appendChild(Sj(d,"SPAN"));this.bv=Na(Tj);this.Ur(b);this.Di=z(this.Di,this);
this.fe=z(this.fe,this);this.s.addEventListener(this.s.j.Ms,this.Di);this.s.O.addEventListener("add",this.fe);this.s.O.addEventListener("remove",this.fe);this.s.O.addEventListener("set",this.fe);this.fe()}var Uj;u(Rj,yb);t("H.map.Imprint",Rj);var Tj={font:'11px "Lucida Grande", Arial, Helvetica, sans-serif',href:"https://legal.here.com/{LN}/terms/serviceterms/{CN}",invert:!1,reportHref:"https://wego.here.com/",locale:"en-US",mark:""};
Rj.prototype.Ur=function(a){var b,c=this.Hl.firstElementChild.firstElementChild.children;a||(this.bv=Na(Tj));var d=this.bv;for(b in d)a&&b in a&&(d[b]=a[b]);a=(this.nq=a=d.invert)?Vj:Wj;c[0].style.fill=a.gx;c[0].style.fillOpacity=""+a.hx;c[1].style.fill=a.ux;c[1].style.fillOpacity=""+a.vx;a=d.locale;Xj[a]||(a="en-US",d.locale=a);this.jo.innerHTML=Xj[a];a=a.split("-");this.jo.href=d.href.replace("{LN}",a[0]).replace("{CN}",a[1].toLowerCase());d.mark?(this.cg.innerHTML=d.mark,this.cg.style.margin="0px 8px"):
(this.cg.innerHTML="",this.cg.style.margin="0px");this.G.style.font=d.font};Rj.prototype.setOptions=Rj.prototype.Ur;function Sj(a,b,c,d,e){a=a.createElement(b);c&&(a.style.cssText=c);d&&(a.innerHTML=d);e&&(a.className=e);return a}Rj.prototype.B=function(){return this.G};Rj.prototype.Di=function(){this.Vl.innerHTML=this.Es+" "+this.U()};Rj.prototype.fe=function(){this.Di();setTimeout(this.Di,5E3)};
var Wj={ux:"#0F1621",vx:.3,gx:"#fff",hx:.6},Vj={ux:"#fff",vx:1,gx:"#0F1621",hx:.7},Yj="1987&ndash;"+Ac(2015,(new Date).getFullYear())+" HERE";Rj.prototype.U=function(){var a=this.s,b=a.Tb(),c=a.va.Hb().bounds;a=a.O;var d=a.aa.length,e={},f=0,g,h,k,l=[Yj];if(c)for(;f<d;f++)if(h=a.get(f).getCopyrights(c.C(),b))for(g=0;g<h.length;g++)e[k=h[g].label]||(l.push(k),e[k]=1);return l.join(", ")};Rj.prototype.getCopyrights=Rj.prototype.U;Rj.prototype.K=function(){return this.G.style};Rj.prototype.Es=String.fromCharCode(169);
Rj.prototype.disposeInternal=function(){this.s.removeEventListener(this.s.j.Ms,this.Di);this.s.O.removeEventListener("add",this.fe);this.s.O.removeEventListener("remove",this.fe);this.s.O.removeEventListener("set",this.fe);if(this.G.parentNode){var a=this.G;a.parentNode.removeChild(a)}};Rj.prototype.disposeInternal=Rj.prototype.disposeInternal;
Rj.prototype.capture=function(a,b,c,d){var e=a.getContext("2d"),f=window.getComputedStyle(this.Vl.parentElement),g=2*hb(f.paddingLeft,10),h=(this.Vl.offsetWidth+2*g)*b,k=this.Vl.offsetHeight*b,l=0!==this.cg.innerHTML.length?this.cg.offsetWidth*b:0,n=ib(f.getPropertyValue("font-size")),p=this.G.ownerDocument,q=+a.width,r=+a.height,v=16*b,w=this.Hl.childNodes[0].getBoundingClientRect(),y=w.width*b,D=w.height*b,F=oe;Za(d)&&(F=function(){d("capture_error")});e.fillStyle=f.backgroundColor;e.fillRect(q-
h-l,r-k,h+l,k);h=this.cg.innerHTML;h=this.Es+" "+function(O){O=Sj(p,"div",null,O);return O.textContent||O.innerText||""}(this.U())+(h?" "+h:"");e.font=n*b+"px "+f.getPropertyValue("font-family");e.fillStyle=f.getPropertyValue("color");e.textBaseline="bottom";e.textAlign="right";e.fillText(h,q-g*b,r);Zj(this,e.font,function(O){(new Qf("image",O)).then(function(R){e.drawImage(R,v,r-(D+v),y,D);c(a)},F)},F)};Rj.prototype.capture=Rj.prototype.capture;
function Zj(a,b,c,d){ak(z(function(e){e?this.nq?c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAADNklEQVRYR82XW6hVVRSGv7+rmJfSMKSnSkMEfY7EogcJC7tilGRopBAiSaI+SBARQSCIIqgFISih2YW0oAgLCsKXojA0RB+81VugZEFZv/yHuWTt7d7Hfc4+6+h4OWefNfcc3xlj/v+YS1zjoab5bE8DZgGngB8keSg5GwO0PQ54F3i2BnQIWCLpx14hGwG0fT3wOfBwB5DzwOOSDvQC2RTgM8Ae4D/gaeA3YDdwN5AWvyxp+6gD2r4OmAq8AbwInAMmA/OAT4CbgBWStvYClzUjWkHbrwHLgF8LVHJ8DDxah7P9JHCil7M40oA/A7OBC8ANtSqlrQOVs30/8CWQat8r6cxg1RwRQNvPA88Bk4D7gJzBV4A5teSp5MlS4VuA/ZIeu1Kr+wa0/QTwIRDlRhT5eTswBvi2CKOd42AULilndNAYCcA7gK+BmbVMiyXtsh3Qt4FFBTgW8w6wXtLfV4LrSyS2FwAvAWOBX+JtwF0laUDmS/oun23fDNwJnJb0Ty9g1ZphVdB2qrK2LdFfBbb685/AIxXkUKDqa4cMaDs2kjalRe8Fola57J3qRQSJviGHA3gMuAdYI2lDUfDOArQLWAd8VTuTOW9vjUoFy6TIGYpS9wKfAjuK5wVuSfn91iKcvZJeHy5ci0hsZwzNk5Qh3xIFbLyks7aPAtPLgv+L4VZwDwLvA6uKz6XdfcVAi22PBz4q4+lVSRurXW2vKYKIZfwEHCmmXC35HngAyITYD0ys2t8XWflyBfhmvKm24QCk7aVFCPVc7WMszzKucknI+NoHPCUppt13VICZm2nNwjoksByY0SXL72Vi3FieZ97mgrpyqF432H9xScW2O0H+W6oSE/4D2FYuA9kzlUzVTwO3Ad9IOtx3ydo2aLGZLpABm5KW2Z4AfAbMLfsEcpGkKLqRuMwHu0CukrSpCCrvGlF6hBEVL5MUw24kOhp1B8gc+FTqgxpkFLuzSbjk6jpJOkC2tDPeKCkVbDRkO67fDTTC2VK7vgfyBUlfNEpV2zyAK4HNXRLmZfshScdHC6g9T+WDGU2XpkdZdNXhWs6g7dXAhmsJ7jKR2M77bG4kV7Wt9TZfBLgYEC7PSpcIAAAAAElFTkSuQmCC"):c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIMSURBVFiFzdZPiE1RGADwXzPTTPIMQoodVpbKgpoUG5qExUi8DSVJQv4slJJsbNjYWFhNETWLUUosRDRLUVLCYhIiojFojHkW997uvefNGIuZc99Xp/fOO6/Or++c75xDi0d7hDlWYQNqeB9hvv+OGq6jUWjPsKZKVBbtuKOMy9p3bKqOlsROCWYc27AWr9PfJnCgKlgbluNqivmGDmzBrxR3sCocnMEw7sqXdEAzboeK9uLTFPVbed8VcesxglFJtqNEHbcxlIL68ChADuCSpEgauBULt11SDI3C5yJJdrLCCNsQumMBl+J5AKinY4slBfNTfsRcxJwYsK0YxD3J0r1RPut6Cv/twgp0xoDBBc3LNhr0RwJktNifAn7gsnLmsuxVinyVTn4i7dcLoH4sU96Tp2Pi2uSVehN75Gdev+QO7pIXztmZnLwTvf+AzU+/v5Rn50+A24gP2IW5M4mbJ7+ejgVjJ/EpHXuCa8p77nGK68FX5eWfsTgfTJoh92qu1vAaa+CtPJuDZuEh3CHZUyHyxSSYrL3DWKE/gStm8aybDDkmKYperJM/BrJMnsJuHMLq2YJNh/wsX7JuPAyQfTFg0yGPFMZreCCv4n2xgTQjxyXP+CxquK8iXBYhMlzOtliQBVg4RVuCG/iSto/YHAuWxWFTHyXDWBkbNFkc1cK4LI5rYVwW57QY7i/pZeJv8QQJRQAAAABJRU5ErkJggg=="):
(e=this.Hl.cloneNode(!0),e.firstChild.setAttribute("style","font:"+b),c(ie(e.innerHTML)))},a),d)}Rj.prototype.nq=!1;
function ak(a,b){var c="data:image/svg+xml;charset=utf-8,"+encodeURIComponent('<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>'),d=
Uj;ab(d)?a(d):(new Qf("image",c)).then(function(e){ee.drawImage(e,0,0);try{ee.getImageData(0,0,1,1),d=!1}catch(f){d=18===f.code}finally{Uj=d,a(d)}},b)}Rj.prototype.ny=function(a,b){Xj[a]=b};Rj.prototype.addL11NString=Rj.prototype.ny;
var Xj={"de-DE":"Nutzungsbedingungen","en-US":"Terms of use","en-GB":"Terms of use","es-ES":"Condiciones de uso","fi-FI":"Palveluehdot","fr-FR":"Conditions d'utilisation","it-IT":"Condizioni di utilizzo","nl-NL":"Dienstvoorwaarden","pl-PL":"Warunki \u015bwiadczenia us\u0142ugi","pt-BR":"Termos de servi\u00e7o","pt-PT":"Termos do servi\u00e7o","ru-RU":"\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f","tr-TR":"Servis Ko\u015fullar\u0131",
"zh-CN":"\u4f7f\u7528\u6761\u6b3e"};function bk(){this.constructor=this.constructor;if(!gb("STATIC_DB"))throw new C(this.constructor,0);this.Iu=ck();if(!this.Iu)throw new vb(this.constructor,"This browser does not support IndexedDB");this.RB="STATIC_DB";this.gf=[];this.Xh=[];this.$q=z(this.$q,this)}var dk,ek;m=bk.prototype;m.put=function(a,b,c,d){if(!gb(a)&&!jb(a))throw new C(this.put,0);if(!fk(b))throw new C(this.put,1);gk(this,function(e){hk(e.put(b,a),c,d)},d)};
m.get=function(a,b,c){var d;if(!gb(a)&&!jb(a))throw new C(this.get,0);if(!Za(b))throw new C(this.get,1);gk(this,function(e){d=e.get(a);hk(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=oe)}}};m.remove=function(a,b,c){if(!gb(a)&&!jb(a))throw new C(this.remove,0);gk(this,function(d){hk(d["delete"](a),b,c)},c)};m.clear=function(a,b){gk(this,function(c){hk(c.clear(),a,b)},b)};m.zl="data";m.Yx=500;m.$q=function(){var a=this.ng.result;a.objectStoreNames.contains(this.zl)||a.createObjectStore(this.zl)};
function ik(a,b,c){if(a.ng)a.gf?(a.gf.push(b),c&&a.Xh.push(c)):a.rn?c&&c(a.rn):b(a.ng.result);else{a.ng=a.Iu.open("H_"+a.RB,1);a.ng.onupgradeneeded=a.$q;var d=a.ng.onerror=function(){clearTimeout(a.Zv);a.rn=this.error;a.Xh.forEach(function(e){e(a.rn)});delete a.gf;delete a.Xh};a.Zv=setTimeout(function(){d.call({error:Error("DbOpenTimeoutError")})},a.Yx);a.ng.onsuccess=function(){clearTimeout(a.Zv);a.gf?(a.gf.forEach(function(e){e(this.result)},this),delete a.gf,delete a.Xh):(delete a.ng,delete a.rn,
a.gf=[],a.Xh=[])};a.gf.push(b);c&&a.Xh.push(c)}}function gk(a,b,c){ik(a,function(d){d=d.transaction([a.zl],"readwrite");b(d.objectStore(a.zl))},c)}function hk(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}function fk(a){var b=Object.prototype.toString.call(a);return"[object Blob]"===b||"[object ArrayBuffer]"===b||gb(a)||ya(a)}function jk(){dk||(dk=new bk);return dk}t("H.util.IndexedDBStorage.getInstance",jk);
function ck(){return globalThis.indexedDB||globalThis.webkitIndexedDB||globalThis.mozIndexedDB||globalThis.msIndexedDB}function kk(){var a="";if(!ab(ek))if("file:"===window.location.protocol&&mc&&128<=window.location.href.length)ek=!1;else{try{var b=ck();a="H_TEST_DB";var c=b&&b.open(a,1)}catch(d){}ek=!!c&&null===c.onupgradeneeded;c&&b.deleteDatabase&&b.deleteDatabase(a)}return ek}t("H.util.IndexedDBStorage.isSupported",kk);function lk(a,b){Za(a)&&(this.Yv=a);jb(b)&&(this.nl=b)}t("H.util.Request",lk);lk.State={PENDING:0,PROCESSING:1,COMPLETE:2,CANCELLED:3,ERROR:4};var mk=[0,1,2,3,4];lk.prototype.o=0;lk.prototype.getState=function(){return this.o};lk.prototype.getState=lk.prototype.getState;lk.prototype.F=function(a){if(0>mk.indexOf(a))throw new C(this.F,0,a);if(this.o!==a||1===a&&1<this.nl)this.o=a,this.Yv&&this.Yv(this)};lk.prototype.nl=1;lk.prototype.PA=function(){return this.nl};lk.prototype.getTotal=lk.prototype.PA;
lk.prototype.Dn=0;lk.prototype.AA=function(){return this.Dn};lk.prototype.getProcessed=lk.prototype.AA;lk.prototype.Tt=0;lk.prototype.Uz=function(){return this.Tt};lk.prototype.getFailed=lk.prototype.Uz;function nk(a,b){a.Dn<a.nl&&(ab(b)||(b=2),0===b||1===b||0!==a.o&&1!==a.o||(a.Dn++,2!==b&&a.Tt++,a.F(a.Dn<a.nl?1:2)))}lk.prototype.Xi=function(){};lk.prototype.cancel=function(){3!==this.o&&(this.Xi(),this.F(3))};lk.prototype.cancel=lk.prototype.cancel;function ok(){this.aa=[];ok.g.constructor.call(this)}u(ok,G);t("H.util.OList",ok);function pk(a,b,c){a=a.aa.length;if(c)var d=a;else if(E(d=0>(d=+b)?Ac(0,a+d):yc(a,d)))throw new Zd(ok,b,[0,a-1]);return d}ok.prototype.Do=function(a,b){this.aa.splice(b,0,a);this.dispatchEvent(new qk(this,this.j.Ki,b,a,null,null))};ok.prototype.add=function(a,b){this.Do(a,pk(this,b,E(b)))};ok.prototype.add=ok.prototype.add;
ok.prototype.nf=function(a){var b=this.aa.splice(a,1)[0];this.dispatchEvent(new qk(this,this.j.Mi,a,null,b,null));return b};ok.prototype.Cd=function(a){this.get(a);return this.nf(a)};ok.prototype.removeAt=ok.prototype.Cd;ok.prototype.remove=function(a){a=this.indexOf(a);return 0<=a?(this.nf(a),!0):!1};ok.prototype.remove=ok.prototype.remove;
ok.prototype.set=function(a,b){if(0!==this.aa.length||0!==a){this.get(a);a=pk(this,a,!1);var c=this.aa[a]}this.aa[a]=b;this.dispatchEvent(new qk(this,this.j.Ni,a,b,c,null));return c};ok.prototype.set=ok.prototype.set;ok.prototype.indexOf=function(a){return this.aa.indexOf(a)};ok.prototype.indexOf=ok.prototype.indexOf;ok.prototype.get=function(a){var b=pk(this,a,!1),c=this.aa;if(b>=c.length)throw new Zd(this.get,a,[0,c.length-1]);return c[b]};ok.prototype.get=ok.prototype.get;ok.prototype.jA=function(){return this.aa.length};
ok.prototype.getLength=ok.prototype.jA;ok.prototype.Sa=function(){return[].concat(this.aa)};ok.prototype.asArray=ok.prototype.Sa;ok.prototype.flush=function(){for(var a=this.aa.length;a--;)this.nf(a)};ok.prototype.flush=ok.prototype.flush;ok.prototype.disposeInternal=function(){this.flush();ok.g.disposeInternal.call(this)};ok.prototype.j={Ki:"add",Mi:"remove",Ni:"set",WD:"move"};function qk(a,b,c,d,e,f){qk.g.constructor.call(this,b,a);this.idx=c;this.added=d;this.removed=e;this.moved=f}u(qk,Jb);
ok.Event=qk;function rk(a){var b;rk.g.constructor.call(this);this.dispatchEvent=z(this.dispatchEvent,this);if(a){var c=a.length;for(b=0;b<c;b++)this.add(a[b])}}u(rk,ok);t("H.map.DataModel",rk);function sk(a,b){var c=b.getProvider&&b.getProvider();c&&(tk[c.uid]=c);b.ea(a)}function uk(a){var b=a.getProvider&&a.getProvider();b&&delete tk[b.uid];a.ea(null)}rk.prototype.add=function(a,b){B(a,vg,this.add,0);sk(this,a);rk.g.add.call(this,a,b)};rk.prototype.add=rk.prototype.add;
rk.prototype.set=function(a,b){B(b,vg,this.set,0);sk(this,b);(a=rk.g.set.call(this,a,b))&&uk(a);return a};rk.prototype.set=rk.prototype.set;rk.prototype.Cd=function(a){var b;(b=rk.g.Cd.call(this,a))&&uk(b);return b};rk.prototype.removeAt=rk.prototype.Cd;rk.prototype.remove=function(a){var b;(b=rk.g.remove.call(this,a))&&uk(a);return b};rk.prototype.remove=rk.prototype.remove;rk.prototype.flush=function(){for(var a=this.aa.length;a--;)this.Cd(a);rk.g.flush.call(this)};rk.prototype.flush=rk.prototype.flush;
var tk={};mb(tk);function vk(a,b,c){if(a=tk[a])return B(a[b],Function,vk,1,"invalid method"),a[b].apply(a,c)}rk.invoke=vk;function T(a){bb(this,T);T.g.constructor.call(this,a);this.uD=new wk;this.bc=z(this.bc,this);this.ht=xk;this.createTileInternal=this.nd.bind(this)}u(T,Fi);t("H.map.provider.RemoteTileProvider",T);T.prototype.Rz=function(){return 1};T.prototype.getEntryWeight=T.prototype.Rz;var xk,yk=screen.width,zk=screen.height,Ak=ae();Ak=Ac(Ak,1);var Bk=Dc(yk*Ak*zk*Ak/1E6);xk=new bj(Hc(2,Ac(8,yc(12,7+Bk))));var Ck={},Dk={};T.prototype.Rb=function(){return this.ht};T.prototype.getCache=T.prototype.Rb;
T.prototype.$n=ca(3);T.prototype.bc=function(a){var b=this.uri;return!a.indexOf(b)&&"_"===a.charAt(b.length)};T.prototype.cacheFilter=T.prototype.bc;T.prototype.hB=function(a,b){b.valid=!1};T.prototype.reload=function(a){var b=this.getCache();a?b.ia(this.bc):b.forEach(this.hB,this,this.bc);Ek(this);this.hb(this,{isReload:!0})};T.prototype.reload=T.prototype.reload;T.prototype.Wi=function(){return!1};T.prototype.MAX_STORE_TIME=Infinity;T.prototype.rd=function(){return this.uD};
T.prototype.uw=function(a,b){b(a)};function Fk(a,b,c,d,e,f){d=~~d;return a.requestInternal(b,c,d,function(g,h){a.rd().put(a.Td(b,c,d),{raw:h&&h.raw||g,timestamp:globalThis.Date.now()},e,f)},f,0)}T.prototype.requestInternal=T.prototype.u;
T.prototype.Pa=function(a,b,c,d){var e=this;var f=this.getCache();if(E(a=+a))throw new C(this.Pa,0,a);if(E(b=+b))throw new C(this.Pa,0,b);if(E(c=+c))throw new C(this.Pa,0,c);c=~~c;var g=this.getTileKey(a,b,c);f=f.get(g);f&&f.valid||d||Ck[g]||(f=A,this.requestTileAsPromise(a,b,c,d).then(function(h){e.hb(h)},oe));return f};T.prototype.requestTile=T.prototype.Pa;
T.prototype.Mw=function(a,b,c,d){var e=this,f=this.getCache(),g=this.getTileKey(a,b,c),h,k,l=this.rd();if(Dk[g])return Dk[g];Dk[g]=h=new wd(function(n,p){function q(r){var v=0,w;var y=function(D,F){w=e.createTileInternal(a,b,c,D,F);w.key=g;f.add(g,w,1);n(w);Gk(g)};r&&(v=globalThis.Date.now()-r.timestamp);r&&v<e.MAX_STORE_TIME?e.uw(r.raw,y):(0<v&&l.remove(g),(w=f.get(g))&&w.valid||d?n(w||null):Ck[g]=e.requestInternal(a,b,c,y,p))}k=l.get(g,q,q)});Ck[g]||(Ck[g]=k);h.then(function(){Gk(g)},function(){Gk(g)});
return h};T.prototype.requestTileAsPromise=T.prototype.Mw;T.prototype.Lw=function(a,b){var c=this,d=a.id,e=a.tile.coords;return new wd(function(f,g){c.Mw(e.x,e.y,e.z,b).then(function(h){var k=x;h=h.ab?h.ab():h.data;for(var l=h.length,n;l--;)if(n=h[l],n.wb()===d){k=n;break}f(k)},g)})};T.prototype.requestObjectAsPromise=T.prototype.Lw;function Gk(a){delete Ck[a];delete Dk[a]}function Ek(a){for(var b in Ck)a.bc(b)&&a.cancelTileByKey(b)}var Hk={cancel:oe};
T.prototype.nd=function(a,b,c,d){return new Hi(a,b,c,d)};T.prototype.createTileInternal=T.prototype.nd;T.prototype.Yi=function(a){var b=Ck[a];b&&(b.cancel(),Gk(a))};T.prototype.cancelTileByKey=T.prototype.Yi;T.prototype.Ld=function(a,b,c){this.cancelTileByKey(this.getTileKey(a,b,c))};T.prototype.cancelTile=T.prototype.Ld;T.prototype.disposeInternal=function(){T.g.disposeInternal.call(this);this.getCache().ia(this.bc);Ek(this)};function wk(){}T.NullStorage=wk;wk.prototype.get=function(a,b){b();return Hk};
wk.prototype.get=wk.prototype.get;wk.prototype.put=function(a,b,c){c&&c()};wk.prototype.put=wk.prototype.put;wk.prototype.clear=function(a){a&&a()};wk.prototype.clear=wk.prototype.clear;wk.prototype.remove=function(a,b){b&&b()};wk.prototype.remove=wk.prototype.remove;function Ik(){Ik.g.constructor.call(this);this.Rn={};this.ji={position:new Re(0,0),zoom:0,heading:180,incline:0,tilt:0,bounds:new P(xh([90,-180,90,0,90,180,-90,180,-90,-180]))};this.xu=!1}u(Ik,G);t("H.map.ViewModel",Ik);Ik.prototype.j={Ca:"update",Pi:"sync"};
Ik.prototype.$c=function(a,b,c){if(!a)throw new C(this.$c,0,a);var d=a[Jk];if(ab(d)&&!Se(d))throw new C(this.$c,0,Jk);var e=a[Kk];if((d=ab(e))&&E(+e))throw new C(this.$c,0,Kk);var f=a[Lk];if((e=ab(f))&&!B(f,Qe))throw new C(this.$c,0,Lk);a=Object.assign({},a);f=Mk(a,this.Rn,this.ji);Nk(this,this.Rn,a);this.xu||Nk(this,this.ji,a);this.dispatchEvent(new Ok(this.Rn,f,!!c&&!d&&e,b));return this};Ik.prototype.setLookAtData=Ik.prototype.$c;
Ik.prototype.Hb=function(){var a={};a[Jk]=Te(this.ji[Jk]);Nk(this,a,this.ji,!0);return a};Ik.prototype.getLookAtData=Ik.prototype.Hb;var Jk="position",Kk="zoom",Lk="bounds",Pk={Qs:Jk,Us:Kk,Is:"heading",Ts:"tilt",Js:"incline",Cs:Lk},Qk=Object.keys(Pk).map(function(a){return Pk[a]});
function Nk(a,b,c,d){a.Fv={};a.Ev={};a.ov=[];for(var e=a.iC,f=a.hC,g=Qk.length,h,k,l;g--;)if(h=Qk[g],l=c[h],k=b[h],null==k||!d)if(null!=l){if(ab(e)&&e.call(a,h,k,l),b[h]="position"!==h||l&&!E(l.lat)&&!E(l.lng)?l:Te(l),ab(f)){switch(h){case "position":k=l&&k&&(l.lat!==k.lat||l.lng!==k.lng);break;case "bounds":k=l&&k&&!l.da(k);break;default:k=l!==k}k&&f.call(a,h)}}else delete b[h]}Ik.prototype.iC=function(a,b,c){this.Fv[a]=b;this.Ev[a]=c};Ik.prototype.hC=function(a){this.ov.push(Rk[a])};
var Rk=Qk.reduce(function(a,b){a[b]=Oj[b.toUpperCase()];return a},{});function Mk(a,b,c){var d=0;["tilt","incline","heading",Kk].forEach(function(e){E(a[e])?a[e]=E(b[e])?c[e]:b[e]:d|=Rk[e]});[Jk,Lk].forEach(function(e){a[e]?d|=Rk[e]:a[e]=b[e]||c[e]});return d}Ik.prototype.pb=function(a){var b={},c={};this.xu=!0;Nk(this,this.ji,a);this.Rn={};b.lookAt=this.Ev;c.lookAt=this.Fv;a=this.ov;a=a.length?a.reduce(Sk):0;this.dispatchEvent(new Nj(this.j.Pi,b,c,a))};Ik.prototype.synchronize=Ik.prototype.pb;
function Sk(a,b){return a|b}Ik.prototype.Wk=function(a,b){if(E(a=+a))throw new C(this.Wk,0,Kk);this.$c({zoom:a},b)};Ik.prototype.Tb=function(){return this.ji.zoom};Ik.prototype.Gd=ub;Ik.prototype.startControl=Ik.prototype.Gd;Ik.prototype.control=ub;Ik.prototype.control=Ik.prototype.control;Ik.prototype.fc=ub;Ik.prototype.endControl=Ik.prototype.fc;
function Ok(a,b,c,d){Ok.g.constructor.call(this,Ik.prototype.j.Ca,a,null,b);this.Nu=this.integerZoom=!!c;this.animate=this.animate=jb(d)&&0<d&&Infinity>d?d:!!d}u(Ok,Nj);function Tk(a,b,c,d){var e=new bf(0,0,0,0);Tk.g.constructor.call(this);if(!a)throw new C(Tk,0,a);if(!b)throw new C(Tk,1,b);if(!c)throw new C(Tk,2,c);if("object"!==typeof d)throw new C(Tk,3,d+" is not an object");if("number"!==typeof d.pixelRatio)throw new C(Tk,3,d.pixelRatio+" is not a number");this.ja=d.pixelRatio;this.zoom=0;this.zb=Fc(this.ja)/Qc;this.pixelProjection=new sg;this.sl={1:e.clone(),2:e.clone(),4:e.clone()};this.wd=new L(.5,.5);this.Ba=a;Uk(this,this.ja);this.Hd=z(this.Hd,this);this.ud=
z(this.ud,this);this.hc=z(this.hc,this);a.startInteraction=this.Hd;a.interaction=this.ud;a.endInteraction=this.hc;a.addEventListener(a.j.Ca,this.mg,!1,this);this.getCapabilities=this.getCapabilities;this.capture=this.capture;this.zoomAt=this.Ng;this.relaunch=this.ba;this.dispose=this.l;this.screenToGeo=this.Va;this.geoToScreen=this.La;this.screenToLookAtData=this.Wn;this.De=b;this.Gd=z(this.Gd,this);this.control=z(this.control,this);this.fc=z(this.fc,this);b.startControl=this.Gd;b.control=this.control;
b.endControl=this.fc;b.addEventListener(b.j.Ca,this.ar,!1,this);this.gb=c;this.hn=z(this.hn,this);this.ig=z(this.ig,this);this.jg=z(this.jg,this);this.gn=z(this.gn,this);c.addEventListener(vg.prototype.j.Ca,this.hn,!1,this);c.addEventListener(c.j.Ki,this.ig,!1,this);c.addEventListener(c.j.Mi,this.jg,!1,this);c.addEventListener(c.j.Ni,this.gn,!1,this)}u(Tk,G);t("H.map.render.RenderEngine",Tk);Tk.prototype.Ng=function(){};
function Uk(a,b){var c=a.Ba,d=c.width,e=c.height,f=c.padding,g=f.top,h=f.left,k=f.bottom;f=f.right;c=c.margin;var l=-(d+h-f)/2<<0,n=-(e+g-k)/2<<0;d+=l;e+=n;a=a.sl;a[1].set((l-c)*b,(n-c)*b,(d+c)*b,(e+c)*b);a[2].set(l*b,n*b,d*b,e*b);a[4].set((l+h)*b,(n+g)*b,(d-f)*b,(e-k)*b)}Tk.prototype.mg=function(){Uk(this,this.ja)};
Tk.prototype.disposeInternal=function(){var a=this.Ba,b=this.De,c=this.gb;a.removeEventListener(a.j.Ca,this.mg,!1,this);a.startInteraction===this.Hd&&(a.startInteraction=Pj.prototype.Hd);a.interaction===this.ud&&(a.interaction=Pj.prototype.ud);a.endInteraction===this.hc&&(a.endInteraction=Pj.prototype.hc);b.removeEventListener(b.j.Ca,this.ar,!1,this);b.startControl===this.Gd&&(b.startControl=Ik.prototype.Gd);b.control===this.control&&(b.control=Ik.prototype.control);b.endControl===this.fc&&(b.endControl=
Ik.prototype.fc);c.removeEventListener(vg.prototype.j.Ca,this.hn,!1,this);c.removeEventListener(c.j.Ki,this.ig,!1,this);c.removeEventListener(c.j.Mi,this.jg,!1,this);c.removeEventListener(c.j.Ni,this.gn,!1,this)};Tk.prototype.Mr=function(a){this.Ho=a};Tk.prototype.setAnimationCallback=Tk.prototype.Mr;Tk.prototype.Dr=function(){this.Ho=void 0};Tk.prototype.resetAnimationCallback=Tk.prototype.Dr;Tk.prototype.control=function(){};Tk.prototype.capture=function(){return Fd(Error("not implemented"))};
function Vk(a,b){a.style.transition="opacity 1.5s";Yb(a,"transitionend",b,!1);a.style.opacity=0}var Wk={ZOOM:1,HEADING:2,TILT:4,INCLINE:8,COORD:16};Tk.InteractionModifiers=Wk;m=Tk.prototype;m.j={Ss:"render",Oi:"statechange"};m.qw=0;m.F=function(a){var b=this,c=this.qw;a^c&&(this.qw=a,setTimeout(function(){return b.dispatchEvent(new kg(b.j.Oi,c,a))}))};m.hn=function(a){this.Nv(a);this.ba()};m.ig=function(a){this.qk(a.idx,a.added)};m.jg=function(a){this.Uq(a.idx,a.removed,a.type===this.gb.j.Ni)};
m.gn=function(a){a.removed&&this.jg(a);this.ig(a)};m.Nv=oe;m.qk=function(a,b){this.gq(a,b);0===a&&this.zc();B(b,vg)&&Xk(this,b,!0);this.li();this.ba()};m.zc=function(){var a=this.gb.Sa();if(0<a.length){var b=a[0].max;this.zq=a[0].min;this.yq=b}else a=this.getCapabilities().lookAt.zoom,b=a.max,this.zq=a.min,this.yq=b;a=Yk(this,this.zoom);a!==this.zoom&&(this.zoom=a,this.pixelProjection.Ua(a),this.pb())};
m.pb=function(a){this.uf=this.Hb();a&&(this.uf.position=a);this.uf.zoom=this.zoom-this.zb;this.uf.position.alt=0};m.zx=0;m.heading=180;m.Hb=function(){return Zk(this,{position:this.pixelProjection.projection.yn(this.wd),zoom:this.zoom,tilt:this.zx,heading:this.heading})};function Zk(a,b){b.tilt=$k(a,b.tilt);b.heading=al(a,b.heading);b.incline=a.getCapabilities().lookAt.incline.min;return b}function Yk(a,b){var c=a.getCapabilities().lookAt.zoom;return cd(b,Ac(c.min,a.zq),yc(c.max,a.yq))}
function $k(a,b){a=a.getCapabilities().lookAt.tilt;return cd(b,a.min,a.max)}function al(a,b){a=a.getCapabilities().lookAt.heading;return cd((b%360+360)%360,a.min,a.max)}function Xk(a,b,c){c=c?b.addEventListener:b.removeEventListener;c.call(b,b.j.Os,a.Vq,!1,a);c.call(b,b.j.Ns,a.Vq,!1,a)}m.gq=oe;m.Uq=oe;m.eD=function(a,b){this.ef={before:a,after:b}};Tk.prototype.setOnRenderCallbacks=Tk.prototype.eD;var bl={P2D:0,WEBGL:1,HARP:2};Tk.EngineType=bl;var cl={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:Wk.ZOOM,COORD:Wk.COORD},capture:!0};t("H.map.render.webgl.capabilities",cl);function dl(a){return a}t("H.util.animation.ease.LINEAR",dl);t("H.util.animation.ease.EASE_IN_QUAD",function(a){return a*a});function el(a){return-a*(a-2)}t("H.util.animation.ease.EASE_OUT_QUAD",el);t("H.util.animation.ease.EASE_IN_OUT_QUINT",function(a){a*=2;return 1>a?Hc(a,5)/2:(a-=2,Hc(a,5)/2+1)});function fl(a){return 1-Math.sqrt(1-a*a)}function gl(a){return Gc(2*a-a*a)}t("H.util.animation.ease.EASE_OUT_CIRC",gl);function hl(a){return 1-Math.cos(a*Math.PI/2)}
function il(a){return Math.sin(a*Math.PI/2)};function jl(a,b){this.bg={tilt:kl(a.tilt,b.tilt),heading:kl(a.heading,b.heading),zoom:b.zoom-a.zoom};var c=this.ep=Te(a.position),d=b.position;a=d.lat*Wc;var e=c.lat*Wc;c=d.lng*Wc-c.lng*Wc;a=Math.atan2(Jc(c)*Mc(a),Mc(e)*Jc(a)-Jc(e)*Mc(a)*Mc(c));this.wy=(0<=a?a:Uc+a)*Xc;this.kh=this.ep.ib(b.position);b=this.bg.zoom;this.Dv=0===b?ll:Object.assign({},ll,{zoom:0>b?gl:fl,position:0>b?hl:il});this.fv=Object.assign({},{tilt:0,heading:0,zoom:0})}
function kl(a,b){a=b-a;return-180<a&&180>=a?a:180<a?a-360:a+360}var ll={tilt:dl,heading:dl,zoom:dl,position:dl};function ml(a){this.xb=a}u(ml,yb);ml.prototype.Sb=function(){return this.xb};ml.prototype.getLayer=ml.prototype.Sb;ml.prototype.KA=function(){return this.Ob};ml.prototype.getSurface=ml.prototype.KA;ml.prototype.sf=function(a){var b=this.Ob;a!==b&&(this.Ob=a,a.Un(),b&&b.release())};ml.prototype.setSurface=ml.prototype.sf;ml.prototype.disposeInternal=function(){this.Ob.release()};ml.prototype.disposeInternal=ml.prototype.disposeInternal;ml.prototype.Eh=function(){};ml.prototype.render=ml.prototype.L;function nl(a,b){nl.g.constructor.call(this,a);this.Od=!(!b||!b.Od);this.Hq={}}u(nl,ml);nl.prototype.sf=function(a){nl.g.sf.call(this,a);this.uC=a.ld.ownerDocument};nl.prototype.setSurface=nl.prototype.sf;var ol=function(a,b){b=b.V();return B(b,Ve)?b.ha:(a[0]=b,a)}.bind(null,[]);
nl.prototype.L=function(a,b,c,d,e,f,g){var h=this.xb,k,l,n,p;this.AC=b=this.Hq;this.Hq=c={};if(d>=h.min&&d<=h.max){var q=this.Vt(a,d,e,f);var r=q.markers;if(a=r.length){d=[];e=this.Ob;for(f=0;f<a;f++){h=r[f];var v=ol(h);for(k=v.length;k--;)if(l=g(v[k]))(p=b[n=h.wb()+"_"+k])?delete b[n]:p={tv:h},c[n]=p,d.push([p,h,h.jc(),e,l.x,l.y])}d.sort(pl);a=d.length;for(f=0;f<a;f++)this.Jw.apply(this,d[f])}}return!q||q.requested&&q.requested===q.total||!q.requested&&r.length===q.total?Ai.DONE:Ai.PENDING};
nl.prototype.render=nl.prototype.L;function pl(a,b){var c=a[1].Ve(),d=b[1].Ve();return Fe(c,d,!0)||a[5]-b[5]||Fe(c,d,!1)}nl.prototype.Ma=function(){};nl.prototype.getObjectsAt=nl.prototype.Ma;function ql(a,b){ql.g.constructor.apply(this,arguments);this.Gq=0;this.Sh=[];this.tp=z(this.tp,this)}u(ql,nl);t("H.map.render.dom.MarkerRenderer",ql);ql.prototype.Vt=function(){return this.xb.oe.apply(this.xb,arguments)};ql.prototype.L=function(a,b,c,d,e,f,g){this.tp();this.SB=0;var h=ql.g.L.apply(this,arguments);var k=this.Ob,l=this.AC,n;for(n in l)rl(this,k,l[n]);return 0===this.Sh.length&&h?Ai.DONE:Ai.PENDING};ql.prototype.render=ql.prototype.L;
ql.prototype.sf=function(a){ql.g.sf.call(this,a);this.na=a.jb()};ql.prototype.setSurface=ql.prototype.sf;ql.prototype.tp=function(){for(var a=this.Sh.length,b,c,d;a--;)d=this.Sh[a],b=d.wo,c=b.jc(),c.Oq(d,c,b);this.Sh.length=0};
ql.prototype.Jw=function(a,b,c,d,e,f){var g;var h=d.jb();var k=b.Mc();e*=h;f*=h;this.Od||(e=Bc(e),f=Bc(f));a.detail&&(k.Kh(a.gB)?rl(this,d,a):g=a.detail);g||(a.detail=g=c.cu(this.uC),this.Gq++,Za(c.Oq)&&this.Sh.push(g));a.gB=k.Kd;g.style.zIndex=this.SB++;g.wo=b;d.Qe(g,e,f,0,0)};var sl,tl="pointer-events",ul;if(ge){var vl;ge&&kc!==x&&(kc=(vl=/(MSIE\s+|rv:)([^\);]+)(\)|;)/.exec(navigator.userAgent))?+vl[2]:x);ul=kc;9===ul?tl="display":10===ul&&(tl="visibility")}sl=tl;
ql.prototype.Ma=function(a,b,c){var d=this.na,e=pe,f,g,h,k,l;if(this.Gq){a/=d;b/=d;d=this.Ob.ld.getRootNode();var n=d.documentElement;var p=this.Ob.B();var q=p.getBoundingClientRect();a+=q.left;for(b+=q.top;(g=h=d.elementFromPoint(a,b))&&g!==p&&g!==n&&g!==d.host&&h!==r;){for(;(k=g.parentNode)&&(!Za(k.contains)||!k.contains(p));)g=k;if(k===p&&(g!==h||"svg"!==g.nodeName)&&0>e.indexOf(l=g.wo)&&(e===pe&&(e=[]),e.push(l),c))break;f||(f=[]);var r=g.style;f.push({ut:r.getPropertyValue(sl),bB:r.getPropertyPriority(sl),
style:r});r.setProperty(sl,"visibility"===sl?"hidden":"none","important");r=h}if(f)for(b=f.length;b--;)a=f[b],a.style.removeProperty(sl),gb(a.ut)&&a.style.setProperty(sl,a.ut,a.bB)}return e};ql.prototype.getObjectsAt=ql.prototype.Ma;ql.prototype.Eh=function(){return"dom"};function rl(a,b,c){b.clear(b=c.detail);delete b.wo;a.Gq--;c=(a=c.tv).jc();c.Sq&&c.Sq(b,c,a)}ql.prototype.disposeInternal=function(){this.Sh.length=0;var a=this.Ob,b=this.Hq,c;for(c in b)rl(this,a,b[c]);this.Ob.l();ql.g.disposeInternal.call(this)};
ql.prototype.disposeInternal=ql.prototype.disposeInternal;function wl(a){wl.g.constructor.call(this,a);a&&(this.Hk={crossOrigin:a.crossOrigin||"anonymous",headers:a.headers||{}},this.Wp=a.getURL);if(xl(this)){var b=a&&a.style&&a.style instanceof H.map.render.harp.Style?a.style:new H.map.render.harp.Style({styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]});this.Wa(b)}if(!Za(this.Wp))throw new C(wl,0,"getURL");this.Eg(a.opacity);this.Al=globalThis.URL||globalThis.webkitURL;a=this.Hk.crossOrigin;if(!(a="anonymous"===a||"use-credentials"===a)){a=this.Wp(0,
0,0);b=window.location;var c=document.createElement("a");c.href=a;a=c.hostname===b.hostname&&c.port===b.port&&c.protocol===b.protocol}(this.ix=a&&!!Rf.arraybuffer&&!!this.Al)&&this.Rb().fi(z(this.je,this))}u(wl,T);t("H.map.provider.ImageTileProvider",wl);function xl(a){return!!H.map.render.harp&&a.ub===mg.HARP}wl.prototype.Dd=function(a){this.Eg(a)};wl.prototype.setOpacity=wl.prototype.Dd;wl.prototype.Ue=function(){return this.Rc};wl.prototype.getOpacity=wl.prototype.Ue;wl.prototype.Ak=me;
wl.prototype.providesRasters=wl.prototype.Ak;
wl.prototype.u=function(a,b,c,d,e,f){var g=this,h=this.Wp(a,b,c),k;a=Hk;if(h){var l=globalThis.setTimeout(function(){g.ix?(k=new Qf("arraybuffer",h,f,g.Hk),k.then(function(n){return n.blob()}).then(function(n){var p=new Image;p.onload=z(d,null,p,{raw:n});p.onerror=z(e,null,"bad url");try{p.src=g.Al.createObjectURL(n)}catch(q){}},e)):(k=new Qf("image",h,f,g.Hk),k.then(d,e))},150);a={cancel:function(){k?k.cancel():globalThis.clearTimeout(l)}}}else d(null);return a};wl.prototype.requestInternal=wl.prototype.u;
wl.prototype.uw=function(a,b){var c=new Image;c.onload=function(){b(this)};c.src=this.Al.createObjectURL(a)};wl.prototype.je=function(a,b){(a=b.data)&&a instanceof HTMLImageElement&&this.Al.revokeObjectURL(a.src)};wl.prototype.K=function(){return this.kb()};wl.prototype.getStyle=wl.prototype.K;wl.prototype.Bb=function(a){xl(this)&&a instanceof H.map.render.harp.Style&&this.Wa(a)};wl.prototype.setStyle=wl.prototype.Bb;function yl(a){var b,c=this,d=globalThis.H.gl;yl.g.constructor.call(this);this.m=b=d.Scene.create(globalThis.URL.createObjectURL(we(JSON.stringify(zl))),{viewport:a.viewport,container:a.ld,disableRenderLoop:!0,devicePixelRatio:a.devicePixelRatio,logLevel:"error"});a.gC&&b.subscribe({load:a.gC});b.subscribe({view_complete:function(){c.Jr=!0;a.Pv()}});var e=b.requestRedraw;b.requestRedraw=function(){e.apply(b);a.Pv()};this.Kr=z(this.Kr,this);this.Mn=z(this.Mn,this);this.qs=0;this.Rh={};this.Fd={}}
u(yl,yb);m=yl.prototype;m.Jr=!1;function Al(a){a=a.m.sources;var b;for(b in a){var c=a[b];if(c.hasPendingCommands&&c.hasPendingCommands())return!0}return globalThis.H.gl.Task.hasPendingTasks()}m.L=function(){var a=globalThis.H.gl.Task;this.m.immediateRedraw();a.setState({user_moving_view:this.m.view.user_input_active});a.processAll();return this.Jr&&!this.m.dirty&&!this.m.building&&!Al(this)&&!Object.keys(this.Fd).length};function Bl(a){a.Jr=!1;a.m.resetViewComplete()}
function Cl(a){return a.m.view}
function Dl(a,b){function c(){var e=b.Sa(),f={},g={},h,k,l,n=++a.qs,p,q;mf(g,zl);for(k=0;k<e.length;k++){var r=e[k];if(h=r.D){var v=h.kb();if(v.getState()===hf.READY){var w=v.Qd();if(!Ma(w)){delete w.cameras;delete w.camera;f[k]=w=yf(w,k);!B(r,oj)&&w.sources&&zf(w,h.uid);for(l in w.sources){var y=w.sources[l];y.max_zoom=yc(h.max,cl.lookAt.zoom.max);y.max_display_zoom=r.max;y.min_display_zoom=r.min;if(q=h.tileSize)2<=d&&256<q&&h instanceof wl&&(q/=2),y.tile_size=q}(p=v.Kc())&&Af(w,p);mf(g,w)}}}}mf(g.layers.skybox.draw.skybox.color,
g.scene.sky);a.m.config=g;return a.m.updateConfig().then(function(){var D={},F,O;if(n!==a.qs)return!1;a.qs=0;for(O in f){r=e[+O];var R=f[O].sources;for(F in R)if(R=a.m.sources[F])D[F]=R,R.initialize&&r.getProvider()&&R.initialize(r.getProvider(),a.Kr,a.m.getWorkers().length,R.tiled?A:a.m.tile_manager.getWorkerForTile(x,R))}for(F in a.Rh)!D[F]&&a.Rh[F].dispose&&a.Rh[F].dispose();a.Rh=D;return!0})}var d=a.m.pixelRatio();a.m.initialized?c():a.m.load(x,{blocking:!1}).then(c)}
m.Kr=function(a,b,c){var d=this,e=this.m.sources[a],f=c&&c.isReload;b?!0!==this.Fd[a]&&(this.Fd[a]||(this.Fd[a]={xx:{},gt:[]}),B(b,Hi)?this.Fd[a].xx[b.x+"/"+b.y+"/"+b.z]=!0:(b=b.boundingBox,this.Fd[a].gt.push(new K(b[0],b[1],b[2],b[3])))):this.Fd[a]=!0;e&&e.has_volatile_data?El(this,f):(globalThis.clearTimeout(this.Gw),this.Gw=globalThis.setTimeout(function(){return El(d,f)},100))};
m.Mn=function(a){var b=!1,c=this.Fd[a.source.name],d=globalThis.H.gl;if(c)if(!0===c)b=!0;else{var e=d.Tile.coord(d.Geo.wrapTile(a.coords));b=!!c.xx[e.key];if(!b){var f=d.Geo.getTileBoundingBox(e,a.source.tile_size,Q.MAX_LINE_WIDTH/2);f=Bg(f.getTopLeft(),f.getBottomRight());b=c.gt.some(function(g){return g.Vf(f,!0)||f.Ff(g.vb(),!0)})}}return b};function El(a,b){var c=a.m.tile_manager;c.removeTiles(a.Mn);c.updateTilesForView();b&&c.removeCachedTiles(a.Mn);Bl(a);a.Fd={}}m.Qd=function(){return this.m.config};
function Fl(a,b,c,d){a.m.getFeatureAt(b,c,d);a.m.update()}function Gl(a){return a.m.screenshot(void 0).then(function(b){return new wd(function(c,d){new ri(URL.createObjectURL(b.blob),function(e,f){1===e?c(f.getData()):d()},!1)})})}m.jb=function(){return this.m.pixelRatio()};m.disposeInternal=function(){var a=this.Rh;yl.g.disposeInternal.call(this);this.m.destroy();this.Fd={};a&&Object.keys(a).forEach(function(b){a[b].dispose()});globalThis.clearTimeout(this.Gw);delete this.Rh;delete this.m};
yl.prototype.disposeInternal=yl.prototype.disposeInternal;var zl={scene:{background:{color:"#FFFFFF"},sky:{zenith:"#347BC0",horizon:"#EDF2F9",fog:"#FFFFFF"}},lights:{default_light:{type:"directional",name:"default_light",visible:!0}},camera:{type:"perspective"},styles:{},fonts:{},sources:{skybox:{type:"SkyBox"}},layers:{skybox:{data:{source:"skybox"},draw:{skybox:{color:{}}}}},global:{}};function Hl(a,b,c,d){Hl.g.constructor.apply(this,arguments)}u(Hl,zi);t("H.map.render.dom.Surface",Hl);m=Hl.prototype;m.uh=function(){return"dom"};m.createElement=function(a){a=a.createElement("DIV");a.style.position="absolute";a.style.pointerEvents="none";return a};m.cx=function(a,b,c,d){b.width=c+"px";b.height=d+"px"};m.Eg=function(a){this.element.style.opacity=a};
m.Qe=function(a,b,c){var d=this.ja,e=a.style;e[li("transform")]="matrix(1,0,0,1,"+b/d+","+c/d+")";a.parentNode!==this.element&&(e.position="absolute",this.element.appendChild(a),this.element.style.pointerEvents="auto","auto"===getComputedStyle(a).pointerEvents&&(a.style.pointerEvents="all"),this.element.style.pointerEvents="none")};m.clear=function(a){a?this.element.removeChild(a):this.element.innerHTML=""};function Il(a,b,c,d,e,f){var g=e||"2d";Il.g.constructor.apply(this,arguments);this.$l=this.element.getContext(g,f);this.Au="2d"===g;this.jj=g;this.ij=f}u(Il,zi);m=Il.prototype;m.createElement=function(a){a=a.createElement("canvas");var b=a.style;b.position="absolute";b.top=b.left="0";return a};m.cx=function(a,b,c,d,e){a.width=Ac(c,1);a.height=Ac(d,1);b.width=Bc(c/e)+"px";b.height=Bc(d/e)+"px"};m.Eg=function(a){this.$l.globalAlpha=a};m.Qe=function(a,b,c,d,e){this.Au&&this.$l.drawImage(a,b,c,d,e)};
m.getContextAttributes=function(){return this.ij};m.uh=function(){return this.jj};m.clear=function(a){var b,c;this.Au&&(a?this.$l.clearRect(b=a.left,c=a.top,a.right-b,a.bottom-c):this.element.width=this.size.w)};m.disposeInternal=function(){var a=this.element;a.width=a.height=0;delete this.$l;Il.g.disposeInternal.call(this)};Il.prototype.disposeInternal=Il.prototype.disposeInternal;function Jl(a,b){this.Iy=a;this.na=b}
function Kl(a,b,c){var d=[],e={ld:a.Iy,width:b.w,height:b.h,ja:a.na};for(a=0;a<c.length;a++){b=c[a];var f=b.Eh();var g={};Qa(g,e);var h=b.Ob;switch(f){case "2d":B(b.Sb(),Bi)&&(g.Yo=b.Sb().getContextAttributes());if(f=n&&"2d"===n.uh()){f=g.Yo;var k=n.ij;f=k===f?!0:k&&!f?!k.alpha&&!k.willReadFrequently:f&&!k?!f.alpha&&!f.willReadFrequently:!f.alpha===!f.alpha&&!k.willReadFrequently===!f.willReadFrequently}if(f)var l=!1;else if(h&&!l){var n=h;l=!1}else n=new Il(g.ld,g.width,g.height,g.ja,"2d",g.Yo),
l=!0;break;case "dom":n=h||new Hl(g.ld,g.width,g.height,g.ja);l=!h;break;default:n=h||new Il(g.ld,g.width,g.height,g.ja,b.Sb().uh(),g.Yo),l=!h}d[d.length-1]!==n&&(n.ui(d.length),d.push(n));b.sf(n)}return d};function Ll(a,b){if(E(this.x=+a))throw new C(Ll,0,a);if(E(this.y=+b))throw new C(Ll,1,b);}m=Ll.prototype;m.add=function(a){return new Ll(this.x+a.x,this.y+a.y)};m.Jt=function(a){if(!B(a,Ll))throw new C(this.Jt,0,a);a=this.multiply(a);return a.x+a.y};m.multiply=function(a){if(!B(a,Ll))throw new C(this.multiply,0,a);return new Ll(this.x*a.x,this.y*a.y)};m.Ua=function(a){return new Ll(this.x*a,this.y*a)};function Ml(a){return Gc(a.Jt(a))}
m.normalize=function(){var a=Ml(this);return 0!==a?new Ll(this.x/a,this.y/a):this};function Nl(a){a=a||qe;this.NB=ab(a.MB)?a.MB:3;this.wv=ab(a.HB)?a.HB:300;this.Nx=ab(a.MD)?a.MD:3;this.CD=ab(a.BD)?a.BD:50;this.ei=[];this.clear()}t("H.map.render.InteractionUtils",Nl);Nl.prototype.kB=function(){return this.Jh};Nl.prototype.isGestureDetected=Nl.prototype.kB;Nl.prototype.start=function(a,b){var c=Wk.HEADING,d=Wk.TILT;this.R&&this.clear();this.jk=a;this.Km=!!b;this.R=!0;this.Jh=!(a&(c|d))||a===c||a===d};Nl.prototype.start=Nl.prototype.start;
Nl.prototype.store=function(a,b,c,d,e){var f=!1;if(this.R){a=new Ol(a,b,c,d,e);f=a.Ru;this.Xn=this.$e;this.$e=a;if(this.zj){if(this.zm=!0,f){b=this.jk;var g=this.Jh;if(!g&&this.zm){e=Wk.HEADING;var h=Wk.TILT;c=Wk.COORD;d=Wk.ZOOM;var k=b&(c|h)?this.Ah(!0):Pl;var l=b&d?this.km(!0):1;var n=b&e?Ec(this.Cp(!0)):0;var p=Ec(k.x);var q=Ec(k.y);k=10<p||10<q;p=10<q&&q>3*p;l=.8>l||1.2<l;n=7<n;b&h&&(n||l||k&&!p?Ql(this,h):p&&(Ql(this,~h>>>0),g=!0));!g&&b&e&&b&(c|d)&&(l||k?(Ql(this,e),g=!0):n&&(Ql(this,h),g=!0));
this.Jh=g}}}else this.zj=a,f||(this.Jh=!0);this.Km&&this.ei.push(a)}return f};Nl.prototype.store=Nl.prototype.store;Nl.prototype.clear=function(){this.ei.length=0;this.R=this.Km=this.zm=this.Jh=!1;this.zj=this.Xn=this.$e=void 0};Nl.prototype.clear=Nl.prototype.clear;Nl.prototype.$d=function(a){return 0<(this.jk&a)};Nl.prototype.isModifierEnabled=Nl.prototype.$d;function Ql(a,b){a.jk^=a.jk&b}Nl.prototype.Mm=function(){return this.R};Nl.prototype.isRunning=Nl.prototype.Mm;var Pl=Wa(new Ll(0,0));
Nl.prototype.Mf=function(){var a;if(this.Km){var b=this.ei;var c=b.length;var d=0;for(a=new Ll(0,0);--c&&d<this.Nx;)a=a.add(Rl(b[c-1],b[c])),d++}else a=this.Ah();return a.normalize()};Nl.prototype.getDirection=Nl.prototype.Mf;Nl.prototype.mc=function(a){a=a||$i();var b,c;if(this.Km){var d=this.ei;var e=this.ei.length;var f=this.ei[e-1];for(c=b=0;--e&&b<this.Nx;)c+=Ml(Rl(d[e],d[e-1])),b++;d=c/b}else f=this.$e,d=Ml(this.Ah());return d=d>=this.NB&&a-f.timestamp<=this.CD?d>this.wv?this.wv:d:0};
Nl.prototype.getSpeed=Nl.prototype.mc;Nl.prototype.jm=function(){return this.$e?Sl(this.$e):A};Nl.prototype.getBifocalCenter=Nl.prototype.jm;Nl.prototype.Ah=function(a){return(a=a?this.zj:this.Xn)?Rl(a,this.$e):new Ll(0,0)};Nl.prototype.getMoveVector=Nl.prototype.Ah;Nl.prototype.km=function(a){var b=1;if(this.zm){var c=this.$e;a=a?this.zj:this.Xn;if(a=Tl(a))if(c=Tl(c))b=c/a}return b};Nl.prototype.getBifocalScaling=Nl.prototype.km;
Nl.prototype.Cp=function(a){if(this.zm){var b=a?this.zj:this.Xn,c=this.$e;a=b.qg;var d=c.qg,e=0;a&&d&&(b=b.ke,c=c.ke,e-=Pc(d.y-c.y,d.x-c.x)*Xc-Pc(a.y-b.y,a.x-b.x)*Xc);a=e}else a=0;return a};Nl.prototype.getBifocalRotation=Nl.prototype.Cp;function Ol(a,b,c,d,e){this.ke=new L(a,b);c!==A&&(this.qg=new L(c,d),this.Ru=!0);this.timestamp=e!==A?e:$i()}Ol.prototype.Ru=!1;function Sl(a){var b=a.ke;return(a=a.qg)?new L(b.x-(b.x-a.x)/2,b.y-(b.y-a.y)/2):A}
function Ul(a,b){var c=a.ke;return(a=a.qg)&&a.ib(b)<c.ib(b)?a:c}function Rl(a,b){var c=a.qg,d=b.qg;d&&c?(b=Sl(b),a=Sl(a)):c?(b=b.ke,a=Ul(a,b)):d?(a=a.ke,b=Ul(b,a)):(b=b.ke,a=a.ke);return new Ll(b.x-a.x,b.y-a.y)}function Tl(a){var b=a.qg;return b?a.ke.ib(b):0};function Vl(a,b){if(E(this.zo=+a))throw new C(Vl,0,a);this.ho=this.sj=0;b&&this.Zw(b)}t("H.util.kinetics.KineticMove",Vl);Vl.prototype.Zw=function(a){this.ho=a;this.sj=this.eu();return this};Vl.prototype.setInitialSpeed=Vl.prototype.Zw;Vl.prototype.eu=function(){return Math.abs(this.ho/this.zo)};Vl.prototype.getDuration=Vl.prototype.eu;Vl.prototype.Ij=function(a){return this.ho+this.zo*a};Vl.prototype.getCurrentSpeed=Vl.prototype.Ij;Vl.prototype.Jz=function(a){return this.ho*a+this.zo*a*a/2};
Vl.prototype.getCurrentPath=Vl.prototype.Jz;function Wl(a,b,c,d,e){if(!Za(a.Mr)||!Za(a.Dr))throw new C(Wl,0,a);this.$s=a;if(!Za(this.ID=b))throw new C(Wl,1,b);if(E(this.sj=+c))throw new C(Wl,2,c);if(!Za(this.Gv=d)&&null!=d)throw new C(Wl,3,d);if(!Za(this.Kt=e)&&null!=e)throw new C(Wl,4,e);this.id=(new je).next();this.R=!1}t("H.util.animation.Animation",Wl);
Wl.prototype.start=function(){var a=this;this.al=$i();this.R=!0;var b=this.al;this.$s.Mr(function(){if(a.R){var c=$i(),d=c-a.al,e=d/a.sj,f=!1;1<=e&&(e=1,f=!0);a.ID(a.Kt?a.Kt(e):e,d,c-b,c);b=c;f&&a.stop()}else a.stop()})};Wl.prototype.start=Wl.prototype.start;Wl.prototype.stop=function(a){this.R=!1;this.$s.Dr();a||this.Gv&&this.Gv(this)};Wl.prototype.stop=Wl.prototype.stop;Wl.prototype.Mm=function(){return this.R};Wl.prototype.isRunning=Wl.prototype.Mm;function Xl(){G.call(this);this.reset()}u(Xl,G);Xl.prototype.start=function(a,b){this.R&&this.reset();E(a-b)||(this.Ug=+a,this.Vg=+b);this.R=!0};Xl.prototype.reset=function(){this.R=!1;this.Ug=this.Vg=A;this.To=new Yl(0,0,0,0,0,0)};Xl.prototype.Mm=function(){return this.R};Xl.prototype.j={yo:"animationupdate"};function Zl(a){Zl.g.constructor.call(this,Xl.prototype.j.yo);this.kt=a}u(Zl,Jb);
Xl.prototype.set=function(a,b,c,d,e,f){var g=this.To;this.R&&(a=new Yl(a/1E3,b/1E3,c/1E3,d/1E3,e/1E3,f/1E3),g.da(a)||(this.To=a,this.dispatchEvent(new Zl($l(this)))))};function $l(a){return globalThis.Object.create(a.To)}Xl.prototype.mc=function(){return $l(this).mc()};Xl.prototype.Mf=function(){var a=$l(this),b=this.mc()||1;return new Yl(a.Kb/b,a.Lb/b,a.Mb/b,a.mi,a.ni,a.Kk)};Xl.prototype.disposeInternal=function(){this.reset();Xl.g.disposeInternal.call(this)};
function Yl(a,b,c,d,e,f){this.Kb=a;this.Lb=b;this.Mb=c;this.mi=d;this.ni=e;this.Kk=f}Yl.prototype.mc=function(){return Gc(this.Kb*this.Kb+this.Lb*this.Lb+this.Mb*this.Mb)};Yl.prototype.Mf=function(){var a=this.mc()||1;return new Yl(this.Kb/a,this.Lb/a,this.Mb/a,this.mi,this.ni,this.Kk)};Yl.prototype.da=function(a){var b=a===this;!b&&(b=B(a,Yl))&&(b=this.Kb===a.Kb&&this.Lb===a.Lb&&this.Mb===a.Mb&&this.mi===a.mi&&this.ni===a.ni&&this.Kk===a.Kk);return b};function am(a){var b="dom";am.g.constructor.call(this,a);B(this.xb,Bi)&&(b="2d"===a.uh()?"2d":"webgl");this.xD=b}u(am,ml);am.prototype.L=function(a,b,c,d,e,f,g,h){g=this.xb;var k=this.Ob,l=!(B(k,Il)&&"2d"===k.uh());if(d>=g.min&&d<=g.max)return l&&k.Yb(!0),g.L(k.B(),{boundingBox:a,zoom:d,screenCenter:b,priorityCenter:f,projection:c,cacheOnly:e,size:k.lc(),pixelRatio:k.jb(),cameraMatrix:h});l&&k.Yb(!1);return Ai.DONE};am.prototype.Eh=function(){return this.xD};function U(a,b,c,d){var e;U.g.constructor.call(this,a,b,c,d);this.sp=new bj(this.gy);this.Wb=new L(0,0);if(e=d.renderBaseBackground)this.Iw=e.lower,this.Hw=e.higher;this.uj=!!d.enableSubpixelRendering;this.Kg=bm;this.ma=new Nl;this.T=d=new Xl;this.fg=z(this.fg,this);d.addEventListener(d.j.yo,this.fg);d=a.element;this.qc=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);this.dl=new Jl(this.qc,this.ja);
this.Vm=b.Hb().position;b=globalThis.H.gl;if(!b)throw new vb(U,'"H-webgl" module is missing');this.m=new yl({viewport:this.Ba,ld:this.qc,devicePixelRatio:this.ja,Pv:z(this.ba,this)});b.WorkerBroker.addTarget("model",rk);this.fq();this.Tq=z(this.Tq,this);this.vg=z(this.vg,this);this.La=z(this.La,this);c.addEventListener(vg.prototype.j.Li,this.Tq);this.o=cm;this.zoom=Yk(this,this.De.Tb());this.zc();this.mg()}u(U,Tk);t("H.map.render.webgl.RenderEngine",U);U.prototype.gy=100;
U.prototype.Hb=function(){var a=this.Vm;return Zk(this,{position:{uB:a.uB,BB:a.BB},zoom:this.zoom,tilt:this.zx,heading:this.heading})};U.prototype.Tq=function(a){a=(a=a.target.D)&&a.kb();(a&&a.getState())===hf.INIT?a.load():(Bl(this.m),Dl(this.m,this.gb),this.ba())};U.prototype.type=bl.WEBGL;var cm=2;U.prototype.getState=function(){return this.o};U.prototype.getState=U.prototype.getState;U.prototype.Fj=function(a,b){a=b-a;var c=Hc(2,8+this.zoom);return a<c/2?a:a-c*b/Ec(b)};
function dm(a,b,c){function d(h){return e[h]+kl(e[h],b[h])/2}if(!(c&Oj.POSITION||c&Oj.BOUNDS))return null;var e=Cl(a.m).getLookAtData();c=e.position;var f=b.position,g=b.bounds;if(Eh(e.bounds,f.lat,f.lng,!1)||g&&Eh(g,c.lat,c.lng,!1))return null;c=em(a,{tilt:d("tilt"),heading:d("heading"),incline:0,bounds:Cg([c,f])});c.zoom=Yk(a,c.zoom-.5);delete c.bounds;return c}U.prototype.mr=!1;function fm(a,b,c,d){a=a.getCapabilities().lookAt[d];return Ec("zoom"===d?c[d]-b[d]:kl(b[d],c[d]))/(a.max-a.min)||0}
function gm(a,b,c){a=Ac(8*fm(a,b,c,"zoom"),fm(a,b,c,"heading"),fm(a,b,c,"tilt")/2);return cd(3E3*a,300,4E3)}
U.prototype.ar=function(a){var b=this,c=a.newValue,d=a.modifiers,e=Cl(this.m);this.Jg();this.Wb.set(0,0);var f=this.Fo(c);Qk.forEach(function(n){d&a[n.toUpperCase()]||delete f[n]});if(a.animate){c=Cl(this.m).getLookAtData();var g=em(this,f,a.Nu);e=dm(this,g,d);var h=1;jb(a.animate)&&(h=1/a.animate);var k=function(){return b.mr=!1};delete g.bounds;this.mr=!0;if(e){c=gm(this,c,e);var l=gm(this,e,g);hm(this,e,c*h,function(){return hm(b,g,l*h,k)})}else e=gm(this,c,g),hm(this,g,e*h,k)}else(c=a.Nu)?f=em(this,
f,c):im(f),e.setLookAtData(f);jm(this);Bl(this.m);this.ba()};function em(a,b,c){im(b);a=Cl(a.m).getBestLookAtData(b);c&&(a.zoom<<=0);return a}function im(a){var b=a.bounds;!b||b instanceof P||(a.bounds=Bh(b.C()))}function km(a,b,c){Cl(a.m).setLookAtData(b);Bl(a.m);jm(a);a.ba();c&&setTimeout(c,0)}
function hm(a,b,c,d){var e=Cl(a.m).getLookAtData(),f=new jl(e,b);0!==f.bg.tilt+f.bg.heading+f.bg.zoom+f.kh?a.ad(function(g){for(var h in f.bg)if(0!==f.bg[h]){var k=f.Dv[h](g);e[h]+=f.bg[h]*(k-f.fv[h]);f.fv[h]=k}0!==f.kh&&(e.position=f.ep.oo(f.wy,f.kh*f.Dv.position(g),!0));return km(a,e)},c,function(){return km(a,b,d)}):km(a,b,d)}U.prototype.Yn=function(){};U.prototype.setAnimationDuration=U.prototype.Yn;U.prototype.Ap=function(){};U.prototype.getAnimationDuration=U.prototype.Ap;U.prototype.Zn=function(){};
U.prototype.setAnimationEase=U.prototype.Zn;U.prototype.Bp=function(){};U.prototype.getAnimationEase=U.prototype.Bp;U.prototype.Sn=function(){};U.prototype.resetAnimationDefaults=U.prototype.Sn;function lm(a,b){a.sp.ia(function(c,d){return d.Ib()===b})}m=U.prototype;m.Nv=function(a){lm(this,a.target.D);Bl(this.m);this.ba()};m.qk=function(a,b){U.g.qk.call(this,a,b);mm(b)&&(Bl(this.m),(a=(a=b.D)&&a.kb())&&a.getState()===hf.INIT&&a.load())};
m.Uq=function(a,b,c){var d;this.ak=$i();lm(this,b.D);if(b.requestDomMarkers||B(b,Bi)||B(b,Di)){var e=this.qe.ka;for(d=e.length;d--;){var f=e[d];if(f.Sb()===b){e.splice(d,1);f.l();break}}}mm(b)&&Dl(this.m,this.gb);this.af=this.gb.Sa();0===a&&(Xk(this,b,!1),this.zc());Kl(this.dl,this.Sf(),this.Pf());this.li();c||this.ba()};function mm(a){return!(B(a,Di)||B(a,Bi))}m.fq=function(){var a=this.gb.Sa(),b=0,c=a.length;this.qe={Pe:[],ka:[]};for(this.af=a;b<c;b++){var d=a[b];this.qk(b,d);Xk(this,d,!0)}this.zc()};
m.Vq=function(){this.zc()};m.zc=function(){U.g.zc.call(this);var a=this.getCapabilities().lookAt.zoom;Cl(this.m).setZoomConstraints(Ac(a.min,this.zq),yc(a.max,this.yq))};m.gq=function(a,b){var c;if(b){a={Od:this.uj,zb:this.zb};b.L?B(b,Bi)?c=new am(b):B(b,Di)&&(c=new am(b)):b.requestDomMarkers&&(c=new ql(b,a));if(c){this.qe.ka.push(c);var d=this.gb.Sa();this.qe.ka.sort(function(e,f){return d.indexOf(e.xb)-d.indexOf(f.xb)});Kl(this.dl,this.Sf(),this.Pf())}mm(b)&&Dl(this.m,this.gb)}this.af=this.gb.Sa()};
m.Pf=function(){return this.qe.ka.filter(ab)};m.Ro=function(){return this.o===cm};m.Fo=function(a){var b=a.position;return Zk(this,{zoom:Yk(this,a.zoom),position:new Re(b.lat,b.lng),tilt:a.tilt,heading:a.heading,bounds:a.bounds})};function jm(a){var b=Cl(a.m).getLookAtData();a.zoom=b.zoom;a.Vm=b.position}m.Ds=4.007501668557849E7;function nm(a,b){b=Cl(a.m).geoToMeters(b);return new L(b.x/a.Ds+.5,1-(b.y/a.Ds+.5))}function om(a,b){return b.sub(nm(a,a.Vm)).scale(Hc(2,8+a.zoom))}m.La=function(a){return Cl(this.m).geoToPixel(a)};
U.prototype.geoToScreen=U.prototype.La;U.prototype.Va=function(a,b){return Cl(this.m).xyToGeo(a,b)};U.prototype.screenToGeo=U.prototype.Va;U.prototype.Wn=function(a,b){a=this.Va(a,b);b=this.De.Hb();b.position=a;return b};
function pm(a,b,c,d,e,f,g,h){var k,l,n=0,p;var q=function(){0===--n&&f(e)};if(h&&h.features)for(n=l=h.features.length,p=0;p<l;p++){var r=h.features[p];var v=r.id;if(k=a.m.m.sources[r.source_name]){var w=k.provider;var y=w.pu();if(y===jg.SOURCE){var D=r.source_layer;if("overlays"===D)qm(a,b,c,d,e,k,r.properties.overlays_config);else if(k=k.getMapObjectById(v))if("markers"!==D)e.push(k);else if(rm(a,b,c,k))e.push(k);else if(d&&!g){var F=!0;Fl(a.m,{x:b,y:c},{radius:3.5,top_most_only:!1},function(O){pm(a,
b,c,d,e,f,!0,O)})}n--}else y===jg.FEATURE?(D=r.tile.coords,F=w.getFeatureProxy(r.properties,D,function(O){O&&(O.bx(w),e.push(O));q()}),F||(k=a.sp.get(v),k||(k=new Ae(r),k.ea(w),a.sp.add(v,k,1)),e.push(k),n--)):y===jg.PROVIDER&&(F=!0,w.Lw(r,!1).then(function(O){O&&(O instanceof Ze?rm(this,b,c,O):1)&&e.push(O);q()},function(){q()},a))}}y&&(F||0!==n)||f(e)}
function qm(a,b,c,d,e,f,g){var h;a=a.Va(b,c);for(b=g.length;b--&&(!(h=f.getMapObjectById(g[b].id))||0<=e.indexOf(h)||!h.V().Ff(a)||(e.push(h),!d)););}function rm(a,b,c,d){var e=d.jc(),f=e.Bm,g,h=!f;if(f)if(e=e.Cb,b+=e.x,c+=e.y,e=d.V(),B(e,Xe))for(d=e.ha,g=d.length;g--&&!h;)e=a.La(d[g]),h=f.Cm(b-e.x,c-e.y,0)!==ed.NONE;else e=a.La(e),h=f.Cm(b-e.x,c-e.y,0)!==ed.NONE;return h}
U.prototype.Ma=function(a,b,c,d){var e=this,f=[];f=this.Np(f,this.qe.ka,a*this.ja,b*this.ja,c);c&&f.length?d(f):this.m.m.initialized?Fl(this.m,{x:a,y:b},{radius:3.5,top_most_only:c},function(g){pm(e,a,b,c,f,d,!1,g)}):d(f)};U.prototype.getObjectsAt=U.prototype.Ma;m=U.prototype;m.Np=function(a,b,c,d,e){for(var f=b.length,g;f--&&!((g=b[f])&&g.Ma&&(a=a.concat(g.Ma(c,d,e)),a.length&&e)););return a};m.xe=x;m.Sf=function(){var a=this.sl[2];return{w:a.right-a.left,h:a.bottom-a.top}};
m.mg=function(){var a=this.qe.ka.length;Uk(this,this.ja);this.Wb.set(0,0);var b=this.Sf();var c=b.w;var d=b.h;for(this.m.m.handleViewportUpdate();a--;){b=this.qe.ka[a].Ob;var e=b.lc();e.w===c&&e.h===d||b.Vk(c,d)}this.xe=new Ue(c,d);Bl(this.m);this.ba()};m.getCapabilities=function(){return cl};U.prototype.getCapabilities=U.prototype.getCapabilities;m=U.prototype;m.wq=function(){this.F(1);this.ne=!1;this.o=1;this.Mk()};
m.Mk=function(){this.ta&&this.ta.R||(Al(this.m)||$i()-this.ak<this.Kg)&&!this.ne?this.rh||(this.rh=Yi(this.vg)):(this.ne&&(this.li(),this.qj(),this.F(0)),this.o=cm)};m.rh=0;m.li=function(){this.qe.Pe.length=0};
m.vg=function(){this.rh=0;this.ef&&this.ef.before();var a=Cl(this.m);var b=a.getLookAtData(!1);var c=a.getLookAtData(!0);a=this.Ba.center.clone();c=c.bounds.C();var d=this.zoom;var e=this.Wb;var f=this.af;var g=f.length;for(this.Kg=bm;g--;){var h=f[g];B(h,vg)&&h.D&&h.D.yk(c,d)}this.ne=this.m.L();this.De.pb(b);this.ne=this.Nn(c,a,d,!1,e,this.qe)&&this.ne;this.xe&&(this.Ba.pb(this.xe),this.xe=x);this.ta&&this.ta.R&&this.Ho();this.ef&&this.ef.after();this.Mk()};
m.Nn=function(a,b,c,d,e,f){var g=f.ka.length,h=!0,k;for(k=0;k<g;k++){var l=f.ka[k];var n=f.Pe;if(l){var p=l.L(a,b,void 0,c,d,e,this.La,this.m.m.getCameraMatrix());p===Ai.ACTIVE&&(this.Kg=Infinity);p!==Ai.DONE||n[k]||(this.qj(l.Sb()),n[k]=!0);n[k]||(h=!1)}}return h};m.qj=function(a){this.mr||setTimeout(z(this.dispatchEvent,this,{type:this.j.Ss,target:a||this}),1)};
m.disposeInternal=function(){var a=this.gb.Sa()[0],b=this.Ba;Zi(this.rh);this.bd(!0);a&&Xk(this,a,!1);this.Pf().forEach(function(c){c.l()});b.element&&b.element.removeChild(this.qc);delete this.qc;this.o=3;this.m.l();U.g.disposeInternal.call(this)};m.ba=function(){this.ak=$i();this.Ro()&&this.wq()};m.Ac=function(a,b){this.Sg(a,b);this.Wb.set(0,0);Bl(this.m);this.ba()};m.Sg=function(a,b){Cl(this.m).applyPxOffset([a,b]);jm(this)};m.Ng=function(a,b,c){a=Yk(this,Yk(this,a));this.rb(a,b,c)};
U.prototype.zoomAt=U.prototype.Ng;U.prototype.rb=function(a,b,c){Cl(this.m).setLookAtData({zoom:a},jb(b)&&jb(b)?[b,c]:A);jm(this);Bl(this.m);this.ba()};U.prototype.Jg=function(){this.bd(!0);this.T.R&&this.fc(!0);this.ma.R&&this.hc(!0)};U.prototype.Sk=function(a){if(a){var b={};b.xk=a.power;b.tj=a.ease;b.duration=a.duration;this.ua=b}};U.prototype.Hd=function(a,b){var c=!!(b||a&(Wk.HEADING|Wk.TILT));this.Jg();this.Sk(b);this.ma.start(a,c);Cl(this.m).setPanning(!0)};U.prototype.startInteraction=U.prototype.Hd;
U.prototype.ud=function(a,b,c,d,e){var f=this.ma;var g=!1;if(f.R){var h=Cl(this.m);var k=h.getLookAtData();var l=this.Ba.center;l=[l.x,l.y];b=f.store(a,b,c,d,e);c=f.jm();a=f.Ah();d=this.ma.km();e=this.ma.Cp();f.Jh&&(f.$d(Wk.TILT)&&(h.setLookAtData({tilt:$k(this,k.tilt+a.y/this.Ba.height*-180)},l),g=!0),b&&1!==d&&f.$d(Wk.ZOOM)&&(g=f.jm(),this.rb(Yk(this,Fc(Hc(2,this.zoom)*d)/Qc),g.x,g.y),g=!0),f.$d(Wk.COORD)&&0<Ml(a)&&(this.Ac(-a.x,-a.y),g=!0),f.$d(Wk.HEADING)&&(b?h.setLookAtData({heading:k.heading+
al(this,e)},[c.x,c.y]):a.x&&h.setLookAtData({heading:al(this,k.heading+a.x/this.Ba.width*360)},l),g=!0),g&&(Bl(this.m),this.ba()))}};U.prototype.interaction=U.prototype.ud;
U.prototype.hc=function(a){var b=this;if(this.ma.R&&!a){if(this.ua){a=this.ma.mc();var c=this.ma.Mf();var d=this.ua.duration;var e=(this.ua.xk||1)*a;var f=new Vl(-e/(0<d?d:1),e);!E(c.x)&&!E(c.y)&&0<e&&b.ma.$d(Wk.COORD)&&this.ad(function(g){e=f.Ij(g*d);E(e)||b.Ac(Bc(-c.x*e),Bc(-c.y*e))},d,void 0,this.ua.tj)}delete this.ua;this.ma.clear()}Cl(this.m).setPanning(!1);this.ba()};U.prototype.endInteraction=U.prototype.hc;U.prototype.Gd=function(a,b,c){this.Jg();this.T.start(b,c);this.Sk(a);Cl(this.m).setPanning(!0)};
U.prototype.startControl=U.prototype.Gd;U.prototype.control=function(a,b,c,d,e,f){for(var g=0,h;g<arguments.length;g++)if(h=+arguments[g],h!==h)throw new C(this.control,g,h);this.T.R&&this.T.set(a,b,c,d,e,f)};U.prototype.control=U.prototype.control;
U.prototype.fc=function(a,b){var c=this,d;if(this.T.R){this.bd(!0);var e=$i();var f=e-this.kj;if(1<=f){var g=$l(this.T);this.Ri(g,f)}if(!this.ua||a||b)"function"===typeof b&&(a=Cl(this.m),a=a.getLookAtData(),b(a),this.Io(a));else{b=this.T.mc();var h=this.T.Mf();var k=this.ua.duration;var l=(this.ua.xk||1)*b;var n=new Vl(-l/(0<k?k:1),l);!E(h.Kb)&&!E(h.Lb)&&0<l&&this.ad(function(p,q,r,v){e&&(r=v-e,e=0);l=n.Ij(p*k)*r;E(l)||((d=h.Mb*l)&&c.rb(Yk(c,c.zoom+d),c.T.Ug,c.T.Vg),c.Ac(Bc(h.Kb*l),Bc(h.Lb*l)))},
k,void 0,this.ua.tj)}this.T.reset();Cl(this.m).setPanning(!1);this.ba()}};U.prototype.endControl=U.prototype.fc;m=U.prototype;
m.Io=function(a){var b=this,c=om(this,nm(this,a.position)),d=c.y;c=c.x;var e=a.zoom,f=om(this,nm(this,this.Vm));a=f.y;var g=f.x;f=this.zoom;var h=this.T.mc(),k=this.T.Ug,l=this.T.Vg,n=0;c=this.Fj(g,c);c-=g;d-=a;f=e-f;a=Gc(c*c+d*d+f*f);if(0!==h&&0!==a){var p=c/a;var q=d/a;var r=f/a;var v=h*h/(2*a);this.ad(function(w,y){var D;if(1!==w){w=h*y-v*y*y/2;y=w-n;if(D=r*y)D=Yk(b,b.zoom+D),b.rb(D,k,l);b.Ac(Bc(p*y),Bc(q*y));n=w}else b.rb(Yk(b,e),k,l),b.ba()},2*a/h)}};
m.fg=function(a){var b=this,c=a.kt;this.Wb.set(0,0);c.Kb||c.Lb||c.Mb||c.mi||c.ni||c.Kk?(this.kj=$i(),this.ad(function(d,e,f,g){b.kj=g;b.Ri(c,f)},Yc),this.ba()):this.bd(!0)};m.Ri=function(a,b){b=b||0;var c=this.T,d=Cl(this.m),e=d.getLookAtData();a.Mb&&this.rb(Yk(this,e.zoom+a.Mb*b),c.Ug,c.Vg);d.setLookAtData({heading:al(this,e.heading+a.ni*b),tilt:$k(this,e.tilt+a.mi*b)});jm(this);this.Ac(a.Kb*b,a.Lb*b)};m.ad=function(a,b,c,d){this.ta&&this.ta.R&&this.ta.stop(!0);this.ta=new Wl(this,a,b,c,d);this.ta.start()};
m.bd=function(a){this.ta&&this.ta.R&&this.ta.stop(a)};m.mp=function(){};U.prototype.enter=U.prototype.mp;U.prototype.rp=function(a){Vk(this.qc,a)};U.prototype.exit=U.prototype.rp;U.prototype.capture=function(a,b,c,d){var e=this;return Gl(e.m).then(function(f){var g=e.qc.ownerDocument.createElement("canvas"),h=e.ja,k=g.getContext("2d"),l=e.m.jb()/h,n=(c-a)*h;h*=d-b;g.width=n;g.height=h;k.drawImage(f,a*l,b*l,n*l,h*l,0,0,n,h);return g})};U.prototype.uz=function(a){return Cl(this.m).geoToMeters(a)};
U.prototype.geoToMeters=U.prototype.uz;U.prototype.KB=function(a){return Cl(this.m).metersToGeo(a)};U.prototype.metersToGeo=U.prototype.KB;var bm=5E3;function sm(a,b,c,d,e,f){var g;for(g=[];d<=e;d++){var h=g.concat,k=a;var l=c;var n=Cc(d);k.pixelProjection.Ua(n);var p=k.Cj(l);l=k.Fh(p,n);n=Gg(k,l,p.left>p.right,n);g=h.call(g,n)}a=g.length;lk.call(this,f,a);this.px=c=[];this.Zq=z(this.Zq,this);this.Yq=z(this.Yq,this);for(this.F(1);a--;)f=g[a],c.push(Fk(b,f[0],f[1],f[2],this.Zq,this.Yq))}u(sm,lk);sm.prototype.Zq=function(){nk(this,2)};sm.prototype.Yq=function(){nk(this,4)};
sm.prototype.Xi=function(){for(var a=this.px,b=a.length;b--;)a[b].cancel();delete this.px};function V(a,b,c){var d={};if(!(a instanceof HTMLElement))throw new C(V,0);V.g.constructor.call(this);this.Fa=tm(c,V);this.va=c=new Ik;this.Fq=!1;c.addEventListener(c.j.Pi,this.Qv,!1,this);if(!B(a,Element))throw new C(V,0,a);c=this.G=a.ownerDocument.createElement("div");var e=c.style;e.position="relative";e.height=c.style.width="100%";e.overflow="hidden";e.webkitTapHighlightColor="transparent";"transparent"!==e.webkitTapHighlightColor&&(e.webkitTapHighlightColor="rgba(0,0,0,0)");a.appendChild(c);
this.ra=new Pj(this.G,this.Fa);this.ra.addEventListener(this.ra.j.Pi,this.Qv,!1,this);a=this.O=new rk(this.Fa.layers);a.addEventListener(a.j.Ni,this.Rq,!1,this);a.addEventListener(a.j.Ki,this.Rq,!1,this);a.addEventListener(a.j.Mi,this.Rq,!1,this);!this.ob&&um(this);this.oa=null;this.O.add(b,0);this.wa=this.$o(null!=this.Fa.engineType?this.Fa.engineType:lg,this.Fa);this.nn=z(this.nn,this);this.wa.addEventListener(Tk.prototype.j.Oi,this.nn);this.lp=z(this.lp,this);b=this.Fa.imprint;if(b!==A&&"object"!==
typeof b)throw new C(V,1,"imprint");this.Xd=null===b?b:new Rj(this,b);b=this.Fa.autoColor;this.ft=b===A||!!b;vm(this);(b=this.Fa.zoom)&&(d.zoom=b);(b=this.Fa.bounds)&&(d.bounds=b);(b=this.Fa.center)&&(d.position=b);this.va.$c(d)}u(V,G);t("H.Map",V);m=V.prototype;m.draggable=V.prototype.draggable=!1;
function tm(a,b){if(a){var c=a.pixelRatio;if(c===A)a.pixelRatio=ae();else if(!(0<c))throw new C(b,0,"pixelRatio: "+c);}else a={},a.pixelRatio=ae();a.renderBaseBackground||(a.renderBaseBackground={lower:3,higher:2});return a}m.iy=333;m.disposeInternal=function(){this.ft=!1;this.Xd&&this.Xd.l();this.wa.dispose();this.va.l();this.ra.l();this.ob.l();this.rc.l();this.O.l();var a=this.G;a.parentNode.removeChild(a);delete this.G;this.wa.removeEventListener(Tk.prototype.j.Oi,this.nn);G.prototype.disposeInternal.call(this)};
m.nn=function(a){this.dispatchEvent(new kg(V.prototype.j.fy,a.oldValue,a.newValue))};m.B=function(){return this.G};V.prototype.getElement=V.prototype.B;V.prototype.jb=function(){return this.Fa.pixelRatio};V.prototype.getPixelRatio=V.prototype.jb;function vm(a){a.Xd&&a.ft&&a.Xd.Ur({invert:a.oa&&a.oa.Ry})}
V.prototype.Rq=function(a){var b=a.added,c=a.removed;b&&b.D&&b.D.ea(this);c&&c.D&&c.D.ea(null);c===this.ob&&(delete this.ob,delete this.rc);c===this.oa&&(this.oa=null);0===a.idx&&(this.dispatchEvent(new kg(this.j.yl,this.oa=a.type!==this.O.j.Mi?b:0<this.O.aa.length?this.O.get(0):x,a.type!==this.O.j.Ki?c:1<this.O.aa.length?this.O.get(1):x)),vm(this))};
V.prototype.Qv=function(a){a.modifiers&&(this.Fq||(wm(this,"start"),this.Fq=!0),wm(this,"",a),this.sv&&globalThis.clearTimeout(this.sv),this.sv=globalThis.setTimeout(this.lp,this.iy))};function wm(a,b,c){a.dispatchEvent(c?new Nj(a.j.Ls,c.newValue,c.oldValue,c.modifiers):a.j.Ls+b)}V.prototype.lp=function(){wm(this,"end");this.Fq=!1};V.prototype.ao=function(a,b){this.wa.getCapabilities().lookAt&&this.va.$c({position:a},!!b);return this};V.prototype.setCenter=V.prototype.ao;
V.prototype.vb=function(){var a=this.va.Hb();return a?a.position:x};V.prototype.getCenter=V.prototype.vb;V.prototype.Wk=function(a,b){this.va.Wk(a,!!b);return this};V.prototype.setZoom=V.prototype.Wk;V.prototype.Tb=function(){return this.va.Tb()};V.prototype.getZoom=V.prototype.Tb;V.prototype.Ng=function(a,b,c){this.wa.zoomAt(a,b,c)};V.prototype.zoomAt=V.prototype.Ng;V.prototype.UA=function(){return this.ra};V.prototype.getViewPort=V.prototype.UA;V.prototype.TA=function(){return this.va};
V.prototype.getViewModel=V.prototype.TA;V.prototype.hA=function(){return this.O};V.prototype.getLayers=V.prototype.hA;V.prototype.bA=function(){return this.Xd};V.prototype.getImprint=V.prototype.bA;
V.prototype.capture=function(a,b,c,d,e,f){function g(F,O){q?F.cancel():(w.save(),O.capture(v,n,function(R){w.restore();F.done(R)},function(R){F.done(null,R);h(null)}))}function h(F){q||(q=!0,a(F))}var k=this.wa,l=k.getCapabilities(),n=this.Fa.pixelRatio,p=this.ra,q=!1,r=this,v,w;if(!Za(a))throw new C(this.capture,0,a);c=c||0;d=d||0;e=e||p.width;f=f||p.height;var y=Ac(0,yc(c,e));var D=Ac(0,yc(d,f));c=yc(p.width,Ac(c,e));d=yc(p.height,Ac(d,f));l.capture?k.capture(y,D,c,d).then(function(F){var O=r.Xd,
R=b||[];v=F;w=v.getContext("2d");v.style.width=v.width/n+"px";v.style.height=v.height/n+"px";var Ta=new lj(10,g);R=R.concat(O).filter(function(aa){return Za(aa&&aa.capture)});R.length?(F=R.pop(),R.forEach(function(aa){Ta.push(aa,oe)}),Ta.push(F,z(h,r,v)),Ta.Cn()):h(v)},function(){h(x)}):a(null)};V.prototype.capture=V.prototype.capture;V.prototype.Pz=function(){return this.wa};V.prototype.getEngine=V.prototype.Pz;
V.prototype.$o=function(a,b){b=b?tm(b,this.$o):this.Fa;vm(this);if(a===mg.P2D)return new globalThis.H.map.render.p2d.RenderEngine(this.ra,this.va,this.O,b);if(a===mg.WEBGL)return new U(this.ra,this.va,this.O,b);if(a===mg.HARP)return new globalThis.H.map.render.harp.RenderEngine(this.ra,this.va,this.O,b);throw new C(this.$o,0,a);};
V.prototype.bl=function(a,b,c,d,e){b=ab(b)?B(b,K,this.bl,1,b)&&b:this.va.Hb().bounds.C();e=e||this.oa;if(!B(e,Fg))throw new C(this.bl,4);var f=e.D,g=this.jb(),h=e.tileSize;2<=g&&256<h&&f instanceof wl&&(h/=2);g=this.Tb();h=Math.log2(h)-8;c=ab(c)?+c:g;d=ab(d)?+d:g;if(!(c<=d))throw new C(this.bl,A,"!(min <= max)");g=f.min;var k=f.max,l=this.wa.type===mg.WEBGL?Cc:Bc;c=cd(l(c)-h,g,k);d=cd(l(d)-h,g,k);if(!(f&&B(f,T)&&kk()&&f.Wi()))throw new vb(this.bl,"Storing is not supported");return new sm(e,f,b,c,
d,a)};V.prototype.storeContent=V.prototype.bl;function xm(a){lk.call(this,a)}u(xm,lk);xm.prototype.qC=function(){nk(this,2)};xm.prototype.pC=function(){nk(this,4)};V.prototype.Fy=function(a){a=new xm(a);jk().clear(z(a.qC,a),z(a.pC,a));return a};V.prototype.clearContent=V.prototype.Fy;V.prototype.Cl=function(a,b){var c=this.O,d=c.indexOf(a),e=b!==+b;b=e?c.aa.length-1:b;0>d?c.add(a,b):d-b&&(c.Cd(d),c.add(a,e?b-1:b));return this};V.prototype.addLayer=V.prototype.Cl;
V.prototype.hi=function(a){var b=this.O.indexOf(a);a!==this.oa&&a!==this.ob&&-1!==b&&this.O.Cd(b);return this};V.prototype.removeLayer=V.prototype.hi;V.prototype.Cg=function(a){this.oa!==a&&(this.O.aa.length&&this.O.get(0)!==this.ob?this.O.set(0,a):this.O.add(a,0),this.oa=a);return this};V.prototype.setBaseLayer=V.prototype.Cg;V.prototype.Bz=function(){return this.oa};V.prototype.getBaseLayer=V.prototype.Bz;
V.prototype.La=function(a){if(!Se(a))throw new C(this.La,0,a);return(a=this.wa.geoToScreen(a))?Ye(a):x};V.prototype.geoToScreen=V.prototype.La;V.prototype.Va=function(a,b){var c;if(c=+E(a)||2*+E(b))throw new C(this.Va,c-1,arguments[c-1]);return(c=this.wa.screenToGeo(a,b))?Te(c):x};V.prototype.screenToGeo=V.prototype.Va;V.prototype.Wn=function(a,b){return this.wa.screenToLookAtData(a,b)};V.prototype.screenToLookAtData=V.prototype.Wn;
V.prototype.Y=function(a){if(!B(a,I))throw new C(this.Y,0,a);!this.ob&&um(this);this.rc.qd().Y(a);return a};V.prototype.addObject=V.prototype.Y;V.prototype.Oa=function(a){if(!B(a,I))throw new C(this.Oa,0,a);!this.ob&&um(this);this.rc.qd().Oa(a);return a};V.prototype.removeObject=V.prototype.Oa;V.prototype.ab=function(a){!this.ob&&um(this);return this.rc.qd().ab(a)};V.prototype.getObjects=V.prototype.ab;
V.prototype.hd=function(a){var b;fb(a,this.hd,0,a);!this.ob&&um(this);var c=a.length;for(b=0;b<c;b++)this.Y(a[b]);return this};V.prototype.addObjects=V.prototype.hd;V.prototype.ug=function(a){var b;fb(a,this.ug,0,a);!this.ob&&um(this);var c=a.length;for(b=0;b<c;b++)this.Oa(a[b]);return this};V.prototype.removeObjects=V.prototype.ug;V.prototype.Bh=function(a,b,c){var d;if(d=+E(a)||2*+E(b))throw new C(this.Bh,d-1,arguments[d-1]);this.wa.getObjectsAt(a,b,!0,function(e){c(e[0])})};
V.prototype.getObjectAt=V.prototype.Bh;V.prototype.Ma=function(a,b,c,d){var e;if(e=+E(a)||2*+E(b))throw new C(this.Bh,e-1,arguments[e-1]);this.wa.getObjectsAt(a,b,!1,c,!!d)};V.prototype.getObjectsAt=V.prototype.Ma;V.prototype.Of=function(a,b,c){c=c||{};var d=c.zoom;c.zoom=ab(d)?d:this.va.Tb();this.rc.Of(a,b,c)};V.prototype.getObjectsWithin=V.prototype.Of;function um(a){a.rc=new J({max:24,engineType:a.Fa.engineType});a.ob=new oj(a.rc,a.Fa);a.O.add(a.ob)}
var ym=bl.HARP,mg={P2D:bl.P2D,WEBGL:bl.WEBGL,HARP:ym};V.EngineType=mg;V.EngineState={IDLE:0,BUSY:1};V.prototype.j={fy:"enginestatechange",VD:"mapviewchangestart",Ls:"mapviewchange",Ms:"mapviewchangeend",yl:"baselayerchange"};function zm(a,b){zm.g.constructor.call(this,ci,b);this.si(a)}u(zm,bi);t("H.map.Rect",zm);zm.prototype.si=function(a){if(!B(a,K))throw new C(this.si,0,a);a.da(this.Ti)||(this.Ti=this.J=a,this.Gb!==x&&zm.g.X.call(this,Bh(a)))};zm.prototype.setBoundingBox=zm.prototype.si;zm.prototype.C=function(){return this.J};zm.prototype.getBoundingBox=zm.prototype.C;zm.prototype.X=function(){return this};zm.prototype.setGeometry=zm.prototype.X;
zm.prototype.V=function(){this.Gb===ci&&zm.g.X.call(this,Bh(this.Ti));return this.Gb};zm.prototype.getGeometry=zm.prototype.V;function Am(a,b,c,d){if(!a||!b||!c)throw new C(Am,A,"Must specify name, version and revision parameter");this.name=a;this.version=b;this.revision=c;d&&Qa(this,d)}t("H.util.BuildInfo",Am);Am.prototype.toString=function(){var a,b=[];for(a in this)gb(this[a])&&b.push(this[a]);return b.join(";")};var Bm={};function Cm(a,b,c,d){if(!a)throw new C(Cm,1,"Must specify a name parameter");return Bm[a]||(Bm[a]=new Am(a,b,c,d))}Am.get=Cm;function Dm(){}t("H.util.ICharStream",Dm);Dm.prototype.next=function(){};Dm.prototype.yi=function(){};Dm.prototype.mh=function(){};Dm.prototype.cb=function(){};function Em(a){this.Ju=String(a);this.nw=0;this.Dc=[];this.Xf=!1}t("H.util.CharStream",Em);Em.prototype.next=function(){var a=this.Ju.charCodeAt(this.nw++);a=isNaN(a)?-1:a;this.Xf&&this.Dc.push(a);return a};Em.prototype.yi=function(){this.Xf=!0;this.Dc=[]};Em.prototype.mh=function(){var a=this.Dc.slice();this.Xf=!1;this.Dc=[];return a};Em.prototype.cb=function(){var a=this.Ju.charCodeAt(this.nw+0);return isNaN(a)?-1:a};function Fm(a,b,c){var d,e=6;if(b){for(d=' expected close to: "'+b;e--;)b=a.lt.next(),-1!==b&&(d+=String.fromCharCode(b));d+='"'}throw new C(Gm,0,"- Malformed WKT: "+(d?c+d:"unexpected end of stream"));}function Hm(a,b){var c=a.next();b=b?")":"(";c!==b&&Fm(a,c,'"'+b+'"')}function Im(a){return","===a.cb()?(a.next(),!0):!1}function Jm(a,b,c,d,e){var f,g,h=2+b+c;for(g=1;g<=h;g++)(c=a.next())?(f=+c)!==f?Fm(a,c,"number"):1===g?d[e+1]=f:2===g?d[e+0]=f:3===g&&(d[e+2]=f):Fm(a,c);b||(d[e+2]=0)}var Km=[];
function Lm(a,b,c,d){d||Hm(a,0);Jm(a,b,c,Km,0);d||Hm(a,1);return new Re(Km[0],Km[1],b?Km[2]:A)}function Mm(a,b,c){var d=[];Hm(a,0);do Jm(a,b,c,d,d.length);while(Im(a));Hm(a,1);return new N(d)}function Nm(a,b,c){Hm(a,0);var d=Mm(a,b,c);if(Im(a)){var e=[];do e.push(Mm(a,b,c));while(Im(a))}Hm(a,1);return new P(d,e)}
var Om=[],Pm=[Nm],Qm=[Lm],Rm={POINT:Qm,LINESTRING:[Mm],POLYGON:Pm,MULTIPOINT:[Lm,Xe],MULTILINESTRING:[Mm,vj],MULTIPOLYGON:[Nm,Ih],GEOMETRY:Om,GEOMETRYCOLLECTION:Om,CIRCULARSTRING:Om,COMPOUNDCURVE:Om,CURVEPOLYGON:Om,MULTICURVE:Om,MULTISURFACE:Om,CURVE:Om,SURFACE:Om,POLYHEDRALSURFACE:Om,TIN:Om,TRIANGLE:Om},Sm={Z:1,M:2,ZM:3};
function Gm(a){a=new Tm(a);var b;var c=a.next();(b=Rm[c.toUpperCase()])||Fm(a,c,"type name");if(b!==Om){c=a.cb();c=Sm[c.toUpperCase()];var d=c&1;var e=c>>1;d|e&&a.next();c=a.cb();if("EMPTY"===c)if(a.next(),d=b[1])var f=new d([]);else b!==Qm&&(f=new N([]),b===Pm&&(f=new P(f)));else if("("===c){f=b[0];b=b[1];if(b){var g=[];Hm(a,0);if(f===Lm){var h="("!==a.cb();do g.push(f(a,d,e,h));while(Im(a))}else{do g.push(f(a,d,e));while(Im(a))}Hm(a,1);d=new b(g)}else d=f(a,d,e);f=d}else Fm(a,c,'"Z", "M", "ZM", "(" or "EMPTY"');
a.next()&&Fm(a,c,"end of stream")}return f||x}function Tm(a){this.lt=a}Tm.prototype.cb=function(){var a=this.hw;if(a===A){for(a=this.lt;a.cb()===Um;)a.next();if(Vm[a.cb()])a=a.next(),a=a===Wm?"":String.fromCharCode(a);else{a.yi();do a.next();while(!Vm[a.cb()]);a=String.fromCharCode.apply(null,a.mh())}this.hw=a}return a};Tm.prototype.next=function(){var a=this.cb();""!==a&&delete this.hw;return a};
var Um=32,Wm=-1,Xm={ZD:Um,TD:40,YD:41,QD:44,RD:Wm},Vm=Object.keys(Xm).reduce(function(a,b){a[Xm[b]]=!0;return a},Ua());t("H.util.wkt.toGeometry",function(a){return Gm(new Em(a))});function Ym(){Ym.g.constructor.call(this);this.fd=Zm(this);this.En=Ua();this.pn=z(this.pn,this);this.fd.addEventListener("message",this.pn);this.fl={}}u(Ym,G);Ym.prototype.disposeInternal=function(){this.fd.terminate()};Ym.prototype.vw=function(a){var b=a.type,c=!!this.En[b],d=a.data,e=$m++,f=d&&d.HD?d.HD:A,g=!0;c?(this.fl[e]=a,an(this,b,e,d&&d.message,f)):(a.reject(new C(this.vw,0,"processor_not_found")),g=!1);return g};
Ym.prototype.pn=function(a){a=a.data;var b=this.fl[a.taskId],c=a.taskId,d=a.data,e=this;if(2===a.type)(new Qf("arraybuffer",d)).then(function(f){return f.arrayBuffer()}).then(function(f){e.fd.postMessage(["3",c,[f]],[f])},function(){e.fd.postMessage(["3",c,[null,"ERROR"]])});else{if(b){switch(a.type){case 1:b.resolve(d);break;case 0:b.reject(d)}delete this.fl[c]}this.dispatchEvent(new Jb(this.j.IDLE))}};var $m=0;function bn(a,b,c){var d=$m++,e;a.fl[d]=e=Gd();an(a,b,d,c);return e.promise}
function an(a,b,c,d,e){d===A||Ca(d)||(d=[d]);try{a.fd.postMessage([b,c,d],e)}catch(f){a=a.fl[c],a.reject(f.message)}}Ym.prototype.j={IDLE:"idle",Hs:"error"};Ym.prototype.oy=function(a,b){var c=this.fz||(this.fz=new Jb(this.j.Hs));c.data=b;delete this.En[a];this.dispatchEvent(c)};Ym.prototype.importScripts=function(a){bn(this,"0",a)};
function Zm(a){var b=globalThis.H.__bootstrap__;b=Za(b)?(""+b).replace(/^[^{]+{((.|[\r\n])+?)}\s*$/,"$1"):""+b;if(globalThis.Worker&&globalThis.URL)try{var c=new globalThis.Worker(globalThis.URL.createObjectURL(we(b,"application/javascript")))}catch(d){}c||(a=new cn(a),function(){eval("var self = arguments[0];"+b)}(a),c=new dn(a));return c}function dn(a){G.call(this);this.fd=a}u(dn,G);dn.prototype.postMessage=function(a){globalThis.setTimeout(z(this.zC,this,a),0)};
dn.prototype.zC=function(a){var b=new Jb("message");b.data=a;this.fd.dispatchEvent(b)};dn.prototype.terminate=function(){this.fd.l();this.l()};function cn(a){G.call(this);this.fd=a;this.addEventListener=z(this.addEventListener,this);this.removeEventListener=z(this.removeEventListener,this);this.postMessage=z(this.postMessage,this);this.eval=z(eval,this)}u(cn,G);cn.prototype.postMessage=function(a){var b=new Jb("message");b.data=a;globalThis.setTimeout(z(this.fd.pn,this.fd,b),0)};function en(){var a=fn;a||(a=fn=this,G.call(a),this.zg());return a}var fn;u(en,G);m=en.prototype;m.disposeInternal=function(){en.g.disposeInternal.call(this);this.zg()};m.zg=function(){var a=this.qo,b;if(a)for(b=a.length;b--;)a[b].l();this.qo=[];mb(this.qo);this.Em={};this.xw=Ua()};
m.Go=function(a){var b;a=a.type;if(b=this.xw[a]){var c=this.qo;var d=c[0];d||(d=c[0]=new Ym,this.ac(Ja(xb,d)),Ma(this.Em)||d.importScripts(globalThis.Object.keys(this.Em)));c=d;c.En[a]||(c.En[a]=b,bn(c,"1",[a,Za(b)?b+"":b]).then(oe,z(c.oy,c,a)))}else throw new vb(this.Go,'Unknown type "'+a+'"');return d};m.am=function(){};m.registerProcessor=function(a,b){var c=this.xw,d=c[a];if(d){if(b!==d)throw new vb(this.registerProcessor,'Type "'+a+'" is already registered');}else c[a]=b};
m.importScripts=function(a){[].concat(a).forEach(function(b){this.Em[b]||(this.Em[b]=!0,this.qo.forEach(function(c){c.importScripts(b)}))},this)};function gn(a,b,c){Ud.call(this,a,b,c)}var hn;u(gn,Ud);gn.prototype.Gp=function(){hn||(hn=new Xd(new en));return hn};gn.prototype.Xi=function(){};gn.prototype.Pt=function(a){return a.vw(this)};t("H.buildInfo",function(){return Cm("H-core","1.63.0","d08e47f",{region:"row"})});var lg=mg.WEBGL,jn,kn="maps".concat("js-"),ln,mn,nn,on,pn;ln=globalThis.document.querySelector('script[src*="'+kn+'"]');if(!ln)for(mn=globalThis.document.getElementsByTagName("script"),on=new RegExp("^.*"+kn),pn=0,nn=mn.length;pn<nn;pn++)if(on.test(mn[pn].src)){ln=mn[pn];break}jn=ln?ln.src.replace(/\/[^\/]*$/,"/"):"";t("H.getScriptPath",function(){return jn});
function qn(){var a=decodeURIComponent(jn);if(a){a="/"===a[a.length-1]?a.substring(0,a.length-1):a;var b=globalThis.document,c="";b?(b=b.createElement("a"),b.href=a,c=b.href):/[\w]+:\/\//.test(a)&&(c=a);a=new URL(c);a.pathname+="/"===a.pathname[a.pathname.length-1]?"styles":"/styles";a=a.toString()}else a="https://js.api.here.com/v3/3.1.63.0/styles";return a}t("H.getStylePath",qn);

function rn(a,b,c,d,e,f,g){rn.g.constructor.call(this,a);this.pointers=b;this.changedPointers=c;this.targetPointers=d;this.currentPointer=e;this.originalEvent=g;this.target=f}u(rn,Jb);t("H.mapevents.Event",rn);function sn(a,b){b=void 0===b?{}:b;var c;sn.g.constructor.call(this);if(-1!==tn.indexOf(a))throw new C(sn,0,"events are already used");this.s=c=a.s;this.qv=a;tn.push(a);c.draggable=!0;this.ua=b.kinetics||{duration:600,ease:el};this.QB=b.modifierKey||"Alt";this.enable(b.enabled);this.Fi=c.ra;this.tl=this.Fi.element;this.Sm=0;c.addEventListener("dragstart",this.Ad,!1,this);c.addEventListener("drag",this.hg,!1,this);c.addEventListener("dragend",this.df,!0,this);c.addEventListener("wheel",this.Xv,!1,
this);c.addEventListener("dbltap",this.Kv,!1,this);c.addEventListener("pointermove",this.he,!1,this);Xb(this.tl,"contextmenu",this.cn,!1,this);a.ac(this.l,this)}u(sn,yb);t("H.mapevents.Behavior",sn);var tn=[];mb(tn);sn.prototype.Qb=0;var un={PANNING:1,PINCH_ZOOM:2,WHEEL_ZOOM:4,DBL_TAP_ZOOM:8,FRACTIONAL_ZOOM:16,TILT:32,HEADING:64};sn.Feature=un;var vn=un.PANNING,wn=un.PINCH_ZOOM,xn=un.WHEEL_ZOOM,yn=un.DBL_TAP_ZOOM,zn=un.FRACTIONAL_ZOOM,An=un.TILT,Bn=un.HEADING,Cn=vn|wn|xn|yn|zn|An|Bn;
sn.DRAGGING=vn;sn.WHEELZOOM=xn;sn.DBLTAPZOOM=yn;sn.FRACTIONALZOOM=zn;function Dn(a,b){if(a!==+a||a%1||0>a||2147483647<a)throw new C(b,0,"integer in range [0...0x7FFFFFFF] required");}sn.prototype.disable=function(a){var b=this.Qb;a!==A?(Dn(a,this.disable),b^=b&a):b=0;this.Fi.endInteraction(!0);this.Qb=b;this.s.draggable=0<(b&(vn|An|Bn|wn))};sn.prototype.disable=sn.prototype.disable;
sn.prototype.enable=function(a){var b=this.Qb;a!==A?(Dn(a,this.enable),b|=a&Cn):b=Cn;this.Qb=b;this.s.draggable=0<(b&(vn|An|Bn|wn))};sn.prototype.enable=sn.prototype.enable;sn.prototype.isEnabled=function(a){Dn(a,this.isEnabled);return a===(this.Qb&a)};sn.prototype.isEnabled=sn.prototype.isEnabled;
function En(a,b,c){var d="touch"===b.currentPointer.type,e=0,f;if(f=!d){f=a.QB;var g=b.originalEvent;f=g.getModifierState?g.getModifierState(f):!!g[f.replace(/^Control$/,"ctrl").toLowerCase()+"Key"]}f?e|=An|Bn:(e|=vn,d&&(b=b.pointers,2===b.length&&(e|=wn|Bn,c?55>Ec(b[0].viewportY-b[1].viewportY)&&(e|=An):a.hq&Wk.TILT&&(e|=An))));e&=a.Qb;return(e&An?Wk.TILT:0)|(e&Bn?Wk.HEADING:0)|(e&wn?Wk.ZOOM:0)|(e&vn?Wk.COORD:0)}
function Fn(a){var b=a.pointers;a=b[0];b=b[1];a=[a.viewportX,a.viewportY];b&&a.push(b.viewportX,b.viewportY);return a}m=sn.prototype;m.hq=0;m.Ad=function(a){var b=En(this,a,!0);if(this.hq=b){var c=this.Fi;a=Fn(a);c.startInteraction(b,this.ua);c.interaction.apply(c,a);if(this.Qb&xn&&!(this.Qb&zn)&&(b=a[0],c=a[1],this.Sm)){a=this.s.Tb();var d=(0>this.Sm?Dc:Cc)(a);a!==d&&(this.Sm=0,this.Ii(a,d,b,c))}}};
m.hg=function(a){var b=En(this,a,!1);if(b!==this.hq)"pointerout"!==a.originalEvent.type&&"pointerover"!==a.originalEvent.type&&(this.df(a),this.Ad(a));else if(b){b=this.Fi;var c=Fn(a);b.interaction.apply(b,c);a.originalEvent.preventDefault()}};m.df=function(a){En(this,a,!1)&&this.Fi.endInteraction(!this.ua)};
m.Ii=function(a,b,c,d){var e=this.s.va;if(isNaN(+a))throw Error("start zoom needs to be a number");if(isNaN(+b))throw Error("to zoom needs to be a number");0!==+b-+a&&(e.startControl(null,c,d),e.control(0,0,6,0,0,0),e.endControl(!0,function(f){f.zoom=b}))};m.Wv=function(a){return a};m.Vv=-1/0;m.Sv=0;m.Uv=[];m.Tv=0;
m.Xv=function(a){var b=this;if(!a.defaultPrevented&&this.Qb&xn){var c=a.originalEvent,d=c.deltaY,e=Math.abs(d),f=this.Tv,g=!!(this.Qb&zn),h=this.Uv,k=c.timeStamp,l=cd(k-this.Vv,5,150);this.Vv=k;k=window.devicePixelRatio;if(this.s.wa.type===mg.P2D)d=this.s.Tb(),f=a.delta,c=g?d-f:(0>-f?Dc:Cc)(d)-f,this.Ii(d,c,a.viewportX,a.viewportY),this.Sm=f;else{if(150<=l){f=0;var n=function(w){return w},p=!(d%1);if(c.ctrlKey&&!p)f=1,n=function(w){return w*(sc?40:20)};else if(qc&&p&&(!mc||e%16))f=2,n=function(w){return Math.pow(w,
1.5)};else if(rc&&100>e)f=3,n=function(w){return g?Math.pow(w+1,2):.4*(w+1)};else if(sc&&(mc&&e%138||nc&&e*k%120))f=4;else if(qc)mc&&16<=e&&!(e%16)?(f=6,n=function(w){return 1.5*Math.pow(w/16,1.937)}):(nc||oc||lc)&&4.000244140625===e&&(f=7,n=function(w){return w/e});else if(rc&&!(e%100&&(!mc||e%102))||sc&&(nc&&!(e*k%120)||mc&&!(e%138)))f=8,h.length=0,n=function(w){var y=b.Uv,D=y.length;D=1<D?y.reduce(function(F,O,R){return R?F+O:0},0)/(D-1):y[0];return w/e*5*Math.pow(150/D,1+yc(7,y.length)/(150/D))};
this.Tv=f;this.Wv=n}8===f&&h.push(l);c=1===f;f=2===f||3===f||4===f;h=yc(f?100:200,this.Wv(e));var q=this.s.va;q.startControl(null,a.viewportX,a.viewportY);var r=0>d?-1:1;q.control(0,0,.1*-r*(g?h:5*cd(h,5,33)),0,0,0);var v=c||f&&!sc;clearTimeout(this.Sv);this.Sv=setTimeout(function(){q.endControl(v,function(w){g||(w.zoom=(0>r?Dc:Cc)(w.zoom))})},150)}a.preventDefault()}};m.he=function(){};
m.Kv=function(a){var b=a.currentPointer,c=this.s.Tb(),d=a.currentPointer.type,e=this.s.wa.type;(e===mg.P2D||e===mg.WEBGL||e===mg.HARP)&&this.Qb&yn&&(a="mouse"===d?0===a.originalEvent.button?-1:1:0<a.pointers.length?1:-1,a=this.Qb&zn?c-a:(0>-a?Dc:Cc)(c)-a,this.Ii(c,a,b.viewportX,b.viewportY))};m.cn=function(a){return this.Qb&yn?(a.preventDefault(),!1):!0};
m.l=function(){var a=this.s;a&&(a.draggable=!1,a.removeEventListener("dragstart",this.Ad,!1,this),a.removeEventListener("drag",this.hg,!1,this),a.removeEventListener("dragend",this.df,!0,this),a.removeEventListener("wheel",this.Xv,!1,this),a.removeEventListener("dbltap",this.Kv,!1,this),a.removeEventListener("pointermove",this.he,!1,this),delete this.s);this.tl&&(this.tl.style.msTouchAction="",ec(this.tl,"contextmenu",this.cn,!1,this),delete this.tl);delete this.Fi;delete this.ua;tn.splice(tn.indexOf(this.qv),
1);delete this.qv;yb.prototype.l.call(this)};sn.prototype.dispose=sn.prototype.l;function Gn(a){var b=a.ownerDocument;b=b.documentElement||b.body.parentNode||b.body;try{var c=a.getBoundingClientRect()}catch(d){c={top:0,right:0,bottom:0,left:0,height:0,width:0}}return{x:c.left+("number"===typeof window.pageXOffset?window.pageXOffset:b.scrollLeft),y:c.top+("number"===typeof window.pageYOffset?window.pageYOffset:b.scrollTop)}};function Hn(a,b,c,d,e,f){if(isNaN(a))throw Error("x needs to be a number");if(isNaN(b))throw Error("y needs to be a number");if(isNaN(c))throw Error("pointer must have an id");this.viewportX=a;this.viewportY=b;this.target=null;this.id=c;this.type=d;this.dragTarget=null;this.button=ab(e)?e:-1;this.buttons=ab(f)?f:0;this.Qm=this.button}t("H.mapevents.Pointer",Hn);
function In(a,b,c){if(isNaN(b))throw Error("x needs to be a number");if(isNaN(c))throw Error("y needs to be a number");a.viewportX=b;a.viewportY=c}Hn.prototype.eA=function(){return this.Qm};Hn.prototype.getLastChangedButton=Hn.prototype.eA;function Jn(a,b){a.Qm=b;a.buttons|=Kn[+b]||0}function Ln(a,b){a.Qm=b;a.buttons&=~(Kn[+b]||0)}var Kn=[1,4,2],Mn={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2};Hn.Button=Mn;function Nn(a){this.Ea=a instanceof Array?a.slice(0):[]}m=Nn.prototype;m.clear=function(){this.Ea.splice(0,this.Ea.length)};m.length=function(){return this.Ea.length};m.item=function(a){return this.Ea[a]||null};m.indexOf=function(a){for(var b=this.Ea.length;b--;)if(this.Ea[b].id===a)return b;return-1};function On(a,b){b=a.indexOf(b);return-1!==b?a.Ea[b]:null}m.remove=function(a){a=this.indexOf(a);return-1!==a?this.Ea.splice(a,1)[0]:null};
function Pn(a,b){for(var c=a.Ea.length,d=[];c--;)a.Ea[c].type!==b&&d.push(a.Ea[c]);a.Ea=d}function Qn(a,b){for(var c=a.Ea.length;c--;)if(a.Ea[c].dragTarget===b)return!0;return!1}m.push=function(a){if(a instanceof Hn)return this.Ea.push(a);throw Error("list needs a pointer");};m.Sa=function(){return this.Ea};m.clone=function(){return new Nn(this.Ea)};function Rn(a,b,c){c=c||{};if(!(a instanceof V))throw Error("events: map instance required");if(!(b instanceof Array))throw Error("events: map array required");yb.call(this);this.hp=c.hp||300;this.xt=c.xt||50;this.sx=c.sx||50;this.tx=c.tx||500;this.Dq=c.Dq||900;this.Cq=c.Cq||8;this.map=a;this.Ba=this.map.ra;this.element=this.Ba.element;this.pp=b;this.pointers=new Nn;this.changedPointers=new Nn;this.Zf={};this.Ka=null;this.fm=!0;this.Ok={};this.rf={};this.ck=null;this.nj=z(this.nj,this);this.Ot={pointerdown:this.Zy,
pointermove:this.$y,pointerup:this.az,pointercancel:this.Yy};Sn(this)}u(Rn,yb);function Sn(a,b){var c,d=a.pp.length;for(c=0;c<d;c++){var e=a.pp[c];var f=e.listener;"function"===typeof f&&(b?(e.target||a.element).removeEventListener(e.Za,f):(e.target||a.element).addEventListener(e.Za,f))}}
function Tn(a,b,c){var d;if("function"===typeof a.Ot[b]){"pointermove"!==b&&(a.fm=!0);var e=0;for(d=a.changedPointers.length();e<d;e++){var f=a.changedPointers.item(e);a.element.contains(c.composedPath()[0])?Un(a,f,a.Gt.bind(a,c,b,f)):a.Gt(c,b,f,null)}}a.changedPointers.clear()}m=Rn.prototype;m.Gt=function(a,b,c,d){Vn(c.id,this.Ok);this.Ot[b].call(this,c,d,a)};
function Un(a,b,c){if(a.Ka===b)c(b.target);else{var d=a.Ba;var e=b.viewportX;b=b.viewportY;if(0>e||0>b||e>=d.width||b>=d.height)c(x);else{var f=a.map;f.Bh(e,b,function(g){c(g||f)})}}}
m.az=function(a,b,c){var d=a.id;a.target=b;Wn(this,a,c);Xn(this,b,"pointerup",c,a);"mouse"!==a.type&&Xn(this,b,"pointerleave",c,a);b=this.Zf[a.id];var e={x:a.viewportX,y:a.viewportY},f=c.timeStamp,g=a.target,h=this.ck;b&&b.target===g&&b.wk.ib(e)<this.sx&&f-b.os<this.tx?(Xn(this,g,"tap",c,a),h&&h.target===g&&f-h.os<this.hp?h.wk.ib({x:a.viewportX,y:a.viewportY})<this.xt&&(Xn(this,g,"dbltap",c,a),this.ck=null):this.ck={target:g,wk:new L(a.viewportX,a.viewportY),os:c.timeStamp}):this.ck=null;this.Zf=
{};Vn(d,this.rf)};function Wn(a,b,c){b===a.Ka&&(Xn(a,b.dragTarget,"dragend",c,b),a.Ka=null,Vn(b.id,a.Ok));b.dragTarget=null}m.nj=function(a,b){var c=this;Xn(this,a.dragTarget,"drag",b,a);Vn(a.id,this.Ok);this.Ok[a.id]=setTimeout(function(){c.nj(a,b)},150)};function Vn(a,b){b[a]&&(b[a].timeout?clearTimeout(b[a].timeout):clearTimeout(b[a]),delete b[a])}
function Yn(a,b,c){var d=b.target,e=new L(b.viewportX,b.viewportY),f=b.id;Vn(f,a.rf);var g=setTimeout(function(){d&&d===b.target&&e.ib({x:b.viewportX,y:b.viewportY})<a.Cq&&(Xn(a,d,"longpress",c,b),delete a.Zf[b.id])},a.Dq);a.rf[f]={timeout:g,wk:e}}
m.$y=function(a,b,c){var d=a.dragTarget,e=a.id;var f=a.target;a.target=b;f!==b&&(Xn(this,f,"pointerleave",c,a),Xn(this,b,"pointerenter",c,a));d?this.Ka?(this.nj(a,c),this.rf[e]&&this.rf[e].wk.ib({x:a.viewportX,y:a.viewportY})>this.Cq&&Vn(e,this.rf)):this.fm?this.fm=!1:(this.Ka=a,Xn(this,d,"dragstart",c,a),this.nj(a,c),delete this.Zf[e],this.fm=!0):(!this.Ka||this.Ka&&this.Ka.dragTarget!==b&&this.Ka.dragTarget!==this.map)&&Xn(this,b,"pointermove",c,a)};
m.Zy=function(a,b,c){var d=!(/^(?:mouse|pen)$/.test(a.type)&&0!==c.button);if(b){a.target=b;this.Zf[a.id]={wk:new L(a.viewportX,a.viewportY),target:a.target,os:c.timeStamp};"mouse"!==a.type&&Xn(this,b,"pointerenter",c,a);var e=Xn(this,b,"pointerdown",c,a);!this.Ka&&d&&(b.draggable&&!Qn(this.pointers,b)?a.dragTarget=b:!this.map.draggable||e.defaultPrevented||Qn(this.pointers,this.map)||(a.dragTarget=this.map));Yn(this,a,c)}};
m.Yy=function(a,b,c){var d=a.id;a.target=null;b?(Xn(this,b,"pointerleave",c,a),Xn(this,b,"pointercancel",c,a)):Xn(this,this.map,"pointercancel",c,a);Wn(this,a,c);this.Zf={};Vn(d,this.rf)};
function Xn(a,b,c,d,e){if(b&&"function"===typeof b.dispatchEvent){var f=rn;var g=a.pointers.Sa(),h=a.changedPointers.Sa();a=a.pointers;var k,l=a.Ea.length,n=[];for(k=0;k<l;k++)a.Ea[k].target===b&&n.push(a.Ea[k]);f=new f(c,g,h,n,e,b,d);e.button=/^(?:longpress|(?:dbl)?tap|pointer(?:down|up))$/.test(c)?e.Qm:Mn.NONE;b.dispatchEvent(f)}return f}
m.disposeInternal=function(){Sn(this,!0);this.pointers.clear();this.changedPointers.clear();var a=this.Ok,b;for(b in a)Vn(b,a);a=this.rf;for(var c in a)Vn(c,a);delete this.element;delete this.pp;delete this.pointers;delete this.changedPointers;delete this.map;this.ck=null;delete this.Zf;this.Ka=null;yb.prototype.disposeInternal.call(this)};function Zn(a){var b=$n(this);(window.PointerEvent||window.MSPointerEvent)&&b.push({Za:"MSHoldVisual",listener:"prevent"});Rn.call(this,a,b)}u(Zn,Rn);function $n(a){var b=!!window.PointerEvent,c,d,e=[];a.$p=z(a.$p,a);"MSPointerDown MSPointerMove MSPointerUp MSPointerCancel MSPointerOut MSPointerOver".split(" ").forEach(function(f){c=f.toLowerCase().replace(/ms/g,"");d=b?c:f;e.push({Za:d,listener:a.$p,target:/^pointer(up|move)$/.test(c)?window:null})});return e}var ao={2:"touch",3:"pen",4:"mouse"};
Zn.prototype.bp=function(a,b){var c=a.pointerType;"number"===typeof c&&(c=ao[c]);a=new Hn(b.x,b.y,a.pointerId,c,a.button,a.buttons);this.pointers.push(a);return a};
Zn.prototype.$p=function(a){var b=window.PointerEvent?a.type:a.type.toLowerCase().replace(/ms/g,""),c=Gn(this.element),d=On(this.pointers,a.pointerId),e=a.pageX-c.x;c=a.pageY-c.y;var f=ao[a.pointerType]||a.pointerType;lc&&"rtl"===globalThis.getComputedStyle(this.Ba.element).direction&&(e-=(globalThis.devicePixelRatio-1)*this.Ba.width);d||/^pointer(up|out|cancel)$/.test(b)||"touch"===f&&"pointerdown"!==b||(d=this.bp(a,{x:e,y:c}));if(d)if(/^pointer(up|cancel)$/.test(b)?("touch"===f&&this.pointers.remove(d.id),
Ln(d,a.button)):"pointerdown"===b&&("touch"===a.pointerType&&(Pn(this.pointers,"mouse"),Pn(this.pointers,"pen")),Jn(d,a.button)),this.changedPointers.push(d),"pointermove"!==b)In(d,e,c),Tn(this,/^pointer(over|out)$/.test(b)?"pointermove":b,a);else if(d.viewportX!==e||d.viewportY!==c)In(d,e,c),Tn(this,b,a);this.changedPointers.clear()};function bo(a,b,c,d){bo.g.constructor.call(this,"contextmenu");this.items=[];this.viewportX=a;this.viewportY=b;this.target=c;this.originalEvent=d}u(bo,Jb);t("H.mapevents.ContextMenuEvent",bo);function co(a){this.Xp=z(this.Xp,this);this.Zp=z(this.Zp,this);this.Yp=z(this.Yp,this);this.sn=!1;this.ih=-1;this.gv=0;co.g.constructor.call(this,a,[{Za:"contextmenu",listener:this.Xp},{target:a,Za:"longpress",listener:this.Zp},{target:a,Za:"dbltap",listener:this.Yp}])}u(co,Rn);m=co.prototype;m.Zp=function(a){var b=a.currentPointer;"touch"===b.type&&1===a.pointers.length&&eo(this,b.viewportX,b.viewportY,a.originalEvent,a.target)};m.Yp=function(a){"touch"===a.currentPointer.type&&(this.gv=Date.now())};
m.Xp=function(a){var b=this;-1===this.ih?this.ih=setTimeout(function(){var c=Gn(b.element),d=a.pageX-c.x;c=a.pageY-c.y;b.ih=-1;eo(b,d,c,a)},this.hp):(clearInterval(this.ih),this.ih=-1);a.preventDefault()};function eo(a,b,c,d,e){var f=a.map,g=Date.now()-a.gv;e?!a.sn&&g>a.Dq&&(a.sn=!0,e.dispatchEvent(new bo(b,c,e,d)),Yb(f.B(),fo,a.Ft,!1,a)):f.Bh(b,c,a.Mp.bind(a,b,c,d))}m.Mp=function(a,b,c,d){eo(this,a,b,c,d&&Za(d.dispatchEvent)?d:this.map)};
m.Ft=function(){this.sn&&(this.sn=!1,this.map.dispatchEvent(new Jb("contextmenuclose",this.map)))};m.disposeInternal=function(){var a=this.map.B();clearInterval(this.ih);a&&ec(a,fo,this.Ft,!1,this);Rn.prototype.disposeInternal.call(this)};var fo=["mousedown","touchstart","pointerdown","wheel"];function go(a){this.Gh=z(this.Gh,this);Rn.call(this,a,[{Za:"touchstart",listener:this.Gh},{Za:"touchmove",listener:this.Gh},{Za:"touchend",listener:this.Gh},{Za:"touchcancel",listener:this.Gh}]);this.Gx={touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",touchcancel:"pointercancel"};this.Hu=(a=(a=a.Xd)?a.B():null)?Array.prototype.slice.call(a.querySelectorAll("a"),0):[]}u(go,Rn);
go.prototype.Gh=function(a){var b=a.touches,c=this.pointers.length(),d;if("touchstart"===a.type&&c>=b.length){c=this.pointers.clone();for(d=b.length;d--;)c.remove(b[d].identifier);for(d=c.length();d--;)this.pointers.remove(c.item(d).id);this.changedPointers=c;Tn(this,"pointercancel",a);this.changedPointers.clear()}if(this.Gx[a.type]){b=Gn(this.Ba.element);c=a.type;d=a.changedTouches;var e=d.length,f;this.changedPointers.clear();for(f=0;f<e;f++){var g=d[f];var h=On(this.pointers,g.identifier);var k=
g.pageX-b.x;var l=g.pageY-b.y;if(h)if("touchmove"===c){g=Math.abs(h.viewportX-k);var n=Math.abs(h.viewportY-l);if(1<g||1<n||1===g&&1===n)In(h,k,l),this.changedPointers.push(h)}else"touchend"===c&&(this.pointers.remove(h.id),this.changedPointers.push(h),Ln(h,Mn.LEFT));else h=new Hn(k,l,g.identifier,"touch",Mn.LEFT,1),this.pointers.push(h),this.changedPointers.push(h)}Tn(this,this.Gx[a.type],a);-1===this.Hu.indexOf(a.target)&&a.preventDefault()}};
go.prototype.disposeInternal=function(){this.Hu=null;Rn.prototype.disposeInternal.call(this)};function ho(a){this.Tf=z(this.Tf,this);Rn.call(this,a,[{Za:"mousedown",listener:this.Tf},{Za:"mousemove",listener:this.Tf,target:window},{Za:"mouseup",listener:this.Tf,target:window},{Za:"mouseover",listener:this.Tf},{Za:"mouseout",listener:this.Tf},{Za:"dragstart",listener:this.oC}])}u(ho,Rn);ho.prototype.bp=function(a){a=new Hn(a.x,a.y,1,"mouse");this.pointers.push(a);return a};
ho.prototype.Tf=function(a){var b=a.type,c=Gn(this.element),d={x:a.pageX-c.x,y:a.pageY-c.y};c=this.pointers.item(0)||this.bp(d);this.changedPointers.push(c);In(c,d.x,d.y);/^mouse(?:move|over|out)$/.test(b)?Tn(this,"pointermove",a):(/^mouse(down|up)$/.test(b)&&(d=a.which-1,"up"===globalThis.RegExp.$1?Ln(c,d):Jn(c,d)),Tn(this,b.replace("mouse","pointer"),a));this.changedPointers.clear()};ho.prototype.oC=function(a){a.preventDefault()};function io(a,b,c,d,e){io.g.constructor.call(this,"wheel");this.delta=a;this.viewportX=b;this.viewportY=c;this.target=d;this.originalEvent=e}u(io,Jb);t("H.mapevents.WheelEvent",io);function jo(a){var b="onwheel"in document;this.hy=b;this.ey=(b?"d":"wheelD")+"elta";this.aq=z(this.aq,this);jo.g.constructor.call(this,a,[{Za:(b?"":"mouse")+"wheel",listener:this.aq}]);this.ra=this.map.ra}u(jo,Rn);
jo.prototype.normalize=function(a,b,c){var d=this.ey,e=a[d+(d+"Y"in a?"Y":"")],f;lc&&"rtl"===globalThis.getComputedStyle(this.ra.element).direction&&(b-=(globalThis.devicePixelRatio-1)*this.ra.width);if(e){var g=Math.abs;var h=g(e);e=(!(f=a[d+"X"])||3<=h/g(f))&&(!(f=a[d+"Z"])||3<=h/g(f))?(+(0<e)-+(0>e))*(this.hy?1:-1):0}return new io(e,b,c,null,a)};
jo.prototype.aq=function(a){if(!a.Vx){var b=Gn(this.element);b=this.normalize(a,a.pageX-b.x,a.pageY-b.y);b.delta&&(a.stopImmediatePropagation(),a.preventDefault(),this.map.Bh(b.viewportX,b.viewportY,this.Mp.bind(this,b)))}};jo.prototype.Mp=function(a,b){var c=a.target=b||this.map,d,e;setTimeout(function(){c.dispatchEvent(a);a.defaultPrevented||(d=a.originalEvent,e=new globalThis.WheelEvent("wheel",d),e.Vx=!0,d.target.dispatchEvent(e))},0)};function ko(a){var b=a.ra.element.style;if(-1!==lo.indexOf(a))throw Error("InvalidArgument: map is already in use");this.s=a;lo.push(a);b.msTouchAction=b.touchAction="none";pc||!window.PointerEvent&&!window.MSPointerEvent?(this.Fx=new go(this.s),this.Cv=new ho(this.s)):this.Fx=new Zn(this.s);this.ND=new jo(this.s);this.Jy=new co(this.s);this.s.ac(this.l,this);yb.call(this)}u(ko,yb);t("H.mapevents.MapEvents",ko);var lo=[];mb(lo);
ko.prototype.l=function(){delete this.s;this.Fx.l();this.ND.l();this.Jy.l();this.Cv&&this.Cv.l();lo.splice(lo.indexOf(this.s),1);yb.prototype.l.call(this)};ko.prototype.dispose=ko.prototype.l;ko.prototype.Az=function(){return this.s};ko.prototype.getAttachedMap=ko.prototype.Az;t("H.mapevents.buildInfo",function(){return Cm("H-mapevents","1.63.0","d08e47f",{region:"row"})});

T.prototype.$n=da(3,function(a){var b=this.getCache(),c=this;if(a!==x){B(a,bj,T.prototype.$n,0);var d=a}else d=xk;d!==b&&b.ia(function(e,f,g){return c.bc(e)?(d.add(e,f,g),!0):!1});this.ht=d});Wf.prototype.Xb=da(0,function(a){this.rs=a;a=this.getState();a!==hf.INIT&&a!==hf.LOADING&&cg(this)});function mo(a){a=a.Td("_#-;,:","_#-;,:","_#-;,:");return new RegExp("^"+a.replace(/[.*+?^${}()|[\]\\\/]/g,"\\$&").replace(/_#-;,:/g,"\\d+")+"$")}function no(a,b){Qa.apply(null,arguments);return a}
function oo(a,b){var c=globalThis.console;c&&c.warn&&(a=cb(a)+" is deprecated and will be removed soon. ",b&&(a+=b),c.warn(a))}var po={};function qo(){}qo.prototype.pop=function(a){this[a]||(this[a]=[]);return this[a].pop()||document.createElement("canvas")};qo.prototype.push=function(a,b){this[b]||(this[b]=[]);this[b].push(a)};var ro=new qo;t("H.service.util.eval",function(a){return eval(a)});function so(a,b){b=void 0===b?{}:b;if(!a.Im)throw new vb(a);so.g.constructor.call(this);var c=to(this,b);if(!c.baseUrl&&!c.platformBaseUrl)throw new C(a,0,'either "baseUrl" or "platformBaseUrl" must be specified');this.xc=(c.baseUrl?c.baseUrl:c.platformBaseUrl).clone();a=c.baseUrl?b:c;a.host&&this.xc.Rk(a.host);a.subDomain&&this.xc.sa(a.subDomain);a.path&&this.xc.vc(a.path);uo(this.xc);this.oc=c.headers||{}}u(so,G);t("H.service.Service",so);function to(a,b){a=a.ya();return b?no({},a,b):a}
so.prototype.ya=function(){return{}};so.prototype.i=function(){return this.xc};so.prototype.getUrl=so.prototype.i;so.prototype.u=function(a,b,c,d){d=new Qf(void 0===d?"application/json":d,a.toString(),Vd,{headers:this.oc});d.then(b,vo(this,a,c));return d};function vo(a,b,c){return function(d){return"function"!==typeof d.json?Promise.reject(c(wo(b,d))):d.json().then(function(e){return c(a.Ic(e))},function(){return c(wo(b,d))})}}so.prototype.Ic=function(a){return Error(a.message)};
function wo(a,b){return Error((b.statusText?"["+b.statusText+"] ":"")+a+" request failed")};function xo(a){xo.g.constructor.call(this,xo,a)}u(xo,so);t("H.service.WaypointsSequenceService",xo);xo.CONFIG_KEY="waypointsSequence";xo.prototype.lz=function(a,b,c){a=this.i().clone().sa("wps").vc("v8/findsequence2").v(a);return this.u(a,b,c)};xo.prototype.findSequence=xo.prototype.lz;function yo(a,b){B(a,zo,yo,0);var c={};Object.assign(c,b);c.min=c.min||0;c.max=c.max||20;c.tileSize=c.tileSize||512;c.getURL=function(d,e,f){return a.Rf(d,e,f).clone().v({size:c.tileSize})};wl.call(this,c);this.$=a}u(yo,wl);t("H.service.rasterTile.Provider",yo);yo.prototype.U=function(a,b){var c=this.$;return c.U().query(c.Ci.Tn+"."+c.K(),b,a)};yo.prototype.getCopyrights=yo.prototype.U;yo.prototype.Wi=function(){return kk()};yo.prototype.rd=function(){return kk()?jk():yo.g.rd.call(this)};function W(a,b,c,d,e,f){if(a&&b)this.$r(a),this.Rk(b),this.vc(c),this.Wr(e),this.Tw(f),this.Uk(d);else throw new C(W,A,'Parameters "scheme" and "host" must be specified');}t("H.service.Url",W);
function Ao(a,b){var c=globalThis.document,d;var e="";if(c){e=c.createElement("a");if(b){var f=(d=c.getElementsByTagName("base")[0])&&d.href;var g=c.head;var h=d||g.appendChild(c.createElement("base"));h.href=b}e.href=a;e=e.href;b&&(d?d.href=f:g.removeChild(h))}else/[\w]+:\/\//.test(a)&&(e=a);f=/(?:(\w+):\/\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\/[^?#]*)?(\?[^#]+)?(#.*)?/.exec(e);a=f[1];g=f[4];b=f[5];h=f[6];c=f[7];d=f[8];!f[2]&&g&&/@/.test(g)&&(g=g.split("@")[1]);f=W;h=h&&0<h.length?
h.substr(1):"";e={};var k,l;if(c)for(k=/([?&]?([^=&+]+))(=([^&]+))?/g;l=k.exec(c);)e[decodeURIComponent(l[2])]=l[4]?decodeURIComponent(l[4]):void 0;return new f(a,g,h,e,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):"")}W.parse=Ao;W.prototype.clone=function(){var a={},b;for(b in this.Ga)a[b]=this.Ga[b];return new W(this.oi,this.Rj,this.hf,a,this.vk,this.Cb)};W.prototype.clone=W.prototype.clone;
W.prototype.$r=function(a){if(!a||"string"!==typeof a)throw new C(this.$r,0,'The "scheme" parameter must be a non-empty string.');this.oi=a;return this};W.prototype.setScheme=W.prototype.$r;W.prototype.HA=function(){return this.oi};W.prototype.getScheme=W.prototype.HA;W.prototype.Rk=function(a){if(!a||"string"!==typeof a||"-"===a.charAt(0)||"."===a.charAt(0)||"."===a.charAt(a.length-1))throw new C(this.Rk,0,'The "host" parameter is not a valid host name.');this.Rj=a;return this};
W.prototype.setHost=W.prototype.Rk;W.prototype.$z=function(){return this.Rj};W.prototype.getHost=W.prototype.$z;W.prototype.vc=function(a){this.hf=a||void 0;return this};W.prototype.setPath=W.prototype.vc;W.prototype.tA=function(){return this.hf};W.prototype.getPath=W.prototype.tA;W.prototype.Uk=function(a){if(a)if("object"==typeof a)this.Ga=a;else throw new C(this.Uk,0,'Parameter "params" must be an object.');else this.Ga={};return this};W.prototype.setQuery=W.prototype.Uk;W.prototype.Bu=function(){return!Bo(this)};
W.prototype.hasQuery=W.prototype.Bu;W.prototype.getQuery=function(){return this.Ga};W.prototype.getQuery=W.prototype.getQuery;W.prototype.Wr=function(a){if(void 0===a)this.vk=a;else{var b=cd(+a<<0,0,65535);if(b!=a)throw new C(this.Wr,0,'Parameter "port" must be an integer in range [0...65535]');this.vk=b}return this};W.prototype.setPort=W.prototype.Wr;W.prototype.yA=function(){return this.vk};W.prototype.getPort=W.prototype.yA;W.prototype.Tw=function(a){this.Cb=a||void 0;return this};
W.prototype.setAnchor=W.prototype.Tw;W.prototype.zp=function(){return this.Cb};W.prototype.getAnchor=W.prototype.zp;W.prototype.v=function(a){if("object"!==typeof a)throw new C(this.v,0,'Parameter "other" must be an object.');var b=this.Ga,c;for(c in a)a.hasOwnProperty(c)&&"function"!==typeof a[c]&&(b[c]=a[c]);return this};W.prototype.mergeQuery=W.prototype.v;
W.prototype.sa=function(a){if(!a||"string"!==typeof a)throw new C(this.sa,0,'Parameter "subDomain" must be a non-empty string');"."===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Rk(a+"."+this.Rj)};W.prototype.addSubDomain=W.prototype.sa;W.prototype.A=function(a){if(!a||"string"!==typeof a)throw new C(this.A,0,'Parameter "subPath" must be a non-empty string');return this.vc((this.hf?this.hf+"/":"")+a)};W.prototype.addSubPath=W.prototype.A;
W.prototype.toString=function(){return[this.oi+"://",this.Rj,this.vk?":"+this.vk:"",this.hf||!Bo(this)||this.Cb?"/":"",this.hf?encodeURI(this.hf):"",Co(this),this.Cb?"#"+encodeURIComponent(this.Cb):""].join("")};W.prototype.toString=W.prototype.toString;function Do(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(b){return"%"+b.charCodeAt(0).toString(16)})}
function Co(a){var b=[],c=a.Ga,d={},e;for(e in c){if(c.hasOwnProperty(e)&&"function"!==typeof c[e]){var f=a.Ga[e];d.Og=Do(e);B(f,Eo)?f.lo.forEach(function(g){return function(h){b.push(g.Og+"="+Do(h))}}(d)):B(f,Fo)?b.push(d.Og+"="+f.lo.map(function(g){return Do(g)}).join(f.Wy)):b.push(void 0===f?d.Og:d.Og+"="+Do(f))}d={Og:d.Og}}return 0<b.length?"?"+b.join("&"):""}
function uo(a){var b=Cm("H-service","1.63.0","d08e47f",{region:"row"});a.Ga.xnlp="CL_JSMv3."+b.version;return a}function Bo(a){var b,c=0;for(b in a.Ga)if(a.Ga.hasOwnProperty(b)&&"function"!==typeof a.Ga[b]&&(c++,0<c))break;return!c}function Go(a,b){if(fb(a))for(var c=0;c<a.length;c++){var d=a[c];if(!gb(d)&&!jb(d)){var e="The Array does not contain only strings and numbers";break}}else e="Not an Array";if(e)throw new C(b,0,a);return a}
function Eo(a){this.lo=Go(a,Eo)}W.MultiValueQueryParameter=Eo;Eo.prototype.SA=function(){return this.lo};Eo.prototype.getValues=Eo.prototype.SA;function Fo(a,b){this.lo=Go(a,Fo);if(!/^[!\$\(\)\*\+,;]$/.test(b))throw new C(Fo,1,'Invalid delimiter "'+b+'"');this.Wy=b}W.DelimitedQuerySubValues=Fo;function X(a){a=no({},this.Uy,a);var b=a.apikey||a.apiKey,c=a.baseUrl;if(c=b?c?0:"baseUrl":"apikey")throw new C(X,0,'"'+c+'" must be specified');this.Ww(a.baseUrl);this.at=b;this.kd.v({apikey:b});this.oc=a.headers||{};this.bD=Na(a.servicesConfig||{})}t("H.service.Platform",X);X.prototype.Uy={apikey:null,baseUrl:new W("https","hereapi.com")};X.prototype.Ww=function(a){this.kd=uo(a.clone());this.at=a=this.at;this.kd.v({apikey:a})};X.prototype.setBaseUrl=X.prototype.Ww;X.prototype.Kc=function(){return this.kd};
X.prototype.getBaseUrl=X.prototype.Kc;X.prototype.Ja=function(a,b){try{return a.Im=!0,new a(no({platformBaseUrl:this.Kc(),headers:this.oc},this.bD[a.CONFIG_KEY]||{},b||{}))}finally{a.Im=!1}};X.prototype.createService=X.prototype.Ja;
X.prototype.Zl=function(a,b,c){var d=this;if(!H.map.render.harp)throw Error("HARP engine module not found");if(!ya(a)&&!gb(a))throw new C(this.Zl,0,"is invalid: must be either a configuration object or a URL");if(!Za(b))throw new C(this.Zl,1,"is invalid: must be a Function");if(!Za(c))throw new C(this.Zl,2,"is invalid: must be a Function");var e=new H.map.render.harp.Style(a);e.addEventListener("change",function(){var f=e.getState();if(-1===f)c(Error("H.service.platform#createHybridLayers method failed to load style configuration"));
else if(2===f){f={dark:!0};var g=d.Rp({resource:"background",queryParams:{style:"satellite.day"}}),h=e.Qd(),k={styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]};h.definitions&&(void 0!==h.definitions["Satellite.Texture.Gamma"]&&(k.styles[0].attr.gamma=h.definitions["Satellite.Texture.Gamma"]),void 0!==h.definitions["Satellite.Texture.Brightness"]&&(k.styles[0].attr.brightness=h.definitions["Satellite.Texture.Brightness"]));g=new yo(g,{engineType:ym,style:new H.map.render.harp.Style(k)});
b({raster:new Ei(g,f),vector:d.Mj().md(e,{engineType:ym},f),traffic:d.Vp().md(e,{engineType:ym},f)})}});e.load()};X.prototype.createHybridLayers=X.prototype.Zl;X.prototype.VA=function(a){return this.Ja(xo,a)};X.prototype.getWaypointsSequenceService=X.prototype.VA;function Ho(a,b,c,d,e,f,g){var h=this;g=g||{};f=f?f:{};var k=a.i().clone().A(b+"/"+a.Ud()+"/"+c).v(f),l=a.Fg;this.$=a;this.wx=k;wl.call(this,{tileSize:d,max:512===d?19:20,min:512===d?2:0,getURL:function(n,p,q){var r=h.wx.clone();l&&r.sa(l[(q+p+n)%l.length]);r.A(q+"/"+n+"/"+p+"/"+d+"/"+e);return r.toString()},crossOrigin:g.crossOrigin,headers:g.headers,uri:k.toString().replace(/_/g,"")+d,engineType:g.engineType});this.AD=b;this.oi=c;this.Ga=f;this.Zo=c.split(".")[0];this.Be=z(this.Be,this);this.getCopyrights=
this.U;this.Xe=!1;a.addEventListener("versionupdate",this.Be)}u(Ho,wl);Ho.prototype.MAX_STORE_TIME=2592E6;Ho.prototype.u=function(a,b,c,d,e,f){this.Xe||(oo(Io,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.Xe=!0);return Ho.g.u.call(this,a,b,c,d,e,f)};Ho.prototype.requestInternal=Ho.prototype.u;Ho.prototype.disposeInternal=function(){wl.prototype.disposeInternal.call(this);this.$.removeEventListener("versionupdate",this.Be)};
Ho.prototype.U=function(a,b){return this.$.U().query(this.Zo,b,a)};Ho.prototype.getCopyrights=Ho.prototype.U;Ho.prototype.Be=function(){var a=this.$;this.wx=a.i().clone().A(this.AD+"/"+a.Ud()+"/"+this.oi).v(this.Ga);this.reload(!1)};Ho.prototype.Wi=function(){return kk()};Ho.prototype.rd=function(){return kk()?jk():Ho.g.rd.call(this)};function Jo(){this.ps={}}function Ko(a,b){for(var c in b)b.hasOwnProperty(c)&&a.Do(c,b[c])}Jo.prototype.Do=function(a,b){a=this.ps[a]||(this.ps[a]=[]);var c,d=b.length;for(c=0;c<d;c++){var e=new po.Ps(b[c]);a.push(e)}};Jo.prototype.query=function(a,b,c){a=this.ps[a];var d,e=a?a.length:0,f=[];for(d=0;d<e;d++)a[d].Vf(b,c)&&f.push(a[d]);return f};
po.Ps=function(a){var b,c=a.boxes;this.alt=a.alt;this.label=a.label;this.min=a.minLevel;this.max=a.maxLevel;this.In=[];if(c&&(b=c.length)){var d=c[0];var e=new K(d[0],d[1],d[2],d[3]);this.In.push(e);this.tn=new K(d[0],d[1],d[2],d[3]);for(a=1;a<b;a++)d=c[a],e=new K(d[0],d[1],d[2],d[3]),this.In.push(e),this.tn.xd(e,!1,this.tn)}};po.Ps.prototype.Vf=function(a,b){if(a>=this.min&&a<=this.max)if((a=this.In.length)&&this.tn){if(this.tn.Vf(b))for(;a--;)if(this.In[a].Vf(b))return!0}else return!0;return!1};function Io(a){var b=this;Io.g.constructor.call(this,Io,a);var c=to(this,a);this.Fg=c.shards;(this.qb=c.ignoreTypes?null:c.type)&&this.i().sa(this.qb);this.dc=new Jo;this.pr={};this.Xl=0;setTimeout(function(){b.dispatchEvent("infoupdate");void 0!==c.version&&"newest"!==c.version||b.dispatchEvent("versionupdate")})}u(Io,so);t("H.service.MapTileService",Io);Io.prototype.ya=function(){return{subDomain:"maps.ls",path:"maptile/2.1",type:"base",version:"newest",shards:["1","2","3","4"]}};
Io.CONFIG_KEY="maptile";Io.prototype.tu=function(){return this.qb};Io.prototype.getType=Io.prototype.tu;Io.prototype.Ud=function(){return this.ya().version};Io.prototype.getVersion=Io.prototype.Ud;Io.prototype.U=function(){this.Xl||this.Jf();return this.dc};Io.prototype.getCopyrights=Io.prototype.U;Io.prototype.ql=function(a){Ko(this.dc,a);this.dispatchEvent("copyrightupdate")};
Io.prototype.Jf=function(){var a=this;var b=this.i().clone().A("copyright").A(a.Ud()).v({output:"json"});this.Fg&&b.sa(this.Fg[0]);this.Xl=1;this.u(b,function(c){a.Xl=2;a.ql(c)},function(c){a.Xl=-1;throw c;})};Io.prototype.Lj=oe;Io.prototype.getInfo=Io.prototype.Lj;
Io.prototype.oj=function(a,b,c,d,e,f){var g=this.i().clone().A(a+"/"+this.Ud()+"/"+b+"/"+c+"/"+d).v(e?e:{}).toString();var h=0,k,l=g.length;if(0!==l)for(k=0;k<l;k++){var n=g.charCodeAt(k);h=(h<<5)-h+n;h|=0}g=h;h=this.pr[g];h||(h=new Ho(this,a,b,c,d,e,no({headers:this.oc},f||{})),this.pr[g]=h);return h};Io.prototype.createTileProvider=Io.prototype.oj;Io.prototype.Nd=function(a,b,c,d,e,f,g,h){a=this.oj(a,b,c,d,e,h);return new Ei(a,{opacity:f,dark:!!g})};Io.prototype.createTileLayer=Io.prototype.Nd;
X.prototype.Lp=function(a){return this.Ja(Io,a)};X.prototype.getMapTileService=X.prototype.Lp;function Lo(a){Lo.g.constructor.call(this,Lo,a);this.Ow=to(this,a).reverseSubDomain;oo(Lo,"Use HERE Geocoding and Search API v7 instead.")}u(Lo,so);t("H.service.GeocodingService",Lo);Lo.prototype.ya=function(){return{subDomain:"geocoder.ls",reverseSubDomain:"reverse",path:"6.2"}};Lo.CONFIG_KEY="geocoding";Lo.prototype.Ic=function(a){return Error(a.Details||a.message||a.error)};Lo.prototype.yp=function(a,b,c){a=this.i().clone().A("geocode.json").v(a);return this.u(a,b,c)};
Lo.prototype.geocode=Lo.prototype.yp;Lo.prototype.Fr=function(a,b,c){a=this.i().clone().A("reversegeocode.json").v(a);this.Ow&&a.sa(this.Ow);return this.u(a,b,c)};Lo.prototype.reverseGeocode=Lo.prototype.Fr;Lo.prototype.search=function(a,b,c){a=this.i().clone().A("search.json").v(a);return this.u(a,b,c)};Lo.prototype.search=Lo.prototype.search;X.prototype.Xz=function(a){return this.Ja(Lo,a)};X.prototype.getGeocodingService=X.prototype.Xz;function Mo(a){Mo.g.constructor.call(this,Mo,a)}u(Mo,so);t("H.service.publicTransit.Service",Mo);Mo.prototype.ya=function(){return{subDomain:"transit.router",path:"v8"}};Mo.CONFIG_KEY="publicTransit";Mo.prototype.FA=function(a,b,c){a=this.i().clone().A("routes").v(a);return this.u(a,b,c)};Mo.prototype.getRoutes=Mo.prototype.FA;Mo.prototype.Nz=function(a,b,c){a=this.i().clone().A("departures").v(a);return this.u(a,b,c)};Mo.prototype.getDepartures=Mo.prototype.Nz;
Mo.prototype.JA=function(a,b,c){a=this.i().clone().A("stations").v(a);return this.u(a,b,c)};Mo.prototype.getStations=Mo.prototype.JA;Mo.prototype.Ic=function(a){return Error(JSON.stringify(a))};X.prototype.BA=function(a){return this.Ja(Mo,a)};X.prototype.getPublicTransitService=X.prototype.BA;function No(a,b,c,d){if(!Za(c))throw new C(a,b,"has invalid type");if(!Za(d))throw new C(a,b+1,"has invalid type");};function Oo(a,b){var c={};this.wC=a;Qa(c,b||c);Aj.call(this,c);this.Ln={};a=this.Mc(Ee.SPATIAL);a.update(a.Kd+1,Ce.ADD)}u(Oo,Aj);t("H.service.remote.ObjectProvider",Oo);Oo.prototype.l=function(){Aj.prototype.l.call(this)};Oo.prototype.dispose=Oo.prototype.l;Oo.prototype.pe=function(){return pe};Oo.prototype.requestMarkers=Oo.prototype.pe;Oo.prototype.oe=function(){return pe};Oo.prototype.requestDomMarkers=Oo.prototype.oe;Oo.prototype.wg=function(){return pe};Oo.prototype.requestOverlays=Oo.prototype.wg;
Oo.prototype.Vc=me;Oo.prototype.providesMarkers=Oo.prototype.Vc;Oo.prototype.Uc=me;Oo.prototype.providesDomMarkers=Oo.prototype.Uc;Oo.prototype.me=me;Oo.prototype.providesSpatials=Oo.prototype.me;Oo.prototype.Pn=function(){return pe};Oo.prototype.requestSpatials=Oo.prototype.Pn;function Po(a){return a.Vd(!0)}Oo.prototype.Qn=function(a,b){a=Qo(this,a,Ro);b&&(a=a.filter(Po));return a};Oo.prototype.requestSpatialsByTile=Oo.prototype.Qn;
function Qo(a,b,c){var d=b.Ji&&b.Ji[c],e;!d&&(e=b.vl)&&(delete b.vl,(b.Ji=a=a.wC.parse(a,b,e))&&(d=a[c]));return d||pe}Oo.prototype.Y=function(a){var b=a.wb();if(this.Ln[b])throw new vb(this.Y,"Remote object "+b+" already added");return this.Ln[b]=a};Oo.prototype.Oa=function(a){delete this.Ln[a.wb()]};var Ro="spatials";function So(a){a=a||{};var b=a.tileCacheSize||1024,c=a.resultType,d=a.styleCallback;ab(a.min)||(a.min=12);So.g.constructor.call(this,a);if(-1===To.indexOf(c))throw new C(So,2,"invalid resultType");this.resultType=c;if(d&&!Za(d))throw new C(So,2,"invalid style callback");this.zi=d;this.na=a.pixelRatio||ae();this.Hc=z(this.Hc,this);this.$n(new bj(b,z(this.je,this)));this.createTileInternal=4===c||8===c?z(this.My,this):z(this.Ky,this)}u(So,T);t("H.service.extension.TileProvider",So);
So.prototype.qq=!1;So.prototype.getCapabilities=function(){return So.g.getCapabilities.call(this)|lf.CROP_LINES_BY_TILE|lf.CROP_POLYGONS_BY_TILE};So.prototype.Pa=function(a,b,c,d){return this.qq?So.g.Pa.call(this,a,b,c,d):A};So.prototype.requestTile=So.prototype.Pa;So.prototype.Hc=function(a){this.dispatchEvent(new tc("error",gb(a)?a:a+"",this))};So.prototype.Vc=function(){return 1===this.resultType};So.prototype.providesMarkers=So.prototype.Vc;So.prototype.Uc=function(){return 2===this.resultType};
So.prototype.providesDomMarkers=So.prototype.Uc;So.prototype.me=function(){return 4===this.resultType||8===this.resultType};So.prototype.providesSpatials=So.prototype.me;function Uo(a){var b=a.zd;b||(a.fw||(a.fw=a.ou(a.resultType,a.zi,a.Hc)),b=a.zd=new Oo(a.fw),b.ea(a),b.addEventListener(a.j.Ca,z(a.ge,a)),b.zw=!0);return b}
So.prototype.Ky=function(a,b,c,d){var e=this.getTileKey(a,b,c);e=this.Rb().get(e);var f=2==this.resultType,g=[],h=Uo(this);e?e.valid=!0:(a=e=new Hi(a,b,c,x),delete a.Ji,a.vl=d);d=f?Qo(h,e,"domMarkers"):Qo(h,e,"markers");for(b=d.length;b--;)a=d[b],a.ws=e,(f||1===a.jc().getState())&&g.push(a);e.data=g;return e};So.prototype.ge=function(a){if(a=a.target.ws)a.valid=!1};So.prototype.hD=function(a){this.Kw=!!a};So.prototype.setTileCanvasRendering=So.prototype.hD;So.prototype.Kw=!0;
So.prototype.My=function(a,b,c,d){var e=Uo(this),f=this.getTileKey(a,b,c),g=this.tileSize,h=this.Rb().get(f);h||(a=h=new Li(f,a,b,c,g,this.na,c,e),delete a.Ji,a.vl=d);this.Kw?(d=ro.pop(g),h.L(d)||ro.push(d,g)):Ri(h);return h};So.prototype.je=function(a,b){var c;if(4===this.resultType||8===this.resultType){a=b.ab();for(c=a.length;c--;)delete a[c].Gk[b.key];if(a=b.Jn())ro.push(a,this.tileSize),b.Kn()}else for(a=b.data,c=a.length;c--;)delete a[c].ws};
So.prototype.disposeInternal=function(){So.g.disposeInternal.call(this);Uo(this).l()};var Vo={MARKER:1,DOM_MARKER:2,POLYLINE:4,POLYGON:8};So.ResultType=Vo;var To=[1,2,4,8];function Wo(){}t("H.service.extension.dataView.ITable",Wo);Wo.prototype.zh=function(){};Wo.prototype.getMeta=Wo.prototype.zh;Wo.prototype.Ch=function(){};Wo.prototype.getRowCount=Wo.prototype.Ch;Wo.prototype.Sd=function(){};Wo.prototype.getRow=Wo.prototype.Sd;Wo.prototype.$a=function(){};Wo.prototype.getColumnNames=Wo.prototype.$a;Wo.prototype.Gj=function(){};Wo.prototype.getColumn=Wo.prototype.Gj;Wo.prototype.xa=function(){};Wo.prototype.getCell=Wo.prototype.xa;Wo.prototype.concat=function(){};
Wo.prototype.concat=Wo.prototype.concat;function Xo(){}t("H.service.extension.dataView.IColumn",Xo);Xo.prototype.xa=function(){};Xo.prototype.getCell=Xo.prototype.xa;function Yo(a,b){this.Zb=a;this.Ol=b}t("H.service.extension.dataView.ObjColumn",Yo);Yo.prototype.xa=function(a){return this.Zb.xa(a,this.Ol)};Yo.prototype.getCell=Yo.prototype.xa;function Zo(){}t("H.service.extension.dataView.IRow",Zo);Zo.prototype.$a=function(){};Zo.prototype.getColumnNames=Zo.prototype.$a;Zo.prototype.xa=function(){};Zo.prototype.getCell=Zo.prototype.xa;Zo.prototype.Qf=function(){};Zo.prototype.getTable=Zo.prototype.Qf;function $o(a,b){this.Zb=a;this.Lk=b}t("H.service.extension.dataView.ObjRow",$o);$o.prototype.$a=function(){return this.Zb.$a()};$o.prototype.getColumnNames=$o.prototype.$a;$o.prototype.xa=function(a){return this.Zb.xa(this.Lk,a)};$o.prototype.getCell=$o.prototype.xa;$o.prototype.Qf=function(){return this.Zb};$o.prototype.getTable=$o.prototype.Qf;function ap(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):A);this.Nb=a;if(b)for(this.eh=b,this.Vo=a=Ua(),d=b.length;d--;)a[b[d]]=!0;c!==A&&(this.Lq=c)}t("H.service.extension.dataView.ObjTable",ap);m=ap.prototype;m.Lq=A;m.Nb=A;m.eh=A;m.Vo=A;m.zh=function(){return this.Lq};ap.prototype.getMeta=ap.prototype.zh;ap.prototype.Ch=function(){return this.Nb?this.Nb.length:0};ap.prototype.getRowCount=ap.prototype.Ch;ap.prototype.Sd=function(a){var b=this.Nb;return b&&b[a]?new $o(this,a):A};
ap.prototype.getRow=ap.prototype.Sd;ap.prototype.$a=function(){return this.eh||pe};ap.prototype.getColumnNames=ap.prototype.$a;ap.prototype.Gj=function(a){return this.Vo[a]?new Yo(this,a):A};ap.prototype.getColumn=ap.prototype.Gj;ap.prototype.xa=function(a,b){var c=this.Nb;return(a=c&&this.Vo[b]&&c[a])&&a[b]};ap.prototype.getCell=ap.prototype.xa;
ap.prototype.concat=function(){var a=arguments.length,b,c=this.eh,d=""+this.eh,e=(this.Nb||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof ap))throw new C(this.concat,b);if(f.Nb){if(c&&""+f.eh!==d)throw new C(this.concat,b,"Incompatible columns!");e=e.concat(f.Nb)}}return new ap(e,this.eh,this.Lq)};ap.prototype.concat=ap.prototype.concat;function bp(a,b,c,d){d=d||cp;this.Gk={};d.provider=a;this.invalidate=ne;bp.g.constructor.call(this,b,d);delete this.invalidate;c&&(this.JD=c);this.qa(Ce.ADD)}u(bp,Wh);t("H.service.remote.Spatial",bp);var cp={};bp.prototype.wb=function(){return this.JD||Wh.prototype.wb.call(this)};bp.prototype.getId=bp.prototype.wb;bp.prototype.Un=oe;bp.prototype.retain=bp.prototype.Un;bp.prototype.release=me;bp.prototype.release=bp.prototype.release;function ep(a,b){this.hm=a;b&&(this.labels=b)}var fp=new ep(pe);
bp.prototype.xh=function(a){return(this.Gk[a.key]||fp).hm};bp.prototype.getGeometriesForTile=bp.prototype.xh;bp.prototype.Ip=function(a){return(this.Gk[a.key]||fp).labels};bp.prototype.getLabels=bp.prototype.Ip;function gp(a,b,c){a.Gk[b.key]=new ep(c,void 0)};function hp(a,b,c){var d=8===a;this.zi=b;this.Nt=c||oe;(this.Nm=4===a||d)?this.We=d:this.Vu=1===a;this.au=this.Nm?"$HProjGeometry":"geometry"}
hp.prototype.parse=function(a,b,c){var d,e={},f=[],g,h;var k=0;for(g=c.length;k<g;k++){var l=c[k];var n=l.Rows;if(l=n.length){var p=Object.keys(n[0]).filter(function(v){return"geometry"!==v&&"$HProjGeometry"!==v});p=new ap(n,p);for(h=0;h<l;h++){var q=n[h];if(d=q[this.au]){if(delete q[this.au],q=p.Sd(h))try{var r=this.Nm?ip(this,a,b,q,d):jp(this,a,q,d.path);r.ea(a);f.push(r)}catch(v){this.Nt(v.message)}}else this.Nt("Layer must contain geometries")}}}e[this.Nm?"spatials":this.Vu?"markers":"domMarkers"]=
f;return e};function ip(a,b,c,d,e){var f=[],g=e.paths,h=g.length,k=0,l=a.zi&&a.zi(d);for(a=new bp(b,a.We,A,{style:l||a.Vy,data:d});k!==h;){b=f;d=b.push;l=g[k++];for(var n=0,p=l.length,q=[];n<p;)q.push(new L(l[n++],l[n++]));d.call(b,q)}gp(a,c,[new Jh(f,e.interiorsIndex,e.outlinesIndex)]);return a}function jp(a,b,c,d){d=new Re(d[0],d[1]);var e=a.zi&&a.zi(c);a.Vu?(a={icon:e,data:c,provider:b},a=new yi(d,a)):(a={icon:e,data:c,provider:b},a=new af(d,a));return a};function kp(a){var b=lp;if(!a||!gb(a.layerId)||ab(a.rowFilter)&&!Za(a.rowFilter)||ab(a.rowFilterContext)&&!ya(a.rowFilterContext))throw new C(b,1,ab("invalid layer config")?"invalid layer config":a);}function mp(a){return gb(a)&&/^[A-Z][A-Z0-9_]*$/.test(a)}function np(a){for(var b=a&&a.length,c=2<=b&&"WKT"===a[--b]&&"GEOMETRY_ID"===a[--b];c&&b--;)c=mp(a[b]);return c}
function op(a,b){var c="",d=[];if(b){var e=a.geometries;if(e&&e.length){var f=Object.keys(e[0].attributes);c=c+("Meta:\t"+b+"\n")+f.join("\t");c+="\tWKT\n";for(a=0;a<e.length;a++){var g=e[a].attributes;var h=e[a].geometry;for(b=0;b<f.length;b++)d.push(g[f[b]]);c+=d.join("\t");c+="\t"+h+"\n";d=[]}}}else{h={};d=[];if(a.geometries)for(e=0;e<a.geometries.length;e++)b=a.geometries[e],h[b.layerId]||(h[b.layerId]=[]),h[b.layerId].push(b);for(f in h)d.push({layerId:f,geometries:h[f]});for(a=0;a<d.length;a++)c+=
op(d[a],d[a].layerId)}return c};function lp(a,b,c){var d=this,e=b&&b.rowFilter,f;lp.g.constructor.call(this,c);B(a,pp,lp,0);var g=c.resultType;kp(b);if(e){var h=Na(b);h.rowFilter=e.toString()}else h=b;(new en).registerProcessor("cle","H.service.extension.worker.processor");var k=b.layerId;a.request(qp,rp,{detail_level:"all",layer_id:k},function(l){l=l.layers;var n;for(n=0;n<l.length;n++)if(l[n].layerId===k){h.level=l[n].level;break}f=a.i().clone().A(sp+"."+rp).v({meta:1});(new gn("cle",{message:[d.uid,0,{tileSize:d.tileSize,
projected:!0,onlyOutline:4===g,serverUrl:f.toString(),layerConfigs:[h],batchTiles:!1,horizontalMargin:1}]})).then(function(){d.qq=!0;d.hb()},d.Hc)},function(l){d.Hc(l.message)})}u(lp,So);t("H.service.extension.customLocation.TileProvider",lp);lp.prototype.ou=function(a,b,c){return new hp(a,b,c)};
lp.prototype.u=function(a,b,c,d,e){var f=this,g=this.getTileKey(a,b,c),h;g=this.Rb().get(g);var k={cancel:oe},l=!0,n=this.resultType;g&&(4===n||8===n?g.Ih()||(d(ro.pop(this.tileSize),null),l=!1):(d(x),l=!1));if(l){var p=globalThis.setTimeout(function(){h=new gn("cle",{message:[f.uid,1,[a,b,c]]});h.then(d,e)},500);k.cancel=function(){h?h.cancel():globalThis.clearTimeout(p)}}return k};lp.prototype.requestInternal=lp.prototype.u;
lp.prototype.disposeInternal=function(){lp.g.disposeInternal.call(this);new gn("cle",{message:[this.uid,3]})};function tp(a){this.Dy=a}tp.prototype.cancel=function(){for(var a=this.Dy,b=a.length;b--;)a[b].cancel();a.length=0};tp.prototype.cancel=tp.prototype.cancel;function up(a){if(a===A)a="\t";else if(!/^[^"\r\n]$/.test(a))throw new C(up,0);this.dy=String(a).charCodeAt(0);this.vd=z(this.vd,this);this.o=vp}var vp=0;m=up.prototype;m.getState=function(){return this.o};function wp(a,b,c){var d=a.o;if(d!==b)throw 1===d&&(a.o=vp),new vb(c,"Requires state: "+["READY","PARSE","PAUSE"][b]+" but found "+["READY","PARSE","PAUSE"][d]);}m.abort=function(){wp(this,2,up.prototype.abort);this.o=vp};
m.vd=function(a){this.o=vp;throw new C(up.prototype.parse,0,"Malformed DSV at row "+this.cd.Gr+" column "+this.cd.gj+": "+a);};function xp(a,b){var c=[];a.parse(b,function(d,e,f){1>d&&(c[e]=f);return 0<d});a.o=vp;return c}m.parse=function(a,b,c){wp(this,vp,up.prototype.parse);a=a.trim();this.cd=new yp(a,this.dy,this.vd);this.cC=b;this.Hv=c||ne;this.o=2;this.resume()};m.Hv=ne;
m.resume=function(){var a=this.cd,b=[];wp(this,2,up.prototype.resume);this.o=1;do{if(!a.cq){this.o=vp;break}if(e>a.gj){if(void 0!==c&&c!==e){this.cd.vd("The number of columns must be the same for all rows");return}var c=e}var d=a.Gr;var e=a.gj;var f=a.Pl;var g=this.Hv(d,e,a);if(a.Pl>f)for(;-1!==a.next(););else{for(;-1!==(f=a.next());)b.push(f);g=String.fromCharCode.apply(x,b);b.length=0}zp(a);this.cC(d,e,g)&&(this.o=a.cq?2:vp)}while(1===this.o);2!=this.o&&void 0!==c&&0<e&&c!==e&&this.cd.vd("The number of columns must be the same for all rows")};
function yp(a,b,c){this.cd=new Em(a);this.Gs=b;this.cq=!0;this.Pl=this.Gr=this.gj=0;zp(this);this.vd=c;this.Dc=[];this.Xf=!1}m=yp.prototype;m.Pl=0;function zp(a){var b=a.cd.cb();a.Wt=!1;(a.lB=34===b)&&a.cd.next()}function Ap(a,b){var c=a.cd;a.Wt=!0;switch(b){case a.Gs:a.gj++;break;case 13:c.next(),10!==c.cb()&&a.vd("CR without LF");case 10:a.gj=0;a.Gr++;break;case -1:a.cq=!1;break;default:a.vd("End of field expected")}c.next();return-1}
m.cb=function(){if(this.Wt)var a=-1;else{var b=this.cd;a=b.cb();if(this.lB)switch(a){case 34:b.next();a=b.cb();34!==a&&(a=Ap(this,a));break;case -1:this.vd("Closing quotation mark expected")}else switch(a){case 34:this.vd("Unexpected quotation mark");case this.Gs:case 13:case 10:case -1:a=Ap(this,a)}}return a};m.yi=function(){this.Xf=!0;this.Dc=[]};m.mh=function(){var a=this.Dc.slice();this.Xf=!1;this.Dc=[];return a};
m.next=function(){var a=this.cb();-1!==a&&this.cd.next();this.Xf&&this.Dc.push(a);this.Pl++;return a};t("H.service.extension.customLocation.Permission",{READ:"read",WRITE:"write",EXPORT:"export"});t("H.service.extension.customLocation.Storage",{READONLY:"readonly",UPDATABLE:"updatable"});function Bp(){if(Cp)throw new vb(Bp);}t("H.service.extension.customLocation.Table",Bp);var Cp=!0;function Dp(a,b){var c;Cp=!1;var d=new Bp;Cp=!0;d.Zm=Xa(globalThis.JSON.parse(globalThis.JSON.stringify(a)));a=a.columnNames;var e=Ua();for(c=a.length;c--;)e[a[c]]=c;d.Uo=e;d.Gc=a.length;if(b){if(b.length%a.length)throw new C(Dp,1,"Invalid number of cells");}else b=[];d.sb=b;return d}Bp.prototype.zh=function(){return this.Zm};Bp.prototype.getMeta=Bp.prototype.zh;
Bp.prototype.Ch=function(){return this.sb.length/this.Gc};Bp.prototype.getRowCount=Bp.prototype.Ch;Bp.prototype.Sd=function(a){return a<this.sb.length/this.Gc?new Ep(this,a):A};Bp.prototype.getRow=Bp.prototype.Sd;Bp.prototype.GA=function(){var a=this.sb.length/this.Gc,b,c=new globalThis.Array(a);for(b=0;b<a;b++)c[b]=new Ep(this,b);return c};Bp.prototype.getRows=Bp.prototype.GA;
Bp.prototype.Bo=function(a){var b=this.Gc,c=this.sb,d=c.length/this.Gc;if(!a||a.length%b)throw new C(this.Bo,0,"Invalid number of cells");this.sb=c.concat(a);return d};Bp.prototype.addCells=Bp.prototype.Bo;Bp.prototype.py=function(){for(var a=this.Gc,b=this.sb,c=this.sb.length/this.Gc;a--;)b.push(x);return this.Sd(c)};Bp.prototype.addRow=Bp.prototype.py;Bp.prototype.$a=function(){return this.Zm.columnNames};Bp.prototype.getColumnNames=Bp.prototype.$a;
Bp.prototype.Gj=function(a){return this.Uo[a]===A?A:new Fp(this,a)};Bp.prototype.getColumn=Bp.prototype.Gj;Bp.prototype.xa=function(a,b){return this.sb[a*this.Gc+this.Uo[b]]};Bp.prototype.getCell=Bp.prototype.xa;Bp.prototype.te=function(a,b,c){b=this.Uo[b];if(a>=this.sb.length/this.Gc)throw new C(this.te,0,"Row index out of bounds");if(b===A)throw new C(this.te,0,"Column unknown");this.sb[a*this.Gc+b]=c};Bp.prototype.setCell=Bp.prototype.te;
Bp.prototype.concat=function(a){var b=arguments.length,c,d=""+this.$a(),e=this.sb?this.sb.slice():[];for(c=0;c<b;c++){var f=arguments[c];if(!(f instanceof Bp))throw new C(this.concat,c);if(""+f.$a()!==d)throw new C(this.concat,c,"Incompatible columns!");f.sb&&(e=e.concat(f.sb))}return Dp(this.Zm,e)};Bp.prototype.concat=Bp.prototype.concat;var Gp=/(\n|\t|\r|")/;
Bp.prototype.ns=function(a,b){var c,d=this.Gc,e=this.$a(),f=[],g=[],h=this.sb,k=-1;for(c=0;c<d;c++)if(!a||a.test(e[c]))"WKT"===e[c]&&(k=f.length),f.push(c);if(!(a=f.length))throw new C(this.ns,1,"No columns filtered");Hp(this,g,e,0,d,f,a,k);if(b){var l=b.length;for(c=0;c<l;c++)g.push("\n"),e=b[c],Hp(this,g,h,e,d,f,a,k)}else for(l=this.Ch(),e=0;e<l;e++)g.push("\n"),Hp(this,g,h,e,d,f,a,k);return g.join("")};
function Hp(a,b,c,d,e,f,g,h){var k;for(k=0;k<g;k++){k&&b.push("\t");var l=c[d*e+f[k]];if(k!==h){if(l!==x){l=String(l);if(Gp.test(l))throw new C(a.ns,0,'Invalid character (\\n, \\r, \\t, or ") in row '+d+" column "+a.Zm.columnNames[f[k]]);b.push(l)}}else b.push(l)}}function Fp(a,b){this.Zb=a;this.Ol=b}Bp.Column=Fp;Fp.prototype.xa=function(a){return this.Zb.xa(a,this.Ol)};Fp.prototype.getCell=Fp.prototype.xa;Fp.prototype.te=function(a,b){this.Zb.te(a,this.Ol,b)};Fp.prototype.setCell=Fp.prototype.te;
function Ep(a,b){this.Zb=a;this.Lk=b}Bp.Row=Ep;Ep.prototype.$a=function(){return this.Zb.$a()};Ep.prototype.getColumnNames=Ep.prototype.$a;Ep.prototype.xa=function(a){return this.Zb.xa(this.Lk,a)};Ep.prototype.getCell=Ep.prototype.xa;Ep.prototype.te=function(a,b){this.Zb.te(this.Lk,a,b)};Ep.prototype.setCell=Ep.prototype.te;Ep.prototype.Qf=function(){return this.Zb};Ep.prototype.getTable=Ep.prototype.Qf;function Ip(a,b,c,d){d=d||{};if(!b)throw new C(Ip,1,"has to be a function");if(!c)throw new C(Ip,2,"has to be a function");this.on=b;this.en=c;this.bh=[];this.oc={};this.xq=[];this.lh={};this.es={};this.ks={};this.rx={};this.sj=d.duration||100;this.Hm=z(this.Hm,this);a=a.split("Meta:\t").slice(1);for(b=0;b<a.length;b++){d=a[b].split("\n");c=d[0].split("\t")[0];d=d.slice(1).join("\n");this.lh[c]=new up;this.oc[c]=xp(this.lh[c],d);var e={layerId:c,columnNames:this.oc[c]};this.xq.push(c);this.rx[c]=
Dp(e);this.es[c]=$i();Jp(this,d,c);this.Hm(c)}}function Jp(a,b,c){var d=[],e=a.oc[c].length-1,f=a.rx[c];try{a.lh[c].parse(b,function(g,h,k){var l=!1;0<g&&(d[h]=k,h===e&&(a.bh.push(f.Sd(f.Bo(d))),$i()-a.es[c]>a.sj&&(l=!0)));return l},function(g,h,k){if(0<g&&h===e)return Gm(k)})}catch(g){a.en(g)}}Ip.prototype.cancel=function(){for(var a in this.ks)globalThis.clearTimeout(this.ks[a])};Ip.prototype.cancel=Ip.prototype.cancel;
Ip.prototype.Hm=function(a){var b=this,c,d;this.ks[a]=globalThis.setTimeout(function(){if(2===b.lh[a].getState())b.es[a]=$i(),b.on(b.bh,!1),b.bh=[],b.lh[a].resume(),b.Hm(a);else{c=!0;for(d=0;d<b.xq.length;d++)if(b.lh[b.xq[d]].getState()!==vp){c=!1;break}if(c){if(0<b.bh.length)b.on(b.bh,!0);b.bh=[]}}},0)};function pp(a){pp.g.constructor.call(this,pp,a);oo(pp)}u(pp,so);t("H.service.extension.customLocation.Service",pp);pp.prototype.ya=function(){return{subDomain:"fleet.ls",path:"2"}};pp.CONFIG_KEY="customLocation";pp.prototype.Nd=function(a,b){var c=b&&b.resultType;a=new lp(this,a,b);return 1===c||2===c?new Ig(a):new Ei(a)};pp.prototype.createTileLayer=pp.prototype.Nd;
function Kp(a,b,c,d){a=a===Lp?"changes":"file";var e=b[a];var f=gb(e),g=!f&&B(e,Blob);if(!f&&!g)throw new C(d,0,"Invalid "+a+" parameter");if(Mp)e=g?e:we(e,"text/plain"),d=new globalThis.FormData,d.append(a,e,e.name||a+".wkt"),c.method="POST",c.data=d,delete b[a];else if(g)throw new C(d,0,"Sending Blob data is not supported by the browser");}var Mp=globalThis.FormData&&!!globalThis.FormData.prototype.append;pp.prototype.request=function(a,b,c,d,e){return this.I(a,b,c,d,e)};pp.prototype.request=pp.prototype.request;
pp.prototype.I=function(a,b,c,d,e){var f="text/plain",g=a===Np.LAYERS_UPLOAD||a===Np.LAYERS_MODIFY||a===Np.LAYERS_IMPORT,h=c,k={data:A,method:"GET",headers:this.oc};if(!a)throw new C(this.request,0,a);if(!b)throw new C(this.request,1,b);No(this.request,3,d,e);g&&(B(c,Object,this.request,2,"Invalid request parameters"),h=Na(c),Kp(a,h,k,this.request));var l=this.i().clone().A(a+"."+b).v(h);b===Op.JSON&&(f="application/json");a=new Qf(f,l.toString(),Vd,k);a.then(function(n){var p=n.issues;p&&n.error_id&&
n.response_code?e(Error(p[0].message)):d(n)},function(n){"error"===n.type||404===n.status?e(Error(n.statusText||"Unable to load data")):n.json().then(function(p){e(Error("["+p.issues[0].message+"] "+l+" request failed"))},function(){e(Error("["+n.statusText+"] "+l+" request failed"))})});return a};
var qp="layers/list",Lp="layers/modify",sp="tiled/tile",Np={LAYERS_DELETE:"layers/delete",LAYERS_GRANT:"layers/access/grant",LAYERS_LIST:qp,LAYERS_MODIFY:Lp,LAYERS_UPLOAD:"layers/upload",LAYERS_IMPORT:"layers/import",SEARCH_ALL:"search/all",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SEARCH_TILE:sp};pp.EntryPoint=Np;var rp="json",Op={TXT:"txt",JSON:rp};pp.EntryPointType=Op;
pp.prototype.Sb=function(a,b,c){var d=this;return this.request("search/all","txt",{filter:'WKT==""',layer_id:a},function(e){var f=String(e).replace(/[\r\n]+$/g,"").split("\t");d.request(qp,rp,{layer_id:a,detail_level:"all"},function(g){g=g.layers[0];g.columnNames=f;b(Dp(g))},c)},c)};pp.prototype.getLayer=pp.prototype.Sb;
pp.prototype.yu=function(a,b,c,d){function e(){return++g<f?h.request("layers/access/grant",rp,{layer_id:a,granted_app_id:b[g].grantedAppId,permissions:b[g].permissions.join(",")},e,d):h.Sb(a,c,d)}var f=b&&b.length,g=-1,h=this;return e()};pp.prototype.grantAccess=pp.prototype.yu;pp.prototype.Bt=function(a,b,c){return this.request("layers/delete",rp,{layer_ids:a},b,c)};pp.prototype.deleteLayer=pp.prototype.Bt;
pp.prototype.md=function(a,b,c){function d(){setTimeout(function(){k.Sb(g,function(q){setTimeout(e.bind(null,q),n)},function(){64E3>l?(l+=n,d()):c(globalThis.Error("Timeout"))})},n);n*=2}function e(q){var r=JSON.stringify(q.$a()),v=a.grants;if(r!==JSON.stringify(h)){var w="Results into different column names on the backend: "+r;setTimeout(function(){k.Bt(g,function(){c(globalThis.Error(w))},function(y){c(globalThis.Error(w+". "+y.message))})},n)}else v&&v.length?k.yu(g,v,b,c):b(q)}var f,g,h,k=this,
l=0,n=1E3;var p=!a||!mp(g=a.layerId)&&(f="layerId")||!np(h=a.columnNames)&&(f="columnNames")?0:Za(b)?Za(c)?-1:2:1;if(0<=p)throw new C(k.md,p,f||arguments[p]);return k.Sb(g,function(){c(globalThis.Error("Layer exists already"))},function(){var q={layer_id:g,file:h.join("\t")},r=a.level,v=a.storage;r!==A&&(q.level=r);v!==A&&(q.storage=v);k.request("layers/upload",rp,q,d,c)})};pp.prototype.createLayer=pp.prototype.md;
pp.prototype.Bg=function(a,b,c,d){var e=[],f;a=this.request(a,rp,b,function(g){g.geometries.length?(g=op(g,b.layer_id),f=new Ip(g,c,d),e.push(f)):c(pe,!0)},d);e.push(a);return new tp(e)};pp.prototype.Yc=function(a,b,c,d,e,f){if(!fb(a))throw new C(this.Yc,0,"has invalid type");B(b,Re,this.Yc,1,"has invalid type");if(!jb(c))throw new C(this.Yc,2,"has invalid type");No(this.Yc,3,d,e);a={layer_ids:a.join(","),proximity:b.lat+","+b.lng+","+c};f&&Qa(a,f);return this.Bg("search/proximity",a,d,e)};
pp.prototype.searchByProximity=pp.prototype.Yc;pp.prototype.Xc=function(a,b,c,d,e,f){var g="";if(!fb(a))throw new C(this.Xc,0,"has invalid type");if(!gb(b)&&!B(b,N))throw new C(this.Xc,1,"has invalid type");if(!jb(c))throw new C(this.Xc,2,"has invalid type");No(this.Xc,3,d,e);a={layer_ids:a.join(","),radius:c};if(gb(b))a.route_id=b;else{var h=b.S;b=0;for(c=h.length;b<c;b+=3)g+=h[b]+","+h[b+1],b<c-3&&(g+=",");a.corridor=g}f&&Qa(a,f);return this.Bg("search/corridor",a,d,e)};
pp.prototype.searchByCorridor=pp.prototype.Xc;pp.prototype.re=function(a,b,c,d,e){function f(k,l){l&&h--;c(k,!h)}var g=[],h;if(!fb(a))throw new C(this.re,0,"has invalid type");B(b,K,this.re,1,"has invalid type");No(this.re,2,c,d);b={bbox:b.fa+","+b.W+";"+b.ga+","+b.ca};e&&Qa(b,e);a=b.layer_id?[b.layer_id]:a;e=0;for(h=a.length;e<h;e++)b.layer_id=a[e],g.push(this.Bg("search/bbox",b,f,d));return new tp(g)};pp.prototype.searchByBoundingBox=pp.prototype.re;
pp.prototype.Lr=function(a,b,c,d){var e,f=[];if(!gb(a))throw new C(this.Lr,0,"has invalid type");No(this.Lr,1,b,c);var g={layer_id:a};d&&Qa(g,d);d=this.request("search/all",rp,g,function(h){h.geometries.length?(h=op(h,a),e=new Ip(h,b,c),f.push(e)):b(pe,!0)},c);f.push(d);return new tp(f)};pp.prototype.searchAll=pp.prototype.Lr;var Pp={"delete":/^GEOMETRY_ID$/,append:/^(?!GEOMETRY_ID$)/};
function Qp(a,b,c,d,e,f){function g(){v++;d(this,v===q)}function h(O){v++;e(O,this,v===q)}var k="append"!==b,l,n={},p=Ua(),q=0,r=[],v=0;if(!fb(c))throw new C(f,0,c);No(f,1,d,e);for(l=c.length;l--;){var w=c[l];if(B(w,Ep)){var y=w.Qf().zh().layerId;var D=w.xa("GEOMETRY_ID");if(k){if(D===x||""===String(D))var F='GEOMETRY_ID must not be null or ""';n[D=y+"_"+D]&&(F="same GEOMETRY_ID for multiple rows");n[D]=w}else D!==x&&""!==String(D)&&(F='GEOMETRY_ID must be null or ""')}else F="Invalid type";if(F)throw new C(f,
0,"- Invalid row at index "+l+", "+F);D=p[y];D||(D=p[y]=[],q++);D.push(w)}for(y in p){D=p[y];c=[];for(l=D.length;l--;)c.push(D[l].Lk);r.push(a.request(Lp,rp,{layer_id:y,action:b,changes:D[0].Qf().ns(Pp[b]||null,c)},z(g,D),z(h,D)))}return new tp(r)}pp.prototype.bt=function(a,b,c){return Qp(this,"append",a,b,c,this.bt)};pp.prototype.appendRows=pp.prototype.bt;pp.prototype.Lx=function(a,b,c){return Qp(this,"update",a,b,c,this.Lx)};pp.prototype.updateRows=pp.prototype.Lx;
pp.prototype.Ct=function(a,b,c){return Qp(this,"delete",a,b,c,this.Ct)};pp.prototype.deleteRows=pp.prototype.Ct;X.prototype.Lz=function(a){return this.Ja(pp,a)};X.prototype.getCustomLocationService=X.prototype.Lz;function Rp(a){Rp.g.constructor.call(this,Rp,a);oo(Rp,"Use HERE Geofencing API v8 instead.")}u(Rp,so);t("H.service.extension.geofencing.Service",Rp);Rp.prototype.ya=function(){return{subDomain:"fleet.ls",path:"2"}};Rp.CONFIG_KEY="geofencing";Rp.prototype.request=function(a,b,c,d){return this.I(a,b,c,d)};Rp.prototype.request=Rp.prototype.request;Rp.prototype.Ic=function(a){return Error(a.issues&&a.issues.length?a.issues.map(function(b){return b.message}).join(". "):a.message||a.response_code)};
Rp.prototype.I=function(a,b,c,d){if(!a)throw new C(this.request,0,a);if(!Za(c))throw new TypeError("onResult must be a function");if(!Za(d))throw new TypeError("onError must be a function");a=this.i().clone().A(a+".json").v(b);return this.u(a,c,d)};Rp.EntryPoint={SEARCH_PROXIMITY:"search/proximity"};function Sp(a){var b=Tp;if(!a||!gb(he(a.layerId,a.layer))||!jb(a.level)||ab(a.rowFilter)&&!Za(a.rowFilter)||ab(a.rowFilterContext)&&!ya(a.rowFilterContext))throw new C(b,1,ab("invalid layer config")?"invalid layer config":a);};function Tp(a,b,c){var d=this,e=b&&b.rowFilter,f=c.resultType;Tp.g.constructor.call(this,c);B(a,Up,Tp,0);Sp(b);e?(c=Na(b),c.rowFilter=e.toString()):c=Na(b);delete c.layer;c.layerId=he(b.layerId,b.layer);(new en).registerProcessor("pde","H.service.extension.worker.processor");a=a.i().clone().A(Vp+"."+Wp).v({meta:1});(new gn("pde",{message:[this.uid,0,{tileSize:this.tileSize,projected:!0,onlyOutline:4===f,serverUrl:a.toString(),layerConfigs:[c],horizontalMargin:1}]})).then(function(){d.qq=!0;d.hb()},
this.Hc)}u(Tp,So);t("H.service.extension.platformData.TileProvider",Tp);Tp.prototype.ou=function(a,b,c){a=new hp(a,b,c);a.Vy=Xp;return a};var Xp=new Q({strokeColor:"transparent",fillColor:"transparent",lineWidth:0,lineJoin:"round",lineCap:"round"});
Tp.prototype.u=function(a,b,c,d,e){var f=this,g=this.getTileKey(a,b,c),h;g=this.Rb().get(g);var k={cancel:oe},l=!0,n=this.resultType;g&&(4===n||8===n?g.Ih()||(d(ro.pop(this.tileSize),null),l=!1):(d(x),l=!1));if(l){var p=globalThis.setTimeout(function(){h=new gn("pde",{message:[f.uid,1,[a,b,c]]});h.then(d,e)},500);k.cancel=function(){h?h.cancel():globalThis.clearTimeout(p)}}return k};Tp.prototype.requestInternal=Tp.prototype.u;
Tp.prototype.disposeInternal=function(){Tp.g.disposeInternal.call(this);new gn("pde",{message:[this.uid,3]})};Tp.ResultType=Vo;function Yp(a,b,c,d,e,f){No(Yp,1,b,c);No(Yp,2,d,e);(this.Vn=a.length)?(this.Nb=a,this.on=b,this.en=c,this.lk=0,this.xn=z(this.xn,this),this.Ny=d,this.Ly=e,this.Yh=Ua(),Qa(this.Yh,Zp,f||{}),this.js={},globalThis.setTimeout(this.xn,0)):b(pe,!0)}var Zp={duration:100,xz:"geometry",wz:"WKT",aD:"searchAttributes",yt:A};
Yp.prototype.xn=function(){var a=[];var b=!1;for(var c=$i(),d;this.lk<this.Vn;){var e=this.Nb[this.lk];b=e.attributes;d=e.layerId||this.Yh.yt;e.distance&&(b[this.Yh.aD]={nearest:new Re(e.nearestLat,e.nearestLon),distance:e.distance});if(e=e[this.Yh.xz]){try{var f=Gm(new Em(e))}catch(g){this.en(new globalThis.Error(g.message));b=!0;break}b[this.Yh.wz]=f}(e=this.js[d])||(e=this.js[d]=this.Ny({layerId:d,columnNames:Object.keys(b)}));b=this.Ly(e,b);a.push(b);this.lk++;if((b=this.lk===this.Vn)||$i()-c>=
this.Yh.duration){this.on(a,b);break}}b?this.js={}:this.ll=globalThis.setTimeout(this.xn,0)};Yp.prototype.cancel=function(){globalThis.clearTimeout(this.ll);this.lk<this.Vn&&this.en(new globalThis.Error("parsing canceled"))};Yp.prototype.cancel=Yp.prototype.cancel;function Up(a){Up.g.constructor.call(this,Up,a);oo(Up)}u(Up,so);t("H.service.extension.platformData.Service",Up);Up.prototype.ya=function(){return{subDomain:"s.fleet.ls",path:"1"}};Up.CONFIG_KEY="platformData";Up.prototype.request=function(a,b,c,d,e){return this.I(a,b,c,d,e)};Up.prototype.request=Up.prototype.request;
Up.prototype.I=function(a,b,c,d,e){var f="text/plain";if(!a)throw new C(this.request,0,a);if(!b)throw new C(this.request,1,b);if(!d)throw new C(this.request,3,d);if(!e)throw new C(this.request,4,e);a=this.i().clone().A(a+"."+b).v(c);b===$p.JSON&&(f="application/json");return this.u(a,d,e,f)};var Vp="tiles";
Up.EntryPoint={DOC_ATTRIBUTES:"doc/attributes",DOC_LAYER:"doc/layer",DOC_LAYERS:"doc/layers",DOC_MAPS:"doc/maps",DOC_INDEXES:"doc/indexes",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SERVICE_CONFIGURATION:"serviceconfiguration",STATIC:"static",TILE:"tile",TILES:Vp,FILE:"file",INDEX:"index"};var Wp="json",$p={TXT:"txt",JSON:Wp,HTML:"html",BIN:"bin"};Up.EntryPointType=$p;
Up.prototype.Nd=function(a,b){var c=b&&b.resultType;a=new Tp(this,a,b);return 1==c||2===c?new Ig(a):new Ei(a)};Up.prototype.createTileLayer=Up.prototype.Nd;Up.prototype.Bg=function(a,b,c,d){var e=[],f,g=b.layer_id||b.layer_ids;a=this.request(a,Wp,b,function(h){f=new Yp(h.geometries,c,d,function(k){return new ap([],k.columnNames,k)},function(k,l){var n=k.Sd;k.Nb?k.Nb.push(l):k.Nb=[l];return n.call(k,k.Nb.length-1)},{yt:g});e.push(f)},function(h){d(new globalThis.Error(h))});e.push(a);return new tp(e)};
function aq(a,b,c){if(!fb(a))throw new C(c,0,"has invalid type");if(!fb(b))throw new C(c,1,"has invalid type");if(a.length!==b.length||!a.length)throw new C(c,1,"specify one key attribute for each given layer id in the same order");}
Up.prototype.re=function(a,b,c,d,e,f){function g(l,n){n&&h--;d(l,!h)}var h,k=[];aq(a,b,this.re);No(this.re,3,d,e);B(c,K,this.re,2);c={bbox:c.fa+","+c.W+";"+c.ga+","+c.ca};f&&Qa(c,f);a=c.layer_id?[c.layer_id]:a;f=0;for(h=a.length;f<h;f++)c.layer_id=a[f],c.key_attribute=b[f],k.push(this.Bg("search/bbox",c,g,e));return new tp(k)};Up.prototype.searchByBoundingBox=Up.prototype.re;
Up.prototype.Yc=function(a,b,c,d,e,f,g){aq(a,b,this.Yc);B(c,Re,this.Yc,2,"has invalid type");if(!jb(d))throw new C(this.Yc,3,"has invalid type");No(this.Yc,4,e,f);a={layer_ids:a.join(","),key_attributes:b.join(","),proximity:c.lat+","+c.lng+","+d};g&&Qa(a,g);return this.Bg("search/proximity",a,e,f)};Up.prototype.searchByProximity=Up.prototype.Yc;
Up.prototype.Xc=function(a,b,c,d,e,f,g){var h="";aq(a,b,this.Xc);if(!gb(c)&&!B(c,N))throw new C(this.Xc,1,"has invalid type");if(!jb(d))throw new C(this.Xc,2,"has invalid type");No(this.Xc,4,e,f);a={layer_ids:a.join(","),key_attributes:b.join(","),radius:d};if(gb(c))a.route_id=c;else{d=c.S;c=0;for(b=d.length;c<b;c+=3)h+=d[c]+","+d[c+1],c<b-3&&(h+=";");a.corridor=h}g&&Qa(a,g);return this.Bg("search/corridor",a,e,f)};Up.prototype.searchByCorridor=Up.prototype.Xc;
X.prototype.vA=function(a){return this.Ja(Up,a)};X.prototype.getPlatformDataService=X.prototype.vA;function bq(a){oo(bq,"Use HERE Geocoding and Search API v7 instead.");bq.g.constructor.call(this,bq,a)}u(bq,so);t("H.service.PlacesService",bq);bq.prototype.ya=function(){return{subDomain:"places.ls",path:"places/v1"}};bq.CONFIG_KEY="places";bq.EntryPoint={SEARCH:"discover/search",SUGGEST:"suggest",EXPLORE:"discover/explore",AROUND:"discover/around",HERE:"discover/here",CATEGORIES:"categories/places"};bq.prototype.request=function(a,b,c,d){return this.I(a,b,c,d)};bq.prototype.request=bq.prototype.request;
bq.prototype.I=function(a,b,c,d){a=this.i().clone().A(a).v(b||{});return this.u(a,c,d)};bq.prototype.search=function(a,b,c){return this.I("discover/search",a,b,c)};bq.prototype.search=bq.prototype.search;bq.prototype.wD=function(a,b,c){return this.I("suggest",a,b,c)};bq.prototype.suggest=bq.prototype.wD;bq.prototype.jz=function(a,b,c){return this.I("discover/explore",a,b,c)};bq.prototype.explore=bq.prototype.jz;bq.prototype.sy=function(a,b,c){return this.I("discover/around",a,b,c)};
bq.prototype.around=bq.prototype.sy;bq.prototype.aB=function(a,b,c){return this.I("discover/here",a,b,c)};bq.prototype.here=bq.prototype.aB;bq.prototype.Ey=function(a,b,c){return this.I("categories/places",a,b,c)};bq.prototype.categories=bq.prototype.Ey;bq.prototype.nz=function(a,b,c,d){a=Ao(a).v(this.i().getQuery()).v(d||{});return this.u(a,b,c)};bq.prototype.follow=bq.prototype.nz;X.prototype.uA=function(a){return this.Ja(bq,a)};X.prototype.getPlacesService=X.prototype.uA;function cq(a){bq.g.constructor.call(this,cq,a);oo(cq)}u(cq,so);t("H.service.extension.customRoute.Service",cq);cq.prototype.ya=function(){return{subDomain:"s.fleet.ls",path:"2"}};cq.CONFIG_KEY="customRoute";cq.prototype.Ic=function(a){return Error(a.issues&&a.issues.length?a.issues.map(function(b){return b.message}).join(". "):a)};cq.prototype.Xg=function(a,b,c){No(this.Xg,1,b,c);a=this.i().clone().A("calculateroute.json").v(a);return this.u(a,b,c)};cq.prototype.calculateRoute=cq.prototype.Xg;
X.prototype.Mz=function(a){return this.Ja(cq,a)};X.prototype.getCustomRoutingService=X.prototype.Mz;function dq(a,b,c){var d=this,e=c||{},f=+e.min,g=+e.max;e.tileSize=e.tileSize||512;e.min=f?cd(f,1,17):1;e.min+=Gi(e.tileSize,1);e.max=g?cd(g,1,17):17;dq.g.constructor.call(this,e);B(a,eq,dq,0);B(b,gf,dq,1);this.$=a;b.Xb&&b.Xb("OMV");this.Wa(b,!0);this.zn=!1;c&&(c.politicalView&&(this.An=c.politicalView),fq(this,c.lg,c.lg2),this.zn=!!c.pois);this.Dw=function(){d.Il=mo(d);d.reload(!1)};a.addEventListener("versionupdate",this.Dw);this.Il=mo(this);dq.prototype.Zo=function(){var h=/^v2\/vectortiles\/(.+)\/mc$/.exec(a.i().hf);
return h?h[1]:A+""}()}u(dq,T);t("H.service.omv.Provider",dq);dq.prototype.Wc=me;dq.prototype.providesOMV=dq.prototype.Wc;dq.prototype.bc=function(a){return this.Il.test(a)};dq.prototype.cacheFilter=dq.prototype.bc;dq.prototype.Td=function(a,b,c){return this.$.Rf(a,b,c).toString()};dq.prototype.getTileKey=dq.prototype.Td;dq.prototype.Rb=function(){return this.XB};dq.prototype.getCache=dq.prototype.Rb;dq.prototype.xA=function(){return this.An};dq.prototype.getPoliticalView=dq.prototype.xA;
dq.prototype.fD=function(a){var b=this.An;this.An=a;this.dispatchEvent(new kg("politicalviewchange",this.An,b))};dq.prototype.setPoliticalView=dq.prototype.fD;dq.prototype.MAX_STORE_TIME=2592E6;dq.prototype.Wi=function(){return kk()};dq.prototype.rd=function(){return kk()?jk():dq.g.rd.call(this)};dq.prototype.u=function(a,b,c,d,e){return this.$.Pa(a,b,c,d,e)};dq.prototype.requestInternal=dq.prototype.u;dq.prototype.Bb=function(a){a.Xb&&a.Xb("OMV");this.Wa(a)};dq.prototype.setStyle=dq.prototype.Bb;
dq.prototype.K=function(){return dq.g.kb.apply(this)};dq.prototype.getStyle=dq.prototype.K;dq.prototype.kb=function(){var a=dq.g.kb.apply(this),b=a.getState()===hf.READY,c=a.Qd();b&&c&&c.global&&(this.oq&&(this.sw&&(c.global.ux_language=this.sw),this.Ut&&(c.global.ux_language_fallback=this.Ut)),this.zn&&c.global.poi&&c.global.poi["default"]&&(c.global.poi["default"].visible=this.zn),this.oq||this.zn)&&(a=new Wf(c,a.Kc()));return a};dq.prototype.getStyleInternal=dq.prototype.kb;
function fq(a,b,c){var d=gb(b),e=gb(c);d&&(a.sw=b);e&&(a.Ut=c);if(d||e)a.$j=[],d=/^([a-zA-Z]{2})(-|$)/,(e=d.exec(b))&&("zh"===e[1]?a.$j.push(b):a.$j.push(e[1])),(e=d.exec(c))&&("zh"===e[1]?a.$j.push(c):a.$j.push(e[1])),a.oq=!0}dq.prototype.oq=!1;var gq=["en"];dq.prototype.Jp=function(){return this.$j||gq};dq.prototype.getLanguages=dq.prototype.Jp;dq.prototype.disposeInternal=function(){dq.g.disposeInternal.call(this);this.$.removeEventListener("versionupdate",this.Dw)};dq.prototype.XB=new bj(256);
dq.prototype.U=function(a,b){return this.$.U().query(this.Zo,b,a)};dq.prototype.getCopyrights=dq.prototype.U;function eq(a){eq.g.constructor.call(this,eq,a);var b=to(this,a).mapVersion;this.Hn=a.queryParams||{};this.ek=ab(b)?b:hq[this.i().toString()];ab(this.ek)||iq(this)}u(eq,so);t("H.service.omv.Service",eq);eq.prototype.ya=function(){return{subDomain:"vector",path:"v2/vectortiles/base/mc"}};eq.CONFIG_KEY="omv";var hq={};mb(hq);eq.prototype.lA=function(){return this.ek};eq.prototype.getMapVersion=eq.prototype.lA;
function iq(a){a.u(a.i().clone().A("../../info"),function(b){b=b.mapVersion;var c=a.i().toString();a.ek=b;b!==hq[c]&&(hq[c]=b,a.dispatchEvent("versionupdate"))},function(){})}eq.prototype.md=function(a,b,c){b=b||{};var d={min:0,max:22};ya(c)&&no(d,c);return new Ei(new dq(this,a,b),d)};eq.prototype.createLayer=eq.prototype.md;eq.prototype.Pa=function(a,b,c,d,e){return this.u(this.Rf(a,b,c),function(f){return f.arrayBuffer().then(d,e)},e,"arraybuffer")};
eq.prototype.Rf=function(a,b,c){a=this.i().clone().A(c+"/"+a+"/"+b+"/omv");ab(this.ek)&&a.v({mv:this.ek}).v(this.Hn);return a};eq.prototype.sm=function(a){return qn()+"/"+a};eq.prototype.Oj=function(a,b){if(!Za(a))throw new C(this.Oj,0,'"onResult" must be a function');if(!Za(b))throw new C(this.Oj,1,'"onError" must be a function');return this.u(this.i().clone().vc("v2/vectortiles/pviews"),a,b)};eq.prototype.getPoliticalViews=eq.prototype.Oj;X.prototype.Mj=function(a){return this.Ja(eq,a)};
X.prototype.getOMVService=X.prototype.Mj;eq.prototype.Jf=function(){this.dc=new Jo;this.u(this.i().clone().A("../../copyrights"),z(this.ql,this),oe)};eq.prototype.ql=function(a){Ko(this.dc,a);this.dispatchEvent("copyrightupdate")};eq.prototype.U=function(){this.dc||this.Jf();return this.dc};eq.prototype.getCopyrights=eq.prototype.U;function jq(a){jq.g.constructor.call(this,jq,a)}u(jq,so);t("H.service.RoutingService8",jq);jq.CONFIG_KEY="routing_v8";jq.prototype.ya=function(){return{subDomain:"router",path:"v8/routes"}};jq.prototype.Ic=function(a){return Error(401===(a&&void 0===a.status?401:a.status)?a.error_description:a.title,{cause:a})};jq.prototype.Xg=function(a,b,c){a=this.i().clone().v(a);return this.u(a,b,c)};jq.prototype.calculateRoute=jq.prototype.Xg;
jq.prototype.Oo=function(a,b,c){a=this.i().clone().sa("isoline").vc("v8/isolines").v(a);return this.u(a,b,c)};jq.prototype.calculateIsoline=jq.prototype.Oo;function kq(a){kq.g.constructor.call(this,kq,a);oo(kq,"Use HERE Routing API v8 instead.")}u(kq,so);t("H.service.RoutingService",kq);kq.prototype.ya=function(){return{subDomain:"route.ls",path:"routing/7.2"}};kq.prototype.Ic=function(a){return Error(a.details)};kq.CONFIG_KEY="routing";kq.prototype.Xg=function(a,b,c){a=this.i().clone().A("calculateroute.json").v(a);return this.u(a,b,c)};kq.prototype.calculateRoute=kq.prototype.Xg;
kq.prototype.Oo=function(a,b,c){a=this.i().clone().sa("isoline").A("calculateisoline.json").v(a);return this.u(a,b,c)};kq.prototype.calculateIsoline=kq.prototype.Oo;X.prototype.qu=function(a,b){b=+b||7;if(7===b)b=kq;else if(8===b)b=jq;else throw new C(this.qu,1,"allowed values are 7 and 8");return this.Ja(b,a)};X.prototype.getRoutingService=X.prototype.qu;function lq(a){this.ms=!!a.toBypassToken;if(!this.ms&&!a.token)throw new C(lq,0,'"token" must be specified');oo(lq,"Use HERE IML service instead.");lq.g.constructor.call(this,lq,a);this.Dx=a.token;this.qt={};this.Wl={}}u(lq,so);t("H.service.xyz.Service",lq);lq.prototype.ya=function(){return{host:"xyz.api.here.com",path:"hub/spaces"}};lq.prototype.Ic=function(a){return Error(a.errorMessage||a.message)};
lq.prototype.Op=function(a,b,c){db(a,"String",this.Op,0,'"projectId" must be a string');mq(this.Op,1,b,c);a=nq(this.i().clone().vc("project-api/projects/"+a));return this.u(a,b,c)};lq.prototype.getProject=lq.prototype.Op;lq.prototype.ru=function(a,b,c){mq(this.ru,0,a,b);c=oq(this,this.i().clone().v(c||{}));return this.u(c,a,b)};lq.prototype.getSpaces=lq.prototype.ru;
lq.prototype.rm=function(a,b,c){db(a,"String",this.rm,0,'"spaceId" must be a string');mq(this.rm,1,b,c);a=oq(this,this.i().clone().A(a));return this.u(a,b,c)};lq.prototype.getSpace=lq.prototype.rm;lq.prototype.Dh=function(a,b,c){db(a,"String",this.Dh,0,'"spaceId" must be a string');mq(this.Dh,1,b,c);a=oq(this,this.i().clone().A(a+"/statistics"));return this.u(a,b,c)};lq.prototype.getStatistics=lq.prototype.Dh;
lq.prototype.mm=function(a,b,c,d,e,f,g){a=oq(this,this.i().clone().A(d+"/tile/web/"+c+"_"+a+"_"+b+".mvtf").v(Object.assign({clip:!0},g)));return this.u(a,function(h){return h.arrayBuffer().then(e)},f,"arraybuffer")};lq.prototype.search=function(a,b,c,d){db(a,"String",this.search,0,'"spaceId" must be a string');mq(this.search,1,b,c);a=oq(this,this.i().clone().A(a+"/search").v(d||{}));return this.u(a,b,c)};lq.prototype.search=lq.prototype.search;
lq.prototype.Te=function(a,b,c,d){db(a,"String",this.Te,0,'"spaceId" must be a string');if(!ya(b))throw new C(this.Te,1,'"params" must be an object');mq(this.Te,2,c,d);a=oq(this,this.i().clone().A(a+"/features").v(b));return this.u(a,c,d)};lq.prototype.getFeaturesById=lq.prototype.Te;
lq.prototype.wh=function(a,b,c,d){db(a,"String",this.wh,0,'"spaceId" must be a string');if(!ya(b))throw new C(this.Te,1,'"params" must be an object');mq(this.wh,2,c,d);a=oq(this,this.i().clone().A(a+"/bbox").v(b));return this.u(a,c,d)};lq.prototype.getFeaturesByBoundingBox=lq.prototype.wh;lq.prototype.U=function(a){var b=this.qt[a];if(b)return b;this.Wl[a]||this.Jf(a);return null};
lq.prototype.mf=function(a,b,c,d,e){db(a,"String",this.mf,0,'"spaceId" must be a string');if(!ya(b))throw new C(this.mf,1,'"geojsonObject" must be an object');mq(this.mf,2,c,d);if(e&&!ya(e))throw new C(this.mf,4,'"opt_params" must be an object');return pq(this,a,c,d,"PUT",b,e)};lq.prototype.putFeatures=lq.prototype.mf;
lq.prototype.kf=function(a,b,c,d,e){db(a,"String",this.kf,0,'"spaceId" must be a string');if(!ya(b))throw new C(this.kf,1,'"featureCollection" must be an object');mq(this.kf,2,c,d);if(e&&!ya(e))throw new C(this.kf,4,'"opt_params" must be an object');return pq(this,a,c,d,"POST",b,e)};lq.prototype.postFeatures=lq.prototype.kf;
lq.prototype.Hf=function(a,b,c,d){db(a,"String",this.Hf,0,'"spaceId" must be a string');if(!ya(b))throw new C(this.Hf,1,'"params" must be an object');mq(this.Hf,2,c,d);return pq(this,a,c,d,"DELETE",A,b)};lq.prototype.deleteFeatures=lq.prototype.Hf;
function pq(a,b,c,d,e,f,g){var h=Object.assign(a.ms?{}:{authorization:"Bearer "+a.Dx},{"Content-Type":"application/geo+json"},a.oc);e={method:e,headers:h};f&&(e.data=JSON.stringify(f));b=nq(a.i().clone().A(b+"/features").v(g||{}));f=new Qf("application/json",b.toString(),Vd,e);f.then(c,vo(a,b,d));return f}lq.prototype.Jf=function(a){var b=this;this.Wl[a]=qq;this.rm(a,function(c){b.Wl[a]=rq;b.qt[a]=c.copyright;b.dispatchEvent("copyrightupdate")},function(c){b.Wl[a]=sq;throw c;})};
function oq(a,b){return a.ms?b:nq(b).v({access_token:a.Dx})}function nq(a){var b=Object.assign({},a.getQuery());delete b.apikey;return a.Uk(b)}lq.CONFIG_KEY="xyz";var qq=1,rq=2,sq=-1;function mq(a,b,c,d){if(!Za(c))throw new C(a,b,'"onResult" must be a function');if(!Za(d))throw new C(a,b+1,'"onError" must be a function');}X.prototype.WA=function(a){return this.Ja(lq,a)};X.prototype.getXYZService=X.prototype.WA;function tq(a,b,c){var d;tq.g.constructor.call(this,c?{min:c.min,max:c.max,engineType:c.engineType}:void 0);B(a,lq,tq,0);if(!gb(b))throw new C(tq,1,'"spaceId" must be a string');this.$=a;this.Gg=b;this.Pk={};if(c&&(["limit","simplificationLevel","tags"].forEach(function(e){e in c&&(this.Pk[e]=c[e])},this),a=c.parameters))for(d in a)this.Pk[d]=a[d];this.Wa(this.Fp())}u(tq,T);t("H.service.xyz.Provider",tq);tq.prototype.u=function(a,b,c,d,e){return this.$.mm(a,b,c,this.Gg,d,e,this.Pk)};
tq.prototype.requestInternal=tq.prototype.u;tq.prototype.U=function(){return this.$.U(this.Gg)};tq.prototype.getCopyrights=tq.prototype.U;tq.prototype.Wc=me;tq.prototype.providesOMV=tq.prototype.Wc;tq.prototype.K=function(){return this.kb()};tq.prototype.getStyle=tq.prototype.K;tq.prototype.Bb=function(a){B(a,Wf)&&a.Xb("MVT");this.Wa(a)};tq.prototype.setStyle=tq.prototype.Bb;
tq.prototype.Fp=function(){return this.ub===mg.WEBGL?new Wf({sources:{xyz:{type:"MVT"}},layers:{xyz:{data:{source:"xyz",layer:this.Gg},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#000000",width:"2px",join:"round",cap:"round"}}}}}}):
new H.map.render.harp.Style({styles:[{layer:this.Gg,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.Gg,when:["==",["geometry-type"],"Polygon"],technique:"polygon",color:"#E39E3C",renderOrder:201},{layer:this.Gg,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",width:"1px",renderOrder:202},{layer:this.Gg,when:["==",["geometry-type"],"LineString"],technique:"solid-line",
color:"#000000",width:"2px",renderOrder:203}]})};function uq(a){uq.g.constructor.call(this,uq,a)}u(uq,so);t("H.service.SearchService",uq);uq.CONFIG_KEY="search";uq.prototype.ya=function(){return{subDomain:"search",path:"v1"}};uq.prototype.Ic=function(a){a=[a.title,a.action,a.cause].filter(function(b){return b});return Error(a.join(". "))};uq.prototype.yp=function(a,b,c){a=this.i().clone().sa("geocode").A("geocode").v(a);return this.u(a,b,c)};uq.prototype.geocode=uq.prototype.yp;
uq.prototype.Fr=function(a,b,c){a=this.i().clone().sa("revgeocode").A("revgeocode").v(a);return this.u(a,b,c)};uq.prototype.reverseGeocode=uq.prototype.Fr;uq.prototype.uy=function(a,b,c){a=this.i().clone().sa("autosuggest").A("autosuggest").v(a);return this.u(a,b,c)};uq.prototype.autosuggest=uq.prototype.uy;uq.prototype.autocomplete=function(a,b,c){a=this.i().clone().sa("autocomplete").A("autocomplete").v(a);return this.u(a,b,c)};uq.prototype.autocomplete=uq.prototype.autocomplete;
uq.prototype.Xy=function(a,b,c){a=this.i().clone().sa("discover").A("discover").v(a);return this.u(a,b,c)};uq.prototype.discover=uq.prototype.Xy;uq.prototype.DB=function(a,b,c){a=this.i().clone().sa("lookup").A("lookup").v(a);return this.u(a,b,c)};uq.prototype.lookup=uq.prototype.DB;uq.prototype.yy=function(a,b,c){a=this.i().clone().sa("browse").A("browse").v(a);return this.u(a,b,c)};uq.prototype.browse=uq.prototype.yy;X.prototype.IA=function(a){return this.Ja(uq,a)};
X.prototype.getSearchService=X.prototype.IA;function zo(a){a=void 0===a?{}:a;zo.g.constructor.call(this,zo,a);this.Ci={Tn:a.resource||"base",Fn:a.projection||"mc",format:a.format||"png8"};this.Hn=a.queryParams||{}}u(zo,so);t("H.service.rasterTile.Service",zo);m=zo.prototype;m.K=function(){return this.Hn.style||"explore.day"};m.Rf=function(a,b,c){return this.i().clone().A(this.Ci.Tn+"/"+(this.Ci.Fn+"/")+(c+"/"+a+"/"+b+"/")+this.Ci.format).v(this.Hn)};m.ya=function(){return{subDomain:"maps",path:"v3"}};
m.U=function(){this.dc||this.Jf();return this.dc};m.Jf=function(){this.dc=new Jo;this.u(this.i().clone().A("copyright"),z(this.ql,this),oe)};m.ql=function(a){var b=a.copyrights;a=a.resources;var c={},d=this.Ci.Tn+"."+this.K();c[d]=[];a[this.Ci.Tn].styles[this.K()].forEach(function(e){b[e].forEach(function(f){var g=[];f.boundingBoxes.forEach(function(h){g.push([h.north,h.west,h.south,h.east])});c[d].push({boxes:g,label:f.label,alt:f.alt,minLevel:f.minLevel,maxLevel:f.maxLevel})})});Ko(this.dc,c)};
m.Lj=function(a,b){return this.u(this.i().clone().A("info"),a,b)};zo.prototype.getInfo=zo.prototype.Lj;zo.prototype.Oj=function(a,b){return this.u(this.i().clone().A("politicalViews"),a,b)};zo.prototype.getPoliticalViews=zo.prototype.Oj;zo.prototype.Wz=function(a,b){return this.u(this.i().clone().A("features"),a,b)};zo.prototype.getFeatures=zo.prototype.Wz;zo.prototype.Jp=function(a,b){return this.u(this.i().clone().A("languages"),a,b)};zo.prototype.getLanguages=zo.prototype.Jp;zo.CONFIG_KEY="rasterTile";
X.prototype.Rp=function(a){return this.Ja(zo,a)};X.prototype.getRasterTileService=X.prototype.Rp;function vq(a){vq.g.constructor.call(this,vq,a)}u(vq,so);t("H.service.GeofencingService",vq);vq.CONFIG_KEY="geofencing";vq.prototype.Ic=function(a){return Error(a.issues&&a.issues[0]?a.issues[0].message:a.message,{cause:a})};vq.prototype.vz=function(a,b,c){a=this.i().clone().sa("geofencing").vc("v8/geofence").v(a);return this.I(a,"GET",b,c)};vq.prototype.geofence=vq.prototype.vz;
vq.prototype.delete=function(a,b,c){a=this.i().clone().sa("geofencing").vc("v8/geofence/delete").v(a);return this.I(a,"GET",b,c)};vq.prototype["delete"]=vq.prototype.delete;vq.prototype.upload=function(a,b,c,d){a=this.i().clone().sa("geofencing").vc("v8/geofence/upload").v(a);b=wq(vq.prototype.upload,b);return this.I(a,"POST",c,d,b)};vq.prototype.upload=vq.prototype.upload;
vq.prototype.modify=function(a,b,c,d){a=this.i().clone().sa("geofencing").vc("v8/geofence/modify").v(a);b=wq(vq.prototype.modify,b);return this.I(a,"POST",c,d,b)};vq.prototype.modify=vq.prototype.modify;function wq(a,b){if(!(b instanceof Blob))throw new C(a,1,"must be an instance of Blob");a=new FormData;a.append("file",b);return a}
vq.prototype.I=function(a,b,c,d,e,f){f=void 0===f?"application/json":f;b={method:b,headers:Object.assign({},this.oc),data:e?e:void 0};f=new Qf(f,a.toString(),Vd,b);f.then(c,vo(this,a,d));return f};X.prototype.iu=function(a,b){b=b?+b:void 0;if(void 0===b)b=Rp;else if(8===b)b=vq;else throw new C(this.iu,1,"allowed values are 8 or undefined");return this.Ja(b,a)};X.prototype.getGeofencingService=X.prototype.iu;function xq(a,b,c){c=c||{};var d=+c.min,e=+c.max;c.min=d?cd(d,1,17):1;c.max=e?cd(e,1,17):17;xq.g.constructor.call(this,c);B(a,yq,xq,0);B(b,gf,xq,1);this.$=a;b.Xb&&b.Xb("OMV");this.Wa(b,!0);this.Il=mo(this)}u(xq,T);t("H.service.trafficVectorTile.Provider",xq);xq.prototype.Wc=me;xq.prototype.providesOMV=xq.prototype.Wc;xq.prototype.bc=function(a){return this.Il.test(a)};xq.prototype.cacheFilter=xq.prototype.bc;xq.prototype.Td=function(a,b,c){return this.$.Rf(a,b,c).toString()};
xq.prototype.getTileKey=xq.prototype.Td;xq.prototype.Rb=function(){return this.vf};xq.prototype.getCache=xq.prototype.Rb;xq.prototype.MAX_STORE_TIME=2592E6;xq.prototype.Wi=function(){return kk()};xq.prototype.rd=function(){return kk()?jk():xq.g.rd.call(this)};xq.prototype.u=function(a,b,c,d,e){return this.$.Pa(a,b,c,d,e)};xq.prototype.requestInternal=xq.prototype.u;xq.prototype.Bb=function(a){a.Xb&&a.Xb("OMV");this.Wa(a)};xq.prototype.setStyle=xq.prototype.Bb;xq.prototype.K=function(){return xq.g.kb.apply(this)};
xq.prototype.getStyle=xq.prototype.K;xq.prototype.vf=new bj(256);xq.prototype.U=function(){return null};xq.prototype.getCopyrights=xq.prototype.U;function yq(a){yq.g.constructor.call(this,yq,a);this.Aq=(a||qe).layer||"traffic";this.le="mc";this.pz="omv"}u(yq,so);t("H.service.trafficVectorTile.Service",yq);yq.prototype.ya=function(){return{subDomain:"traffic.vector",path:"v2"}};yq.CONFIG_KEY="trafficVectorTile";yq.prototype.md=function(a,b,c){b=b||{};var d={min:0,max:22};ya(c)&&no(d,c);return new Ei(new xq(this,a,b),d)};yq.prototype.createLayer=yq.prototype.md;
yq.prototype.Pa=function(a,b,c,d,e){return this.u(this.Rf(a,b,c),function(f){return f.arrayBuffer().then(d,e)},e,"arraybuffer")};yq.prototype.Rf=function(a,b,c){return this.i().clone().A("traffictiles/"+this.Aq+"/"+this.le+"/"+c+"/"+a+"/"+b+"/"+this.pz)};yq.prototype.sm=function(a){return qn()+"/"+a};yq.prototype.gA=function(){return this.Aq};yq.prototype.getLayerName=yq.prototype.gA;X.prototype.Vp=function(a){return this.Ja(yq,a)};X.prototype.getTrafficVectorTileService=X.prototype.Vp;function zq(a){zq.g.constructor.call(this,zq,a);this.su=a.getToken}u(zq,so);t("H.service.iml.Service",zq);zq.prototype.ya=function(){return{host:"interactive.data.api.platform.here.com",path:"interactive/v1/catalogs"}};
zq.prototype.Ic=function(a){function b(){for(var d=fa(c),e=d.next();!e.done;e=d.next()){e=e.value;var f=e.format;if(e.keys.every(function(g){return a[g]}))return f()}return JSON.stringify(a)}var c=[{keys:["code","title","cause","action"],format:function(){return a.code+": "+a.title+"; cause: "+a.cause+"; action: "+a.action}},{keys:["error","error_description"],format:function(){return a.error+": "+a.error_description}},{keys:["error","errorMessage"],format:function(){return a.error+": "+a.errorMessage}}];
return Error(ya(a)?b():a)};zq.prototype.Dh=function(a,b,c,d,e){var f=this.Dh;Aq(f,0,a,b);Bq(f,2,c,d);a=this.i().clone().A(a+"/layers/"+b+"/statistics").v(e||{});return this.I(a,"GET",c,d)};zq.prototype.getStatistics=zq.prototype.Dh;zq.prototype.mm=function(a,b,c,d,e,f,g,h,k){var l=k?"":".mvtf";a=this.i().clone().A(d+"/layers/"+e+"/tile/web/"+c+"_"+a+"_"+b+l).v(Object.assign({clip:!0},h));return this.I(a,"GET",k?f:function(n){return n.arrayBuffer().then(f)},g,void 0,k?"application/json":"arraybuffer")};
zq.prototype.getFeaturesByTile=zq.prototype.mm;zq.prototype.fu=function(a,b,c,d,e,f){var g=this.fu;Cq(g,a);Aq(g,1,b,c);Bq(g,3,d,e);a=Dq(this,a,b,c,f);return this.I(a,"GET",d,e)};zq.prototype.getFeatureById=zq.prototype.fu;zq.prototype.Te=function(a,b,c,d,e,f){var g=this.Te;Eq(g,a);Aq(g,1,b,c);Bq(g,3,d,e);a=Fq(this,a,b,c,f);return this.I(a,"GET",d,e)};zq.prototype.getFeaturesById=zq.prototype.Te;
zq.prototype.wh=function(a,b,c,d,e){var f=this.wh;if(!ya(a)||!(a.bbox||a.north&&a.east&&a.south&&a.west))throw new C(f,0,'must be an object with either "bbox" or a full set of "north", "east", "south" and "west"');Aq(f,1,b,c);Bq(f,3,d,e);a=this.i().clone().A(b+"/layers/"+c+"/bbox").v(a);return this.I(a,"GET",d,e)};zq.prototype.getFeaturesByBoundingBox=zq.prototype.wh;
zq.prototype.hu=function(a,b,c,d,e){var f=this.hu;if(!(ya(a)&&a.radius&&(a.lat&&(a.lng||a.lon)||a.refCatalogHrn&&a.refLayerId&&a.refFeatureId)))throw new C(f,0,'must be an object with "radius" and a combination of either "lat"+"lng" or "refCatalogHrn"+"refLayerId"+"refFeatureId"');Aq(f,1,b,c);Bq(f,3,d,e);a=this.i().clone().A(b+"/layers/"+c+"/spatial").v(a);return this.I(a,"GET",d,e)};zq.prototype.getFeaturesByPointAndRadius=zq.prototype.hu;
zq.prototype.gu=function(a,b,c,d,e,f){var g=this.gu;if(!ya(a)||!a.radius)throw new C(g,0,'must be an object with "radius"');Gq(g,1,b);Aq(g,2,c,d);Bq(g,4,e,f);a=this.i().clone().A(c+"/layers/"+d+"/spatial").v(a);return this.I(a,"POST",e,f,b)};zq.prototype.getFeaturesByGeometryAndRadius=zq.prototype.gu;zq.prototype.Rw=function(a,b,c,d,e){var f=this.Rw;Aq(f,0,a,b);Bq(f,2,c,d);a=this.i().clone().A(a+"/layers/"+b+"/search").v(e||{});return this.I(a,"GET",c,d)};zq.prototype.searchFeatures=zq.prototype.Rw;
zq.prototype.Zu=function(a,b,c,d,e){var f=this.Zu;Aq(f,0,a,b);Bq(f,2,c,d);a=this.i().clone().A(a+"/layers/"+b+"/iterate").v(e||{});return this.I(a,"GET",c,d)};zq.prototype.iterateFeatures=zq.prototype.Zu;zq.prototype.mf=function(a,b,c,d,e,f){var g=this.mf;Gq(g,0,a);Aq(g,1,b,c);Bq(g,3,d,e);b=Hq(this,b,c,f);return this.I(b,"PUT",d,e,a)};zq.prototype.putFeatures=zq.prototype.mf;
zq.prototype.kf=function(a,b,c,d,e,f){var g=this.kf;Gq(g,0,a);Aq(g,1,b,c);Bq(g,3,d,e);b=Hq(this,b,c,f);return this.I(b,"POST",d,e,a)};zq.prototype.postFeatures=zq.prototype.kf;zq.prototype.Hf=function(a,b,c,d,e){var f=this.Hf;Eq(f,a);Aq(f,1,b,c);Bq(f,3,d,e);a=Fq(this,a,b,c);return this.I(a,"DELETE",d,e)};zq.prototype.deleteFeatures=zq.prototype.Hf;zq.prototype.Bw=function(a,b,c,d,e,f,g){var h=this.Bw;Cq(h,a);Gq(h,1,b);Aq(h,2,c,d);Bq(h,4,e,f);a=Dq(this,a,c,d,g);return this.I(a,"PUT",e,f,b)};
zq.prototype.putFeature=zq.prototype.Bw;zq.prototype.gw=function(a,b,c,d,e,f,g){var h=this.gw;Cq(h,a);Gq(h,1,b);Aq(h,2,c,d);Bq(h,4,e,f);a=Dq(this,a,c,d,g);return this.I(a,"PATCH",e,f,b)};zq.prototype.patchFeature=zq.prototype.gw;zq.prototype.At=function(a,b,c,d,e){var f=this.At;Cq(f,a);Aq(f,1,b,c);Bq(f,3,d,e);a=Dq(this,a,b,c);return this.I(a,"DELETE",d,e,void 0,"text/plain")};zq.prototype.deleteFeature=zq.prototype.At;
function Hq(a,b,c,d){return a.i().clone().A(b+"/layers/"+c+"/features").v(d||{})}function Fq(a,b,c,d,e){b=Object.assign({},e,{id:new Eo(b)});return Hq(a,c,d,b)}function Dq(a,b,c,d,e){return a.i().clone().A(c+"/layers/"+d+"/features/"+b).v(e||{})}
zq.prototype.I=function(a,b,c,d,e,f){f=void 0===f?"application/json":f;b={method:b,headers:Object.assign({},e?{"Content-Type":"application/geo+json"}:void 0,"function"===typeof this.su?{Authorization:"Bearer "+this.su()}:void 0,this.oc)};e&&(b.data=JSON.stringify(e));e=new Qf(f,a.toString(),Vd,b);e.then(c,vo(this,a,d));return e};zq.CONFIG_KEY="iml";function Aq(a,b,c,d){db(c,"String",a,b,"must be a string");db(d,"String",a,b+1,"must be a string")}
function Cq(a,b){db(b,"String",a,0,"must be a string")}function Eq(a,b){if(!Array.isArray(b)||0===b.length||b.some(function(c){return"string"!==typeof c}))throw new C(a,0,"must be a non-empty array of strings");}function Gq(a,b,c){if(!ya(c))throw new C(a,b,"must be a GeoJSON object");}function Bq(a,b,c,d){if(!Za(c))throw new C(a,b,"must be a function");if(!Za(d))throw new C(a,b+1,"must be a function");}X.prototype.aA=function(a){return this.Ja(zq,a)};X.prototype.getIMLService=X.prototype.aA;function Iq(a,b,c,d){Iq.g.constructor.call(this,d?{min:d.min,max:d.max,engineType:d.engineType}:void 0);B(a,zq,Iq,0);if(!gb(b))throw new C(Iq,1,'"catalogHrn" must be a string');if(!gb(c))throw new C(Iq,2,'"layerId" must be a string');this.$=a;this.$g=b;this.Mh=c;this.Pk=ya(d)&&ya(d.parameters)?d.parameters:{};this.Wa(this.Fp())}u(Iq,T);t("H.service.iml.Provider",Iq);Iq.prototype.u=function(a,b,c,d,e){return this.$.mm(a,b,c,this.$g,this.Mh,d,e,this.Pk)};Iq.prototype.requestInternal=Iq.prototype.u;
Iq.prototype.Wc=me;Iq.prototype.providesOMV=Iq.prototype.Wc;Iq.prototype.K=function(){return this.kb()};Iq.prototype.getStyle=Iq.prototype.K;Iq.prototype.Bb=function(a){B(a,Wf)&&a.Xb("MVT");this.Wa(a)};Iq.prototype.setStyle=Iq.prototype.Bb;
Iq.prototype.Fp=function(){return this.ub===mg.WEBGL?new Wf({sources:{iml:{type:"MVT"}},layers:{iml:{data:{source:"iml",layer:this.$g+":"+this.Mh},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#0258AE",width:"2px",join:"round",
cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.$g+":"+this.Mh,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.$g+":"+this.Mh,when:["==",["geometry-type"],"Polygon"],technique:"polygon",color:"#E39E3C",renderOrder:201},{layer:this.$g+":"+this.Mh,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",width:"1px",renderOrder:202},{layer:this.$g+
":"+this.Mh,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#0258AE",width:"2px",renderOrder:203}]})};X.prototype.Yl=function(a,b,c,d,e,f){function g(Oa,ic,jc){ic=Oa.sm(ic);ic=r?new Wf(ic):new H.map.render.harp.Style(ic);var Ka={engineType:l};p&&p.politicalView&&(Ka.politicalView=p.politicalView);c&&(Ka.lg=c);d&&(Ka.lg2=d);f&&(Ka.pois=f);var zc;jc&&(zc={dark:jc});return Oa.md(ic,Ka,zc)}function h(Oa,ic,jc,Ka,zc){return Oa.Nd(ic,jc,v,Ka,w,1,zc,n)}var k=this,l=lg,n={crossOrigin:"anonymous"};if(ya(a)){var p=a;"crossOrigin"in p&&(n.crossOrigin=p.crossOrigin);a=p.tileSize;b=p.ppi;c=p.lg;d=p.lg2;e=p.style;
f=p.pois;void 0!==p.engineType&&(l=p.engineType,n.engineType=l)}var q=l===mg.HARP,r=l===mg.WEBGL,v=a||512,w={};if(0>[72,250,320,500].indexOf(+b)){if(b!==A)throw new C(this.Yl,1,b);}else w.ppi=+b;c&&(w.lg=c);d&&(w.lg2=d);e&&(w.style=e);f&&(w.pois=!!f);if(q&&!H.map.render.harp)throw new C(this.Yl,0,"HARP engine is not supported, module not found");a={};e=this.Lp();var y=this.Lp({type:"aerial"}),D=this.Tp(),F=D.tt(w.lg?{lg:w.lg,i18n:!0,engineType:l}:{engineType:l});no(a,{raster:{normal:{xbase:h(e,"xbasetile",
"normal.day","png8",!1),xbasenight:h(e,"xbasetile","normal.night","png8",!0),base:h(e,"basetile","normal.day","png8",!1),basenight:h(e,"basetile","normal.night","png8",!0),map:h(e,"maptile","normal.day","png8",!1),mapnight:h(e,"maptile","normal.night","png8",!0),trafficincidents:F,transit:h(e,"maptile","normal.day.transit","png8",!1),labels:h(e,"labeltile","normal.day","png",!1)},satellite:{xbase:h(y,"xbasetile","hybrid.day","jpg",!0),base:h(y,"basetile","hybrid.day","jpg",!0),map:h(y,"maptile","hybrid.day",
"jpg",!0),labels:h(y,"labeltile","hybrid.day","png",!0)},terrain:{xbase:h(y,"xbasetile","terrain.day","jpg",!1),base:h(y,"basetile","terrain.day","jpg",!1),map:h(y,"maptile","terrain.day","jpg",!1),labels:h(y,"labeltile","terrain.day","png",!1)}}});if(q||r){no(a,{vector:{normal:{traffic:D.st(void 0,l),trafficincidents:F}}});y=this.Mj({queryParams:{content:"default,transit"}});e=this.Vp();D=this.Mj({queryParams:{content:"default,advanced_roads,advanced_pois,transit"}});var O=this.Mj({queryParams:{content:"default,hillshade,contours,transit"}});
if(r)a.vector.normal.map=g(y,"omv/miami/normal.day.yaml"),a.vector.normal.truck=g(y,"omv/miami/truck.day.yaml");else if(q){a.vector.normal.map=g(y,"harp/oslo/normal.day.json");a.vector.normal.truck=g(y,"harp/oslo/normal.day.json");a.vector.normal.logistics=g(D,"harp/oslo/logistics.day.json");a.vector.normal.logisticsnight=g(D,"harp/oslo/logistics.night.json");F=g(O,"harp/oslo/topo.day.json");O=g(O,"harp/oslo/topo.night.json");var R=function(Oa){Oa=Oa.target;if(2===Oa.getState()){Oa.removeEventListener("change",
R);var ic=Oa.getEnabledFeatures()||[];[{feature:"terrain",mode:"hillshade"},{feature:"contours",mode:"all"}].forEach(function(jc){var Ka=ic.findIndex(function(zc){return zc.feature===jc.feature});ic.splice(Ka,-1===Ka?0:1,jc)});Oa.setEnabledFeatures(ic)}};F.D.K().addEventListener("change",R);O.D.K().addEventListener("change",R);a.vector.normal.topo=F;a.vector.normal.toponight=O;var Ta={ppi:72<b||void 0===b&&2<=window.devicePixelRatio?200:100,size:256<v?512:256,features:"pois:"+(!0===f||gb(f)&&/[^0]/.test(f)?
"all":"disabled")};c&&(Ta.lang=c);d&&(Ta.lang2=d);p&&p.politicalView&&(Ta.pview=p.politicalView);b={dark:!0};F=function(Oa,ic,jc,Ka,zc){var Lc=no({},Ta);/^explore\./.test(jc)||delete Lc.features;Oa=k.Rp({format:ic,resource:Oa,queryParams:no({style:jc},Lc)});zc=new yo(Oa,{engineType:l,style:zc});return new Ei(zc,Ka)};no(a.raster.normal,{base:F("background","png8","explore.day"),basenight:F("background","png8","explore.night",b),map:F("base","png8","explore.day"),mapnight:F("base","png8","explore.night",
b),labels:F("label","png8","explore.day")});no(a.raster.satellite,{xbase:F("background","jpeg","satellite.day",b),base:F("background","jpeg","explore.satellite.day",b),map:F("base","jpeg","explore.satellite.day",b),labels:F("label","png8","explore.satellite.day")});no(a.raster.terrain,{base:F("background","png8","topo.day",b),map:F("base","png8","topo.day",b),labels:F("label","png8","topo.day",b)});no(a.vector.normal,{mapnight:g(y,"harp/oslo/normal.night.json",!0),lite:g(y,"harp/oslo/lite.day.json"),
litenight:g(y,"harp/oslo/lite.night.json",!0),ism:g(y,"harp/oslo/road.network.day.json"),ismnight:g(y,"harp/oslo/road.network.night.json",!0),roadnetwork:g(y,"harp/oslo/road.network.day.json"),roadnetworknight:g(y,"harp/oslo/road.network.night.json",!0)});O={styles:[{technique:"raster",attr:{gamma:["step",["zoom"],.9,13,1],brightness:["step",["zoom"],.6,12,.7,13,.8,14,.8,17,.9]}}]};for(var aa=[],wb=0;6>wb;wb++){var Ba=new H.map.render.harp.Style(JSON.parse(JSON.stringify(O)));Ba=F("background","jpeg",
"satellite.day",b,Ba);aa.push(Ba)}a.hybrid={day:{raster:aa[0],vector:g(y,"harp/oslo/hybrid.day.json",!0),traffic:g(e,"harp/oslo/hybrid.day.json",!0)},night:{raster:aa[1],vector:g(y,"harp/oslo/hybrid.night.json",!0),traffic:g(e,"harp/oslo/hybrid.night.json",!0)},liteday:{raster:aa[2],vector:g(y,"harp/oslo/lite.hybrid.day.json",!0),traffic:g(e,"harp/oslo/lite.hybrid.day.json",!0)},litenight:{raster:aa[3],vector:g(y,"harp/oslo/lite.hybrid.night.json",!0),traffic:g(e,"harp/oslo/lite.hybrid.night.json",
!0)},logistics:{raster:aa[4],vector:g(D,"harp/oslo/logistics.hybrid.day.json",!0),traffic:g(e,"harp/oslo/logistics.hybrid.day.json",!0)},logisticsnight:{raster:aa[5],vector:g(D,"harp/oslo/logistics.hybrid.night.json",!0),traffic:g(e,"harp/oslo/logistics.hybrid.night.json",!0)}}}y={traffic:{}};y.traffic.map=g(e,r?"traffic/vector.tile.yaml":"harp/oslo/normal.day.json");q&&(y.traffic.logistics=g(e,"harp/oslo/logistics.day.json"),y.traffic.logisticsnight=g(e,"harp/oslo/logistics.night.json"),y.traffic.mapnight=
g(e,"harp/oslo/normal.night.json"),y.traffic.lite=g(e,"harp/oslo/lite.day.json"),y.traffic.litenight=g(e,"harp/oslo/lite.night.json"),y.traffic.topo=g(e,"harp/oslo/topo.day.json"),y.traffic.toponight=g(e,"harp/oslo/topo.night.json"));no(a.vector,y)}return a};X.prototype.createDefaultLayers=X.prototype.Yl;function Jq(){this.td={}}Jq.prototype.jc=function(a,b){var c=a+b,d;if(d=this.td[c])return d;a=Kq.MARKER.replace("{{icon}}",Lq[a]||Lq.OTHER);a=a.replace("{{color}}",Mq[b]||Mq.BLOCKING);b={size:{w:26,h:33},anchor:{x:13,y:30},hitArea:new Je(Ke.POLYGON,Nq.MARKER)};return this.td[c]=d=new wi(a,b)};
var Kq={MARKER:'<svg width="26" height="33" enable-background="new 0 0 26 33" viewBox="0 0 26 33" xmlns="http://www.w3.org/2000/svg"><path d="m26 33h-26v-33h26z" fill="#8c8c8c" opacity="0"/><path d="m17 29.566c0 1.116-1.791 2.022-4 2.022s-4-.906-4-2.022c0-1.118 1.791-2.026 4-2.026s4 .908 4 2.026" fill="#878787" opacity=".6"/><path d="m1.795 17.971c-1.562-1.555-1.574-3.828-.028-5.655l8.343-10.021c.769-.895 1.795-1.384 2.894-1.384 1.117 0 2.197.521 2.889 1.394l8.338 10.014c1.588 1.854 1.578 4.022-.029 5.65l-11.202 11.202z" fill="{{color}}"/>{{icon}}</svg>'},Lq=
{CONGESTION:'<path style="fill:#FFFFFF;" d="M12.966,1.177c0.965,0,1.894,0.442,2.496,1.204l8.378,10.258c1.362,1.592,1.482,3.477,0,4.979L12.994,28.464L2.143,17.618c-1.381-1.375-1.38-3.348,0-4.979l8.314-10.258C11.174,1.547,12.085,1.177,12.966,1.177 M12.967,0.177L12.967,0.177c-1.247,0-2.408,0.551-3.269,1.552l-8.332,10.28c-1.711,2.022-1.688,4.567,0.07,6.317l10.85,10.845l0.707,0.707l0.707-0.707l10.847-10.846c1.784-1.807,1.803-4.292,0.053-6.337L16.237,1.748C15.462,0.769,14.236,0.177,12.967,0.177L12.967,0.177z M16.645,10.405l-2.025-2.22c-0.48-0.51-1.15-0.8-1.84-0.8H9.53c-0.69,0-1.36,0.29-1.84,0.8l-1.94,2.22c-0.39,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.44l0.255-0.539c0.204-0.431,0.456-0.837,0.753-1.21l0.962-1.211l0.83-0.9c0.32-0.35,0.72-0.63,1.15-0.82H8.23c-0.28,0-0.55-0.07-0.79-0.22l-0.28-0.17l1.27-1.45c0.28-0.31,0.68-0.48,1.1-0.48h3.25c0.42,0,0.82,0.17,1.1,0.48l1.354,1.54H16.645z M18.31,12.205c-0.35-0.37-0.81-0.63-1.3-0.74c-0.18-0.04-0.36-0.06-0.54-0.06h-3.24c-0.7,0-1.37,0.29-1.84,0.8l-1.13,1.22l-0.82,1c-0.38,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.75v-1h5.99v1h1.75c0.69,0,1.25-0.56,1.25-1.25v-1.64c0-0.74-0.2-1.46-0.59-2.09L18.31,12.205z M12.1,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C12.35,16.993,12.238,17.105,12.1,17.105z M18.59,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C18.84,16.993,18.728,17.105,18.59,17.105z M18.56,14.505c-0.24,0.15-0.51,0.22-0.79,0.22h-5.85c-0.28,0-0.55-0.07-0.78-0.22l-0.29-0.17l1.27-1.45c0.15-0.16,0.33-0.28,0.53-0.37c0.18-0.07,0.38-0.11,0.58-0.11h3.24c0.24,0,0.48,0.06,0.68,0.16c0.16,0.08,0.3,0.19,0.42,0.32l1.27,1.45L18.56,14.505z M8.42,13.03h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C8.67,12.918,8.559,13.03,8.42,13.03z"/>',
ROADWORKS:'<path d="m13.004 1.411c.964 0 1.894.441 2.496 1.204l8.346 10.023c1.363 1.592 1.482 3.477 0 4.979l-10.846 10.847-10.852-10.846c-1.381-1.375-1.379-3.348 0-4.979l8.346-10.023c.717-.835 1.628-1.205 2.51-1.205m0-1c-1.248 0-2.408.551-3.268 1.552l-8.356 10.035c-1.718 2.033-1.695 4.578.064 6.328l10.85 10.845.706.707.707-.707 10.846-10.846c1.784-1.808 1.803-4.293.053-6.337l-8.337-10.012c-.769-.973-1.996-1.565-3.265-1.565zm-.575 15.264c.018-.332-.13-.651-.394-.851l-2.945-2.235-.21.36c-.22.39-.41.78-.58 1.19l-.677 2.129-1.364 3.051h1.314l2.109-4.672 1.317 1.212.138 3.46h1.092zm6.16-1.327c-.401-.54-1.209-.539-1.609.001l-1.17 1.58-2.29-1.74-.139-4.054c-.011-.276-.134-.535-.342-.716l-.7-.61c-.185-.161-.422-.25-.667-.25h-1.885c-.335 0-.648.168-.833.447l-1.144 1.723 7.58 5.76-1.86 2.51c-.098.132-.004.32.161.32h6.648l1.142-1.077zm-8.79-2.989-.876-.665.841-1.018.965.043zm1.63 1.24.969-1.781.118 2.61zm2.76-5.79c-.64 0-1.16.52-1.16 1.16 0 .65.52 1.17 1.16 1.17s1.16-.52 1.16-1.17c0-.64-.52-1.16-1.16-1.16z" fill="#fff"/>',
ACCIDENT:'<path style="fill:#FFFFFF;" d="M12.998,1.091c0.964,0,1.894,0.442,2.496,1.204l8.346,10.344c1.363,1.592,1.482,3.477,0,4.979L12.994,28.465L2.143,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.344C11.205,1.462,12.115,1.091,12.998,1.091 M12.998,0.091L12.998,0.091c-1.248,0-2.408,0.551-3.269,1.552L1.364,12.011c-1.708,2.021-1.685,4.566,0.073,6.316l10.85,10.845l0.707,0.707l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337l-8.327-10.32C15.494,0.684,14.268,0.091,12.998,0.091L12.998,0.091z M7.83,18.982l-3.309-1.855l0.945,1.855H7.83z M16.111,19h3.942l1.596-2L16.111,19z M10.512,20.064l1.021-1.021l1.632,0.076c0.329,0.018,0.651-0.022,0.963-0.123c0.626-0.206,1.122-0.76,1.288-1.44l0.264-1.089l2.066-0.93c0.373-0.17,0.673-0.42,0.861-0.731c0.275-0.449,0.405-0.97,0.369-1.498L18.9,11.676l1.021-1.021l-0.724-0.724l-0.427,0.427l-0.121-0.364c-0.201-0.603-0.54-1.151-0.989-1.6l-1.159-1.159c-0.5-0.5-1.31-0.5-1.809,0l-1.267,1.267l0.724,0.724l-5.066,5.066l-0.724-0.724l-1.267,1.267c-0.5,0.5-0.5,1.31,0,1.809l1.159,1.159c0.449,0.449,0.997,0.788,1.6,0.989l0.364,0.121l-0.427,0.427L10.512,20.064z M14.901,10.349l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0l-0.732-0.732C14.803,10.604,14.803,10.446,14.901,10.349z M9.472,15.777l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0L9.472,16.13C9.375,16.033,9.375,15.874,9.472,15.777z M11.391,17.615c0.069-0.271,0.206-0.518,0.405-0.717l4.961-4.961c0.195-0.195,0.445-0.337,0.717-0.405l0.344-0.083l0.137,1.925c0.022,0.318-0.058,0.63-0.221,0.901c-0.101,0.166-0.279,0.271-0.409,0.329L14.8,15.74l-0.38,1.574c-0.083,0.344-0.318,0.615-0.612,0.713c-0.188,0.058-0.38,0.083-0.579,0.072l-1.925-0.138L11.391,17.615z"/>',
OTHER:'<path style="fill:#FFFFFF;" d="M13.004,1.411c0.964,0,1.894,0.441,2.496,1.204l8.346,10.023c1.363,1.592,1.482,3.477,0,4.979L13,28.465L2.148,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.023C11.211,1.781,12.122,1.411,13.004,1.411 M13.004,0.411L13.004,0.411c-1.248,0-2.408,0.551-3.268,1.552L1.38,11.998c-1.718,2.033-1.694,4.579,0.064,6.328l10.85,10.845L13,29.878l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337L16.269,1.976C15.5,1.003,14.273,0.411,13.004,0.411L13.004,0.411z M14.716,20.139c0,0.947-0.758,1.724-1.724,1.724c-0.947,0-1.704-0.777-1.704-1.724c0-0.928,0.757-1.704,1.704-1.704C13.958,18.435,14.716,19.211,14.716,20.139z M14.204,16.33H11.78l-0.537-8.533h3.5L14.204,16.33z"/>'},
Mq={BLOCKING:"#323232",VERYHIGH:"#d5232f",HIGH:"#ffa100"},Nq={MARKER:[24.1,17.8,14.2,28.42,16.8,29.4,12.8,31.4,8.79,29.4,11.23,28.42,1.7,17.8,1.7,12.1,10,1.9,12.9,.498,15.8,1.9,24.1,12.1,24.1,17.8]};function Oq(a){if(!a||!Za(a.requestData))throw new C(Oq,0,"options.requestData");Oq.g.constructor.call(this,a);this.NC=a.requestData;this.CC=!!a.providesDomMarkers}u(Oq,T);t("H.map.provider.MarkerTileProvider",Oq);Oq.prototype.u=function(a,b,c,d,e){var f=this;return this.NC(a,b,c,function(g){for(var h=[],k,l,n=g.length;n--;)l=g[n],l.yD=f.getTileKey(a,b,c),l.ea(f),k=l.jc(),(B(l,af)||1===k.getState())&&h.push(g[n]);d(h)},e)};Oq.prototype.requestInternal=Oq.prototype.u;
Oq.prototype.Hh=function(a,b){b===Ce.VISUAL&&(a=this.Rb().get(a.yD))&&(a.valid=!1,this.hb(a))};Oq.prototype.invalidateObject=Oq.prototype.Hh;Oq.prototype.Uc=function(){return this.CC};Oq.prototype.providesDomMarkers=Oq.prototype.Uc;Oq.prototype.Vc=me;Oq.prototype.providesMarkers=Oq.prototype.Vc;function Pq(a,b,c){c=c?c:{};c.criticality||(c.criticality="major,critical");B(a,Qq,Pq,0);Oq.call(this,{max:20,min:8,requestData:z(this.RC,this),engineType:c.engineType});this.td=new Jq;this.$=a;this.Ga=c;this.reload=z(this.reload,this);this.yr=setInterval(this.reload,b||18E4)}u(Pq,Oq);t("H.service.traffic.incidents.Provider",Pq);var Rq={minor:"HIGH","low impact":"HIGH",major:"VERYHIGH",critical:"BLOCKING"};
Pq.prototype.RC=function(a,b,c,d,e){var f=this,g=this.td;return this.$.requestIncidentsByTile(a,b,c,function(h){var k=[];h=h.TRAFFIC_ITEMS;var l;if(h)for(h=h.TRAFFIC_ITEM,l=h.length;l--;){var n=h[l];var p=n.TRAFFIC_ITEM_TYPE_DESC;switch(p){case "ACCIDENT":case "CONGESTION":var q=p;break;case "CONSTRUCTION":q="ROADWORKS";break;default:q="OTHER"}q=g.jc(q,Rq[n.CRITICALITY.DESCRIPTION]);p=n.LOCATION.GEOLOC.ORIGIN;p=new yi({lat:p.LATITUDE,lng:p.LONGITUDE},{provider:f,icon:q});p.setData(n);k.push(p)}d(k)},
e,this.Ga)};Pq.prototype.l=function(){Oq.prototype.l.call(this);clearInterval(this.yr)};Pq.prototype.dispose=Pq.prototype.l;var Sq="A21 A22 F01 F02 F08 F04 F05 F07 F03 F06 A2F F13 A25 A2C F12 D1B F1B A27 E12 A3A A24 A3D A3F F1F F25 F2C E32 A33 F29 D26 D36 F26 D0F F0F F2B E0C D3A A45 D23 D11 F2E F19 F14 F39 A4A A4B A5C D38 F2A F1A D0A F1C A48 D25 D1D F32 A46 A3E D24 E1C E32 A5F D2E D22 D0A".split(" ");function Tq(a,b,c,d){Tq.g.constructor.call(this,{min:10,max:21,engineType:d});B(a,Qq,Tq,0);this.$=a;this.Ga=c||Uq;this.Ga.responseattributes="sh,fc";this.yr=setInterval(z(this.reload,this),b||18E4);this.ub===mg.WEBGL?this.Wa(new Wf(a.sm("traffic/flow.yaml")),!0):this.Wa(new H.map.render.harp.Style({styles:[{when:["==",["geometry-type"],"LineString"],technique:"solid-line",renderOrder:10002,attr:{color:["case",[">=",["get","JF"],10],"black",[">=",["get","JF"],8],"red",[">=",["get","JF"],4],"yellow",
"green"],width:3,metricUnit:"Pixel"}}]}))}u(Tq,T);t("H.service.traffic.flow.Provider",Tq);Tq.prototype.rr=me;Tq.prototype.providesGeoJSON=Tq.prototype.rr;Tq.prototype.K=function(){return this.kb()};Tq.prototype.getStyle=Tq.prototype.K;Tq.prototype.Bb=function(a){a.Xb&&a.Xb("GeoJSONTileSource");this.Wa(a)};Tq.prototype.setStyle=Tq.prototype.Bb;var Uq={locationreferences:"tmc,shp"};Tq.prototype.disposeInternal=function(){Tq.g.disposeInternal.call(this);clearInterval(this.yr)};
Tq.prototype.u=function(a,b,c,d,e){return this.$.requestFlowByTile(a,b,c,function(f){f.type&&-1!==f.type.indexOf("Error")?e(f.Details):d(f)},e,this.Ga)};Tq.prototype.requestInternal=Tq.prototype.u;
Tq.prototype.nd=function(a,b,c,d,e){var f,g,h,k,l={type:"FeatureCollection",features:[]},n;var p=d.RWS.length;for(f=0;f<p;f++){var q=d.RWS[f];var r=q.RW;var v=r.length;var w=-1!==Sq.indexOf(q.EXTENDED_COUNTRY_CODE+q.EBU_COUNTRY_CODE);for(q=0;q<v;q++){var y=r[q].FIS;var D=y.length;for(y=0;y<D;y++){var F=r[q].FIS[y].FI;var O=F.length;for(g=0;g<O;g++){var R=F[g];var Ta=[];var aa=R.CF[0];var wb=!!aa.SSS;var Ba={type:"Feature",properties:aa,geometry:{type:"MultiLineString",coordinates:Ta}};Ba.properties.LHT=
w;R.SHP.length&&(Ba.properties.FC=R.SHP[0].FC);wb&&(n=[]);for(aa=0;aa<R.SHP.length;aa++){var Oa=R.SHP[aa].value;var ic=Oa.length;for(h=0;h<ic;h++){var jc=wb?n:void 0,Ka=new Em(Oa[h].trim()),zc=[],Lc={};for(Ka.yi();-1!==(k=Ka.cb());)k===Vq?(Lc.lat=+String.fromCharCode.apply(Tq,Ka.mh()),Ka.next(),Ka.yi()):k===Wq?(Lc.lng=+String.fromCharCode.apply(Tq,Ka.mh()),zc.push([Lc.lng,Lc.lat]),jc&&jc.push(Te(Lc)),Lc=[],Ka.next(),Ka.yi()):Ka.next();Lc.lng=+String.fromCharCode.apply(Tq,Ka.mh());zc.push([Lc.lng,
Lc.lat]);jc&&jc.push(Te(Lc));k=zc;Ta.push(k)}}l.features.push(Ba)}}}}return Tq.g.nd.call(this,a,b,c,l,e)};Tq.prototype.createTileInternal=Tq.prototype.nd;var Wq=32,Vq=44;function Xq(a){function b(n){d.contains(e)&&d.removeChild(e);l&&clearTimeout(l);delete Xq.Br[f];n&&a.Mt&&a.Mt.call(k,n)}if(!a.url||!a.Qo)throw Error('Parameter "options" must specify at least a URL and a callback.');if("function"!==typeof a.Qo)throw Error("Parameters options.callback must be a function");var c=a.cE||document;var d=c.getElementsByTagName("head")[0];var e=c.createElement("script");c=a.url instanceof W?a.url:Ao(a.url,a.aE);var f=Xq.XC++;var g=a.By||"callback";var h=a.Qo;var k={};var l=
null;k.id=f;k.cancel=function(){b("cancelled")};0!==a.timeout&&(l=globalThis.setTimeout(function(){b("timeout")},a.timeout||3E4));Xq.Br[f]=function(n){b();h.call(k,n)};e.type="text/javascript";e.src=c.toString()+(c.Bu()?"&":"?")+g+"="+(a.dE?"H.service.jsonp.handleResponse("+f+")":encodeURI("H.service.jsonp.handleResponse("+f+")"));d.appendChild(e);return k}t("H.service.jsonp",Xq);Xq.ZA=function(a){return(a=Xq.Br[a])?a:function(){}};Xq.handleResponse=Xq.ZA;Xq.XC=0;Xq.Br={};function Qq(a){Qq.g.constructor.call(this,Qq,a);this.Cy=to(this,a).callbackKey;this.Xe=!1}u(Qq,so);t("H.service.traffic.Service",Qq);Qq.prototype.ya=function(){return{subDomain:"traffic.ls",path:"traffic/6.1",callbackKey:"jsoncallback"}};Qq.CONFIG_KEY="traffic";Qq.prototype.st=function(a,b){return new Ei(new Tq(this,void 0,a,b),{max:22})};Qq.prototype.createFlowLayer=Qq.prototype.st;Qq.prototype.tt=function(a){return new Ig(new Pq(this,void 0,a))};Qq.prototype.createIncidentsLayer=Qq.prototype.tt;
function Yq(a,b,c,d){a.Xe||(oo(Qq,"Use HERE Traffic API v7 instead."),a.Xe=!0);return Xq({url:b,Qo:c,Mt:function(e){d(Error("["+e+"] "+b+" request failed"))},By:a.Cy})}Qq.prototype.SC=function(a,b,c){a=this.i().clone().A("incidents.json").v(a);return Yq(this,a,b,c)};Qq.prototype.requestIncidents=Qq.prototype.SC;Qq.prototype.PC=function(a,b,c,d,e,f){a=this.i().clone().A(["flow/json",c,a,b].join("/")).v(f||{});return Yq(this,a,d,e)};Qq.prototype.requestFlowByTile=Qq.prototype.PC;
Qq.prototype.UC=function(a,b,c,d,e,f){a=this.i().clone().A(["incidents/json",c,a,b].join("/")).v(f||{});return Yq(this,a,d,e)};Qq.prototype.requestIncidentsByTile=Qq.prototype.UC;Qq.prototype.sm=function(a){return qn()+"/"+a};function Zq(a){Zq.g.constructor.call(this,Zq,a)}u(Zq,so);t("H.service.traffic.Service7",Zq);Zq.prototype.ya=function(){return{subDomain:"data.traffic",path:"v7"}};Zq.CONFIG_KEY="traffic_v7";Zq.prototype.QC=function(a,b,c,d){a=this.i().clone().A(["incidents",a].join("/")).v(b||{});return this.u(a,c,d)};Zq.prototype.requestIncidentById=Zq.prototype.QC;Zq.prototype.OC=function(a,b,c){a=this.i().clone().A("flow").v(a||{});return this.u(a,b,c)};Zq.prototype.requestFlowByArea=Zq.prototype.OC;
Zq.prototype.TC=function(a,b,c){a=this.i().clone().A("incidents").v(a||{});return this.u(a,b,c)};Zq.prototype.requestIncidentsByArea=Zq.prototype.TC;X.prototype.Tp=function(a,b){b=b||6;if(6===b)b=Qq;else if(7===b)b=Zq;else throw new C(this.Tp,1,"allowed values are 6 and 7");return this.Ja(b,a)};X.prototype.getTrafficService=X.prototype.Tp;t("H.service.buildInfo",function(){return Cm("H-service","1.63.0","d08e47f",{region:"row"})});

function $q(a,b){var c,d=0;if(!ya(a)||Ma(a))throw new C($q,0,a);for(c in a){var e=+c;d++;if(!(jb(e)&&0<=e&&1>=e&&gb(a[c])))throw new C($q,0,a);}if(2>d)throw new C($q,0,"Specify at least 2 stops");this.tD=a;this.Pu=!!b}t("H.data.heatmap.Colors",$q);var ar=new $q({0:"#008","0.2":"#0b0","0.5":"#ff0","0.7":"#f00"},!0);$q.DEFAULT=ar;function br(a,b,c){this.bf=a=cd(a,0,30);this.qb=b;this.pj=c;this.fs=[];this.ci=[];do this.ci[a]=[],this.fs[a]=new cr;while(a--);b===dr?(this.Rs=er,this.normalize=fr):(this.Rs=gr,this.normalize=hr);this.hk=1/0;this.Ym=-1/0}var ir=Math.log(.5);function fr(a){return this.kp?Math.round((a-this.hk)/this.kp*255):127}function hr(a){return void 0===this.$t?127:Math.round(255*Math.pow(a,this.$t))}
br.prototype.yc=function(a){var b,c;var d=a.value;void 0===d&&(d=1);d>this.Ym&&(this.Ym=d,this.kp=this.Ym-this.hk);d<this.hk&&(this.hk=d,this.kp=this.Ym-this.hk);var e=rg.Re(a).scale(1073741823).floor();d=this.bf;var f=e.x>>30-d;e=e.y>>30-d;for(c=this.Rs;-1<d;){this.ci[d][e]||(this.ci[d][e]=[]);(b=this.ci[d][e][f])||(b=this.ci[d][e][f]=new c(f,e,d));b.yc(a,d);var g=this.fs[d];g.zv>b.dd&&(g.zv=b.dd);g.Qh<b.dd&&(g.Qh=b.dd);g.yv>b.Bc&&(g.yv=b.Bc);g.Iq<b.Bc&&(g.Iq=b.Bc);d--;f>>=1;e>>=1}};
function jr(a,b,c,d,e){var f=1<<b,g,h;d=bd(d,f);f=0<=c&&c<f&&(g=a.ci[b])&&(h=g[c])&&(f=h[d])||null;!f&&e&&0<=b&&(f=jr(a,b-1,c>>1,d>>1,e));return f}function kr(a,b,c,d,e,f){for(var g,h=[];c<=d;c++)for(g=e;g<=f;g++)h.push(jr(a,b,c,g,!1));return h}function lr(a,b){var c=0,d=0,e=jr(a,0,0,0,!1),f;if(b.gm)return b.Bj;b.z===a.bf?b.Bj=b.Bc:(mr(a,b,function(g){var h=nr(a,g),k=4-h.length;if(g.z!==a.bf){for(f=0;f<h.length;f++)c+=h[f].Bc,d++;c+=k*e.Bc;d+=k}}),b.Bj=c/d);b.gm=!0;return b.Bj}
function mr(a,b,c){b=[b];for(var d,e;0<b.length;)e=b.shift(),d=nr(a,e),c(e),b.push.apply(b,d)}function nr(a,b){var c=[],d,e,f;for(e=0;1>=e;e++)for(f=0;1>=f;f++)(d=jr(a,b.z+1,2*b.x+e,2*b.y+f,!1))&&c.push(d);return c}br.prototype.clear=function(){br.call(this,this.bf,this.qb,this.pj)};function gr(a,b,c){this.x=a;this.y=b;this.z=c;this.Bc=this.dd=this.count=0;this.gm=!1;this.Bj=0}gr.prototype.yc=function(a,b){this.count++;this.dd+=a.value||1;this.Bc=this.dd/Math.pow(2,2*(30-b))};
function er(a,b,c){this.x=a;this.y=b;this.z=c;this.Bc=this.dd=this.count=0;this.gm=!1;this.Bj=0}er.prototype.yc=function(a){a=a.value;this.dd+=void 0!==a?a:1;this.Bc=this.dd/++this.count;this.gm=!1};function cr(){this.zv=this.yv=1/0;this.Qh=this.Iq=-1/0};function or(a,b,c,d,e){e&1&&pr(a,a,b,c,d,0);e&2&&pr(a,a,b,c,d,1);e&4&&pr(a,a,b,c,d,2);e&8&&pr(a,a,b,c,d,3)}
function pr(a,b,c,d,e,f){var g=(c+1)*(c+1),h,k=4*d,l=c+1,n,p=[{r:0,rz:0,b:0,a:0,next:null}];var q=1;var r=["r","g","b","a"][f];var v=2*c+1;for(var w,y;q<v;q++)p[q]={r:0,rz:0,b:0,a:0,next:null},p[q-1].next=p[q];p[2*c].next=p[0];var D=4*(d-1);for(h=0;h<e;h++){var F=h*k;var O=a[F+f];var R=O*l*(c+2)/2;v=O*l;for(q=0;q<=c;q++)p[q][r]=O;var Ta=0;for(q=1;q<=c;q++){var aa=q<d?F+4*q:F+D;aa=a[aa+f];R+=aa*(l-q);Ta+=aa;p[c+q][r]=aa}aa=p[0];w=p[l];q=F;y=4*l;var wb=F+D;for(O=0;O<d;O++){b[q+f]=R/g;R-=v;var Ba=O+
l<d?q+y:wb;Ba=a[Ba+f];Ta+=Ba;R+=Ta;v-=aa[r];v+=w[r];Ta-=w[r];aa[r]=Ba;aa=aa.next;w=w.next;q+=4;if(!R)for(;(n=4*(O+l))<k&&0===a[F+f+n];)O++,q+=4}}F=(e-1)*k;for(O=0;O<d;O++){a=4*O;h=b[a+f];R=h*l*(c+2)/2;v=h*l;for(q=0;q<=c;q++)p[q][r]=h;Ta=0;for(q=1;q<=c;q++)aa=q<e?a+q*k:a+F,aa=b[aa+f],R+=aa*(c-q+1),Ta+=aa,p[c+q][r]=aa;aa=p[0];w=p[l];q=a;wb=l*k;D=a+F;for(h=0;h<e;h++)if(b[q+f]=R/g,R-=v,Ba=h+l<e?q+wb:D,Ba=b[Ba+f],Ta+=Ba,R+=Ta,v-=aa[r],v+=w[r],Ta-=w[r],aa[r]=Ba,aa=aa.next,w=w.next,q+=k,!R)for(;(n=h+l)<
e&&0===b[n*k+f+a];)h++,q+=k}};function qr(a,b,c){this.dB=b=a>>b;this.GB=Math.log(b)*Math.LOG2E;this.Dc=a=document.createElement("CANVAS");this.zy=a.getContext("2d");this.Ay=a.width=a.height=3*b;var d=document.createElement("canvas");a=c.Pu;var e=c.tD;b=[];var f;d.width=256;d.height=1;d=d.getContext("2d");for(g in e)e.hasOwnProperty(g)&&b.push({stop:parseFloat(g),value:e[g]});e=b.length;b.sort(this.sD);0<b[0].stop&&b.unshift({stop:0,value:b[0].value});1>b[e-1].stop&&b.push({stop:1,value:b[e-1].value});e=b.length;var g=d.createLinearGradient(0,
0,256,0);for(f=0;f<e;f++){if(!a&&k){var h=k.stop+(b[f].stop-k.stop)/2;g.addColorStop(h,k.value);g.addColorStop(h,b[f].value)}g.addColorStop(b[f].stop,b[f].value);var k=b[f]}d.fillStyle=g;d.fillRect(0,0,256,1);this.Hy=d.getImageData(0,0,256,1).data;this.eB=c.Pu}qr.prototype.sD=function(a,b){return a.stop-b.stop};qr.prototype.Xx="#000";qr.prototype.ly="#080";function rr(a,b){this.canvas=a;this.size=b};function sr(a){var b=a||{},c=+b.sampleDepth,d=b.pointSize;a=+b.coarseness;var e=b.colors,f={min:b.min,max:b.max,engineType:b.engineType},g=b.tileSize,h=+b.dataMax;b.tileSize&&(f.tileSize=g);T.call(this,f);this.Eg(b.opacity);this.qb="value"===b.type?dr:tr;this.sampleDepth_=jb(c)?cd(Math.round(c),1,8):4;this.Pw=this.qb===tr?jb(d)?cd(Math.round(7-d),0,6):2:1;this.ct=!!b.assumeValues;b=this.max;this.pj=jb(h)?cd(Math.round(h),this.min,b+this.sampleDepth_):b;a=jb(a)?cd(Math.round(a),0,3):1;if(e&&!B(e,$q))throw new C(sr,
0,"colors");this.Bi=new br(b+this.sampleDepth_+this.Pw,this.qb,this.pj);this.zD=new qr(this.tileSize,a,e||ar);this.rg=z(this.rg,this);this.kg=z(this.kg,this);this.On=new lj(20,this.rg)}u(sr,T);t("H.data.heatmap.Provider",sr);sr.prototype.Dd=function(a){this.Eg(a)};sr.prototype.setOpacity=sr.prototype.Dd;sr.prototype.Ue=function(){return this.Rc};sr.prototype.getOpacity=sr.prototype.Ue;sr.prototype.Ak=me;sr.prototype.providesRasters=sr.prototype.Ak;
sr.prototype.u=function(a,b,c,d,e){var f=this.ct,g,h;if(jr(this.Bi,0,0,0,!1)){if(!f){var k=kr(this.Bi,c,b-1,b+1,a-1,a+1);for(g=k.length;g--&&!f;)if(null!==k[g]){f=!0;break}}f&&(h=this.On.push([a,b,c,d,e],this.kg))}f||d(null);return h||Hk};sr.prototype.requestInternal=sr.prototype.u;
sr.prototype.rg=function(a,b){var c=a.done,d=b[0],e=b[1],f=b[2];b=document.createElement("canvas");var g=this.tileSize,h=b.getContext("2d");b.width=b.height=g;var k=this.zD;var l=this.Bi,n=this.ct,p=this.qb,q=this.Pw;var r=k.dB;var v=k.zy,w,y,D=p===tr?void 0===q?2:q:1;q=D;D=Math.min(this.sampleDepth_+D,k.GB);var F=k.Ay,O=l.bf;if(n&&p===dr){for(y=-1;1>=y;y++)for(n=-1;1>=n;n++){var R=(R=jr(l,f,e+y,d+n,!0))?l.normalize(lr(l,R)):128;v.fillStyle="rgba("+R+",128,0,1)";v.fillRect((n+1)*r,(y+1)*r,r,r)}n=
r-Math.floor(r/10);y=3;R=v.getImageData(0,0,F,F);or(R.data,n,F,F,y);v.putImageData(R,0,0)}else v.fillStyle=n?k.ly:k.Xx,v.fillRect(0,0,F,F);for(;q<=D&&f+q<=O;q++){n=r>>q;y=r-n;var Ta=p===tr?127+Math.floor(128/(1<<D-q)):255;R=(1<<q)+2;var aa=1<<q;var wb=d<<q;var Ba=e<<q;aa=kr(l,f+q,Ba-1,Ba+aa,wb-1,wb+aa);for(wb=aa.length;wb--;){Ba=wb%R;var Oa=wb/R<<0;if(w=aa[wb])w=l.normalize(w.Bc),v.fillStyle="rgba("+w+","+Ta+",0,1)",v.fillRect(Ba*n+y,Oa*n+y,n,n)}R=v;Ta=n;aa=y;wb=r+2*n;n=r+2*n;Ba=Ba=3;Oa=v.getImageData(aa,
y,wb,n);or(Oa.data,Ta,wb,n,Ba);R.putImageData(Oa,aa,y)}d=v.getImageData(0,0,F,F);e=k.Hy;f=k.eB;l=d.data;D=0;for(F=l.length;D<F;D+=4)p=l[D],q=l[D+1],4===e.length&&(p=0),l[D]=e[4*p],l[D+1]=e[4*p+1],l[D+2]=e[4*p+2],l[D+3]=e[4*p+3]*(f?q/255:10>q?0:1);v.putImageData(d,0,0);k=new rr(k.Dc,r);r=k.size;h.drawImage(k.canvas,r,r,r,r,0,0,g,g);c.call(a,b)};sr.prototype.kg=function(a,b,c){var d=a.data;a=d[3];d=d[4];c?d():a(b)};
sr.prototype.Xs=function(a,b){var c;if(!fb(a))throw new C(this.Xs,0,a);if(c=a.length){for(;c--;)this.Bi.yc(a[c]);a=this.Bi;var d;c=a.fs;var e=a.bf,f=0;if(a.qb===tr){var g=c[a.bf].Qh;for(d=a.bf;0<=d;d--)if(c[d].Qh===g)f=d;else break;g=c[0].Qh;for(d=0;d<=f;d++)if(g===c[d].Qh)e=d;else break;f>a.pj&&(f=a.pj);g=Math.round(e+(f-e)/2);a.$t=ir/Math.log(c[g].Iq)}this.reload(!!b)}};sr.prototype.addData=sr.prototype.Xs;sr.prototype.clear=function(){this.Bi.clear();this.reload(!0)};sr.prototype.clear=sr.prototype.clear;var tr=0,dr=1;function ur(){}t("H.data.utils.Dom",ur);ur.prototype.sh=function(a){return!!a&&/^\s*(1|true)\s*$/i.test(this.Ta(a))};ur.prototype.getBoolean=ur.prototype.sh;ur.prototype.Ta=function(a){var b;try{if(a.nodeType===Node.ATTRIBUTE_NODE)return a.value;var c="";var d=0;var e=a.childNodes;for(b=e.length;d<b;d++)e[d].nodeType!==Node.COMMENT_NODE&&(c+=e[d].nodeValue.replace(/^\s+|\s+$/g,""))}catch(f){}return c||""};ur.prototype.getString=ur.prototype.Ta;
ur.prototype.nm=function(a){return parseFloat(this.Ta(a))||0};ur.prototype.getFloat=ur.prototype.nm;ur.prototype.ew=function(a){var b=a.split(/\s+/),c=b.length,d=!(b&&1==c),e=d?1:3,f=[],g;d||(b=a.split(","),c=b.length);for(g=0;g<c;g+=e)if(a=this.fr(d?b[g]:g+3>b.length?null:b.slice(g,g+3)))f.push(a);else return[];return f};ur.prototype.parseCoords=ur.prototype.ew;
ur.prototype.fr=function(a){if(!a)return null;var b=a instanceof Array&&0<a.length&&4>a.length?a:a.split(",");a=parseFloat(b[0]);var c=parseFloat(b[1]);b=parseFloat(b[2]);return isNaN(c)||isNaN(a)?null:new Re(c,a,isNaN(b)?void 0:b)};ur.prototype.parseCoord=ur.prototype.fr;ur.prototype.lm=function(a){a=this.Ta(a);return/^[0-9a-fA-F]{8}$/.test(a)?"#"+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2):"#000000ff"};ur.prototype.getColor=ur.prototype.lm;function vr(){this.cB={4:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),"ff"].join("")},5:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),a.charAt(4),a.charAt(4)].join("")},7:function(a){return a+"ff"},9:function(a){return a}};this.YC={4:function(a){return[wr(a.charAt(1)),wr(a.charAt(2)),wr(a.charAt(3)),255]},5:function(a){return[wr(a.charAt(1)),wr(a.charAt(2)),wr(a.charAt(3)),wr(a.charAt(4))]},7:function(a){a=
parseInt(a.substring(1),16);return[a>>16&255,a>>8&255,a&255,255]},9:function(a){a=parseInt(a.substring(1),16);return[a>>24&255,a>>16&255,a>>8&255,a&255]}}}t("H.data.utils.ColorHelper",vr);function wr(a){a=parseInt(a,16);return(a<<4)+a}function xr(a){return 16>a?"0"+Math.round(a).toString(16):Math.round(a).toString(16)}
function yr(a,b,c){if(!/^(#|rgb).*/.test(b))return[0,0,0,255];c||(c="","#"===b.charAt(0)?c=a.cB[b.length]?b:"":"rgb"===b.substr(0,3)&&(b=b.match(/\d+(\.\d+)?/g),c=b.length,c=2<c&&5>c?["#",xr(+b[0]),xr(+b[1]),xr(+b[2]),3<c?xr(255*+b[3]):"ff"].join(""):""),b=c);a=a.YC[b.length](b);a[3]=Math.round(a[3]/255*100)/100;return a}
vr.prototype.Ax=function(a,b){var c="";if(!/^(#|rgb).*/.test(a)){c="";for(a=0;6>a;a++)c+="ABCDEF0123456789".charAt(Math.floor(16*Math.random()));return c+"ff"}a=yr(this,a,b);for(b=0;4>b;b++)c+=""+xr(3>b?Math.floor(Math.random()*(a[b]-0+1))+0:255*a[b]);return c};vr.prototype.toRandomRGBA=vr.prototype.Ax;function zr(a){a=a.childNodes;for(var b,c=a.length,d=new ur,e=new vr;c--;)switch(b=a[c],b.nodeName){case "color":this.color=d.lm(b);break;case "colorMode":this.Gy=d.Ta(b)}"random"===this.Gy&&(this.color="#"+e.Ax(this.color,!1))}t("H.data.kml.ColorStyle",zr);function Ar(a){var b=a.childNodes,c=b.length,d=new ur;this.outline=this.fill=!0;for(this.Nl=new zr(a);c--;)switch(a=b[c],a.nodeName){case "fill":this.fill=d.sh(a);break;case "outline":this.outline=d.sh(a)}}t("H.data.kml.PolyStyle",Ar);function Br(a){var b=a.childNodes,c=b.length,d=new ur;for(this.Nl=new zr(a);c--;)a=b[c],"width"===a.nodeName&&(this.width=d.nm(a))}t("H.data.kml.LineStyle",Br);function Cr(a){var b=a.childNodes,c=new ur;this.offsetX=this.offsetY=0;for(a=b.length;a--;){var d=b[a];switch(d.nodeName){case "href":this.href=c.Ta(d)}}}t("H.data.kml.Icon",Cr);function Dr(a){a=a.attributes;for(var b,c=a.length;c--;)switch(b=a[c],b.name){case "x":this.x=parseFloat(b.value);break;case "y":this.y=parseFloat(b.value);break;case "xunits":this.Ye="fraction"===ur.prototype.Ta(b);break;case "yunits":this.Zd="fraction"===ur.prototype.Ta(b)}}t("H.data.kml.HotSpot",Dr);function Er(a){var b;if(a){a=a.childNodes;var c=a.length;for(b=new ur;c--;){var d=a[c];switch(d.nodeName){case "scale":this.scale=b.nm(d);break;case "Icon":this.icon=d=new Cr(d);break;case "hotSpot":this.Eu=d=new Dr(d)}}}}t("H.data.kml.IconStyle",Er);function Fr(a){a=a.childNodes;for(var b,c=a.length,d=new ur;c--;)switch(b=a[c],b.nodeName){case "bgColor":this.bgColor=d.lm(b);break;case "textColor":this.textColor=d.lm(b);break;case "text":this.text=d.Ta(b);break;case "displayMode":this.displayMode=d.Ta(b)}}t("H.data.kml.BalloonStyle",Fr);function Gr(a){var b=a.childNodes,c=b.length;for(this.id=a.getAttribute("id");c--;)switch(a=b[c],a.nodeName){case "IconStyle":this.Gu=a=new Er(a);break;case "LineStyle":this.Nh=a=new Br(a);break;case "PolyStyle":this.lw=a=new Ar(a);break;case "BalloonStyle":this.El=a=new Fr(a)}}t("H.data.kml.Style",Gr);function Hr(a,b){var c=a&&a.childNodes||[],d=new ur;if(!a||!b)throw Error("Node or stylesContainer is not defined");this.visibility=!0;this.yC=a;for(a=c.length;a--;){var e=c[a];switch(e.nodeName){case "name":this.name=d.Ta(e);break;case "description":this.description=d.Ta(e);break;case "visibility":this.visibility=d.sh(e);break;case "open":this.open=d.sh(e);break;case "styleUrl":if(this.cl=d.Ta(e))e=this.cl.substr(1),this.kz=b.Sp(e,!1);break;case "Style":this.nv=e=new Gr(e)}}}
t("H.data.kml.Feature",Hr);function Ir(){}Ir.prototype.elevation=0;Ir.prototype.St=0;function Jr(a){a=a.childNodes;for(var b,c=a.length,d=new ur;c--;)if(b=a[c],"coordinates"===b.nodeName){b=d.Ta(b);var e=[],f=new ur;try{e=f.ew(b)}catch(g){e=[]}this.Ul=2>e.length?[]:e}}t("H.data.kml.Line",Jr);Jr.prototype.vh=function(){for(var a=new N,b=this.Ul?this.Ul.length:0;b--;)a.sg(this.Ul[b]);return a};function Kr(a){var b=a.childNodes,c=b.length;this.Rt=new N;for(this.Ou=[];c--;){var d=b[c];var e=d.nodeName;if("outerBoundaryIs"===e||"innerBoundaryIs"===e){var f=d.childNodes;for(d=f.length;d--;){var g=f[d];if("LinearRing"===g.nodeName){var h=new Jr(g);if("outerBoundaryIs"===e){this.Rt=h.vh();var k=void 0,l=a,n=h.Ul;h=new ur;var p=l.querySelector("altitudeMode");if(p&&p.parentNode===l&&!/^\s*clampTo/.test(h.Ta(p))&&n){p=n.length;for(var q=0;q<p&&0!==k;q++){var r=n[q].alt;r?k?r!==k&&(k=0):k=r:k=0}(n=
l.querySelector("*|altitudeOffset"))&&n.parentNode===g&&"http://www.google.com/kml/ext/2.2"===n.namespaceURI&&(g=h.nm(n))&&(k+=g);k&&(k=yc(2047,k),(g=l.querySelector("extrude"))&&g.parentNode===l&&h.sh(g)?this.St=k:this.elevation=k)}}else this.Ou.push(h.vh())}}}}}u(Kr,Ir);t("H.data.kml.Polygon",Kr);function Lr(a){a=a.childNodes;for(var b,c=a.length,d=null,e=new ur;c--;)b=a[c],"coordinates"===b.nodeName&&(d=e.Ta(b));this.jv=null;d&&(this.jv=e.fr(d)||null)}t("H.data.kml.Point",Lr);Lr.prototype.vh=function(){return this.jv};function Mr(a,b){var c=document.createElement("CANVAS");c.width=1;c.height=1;this.gs=a;this.eq={};this.hr={};this.ez=new wi(c);this.kd=b||""}Mr.prototype.create=function(a){this.oh=new Hr(a,this.gs);return Nr(this,a)};
function Nr(a,b,c){b=b.childNodes;for(var d=b.length,e,f={},g;d--;){var h=b[d];switch(h.nodeName){case "Point":h=new Lr(h);g=Or(a,"Marker");if(h=h.vh())e=new yi(h,g),g.gr&&Yb(g.gr,"statechange",z(a.kC,a,g.gr,e,g),!1);break;case "LineString":h=new Jr(h);g=Or(a,"Polyline");e=new wj(h.vh(),g);break;case "LinearRing":h=new Jr(h);g=Or(a,"Polyline");e=new wj(h.vh(),g);break;case "Polygon":h=new Kr(h);g=Or(a,"Polygon");g.elevation=h.elevation;g.extrusion=h.St;e=new bi(new P(h.Rt,h.Ou),g);break;case "MultiGeometry":e=
Nr(a,h,new S)}e&&(a.oh.name&&(f.name=a.oh.name),a.oh.description&&(f.description=a.oh.description),g&&g.El&&(f.balloonStyle=g.El),f.kmlNode=a.oh.yC,e.setData(f),c&&c.Y(e))}return c||e}
Mr.prototype.kC=function(a,b,c){var d=c.anchor,e=c.scale;c=e+"_"+d.x+d.y+d.Ye+d.Zd+"_"+c.href;var f={};if(1===a.getState()){var g=this.eq[c];if(!g){var h=d.x;var k=d.y;if(g=a.lc())g={w:g.w*e,h:g.h*e},f.size=g;h=d.Ye&&g?g.w*h:h*e;k=d.Zd&&g?g.h*(1-k):!d.Zd&&g?g.h-k*e:k*e;f.anchor={x:h,y:k};g=new wi(a.Se(),f);this.eq[c]=g}b.ve(g)}delete this.hr[c]};
function Or(a,b){var c=a.oh,d={visibility:c.visibility};var e=new vr;var f=1;var g={x:0,y:0,Ye:!1,Zd:!1};var h=Pr(a,c.kz);c.nv&&(h=Pr(a,c.nv,h));switch(b){case "Marker":if(h&&h.Gu){e=h.Gu;e.scale&&(f=e.scale);if(e.Eu){var k=e.Eu;g={x:k.x,y:k.y,Ye:k.Ye,Zd:k.Zd}}e.icon&&e.icon.href?(b=e.icon.href,Qr.test(b)||(b=a.kd+b),e=f+"_"+g.x+g.y+g.Ye+g.Zd+"_"+b,k=a.eq[e]||a.hr[e],k||(k=new wi(b),a.hr[e]=k),0===k.getState()?(d.icon=a.ez,d.gr=k,d.href=b,d.anchor=g,d.scale=f):1===k.getState()&&(d.icon=k)):1!==f&&
(k||(g={x:14,y:4,Ye:!1,Zd:!1}),e=wi,a=a.Ep(),k={w:28*f,h:36*f},f={size:new Ue(k.w,k.h),anchor:new L(g.Ye?k.w*g.x:g.x*f,g.Zd?k.h*(1-g.y):k.h-g.y*f),hitArea:new Je(Ke.POLYGON,[0*f,16*f,0*f,7*f,8*f,0*f,18*f,0*f,26*f,7*f,26*f,16*f,18*f,34*f,8*f,34*f])},d.icon=new e(a,f))}break;case "Polyline":d.style={};h&&h.Nh&&(f=h.Nh,d.style.strokeColor="rgba("+yr(e,f.Nl.color,!0)+")",0<=f.width&&(d.style.lineWidth=f.width));break;case "Polygon":d.style={},h&&(h.Nh&&(f=h.Nh,d.style.strokeColor="rgba("+yr(e,f.Nl.color,
!0)+")",0<=f.width&&(d.style.lineWidth=f.width)),h.lw&&(f=h.lw,d.style.fillColor=f.fill?"rgba("+yr(e,f.Nl.color,!0)+")":"rgba(0,0,0,0)",f.outline||(d.style.lineWidth=0)))}d.El=h.El;return d}function Pr(a,b,c){c=c||{};for(var d in b)b.hasOwnProperty(d)&&(c[d]="object"===typeof b[d]?Pr(a,b[d],c[d]):b[d]);return c}var Qr=/^[^:\/]+:/;Mr.prototype.Ep=function(){return'<svg xmlns="http://www.w3.org/2000/svg" width="28px" height="36px"><path d="M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z" fill="#000" fill-opacity=".2"/><path d="M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z" fill="#fff"/><path d="M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z" fill="#18d"/></svg>'};function Rr(a,b){a=a.childNodes;var c=a.length,d=new ur;for(this.vD=b;c--;)switch(b=a[c],b.nodeName){case "key":this.key=d.Ta(b);break;case "styleUrl":this.cl=d.Ta(b)}}t("H.data.kml.Pair",Rr);Rr.prototype.K=function(){if(this.cl){var a="highlight"===this.key?!0:!1;a=this.vD.Sp(this.cl.substr(1),a)}return a};Rr.prototype.getStyle=Rr.prototype.K;function Sr(a,b){var c=a.childNodes,d=c.length;this.gs=b;this.id=a.getAttribute("id");for(this.wn=[];d--;)a=c[d],"Pair"===a.nodeName&&(a=new Rr(a,this.gs),this.wn.push(a))}t("H.data.kml.StyleMap",Sr);Sr.prototype.K=function(a){var b=null;a=a?"highlight":"normal";for(var c=this.wn.length;c--;)this.wn[c].key===a&&(b=this.wn[c].K());return b};Sr.prototype.getStyle=Sr.prototype.K;function Tr(){this.ox={}}t("H.data.kml.StyleContainer",Tr);Tr.prototype.Co=function(a){a&&a.id&&(this.ox["style_"+a.id]=a)};Tr.prototype.addStyle=Tr.prototype.Co;Tr.prototype.Sp=function(a,b){a=this.ox["style_"+a];a instanceof Sr&&(a=a.K(b));return a};Tr.prototype.getStyleById=Tr.prototype.Sp;function Ur(a){bb(this,Ur);this.url=a;this.hj=[];this.ae=x;this.mj=z(this.mj,this);G.call(this)}u(Ur,G);t("H.data.AbstractReader",Ur);var Vr={ERROR:-1,LOADING:0,VISIT:1,READY:2};Ur.State=Vr;Ur.prototype.state=Vr.READY;Ur.prototype.j={Oi:"statechange"};Ur.prototype.Sb=function(){if(!this.ae){this.ae=new J;var a=this.ae.qd();a.hd(this.hj)}return new oj(this.ae)};Ur.prototype.getLayer=Ur.prototype.Sb;Ur.prototype.sA=function(){return this.hj.concat([])};Ur.prototype.getParsedObjects=Ur.prototype.sA;
Ur.prototype.i=function(){return this.url};Ur.prototype.getUrl=Ur.prototype.i;Ur.prototype.jD=function(a){if(this.state===Vr.LOADING||this.state===Vr.VISIT)throw Error("InvalidState: state "+this.state);this.hj=[];this.ae=x;this.url=a;return this};Ur.prototype.setUrl=Ur.prototype.jD;Ur.prototype.getState=function(){return this.state};Ur.prototype.getState=Ur.prototype.getState;Ur.prototype.F=function(a,b,c){this.state=a;this.dispatchEvent(new Wr(b||this,this.j.Oi,a,c||""))};
Ur.prototype.parse=function(){var a=this;ab(this.url)?(this.F(Vr.LOADING),(new Qf("text/plain",this.url)).then(function(b){try{a.mj(b)}catch(c){a.F(Vr.ERROR,x,c.message)}},function(){a.F(Vr.ERROR,x,"Error loading file")})):a.F(Vr.ERROR,x,"File url was not set")};Ur.prototype.parse=Ur.prototype.parse;function Wr(a,b,c,d){Wr.g.constructor.call(this,b,a);this.state=c;this.message=d}u(Wr,Jb);Ur.Event=Wr;function Xr(a){var b=a?a.lastIndexOf("/"):-1;this.Bk=[];Ur.call(this,a);0<=b&&(this.oB=a.substr(0,b)+"/")}u(Xr,Ur);t("H.data.kml.Reader",Xr);
Xr.prototype.mj=function(a){var b,c=null;if(gb(a)&&""!=a.trim()){try{var d=(new DOMParser).parseFromString(a,"text/xml")}catch(h){this.F(Vr.ERROR,x,"Error parsing KML document");return}if(d.getElementsByTagName("parsererror").length)this.F(Vr.ERROR,x,"Error parsing KML document");else if((a=d.childNodes&&"kml"===d.childNodes[0].nodeName?d.childNodes[0]:void 0)&&(b=Yr(a.childNodes,"Document")[0]),b=b||a){d=new Tr;for(var e=Yr(b.childNodes,"Style"),f=Yr(b.childNodes,"StyleMap"),g=e.length;g--;)a=new Gr(e[g]),
d.Co(a);for(g=f.length;g--;)a=new Sr(f[g],d),d.Co(a);this.VB=new Mr(d,this.oB);a=b.childNodes;for(b=a.length;b--;)if(e=a[b],d=c,"Placemark"===e.nodeName?(e=this.VB.create(e))&&this.Rg(e,d):"Folder"===e.nodeName&&(e={group:new S,node:e},this.Rg(e.group,d),this.Bk.push(e)),!b&&(d=this.Bk.shift()))a=d.node.childNodes,c=d.group,b=a.length;this.F(Vr.READY)}else this.F(Vr.ERROR,x,"Invalid KML document")}else this.F(Vr.ERROR,x,"Unable to create objects from the empty data")};
Xr.prototype.Rg=function(a,b){b?b.Y(a):(this.ae&&this.ae.qd().Y(a),this.hj.push(a),this.F(Vr.VISIT,a))};function Yr(a,b){for(var c=a.length,d,e=[];c--;)d=a[c],d.nodeName===b&&e.push(d);return e};function Zr(a,b){this.Xa=a;this.Oe=b}
Zr.prototype.create=function(a,b){var c=a.coordinates;switch(a.type){case "Point":var d=new yi($r(c));break;case "LineString":d=new wj(as(c));break;case "Polygon":d=new bi(bs(c));break;case "MultiPoint":var e=0;var f=c.length;d=[];if(this.Oe){for(;e<f;e++)d.push($r(c[e]));c=new yi(new Xe(d))}else{for(;e<f;e++)d.push(new yi($r(c[e])));c=new S;c.hd(d)}d=c;f="multiPoint";break;case "MultiLineString":e=0;f=c.length;d=[];if(this.Oe){for(;e<f;e++)d.push(as(c[e]));c=new wj(new vj(d))}else{for(;e<f;e++)d.push(new wj(as(c[e])));
c=new S;c.hd(d)}d=c;f="multiLineString";break;case "MultiPolygon":d=[];e=0;f=c.length;if(this.Oe){for(;e<f;e++)d.push(bs(c[e]));c=new bi(new Ih(d))}else{for(;e<f;e++)d.push(new bi(bs(c[e])));c=new S;c.hd(d)}d=c;f="multiPolygon";break;case "GeometryCollection":c=d=new S;e=a.geometries;f=0;for(var g=e.length;f<g;f++)this.create(e[f],c);f="geometryCollection"}d&&(c=d,e=a.properties,a=a.id,g={},e&&(this.Oe?g=e:g.properties=e),f&&!this.Oe&&(g[f]=!0),a&&c.Zr(a),c.setData(g),this.Xa(d));b&&d&&b.Y(d);return d};
Zr.prototype.create=Zr.prototype.create;function $r(a){return new Re(a[1],a[0])}function bs(a){for(var b=as(a[0]),c=[],d,e=1,f=a.length;e<f;e++)d=as(a[e]),c.push(d);return new P(b,c)}function as(a){for(var b=0,c=a.length,d=new N;b<c;b++)d.sg($r(a[b]));return d};function cs(a,b){b=b||{};this.Xa=b.style||this.gh;(this.Oe=!!b.disableLegacyMode)||window.console.warn("H.data.geojson.Reader: Legacy parser is enabled in GeoJSON Reader. Features like Multi-Geometries, Polygon interiors and GeoJSON feature properties might not work as expected. To maximise compatibility with the remote services it is recommended to set the `disableLegacyMode` flag to true.");Ur.call(this,a)}u(cs,Ur);t("H.data.geojson.Reader",cs);
cs.prototype.mj=function(a){var b,c;try{var d="string"===typeof a?JSON.parse(a):a;if("object"===typeof d){var e=new Zr(this.Xa,this.Oe);switch(d.type){case "FeatureCollection":if(b=d.features){var f=new S;this.Rg(f);for(c=0;c<b.length;c++){var g=ds(b[c]);(g=e.create(g))&&f.Y(g)}}break;case "Feature":g=ds(d);(g=e.create(g))&&this.Rg(g);break;default:(g=e.create(d))&&this.Rg(g)}this.F(Vr.READY)}else this.F(Vr.ERROR,x,"Invalid syntax")}catch(h){this.F(Vr.ERROR,x,"Parse error. "+h.message)}};
cs.prototype.vC=function(a){this.F(Vr.LOADING);this.mj(a)};cs.prototype.parseData=cs.prototype.vC;cs.prototype.gh=function(){};function ds(a){var b={};if(a.geometry){var c=a.geometry;b.type=c.type;b.properties=a.properties;c.coordinates&&(b.coordinates=c.coordinates);c.geometries&&(b.geometries=c.geometries);a.id&&(b.id=a.id)}return b}cs.prototype.Rg=function(a){this.ae&&this.ae.qd().Y(a);this.hj.push(a);this.F(Vr.VISIT,a)};t("H.data.buildInfo",function(){return Cm("H-data","1.63.0","d08e47f",{region:"row"})});

Xg.prototype.ze=da(2,function(a,b){this.root.ze(a,jb(b)?b:this.Ph)});ah.prototype.ze=da(1,function(a,b){var c=0,d;if(!a(this)&&b--)for(;3>=c;c++)(d=this[c])&&d.ze(a,b)});function es(a){yb.call(this);this.ec=[];var b;a?Qa(b={},fs,a):b=fs;this.options=b;yb.call(this)}u(es,yb);var gs={clusters:[],noisePoints:[]},fs={projection:rg,min:0,max:22,eps:32,minWeight:2};m=es.prototype;m.ue=function(a){this.ec=a;this.od=!0};m.yc=function(a){this.ec.push(a);this.od=!0};m.Bl=function(a){this.ec=this.ec.concat(a);this.od=!0};m.Ek=function(a){this.ec=this.ec.filter(function(b){return b!==a});this.od=!0};m.disposeInternal=function(){es.g.disposeInternal.call(this);delete this.ec};
es.prototype.disposeInternal=es.prototype.disposeInternal;es.prototype.Uw=oe;function hs(a,b,c){this.pa=a;this.em=b;this.de=c}t("H.clustering.fastgrid.NoisePoint",hs);hs.prototype.Aa=function(){this.Tc||(this.Tc=this.pa.Ya(this.em[1],this.em[0],1));return this.Tc};hs.prototype.getPosition=hs.prototype.Aa;hs.prototype.Wd=function(){return this.em.weight};hs.prototype.getWeight=hs.prototype.Wd;hs.prototype.Yf=ne;hs.prototype.isCluster=hs.prototype.Yf;hs.prototype.Rd=function(){return this.de-this.pa.hh};hs.prototype.getMinZoom=hs.prototype.Rd;hs.prototype.getData=function(){return this.em.data};
hs.prototype.getData=hs.prototype.getData;function is(a,b,c,d,e,f){this.Eo=b;a&&(this.parent=a,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}m=is.prototype;m.fb=0;m.th=function(a){return this[a]||(++this.fb,this[a]=new is(this,a))};m.removeChild=function(a){var b=a.Eo;this[b]===a&&(delete this[b],delete a.parent,--this.fb)};m.ze=function(a,b){for(var c=0,d=this;d=d.parent;)++c;js(this,a,b,c)};
function js(a,b,c,d){var e,f;if(!b(a,d)&&c--)for(++d,e=0;4>e;e++)(f=a[e])&&js(f,b,c,d)}m.Qg=function(a){(this.entries||(this.entries=[])).push(a)};m.ej=0;m.fj=0;m.Fc=0;function ks(a){this.Ph=a||10;this.Dk=this.Ck=this.$i=this.Zi=2147483648;this.Fm()}m=ks.prototype;m.Fm=function(){this.head=this.root=new is(null,NaN,this.Zi-this.Ck,this.$i-this.Dk,this.Zi+this.Ck,this.$i+this.Dk)};m.Ml=function(){ls(this,this.root);this.Fm()};function ls(a,b){var c,d;for(c=0;4>c;c++)if(d=b[c])ls(a,d),delete b[c];delete b.parent;delete b.entries}
m.jd=function(a){var b=this.head,c;if(a){var d=a;if(d!==b)for(b=d;d=d.parent;)if(d.entries||1<d.fb)b=d}else for(;!b.entries&&2>(c=b.fb);)if(c)b=d;else break;this.head=b};m.Yd=function(a,b,c,d){var e=this.root;if(!(a>=e[7]&&b>=e[4]&&a<=e[5]&&b<=e[6]))throw Error("Coordinates out of bounds");return this.Ub(this.root,a,b,c,this.Ph,d)};
m.Ub=function(a,b,c,d,e,f){var g=a.entries;e?a.fb?g=this.Tj(a,b,c,d,e,f):g?(g=g[0],g=a.th(+(g[1]>=a[8])|+(g[0]>=a[9])<<1),g.entries=a.entries,g.ej=a.ej,g.fj=a.fj,g.Fc=a.Fc,g.dh=a.dh,g.dj=a.dj,g.bj=a.bj,g.cj=a.cj,delete a.entries,this.jd(g),g=this.Tj(a,b,c,d,e,f)):(a.Qg(g=new ms(b,c,d,f)),this.jd(a)):(g||this.jd(a),a.Qg(g=new ms(b,c,d,f)));a.ej+=b*d;a.fj+=c*d;a.Fc+=d;a.dh===A?(a.dh=a.bj=b,a.dj=a.cj=c):(b<a.dh?a.dh=b:b>a.bj&&(a.bj=b),c<a.dj?a.dj=c:c>a.cj&&(a.cj=c));return g};
m.Tj=function(a,b,c,d,e,f){return this.Ub(a.th(+(b>=a[8])|+(c>=a[9])<<1),b,c,d,e-1,f)};m.ze=function(a,b){js(this.root,a,b===+b?b:this.Ph,0)};function ms(a,b,c,d){this[0]=b;this[1]=a;this.weight=c;this.data=d};function ns(a,b,c,d){this.pa=a;this.tc=b;this.de=c;this.Jq=d;this.xp=Ia(this.xp,this);this.vp=Ia(this.vp,this)}t("H.clustering.fastgrid.Cluster",ns);ns.prototype.Aa=function(){this.Tc||(this.Tc=this.pa.Ya(this.tc.ej,this.tc.fj,this.tc.Fc));return this.Tc};ns.prototype.getPosition=ns.prototype.Aa;ns.prototype.Wd=function(){return this.tc.Fc};ns.prototype.getWeight=ns.prototype.Wd;ns.prototype.Yf=me;ns.prototype.isCluster=ns.prototype.Yf;
ns.prototype.Rd=function(){return this.de?this.de-this.pa.hh:-1/0};ns.prototype.getMinZoom=ns.prototype.Rd;ns.prototype.pm=function(){return this.Jq-this.pa.hh};ns.prototype.getMaxZoom=ns.prototype.pm;ns.prototype.C=function(){this.J||(this.J=Bg(this.pa.Ya(this.tc.dh,this.tc.dj,1),this.pa.Ya(this.tc.bj,this.tc.cj,1),!0));return this.J};ns.prototype.getBoundingBox=ns.prototype.C;ns.prototype.wp=function(a){this.Yt=a;this.tc.ze(this.xp,Yc)};ns.prototype.forEachEntry=ns.prototype.wp;
ns.prototype.xp=function(a,b){var c=!1,d,e;a.Fc>=this.pa.Av&&a!==this.tc&&a.Fc!==this.tc.Fc&&(this.Yt(new ns(this.pa,a,0,b)),c=!0);if(!c&&(d=a.entries))for(a=d.length,e=0;e<a;e++)this.Yt(new hs(this.pa,d[e],b));return c};ns.prototype.Aj=function(a){this.oz=a;this.tc.ze(this.vp,Yc)};ns.prototype.forEachDataPoint=ns.prototype.Aj;ns.prototype.vp=function(a,b){var c;if(a=a.entries){var d=a.length;for(c=0;c<d;c++)this.oz(new hs(this.pa,a[c],b))}return!1};function os(a){es.call(this,a);a=this.options;this.le=a.projection;this.ik=a.min;this.eg=a.max;this.Av=a.minWeight;this.hh=7-Bc(Fc(Ac(1,a.eps))/Qc);this.vr=new ks(Ac(this.ik,this.eg+this.hh))}u(os,es);m=os.prototype;m.ue=function(a){var b=0,c=a.length,d,e=new L(0,0),f=this.le,g=this.vr;os.g.ue.call(this,a);for(g.Ml();b<c;b++)f.Re(d=a[b],e).scale(4294967296).floor(),g.Yd(e.x,e.y,d.wt,d.data);this.od=!0};m.yc=function(a){os.g.yc.call(this,a);this.ue(this.ec)};
m.Bl=function(a){for(var b=a.length,c=os.g.yc;b--;)c.call(this,a[b]);this.ue(this.ec)};m.Ek=function(a){os.g.Ek.call(this,a);this.ue(this.ec)};m.Ya=function(a,b,c,d){return this.le.Ya(a/c/4294967296,b/c/4294967296,d)};m.ds=function(a){if(this.od){var b={clusters:[],noisePoints:[]};ps(this,this.vr.root,0,this.eg+this.hh,-1/0,b,null);this.od=!1;a(b)}};
function ps(a,b,c,d,e,f,g){var h=b.Fc,k;g&&(g.node.Fc!==h?(f.clusters.push(new ns(a,g.node,g.depth,c-1)),g=null):e++);g||(h>=a.Av?(g={node:b,depth:c},e=c):qs(a,b,e+1,f));if(b.fb&&d--)for(c++,h=0;4>h;h++)if(k=b[h])ps(a,k,c,d,e,f,g),g=null;g&&f.clusters.push(new ns(a,g.node,g.depth,a.eg+a.hh))}function qs(a,b,c,d){b=b.entries;var e;if(b){var f=b.length;d=d.noisePoints;for(e=0;e<f;e++)d.push(new hs(a,b[e],c))}else for(e=0;4>e;e++)(f=a[e])&&qs(a,f,c,d)}
m.disposeInternal=function(){os.g.disposeInternal.call(this);this.vr=null};os.prototype.disposeInternal=os.prototype.disposeInternal;function rs(a,b){this.ir=a;this.de=b}t("H.clustering.grid.NoisePoint",rs);rs.prototype.Aa=function(){return Te(this.ir)};rs.prototype.getPosition=rs.prototype.Aa;rs.prototype.Wd=function(){return this.ir.wt};rs.prototype.getWeight=rs.prototype.Wd;rs.prototype.Yf=ne;rs.prototype.isCluster=rs.prototype.Yf;rs.prototype.Rd=function(){return this.de};rs.prototype.getMinZoom=rs.prototype.Rd;rs.prototype.getData=function(){return this.ir.data};rs.prototype.getData=rs.prototype.getData;function ss(a,b,c){this.Jq=this.de=c;this.jr=[];this.ss=0;this.J=Bg(a,b,!0)}t("H.clustering.grid.Cluster",ss);ss.prototype.Qi=function(a){this.Tc||(this.Tc=Te(a));this.ss+=a.wt||1;this.jr.push(a)};ss.prototype.Aa=function(){return this.Tc};ss.prototype.getPosition=ss.prototype.Aa;ss.prototype.Wd=function(){return this.ss};ss.prototype.getWeight=ss.prototype.Wd;ss.prototype.Yf=me;ss.prototype.isCluster=ss.prototype.Yf;ss.prototype.Rd=function(){return this.de};ss.prototype.getMinZoom=ss.prototype.Rd;
ss.prototype.pm=function(){return this.Jq};ss.prototype.getMaxZoom=ss.prototype.pm;ss.prototype.C=function(){return this.J};ss.prototype.getBoundingBox=ss.prototype.C;ss.prototype.wp=function(a){this.Aj(a)};ss.prototype.forEachEntry=ss.prototype.wp;ss.prototype.Aj=function(a){var b=this;if(!Za(a))throw new C(this.Aj,0,a);this.jr.forEach(function(c){a(new rs(c,b.de+1))})};ss.prototype.forEachDataPoint=ss.prototype.Aj;function ts(a){es.call(this,a)}u(ts,es);
ts.prototype.ds=function(a){var b=this.options,c=b.min,d=b.max,e=[],f=[],g;if(this.od){for(g=this.ec;c<=d;c++){for(var h,k=void 0,l,n,p,q,r,v,w,y=c,D=g,F=e,O=f,R=b.eps,Ta=b.projection,aa=b.minWeight,wb=D.length,Ba=Math.pow(2,y+8),Oa=[];w=D[--wb];)if(!w.zs){n=Ta.Re(w).scale(Ba).floor();v=Ba;r=n.x;q=n.y;for(l=Oa.length;l--;)h=Oa[l],p=h.Aa(),h.xs||(h.xs=Ta.Re(p).scale(Ba).floor()),p=h.xs,p=p.ib(n),p<v&&(v=p,k=h);k&&k.C().Ff(w)||(k=new ss(Ta.yn({x:(r-R)/Ba,y:(q-R)/Ba}),Ta.yn({x:(r+R)/Ba,y:(q+R)/Ba}),
y),Oa.push(k));k.Qi(w);k=null}for(wb=Oa.length;wb--;)if(h=Oa[wb],l=h.Wd(),l<aa)for(h=h.jr,l=h.length;w=h[--l];)O.push(new rs(w,y)),w.zs=!0;else F.push(h)}c=0;for(d=g.length;c<d;c++)delete g[c].zs;this.od=!1;a({clusters:e,noisePoints:f})}};function us(a){this.na=a;this.vy=11;a=document.createElement("canvas");var b=a.getContext("2d"),c=this.na,d=14*c;a.width=d;a.height=d;b.scale(c,c);b.beginPath();b.strokeStyle="#FFFFFF";b.fillStyle="#1080DD";b.arc(7,7,6,0,2*Math.PI,!1);b.fill();b.lineWidth=1;b.stroke();this.TB=new wi(a,{size:{w:14,h:14},anchor:{x:7,y:7}});this.mt={};this.nt={}}t("H.clustering.theme.Circular",us);
function vs(a,b,c){var d,e=document.createElement("canvas"),f=e.getContext("2d",{willReadFrequently:!0});var g=a.na;var h=b*g;e.width=h;e.height=h;f.scale(g,g);g=b+":"+c;(d=a.mt[g])?f.putImageData(d,0,0):(b/=2,f.beginPath(),f.strokeStyle="rgba("+c+",0.2)",f.fillStyle="rgba("+c+",1)",f.arc(b,b,b/5*3,0,2*Math.PI,!1),f.fill(),f.lineWidth=b/5*4,f.stroke(),a.mt[g]=f.getImageData(0,0,h,h));return e}
us.prototype.Fz=function(a){var b=a.Wd();var c=this.nt[b];if(!c){if(10>b){c=vs(this,28,"118,209,0");var d={x:11,y:18}}else 25>b?(c=vs(this,38,"255,105,0"),d={x:13,y:23}):50>b?(c=vs(this,38,"240,60,0"),d={x:13,y:23}):100>b?(c=vs(this,38,"181,0,21"),d={x:13,y:23}):1E3>b?(c=vs(this,48,"181,0,21"),d={x:15,y:28}):(c=vs(this,66,"181,0,21"),d={x:20,y:38});var e=c.getContext("2d");e.fillStyle="#FFFFFF";e.font="bold "+this.vy+"px Arial";e.fillText(String(b),d.x,d.y);d=c.width/this.na;c=new wi(c,{size:{w:d,
h:d},anchor:{x:d/2,y:d/2}});this.nt[b]=c}b=new yi(a.Aa(),{icon:c,min:a.Rd(),max:a.pm()});b.setData(a);return b};us.prototype.getClusterPresentation=us.prototype.Fz;us.prototype.pA=function(a){var b=new yi(a.Aa(),{icon:this.TB,min:a.Rd()});b.setData(a);return b};us.prototype.getNoisePresentation=us.prototype.pA;t("H.clustering.DataPoint",function(a,b,c,d){this.lat=a;this.lng=b;this.wt=c===+c?c:1;this.data=d});function ws(a){es.call(this,a);a=this.options;if(a.projection!==rg)throw new C(ws,0,"Other projection than mercator not supported yet");this.le=a.projection;this.np=a.eps;this.OB=a.minWeight;this.iw=new sg(this.le);(new en).registerProcessor("cluster","H.clustering.dynamicgrid.worker");this.gg=z(this.gg,this);this.Pq=z(this.Pq,this)}u(ws,es);ws.prototype.Uw=function(a,b){this.Py=a;this.Qy=Cc(b)};
ws.prototype.ds=function(a,b){var c=this.Lg;var d=this.Py,e=this.Qy||0;var f=!c||!(c.zoom===e&&c.Ti.da(d));if(d&&(this.od||f)){c&&3>c.state&&c.cancel();this.od=!1;c=this.np;if(c>=128*Hc(2,e))var g=xs;else{f=this.iw;f.Ua(e);var h=f.Fb(d.Nc());g=f.Fb(d.Lc());h.y-=c;g.y+=c;h=f.tk(h);var k=f.tk(g);g=new K(h.lat,h.lng,k.lat,k.lng);c=f.Ya(c,0).lng+180;g=g.ce(h.lat,h.lng-c,k.lat,h.lng).ce(h.lat,k.lng,k.lat,k.lng+c)}c=g;h=this.ec;g=[];for(f=h.length;f--;)c.Ff(h[f])&&g.push(h[f]);0<g.length?(this.Lg=new ys(d,
e,g,this.np,this.OB,this.le!==rg,a,b),this.Lg.then(this.gg,this.Pq)):a(gs)}};
ws.prototype.gg=function(a){Ca(a)||(a=new globalThis.Uint32Array(a));for(var b=this.Lg,c=b.lC,d=0,e=a[d++],f=Array(e),g=0,h=[],k=a.length,l=this.Lg.Sy,n=this.Lg.zoom;e--;)f[g++]=new rs(l[a[d++]],n);for(;d<k;){e=a[d++];g=l[a[d]];var p=this.iw;var q=this.np;p.Ua(this.Lg.zoom);var r=p.Fb(g);g=p.Ya(r.x-q,r.y-q);p=p.Ya(r.x+q,r.y+q);g=new K(g.lat,g.lng,p.lat,p.lng);for(g=new ss(g.Nc(),g.Lc(),n);e--;)g.Qi(l[a[d++]]);h.push(g)}c.call(b,{clusters:h,noisePoints:f})};ws.prototype.Pq=function(a){gb(a)&&this.Lg.bC(a)};
var xs=new K(90,-180,-90,180);ws.prototype.disposeInternal=function(){ws.g.disposeInternal.call(this)};ws.prototype.disposeInternal=ws.prototype.disposeInternal;function ys(a,b,c,d,e,f,g,h){this.Ti=a;this.zoom=b;this.Sy=c;this.lC=g;this.bC=h;a=c.length;g=3*a;h=new (globalThis.Float64Array||Array)(g);for(var k;a--;)k=c[a],h[--g]=k.lat,h[--g]=k.lng,h[--g]=k.wt;Ud.call(this,"cluster",{message:[h,d,e,b,f]},void 0)}u(ys,gn);function zs(a,b){b=b||{};var c={},d=b.min||0,e=Ac(d,b.max||22);d={min:d,max:e};zs.g.constructor.call(this,d);this.na=b.pixelRatio||ae();Qa(c,fs,d,b.clusteringOptions||{});c.minWeight=Ac(fs.minWeight,c.minWeight);switch(c.strategy){case As.DYNAMICGRID:if(c.projection!==rg)throw new C(zs,1,"Unsupported projection");this.pa=new ws(c);break;case As.GRID:this.pa=new ts(c);break;default:this.pa=new os(c)}this.pa.ue(a);this.hl=b.theme||new us(this.na);this.Po=z(this.Po,this);this.gg=z(this.gg,this);Bs(this)}
u(zs,J);t("H.clustering.Provider",zs);zs.prototype.disposeInternal=function(){zs.g.disposeInternal.call(this);this.Ag.ia();this.pa.l();delete this.pa;delete this.Rm;delete this.hl;globalThis.clearTimeout(this.jp)};var As={FASTGRID:0,GRID:1,DYNAMICGRID:2};zs.Strategy=As;zs.prototype.ky=150;zs.prototype.Po=function(){this.dispatchEvent("start");this.pa.ds(this.gg,oe)};function Bs(a,b,c){a.jp&&globalThis.clearTimeout(a.jp);b&&a.pa.Uw(b,c);a.jp=globalThis.setTimeout(a.Po,a.ky)}
zs.prototype.gg=function(a){this.Rm=a;Cs(this);this.dispatchEvent("end")};zs.prototype.ue=function(a){this.pa.ue(a);Bs(this)};zs.prototype.setDataPoints=zs.prototype.ue;zs.prototype.yc=function(a){this.pa.yc(a);Bs(this)};zs.prototype.addDataPoint=zs.prototype.yc;zs.prototype.Bl=function(a){this.pa.Bl(a);Bs(this)};zs.prototype.addDataPoints=zs.prototype.Bl;zs.prototype.Ek=function(a){this.pa.Ek(a);Bs(this)};zs.prototype.removeDataPoint=zs.prototype.Ek;zs.prototype.LA=function(){return this.hl};
zs.prototype.getTheme=zs.prototype.LA;zs.prototype.gD=function(a){this.hl=a;this.Rm&&(this.Ag.ia(),Cs(this))};zs.prototype.setTheme=zs.prototype.gD;function Cs(a){var b=a.Rm.clusters,c=a.Rm.noisePoints,d=b.length,e=c.length,f=0<d+e;for(a.Ag.ia();e--;){var g=c[e];a.Ag.Y(a.hl.getNoisePresentation(g))}for(;d--;)c=b[d],a.Ag.Y(a.hl.getClusterPresentation(c));f&&a.hb()}zs.prototype.Uc=function(){return!0};zs.prototype.providesDomMarkers=zs.prototype.Uc;zs.prototype.Vc=function(){return!0};
zs.prototype.providesMarkers=zs.prototype.Vc;zs.prototype.me=function(){return!0};zs.prototype.providesSpatials=zs.prototype.me;zs.prototype.yk=function(a,b){Bs(this,a,b)};zs.prototype.preprocessData=zs.prototype.yk;t("H.clustering.buildInfo",function(){return Cm("H-clustering","1.63.0","d08e47f",{region:"row"})});

function Ds(a,b){a:{for(var c=a.length,d="string"===typeof a?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:"string"===typeof a?a.charAt(b):a[b]}var Es={};function Fs(a){var b=a.ownerDocument,c=b.documentElement;b=b.defaultView;var d=a.getBoundingClientRect();a=d.left;d=d.top;isNaN(b.pageXOffset)?(a+=c.scrollLeft,d+=c.scrollTop):(a+=b.pageXOffset,d+=b.pageYOffset);return new L(a,d)}
function Gs(a,b,c){b=jb(b)?b+"px":b;c=jb(c)?c+"px":c;a.style[li("transform")]="translate("+b+","+c+")"}var Hs,Is=navigator.userAgent,Js=-1<Is.indexOf("Android")&&-1<Is.indexOf("Mozilla/5.0")&&-1<Is.indexOf("AppleWebKit"),Ks=/AppleWebKit\/([\d.]+)/,Ls=null===Ks.exec(Is)?null:parseFloat(Ks.exec(Is)[1]);Hs=Js&&null!==Ls&&537>Ls;var Ms=document.createElement("T");function Ns(){this.ex=this.Et()}Ns.prototype.Et=function(){var a=navigator,b=[];a&&(a.msPointerEnabled?b.push(Os):a.pointerEnabled&&b.push(Ps));1>b.length&&("TouchEvent"in globalThis&&b.push(Qs),b.push(Rs));b.push(Ss);return b};Ns.prototype.detectEventSets=Ns.prototype.Et;Ns.prototype.addEventListener=function(a,b,c,d){for(var e=this.ex,f,g=e.length,h=!1;g--;)if(f=e[g][b])h=!0,a.addEventListener(f,c,d||!1);h||a.addEventListener(b,c,d||!1)};
Ns.prototype.removeEventListener=function(a,b,c,d){for(var e=this.ex,f,g=e.length,h=!1;g--;)if(f=e[g][b])h=!0,a.removeEventListener(f,c,d||!1);h||a.removeEventListener(b,c,d||!1)};
var Ps={start:"pointerdown",end:"pointerup",move:"pointermove",cancel:"pointercancel",over:"pointerover",out:"pointerout",hover:"pointerhover"},Os={start:"MSPointerDown",end:"MSPointerUp",move:"MSPointerMove",cancel:"MSPointerCancel",over:"MSPointerOver",out:"MSPointerOut",hover:"MSPointerHover"},Qs={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Rs={start:"mousedown",end:"mouseup",move:"mousemove",over:"mouseover",out:"mouseout",hover:"mousehover"},Ss={start:"keydown",end:"keyup"};
function Ts(a){return!(a instanceof KeyboardEvent)||"Enter"===a.code};function Us(a,b,c,d){a=a.createElement(b);c&&(a.className=c);d&&(a.innerHTML=d);return a}function Vs(a,b){for(var c=1,d=arguments.length;c<d;c++)a.appendChild(arguments[c])}var Ws=new Ns;function Xs(a,b,c){Ws.addEventListener(a,b,c,void 0)}function Ys(a,b,c){Ws.removeEventListener(a,b,c,void 0)};function Y(a,b){G.call(this);this.qb=a||"div";this.Le=b?b.split(" "):[];this.tb=!1;this.Le.push("H_el")}u(Y,G);t("H.ui.base.Element",Y);Y.prototype.L=function(a){if(!a)throw Error("Wrong document object");this.G=Us(a,this.qb,this.Le.join(" "));this.renderInternal(this.G,a);this.za(this.tb,!0);this.Ed(this.Ex);this.Yb(this.Jd);this.tf(this.qx);return this.G};Y.prototype.subscribe=function(){};Y.prototype.unsubscribe=function(){};Y.prototype.N=function(){};Y.prototype.renderInternal=Y.prototype.N;
Y.prototype.lq=function(){return this.tb};Y.prototype.isDisabled=Y.prototype.lq;Y.prototype.za=function(a,b){a=!!a;if(a!==this.tb||b)(this.tb=a)?this.Ha("H_disabled"):this.Ab("H_disabled");return this};Y.prototype.setDisabled=Y.prototype.za;Y.prototype.gp=null;Y.prototype.getData=function(){return this.gp};Y.prototype.getData=Y.prototype.getData;Y.prototype.setData=function(a){this.gp=a};Y.prototype.setData=Y.prototype.setData;
Y.prototype.Ed=function(a){var b=this.B();this.Ex=a;b&&(a?(b.setAttribute("title",a),b.setAttribute("aria-label",a)):(b.removeAttribute("title"),b.removeAttribute("aria-label")))};Y.prototype.setTooltip=Y.prototype.Ed;Y.prototype.G=null;Y.prototype.B=function(){return this.G};Y.prototype.getElement=Y.prototype.B;Y.prototype.Jd=!0;Y.prototype.Yb=function(a){var b=this.B();this.Jd=a;b&&(b.style.display=a?"":"none")};Y.prototype.setVisibility=Y.prototype.Yb;Y.prototype.Vd=function(){return this.Jd};
Y.prototype.getVisibility=Y.prototype.Vd;Y.prototype.qx=-1;Y.prototype.tf=function(a){this.qx=a;var b=this.B();b&&(b.tabIndex=a)};Y.prototype.setTabIndex=Y.prototype.tf;Y.prototype.Ha=function(a){var b=this.B();0>this.Le.indexOf(a)&&this.Le.push(a);b&&(b.className=this.Le.join(" "));return this};Y.prototype.addClass=Y.prototype.Ha;Y.prototype.Ab=function(a){a=this.Le.indexOf(a);var b=this.B();-1<a&&this.Le.splice(a,1);b&&(b.className=this.Le.join(" "));return this};Y.prototype.removeClass=Y.prototype.Ab;
function Zs(a){(a=a.B())&&a.parentNode&&a.parentNode.removeChild(a)}Y.prototype.disposeInternal=function(){Y.g.disposeInternal.call(this);Zs(this);this.gp=this.G=null;delete this.Ex};function $s(a,b,c){Y.call(this,a,b);this.cc=c?[].concat(c):[]}u($s,Y);t("H.ui.base.Container",$s);$s.prototype.za=function(a,b){var c=this.cc?this.cc.length:0;for(Y.prototype.za.call(this,a,b);c--;)this.cc[c].za(a,b);return this};$s.prototype.setDisabled=$s.prototype.za;$s.prototype.Ra=function(a){var b=this.B();this.cc.push(a);b&&(a.L(b.ownerDocument),b.appendChild(a.B()));return this};$s.prototype.addChild=$s.prototype.Ra;$s.prototype.Ej=function(){return[].concat(this.cc)};
$s.prototype.getChildren=$s.prototype.Ej;$s.prototype.removeChild=function(a){var b=this.cc.indexOf(a),c=this.B();0<=b&&(this.cc.splice(b,1),c&&c.removeChild(a.B()))};$s.prototype.removeChild=$s.prototype.removeChild;$s.prototype.ia=function(){var a=this.B();a&&this.cc.forEach(function(b){a.removeChild(b.B())});this.cc=[]};$s.prototype.N=function(a,b){for(var c=0,d=this.cc.length;c<d;c++)a.appendChild(this.cc[c].L(b))};$s.prototype.renderInternal=$s.prototype.N;
$s.prototype.disposeInternal=function(){this.ia();this.cc.forEach(this.cz,this);Y.prototype.disposeInternal.call(this)};$s.prototype.cz=function(a){a.l()};function at(a){a=a||{};Y.call(this,"div","H_btn");this.we(a.label||" ");this.Ed(a.tooltip||"");this.setData(a.data);this.za(!!a.disabled);this.tf(0);this.F(bt.UP,!0);a.onStateChange&&this.addEventListener("statechange",a.onStateChange);this.dn=z(this.dn,this);this.Vh=z(this.Vh,this)}u(at,Y);t("H.ui.base.Button",at);at.prototype.za=function(a,b){a&&this.Ab("H_active");return at.g.za.call(this,a,b)};at.prototype.setDisabled=at.prototype.za;
at.prototype.N=function(a){Xs(a,"start",this.dn);Xs(a,"end",this.Vh);Xs(a,"out",this.Vh);this.we(this.Vb,!0)};at.prototype.renderInternal=at.prototype.N;at.prototype.getState=function(){return this.o};at.prototype.getState=at.prototype.getState;at.prototype.F=function(a,b){a!==this.o&&(this.o=a,a===bt.DOWN?this.Ha("H_active"):this.Ab("H_active"),b||this.dispatchEvent("statechange"));return this};at.prototype.setState=at.prototype.F;at.prototype.Hp=function(){return this.Vb};
at.prototype.getLabel=at.prototype.Hp;at.prototype.we=function(a,b){if(b||a!==this.Vb)if(this.Vb=a,b=this.B())b.innerHTML=a;return this};at.prototype.setLabel=at.prototype.we;at.prototype.dn=function(a){!this.tb&&Ts(a)&&(this.F(bt.DOWN),a.preventDefault())};at.prototype.Vh=function(a){!this.tb&&Ts(a)&&(this.F(bt.UP),a.preventDefault())};at.prototype.disposeInternal=function(){var a=this.B();a&&(Ys(a,"start",this.dn),Ys(a,"end",this.Vh),Ys(a,"out",this.Vh));Y.prototype.disposeInternal.call(this)};
var bt={UP:"up",DOWN:"down"};at.State=bt;function ct(a){at.call(this,a);this.aC=function(b){Ts(b)&&b.preventDefault()};this.ie=z(function(b){!this.tb&&Ts(b)&&(this.toggleState(),b.preventDefault())},this)}u(ct,at);t("H.ui.base.PushButton",ct);ct.prototype.N=function(a){Xs(a,"start",this.ie);Xs(a,"end",this.aC);this.we(this.Vb,!0)};ct.prototype.renderInternal=ct.prototype.N;ct.prototype.Bx=function(){var a=bt.DOWN;this.F(this.getState()===a?bt.UP:a);return this};ct.prototype.toggleState=ct.prototype.Bx;
ct.prototype.disposeInternal=function(){var a=this.B();a&&Ys(a,"start",this.ie);at.prototype.disposeInternal.call(this)};function dt(a){a=a||{};$s.call(this,"div","H_rdo");this.ls=new Y("div","H_rdo_title");this.Ui=new $s("div","H_rdo_buttons");this.Ra(this.ls);this.Ra(this.Ui);this.Iv=z(function(b){b.target.getState()===bt.DOWN?(this.Sw(b.target,!0),this.dispatchEvent(et)):b.target.F(bt.DOWN,!0)},this);this.addEventListener("statechange",this.Iv);this.bs(a.title||"");a.onActiveButtonChange&&this.addEventListener(et,a.onActiveButtonChange);a.buttonsOptions&&a.buttonsOptions.forEach(function(b){this.Ao(new ct(b))},
this)}u(dt,$s);t("H.ui.base.RadioGroup",dt);var et="activebuttonchange";dt.prototype.N=function(a,b){$s.prototype.renderInternal.call(this,a,b);this.bs(this.ko,!0)};dt.prototype.renderInternal=dt.prototype.N;dt.prototype.ia=function(){this.Ui.ia()};dt.prototype.bs=function(a,b){if(a!==this.ko||b)this.ko=a,this.ls.B()&&(this.ls.B().innerHTML=this.ko);return this};dt.prototype.setTitle=dt.prototype.bs;dt.prototype.NA=function(){return this.ko};dt.prototype.getTitle=dt.prototype.NA;
dt.prototype.Ao=function(a){if(!(a instanceof ct))throw Error("PushButton expected");a.ea(this);this.Ui.Ra(a);return this};dt.prototype.addButton=dt.prototype.Ao;dt.prototype.GC=function(a){this.Ui.removeChild(a);a.ea(null);return this};dt.prototype.removeButton=dt.prototype.GC;dt.prototype.Dj=function(){return this.Ui.Ej()};dt.prototype.getButtons=dt.prototype.Dj;dt.prototype.Sw=function(a,b){for(var c=this.Dj(),d=c.length;d--;)c[d].F(c[d]===a?bt.DOWN:bt.UP,b)};dt.prototype.setActiveButton=dt.prototype.Sw;
dt.prototype.disposeInternal=function(){this.removeEventListener("statechange",this.Iv);this.ia();$s.prototype.disposeInternal.call(this)};function ft(){this.o=gt.CLOSED;$s.call(this,"div","H_overlay")}u(ft,$s);t("H.ui.base.OverlayPanel",ft);ft.prototype.F=function(a,b){if(a!==this.o||b)this.o=a,a===gt.OPEN?this.Ha("H_open"):this.Ab("H_open");return this};ft.prototype.setState=ft.prototype.F;ft.prototype.getState=function(){return this.o};ft.prototype.getState=ft.prototype.getState;
ft.prototype.kw=function(a){var b=a.Ee;a=a.B();var c=this.B(),d=c.style;this.Ab("H_top");this.Ab("H_middle");this.Ab("H_bottom");this.Ab("H_left");this.Ab("H_center");this.Ab("H_right");d.bottom=d.top=d.left=d.right=d.margin="";if(/top/g.test(b)){this.Ha("H_top");d.top="0";d.margin="0 12px";var e=-1}else/bottom/g.test(b)?(this.Ha("H_bottom"),d.bottom="0",d.margin="0 12px",e=1):(this.Ha("H_middle"),d.top="50%",d.margin="0 12px",d.marginTop=-Math.round(.5*
c.offsetHeight)+"px",e=0);/left/g.test(b)?(this.Ha("H_left"),d.left=a.offsetWidth+"px",d.marginLeft="12px"):/right/g.test(b)?(this.Ha("H_right"),d.right=a.offsetWidth+"px",d.marginRight="12px"):(this.Ha("H_center"),d.left="50%",0>e?(d.top=a.offsetHeight+"px",d.marginTop="12px"):0<e&&(d.bottom=a.offsetHeight+"px",d.marginBottom="12px"),d.marginLeft=-Math.round(.5*c.offsetWidth)+"px",a.appendChild(c))};ft.prototype.pointToControl=ft.prototype.kw;var gt={OPEN:"open",CLOSED:"closed"};
ft.State=gt;var ht={TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right",LEFT_TOP:"left-top",LEFT_MIDDLE:"left-middle",LEFT_BOTTOM:"left-bottom",RIGHT_TOP:"right-top",RIGHT_MIDDLE:"right-middle",RIGHT_BOTTOM:"right-bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right"};t("H.ui.LayoutAlignment",ht);function it(){$s.call(this,"div","H_ctl");this.map=null;this.Ee="top-left"}u(it,$s);t("H.ui.Control",it);it.prototype.Qa=function(a){this.map=a};it.prototype.L=function(a){return $s.prototype.L.call(this,a)};it.prototype.N=function(a,b){$s.prototype.renderInternal.call(this,a,b);this.Zc(this.Ee)};it.prototype.renderInternal=it.prototype.N;it.prototype.rk=function(){};it.prototype.onUnitSystemChange=it.prototype.rk;it.prototype.kc=function(){return this.map};it.prototype.getMap=it.prototype.kc;
it.prototype.la=function(){return this.CB};it.prototype.getLocalization=it.prototype.la;it.prototype.yz=function(){return this.Ee};it.prototype.getAlignment=it.prototype.yz;it.prototype.Zc=function(a){"string"===typeof a&&ht[a.replace("-","_").toUpperCase()]===a&&(this.Ee=a,this.dispatchEvent("alignmentchange"));return this};it.prototype.setAlignment=it.prototype.Zc;function jt(a,b,c){af.call(this,a,{icon:kt,visibility:c});lt(this,b)}u(jt,af);function lt(a,b){a.qB=b;a.G&&(a.G.textContent=b)}var kt=new ye(Us(globalThis.document,"span","H_dm_label"),{onAttach:function(a,b,c){c.G=a;lt(c,c.qB)},onDetach:function(a,b,c){delete c.G}});function mt(a,b){G.call(this);this.Me=a;this.Vb=new jt(this.DD,"");b.push(this.Vb);this.sd=new S({objects:b,data:this});this.bo=this.bo.bind(this)}u(mt,G);m=mt.prototype;m.Ze=!1;m.DD={lat:0,lng:0};m.we=function(a,b){lt(this.Vb,a);this.Vb.X(b)};m.Tk=function(a){(this.Jd=a)?this.bo():(this.ll&&globalThis.clearTimeout(this.ll),this.ll=globalThis.setTimeout(this.bo,100))};m.ll=0;m.bo=function(){this.Vb.Yb(this.Jd)};function nt(a,b){b&&(a.nextSibling=b,b.previousSibling=a)};function ot(a,b,c,d){var e=new N,f=[];nt(a,this);nt(this,b);e.sg(a.Aa());e.sg(b.Aa());this.Oh=new wj(e,{style:c.Nh});this.wu=new wj(e,{style:{strokeColor:"transparent",lineWidth:Math.min(100,this.Oh.K().lineWidth+2*(d||5))}});c.outlineStyle&&(this.cr=new wj(e,{style:c.outlineStyle}),f.push(this.cr));f.push(this.Oh,this.wu);mt.call(this,c,f);this.dv=this.cv=-1;a=this.sd;a.addEventListener("pointermove",this.he,!0,this);a.addEventListener("pointerleave",this.Wq,!0,this)}u(ot,mt);
ot.prototype.Jj=function(){var a=this.Oh.V();return a.xj(0).ib(a.xj(1))};function pt(a,b,c){var d=a.Oh.V();d.Zk(3*+c,3,[b.lat,b.lng,0]);a.cr&&a.cr.X(d);a.wu.X(d);a.Oh.X(d)}ot.prototype.he=function(a){var b=a.currentPointer;a=this.previousSibling.Aa();var c=this.nextSibling.Aa(),d=this.Me.kx,e=b.viewportX;b=b.viewportY;if(this.cv!==e||this.dv!==b)this.cv=e,this.dv=b,d.X(this.Me.oA(a,c,{x:e,y:b})),d.Yb(!0)};ot.prototype.Wq=function(){this.Me.kx.Yb()};
ot.prototype.Nr=function(){this.we(this.Me.Ht(this.Jj()),this.Oh.C().vb())};function qt(a,b,c){c=b.Kj(c||0);this.dg=new yi(a,{icon:c,zIndex:0});this.dg.draggable=!0;mt.call(this,b,[this.dg]);a=this.sd;a.addEventListener("dragstart",this.Ad,!0,this);a.addEventListener("drag",this.hg,!0,this);a.addEventListener("dragend",this.df,!0,this)}u(qt,mt);m=qt.prototype;m.kh=0;m.j={zf:"change"};m.Jj=function(){return this.kh};m.Aa=function(){return this.dg.V()};
function rt(a){var b=0;a.nextSibling&&a.previousSibling&&(a.nextSibling.Ze||a.previousSibling.Ze?a.nextSibling.Ze&&!a.previousSibling.Ze&&(b=2):b=1);b=a.Me.Kj(b);a.dg.ve(b)}m.hg=function(a){var b=a.currentPointer;a=b.viewportX;b=b.viewportY;if(this.rB!==a||this.sB!==b)this.rB=a,this.sB=b,this.dg.X(this.Me.map.Va(a-this.uv.x,b-this.uv.y)),this.dispatchEvent(new Jb(this.j.zf,this))};
m.Ad=function(a){var b=a.currentPointer,c=b.viewportX;b=b.viewportY;var d=this.Me.map.La(this.Aa());this.dg.ui(1);this.uv={x:c-d.x,y:b-d.y};a.stopPropagation()};m.df=function(){this.dg.ui(0)};m.Nr=function(a){this.kh=a;this.we(this.Me.Ht(a),this.Aa())};function st(a,b){this.Ia=b;this.uc=a;this.lb={Ze:!0};tt(this,this.lb);this.jn=z(this.jn,this)}t("H.ui.distanceMeasurement.Model",st);m=st.prototype;m.Jm=function(){return this.lb.nextSibling===this.lb};m.Tk=function(a){for(var b=this.lb,c=b.nextSibling;c!==b;)c.Tk(c.previousSibling===b?!1:a),c=c.nextSibling};
function ut(a,b){var c=b||a.lb.nextSibling,d=0,e=0;if(b&&!vt(a,b))throw new C(a.Fk,0,b);c instanceof qt?d=c.Jj():c instanceof ot&&(d=c.previousSibling.Jj());for(b=c;b&&b!==a.lb;b=b.nextSibling,e++)b.Nr(d),1===e%2&&(d+=b.Jj())}m.Qi=function(a){var b=this.lb.previousSibling,c=this.Jm();a=new qt(a,this.Ia,c?0:2);this.uc.Y(a.sd);nt(a,this.lb);a.addEventListener(a.j.zf,this.jn);c?tt(this,a):(wt(this,b,a),rt(b),ut(this,b));return a};
m.insertBefore=function(a,b){var c;var d=1;if(b){if(!vt(this,b))throw new C(this.insertBefore,1,b);if(c=b.previousSibling.Ze)d=0;a=new qt(a,this.Ia,d);a.addEventListener(a.j.zf,this.jn);this.uc.Y(a.sd);c?(c=this.lb.nextSibling,wt(this,a,c),tt(this,a),b=a,rt(c)):(c=b.previousSibling,b=c.previousSibling,d=c.nextSibling,this.uc.Oa(c.sd),wt(this,b,a),wt(this,a,d));ut(this,b)}else a=this.Qi(a);return a};m.ia=function(){tt(this,this.lb);this.uc.ia()};
m.Fk=function(a){var b=this.lb,c=a.previousSibling,d=a.nextSibling;if(!vt(this,a))throw new C(this.Fk,0,a);this.uc.Oa(a.sd);if(c===b){var e=d;e!==b?(a=e.nextSibling,tt(this,a),a.Nr(0),rt(a),ut(this,a)):tt(this,this.lb)}else d===b?(e=c,a=e.previousSibling,nt(a,b),rt(a)):c&&d&&(wt(this,c.previousSibling,d.nextSibling),this.uc.ug([d.sd,c.sd]),ut(this,c.previousSibling));e&&e!==b&&this.uc.Oa(e.sd)};
function vt(a,b){for(var c=a.lb.nextSibling,d=!1;c!==a.lb;){if(c===b){d=!0;break}c=c.nextSibling}return d}function wt(a,b,c){b=new ot(b,c,a.Ia);a.uc.Y(b.sd)}function tt(a,b){a.lb.nextSibling=b;b.previousSibling=a.lb}m.jn=function(a){a=a.target;var b=a.previousSibling,c=a.nextSibling,d=a.Aa();if(!c.Ze){pt(c,d,!1);var e=a}b.Ze||(pt(b,d,!0),e=b.previousSibling);ut(this,e)};var xt={IMPERIAL:"imperial",METRIC:"metric"};t("H.ui.UnitSystem",xt);var yt={btn:'<svg class="H_icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><g transform="translate(3 2)"><path d="m18 13v7h-18v-7h2v5h2v-2h2v2h2v-3h2v3h2v-2h2v2h2v-5z"></path><path d="m2.3.3c.7 0 1.3.1 1.8.4s.9.6 1.1 1 .4.9.4 1.4c0 .5-.1 1-.3 1.4s-.57 1-1 1.6-1.3 1.3-2.3 2.2h3.9l-.2 1.7h-6.16v-1.6c1.1-1.1 2-2 2.5-2.6s.9-1 1-1.4.3-.8.3-1.2c0-.4-.1-.7-.3-.9s-.5-.3-.9-.3c-.3 0-.6 0-.9.2s-.5.4-.8.7l-1.3-1c.4-.5.9-.9 1.4-1.2s1.2-.4 1.8-.4zm14.4 9.7h-2.3l-.2-3.8c 0-.9-.1-1.7-.1-2.4 0-.5 0-1 0-1.5l-1.5 6.7h-2.2l-1.6-6.7c.1.8.1 1.6.1 2.3 0 .5 0 1.1 0 1.7l-.2 3.8h-2.2l.7-9.7h2.9l1.5 6.6 1.4-6.6h2.9z"></path></g></g></svg>',
point:'<svg height="22" viewBox="0 0 12 12" width="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m6 12c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6z" fill="#fff"></path><path d="m6 10c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4z" fill="#2ed5c9" stroke="#272c36" stroke-width="2"></path></g></svg>'};function zt(a){a=a||{};var b,c=a.lineStyle;it.call(this);this.No=new ct({label:yt.btn,onStateChange:z(this.ff,this)});this.Ra(this.No);if(b=a.distanceFormatter)this.It=b;c&&(this.lv=c,this.$v=A);this.Zc(a.alignment||"right-bottom");this.td={};this.td[0]=a.startIcon;this.td[2]=a.endIcon;this.td[1]=a.stopoverIcon;this.td[3]=a.splitIcon}u(zt,it);t("H.ui.DistanceMeasurement",zt);m=zt.prototype;m.Pb=xt.METRIC;m.Zx=22;m.lv={strokeColor:"rgb(39,44,54)",lineWidth:5};m.$v={strokeColor:"white",lineWidth:7};
m.Xk=function(){var a=this.map,b,c={};this.Xj||(this.rc=new J,this.ob=new oj(this.rc,{pixelRatio:this.map.jb()}),this.uc=b=this.rc.qd(),this.uc.dx(!0),b.addEventListener("dragstart",this.Ad,!0,this),b.addEventListener("dragend",this.Yk,!0,this),b.addEventListener("pointerenter",this.Yk,!0,this),b.addEventListener("pointerleave",this.Wq,!0,this),b.addEventListener("tap",this.mC,!0,this),this.$k=At(this),c.Ht=z(this.It,this),c.Kj=z(this.Kj,this),c.oA=z(this.nu,this),c.map=this.map,c.kx=this.$k,c.Nh=
this.lv,c.outlineStyle=this.$v,this.Jb=new st(this.uc,c),this.Xj=!0);this.$k&&this.uc.Y(this.$k);a.addEventListener("tap",this.Ov,!0,this);a.O.add(this.ob)};m.Ai=function(){var a=this.map;this.Xj&&(a.removeEventListener("tap",this.Ov,!0,this),a.hi(this.ob),this.Jb.ia())};
function At(a){function b(){var h=c.lc();h={anchor:c.Cb.clone().scale(f).floor(),size:new Ue(Cc(h.w*f),Cc(h.h*f)),hitArea:d};return new wi(c.Se(),h)}var c=a.Kj(3),d=new Je(Ke.NONE,[]),e,f=c===a.Fs?.5:1;if(1===c.getState())var g=b();else g=new wi("<svg/>",{hitArea:d}),c.addEventListener("statechange",function(){1===c.getState()&&e.ve(b())});return e=new yi(a.map.vb(),{visibility:!1,icon:g})}
m.It=function(a){var b="m",c=0;"metric"===this.Pb?1E3<=a&&(a/=1E3,b="km",c=1):(a/=.3048,b="ft",5280<=a&&(a/=5280,b="mi",c=1));return a.toFixed(c)+" "+this.la().translate("scale."+b)};m.nu=function(a,b,c){var d=this.map.La(a);b=this.map.La(b);c=(new L(c.x,c.y)).mu(d,b);return this.map.Va(c.x,c.y)||Te(a)};
m.N=function(a,b){var c=this.map.wa.type===mg.P2D?this.map.jb():1;c*=this.Zx;var d=c/2;it.prototype.renderInternal.call(this,a,b);this.Pb=xt.METRIC;this.Fs=new wi(yt.point,{anchor:{x:d,y:d},size:{w:c,h:c},hitArea:new Je(Ke.CIRCLE,[d,d,d])});this.No.Ed(this.la().translate("distance.measurement"))};zt.prototype.renderInternal=zt.prototype.N;m=zt.prototype;m.Kj=function(a){return this.td[a]||this.Fs};m.Yk=function(){this.Jb.Tk(!0)};m.Ad=function(){this.Jb.Tk()};
m.Wq=function(a){"touch"!==a.currentPointer.type&&this.Jb.Tk()};m.mC=function(a){var b=a.currentPointer;var c=a.target.Na;var d;c&&(c=c.getData())instanceof mt&&(d=c);c=d;a=a.originalEvent;a=a.metaKey||a.altKey;c&&(a&&c instanceof qt?this.Jb.Fk(c):c instanceof ot&&(a=c.previousSibling.Aa(),d=c.nextSibling.Aa(),b={x:b.viewportX,y:b.viewportY},this.Jb.insertBefore(this.nu(a,d,b),c.nextSibling),this.$k.Yb()),this.Yk())};
m.Ov=function(a){var b=a.currentPointer;a=a.target;a!==this.map&&a.getProvider&&a.getProvider()===this.rc||(this.Jb.Qi(this.map.Va(b.viewportX,b.viewportY)),this.$k.Yb(),this.Yk())};m.ff=function(a){"down"===a.target.getState()?this.Xk():this.Ai()};m.rk=function(a){this.Pb=a;this.Xj&&(ut(this.Jb),this.Yk())};zt.prototype.onUnitSystemChange=zt.prototype.rk;zt.prototype.disposeInternal=function(){this.Ai();this.Xj&&(this.rc.l(),this.ob.l());zt.g.disposeInternal.call(this)};
zt.prototype.Qa=function(a){a?this.No.getState()===bt.DOWN&&(this.map=a,this.Xk()):(this.Ai(),this.Xj=!1);it.prototype.Qa.apply(this,arguments)};zt.prototype.setMap=zt.prototype.Qa;function Bt(a){a=a||{};it.call(this);this.sc=new ct({label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><g transform="translate(1 3)"><path fill-rule="nonzero" d="M5,0 L5,2 L2,2 L2,16 L5,16 L5,18 L2,18 C0.9,18 0,17 0,15.75 L0,2.25 C0,1 0.9,0 2,0 L5,0 Z M17,0 L20,0 C21.1,0 22,1 22,2.25 L22,15.75 C22,17 21.1,18 20,18 L17,18 L17,16 L20,16 L20,2 L17,2 L17,0 Z"></path><rect width="10" height="2" x="6" y="8"></rect><rect width="2" height="10" x="10" y="4"></rect></g></svg>',
onStateChange:z(this.ff,this)});this.Ra(this.sc);this.Zc(a.alignment||"right-bottom")}u(Bt,it);t("H.ui.ZoomRectangle",Bt);m=Bt.prototype;
m.ff=function(a){var b=this.map,c=b.ra.element;a.target.getState()===bt.DOWN?(b.addEventListener("dragstart",this.Ad,!0,this),b.addEventListener("drag",this.hg,!0,this),b.addEventListener("dragend",this.df,!0,this),a=c.ownerDocument.createElement("div"),a.className="H_zoom_lasso",c.appendChild(a),this.Pm=a):(b.removeEventListener("dragstart",this.Ad,!0,this),b.removeEventListener("drag",this.hg,!0,this),b.removeEventListener("dragend",this.df,!0,this),c.removeChild(this.Pm))};
m.Ad=function(a){var b=this.Pm.style,c=a.currentPointer,d=c.viewportX;c=c.viewportY;a.target===this.map&&(a.stopPropagation(),b.width="0px",b.height="0px",b.top=c+"px",b.left=d+"px",b.display="block",this.mx=c,this.lx=d)};m.hg=function(a){var b=a.currentPointer,c=b.viewportX,d=b.viewportY;b=this.lx;var e=this.mx,f=this.Pm.style;a.target===this.map&&(a.stopPropagation(),a=c-b,c=d-e,f.left=b+(0>a?a:0)+"px",f.top=e+(0>c?c:0)+"px",f.width=Math.abs(a)+"px",f.height=Math.abs(c)+"px")};
m.df=function(a){var b=this.map,c=a.currentPointer;a.target===this.map&&(a.stopPropagation(),this.Pm.style.display="none",b.va.$c({bounds:Cg([b.Va(this.lx,this.mx),b.Va(c.viewportX,c.viewportY)])},!0))};m.N=function(a,b){it.prototype.renderInternal.call(this,a,b);this.sc.Ed(this.la().translate("zoom.rectangle"))};Bt.prototype.renderInternal=Bt.prototype.N;function Ct(a){a=a||{};it.call(this);this.Ha("H_scalebar");this.Zc(a.alignment||"right-bottom");this.maxWidth=150;this.update=z(this.update,this);this.$u=this.Ir=this.Nk=this.el=null;this.tf(0)}u(Ct,it);t("H.ui.ScaleBar",Ct);
Ct.prototype.N=function(a,b){it.prototype.renderInternal.call(this,a,b);a.innerHTML='<svg height="12" version="1.1" xmlns="http://www.w3.org/2000/svg"><polyline style="fill:none; stroke:white; stroke-width:4" points="2,2 2,10 98,10 98,2"/><polyline style="fill:none; stroke:black; stroke-width:2" points="2,2 2,10 98,10 98,2"/></svg><div style="padding: 0 0 0 10px"></div>';a.style.direction="ltr";this.el=a.firstChild;b=this.el.childNodes;this.Nk=b[0];this.Ir=b[1];this.$u=a.lastChild;this.Pb=xt.METRIC;
this.bz=z(function(c){!this.tb&&Ts(c)&&(this.dispatchEvent("toggleunitsystem"),c.preventDefault())},this);this.ie=z(function(c){!this.tb&&Ts(c)&&c.preventDefault()},this);Xs(a,"start",this.ie);Xs(a,"end",this.bz);this.Ed(this.la().translate("scale.switchToImperial"));this.update()};Ct.prototype.renderInternal=Ct.prototype.N;Ct.prototype.Qa=function(a){this.map&&this.map.removeEventListener("mapviewchange",this.update);a&&a.addEventListener("mapviewchange",this.update);it.prototype.Qa.apply(this,arguments)};
Ct.prototype.setMap=Ct.prototype.Qa;
Ct.prototype.capture=function(a,b,c){var d=this.B();var e=d.ownerDocument,f=e.createElement("canvas"),g=f.getContext("2d"),h=e.createElementNS("http://www.w3.org/2000/svg","svg"),k=e.createElementNS("http://www.w3.org/2000/svg","foreignObject"),l=se(d,e,!1);e=parseFloat(d.offsetWidth)+1;var n=parseFloat(d.offsetHeight),p=e*a;a*=n;f.width=p;f.height=a;h.setAttribute("xmlns","http://www.w3.org/2000/svg");h.setAttribute("width",p);h.setAttribute("height",a);h.setAttribute("viewBox","0 0 "+e+" "+n);k.setAttribute("width",
"100%");k.setAttribute("height","100%");h.appendChild(k);l.setAttribute("width","100%");l.setAttribute("height","100%");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var q=window.getComputedStyle(d);"box-shadow display align-items font font-family font-size height text-shadow direction".split(" ").forEach(function(r){l.style.setProperty(r,q.getPropertyValue(r))});k.appendChild(l);d=ie(h.outerHTML);(new Qf("image",d)).then(function(r){g.drawImage(r,0,0);b(f)},c)};Ct.prototype.capture=Ct.prototype.capture;
Ct.prototype.rk=function(a){this.Pb=a;this.Ed("imperial"===a?this.la().translate("scale.switchToMetric"):this.la().translate("scale.switchToImperial"));this.update()};Ct.prototype.onUnitSystemChange=Ct.prototype.rk;
Ct.prototype.update=function(){var a;if(this.B()){this.el=this.el;this.Nk=this.Nk;var b=this.maxWidth;var c=0;if(a=this.map){var d=a.ra;var e=Math.round(.5*d.width);var f=Math.round(.5*d.height);0<e&&0<f&&(d=a.Va(e,f))&&(a=a.Va(e+1,f))&&(c=100*d.ib(a))}c&&(this.Pb===xt.IMPERIAL?1609.344>c?(e=c/.3048006,a=this.la().translate("scale.ft")):(e=c/1609.344,a=this.la().translate("scale.mi")):1E3>c?(e=c,a=this.la().translate("scale.m")):(e=c/1E3,a=this.la().translate("scale.km")),c=Math.pow(10,Math.floor(Math.log(e)/
Math.LN10)),e=c/e*100,e<b/5?(c*=5,e*=5):e<b/2?(c*=2,e*=2):e>b&&(c/=2,e/=2),e=Math.round(e),this.el.setAttribute("width",e),this.$u.textContent=c+" "+a,this.Nk.points.getItem(2).x=this.Ir.points.getItem(2).x=this.Nk.points.getItem(3).x=this.Ir.points.getItem(3).x=e-2)}};function Dt(a,b){b=b||{};if(!(a&&a instanceof Ei))throw Error("Base layer is mandatory for overview UI element");it.call(this);this.dr=new ct({label:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="H_icon"><g fill-rule="evenodd" transform="translate(2 2)"><rect width="9" height="9" x="10" y="10"/><rect class="H_icon_stroke" width="18" height="18" x="1" y="1" fill="none" stroke="#000" stroke-width="2" rx="2"/></g></svg>',onStateChange:z(this.ff,this)});this.Ra(this.dr);
this.$h=new Et(a,b.zoomDelta,b.scaleX,b.scaleY);this.Zc(b.alignment||"right-bottom");this.Ra(this.$h)}u(Dt,it);t("H.ui.Overview",Dt);Dt.prototype.Cg=function(a){this.$h.Cg(a);return this};Dt.prototype.setBaseLayer=Dt.prototype.Cg;Dt.prototype.ff=function(a){a.target.getState()===bt.DOWN?(a=this.$h,Ft(a,!0),a.hs(),a.Ha(a.Vs),a.s.addEventListener("mapviewchange",a.hs,!1,a)):Gt(this.$h)};
Dt.prototype.N=function(a,b){it.prototype.renderInternal.call(this,a,b);this.dr.B().style["float"]=this.Ee.match("right")?"right":"left";this.$h.Qa(this.map);this.dr.Ed(this.la().translate("minimap"))};Dt.prototype.renderInternal=Dt.prototype.N;Dt.prototype.disposeInternal=function(){this.$h.l();Y.prototype.disposeInternal.call(this)};
function Et(a,b,c,d){this.oa=a;this.Vs="H_overview_active";"number"===typeof b&&(this.Tx=b);"number"===typeof c&&(this.cw=c);"number"===typeof d&&(this.dw=d);$s.call(this,"div","H_overview")}u(Et,it);Et.prototype.Cg=function(a){this.ai.Cg(a)};Et.prototype.N=function(a,b){b=Us(b,"div","H_overview_map");Vs(a,b);this.Eq=b};Et.prototype.renderInternal=Et.prototype.N;Et.prototype.renderInternal=Et.prototype.N;m=Et.prototype;m.Tx=3;m.cw=5;m.dw=5;
m.Qa=function(a){this.s=a;this.ai=new V(this.Eq,this.oa,{pixelRatio:this.s.jb(),engineType:this.s.wa.type});this.ai.Xd.B().style.display="none";this.bw=this.ai.va;this.rv=this.s.va};function Gt(a){!a.jh&&Ft(a);a.Ab(a.Vs);a.s.removeEventListener("mapviewchange",a.hs,!1,a)}m.hs=function(a){a&&a.modifiers&a.SIZE&&Ft(this,!0);a=this.rv.Hb();a.zoom-=this.Tx;this.bw.$c(a)};
function Ft(a,b){var c=a.s.ra.element,d=a.B().style,e=c.offsetWidth/a.cw/10;c=c.offsetHeight/a.dw/10;var f=a.Eq.style;b?(d.width=e+"em",d.height=c+"em",f.width=e+"em",f.height=c+"em"):d.width=d.height="0em";a.ai.ra.resize()}m.disposeInternal=function(){Et.g.disposeInternal.call(this);Gt(this);this.ai.l();this.ai=this.bw=this.rv=this.s=this.oa=this.Eq=null};function Ht(a){a=a||{};var b;this.yf=!!a.vertical;this.vB=a.length||this.$x;this.yb=jb(b=a.min)?b:this.by;this.Pc=Ac(this.yb,jb(b=a.max)?b:this.ay);this.pD=E(b=a.step)?this.cy:b;this.Ei=It(this,jb(b=a.value)?b:(this.yb+this.Pc)/2);this.Qc=z(this.Qc,this);this.he=z(this.he,this);this.ln=z(this.ln,this);this.kn=z(this.kn,this);this.uk=a.pointerArea;Y.call(this,"div","H_slider"+(this.yf?"":" H_l_horizontal"))}u(Ht,Y);t("H.ui.base.Slider",Ht);m=Ht.prototype;m.Ks=1;m.by=0;m.ay=100;
m.cy=1;m.$x="16em";m.eo=function(a,b){var c=this.yf,d=c?"top":"left";if(!this.Ka||b)a=cd(a,this.yb,this.Pc),this.Lh&&(b=100*(a-this.yb)/(this.Pc-this.yb),c=(c?-1:1)*b,this.Lh.style[d]=c+"%",this.FD.style[d]=100+c+"%"),this.Ei=It(this,a);return this.Ei};Ht.prototype.setValue=Ht.prototype.eo;Ht.prototype.RA=function(){return this.Ei};Ht.prototype.getValue=Ht.prototype.RA;m=Ht.prototype;
m.Xk=function(){if(!this.iq){Xs(this.B(),"start",this.Qc);var a=this.uk;Xs(a,"move",this.he);Xs(a,"end",this.ln);Xs(a,"out",this.kn);this.iq=!0}};m.Ai=function(){if(this.iq){Ys(this.B(),"start",this.Qc);var a=this.uk;Ys(a,"move",this.he);Ys(a,"end",this.ln);Ys(a,"out",this.kn);this.iq=!1}};function It(a,b){var c=a.pD;b=cd(b,a.yb,a.Pc);return c?a.yb+Bc((b-a.yb)/c)*c:b}
function Jt(a,b){var c=a.Ix,d=a.yf;a.Hx||(a.Hx=c["offset"+(d?"Height":"Width")]);b-=Fs(c)[d?"y":"x"];0>b&&(b=0);b=(a.Pc-a.yb)*b/a.Hx;b=It(a,d?a.Pc-b:a.yb+b);a.Ei!==b&&(a.eo(b,!0),a.dispatchEvent(new kg(a.j.zf,b,a.Ei)))}function Kt(a,b){return(b.touches?b.targetTouches[0]:b)["page"+(a.yf?"Y":"X")]}function Lt(a,b){var c=!1,d=a.type;-1!==d.indexOf("pointer")||-1!==d.indexOf("touch")?c=!0:B(a,MouseEvent)&&(c=a.which===b||a.buttons===b);return c}
function Mt(a){var b=a.touches;return b&&1===b.length||B(a,MouseEvent)}m.Qc=function(a){var b=this.yf;if(Lt(a,this.Ks)&&Mt(a)){var c=Kt(this,a);var d=a.target;d===this.Lh||d.parentElement===this.Lh?(this.pB=c-Fs(this.Lh)[b?"y":"x"]-this.Lh.offsetWidth/2,this.B().className="H_slider H_slider_active"+(this.yf?"":" H_l_horizontal"),this.Ka=!0):Jt(this,c);a.preventDefault()}};m.ln=function(){this.Ka&&(this.B().className="H_slider "+(this.yf?"":" H_l_horizontal"),this.Ka=!1)};
m.kn=function(a){this.Ka&&a.target===this.uk&&(this.Ka=!1)};m.he=function(a){this.Ka&&Mt(a)&&(Lt(a,this.Ks)?(Jt(this,Kt(this,a)-this.pB),a.preventDefault()):this.Ka=!1)};m.j={zf:"change"};
m.N=function(a,b){var c=Us(b,"div","H_slider_cont"),d=Us(b,"div","H_slider_knob_cont"),e=Us(b,"div","H_slider_knob"),f=Us(b,"div","H_slider_knob_halo"),g=Us(b,"div","H_slider_track");b=Us(b,"div","H_slider_track H_slider_track_active");a.appendChild(c);c.appendChild(g);g.appendChild(b);c.appendChild(d);d.appendChild(e);d.appendChild(f);this.Ix=g;this.FD=b;this.Lh=d;this.uk||(this.uk=a.ownerDocument.body);c.style[this.yf?"height":"width"]=this.vB;this.eo(this.Ei);
this.Xk()};Ht.prototype.renderInternal=Ht.prototype.N;Ht.prototype.disposeInternal=function(){this.Ai()};Ht.prototype.za=function(a,b){a?this.Ai():this.Ix&&this.Xk();return Y.prototype.za.call(this,a,b)};Ht.prototype.setDisabled=Ht.prototype.za;var Nt={"in":'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><path d="m5 10.6h5.6v-5.6h2.8v5.6h5.6v2.8h-5.6v5.6h-2.8v-5.6h-5.6v-2.8z"></path></g></svg>',out:'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><path d="m5 10.6h14v2.8h-14z"/></svg>'};function Ot(a){a=a||{};var b=a.slider;it.call(this);this.qn=z(this.qn,this);this.rl=z(this.rl,this);this.Id=z(this.Id,this);b&&(this.Xq=z(this.Xq,this),this.Cu=b,this.oD=a.sliderSnaps,this.Ha("H_zoom_slider"));this.ul=new at({label:Nt["in"],onStateChange:this.qn});this.uo=new at({label:Nt.out,onStateChange:this.qn});this.Ha("H_zoom");this.Ha("H_grp");this.qz=!1!==a.fractionalZoom;this.setZoomSpeed(a.zoomSpeed||4);this.Zc(a.alignment||"right-middle")}u(Ot,it);
t("H.ui.ZoomControl",Ot);Ot.prototype.XA=function(){return this.Ux};Ot.prototype.getZoomSpeed=Ot.prototype.XA;Ot.prototype.kD=function(a){this.Ux=a};Ot.prototype.setZoomSpeed=Ot.prototype.kD;Ot.prototype.Qa=function(a){this.map!==a&&(this.map&&this.map.removeEventListener("mapviewchange",this.rl),Pt(this));it.prototype.Qa.apply(this,arguments);this.map&&(this.Id(),a.addEventListener("mapviewchange",this.rl),a.addEventListener("baselayerchange",this.Id))};Ot.prototype.setMap=Ot.prototype.Qa;
Ot.prototype.disposeInternal=function(){it.prototype.disposeInternal.apply(this,arguments);this.map.removeEventListener("baselayerchange",this.Id);Pt(this)};Ot.prototype.N=function(a,b){it.prototype.renderInternal.call(this,a,b);this.ul.Ed(this.la().translate("zoom.in"));this.uo.Ed(this.la().translate("zoom.out"))};Ot.prototype.renderInternal=Ot.prototype.N;Ot.prototype.Zc=function(a){var b=this.Ee;it.prototype.Zc.call(this,a);b!==a&&this.Id();return this};Ot.prototype.setAlignment=Ot.prototype.Zc;
Ot.prototype.rl=function(){var a=this.map,b=a.Tb(),c=a.jb()-1;a=a.oa||a.wa.getCapabilities().lookAt.zoom;this.Cu&&this.vi.eo(b);this.tb||(this.ul.za(b+c>=a.max),this.uo.za(b<=a.min))};Ot.prototype.za=function(a,b){Ot.g.za.call(this,a,b);this.rl();return this};Ot.prototype.setDisabled=Ot.prototype.za;function Pt(a){a.removeChild(a.vi);a.vi=null;a.oa&&(a.oa.removeEventListener("minchange",a.Id),a.oa.removeEventListener("maxchange",a.Id),a.oa=null)}
Ot.prototype.qn=function(a){a=a.target;var b=a===this.ul?1:-1,c=0<b?Math.ceil:Math.floor,d=this.map,e,f=this;d&&("down"===a.getState()?(d.va.startControl(),d.va.control(0,0,b*this.Ux,0,0,0)):d.va.endControl(!0,function(g){e=f.qz?g.zoom:c(g.zoom);g.zoom=e}))};Ot.prototype.Xq=function(a){this.map&&this.map.Wk(a.newValue)};
Ot.prototype.Id=function(){var a=this.Ee,b=this.kc();if(/^top/g.test(a)||/^bottom/g.test(a)){var c=this.uo;a=this.ul;var d=!1}else c=this.ul,a=this.uo,d=!0;this.removeChild(c);this.removeChild(a);this.Ra(c);if(this.Cu&&b){Pt(this);b=d;var e=(d=(c=this.map)&&c.oa)||c.wa.getCapabilities().lookAt.zoom;if(this.oa=d)d.addEventListener("minchange",this.Id),d.addEventListener("maxchange",this.Id);this.vi=new Ht({step:this.oD?1:0,vertical:b,min:e.min,max:e.max,value:c.Tb(),pointerArea:c.B()});this.vi.addEventListener(this.vi.j.zf,
this.Xq);this.Ra(this.vi)}this.Ra(a)};function Qt(a){B(a,vc,Qt,1);Y.call(this,"div","H_context_menu_item");this.Jb=a;this.mk=z(this.mk,this);this.Ce=z(this.Ce,this);this.Jb.addEventListener("update",this.Ce)}u(Qt,Y);t("H.ui.context.Item",Qt);Qt.prototype.mk=function(a){var b=this.Jb,c=b.callback;c&&!b.isDisabled()&&(this.dispatchEvent("click"),c(a))};Qt.prototype.N=function(){var a=this,b=this.B();Xs(b,"click",this.mk);Xs(b,"keyup",function(c){"Enter"===c.code.code&&a.mk(c)});this.tf(-1);this.Ce()};
Qt.prototype.renderInternal=Qt.prototype.N;Qt.prototype.Ce=function(){var a=this.B(),b=this.Jb;b.callback?this.Ha("H_clickable"):this.Ab("H_clickable");b.isDisabled()?this.Ha("H_disabled"):this.Ab("H_disabled");b=b.getLabel();Ms.textContent=b;a.innerHTML=Ms.innerHTML.split("\n").join("<br/>")};Qt.prototype.disposeInternal=function(){Y.prototype.disposeInternal.call(this);this.Jb.removeEventListener("update",this.Ce)};var Rt={};Rt=function(a,b,c){yb.call(this);this.qh=-1;this.G=a;this.Om=b;this.Lv=c;this.ie=z(this.ie,this);a.focus();Xs(a,"keydown",this.ie)};u(Rt,yb);Rt.prototype.disposeInternal=function(){this.qh=-1;this.Kx();Rt.g.disposeInternal.call(this);Ys(this.G,"keydown",this.ie);var a=this.Lv;this.G=this.Om=this.Lv=null;a()};
Rt.prototype.ie=function(a){if(a instanceof KeyboardEvent){var b=this.Om.length-1,c=/^Arrow(Down|Up)$/.exec(a.code);if(c){if(a={Up:-1,Down:1}[c[1]])this.qh=0>this.qh&&0>a?b:cd(this.qh+a,0,b),this.Kx()}else"Enter"===a.code?(b=this.Om[this.qh],b instanceof at?(b.Ib()instanceof dt?b.F(bt.DOWN):b.Bx(),this.l()):b instanceof Qt&&(b.mk(),this.l())):"Escape"===a.code&&this.l()}};Rt.prototype.Kx=function(){var a=this;this.Om.forEach(function(b,c){c===a.qh?b.Ha("H_focused"):b.Ab("H_focused")})};function St(a){a=a||{};it.call(this);this.be=new ft;this.se=this.se.bind(this);this.Ec=this.Ec.bind(this);this.Qc=this.Qc.bind(this);this.vm=this.vm.bind(this);this.Zc(a.alignment||"bottom-right");Tt(this,a.baseLayers,a.layers)}u(St,it);t("H.ui.MapSettingsControl",St);function Ut(a,b){var c=[];a.concat(b).forEach(function(d){c=c.concat(d.layer)});return c}function Vt(a,b,c){var d=a.kc();if(d){a=Ut(a.Ge,a.$f);var e=Ut(b,c);a.forEach(function(f){e.includes(f)||d.hi(f)})}}
function Tt(a,b,c){Vt(a,b,c);a.uq=NaN;a.Ge=fb(b)?b:[];a.$f=fb(c)?c:[];a.Af&&(a.Af.ia(),a.dk.ia(),Wt(a))}St.prototype.subscribe=function(){var a=this.kc();if(a){var b=this.Ib();b&&(b=b.B())&&Xb(b,"pointerdown",this.Qc);Xb(a,"pointerdown",this.Qc);a=a.O;Xb(a,"add",this.se);Xb(a,"remove",this.se);Xb(a,"set",this.se)}};St.prototype.Qc=function(a){this.be.getState()===gt.OPEN&&(a.currentTarget!==this.kc()&&this.be.B().contains(a.target)||this.Ec())};
St.prototype.unsubscribe=function(){var a=this.kc();if(a){var b=this.Ib();b&&(b=b.B())&&ec(b,"pointerdown",this.Qc);ec(a,"pointerdown",this.Qc);a=a.O;ec(a,"add",this.se);ec(a,"remove",this.se);ec(a,"set",this.se)}};
St.prototype.N=function(a,b){var c=this.la().translate("layers.choose");it.prototype.renderInternal.call(this,a,b);this.subscribe();this.sc=new ct({tooltip:c,label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.7,14.6 L4.5,16 L12,20.6 L19.5,16 L17.3,14.6 L19.1,13.5 L23,16 L12,23 L1,16 L4.9,13.5 L6.7,14.6 Z M12,2 L23,9 L12,16 L1,9 L12,2 Z"></path></svg>',onStateChange:z(function(e){var f=this;e.target.getState()===bt.DOWN?(this.be.F(gt.OPEN),
this.be.kw(this),this.Zj=new Rt(this.B().ownerDocument.body,this.Af.Dj().concat(this.dk.Ej()),function(){f.sc.F(bt.UP);f.sc.B().blur()})):globalThis.setTimeout(function(){f.be.F(gt.CLOSED);f.Zj.l()})},this)});this.Af=new dt({title:c,onActiveButtonChange:function(){var e=this.uq;a:{var f=this.Af.Dj();for(var g=f.length;g--;)if(f[g].getState()===bt.DOWN){f=f[g];break a}f=null}f=f.getData();f=this.Ge[f].layer;g=fb(f);this.map.Cg(g?f[0]:f);if(e=this.Ge[e])if(e=e.layer,fb(e))for(var h=e.length;1<h--;)this.map.hi(e[h]);
if(g)for(e=f.length;1<e--;)this.map.Cl(f[e],1);Xt(this,f);this.vm();this.Ec()}.bind(this)});this.dk=new $s("div","H_grp");this.zu=new Y("div","H_separator");this.Ra(this.sc);this.Ra(this.be);this.be.Ra(this.Af);this.be.Ra(this.zu);this.be.Ra(this.dk);Wt(this);var d=this;Xs(this.sc.B(),"focus",function(){d.sc.F(bt.DOWN)});Xs(this.sc.B(),"blur",function(){d.Ec()})};St.prototype.renderInternal=St.prototype.N;
function Xt(a,b){if(a.map.wa.type===ym){var c=H.map.render.harp.Style;b=[].concat(b);for(var d=0;!f&&d<b.length;d++){var e=b[d].D;if(e.Wc()&&e.K){e=e.K();var f=e.getConfig()||e.getUrl()}}if(f){var g=function(h){h=h.D;h.Wc()&&h.K&&h.K()instanceof c&&h.Bb(new c(f))};a.$f.forEach(function(h){h=h.layer;fb(h)?h.forEach(g):h&&g(h)})}}}
function Wt(a){var b=a.la();a.Ge.forEach(function(c,d){var e=c.layer;c=new ct({tooltip:c.tooltip,label:Yt(b,c.label),data:d,disabled:!e||fb(e)&&!e.length});c.tf(-1);this.Af.Ao(c)},a);a.$f.forEach(function(c,d){var e=c.layer;c=new ct({tooltip:c.tooltip,label:Yt(b,c.label),onStateChange:this.fC.bind(this,c.layer),data:d,disabled:!e||fb(e)&&!e.length});c.tf(-1);this.dk.Ra(c)},a);a.zu.Yb(!(!a.$f.length||!a.Ge.length));globalThis.setTimeout(function(){this.map&&(this.se(),this.sc.za(!(this.Ge&&this.Ge.length||
this.$f&&this.$f.length)))}.bind(a))}St.prototype.se=function(){var a=this.map.oa,b=this.map.O;this.uq=NaN;this.Ge.forEach(function(c,d){c=c.layer;c=a===(fb(c)?c[0]:c);this.Af.Dj()[d].F(bt[c?"DOWN":"UP"],!0);c&&(this.uq=d)},this);this.$f.forEach(function(c,d){c=c.layer;var e=fb(c);d=this.dk.Ej()[d];!c||e&&!c.length?d.za(!0):d.F(bt[-1!==b.indexOf(e?c[0]:c)?"DOWN":"UP"],!0)},this)};
St.prototype.fC=function(a,b){a=fb(a)?a:[a];b=b.target.getState()===bt.DOWN;for(var c=0;c<a.length;c++)b?this.map.Cl(a[c]):this.map.hi(a[c]);this.vm();this.Ec()};St.prototype.vm=function(){var a=Zt(this);a&&(a.xo.D.K().gk(a.D.K().Qd()),this.map.hi(a),a.l(),delete a.xo);$t(this)&&au(this,this.map.oa)};
function au(a,b){var c=window.H.service&&window.H.service.omv.Provider,d=b.D;if(c&&b.D instanceof c&&d.K().wj){var e=d.K(),f=function(){var g=bu.ground.filter(function(l){return!!e.Pp("layers."+l)}),h=bu.water.filter(function(l){return!!e.Pp("layers."+l)});if(g.concat(h).length){var k={};mf(k,e.wj(g));mf(k,e.wj(h,!1,!0));delete k.global;g=new Wf(k,e.Kc());g=d.$.md(g);g.xo=b;this.map.Cl(g)}e.removeEventListener(kf.CHANGE,f)}.bind(a);e.getState()!==hf.READY?e.addEventListener(kf.CHANGE,f):
f()}}function Zt(a){return Ds(a.map.O.Sa(),function(b){return!!b.xo})}function $t(a){a=a.map.O.Sa();var b=window.H.service&&window.H.service.traffic.flow.Provider;return!!b&&a.some(function(c){return c.D instanceof b})}var bu={water:["water.water-labels"],ground:"road_labels continent_label island_label roads.shields roads.directions truck-restriction.signs places landuse.label".split(" ")};function Yt(a,b){return/^layers?/.test(b)&&a.ym(b)?a.translate(b):b}
St.prototype.Ec=function(){this.sc.F(bt.UP);this.sc.B().blur()};St.prototype.disposeInternal=function(){St.g.disposeInternal.call(this);this.unsubscribe()};function cu(a){B(a,Array,cu,1);$s.call(this,"div","H_context_menu");this.JB=a;this.s=null;this.Ec=this.Ec.bind(this)}u(cu,$s);t("H.ui.context.Menu",cu);cu.prototype.disposeInternal=function(){cu.g.disposeInternal.call(this);this.Zj&&this.Zj.l();this.Zj=null};cu.prototype.disposeInternal=cu.prototype.disposeInternal;
cu.prototype.N=function(){$s.prototype.N.apply(this,arguments);this.JB.forEach(function(a){a===wc?a=new Y("div","H_context_menu_item_separator"):(a=new Qt(a),a.addEventListener("click",this.Ec));this.Ra(a);this.tf(0)},this);Xb(this.B(),["mousedown","touchstart","pointerdown","wheel"],function(a){a.stopPropagation()});this.Zj=new Rt(this.B(),this.Ej().filter(function(a){return a instanceof Qt?(a=a.Jb,a.callback&&!a.isDisabled()):!1}),this.Ec)};cu.prototype.renderInternal=cu.prototype.N;
cu.prototype.setPosition=function(a,b){if(this.s){var c=this.B();var d=c.offsetWidth;var e=c.offsetHeight;var f=this.s;var g=f.ra.width;f=f.ra.height;a+d>g&&a>g/2&&(a-=d);b+e>f&&b>f/2&&(b-=e);Gs(c,a,b)}};cu.prototype.setPosition=cu.prototype.setPosition;cu.prototype.Ec=function(){this.s&&this.s.dispatchEvent(new Jb("contextmenuclose",this.s))};cu.prototype.Qa=function(a){this.s=a};cu.prototype.setMap=cu.prototype.Qa;var du=[];t("H.ui.i18n.defaultLocales",du);var eu={},fu=[];function gu(a,b){eu[a]=b;-1===du.indexOf(a)&&du.push(a);fu.length?hu(a,b):fu=Object.keys(b)}function hu(a,b){for(var c=fu,d=c.length,e;d--;)if(e=c[d],!b[e])throw Error("'"+e+"' key missing in translation map for "+a);};gu("en-US",{"layers.normal":"Map view","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Public transport","layer.traffic":"Traffic conditions","layer.incidents":"Show traffic incidents","layers.choose":"Choose view",minimap:"Minimap","scale.switchToImperial":"Change to miles","scale.switchToMetric":"Change to km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom out","zoom.in":"Zoom in","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Public transport",
"traffic.MISCELLANEOUS":"Miscellaneous","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Other news","traffic.OTHER":"Other news","traffic.PLANNED_EVENT":"Planned event","traffic.ROAD_HAZARD":"Road hazard","traffic.ROAD_CLOSURE":"Roadway closed","traffic.WEATHER":"Weather","traffic.CONGESTION":"Congestion","traffic.CONSTRUCTION":"Construction","traffic.DISABLED_VEHICLE":"Disabled vehicle","traffic.LANE_RESTRICTION":"Lane restriction","traffic.from":"Start time:","traffic.until":"Estimated end time:",
"distance.measurement":"Measure distance"});gu("fr-FR",{"layers.normal":"Carte","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Transports publics","layer.traffic":"Conditions de circulation","layer.incidents":"Afficher les incidents de circulation","layers.choose":"Choisir la vue",minimap:"Minimap","scale.switchToImperial":"Passer en miles","scale.switchToMetric":"Passer en km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom arri\u00e8re","zoom.in":"Zoom avant","zoom.rectangle":"Zoom rectangle",
"traffic.MASS_TRANSIT":"Transports publics","traffic.MISCELLANEOUS":"Divers","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Autre","traffic.OTHER":"Autre","traffic.PLANNED_EVENT":"\u00c9v\u00e9nement pr\u00e9vu","traffic.ROAD_HAZARD":"Danger routier","traffic.ROAD_CLOSURE":"Chauss\u00e9e ferm\u00e9e","traffic.WEATHER":"M\u00e9t\u00e9o","traffic.CONGESTION":"Embouteillage","traffic.CONSTRUCTION":"Travaux","traffic.DISABLED_VEHICLE":"V\u00e9hicule en panne","traffic.LANE_RESTRICTION":"Restriction de voie",
"traffic.from":"Date ou heure de d\u00e9but:","traffic.until":"Date et heure de fin estim\u00e9es:","distance.measurement":"Measure distance"});gu("de-DE",{"layers.normal":"Kartenansicht","layers.satellite":"Satellit","layers.terrain":"Gel\u00e4nde","layer.transit":"\u00d6ffentliche Verkehrsmittel","layer.traffic":"Verkehrslage","layer.incidents":"Verkehrsst\u00f6rungen anzeigen","layers.choose":"Ansicht ausw\u00e4hlen",minimap:"Minimap","scale.switchToImperial":"Umrechnung in Meilen","scale.switchToMetric":"Umrechnung in Kilometer","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Verkleinern","zoom.in":"Vergr\u00f6\u00dfern",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u00d6ffentliche Verkehrsmittel","traffic.MISCELLANEOUS":"Diverse","traffic.ACCIDENT":"Unfall","traffic.OTHER_NEWS":"Anderes Ereignis","traffic.OTHER":"Anderes Ereignis","traffic.PLANNED_EVENT":"Geplantes Ereignis","traffic.ROAD_HAZARD":"Verkehrshindernis","traffic.ROAD_CLOSURE":"Fahrbahn gesperrt","traffic.WEATHER":"Wetter","traffic.CONGESTION":"Verkehrsstau","traffic.CONSTRUCTION":"Baustelle","traffic.DISABLED_VEHICLE":"Liegengebliebenes Fahrzeug",
"traffic.LANE_RESTRICTION":"Fahrstreifensperrung","traffic.from":"Beginn:","traffic.until":"Voraussichtliches Ende:","distance.measurement":"Measure distance"});gu("nl-NL",{"layers.normal":"Kaartweergave","layers.satellite":"Satelliet","layers.terrain":"Terrein","layer.transit":"Openbaar vervoer","layer.traffic":"Verkeerssituatie","layer.incidents":"Toon verkeersincidenten","layers.choose":"Weergave kiezen",minimap:"Minimap","scale.switchToImperial":"Overgaan naar mijlen","scale.switchToMetric":"Wijzigen naar km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Uitzoomen","zoom.in":"Inzoomen","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Openbaar vervoer",
"traffic.MISCELLANEOUS":"Diversen","traffic.ACCIDENT":"Ongeval","traffic.OTHER_NEWS":"Meer informatie","traffic.OTHER":"Meer informatie","traffic.PLANNED_EVENT":"Geplande afzetting","traffic.ROAD_HAZARD":"Gevaar op de weg","traffic.ROAD_CLOSURE":"Rijbaan afgesloten","traffic.WEATHER":"Weer","traffic.CONGESTION":"Verkeersopstopping","traffic.CONSTRUCTION":"Wegwerkzaamheden","traffic.DISABLED_VEHICLE":"Voertuig met pech","traffic.LANE_RESTRICTION":"Rijstrookbeperking","traffic.from":"Begintijd:","traffic.until":"Geschatte eindtijd:",
"distance.measurement":"Measure distance"});gu("pl-PL",{"layers.normal":"Widok mapy","layers.satellite":"Satelita","layers.terrain":"Teren","layer.transit":"Transport publiczny","layer.traffic":"Warunki drogowe","layer.incidents":"Poka\u017c zdarzenia drogowe","layers.choose":"Wybierz widok",minimap:"Minimap","scale.switchToImperial":"Zmie\u0144 na mile","scale.switchToMetric":"Zmie\u0144 na km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Oddal","zoom.in":"Przybli\u017c","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transport publiczny",
"traffic.MISCELLANEOUS":"Inne zdarzenie","traffic.ACCIDENT":"Wypadek","traffic.OTHER_NEWS":"Inne wiadomo\u015bci","traffic.OTHER":"Inne wiadomo\u015bci","traffic.PLANNED_EVENT":"Zdarzenie planowane","traffic.ROAD_HAZARD":"Niebezpiecze\u0144stwo na drodze","traffic.ROAD_CLOSURE":"Jezdnia zamkni\u0119ta","traffic.WEATHER":"Pogoda","traffic.CONGESTION":"Korek","traffic.CONSTRUCTION":"Budowa","traffic.DISABLED_VEHICLE":"Uszkodzony pojazd","traffic.LANE_RESTRICTION":"Ograniczenie pasa ruchu","traffic.from":"Data rozpocz\u0119cia:",
"traffic.until":"Przybli\u017cona data zako\u0144czenia:","distance.measurement":"Measure distance"});gu("fi-FI",{"layers.normal":"Karttan\u00e4kym\u00e4","layers.satellite":"Satelliitti","layers.terrain":"Maasto","layer.transit":"Julkinen liikenne","layer.traffic":"Liikenneolosuhteet","layer.incidents":"N\u00e4yt\u00e4 liikennetapahtumat","layers.choose":"Valitse n\u00e4kym\u00e4",minimap:"Minimap","scale.switchToImperial":"Vaihda maileihin","scale.switchToMetric":"Vaihda kilometreihin","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Loitonna","zoom.in":"L\u00e4henn\u00e4",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Julkinen liikenne","traffic.MISCELLANEOUS":"Erittelem\u00e4t\u00f6n syy","traffic.ACCIDENT":"Onnettomuus","traffic.OTHER_NEWS":"Muu tapahtuma","traffic.OTHER":"Muu tapahtuma","traffic.PLANNED_EVENT":"Suunniteltu tapahtuma","traffic.ROAD_HAZARD":"Vaara tiell\u00e4","traffic.ROAD_CLOSURE":"Tie suljettu","traffic.WEATHER":"S\u00e4\u00e4","traffic.CONGESTION":"Ruuhka","traffic.CONSTRUCTION":"Rakennusty\u00f6","traffic.DISABLED_VEHICLE":"Pys\u00e4htynyt ajoneuvo",
"traffic.LANE_RESTRICTION":"Kaista rajoitus","traffic.from":"Alkamisaika:","traffic.until":"Arvioitu p\u00e4\u00e4ttymisaika:","distance.measurement":"Measure distance"});gu("es-ES",{"layers.normal":"Mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transporte p\u00fablico","layer.traffic":"Estado del tr\u00e1fico","layer.incidents":"Mostrar incidentes de tr\u00e1fico","layers.choose":"Elija una vista",minimap:"Minimap","scale.switchToImperial":"Cambiar a millas","scale.switchToMetric":"Cambiar a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Alejar","zoom.in":"Acercar","zoom.rectangle":"Zoom rectangle",
"traffic.MASS_TRANSIT":"Transporte p\u00fablico","traffic.MISCELLANEOUS":"Varios","traffic.ACCIDENT":"Accidente","traffic.OTHER_NEWS":"M\u00e1s noticias","traffic.OTHER":"M\u00e1s noticias","traffic.PLANNED_EVENT":"Acto programado","traffic.ROAD_HAZARD":"Riesgo en carretera","traffic.ROAD_CLOSURE":"Carretera cerrada","traffic.WEATHER":"Tiempo","traffic.CONGESTION":"Atasco","traffic.CONSTRUCTION":"Construcci\u00f3n","traffic.DISABLED_VEHICLE":"Veh\u00edculo averiado","traffic.LANE_RESTRICTION":"Restricci\u00f3n de carril",
"traffic.from":"Inicio:","traffic.until":"Finalizaci\u00f3n estimada:","distance.measurement":"Measure distance"});gu("tr-TR",{"layers.normal":"Harita g\u00f6r\u00fcn\u00fcm\u00fc","layers.satellite":"Uydu","layers.terrain":"Arazi","layer.transit":"Toplu ula\u015f\u0131m","layer.traffic":"Trafik durumlar\u0131","layer.incidents":"Trafik olaylar\u0131n\u0131 g\u00f6ster","layers.choose":"G\u00f6r\u00fcn\u00fcm se\u00e7",minimap:"Minimap","scale.switchToImperial":"Mile d\u00f6n\u00fc\u015ft\u00fcr","scale.switchToMetric":"Kilometreye d\u00f6n\u00fc\u015ft\u00fcr","scale.km":"km","scale.m":"m","scale.mi":"mil","scale.ft":"ft",
"zoom.out":"Uzakla\u015ft\u0131r","zoom.in":"Yak\u0131nla\u015ft\u0131r","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Toplu ula\u015f\u0131m","traffic.MISCELLANEOUS":"\u00c7e\u015fitli","traffic.ACCIDENT":"Kaza","traffic.OTHER_NEWS":"Di\u011fer haberler","traffic.OTHER":"Di\u011fer haberler","traffic.PLANNED_EVENT":"Planl\u0131 etkinlik","traffic.ROAD_HAZARD":"Yol tehlikesi","traffic.ROAD_CLOSURE":"Yol kapal\u0131","traffic.WEATHER":"Hava durumu","traffic.CONGESTION":"Yo\u011funluk",
"traffic.CONSTRUCTION":"Yol \u00e7al\u0131\u015fmas\u0131","traffic.DISABLED_VEHICLE":"Ara\u00e7 ar\u0131zas\u0131","traffic.LANE_RESTRICTION":"\u015eerit k\u0131s\u0131tlamas\u0131","traffic.from":"Ba\u015flang\u0131\u00e7 zaman\u0131:","traffic.until":"Tahmini biti\u015f zaman\u0131:","distance.measurement":"Measure distance"});gu("pt-BR",{"layers.normal":"Exibi\u00e7\u00e3o do mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transporte p\u00fablico","layer.traffic":"Condi\u00e7\u00f5es do tr\u00e2nsito","layer.incidents":"Mostrar incidentes no tr\u00e2nsito","layers.choose":"Escolher exibi\u00e7\u00e3o",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"milhas","scale.ft":"p\u00e9s","zoom.out":"Menos zoom",
"zoom.in":"Mais zoom","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transporte p\u00fablico","traffic.MISCELLANEOUS":"Miscel\u00e2nea","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras not\u00edcias","traffic.OTHER":"Outras not\u00edcias","traffic.PLANNED_EVENT":"Evento planejado","traffic.ROAD_HAZARD":"Risco na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Clima","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Constru\u00e7\u00e3o","traffic.DISABLED_VEHICLE":"Ve\u00edculo incapacitado",
"traffic.LANE_RESTRICTION":"Restri\u00e7\u00e3o de pista","traffic.from":"Hora de in\u00edcio:","traffic.until":"Tempo final estimado:","distance.measurement":"Measure distance"});gu("zh-CN",{"layers.normal":"\u5730\u56fe\u89c6\u56fe","layers.satellite":"\u536b\u661f","layers.terrain":"\u5730\u5f62","layer.transit":"\u516c\u5171\u4ea4\u901a","layer.traffic":"\u4ea4\u901a\u60c5\u51b5","layer.incidents":"\u663e\u793a\u4ea4\u901a\u4e8b\u4ef6","layers.choose":"\u9009\u62e9\u89c6\u56fe",minimap:"Minimap","scale.switchToImperial":"\u5207\u6362\u4e3a\u300c\u82f1\u91cc\u300d","scale.switchToMetric":"\u5207\u6362\u4e3a\u300c\u516c\u91cc\u300d","scale.km":"\u516c\u91cc","scale.m":"\u7c73",
"scale.mi":"\u82f1\u91cc","scale.ft":"\u82f1\u5c3a","zoom.out":"\u7f29\u5c0f","zoom.in":"\u653e\u5927","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u516c\u5171\u4ea4\u901a","traffic.MISCELLANEOUS":"\u7efc\u5408\u4e8b\u4ef6","traffic.ACCIDENT":"\u4ea4\u901a\u610f\u5916","traffic.OTHER_NEWS":"\u5176\u4ed6\u65b0\u95fb","traffic.OTHER":"\u5176\u4ed6\u65b0\u95fb","traffic.PLANNED_EVENT":"\u9884\u5b9a\u4e8b\u4ef6","traffic.ROAD_HAZARD":"\u9053\u8def\u5371\u9669","traffic.ROAD_CLOSURE":"\u9053\u8def\u5df2\u5173\u95ed",
"traffic.WEATHER":"\u5929\u6c14","traffic.CONGESTION":"\u5835\u585e","traffic.CONSTRUCTION":"\u65bd\u5de5","traffic.DISABLED_VEHICLE":"\u8f66\u8f86\u629b\u951a","traffic.LANE_RESTRICTION":"\u8f66\u9053\u9650\u5236","traffic.from":"\u5f00\u59cb\u65f6\u95f4\uff1a","traffic.until":"\u9884\u8ba1\u7ed3\u675f\u65f6\u95f4\uff1a","distance.measurement":"Measure distance"});gu("ru-RU",{"layers.normal":"\u0420\u0435\u0436\u0438\u043c \u043a\u0430\u0440\u0442\u044b","layers.satellite":"\u0421\u043f\u0443\u0442\u043d\u0438\u043a\u043e\u0432\u0430\u044f","layers.terrain":"\u041c\u0435\u0441\u0442\u043d\u043e\u0441\u0442\u044c","layer.transit":"\u041e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442","layer.traffic":"\u0414\u043e\u0440\u043e\u0436\u043d\u044b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f",
"layer.incidents":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0434\u043e\u0440\u043e\u0436\u043d\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f","layers.choose":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0438\u0434",minimap:"Minimap","scale.switchToImperial":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u043b\u0438","scale.switchToMetric":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u0438\u043b\u043e\u043c\u0435\u0442\u0440\u044b",
"scale.km":"\u043a\u043c","scale.m":"\u043c","scale.mi":"\u043c\u0438\u043b\u044c","scale.ft":"\u0444\u0443\u0442","zoom.out":"\u041e\u0442\u0434\u0430\u043b\u0438\u0442\u044c","zoom.in":"\u041f\u0440\u0438\u0431\u043b\u0438\u0437\u0438\u0442\u044c","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u041e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442","traffic.MISCELLANEOUS":"\u041f\u0440\u043e\u0447\u0435\u0435 \u0414\u0422\u041f",
"traffic.ACCIDENT":"\u0414\u0422\u041f","traffic.OTHER_NEWS":"\u0414\u0440\u0443\u0433\u0438\u0435 \u043d\u043e\u0432\u043e\u0441\u0442\u0438","traffic.OTHER":"\u0414\u0440\u0443\u0433\u0438\u0435 \u043d\u043e\u0432\u043e\u0441\u0442\u0438","traffic.PLANNED_EVENT":"\u041f\u043b\u0430\u043d\u043e\u0432\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435","traffic.ROAD_HAZARD":"\u0414\u043e\u0440\u043e\u0436\u043d\u0430\u044f \u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c",
"traffic.ROAD_CLOSURE":"\u0414\u043e\u0440\u043e\u0433\u0430 \u0437\u0430\u043a\u0440\u044b\u0442\u0430","traffic.WEATHER":"\u041f\u043e\u0433\u043e\u0434\u0430","traffic.CONGESTION":"\u041f\u0440\u043e\u0431\u043a\u0430","traffic.CONSTRUCTION":"\u0420\u0435\u043c\u043e\u043d\u0442","traffic.DISABLED_VEHICLE":"\u041d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u044b\u0439 \u0430\u0432\u0442\u043e\u043c\u043e\u0431\u0438\u043b\u044c","traffic.LANE_RESTRICTION":"\u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u043e\u0441\u044b \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f",
"traffic.from":"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430:","traffic.until":"\u041e\u0436\u0438\u0434\u0430\u0435\u043c\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f:","distance.measurement":"\u0418\u0437\u043c\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0441\u0441\u0442\u043e\u044f\u043d\u0438\u0435"});gu("pt-PT",{"layers.normal":"Vista do mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transportes p\u00fablicos","layer.traffic":"Condi\u00e7\u00f5es de tr\u00e2nsito","layer.incidents":"Mostrar incidentes de tr\u00e2nsito","layers.choose":"Escolher vista",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Diminuir","zoom.in":"Aumentar",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transportes p\u00fablicos","traffic.MISCELLANEOUS":"Diversos","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras not\u00edcias","traffic.OTHER":"Outras not\u00edcias","traffic.PLANNED_EVENT":"Evento planeado","traffic.ROAD_HAZARD":"Perigo na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Meteorologia","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Constru\u00e7\u00e3o","traffic.DISABLED_VEHICLE":"Ve\u00edculo avariado",
"traffic.LANE_RESTRICTION":"Limita\u00e7\u00e3o da faixa de rodagem","traffic.from":"Hora de in\u00edcio:","traffic.until":"Hora de fim prevista:","distance.measurement":"Measure distance"});gu("it-IT",{"layers.normal":"Vista mappa","layers.satellite":"Satellite","layers.terrain":"Terreno","layer.transit":"Mezzi pubblici","layer.traffic":"Condizioni del traffico","layer.incidents":"Mostra incidenti stradali","layers.choose":"Scegli vista",minimap:"Minimap","scale.switchToImperial":"Passa a miglia","scale.switchToMetric":"Passa a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom indietro","zoom.in":"Zoom avanti","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Mezzi pubblici",
"traffic.MISCELLANEOUS":"Varie","traffic.ACCIDENT":"Incidente","traffic.OTHER_NEWS":"Altre notizie","traffic.OTHER":"Altre notizie","traffic.PLANNED_EVENT":"Evento pianificato","traffic.ROAD_HAZARD":"Strada dissestata","traffic.ROAD_CLOSURE":"Strada chiusa","traffic.WEATHER":"Maltempo","traffic.CONGESTION":"Ingorgo","traffic.CONSTRUCTION":"Lavori in corso","traffic.DISABLED_VEHICLE":"Veicolo in panne","traffic.LANE_RESTRICTION":"Restrizione di corsia","traffic.from":"Ora di inizio:","traffic.until":"Ora di fine stimata:",
"distance.measurement":"Measure distance"});function iu(a,b){if(!gb(a))throw new TypeError("string locale code required");if(ya(b))hu(a,b);else{if(-1===du.indexOf(a))throw Error("Default locale '"+a+"' does nto exist.");b=eu[a]}this.s=b||{};this.Um=a}t("H.ui.i18n.Localization",iu);iu.prototype.kA=function(){return this.Um};iu.prototype.getLocale=iu.prototype.kA;iu.prototype.dA=function(){return Object.keys(this.s)};iu.prototype.getKeys=iu.prototype.dA;iu.prototype.ym=function(a){return!(!this.s||!this.s[a])};iu.prototype.hasKey=iu.prototype.ym;
iu.prototype.translate=function(a){var b=this.s[a];if(!gb(b))throw Error("Translation missing for key '"+a+"'.");return b};iu.prototype.translate=iu.prototype.translate;function ju(a,b){b=b||{};var c=this;Y.call(this,"div","H_ib H_ib_top");this.Rv=z(function(d){c.tb||!Ts(d)&&d instanceof KeyboardEvent&&"Escape"!==d.code||(c.close(),d.preventDefault())},this);this.update=z(this.update,this);this.bm=z(this.bm,this);this.setPosition(a);this.Qk(b.content);b.onStateChange&&this.addEventListener("statechange",b.onStateChange);this.F(ku.OPEN)}u(ju,Y);t("H.ui.InfoBubble",ju);ju.prototype.s=null;ju.prototype.Aa=function(){return this.Tc};
ju.prototype.setPosition=function(a){this.Tc=Te(a);this.update()};ju.prototype.setPosition=ju.prototype.setPosition;ju.prototype.Qa=function(a){this.s=a};
ju.prototype.N=function(a,b){this.Lo=Us(b,"div","H_ib_body");this.tailEl_=Us(b,"div","H_ib_tail");this.aj=Us(b,"div","H_ib_close H_btn",'<svg version="1.1" class="H_icon" viewBox="0 0 12 12"><path d="m8.12 6 3.66-3.66c.29-.29.29-.76 0-1.05l-1.06-1.06c-.29-.29-.76-.29-1.05 0l-3.66 3.66-3.66-3.66c-.29-.29-.76-.29-1.05 0l-1.06 1.06c-.29.29-.3.76 0 1.05l3.66 3.66-3.66 3.66c-.29.29-.29.76 0 1.05l1.06 1.06c.29.29.76.29 1.05 0l3.66-3.66 3.66 3.66c.29.29.76.29 1.05 0l1.06-1.06c.29-.29.3-.76 0-1.05z"></path></svg>');this.aj.setAttribute("tabindex",
"0");this.fh=Us(b,"div","H_ib_content","&nbsp;");this.Lo.appendChild(this.aj);this.Lo.appendChild(this.fh);Xs(this.aj,"start",this.Rv);this.s.va.addEventListener("sync",this.update);this.s.ra.addEventListener("sync",this.update);a.appendChild(this.Lo);a.appendChild(this.tailEl_);this.Qk(this.Sl)};ju.prototype.renderInternal=ju.prototype.N;ju.prototype.bm=function(){this.zt||(this.zt=setTimeout(this.update,0))};
ju.prototype.update=function(){var a=this.B(),b=this.s,c,d="none";this.zt=0;if(b&&a&&this.getState()===ku.OPEN){if(c=b.La(this.Tc)){var e=c.x;c=c.y;b=b.ra.width;if(e>=-b||e<=2*b||c>=-b||c<=2*b)d="",Hs?(a.style.left=e-b+"px",a.style.top=c+"px"):Gs(a,e,c)}a.style.display=d;""===d&&(a.style.visibility="visible")}};var ku={OPEN:"open",CLOSED:"closed"};ju.State=ku;ju.prototype.o=ku.OPEN;ju.prototype.getState=function(){return this.o};ju.prototype.getState=ju.prototype.getState;
ju.prototype.F=function(a){a!==this.o&&(this.o=a,this.dispatchEvent("statechange"));if(a=this.B())this.o===ku.OPEN?(a.style.display="block",a.style.visibility="hidden",this.bm()):a.style.display="none"};ju.prototype.setState=ju.prototype.F;ju.prototype.close=function(){this.F(ku.CLOSED)};ju.prototype.close=ju.prototype.close;ju.prototype.open=function(){this.F(ku.OPEN)};ju.prototype.open=ju.prototype.open;ju.prototype.Hz=function(){return this.fh||null};ju.prototype.getContentElement=ju.prototype.Hz;
ju.prototype.Qk=function(a){if(a)if("string"===typeof a||"number"===typeof a.nodeType&&"string"===typeof a.nodeName)this.Sl=a;else throw Error("InfoBubble content must be a string or HTML node.");else this.Sl="";this.B()&&(this.Sl?(this.fh.innerHTML="","string"===typeof this.Sl?this.fh.innerHTML=a:"number"===typeof a.nodeType&&"string"===typeof a.nodeName&&this.fh.appendChild(a)):this.fh.innerHTML="&nbsp;",this.bm())};ju.prototype.setContent=ju.prototype.Qk;
ju.prototype.disposeInternal=function(){this.close();this.Qk("");this.aj&&Ys(this.aj,"end",this.Rv);this.s&&(this.s.va.removeEventListener("sync",this.update),this.s.ra.removeEventListener("sync",this.update));Y.prototype.disposeInternal.call(this)};function lu(a,b){this.wc=a;this.Cc=null;this.ik=0;this.eg=22;this.GD=b;this.fn=z(this.fn,this);this.ap=z(this.ap,this);a=this.wc.kc();a.addEventListener("mapviewchange",this.jC,!1,this);this.ub=a.wa.type;a=a.O;a.addEventListener("add",this.ig,!1,this);a.addEventListener("remove",this.jg,!1,this)}function mu(a,b,c){var d=b.D;d&&(void 0===c?0:c)&&d.removeEventListener("tap",a.fn);b?(d.addEventListener("tap",a.fn),a.ik=d.min,a.eg=d.max):(a.ik=0,a.eg=22)}m=lu.prototype;
m.jC=function(a){var b=a.newValue.zoom;this.Cc&&a.modifiers&a.ZOOM&&(b<this.ik||b>this.eg)&&this.Cc.close()};m.ig=function(a){a=a.added;nu(a)&&mu(this,a)};m.jg=function(a){a=a.removed;nu(a)&&(this.Cc&&this.Cc.close(),mu(this,a,!0))};function nu(a){return window.H.service&&(a.D instanceof window.H.service.traffic.incidents.Provider||a.D instanceof window.H.service.trafficVectorTile.Provider&&"incident"===a.D.$.Aq)}
m.fn=function(a){var b,c=this.ub===mg.HARP;a.target&&(b=a.target.getData())&&0===a.currentPointer.button&&(c?(b=this.wc.kc().Va(a.currentPointer.viewportX,a.currentPointer.viewportY),(c=a.target.getData()?a.target.getData().properties.id:null)&&this.GD.requestIncidentById(c,{locationReferencing:"none",lang:this.wc.la().Um,units:this.wc.Pb===xt.METRIC?"metric":"imperial"},this.Jx.bind(this,b),console.error)):(c=a.target.V(),this.Jx(c,b)),a.stopPropagation())};
m.Jx=function(a,b){if(this.ub===mg.HARP){b=b.incidentDetails;var c=this.wc.la().Um,d=b.type,e=d.split(/(?=[A-Z])/).join("_").toUpperCase();this.wc.la().ym("traffic."+e)&&(d=this.wc.la().translate("traffic."+e));a={position:a,title:d,description:b.description.value,startTime:(new Date(b.startTime)).toLocaleString(c).split(",").join(" "),endTime:(new Date(b.endTime)).toLocaleString(c).split(",").join(" ")}}else c=b.TRAFFIC_ITEM_TYPE_DESC.replace(" ","_"),c=this.wc.la().ym("traffic."+c)?this.wc.la().translate("traffic."+
c):b.TRAFFIC_ITEM_DESCRIPTION[b.TRAFFIC_ITEM_DESCRIPTION.length-1].value,a={position:a,title:c,description:b.TRAFFIC_ITEM_DESCRIPTION[0].value,startTime:b.START_TIME,endTime:b.END_TIME};this.ap(a)};
m.ap=function(a){var b=a.position,c=a.title,d=a.description,e=a.startTime;a=a.endTime;this.Cc||(this.Cc=new ju(b),this.Cc.Ha("H_tib"),this.wc.Ws(this.Cc));this.Cc.setPosition(b);this.Cc.Qk('<div class="H_tib_content"><div class="H_rdo_title" dir="auto">{{title}}</div><div class="H_tib_desc" dir="auto"><span>{{desc}}</span><div class="H_tib_time"><span class="H_tib_left">{{traffic.from}}</span><span class="H_tib_right">{{from}}</span><br/><span class="H_tib_left">{{traffic.until}}</span><span class="H_tib_right">{{until}}</span></div></div>'.replace("{{title}}",c).replace("{{desc}}",
d).replace("{{traffic.from}}",this.wc.la().translate("traffic.from")).replace("{{traffic.until}}",this.wc.la().translate("traffic.until")).replace("{{from}}",e).replace("{{until}}",a));this.Cc.open()};function ou(a,b){var c={},d={};c["top-left"]=Us(b,"div",[pu,qu].join(" "));c["top-center"]=Us(b,"div",[pu,ru,su,qu].join(" "));c["top-right"]=Us(b,"div",[pu,qu].join(" "));c["left-top"]=Us(b,"div",[pu,tu].join(" "));c["left-middle"]=Us(b,"div",[pu,uu,vu,tu].join(" "));c["left-bottom"]=Us(b,"div",[pu,tu].join(" "));c["right-top"]=Us(b,"div",[pu,tu].join(" "));c["right-middle"]=Us(b,"div",[pu,wu,vu,tu].join(" "));c["right-bottom"]=Us(b,"div",[pu,tu].join(" "));c["bottom-left"]=Us(b,"div",[pu,qu].join(" "));
c["bottom-center"]=Us(b,"div",[pu,xu,su,qu].join(" "));c["bottom-right"]=Us(b,"div",[pu,qu].join(" "));d["top-left"]=Us(b,"div",[ru,uu].join(" "));d["top-right"]=Us(b,"div",[ru,wu].join(" "));d["bottom-left"]=Us(b,"div",[xu,uu].join(" "));d["bottom-right"]=Us(b,"div",[xu,wu].join(" "));Vs(d["top-left"],c["top-left"],c["left-top"]);Vs(d["top-right"],c["top-right"],c["right-top"]);Vs(d["bottom-left"],c["left-bottom"],c["bottom-left"]);Vs(d["bottom-right"],c["right-bottom"],c["bottom-right"]);Vs(a,d["top-left"],
d["top-right"],d["bottom-left"],d["bottom-right"],c["top-center"],c["left-middle"],c["right-middle"],c["bottom-center"]);this.Zs=c}var ru="H_l_top",xu="H_l_bottom",uu="H_l_left",wu="H_l_right",su="H_l_center",vu="H_l_middle",qu="H_l_horizontal",tu="H_l_vertical",pu="H_l_anchor";ou.prototype.update=function(){var a=this.Zs;yu(a["top-center"],!0);yu(a["bottom-center"],!0);yu(a["left-middle"],!1);yu(a["right-middle"],!1)};
function yu(a,b){b?(b=a.offsetWidth,a.style.marginLeft=-Math.round(.5*b)+"px"):(b=a.offsetHeight,a.style.marginTop=-Math.round(.5*b)+"px")}ou.prototype.put=function(a,b){a=a?a.B():null;var c=b?this.Zs[b]:null;a&&c&&(a.parentElement&&a.parentElement.removeChild(a),c.insertBefore(a,/(bottom|right)$/.test(b)||/(center|middle)/.test(b)&&c.childNodes.length%2?c.firstChild:null));this.update()};function zu(a,b){try{return a.Im=!0,new a(b)}finally{a.Im=!1}}
function Au(a,b){var c=a.B(),d=this;G.call(this);this.s=a;this.rj=c.ownerDocument;this.Gf={};this.Ie=[];this.G=Us(this.rj,"div","H_ui");this.setDirection();this.YB=z(function(e){this.kv.put(e.target,e.target.Ee)},this);this.addEventListener("alignmentchange",this.YB);this.nC=z(function(){this.Cx()},this);this.addEventListener("toggleunitsystem",this.nC);this.G.addEventListener("contextmenu",this.pw,!1);this.G.addEventListener("MSHoldVisual",this.pw,!1);this.s.addEventListener("contextmenu",this.cn,
!1,this);this.s.addEventListener("contextmenuclose",this.Jv,!1,this);this.s.ac(this.l.bind(this));this.Md=null;this.pt=-1;this.kv=new ou(this.G,this.rj);this.Pb=xt.METRIC;Bu(this,"en-US");b&&Cu(this,b);c.appendChild(this.G);globalThis.setTimeout(function(){d.kv.update()},1)}u(Au,G);t("H.ui.UI",Au);Au.prototype.pw=function(a){for(var b=a.target;b&&!/\bH_ib_content\b/.test(b.className);)b=b.parentNode;b||a.preventDefault()};Au.prototype.B=function(){return this.G};
Au.prototype.getElement=Au.prototype.B;Au.prototype.kc=function(){return this.s};Au.prototype.getMap=Au.prototype.kc;Au.prototype.QA=function(){return this.Pb};Au.prototype.getUnitSystem=Au.prototype.QA;Au.prototype.co=function(a){var b=this.Gf,c;if(a!==this.Pb)for(c in this.Pb=a,b)if(b[c]instanceof it)b[c].onUnitSystemChange(this.Pb)};Au.prototype.setUnitSystem=Au.prototype.co;Au.prototype.setDirection=function(a){this.G.setAttribute("dir",a||getComputedStyle(this.kc().B()).direction)};
Au.prototype.setDirection=Au.prototype.setDirection;function Bu(a,b){if(gb(b))var c=b;else if(b instanceof iu){c=b.Um;var d=b}else throw Error("The locale parameter must be a string or a H.ui.i18n.Localization object.");if(c)if(d)a.Bq=d;else if(0<=du.indexOf(c))a.Bq=new iu(c);else throw Error("Locale ["+c+"] is not supported.");else throw Error("No locale was defined.");}Au.prototype.la=function(){return this.Bq};Au.prototype.Cx=function(){this.Pb===xt.METRIC?this.co(xt.IMPERIAL):this.co(xt.METRIC)};
Au.prototype.toggleUnitSystem=Au.prototype.Cx;Au.prototype.Ws=function(a){var b=this.Ie.length,c=this.G;if(0>this.Ie.indexOf(a)){a.ea(this);a.Qa(this.s);var d=a.L(this.rj);b=0<b?this.Ie[b-1].B().nextSibling:this.G.firstChild;c.insertBefore(d,b);this.Ie.push(a)}};Au.prototype.addBubble=Au.prototype.Ws;
Au.prototype.cn=function(a){var b=a.items;this.Md&&this.Jv();clearTimeout(this.pt);this.pt=globalThis.setTimeout(function(){b.length&&(this.Md=new cu(b),this.G.insertBefore(this.Md.L(this.rj),this.G.firstChild),this.Md.ea(this),this.Md.Qa(this.s),this.Md.setPosition(a.viewportX,a.viewportY))}.bind(this),0)};Au.prototype.Jv=function(){this.Md&&(this.Md.l(),this.Md=null)};Au.prototype.EC=function(a){var b=this.Ie.indexOf(a);-1<b&&(a.ea(null),a.Qa(null),this.Ie.splice(b,1),this.G.removeChild(a.B()))};
Au.prototype.removeBubble=Au.prototype.EC;Au.prototype.Dz=function(){return this.Ie};Au.prototype.getBubbles=Au.prototype.Dz;Au.prototype.Pg=function(a,b){if(this.Hj(a))throw Error("A control with name ["+a+"] is already registered.");b.ea(this);b.Qa(this.s);b.CB=this.Bq;b.L(this.rj);b.onUnitSystemChange(this.Pb);this.Gf[a]=b};Au.prototype.addControl=Au.prototype.Pg;
Au.prototype.HC=function(a){var b=this.Hj(a);if(b)b.unsubscribe(),b.ea(null),b.Qa(null),Zs(b),delete this.Gf[a];else throw Error("Control ["+a+"] not found in this UI's controls.");return b};Au.prototype.removeControl=Au.prototype.HC;Au.prototype.Hj=function(a){return this.Gf[a]};Au.prototype.getControl=Au.prototype.Hj;
Au.prototype.disposeInternal=function(){for(var a in this.Gf)Es.hasOwnProperty.call(this.Gf,a)&&this.Gf[a].l();this.Ie.forEach(function(b){b.l()});(a=this.G.parentNode)&&a.removeChild(this.G);G.prototype.disposeInternal.call(this);delete this.G};
function Cu(a,b){var c,d;b.unitSystem&&a.co(b.unitSystem);(d=b.locale)&&Bu(a,d);(c=b.zoom)&&a.Pg("zoom",new Ot(ya(c)?c:null));(c=b.zoomrectangle)&&a.Pg("zoomrectangle",new Bt(ya(c)?c:null));(c=b.mapsettings)&&a.Pg("mapsettings",new St(ya(c)?c:null));(c=b.scalebar)&&a.Pg("scalebar",new Ct(ya(c)?c:null));(c=b.distancemeasurement)&&a.Pg("distancemeasurement",new zt(ya(c)?c:null))}
Au.prototype.capture=function(a,b,c,d){var e=this.Hj("scalebar"),f=a.getContext("2d"),g=a.width,h=a.height,k=this.s.Xd,l=5+(k?k.B().childNodes[1].offsetHeight:0);e&&e.Vd()?e.capture(b,function(n){f.drawImage(n,g-n.width-5*b,h-n.height-l*b);c(a)},d):c(a)};Au.prototype.capture=Au.prototype.capture;
Au.createDefault=function(a,b,c){var d=a.wa.type;c=new Au(a,{unitSystem:xt.METRIC,zoom:{alignment:"right-bottom"},mapsettings:Du(d,b,a.oa),scalebar:{alignment:"bottom-right"},locale:c||"en-US"});if(d===mg.P2D){var e=c.Hj("mapsettings");var f=function(){if(e.kc()){var l=Du(d,b,a.oa);Tt(e,l.baseLayers,l.layers)}};a.addEventListener(a.j.yl,f);c.ac(function(){a.removeEventListener(a.j.yl,f)});e.ac(function(){a.removeEventListener(a.j.yl,f)})}if(d===mg.HARP){if(window.H.service){var g=b.vector.traffic.map.D.$.i(),
h=new window.H.service.Url(g.oi,g.Rj.split(".").slice(-2).join("."));h=zu(window.H.service.traffic.Service7,{platformBaseUrl:h});var k=h.i().getQuery();k.apikey=g.getQuery().apikey;h.i().Uk(k);new lu(c,h)}}else new lu(c);return c};Au.prototype.iD=function(){};Au.prototype.setTrafficIncidentsHandle=Au.prototype.iD;function Eu(a,b,c,d){for(var e=a,f=0;e&&f<b.length;f++)e=e[b[f]];if(e&&e!==a)return a={label:c,layer:e},d.push(a),a}
function Du(a,b,c){var d=[],e=[],f=b.raster;if(a===mg.P2D&&f){Eu(b,["raster","normal","map"],"layers.normal",d);Eu(b,["raster","satellite","map"],"layers.satellite",d);Eu(b,["raster","terrain","map"],"layers.terrain",d);if(c)for(var g in f)if(f[g]&&f[g].map===c){var h=g;break}Eu(b,["raster","normal","trafficincidents"],"layer.incidents",e);Eu(b,["raster",h,"transit"],"layer.transit",e)}else Eu(b,["vector","normal","map"],"layers.normal",d),a===mg.WEBGL?(e.push({label:"layers.satellite",tooltip:"Disabled with WEBGL engine"}),
e.push({label:"layer.traffic",tooltip:"Disabled with WEBGL engine"}),e.push({label:"layer.incidents",tooltip:"Disabled with WEBGL engine"})):(c=Eu(b,["hybrid","day","vector"],"",[]),f=Eu(b,["hybrid","day","raster"],"layers.satellite",d),f.layer=[f.layer,c.layer],window.H.service&&(c=b.vector.traffic.map.D.$.i(),b=zu(window.H.service.trafficVectorTile.Service,{baseUrl:c,layer:"flow"}),c=zu(window.H.service.trafficVectorTile.Service,{baseUrl:c,layer:"incident"}),h=qn()+"/harp/oslo/normal.day.json",
f=new H.map.render.harp.Style(h),h=new H.map.render.harp.Style(h),b=b.createLayer(f,{engineType:a}),a=c.createLayer(h,{engineType:a}),e.push({label:"layer.traffic",layer:b},{label:"layer.incidents",layer:a})));return{alignment:"bottom-right",baseLayers:d,layers:e}};t("H.ui.buildInfo",function(){return Cm("H-ui","1.63.0","d08e47f",{region:"row"})});

function Fu(a,b){this.Xm=[];Fu.g.constructor.apply(this,arguments)}u(Fu,nl);m=Fu.prototype;m.Vt=function(){return this.xb.pe.apply(this.xb,arguments)};m.L=function(a,b,c,d,e,f,g){this.Xm=[];return Fu.g.L.apply(this,arguments)};m.na=1;m.Jw=function(a,b,c,d,e,f){var g=this.na=d.jb();e*=g;f*=g;var h=c.lc();b=h.w*g;h=h.h*g;var k=c.Cb;this.Od?(e-=k.x*g,f-=k.y*g):(e=Bc(e-k.x*g),f=Bc(f-k.y*g));d.Qe(c.Se(),e,f,b,h);a.detail?a.detail.set(e,f,e+b,f+h):a.detail=new bf(e,f,e+b,f+h);this.Xm.push(a)};
m.Ma=function(a,b,c){for(var d=this.Xm,e=d.length,f,g,h,k=pe,l=this.na;e--&&!(f=d[e],g=f.detail,g.Rl(a,b)&&(f=f.tv,(!(h=f.jc().Bm)||h.Cm((a-g.left)/l,(b-g.top)/l,0))&&0>k.indexOf(f)&&(k===pe&&(k=[]),k.push(f),c))););return k};m.Eh=function(){return"2d"};m.disposeInternal=function(){this.Xm=[];Fu.g.disposeInternal.call(this)};Fu.prototype.disposeInternal=Fu.prototype.disposeInternal;function Gu(a,b){b=b||{};B(a,oj,Gu,0);Gu.g.constructor.call(this,a);this.Od=!!b.Od;this.xC=b.zb||0;this.vn=[];this.aw={}}u(Gu,ml);
Gu.prototype.L=function(a,b,c,d,e,f){var g,h=this.xb,k;d-=this.xC;this.vn.length=0;var l=this.aw;this.aw=g={};if(d>=h.min&&d<=h.max){var n=h.wg(a,d,e,f);var p=n.overlays;if(a=p.length)for(p.sort(Ge),d=this.Ob,e=this.Od,f=0;f<a;f++){h=p[f];var q=h.C();var r=c.Fb(q.Nc());var v=c.Fb(q.Lc());q=c.w;r.x>=v.x&&(r.x-=q);q*=-((r.x+v.x)/q>>1);r.x+=q;r.add(b);v.x+=q;v.add(b);e||(r.round(),v.round());(q=l[k=h.wb()])?delete l[k]:q={tC:h};g[k]=q;var w=r.x;r=r.y;var y=v.x;v=v.y;var D=y-w;var F=v-r;d.Dd(h.Ue());
d.Qe(h.Se(),w,r,D,F);q.details?q.details.set(w,r,y,v):q.details=new bf(w,r,y,v);this.vn.push(q)}}return!n||n.requested&&n.requested===n.total||!n.requested&&p.length===n.total?Ai.DONE:Ai.PENDING};Gu.prototype.Ma=function(a,b,c){for(var d=this.vn,e=d.length,f,g,h;e--;)if(f=d[e],g=f.details,g.Rl(a,b))if(f=f.tC,h)h.push(f);else if(h=[f],c)break;return h||pe};Gu.prototype.Eh=function(){return"2d"};Gu.prototype.disposeInternal=function(){delete this.vn;Gu.g.disposeInternal.call(this)};
Gu.prototype.disposeInternal=Gu.prototype.disposeInternal;var Hu={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:0},incline:{min:0,max:0},heading:{min:180,max:180}},interaction:{ZOOM:Wk.ZOOM,COORD:Wk.COORD},capture:!0};t("H.map.render.p2d.capabilities",Hu);function Iu(a,b){if(!a)throw new C(Iu,0,a);Iu.g.constructor.call(this,a);this.jw={};this.uj=!(!b||!b.Od);this.Sj=Ju++}u(Iu,ml);var Ju=0;
Iu.prototype.L=function(a,b,c,d,e,f){var g=Bc(d),h=this.xb,k=g+(c.exp-h.pixelProjection.exp),l=h.min,n=h.max;d=h.tileSize;var p=h.D.Rc,q=this.Ob,r=q.Ue();var v=q.lc().w;var w=c.w,y=c.x,D=c.y,F={};if(g<l||g>n)return Ai.DONE;e=h.requestTiles(a,k,e,f,this.Sj);a=e.total;e=e.tiles;f=e.length;this.le=c;this.$C=b;this.us=k;r!==p&&q.Dd(p);c=d=d*w/(Hc(2,k)*d);this.uj||(d%1&&(d=Cc(d),w=c/d,y/=w,D/=w,w=Hc(2,k)*d),y=Cc(y),D=Cc(D));this.MC=c;k=-d;g=v+d;for(h=0;h<f;h++){v=e[h];if((l=v.data)&&l.tagName){c=b.x-(y-
v.x*d);p=b.y-(D-v.y*d);q.Qe(l,c,p,d,d);for(r=c;(r-=w)>k;)q.Qe(l,r,p,d,d);for(r=c;(r+=w)<g;)q.Qe(l,r,p,d,d)}F[this.us+"_"+v.x+"_"+v.y]=v}this.jw=F;return f===a?Ai.DONE:Ai.PENDING};Iu.prototype.Ma=function(a,b,c){var d=this.MC,e=d/this.xb.tileSize,f=this.le,g=this.$C,h;if(ab(this.us)&&f){a=f.x+(a-g.x);b=f.y+(b-g.y);var k=Cc(f.w/d);var l=f=Cc(a/d);g=Cc(b/d);Ec(l)>=k&&(l%=k);0>l&&(l=k+l);(k=this.jw[this.us+"_"+l+"_"+g])&&k.Ma&&(h=k.Ma((a-d*f)/e,(b-d*g)/e,c))}return h||pe};Iu.prototype.Eh=function(){return"2d"};function Z(a,b,c,d){Z.g.constructor.call(this,a,b,c,d);this.Wb=new L(0,0);if(c=d.renderBaseBackground)this.Iw=c.lower,this.Hw=c.higher;this.uj=!!d.enableSubpixelRendering;this.Kg=Ku;this.hv=0;this.vs=this.av=!1;this.ma=new Nl;this.T=d=new Xl;this.fg=z(this.fg,this);d.addEventListener(d.j.yo,this.fg);this.La=z(this.La,this);d=a.element;this.qc=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);this.dl=
new Jl(this.qc,this.ja);this.Fe=[];this.fq();this.vg=z(Z.prototype.vg,this);this.o=Lu;this.Sn();this.zoom=Mu(this,this.De.Tb()+this.zb);this.zc();Nu(this,b.Hb().position,this.zoom);this.pb();this.mg()}u(Z,Tk);t("H.map.render.p2d.RenderEngine",Z);Z.prototype.type=bl.P2D;var Lu=2;Z.prototype.getState=function(){return this.o};Z.prototype.getState=Z.prototype.getState;Z.prototype.Fj=function(a,b){a=b-a;return Ec(a)<this.pixelProjection.w/2?a:a-this.pixelProjection.w*b/Ec(b)};
Z.prototype.ar=function(a){var b=this,c=a.animate,d=a.newValue,e=a.modifiers;a=d.position;var f=d.bounds,g,h=this.zoom,k=this.wd,l=0;e&Oj.POSITION&&(g=b.pixelProjection.Fb(a));if(e&Oj.BOUNDS)d=Ou(this,f.C(),e&Oj.ZOOM?d.zoom:A,e&Oj.POSITION?a:A),this.De.$c(d,c);else{e&Oj.POSITION||(g=b.pixelProjection.Fb(d.position));var n=g.x;var p=g.y;this.Jg();this.Wb.set(0,0);d=this.Fo(d);var q=d.zoom;var r=d.position;if(c){var v=q-h;var w={x:k.x,y:k.y};c=this.pixelProjection.bi(w).x;var y=this.pixelProjection.projection.Re(a);
if(y.x!==this.wd.x||y.y!==this.wd.y||q!==this.zoom)n=this.Fj(c,n),this.ad(function(D){var F=D-l;if(q!==h){g=b.pixelProjection.bi(y);var O=b.pixelProjection.bi(w);n=b.Fj(O.x,g.x);p=g.y-O.y}l=D;b.Sg(n*F,p*F);h+=v*F;b.rb(h);b.pb();b.ba()},this.wl,function(){Nu(b,r,q);b.rb(q);b.pb(r);b.ba()},this.xl)}else this.bd(),Nu(this,r,q),this.rb(q),this.pb(r);this.ba()}};Z.prototype.wl=300;Z.prototype.Yn=function(a){var b=jb(a);if(!b||b&&0>a)throw new C(this.Yn,1,"positive number required");this.wl=a};
Z.prototype.setAnimationDuration=Z.prototype.Yn;Z.prototype.Ap=function(){return this.wl};Z.prototype.getAnimationDuration=Z.prototype.Ap;Z.prototype.xl=el;Z.prototype.Zn=function(a){if(!Za(a))throw new C(this.Zn,1,"function required");this.xl=a};Z.prototype.setAnimationEase=Z.prototype.Zn;Z.prototype.Bp=function(){return this.xl};Z.prototype.getAnimationEase=Z.prototype.Bp;Z.prototype.Sn=function(){this.xl=el;this.wl=300};Z.prototype.resetAnimationDefaults=Z.prototype.Sn;m=Z.prototype;
m.Uq=function(a,b,c){var d;this.ak=$i();(d=this.Zh.ka.splice(a,1)[0])&&d.l&&d.l();(d=this.Lf.ka.splice(a,1)[0])&&d.l&&d.l();(d=this.ri.ka.splice(a,1)[0])&&d.l&&d.l();(d=this.pi.ka.splice(a,1)[0])&&d.l&&d.l();this.af=this.gb.Sa();0===a&&(Xk(this,b,!1),this.zc());this.Fe=Kl(this.dl,this.Sf(),this.Pf());this.li();c||this.ba()};
m.fq=function(){var a=this.gb.Sa(),b=0,c=a.length;[this.Zh={},this.Lf={},this.ri={},this.pi={}].forEach(function(d){d.Pe=[];d.ka=[]});for(this.af=this.gb.Sa();b<c;b++)this.qk(b,a[b]);this.zc()};m.Vq=function(){this.zc();this.ba()};
m.gq=function(a,b,c){var d,e,f,g;if(b){var h={Od:this.uj,zb:this.zb};b.L?B(b,Bi)?e=new am(b):B(b,Di)&&(g=new am(b)):(b.requestOverlays&&(d=new Gu(b,h)),b.requestTiles&&(e=new Iu(b,h)),b.requestMarkers&&(f=new Fu(b,h)),b.requestDomMarkers&&(g=new ql(b,h)))}c=c||0;this.Zh.ka.splice(a,c,d);this.Lf.ka.splice(a,c,e);this.ri.ka.splice(a,c,f);this.pi.ka.splice(a,c,g);this.af=this.gb.Sa();this.Fe=Kl(this.dl,this.Sf(),this.Pf())};
m.Pf=function(){var a=[];a=a.concat(this.Lf.ka);a=a.concat(this.Zh.ka);a=a.concat(this.ri.ka);a=a.concat(this.pi.ka);return a=a.filter(ab)};m.Ro=function(){return this.o===Lu};m.Fo=function(a){var b=Yk(this,Yk(this,a.zoom)+this.zb);a=Zk(this,a);a.zoom=b;return a};function Nu(a,b,c){var d=a.pixelProjection;d.Ua(c);a.wd=d.projection.Re(b);d.x=d.w*a.wd.x;d.y=d.h*a.wd.y}m.Va=function(a,b){var c=this.Ba.center,d=this.ja;return this.pixelProjection.Ya((a-c.x)*d,(b-c.y)*d)};Z.prototype.screenToGeo=Z.prototype.Va;
Z.prototype.Wn=function(a,b){a=this.Va(a,b);b=this.De.Hb();b.position=a;return b};Z.prototype.La=function(a){var b=this.ja,c=this.Ba.center,d=c.x*b;c=c.y*b;a=this.pixelProjection.Fb(a);var e=this.pixelProjection.w;return new L(Bc((a.x-Bc(a.x/e)*e+d)/b),Bc((a.y+c)/b))};Z.prototype.geoToScreen=Z.prototype.La;Z.prototype.C=function(a,b){var c=this.sl[a||4];a=this.pixelProjection;var d=c.left-b,e=a.Ya(d,c.top-b),f=c.right+b;b=a.Ya(f,c.bottom+b);f-d>=a.w&&(e.lng=-(b.lng=180));return Bg(e,b)};
Z.prototype.Ma=function(a,b,c,d){var e=[],f=this.ja,g;a*=f;b*=f;f=[this.Zh,this.Lf,this.ri,this.pi];for(g=f.length;g--&&(!c||!e.length);)e=this.Np(e,f[g].ka,a,b,c);d(e)};Z.prototype.getObjectsAt=Z.prototype.Ma;m=Z.prototype;m.Np=function(a,b,c,d,e){for(var f=b.length,g;f--&&!((g=b[f])&&g.Ma&&(a=a.concat(g.Ma(c,d,e)),a.length&&e)););return a};m.xe=x;m.Sf=function(){var a=this.sl[2];return{w:a.right-a.left,h:a.bottom-a.top}};
m.mg=function(){var a=this.Fe.length,b;Z.g.mg.call(this);var c=this.Sf();this.Wb.set(0,0);var d=c.w;for(b=c.h;a--;){c=this.Fe[a];var e=c.lc();e.w===d&&e.h===b||c.Vk(d,b)}this.xe=new Ue(d,b);this.ba()};m.getCapabilities=function(){return Hu};Z.prototype.getCapabilities=Z.prototype.getCapabilities;m=Z.prototype;m.wq=function(){this.ne=!1;this.o=1;this.F(1);this.Mk()};
m.Mk=function(){this.ta&&this.ta.R||$i()-this.ak<this.Kg&&!this.ne?this.rh=Yi(this.vg):(this.ne&&(this.li(),this.qj(),this.F(0)),this.o=Lu)};m.li=function(){this.Zh.Pe.length=0;this.Lf.Pe.length=0;this.ri.Pe.length=0;this.pi.Pe.length=0};
m.vg=function(){var a;this.ef&&this.ef.before();var b=this.Lf.ka;var c=this.Ba.center.clone().scale(this.ja).round();var d=this.C(1,0);var e=this.C(1,Pu);var f=this.zoom;var g=f-this.zb;var h=this.pixelProjection;var k=this.Iw;var l=this.Hw;var n=b[0];b=this.Wb;var p=this.Fe.length;var q=this.af;for(a=q.length;p--;){var r=this.Fe[p];B(r,Il)&&r.clear()}if(n){if(k)for(;k;)p=f-k,n.L(d,c,h,p,!0,b),--k;if(l&&this.vs)for(r=1;r<=l&&(p=f+r,h.Ua(p),k=this.C(2,0),h.Ua(f),!n.L(k,c,h,p,!0,b));r++);}for(this.Kg=
Ku;a--;)h=q[a],B(h,vg)&&h.D&&h.D.yk(e,g);d=this.Nn(d,c,f,!1,b,Qu,this.Lf,this.Zh);c=this.Nn(e,c,g,!1,b,Ru,this.ri,this.pi);this.ne=d&&c;this.ta&&this.ta.R&&this.Ho();this.uf||(this.uf=this.De.Hb());this.uf.bounds=this.C(4,0);this.De.pb(this.uf);this.uf=null;this.xe&&(this.Ba.pb(this.xe),this.xe=x);f<this.hv?this.vs=!0:this.av&&(this.vs=!1);this.hv=f;this.av=d;this.ef&&this.ef.after();this.Mk()};
m.Nn=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments,6),k=h.length,l=h[0].ka.length,n=k*l,p=!!n,q;for(q=0;q<n;q++){if(f===Qu){var r=q%k;var v=Math.floor(q/k)}else r=Math.floor(q/l),v=q%l;var w=h[r].ka[v];r=h[r].Pe;w&&(w=w.L(a,b,this.pixelProjection,c,d,e,this.La),w===Ai.ACTIVE&&(this.Kg=Infinity),w!==Ai.DONE||r[v]||(this.qj(this.af[v]),r[v]=!0),r[v]||(p=!1))}return p};m.qj=function(a){this.dispatchEvent({type:this.j.Ss,target:a||this})};
m.disposeInternal=function(){var a=this.gb.Sa()[0],b=this.Ba;Zi(this.rh);this.bd(!0);a&&Xk(this,a,!1);this.Pf().forEach(function(c){c.l()});b.element&&b.element.removeChild(this.qc);this.qc=null;this.o=3;Z.g.disposeInternal.call(this)};m.ba=function(){this.ak=$i();this.Ro()&&this.wq()};m.Ac=function(a,b){this.Sg(a*this.ja,b*this.ja);this.Wb.set(0,0);this.pb();this.ba()};m.Sg=function(a,b){var c=this.pixelProjection,d=this.wd;c.x=ad(c.x+a,c.w);c.y=Ac(0,yc(c.w,c.y+b));d.x=c.x/c.w;d.y=c.y/c.h};
m.Ng=function(a,b,c){a=Yk(this,Yk(this,a)+this.zb);this.rb(a,b,c)};Z.prototype.zoomAt=Z.prototype.Ng;Z.prototype.rb=function(a,b,c){var d=this.ja,e=this.Ba.center;b===+b&&c===+c?(b=(b-e.x)*d,c=(c-e.y)*d,this.Wb.set(b,c),this.Sg(b,c),this.pixelProjection.Ua(a),this.Sg(-b,-c)):(this.Wb.set(0,0),this.pixelProjection.Ua(a));this.zoom=a;this.pb();this.ba()};
function Ou(a,b,c,d){var e=a.getCapabilities().lookAt.zoom.max,f=b.vb(),g=d||f;if(b.Jm()||c&&d)c=c===A?e:c;else{var h=new sg(a.pixelProjection.projection);h.Ua(e);var k=h.Fb(b.Nc()).round();var l=h.Fb(b.Lc()).round();e=h.w;b.pc()&&(k.x-=e);d?(f=h.Fb(g),b=2*Ac(f.x-k.x,l.x-f.x),k=2*Ac(f.y-k.y,l.y-f.y)):(b=l.x-k.x,k=l.y-k.y,g=f);c===A&&(f=a.sl[4],c=f.right-f.left,f=f.bottom-f.top,c=-8+yc(Fc(c/b*e)/Qc,Fc(f/k*e)/Qc)-a.zb,c=Yk(a,c))}return{zoom:Cc(c),position:g}}
Z.prototype.Jg=function(){this.bd(!0);this.T.R&&this.fc(!0);this.ma.R&&this.hc(!0);this.bd(!0)};Z.prototype.Hd=function(a,b){this.Jg();this.Sk(b);this.ma.start(a,!!b)};Z.prototype.startInteraction=Z.prototype.Hd;Z.prototype.Sk=function(a){if(a){var b={};b.xk=a.power;b.tj=a.ease;b.duration=a.duration;this.ua=b}};function Mu(a,b){return Yk(a,Yk(a,b-a.zb)+a.zb)}
Z.prototype.ud=function(a,b,c,d,e){var f=!1;this.ma.R&&(b=this.ma.store(a,b,c,d,e),this.ma.$d(Wk.COORD)&&(a=this.ma.Ah(),0<Ml(a)&&(this.Ac(-a.x,-a.y),f=!0)),b&&this.ma.$d(Wk.ZOOM)&&(a=this.ma.jm(),b=this.ma.km(),b=Fc(Hc(2,this.zoom)*b)/Qc,b!==this.zoom&&(b=Mu(this,b),this.rb(b,a.x,a.y),f=!0)),f&&this.ba())};Z.prototype.interaction=Z.prototype.ud;
Z.prototype.hc=function(a){var b=this;if(this.ma.R&&!a){if(this.ua){a=this.ma.mc();var c=this.ma.Mf();var d=this.ua.duration;var e=(this.ua.xk||1)*a;var f=new Vl(-e/(0<d?d:1),e);!E(c.x)&&!E(c.y)&&0<e&&b.ma.$d(Wk.COORD)&&this.ad(function(g){e=f.Ij(g*d);E(e)||b.Ac(Bc(-c.x*e),Bc(-c.y*e))},d,void 0,this.ua.tj)}this.ua=null;this.ma.clear()}};Z.prototype.endInteraction=Z.prototype.hc;Z.prototype.Gd=function(a,b,c){this.Jg();this.T.start(b,c);this.Sk(a)};Z.prototype.startControl=Z.prototype.Gd;
Z.prototype.control=function(a,b,c){if(E(+c))throw new C(this.control,2,c);if(E(a))throw new C(this.control,0,a);if(E(b))throw new C(this.control,1,b);this.T.R&&this.T.set(a,b,c,0,0,0)};Z.prototype.control=Z.prototype.control;
Z.prototype.fc=function(a,b){var c=this,d;if(this.T.R){this.bd(!0);var e=$i();var f=e-this.kj;if(1<=f){var g=$l(this.T);this.Ri(g,f)}if(!this.ua||a||b)"function"===typeof b&&(a=this.Hb(),a.zoom=this.zoom-this.zb,b(a),a.zoom+=this.zb,this.Io(a));else{b=this.T.mc();var h=this.T.Mf();var k=this.ua.duration;var l=(this.ua.xk||1)*b;var n=new Vl(-l/(0<k?k:1),l);!E(h.Kb)&&!E(h.Lb)&&0<l&&this.ad(function(p,q,r,v){e&&(r=v-e,e=0);l=n.Ij(p*k)*r;E(l)||((d=h.Mb*l)&&c.rb(Mu(c,c.zoom+d),c.T.Ug,c.T.Vg),c.Ac(Bc(h.Kb*
l),Bc(h.Lb*l)))},k,void 0,this.ua.tj)}this.T.reset()}};Z.prototype.endControl=Z.prototype.fc;m=Z.prototype;
m.Io=function(a){var b=this,c=this.wd,d=this.pixelProjection.projection.Re(a.position),e=this.pixelProjection.bi(d),f=e.y;e=e.x;var g=a.zoom;c=this.pixelProjection.bi(c);a=c.y;var h=c.x;c=this.zoom;var k=this.T.mc(),l=this.T.Ug,n=this.T.Vg,p=0;e=this.Fj(h,e);e-=h;f-=a;c=g-c;a=Gc(e*e+f*f+c*c);if(0!==k&&0!==a){var q=e/a;var r=f/a;var v=c/a;var w=k*k/(2*a);this.ad(function(y,D){var F;if(1!==y){y=k*D-w*D*D/2;D=y-p;if(F=v*D)F=Mu(b,b.zoom+F),b.rb(Mu(b,F),l,n);b.Ac(Bc(q*D),Bc(r*D));p=y}else b.wd=d,b.rb(Mu(b,
g),l,n),b.pb(),b.ba()},2*a/k)}};m.fg=function(a){var b=this,c=a.kt;this.Wb.set(0,0);c.Kb||c.Lb||c.Mb?(this.kj=$i(),this.ad(function(d,e,f,g){b.kj=g;b.Ri(c,f)},Number.POSITIVE_INFINITY),this.ba()):this.bd(!0)};m.Ri=function(a,b){b=b||0;a.Mb&&this.rb(Mu(this,this.zoom+a.Mb*b),this.T.atX,this.T.atY);this.Ac(a.Kb*b,a.Lb*b)};m.ad=function(a,b,c,d){this.ta&&this.ta.R&&this.ta.stop(!0);this.ta=new Wl(this,a,b,c,d);this.ta.start()};m.bd=function(a){this.ta&&this.ta.R&&this.ta.stop(a)};m.mp=function(){};
Z.prototype.enter=Z.prototype.mp;Z.prototype.rp=function(a){Vk(this.qc,a)};Z.prototype.exit=Z.prototype.rp;Z.prototype.capture=function(a,b,c,d){var e=this.qc.ownerDocument.createElement("canvas"),f=e.getContext("2d"),g=this.ja;e.width=(c-a)*g;e.height=(d-b)*g;for(c=0;c<this.Fe.length;c++)d=this.Fe[c],B(d,Il)&&f.drawImage(d.B(),-a*g,-b*g);return Ed(e)};var Ru=0,Qu=1,Ku=1E3,Pu=256;

function Su(a){var b;if(a)for(Tu={},b=a.length;b--;)Tu[a[b]]=!0;this.nx={}}var Uu,Tu={};Su.prototype.parse=function(a,b,c){var d,e,f,g,h;Uu=!1;try{c=JSON.parse(c)}catch(n){Uu=!0}if(c&&(d=c.metadata)){var k={spatials:[]};for(e in d){if(c=!Tu[e]&&(f=Vu[e]))(g=d[e])||(Uu=!0,g=void 0),c=g;if(c)for(c=g.length;c--;){var l;(l=g[c])||(Uu=!0,l=void 0);(h=l)&&f(b,a,this,e,h,k)}}}else Uu=!0;return Uu?void 0:k};Su.prototype.parse=Su.prototype.parse;
var Vu={"street labels":function(a,b,c,d,e,f){var g;(g=e.vertices)||(Uu=!0,g=void 0);if(g){var h,k=g.length,l;(l=0<k)||(Uu=!0,l=void 0);if(l)for(h=Array(k/2);k;){var n=g[--k];l=g[--k];h[k/2]=new L(l,n)}h=h?{Sc:[h]}:A;k=+e["font size"]/a.jb();g=c.nx[k];g||(Wu.lineWidth=k,g=c.nx[k]=c.gh.du(Wu));Xu(a,b,h,!1,g,e,d,f)}delete e.vertices},"city center labels":function(a,b,c,d,e,f){Xu(a,b,Yu(e,new Jh([])),!0,c.gh,e,d,f)},labels:function(a,b,c,d,e,f){var g;(g=e["bounding boxes"])||(Uu=!0,g=void 0);if(g){for(var h=
g.length,k=new Jh([]),l;h--;){var n;(n=g[h])||(Uu=!0,n=void 0);(l=n)&&Yu(l,k)}Xu(a,b,k,!0,c.gh,e,d,f)}delete e["bounding boxes"]},buildings:function(a,b,c,d,e,f){var g=e.id,h=b.Ln[g],k,l,n,p=[],q=[];(k=e)||(Uu=!0,k=void 0);if(k&&((l=k.vertices)||(Uu=!0,l=void 0),l)){var r;(r=k.polygons)||(Uu=!0,r=void 0);(n=r)&&p.push.apply(p,Zu(l,n));(k=k.outlines)||(Uu=!0,k=void 0);(n=k)&&q.push.apply(q,Zu(l,n))}n=p.length;p.push.apply(p,q);q=new Jh(p,Yc,n);(p=p.length)||(Uu=!0,p=void 0);p&&(h?(gp(h,a,[q]),f.spatials.push(h)):
(h=Xu(a,b,q,!0,c.gh,e,d,f,g),b.Y(h)))}};Vu["transit stops"]=Vu.POIs=Vu.labels;var $u=["box 2","box 1","annotation box","icon box"];function Yu(a,b){for(var c=$u.length,d,e;c--;)if(d=$u[c],e=a[d]){var f=e[0],g=e[1],h=e[2];e=e[3];b.Sc.push([new L(f,g),new L(f+h,g),new L(f+h,g+e),new L(f,g+e)]);delete a[d]}return b}
function Zu(a,b){var c=b.length,d,e,f;if(0<c)for(e=Array(c);c--;)if((d=b[c])||(Uu=!0,d=void 0),d){var g=d.length;if(0<g)for(e[c]=f=Array(g);g--;){var h=2*d[g];f[g]=new L(a[h],a[h+1])}}return e||[]}var av={};function Xu(a,b,c,d,e,f,g,h,k){av.style=e;d=new bp(b,d,k,av);c&&gp(d,a,[c]);bv(f);f.category=g;d.setData(f);h.spatials.push(d);d.ea(b);return d}Su.prototype.gh=new Q({strokeColor:"transparent",fillColor:"transparent",lineWidth:0});var Wu={};
function bv(a){var b,c=!1;switch(typeof a){case "object":if(a instanceof Array)for(b=a.length;b--;)bv(a[b])?c=!0:delete a[b];else if(a)for(b in a)bv(a[b])?c=!0:delete a[b];break;case "number":c=!0;break;default:c=!!a}return c};function cv(a,b,c){c=c||{};b=b||{};var d=c.tileType||"maptile",e=c.scheme||"normal.day";T.call(this,{min:0,max:20});!0===b.pois&&(b.pois="!F");this.Ga=b;if(!(a&&a instanceof dv))throw Error("InvalidArgument: service required");this.$=a;this.Be=z(this.Be,this);this.$.addEventListener("versionupdate",this.Be);this.kd=a.i().clone().A(d+"/"+a.Ud()+"/"+e).v(ev).v(b);this.Fg=a.Fg||null;this.na=c.pixelRatio||c.pixelratio||ae();this.tileSize=c.tileSize||256;this.tileType=d;this.scheme=e;this.ts=0;this.zd=
new Oo(new Su(c.categoryFilter));this.zd.ea(this);this.ge=z(this.ge,this);this.zd.addEventListener("update",this.ge);this.Xe=!1;T.call(this,{min:0,max:20});this.$n(new bj(c.tileCacheSize||256,z(this.je,this)))}u(cv,T);t("H.service.metaInfo.TileProvider",cv);cv.prototype.je=function(a,b){a=b.ab();for(var c=a.length,d;c--;)d=a[c],delete d.Gk[b.key],d.release();b.data&&(ro.push(b.Jn(),this.tileSize),b.Kn())};cv.prototype.ge=function(){this.dispatchEvent("update")};
cv.prototype.u=function(a,b,c,d,e){var f=this.kd.clone(),g=this.Fg,h=this.tileSize,k=this.getTileKey(a,b,c);k=this.Rb().get(k);var l;if(k&&!k.Ih()){d(ro.pop(this.tileSize),null);var n={cancel:function(){}}}else{g&&f.sa(g[(c+b+a)%g.length]);f.A(c+"/"+a+"/"+b+"/"+h+"/png8");var p=globalThis.setTimeout(function(){l=new Qf("text/plain",f.toString());l.then(function(q){d(null,q)},e)},500)}this.Xe||(oo(cv,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.Xe=!0);return n||{cancel:function(){l?
l.cancel():globalThis.clearTimeout(p)}}};cv.prototype.requestInternal=cv.prototype.u;cv.prototype.nd=function(a,b,c,d,e){var f=this.zd;var g=d||ro.pop(this.tileSize);if(d)a=this.Rb().get(this.getTileKey(a,b,c)),a.L(d);else if(d=a=new Li(this.Td(a,b,c),a,b,c,this.tileSize,this.na,c+this.ts,f),delete d.Ji,d.vl=e,a.L(g))for(e=a.ab(),g=e.length;g--;)e[g].Un();else ro.push(g,this.tileSize);return a};cv.prototype.createTileInternal=cv.prototype.nd;
cv.prototype.l=function(){this.zd.l();this.$.removeEventListener("versionupdate",this.Be);T.prototype.l.call(this)};cv.prototype.dispose=cv.prototype.l;cv.prototype.Be=function(){var a=this.$;this.kd=a.i().clone().A(this.tileType+"/"+a.Ud()+"/"+this.scheme).v(ev).v(this.Ga);this.reload(!1)};var ev={metadata:"metaonly",mgen:"2"};function dv(a){var b=this;dv.g.constructor.call(this,dv,a);var c=to(this,a);this.Fg=c.shards;(this.qb=c.ignoreTypes?null:c.type)&&this.i().sa(this.qb);this.pr={};this.dc=new Jo;setTimeout(function(){b.dispatchEvent("infoupdate");void 0!==c.version&&"newest"!==c.version||b.dispatchEvent("versionupdate")})}u(dv,so);t("H.service.metaInfo.Service",dv);dv.prototype.ya=function(){return{type:"base",version:"newest",subDomain:"maps.ls",path:"maptile/2.1",shards:["1","2","3","4"]}};dv.CONFIG_KEY="metaInfo";
dv.prototype.tu=function(){return this.qb};dv.prototype.Ud=function(){return this.ya().version};dv.prototype.getVersion=dv.prototype.Ud;dv.prototype.U=function(){return this.dc};dv.prototype.getCopyrights=dv.prototype.U;dv.prototype.Lj=oe;dv.prototype.getInfo=dv.prototype.Lj;dv.prototype.oj=function(a,b,c,d,e,f){return new cv(this,d,{tileSize:a,pixelRatio:b,categoryFilter:c,tileType:e,scheme:f})};dv.prototype.createTileProvider=dv.prototype.oj;
dv.prototype.Nd=function(a,b,c,d,e,f){return new Ei(this.oj(a,b,c,d,e,f))};dv.prototype.createTileLayer=dv.prototype.Nd;X.prototype.ku=function(a){return this.Ja(dv,a)};X.prototype.getMetaInfoService=X.prototype.ku;(function(){var a=X.prototype.createDefaultLayers;X.prototype.createDefaultLayers=function(b,c,d,e,f,g){var h=a.call(this,b,c,d,e,f,g),k={},l=this.ku();"object"===typeof b&&(g=b,b=g.tileSize,c=g.ppi,d=g.lg,e=g.lg2,f=g.style,g=g.pois);b=b||256;var n=320===c?2:1;if(0>[72,250,320,500].indexOf(+c)){if(c!==A)throw new C(this.Yl,1,c);}else k.ppi=+c;d&&(k.lg=d);e&&(k.lg2=e);f&&(k.style=f);g&&(k.pois=g);h.raster.normal.metaInfo=l.Nd(b,n,["buildings"],k);return h}})();

H.__bootstrap__="/*\n\n Copyright The Closure Library Authors.\n SPDX-License-Identifier: Apache-2.0\n*/\nvar l;function ba(a){a=[\"object\"==typeof globalThis&&globalThis,a,\"object\"==typeof window&&window,\"object\"==typeof self&&self,\"object\"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error(\"Cannot find global object\");}var ca=ba(this);function da(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}\nvar ea=\"function\"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function fa(a,b){if(b)a:{var c=ca;a=a.split(\".\");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ea(c,a,{configurable:!0,writable:!0,value:b})}}\nfa(\"Symbol\",function(a){function b(f){if(this instanceof b)throw new TypeError(\"Symbol is not a constructor\");return new c(d+(f||\"\")+\"_\"+e++,f)}function c(f,g){this.fc=f;ea(this,\"description\",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.fc};var d=\"jscomp_symbol_\"+(1E9*Math.random()>>>0)+\"_\",e=0;return b});\nfa(\"Symbol.iterator\",function(a){if(a)return a;a=Symbol(\"Symbol.iterator\");for(var b=\"Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array\".split(\" \"),c=0;c<b.length;c++){var d=ca[b[c]];\"function\"===typeof d&&\"function\"!=typeof d.prototype[a]&&ea(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ha(da(this))}})}return a});function ha(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}\nfa(\"globalThis\",function(a){return a||ca});function ka(a,b){a instanceof String&&(a+=\"\");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}fa(\"Array.prototype.keys\",function(a){return a?a:function(){return ka(this,function(b){return b})}});var la;\nif(\"function\"==typeof Object.setPrototypeOf)la=Object.setPrototypeOf;else{var ma;a:{var na={a:!0},oa={};try{oa.__proto__=na;ma=oa.a;break a}catch(a){}ma=!1}la=ma?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+\" is not extensible\");return a}:null}var pa=la;fa(\"Object.setPrototypeOf\",function(a){return a||pa});var p=this||self;\nfunction qa(a,b,c,d){a=a.split(\".\");d=d||p;a[0]in d||\"undefined\"==typeof d.execScript||d.execScript(\"var \"+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||void 0===b)d=d[e]&&d[e]!==Object.prototype[e]?d[e]:d[e]={};else if(!c&&ra(b)&&ra(d[e]))for(var f in b)b.hasOwnProperty(f)&&(d[e][f]=b[f]);else d[e]=b}function sa(){}function ta(a){var b=typeof a;return\"object\"!=b?b:a?Array.isArray(a)?\"array\":b:\"null\"}function ra(a){var b=typeof a;return\"object\"==b&&null!=a||\"function\"==b}\nfunction ua(a){return Object.prototype.hasOwnProperty.call(a,ya)&&a[ya]||(a[ya]=++za)}var ya=\"closure_uid_\"+(1E9*Math.random()>>>0),za=0;function Aa(a,b,c){return a.call.apply(a.bind,arguments)}function Ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}\nfunction Ca(a,b,c){Ca=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf(\"native code\")?Aa:Ba;return Ca.apply(null,arguments)}function Da(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function r(a,b){qa(a,b,!0,void 0)}\nfunction Fa(a,b){function c(){}c.prototype=b.prototype;a.Z=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Cd=function(d,e,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[e].apply(d,g)}};function Ga(){}r(\"H.service.extension.dataView.IColumn\",Ga);Ga.prototype.o=function(){};Ga.prototype.getCell=Ga.prototype.o;function Ha(a,b){this.Ca=a;this.qc=b}r(\"H.service.extension.dataView.ObjColumn\",Ha);Ha.prototype.o=function(a){return this.Ca.o(a,this.qc)};Ha.prototype.getCell=Ha.prototype.o;function Ia(){var a=Ja,b;for(b in a)return!1;return!0}function Ka(a){var b={},c;for(c in a)b[c]=a[c];return b}var La=\"constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Ma(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<La.length;f++)c=La[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function Na(a){if(Error.captureStackTrace)Error.captureStackTrace(this,Na);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}Fa(Na,Error);Na.prototype.name=\"CustomError\";var Oa=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(\"string\"===typeof a)return\"string\"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var Pa=Ca,Qa=String,Ra=globalThis.Object.freeze||function(a){return a},t=[].pop(),Sa=/x/.exec(\"\");function Ta(a){return Qa(a).split(\",\"!==t?\",\":\" \")}var Ua=\"prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Va(a,b,c,d){if(!(b=a instanceof b)&&c)throw new x(c,d,void 0!==t?void 0:a);return b}function Wa(a){return\"function\"==ta(a)}function Xa(a,b,c,d){var e;if(!(e=\"Array\"===Ya(a))&&b)throw new x(b,c,d!==t?d:a);return e}\nr(\"H.lang.isArray\",function(a,b,c,d){return Xa(a,b,c,d)});function $a(a){return\"string\"===typeof a}r(\"H.lang.isString\",$a);var ab=isNaN;function bb(a){return a===+a}r(\"H.lang.isNumber\",bb);r(\"H.lang.isInteger\",Number.isInteger?Number.isInteger:function(a){return\"number\"===typeof a&&0===a%1});function Ya(a){var b=Object[Ua[0]][Ua[6]].call(a).match(/^\\[object (\\w+)\\]$/);return b?b[1]:typeof a}var cb=[];0>cb.indexOf(cb)&&cb.push(cb);\nfunction db(a,b,c,d){var e=\"\",f=2>arguments.length,g;f&&(b={H:globalThis.H},c=\"\",d=cb.slice());eb(b,!0,function(h,k){try{if(g=h[k],k=fb(h,g),!(ra(g)&&g.window===g&&g.self===g||ra(g)&&0<g.nodeType&&Wa(g.cloneNode))&&ra(g)){if(g===a)return e=c+\".\"+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=db(a,g,c+\".\"+k,d)))return!0}}catch(m){}});f&&(e=e?e.substr(1).replace(\".\"+Ua[0]+\".\",\"#\"):\"~\"+(Wa(a)?gb(a)+\"()\":Ya(a)));return e}\nfunction fb(a,b){var c=[];eb(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(hb)[0]}function hb(a,b){return b.length-a.length}var ib=Object[Ua[0]][Ua[2]];function eb(a,b,c){var d;if(a){for(e in a)if((!b||ib.call(a,e))&&c(a,e,!0))return;for(d=Ua.length;d--;){var e=Ua[d];if((!b||ib.call(a,e))&&c(a,e,!1))break}}}function gb(a){return(a=/^\\s*function ([^\\( ]+)/.exec(a))?a[1]:\"anonymous\"}function jb(a,b,c){c[b]=\"#\"+b}\nfunction x(a,b,c){var d=arguments.length;b=b!==t?+b:b;if(b!==t){var e=(e=/^.*?\\(([^\\)]+)/.exec((\"\"+a).replace(/(\\/\\*([\\s\\S]*?)\\*\\/)|(\\/\\/(.*)$)/gm,\"\")))?Ta(e[1].replace(/\\s+/g,\"\")):[];e.forEach(jb);e=e[b]||\"#\"+b}var f=a?db(a):\"\";d=2<d?Qa(c):\"\";if(e||d)f+=\" (Argument \"+(e||\"\")+(d?\" \"+d:\"\")+\")\";d=Error(f);Object.setPrototypeOf(d,x.prototype);return d}Fa(x,Error);r(\"H.lang.InvalidArgumentError\",x);x.prototype.name=\"InvalidArgumentError\";\nfunction kb(a,b){var c=[];a&&c.push(db(a));1<arguments.length&&c.push(\"\"+b);c=Error(c.join(\" \"));Object.setPrototypeOf(c,kb.prototype);return c}Fa(kb,Error);r(\"H.lang.IllegalOperationError\",kb);kb.prototype.name=\"IllegalOperationError\";function y(){}r(\"H.service.extension.dataView.ITable\",y);y.prototype.nb=function(){};y.prototype.getMeta=y.prototype.nb;y.prototype.ob=function(){};y.prototype.getRowCount=y.prototype.ob;y.prototype.Ja=function(){};y.prototype.getRow=y.prototype.Ja;y.prototype.L=function(){};y.prototype.getColumnNames=y.prototype.L;y.prototype.lb=function(){};y.prototype.getColumn=y.prototype.lb;y.prototype.o=function(){};y.prototype.getCell=y.prototype.o;y.prototype.concat=function(){};y.prototype.concat=y.prototype.concat;function z(){0!=lb&&(mb[ua(this)]=this);this.na=this.na;this.G=this.G}var lb=0,mb={};z.prototype.na=!1;z.prototype.C=function(){if(!this.na&&(this.na=!0,this.K(),0!=lb)){var a=ua(this);if(0!=lb&&this.G&&0<this.G.length)throw Error(this+\" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.\");delete mb[a]}};\nz.prototype.aa=function(a,b){this.na?void 0!==b?a.call(b):a():(this.G||(this.G=[]),this.G.push(void 0!==b?Ca(a,b):a))};z.prototype.K=function(){if(this.G)for(;this.G.length;)this.G.shift()()};function nb(a,b){return-1!=a.indexOf(b)};var A;a:{var ob=p.navigator;if(ob){var pb=ob.userAgent;if(pb){A=pb;break a}}A=\"\"};function qb(a){qb[\" \"](a);return a}qb[\" \"]=sa;var rb=nb(A,\"Gecko\")&&!(nb(A.toLowerCase(),\"webkit\")&&!nb(A,\"Edge\"))&&!(nb(A,\"Trident\")||nb(A,\"MSIE\"))&&!nb(A,\"Edge\"),sb=nb(A.toLowerCase(),\"webkit\")&&!nb(A,\"Edge\");var tb=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},\"passive\",{get:function(){a=!0}});try{p.addEventListener(\"test\",sa,b),p.removeEventListener(\"test\",sa,b)}catch(c){}return a}();function B(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.xa=!1}B.prototype.stopPropagation=function(){this.xa=!0};B.prototype.preventDefault=function(){this.defaultPrevented=!0};function ub(a,b){B.call(this,a?a.type:\"\");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key=\"\";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType=\"\";this.oa=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=\nb;if(b=a.relatedTarget){if(rb){a:{try{qb(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else\"mouseover\"==c?b=a.fromElement:\"mouseout\"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.offsetX=sb||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=sb||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,\nthis.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||\"\";this.charCode=a.charCode||(\"keypress\"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType=\"string\"===typeof a.pointerType?a.pointerType:vb[a.pointerType]||\"\";this.state=a.state;this.oa=a;a.defaultPrevented&&ub.Z.preventDefault.call(this)}}\nFa(ub,B);var vb={2:\"touch\",3:\"pen\",4:\"mouse\"};ub.prototype.stopPropagation=function(){ub.Z.stopPropagation.call(this);this.oa.stopPropagation?this.oa.stopPropagation():this.oa.cancelBubble=!0};ub.prototype.preventDefault=function(){ub.Z.preventDefault.call(this);var a=this.oa;a.preventDefault?a.preventDefault():a.returnValue=!1};var wb=\"closure_listenable_\"+(1E6*Math.random()|0);var xb=0;function yb(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.La=e;this.key=++xb;this.za=this.Ga=!1}function zb(a){a.za=!0;a.listener=null;a.proxy=null;a.src=null;a.La=null};function Bb(a){this.src=a;this.m={};this.Ea=0}Bb.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.m[f];a||(a=this.m[f]=[],this.Ea++);var g=Cb(a,b,d,e);-1<g?(b=a[g],c||(b.Ga=!1)):(b=new yb(b,this.src,f,!!d,e),b.Ga=c,a.push(b));return b};Bb.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.m))return!1;var e=this.m[a];b=Cb(e,b,c,d);return-1<b?(zb(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.m[a],this.Ea--),!0):!1};\nfunction Db(a,b){var c=b.type;if(c in a.m){var d=a.m[c],e=Oa(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(zb(b),0==a.m[c].length&&(delete a.m[c],a.Ea--))}}Bb.prototype.ia=function(a){a=a&&a.toString();var b=0,c;for(c in this.m)if(!a||c==a){for(var d=this.m[c],e=0;e<d.length;e++)++b,zb(d[e]);delete this.m[c];this.Ea--}return b};Bb.prototype.mb=function(a,b,c,d){a=this.m[a.toString()];var e=-1;a&&(e=Cb(a,b,c,d));return-1<e?a[e]:null};\nfunction Cb(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.za&&f.listener==b&&f.capture==!!c&&f.La==d)return e}return-1};var Eb=\"closure_lm_\"+(1E6*Math.random()|0),Fb={},Gb=0;function Hb(a,b,c,d,e){if(d&&d.once)Ib(a,b,c,d,e);else if(Array.isArray(b))for(var f=0;f<b.length;f++)Hb(a,b[f],c,d,e);else c=Jb(c),a&&a[wb]?a.D.add(String(b),c,!1,ra(d)?!!d.capture:!!d,e):Kb(a,b,c,!1,d,e)}\nfunction Kb(a,b,c,d,e,f){if(!b)throw Error(\"Invalid event type\");var g=ra(e)?!!e.capture:!!e,h=Lb(a);h||(a[Eb]=h=new Bb(a));c=h.add(b,c,d,g,f);if(!c.proxy){d=Mb();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)tb||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Nb(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error(\"addEventListener and attachEvent are unavailable.\");Gb++}}\nfunction Mb(){function a(c){return b.call(a.src,a.listener,c)}var b=Ob;return a}function Ib(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)Ib(a,b[f],c,d,e);else c=Jb(c),a&&a[wb]?a.D.add(String(b),c,!0,ra(d)?!!d.capture:!!d,e):Kb(a,b,c,!0,d,e)}function Pb(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)Pb(a,b[f],c,d,e);else d=ra(d)?!!d.capture:!!d,c=Jb(c),a&&a[wb]?a.D.remove(String(b),c,d,e):a&&(a=Lb(a))&&(b=a.mb(b,c,d,e))&&Qb(b)}\nfunction Qb(a){if(\"number\"!==typeof a&&a&&!a.za){var b=a.src;if(b&&b[wb])Db(b.D,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(Nb(c),d):b.addListener&&b.removeListener&&b.removeListener(d);Gb--;(c=Lb(b))?(Db(c,a),0==c.Ea&&(c.src=null,b[Eb]=null)):zb(a)}}}function Nb(a){return a in Fb?Fb[a]:Fb[a]=\"on\"+a}function Ob(a,b){if(a.za)a=!0;else{b=new ub(b,this);var c=a.listener,d=a.La||a.src;a.Ga&&Qb(a);a=c.call(d,b)}return a}\nfunction Lb(a){a=a[Eb];return a instanceof Bb?a:null}var Rb=\"__closure_events_fn_\"+(1E9*Math.random()>>>0);function Jb(a){if(\"function\"===typeof a)return a;a[Rb]||(a[Rb]=function(b){return a.handleEvent(b)});return a[Rb]};r(\"H.util.Event\",B);B.prototype.stopPropagation=B.prototype.stopPropagation;B.prototype.stopPropagation=B.prototype.stopPropagation;B.prototype.CAPTURING_PHASE=1;B.prototype.CAPTURING_PHASE=B.prototype.CAPTURING_PHASE;B.prototype.AT_TARGET=2;B.prototype.AT_TARGET=B.prototype.AT_TARGET;B.prototype.BUBBLING_PHASE=3;B.prototype.BUBBLING_PHASE=B.prototype.BUBBLING_PHASE;B.prototype.eventPhase=0;B.prototype.eventPhase=B.prototype.eventPhase;function Sb(a,b,c){Sb.Z.constructor.call(this,a,c);this.message=b}Fa(Sb,B);r(\"H.util.ErrorEvent\",Sb);function Tb(){}r(\"H.util.ICancelable\",Tb);Tb.prototype.cancel=function(){};Tb.prototype.cancel=Tb.prototype.cancel;function Ub(a,b){this.$c=100;this.rc=a;this.md=b;this.Qa=0;this.Ma=null}Ub.prototype.get=function(){if(0<this.Qa){this.Qa--;var a=this.Ma;this.Ma=a.next;a.next=null}else a=this.rc();return a};Ub.prototype.put=function(a){this.md(a);this.Qa<this.$c&&(this.Qa++,a.next=this.Ma,this.Ma=a)};function Vb(){this.Ya=this.ja=null}Vb.prototype.add=function(a,b){var c=Wb.get();c.set(a,b);this.Ya?this.Ya.next=c:this.ja=c;this.Ya=c};Vb.prototype.remove=function(){var a=null;this.ja&&(a=this.ja,this.ja=this.ja.next,this.ja||(this.Ya=null),a.next=null);return a};var Wb=new Ub(function(){return new Xb},function(a){return a.reset()});function Xb(){this.next=this.scope=this.hb=null}Xb.prototype.set=function(a,b){this.hb=a;this.scope=b;this.next=null};\nXb.prototype.reset=function(){this.next=this.scope=this.hb=null};function Yb(a){p.setTimeout(function(){throw a;},0)};function Zb(){var a=document;var b=\"IFRAME\";\"application/xhtml+xml\"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)};var $b;\nfunction ac(){var a=p.MessageChannel;\"undefined\"===typeof a&&\"undefined\"!==typeof window&&window.postMessage&&window.addEventListener&&!nb(A,\"Presto\")&&(a=function(){var e=Zb();e.style.display=\"none\";document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.close();var g=\"callImmediate\"+Math.random(),h=\"file:\"==f.location.protocol?\"*\":f.location.protocol+\"//\"+f.location.host;e=Ca(function(k){if((\"*\"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},this);f.addEventListener(\"message\",e,\n!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if(\"undefined\"!==typeof a&&!nb(A,\"Trident\")&&!nb(A,\"MSIE\")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.Jb;c.Jb=null;e()}};return function(e){d.next={Jb:e};d=d.next;b.port2.postMessage(0)}}return function(e){p.setTimeout(e,0)}};function bc(a,b){cc||dc();ec||(cc(),ec=!0);fc.add(a,b)}var cc;function dc(){if(p.Promise&&p.Promise.resolve){var a=p.Promise.resolve(void 0);cc=function(){a.then(gc)}}else cc=function(){var b=gc;\"function\"!==typeof p.setImmediate||p.Window&&p.Window.prototype&&!nb(A,\"Edge\")&&p.Window.prototype.setImmediate==p.setImmediate?($b||($b=ac()),$b(b)):p.setImmediate(b)}}var ec=!1,fc=new Vb;function gc(){for(var a;a=fc.remove();){try{a.hb.call(a.scope)}catch(b){Yb(b)}Wb.put(a)}ec=!1};function hc(a){this.u=ic;this.Zb=void 0;this.ba=this.I=this.W=null;this.Ka=this.gb=!1;if(a!=sa)try{var b=this;a.call(void 0,function(c){jc(b,mc,c)},function(c){jc(b,nc,c)})}catch(c){jc(this,nc,c)}}var ic=0,mc=2,nc=3;function oc(){this.next=this.context=this.ha=this.ua=this.R=null;this.Fa=!1}oc.prototype.reset=function(){this.context=this.ha=this.ua=this.R=null;this.Fa=!1};var pc=new Ub(function(){return new oc},function(a){a.reset()});\nfunction qc(a,b,c){var d=pc.get();d.ua=a;d.ha=b;d.context=c;return d}function rc(a,b,c){sc(a,b,c,null)||bc(Da(b,a))}function tc(a){return new hc(function(b,c){var d=a.length,e=[];if(d)for(var f=function(m,n){d--;e[m]=n;0==d&&b(e)},g=function(m){c(m)},h=0,k;h<a.length;h++)k=a[h],rc(k,Da(f,h),g);else b(e)})}function uc(){var a,b,c=new hc(function(d,e){a=d;b=e});return new vc(c,a,b)}hc.prototype.then=function(a,b,c){return wc(this,\"function\"===typeof a?a:null,\"function\"===typeof b?b:null,c)};\nhc.prototype.$goog_Thenable=!0;hc.prototype.cancel=function(a){if(this.u==ic){var b=new xc(a);bc(function(){yc(this,b)},this)}};function yc(a,b){if(a.u==ic)if(a.W){var c=a.W;if(c.I){for(var d=0,e=null,f=null,g=c.I;g&&(g.Fa||(d++,g.R==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.u==ic&&1==d?yc(c,b):(f?(d=f,d.next==c.ba&&(c.ba=d),d.next=d.next.next):zc(c),Ac(c,e,nc,b)))}a.W=null}else jc(a,nc,b)}function Bc(a,b){a.I||a.u!=mc&&a.u!=nc||Cc(a);a.ba?a.ba.next=b:a.I=b;a.ba=b}\nfunction wc(a,b,c,d){var e=qc(null,null,null);e.R=new hc(function(f,g){e.ua=b?function(h){try{var k=b.call(d,h);f(k)}catch(m){g(m)}}:f;e.ha=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof xc?g(h):f(k)}catch(m){g(m)}}:g});e.R.W=a;Bc(a,e);return e.R}hc.prototype.td=function(a){this.u=ic;jc(this,mc,a)};hc.prototype.ud=function(a){this.u=ic;jc(this,nc,a)};\nfunction jc(a,b,c){a.u==ic&&(a===c&&(b=nc,c=new TypeError(\"Promise cannot resolve to itself\")),a.u=1,sc(c,a.td,a.ud,a)||(a.Zb=c,a.u=b,a.W=null,Cc(a),b!=nc||c instanceof xc||Dc(a,c)))}function sc(a,b,c,d){if(a instanceof hc)return Bc(a,qc(b||sa,c||null,d)),!0;if(a)try{var e=!!a.$goog_Thenable}catch(g){e=!1}else e=!1;if(e)return a.then(b,c,d),!0;if(ra(a))try{var f=a.then;if(\"function\"===typeof f)return Ec(a,f,b,c,d),!0}catch(g){return c.call(d,g),!0}return!1}\nfunction Ec(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Cc(a){a.gb||(a.gb=!0,bc(a.uc,a))}function zc(a){var b=null;a.I&&(b=a.I,a.I=b.next,b.next=null);a.I||(a.ba=null);return b}hc.prototype.uc=function(){for(var a;a=zc(this);)Ac(this,a,this.u,this.Zb);this.gb=!1};\nfunction Ac(a,b,c,d){if(c==nc&&b.ha&&!b.Fa)for(;a&&a.Ka;a=a.W)a.Ka=!1;if(b.R)b.R.W=null,Fc(b,c,d);else try{b.Fa?b.ua.call(b.context):Fc(b,c,d)}catch(e){Gc.call(null,e)}pc.put(b)}function Fc(a,b,c){b==mc?a.ua.call(a.context,c):a.ha&&a.ha.call(a.context,c)}function Dc(a,b){a.Ka=!0;bc(function(){a.Ka&&Gc.call(null,b)})}var Gc=Yb;function xc(a){Na.call(this,a)}Fa(xc,Na);xc.prototype.name=\"cancel\";function vc(a,b,c){this.promise=a;this.resolve=b;this.reject=c};function Hc(a,b,c){this.type=a;this.data=b;this.O=uc();this.resolve=Pa(this.resolve,this);this.reject=Pa(this.reject,this);this.priority=Ic;c!==t&&(this.priority=c);this.Gc().add(this)}var Ic=1,Jc={zd:0,Ad:Ic,yd:2};l=Hc.prototype;l.then=function(a,b,c){return this.O.promise.then(a,b,c)};l.resolve=function(a){this.state=3;this.O.resolve(a)};l.reject=function(a){this.state=5;this.O.reject(a)};l.state=0;l.cancel=function(){3>this.state&&(this.Dd(),this.Gc().remove(this),this.state=4)};\nHc.prototype.cancel=Hc.prototype.cancel;function Kc(a){var b;this.Y={};for(b in Jc)this.Y[Jc[b]]=[];this.Ba=a;this.Ba.addEventListener(\"allocatable\",Pa(this.Lb,this))}r(\"H.util.JobManager\",Kc);var Lc=Object.keys(Jc).map(function(a){return Jc[a]}).sort().reverse();Kc.prototype.add=function(a){Va(a,Hc,this.add,0);this.Y[a.priority].push(a);this.Lb()};Kc.prototype.contains=function(a){return-1<this.Y[a.priority].indexOf(a)};\nKc.prototype.remove=function(a){var b=a.priority,c=this.Y[b].indexOf(a);if(-1<c)return this.Y[b].splice(c,1),!0;a.Fb&&this.Ba.sc(a.Fb);return!1};Kc.prototype.Lb=function(){Lc.forEach(function(a){this.Y[a]=this.Y[a].filter(function(b){var c;if((c=this.Ba.Bd(b))!==Sa){var d=Pa(this.Ba.sc,this.Ba,c,b);b.Fb=c;b.then(d,d);b.state=b.Ed(c)?1:5}else return!0},this)},this)};function C(){z.call(this);this.D=new Bb(this);this.hc=this;this.wb=null}Fa(C,z);C.prototype[wb]=!0;l=C.prototype;l.M=function(){return this.wb};l.Sa=function(a){this.wb=a};l.addEventListener=function(a,b,c,d){Hb(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){Pb(this,a,b,c,d)};\nl.dispatchEvent=function(a){var b,c=this.M();if(c)for(b=[];c;c=c.M())b.push(c);c=this.hc;var d=a.type||a;if(\"string\"===typeof a)a=new B(a,c);else if(a instanceof B)a.target=a.target||c;else{var e=a;a=new B(d,c);Ma(a,e)}e=!0;if(b)for(var f=b.length-1;!a.xa&&0<=f;f--){var g=a.currentTarget=b[f];e=g.da(d,!0,a)&&e}a.xa||(g=a.currentTarget=c,e=g.da(d,!0,a)&&e,a.xa||(e=g.da(d,!1,a)&&e));if(b)for(f=0;!a.xa&&f<b.length;f++)g=a.currentTarget=b[f],e=g.da(d,!1,a)&&e;return e};\nl.K=function(){C.Z.K.call(this);this.D&&this.D.ia(void 0);this.wb=null};l.da=function(a,b,c){a=this.D.m[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.za&&f.capture==b){var g=f.listener,h=f.La||f.src;f.Ga&&Db(this.D,f);d=!1!==g.call(h,c)&&d}}return d&&!c.defaultPrevented};l.mb=function(a,b,c,d){return this.D.mb(String(a),b,c,d)};r(\"H.util.EventTarget\",C);C.prototype.Sa=C.prototype.Sa;C.prototype.setParentEventTarget=C.prototype.Sa;C.prototype.M=C.prototype.M;C.prototype.getParentEventTarget=C.prototype.M;C.prototype.addEventListener=C.prototype.addEventListener;C.prototype.addEventListener=C.prototype.addEventListener;C.prototype.removeEventListener=C.prototype.removeEventListener;C.prototype.removeEventListener=C.prototype.removeEventListener;C.prototype.dispatchEvent=C.prototype.dispatchEvent;\nC.prototype.dispatchEvent=C.prototype.dispatchEvent;C.prototype.C=C.prototype.C;C.prototype.dispose=C.prototype.C;C.prototype.aa=C.prototype.aa;C.prototype.addOnDisposeCallback=C.prototype.aa;C.prototype.yc=C.prototype.da;\nC.prototype.da=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?\"AT_TARGET\":b?\"CAPTURING_PHASE\":(d=!0,\"BUBBLING_PHASE\")];if(!d||\"pointerenter\"!==(e=c.type)&&\"pointerleave\"!==e)c.eventPhase=g,f=C.prototype.yc.apply(this,arguments),d&&this.M&&null===this.M()&&delete c.eventPhase;return f};C.prototype.qd=function(a){for(var b,c=this;c&&(b=c.M())&&b!==a;)c=b;b||c.Sa(a)};C.prototype.setRootParentEventTarget=C.prototype.qd;function D(a){a=a||{};var b=a.callback;this.rb=a.label;Wa(b)&&(this.callback=b);this.cb=!!a.disabled;D.Z.constructor.call(this)}Fa(D,C);r(\"H.util.ContextItem\",D);D.prototype.Hc=function(){return this.rb};D.prototype.getLabel=D.prototype.Hc;D.prototype.pd=function(a){this.rb!==a&&(this.rb=a,this.dispatchEvent(\"update\"));return this};D.prototype.setLabel=D.prototype.pd;D.prototype.Xc=function(){return this.cb};D.prototype.isDisabled=D.prototype.Xc;\nD.prototype.od=function(a){a!==this.cb&&(this.cb=a,this.dispatchEvent(\"update\"));return this};D.prototype.setDisabled=D.prototype.od;var Mc=new D;D.SEPARATOR=Mc;function Nc(a,b,c){var d=[],e=arguments.length;a&&d.push(db(a));1<e&&(e=2<e&&Xa(c,void 0,void 0,void 0)?\" out of [\"+c[0]+\"...\"+c[1]+\"]\":\"\",d.push(\"(\"+b+e+\")\"));d=Error(d.join(\" \"));Object.setPrototypeOf(d,Nc.prototype);return d}Fa(Nc,Error);r(\"H.lang.OutOfRangeError\",Nc);Nc.prototype.name=\"OutOfRangeError\";function Oc(a,b,c){Oc.Z.constructor.call(this,a,c);this.data=b}Fa(Oc,B);r(\"H.util.DataEvent\",Oc);var E=Math,Pc=E.min,Qc=E.max,Rc=E.round,Sc=E.floor,Tc=E.ceil,Uc=E.abs,Vc=E.log,Wc=E.sqrt,F=E.pow,Xc=E.exp,Yc=E.sin,Zc=E.asin,$c=E.cos,ad=E.tan,bd=E.atan,cd=E.atan2,dd=E.LN2,K=E.PI,ed=K/2,fd=K/4,gd=2*K,hd=3*K,id=K/180,jd=180/K,kd=1/0;function ld(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}r(\"H.math.normalize\",function(a,b,c){b-=c=c||0;a-=c;return a-Sc(a/b)*b+c});function md(a,b,c){return(a-=0)>c?c:a<b?b:a}r(\"H.math.clamp\",md);\nfunction nd(a,b,c){var d=0;(d-=0)||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}var od={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};r(\"H.math.CoverType\",od);\nfunction pd(a,b,c){for(var d=c.length,e=d,f,g,h,k,m=c[0],n=0,q=0,u=0;1!=n&&1<e;){e-=0;g=c[--e];f=c[--e];k=c[e?e-0-1:(d+(e-0-1))%d];h=c[e?e-0-2:(d+(e-0-2))%d];if(f>=a-0&&f<=a+0&&g>=b-0&&g<=b+0||h>=a-0&&h<=a+0&&k>=b-0&&k<=b+0)n=1;else if(!n&&f===a)h===a&&(g<b&&k>b||g>b&&k<b)||(m<=a&&h>a||m>=a&&h<a)&&(g>=b?++q:++u),n=nd(b,g,k)&&0>=Wc(F((a-h)*(g-k)-(b-k)*(f-h),2)/(F(f-h,2)+F(g-k,2)))?2:0;else if(!n&&nd(a,f,h)){if(f<a&&h>a||f>a&&h<a)m=g+(a-f)/(h-f)*(k-g),q+=m>b,u+=m<b;n=nd(b,g,k)&&0>=Wc(F((a-h)*(g-k)-\n(b-k)*(f-h),2)/(F(f-h,2)+F(g-k,2)))?2:0}m=f}!n&&0!==u&&0!==q%2&&(n=3);return n}function qd(a,b){return pd(a.x,a.y,b)!==od.NONE}r(\"H.math.isPointInsidePolygon\",qd);function rd(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&a[0].x!==t;b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}r(\"H.math.flatten\",rd);function sd(a){if(globalThis.document){var b=document.createElement(\"canvas\");b.width=b.height=1;b.getContext(\"2d\",{willReadFrequently:a})}}r(\"H.util.getPixelRatio\",function(){return window.devicePixelRatio||1});Object.create(Sa,void 0);r(\"H.util.eval\",function(a){return eval(a)});r(\"H.util.provide\",function(a){var b=p.$jscomp;if(b&&(\"function\"!=typeof b.Dc?0:b.Dc()))throw Error(\"goog.provide cannot be used within a module.\");qa(a,void 0,void 0)});function td(){this.v=0}\ntd.prototype.next=function(a){if(9007199254740992===this.v)throw new Nc(a,this.v,[0,9007199254740991]);return this.v++};var ud=new td;Pa(ud.next,ud);var vd=Ra([]);Ra({});sd(!0);sd(!1);function wd(){}r(\"H.service.extension.dataView.IRow\",wd);wd.prototype.L=function(){};wd.prototype.getColumnNames=wd.prototype.L;wd.prototype.o=function(){};wd.prototype.getCell=wd.prototype.o;wd.prototype.pb=function(){};wd.prototype.getTable=wd.prototype.pb;function xd(a,b){this.Ca=a;this.nd=b}r(\"H.service.extension.dataView.ObjRow\",xd);xd.prototype.L=function(){return this.Ca.L()};xd.prototype.getColumnNames=xd.prototype.L;xd.prototype.o=function(a){return this.Ca.o(this.nd,a)};xd.prototype.getCell=xd.prototype.o;xd.prototype.pb=function(){return this.Ca};xd.prototype.getTable=xd.prototype.pb;function M(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):t);this.P=a;if(b)for(this.ca=b,this.ab=a=Object.create(Sa,void 0),d=b.length;d--;)a[b[d]]=!0;c!==t&&(this.ub=c)}r(\"H.service.extension.dataView.ObjTable\",M);l=M.prototype;l.ub=t;l.P=t;l.ca=t;l.ab=t;l.nb=function(){return this.ub};M.prototype.getMeta=M.prototype.nb;M.prototype.ob=function(){return this.P?this.P.length:0};M.prototype.getRowCount=M.prototype.ob;M.prototype.Ja=function(a){var b=this.P;return b&&b[a]?new xd(this,a):t};\nM.prototype.getRow=M.prototype.Ja;M.prototype.L=function(){return this.ca||vd};M.prototype.getColumnNames=M.prototype.L;M.prototype.lb=function(a){return this.ab[a]?new Ha(this,a):t};M.prototype.getColumn=M.prototype.lb;M.prototype.o=function(a,b){var c=this.P;return(a=c&&this.ab[b]&&c[a])&&a[b]};M.prototype.getCell=M.prototype.o;\nM.prototype.concat=function(){var a=arguments.length,b,c=this.ca,d=\"\"+this.ca,e=(this.P||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof M))throw new x(this.concat,b);if(f.P){if(c&&\"\"+f.ca!==d)throw new x(this.concat,b,\"Incompatible columns!\");e=e.concat(f.P)}}return new M(e,this.ca,this.ub)};M.prototype.concat=M.prototype.concat;function O(a,b){this.x=+a;this.y=+b}r(\"H.math.Point\",O);O.prototype.set=O;O.prototype.set=O.prototype.set;O.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new O(this.x,this.y);return a};O.prototype.clone=O.prototype.clone;O.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};O.prototype.add=O.prototype.add;O.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};O.prototype.sub=O.prototype.sub;O.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};\nO.prototype.scale=O.prototype.scale;O.prototype.round=function(){this.x=Rc(this.x);this.y=Rc(this.y);return this};O.prototype.round=O.prototype.round;O.prototype.floor=function(){this.x=Sc(this.x);this.y=Sc(this.y);return this};O.prototype.floor=O.prototype.floor;O.prototype.ceil=function(){this.x=Tc(this.x);this.y=Tc(this.y);return this};O.prototype.ceil=O.prototype.ceil;O.prototype.S=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};O.prototype.equals=O.prototype.S;\nO.prototype.Kc=function(a,b){var c=b.x-a.x,d=b.y-a.y;var e=a;if(c||d)e=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d),e=0>=e?a:1<=e?b:new O(a.x+e*c,a.y+e*d);return e};O.prototype.getNearest=O.prototype.Kc;O.prototype.eb=function(a){return Wc(F(this.x-a.x,2)+F(this.y-a.y,2))};O.prototype.distance=O.prototype.eb;O.fromIPoint=function(a){if(!a)throw Error(\"invalid argument\");return a instanceof O?a:new O(a.x,a.y)};function yd(a,b,c,d,e,f){var g,h,k=a.length,m,n;if(k)for(g=[];k--;){var q=a[k];var u=q.length;var I=0;for(m=1;m<u;m++)if(n=zd(q[m-1],q[m],c,b,d,e)){var L=n[0];var w=n[1];I&&I.S(L)?h.push(w):g.push(h=n);I=w;f&&(m=u,k=0)}}else g=a;return g}r(\"H.math.clipping.clipStrips\",yd);\nfunction zd(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var m=a;g=h;a=b;h=k;b=m;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;m=f;f=-c;c=-m}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new O(h,-b),new O(g,-a)]:[new O(g,-a),new O(h,-b)]}\nfunction Ad(a,b,c){a=Bd(a,!0);b=Bd(b,!1);var d,e;var f={};var g=d=1;switch(~~(1*(c||0))){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.ma=new Cd(b.x,b.y,null,Dd(b));a.ma=new Cd(a.x,a.y,null,Dd(a));for(g=b;g.next;g=g.next)if(!g.F)for(d=a;d.next;d=d.next)if(!d.F){var k=Ed(g.next);var m=Ed(d.next);if(e=Fd(g,k,d,m,f)){e=f.ic;var n=f.jc;var q=f.wd;var u=f.xd;e=new Cd(q,u,null,null,null,null,!0,0,0,e);Gd(e,g,k);k=new Cd(q,u,null,null,null,null,!0,0,0,n);Gd(k,d,m);e.vb=k;\nk.vb=e}}f=qd(b,Hd(a));c&&(f=!f);for(g=b;g;g=g.next)g.F&&(g.qb=f,f=!f);f=qd(a,Hd(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.F&&(d.qb=f,f=!f);Id(b);for(Id(a);(a=Jd(b))!=b;){for(c=null;!a.Wa;a=a.vb){for(f=a.qb;;){c=new Cd(a.x,a.y,c);c.artificial=a.F||a.Rb;a.Wa=1;a=f?a.next:a.B;if(!a)break;if(a.F){a.Wa=1;break}}if(!a)break}c.Vb=I||null;var I=c}return I}}r(\"H.math.clipping.clipPolygon\",Ad);\nfunction Cd(a,b,c,d,e,f,g,h,k,m){this.x=a;this.y=b;this.next=c||null;this.B=d||null;this.Vb=e||null;this.vb=f||null;this.F=!!g;this.qb=!!h;this.Wa=k||0;this.alpha=m||0;d&&(d.next=this);c&&(c.B=this);this.Rb=!1;this.ma=null}function Ed(a){for(;a&&a.F;)a=a.next;return a}function Dd(a){if(a)for(;a.next;)a=a.next;return a}function Jd(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.F||b.F&&b.Wa))}return b}function Id(a){var b=Dd(a);b.B.next=a;a.B=b.B}\nfunction Fd(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var m=d.y-c.y;var n=g*m-h*k;if(!n)return 0;k=((c.x-a.x)*m-(c.y-a.y)*k)/n;n=(h*(c.x-a.x)-g*(c.y-a.y))/n;if(0>k||1<k||0>n||1<n)return 0;0===k?f=a:1===k?f=b:0===n?f=c:1===n&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.ma&&(f.ma.x=f.x,f.ma.y=f.y),Fd(a,b,c,d,e);e.wd=a.x+k*g;e.xd=a.y+k*h;e.ic=k;e.jc=n;return 1}function Hd(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}\nfunction Gd(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.B=b.B;a.next.B=a;a.B.next=a}function Bd(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=new Cd(a[e].x,a[e].y,d);c.Rb=b;if(c.next=d)d.B=c;d=c}return d};r(\"H.util.Disposable\",z);z.prototype.aa=z.prototype.aa;z.prototype.addOnDisposeCallback=z.prototype.aa;r(\"H.util.dispose\",function(a){a&&\"function\"==typeof a.C&&a.C()});z.prototype.C=z.prototype.C;z.prototype.dispose=z.prototype.C;z.prototype.K=z.prototype.K;z.prototype.disposeInternal=z.prototype.K;var Kd={};function Ld(a){try{importScripts.apply(self,arguments)}catch(b){this.postError(\"invalid_script\")}}function Md(a){delete Kd[a];this.postMessage(a)}function Nd(a,b,c){if(Wa(b))var d=b;else try{d=self.eval(\"(\"+b+\")\"),Wa(d)||(d=null)}catch(e){}d?(Kd[a]=d,c||this.postMessage(a)):this.postError(\"invalid_processor\")}function Od(a){this.Wb=a&&a[0];this.Ua=a&&a[1];this.kc=a&&a[2]||[]}Od.prototype.postError=function(a){this.postMessage(a,t,0)};\nOd.prototype.postMessage=function(a,b,c){self.postMessage({processor:this.Wb,taskId:this.Ua,type:c===t?1:c,data:a},b||t)};function Pd(a,b,c){if(!$a(a))throw new x(Pd,0,\"InvalidArgument\");if(!Wa(b))throw new x(Pd,1,\"InvalidArgument\");var d=Qd++;Rd[d]={mimeType:c||Sd,nc:b};(new Od([\"3\",d,[]])).postMessage(a,[],2)}var Rd={},Qd=0;\nfunction Td(a,b){var c=a;if(Rd[this.Ua]){var d=Rd[this.Ua];var e=d.nc;delete Rd[this.Ua];if(b)e(null,b);else{if(d.mimeType===Ud){a=new Uint8Array(a);b=a.byteLength;d=\"\";c=0;for(var f,g,h,k;c<b;)f=a[c++],192>f||(g=a[c++],224>f?f=(f&31)<<6|g&63:(h=a[c++],240>f?f=(f&15)<<12|(g&63)<<6|h&63:(k=a[c++],f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63))),65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));c=d}e(c)}}}var Sd=0,Ud=1;function Wd(a,b,c){var d=md(+a,-90,90);if(b&&ab(d))throw new x(b,c,a);return d}function Xd(a,b,c){var d=+a;if(-180>d||180<d)d=ld(d+180,360)-180;if(b&&ab(d))throw new x(b,c,a);return d}function Yd(a,b,c){var d;if(a!==t&&ab(d=+a)&&b)throw new x(b,c,a);return d}r(\"H.geo.isDBC\",function(a,b){return 0>a!==0>b&&180<Uc(b-a)});function Q(){var a=Q;if(!0===(Va(this,a)&&this.constructor===a))throw new TypeError(\"Illegal constructor \"+db(a));}r(\"H.geo.AbstractGeometry\",Q);Q.prototype.getBoundingBox=Q.prototype.pa;Q.prototype.equals=Q.prototype.S;Q.prototype.Xa=\"\";Q.prototype.kb=\"\";Q.prototype.toString=function(){return this.dc([this.Xa.toUpperCase(),\" \"]).join(\"\")};Q.prototype.toString=Q.prototype.toString;Q.prototype.sd=function(){return{type:this.kb,coordinates:this.cc()}};Q.prototype.toGeoJSON=Q.prototype.sd;\nQ.prototype.ib=function(){return{type:this.Xa,coordinates:this.jb(),boundingBox:this.pa().ib()}};Q.prototype.forWorkerMessage=Q.prototype.ib;function S(a,b,c){this.lat=Wd(a,S,0);this.lng=Xd(b,S,1);c!==t&&(this.alt=Yd(c,S,2))}Fa(S,Q);r(\"H.geo.Point\",S);S.prototype.S=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};S.prototype.equals=S.prototype.S;S.prototype.eb=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*id;var c=a.lat*id;a=1.274200158E7*Zc(Pc(1,Wc(F(Yc((b-c)/2),2)+$c(b)*$c(c)*F(Yc((this.lng*id-a.lng*id)/2),2))))}return a};\nS.prototype.distance=S.prototype.eb;\nS.prototype.vd=function(a,b,c){var d;if(c){if(d=b/6371000.79){b=a*id;a=id*this.lat;var e=Yc(a);c=Yc(d);var f=$c(d);d=id*this.lng;var g=$c(a);a=Zc(g*$c(b)*c+e*f);b=cd(Yc(b)*g*c,f-e*Yc(a));b=(d+b+K)%(2*K)-K;b*=jd;e=new S(a*jd,(b+540)%360-180)}return e||this}a=(a%360+360)%360;if(0===(a+90)%180)return a=this.lng+b/(6371000.79*gd*$c(this.lat*id))*(270===a?-360:360),new S(this.lat,(a+540)%360-180);if(b/=6371000.79)a*=id,e=this.lat*id,c=this.lng*id,d=e+b*$c(a),f=d-e,g=Vc(ad(d/2+fd)/ad(e/2+fd)),g=ab(f/g)?\n$c(e):f/g,a=b*Yc(a)/g,Uc(d)>ed&&(d=0<d?K-d:-(K+d)),d=new S(d*jd,((c+a+hd+(Uc(e+f)>ed?K:0))%gd-K)*jd);return d||this};S.prototype.walk=S.prototype.vd;S.prototype.pa=function(){return new T(this.lat,this.lng,this.lat,this.lng)};S.prototype.getBoundingBox=S.prototype.pa;function Zd(a,b,c){var d=ra(a)&&!(ab(a.lat=Wd(a.lat))||ab(a.lng=Xd(a.lng))||a.alt!==t&&ab(a.alt=Yd(a.alt)));if(!d&&b)throw new x(b,c,a);return d}S.validate=Zd;function $d(a){if(!a)throw new x($d,0,a);return new S(a.lat,a.lng,a.alt)}\nS.fromIPoint=$d;l=S.prototype;l.Xa=\"Point\";l.dc=function(a){a.push(\"(\",this.lng,\" \",this.lat,\")\");return a};l.kb=\"Point\";l.cc=function(){return[this.lng,this.lat,this.alt||0]};l.jb=function(){return[this.lat,this.lng,this.alt||0]};function T(a,b,c,d){ae(this,Wd(a,T,0),Xd(b,T,1),Wd(c,T,2),Xd(d,T,3))}Fa(T,Q);r(\"H.geo.Rect\",T);T.prototype.Xa=\"Polygon\";T.prototype.dc=function(a){var b=this.l,c=this.g,d=this.j,e=this.i;a.push(\"(\",\"(\",c,\" \",b,\",\",e,\" \",b,\",\",e,\" \",d,\",\",c,\" \",d,\",\",c,\" \",b,\")\",\")\");return a};T.prototype.S=function(a){var b=this===a;!b&&Va(a,T)&&(b=this.l===a.l&&this.g===a.g&&this.j===a.j&&this.i===a.i);return b};T.prototype.equals=T.prototype.S;\nT.prototype.clone=function(){return new T(this.l,this.g,this.j,this.i)};T.prototype.clone=T.prototype.clone;function ae(a,b,c,d,e){a.g=c;a.i=e;b<d&&(c=b,b=d,d=c);a.l=b;a.j=d;a.Db=a.Za=a.$a=null;return a}T.prototype.Nb=function(){this.Db||(this.Db=new S(this.l,this.g));return this.Db};T.prototype.getTopLeft=T.prototype.Nb;T.prototype.Mb=function(){this.Za||(this.Za=new S(this.j,this.i));return this.Za};T.prototype.getBottomRight=T.prototype.Mb;T.prototype.Pc=function(){return this.l};\nT.prototype.getTop=T.prototype.Pc;T.prototype.Cc=function(){return this.j};T.prototype.getBottom=T.prototype.Cc;T.prototype.Ic=function(){return this.g};T.prototype.getLeft=T.prototype.Ic;T.prototype.Nc=function(){return this.i};T.prototype.getRight=T.prototype.Nc;T.prototype.T=function(){this.$a||(this.$a=new S(this.j+(this.l-this.j)/2,be(this.g,this.U())));return this.$a};T.prototype.getCenter=T.prototype.T;T.prototype.U=function(){return ce(this.g,this.i)};T.prototype.getWidth=T.prototype.U;\nT.prototype.fa=function(){return this.l-this.j};T.prototype.getHeight=T.prototype.fa;T.prototype.Wc=function(){return this.g>this.i};T.prototype.isCDB=T.prototype.Wc;T.prototype.Yc=function(){return!this.U()&&!this.fa()};T.prototype.isEmpty=T.prototype.Yc;T.prototype.pa=function(){return new T(this.l,this.g,this.j,this.i)};T.prototype.getBoundingBox=T.prototype.pa;\nT.prototype.Ha=function(a,b,c){var d=this.T();c||(a=Wd(a,this.Ha,0),b=Xd(b,this.Ha,1));b=this.V(a,b,c);a=b.T();return a.lat===d.lat&&a.lng===d.lng&&this.fa()===b.fa()&&this.U()===b.U()};T.prototype.containsLatLng=T.prototype.Ha;T.prototype.Ia=function(a,b){b||Zd(a,this.Ia,0);return this.Ha(a.lat,a.lng,b)};T.prototype.containsPoint=T.prototype.Ia;\nT.prototype.Kb=function(a,b){var c=this.T();if(!b&&!Va(a,T))throw new x(this.Kb,0,a);b=this.Pa(a,b);a=b.T();return a.lat===c.lat&&a.lng===c.lng&&this.fa()===b.fa()&&this.U()===b.U()};T.prototype.containsRect=T.prototype.Kb;T.prototype.V=function(a,b,c,d){if(!c){if(ab(a=Wd(a)))throw new x(this.V,0,a);if(ab(b=Xd(b)))throw new x(this.V,1,b);}return de(this.l,this.g,this.j,this.i,a,b,a,b,d)};T.prototype.mergeLatLng=T.prototype.V;\nT.prototype.Ub=function(a,b,c){b||Zd(a,this.Ub,0);return this.V(a.lat,a.lng,b,c)};T.prototype.mergePoint=T.prototype.Ub;T.prototype.Pa=function(a,b,c){if(!b&&!Va(a,T))throw new x(this.Pa,0,a);return de(this.l,this.g,this.j,this.i,a.l,a.g,a.j,a.i,c)};T.prototype.mergeRect=T.prototype.Pa;T.prototype.sa=function(a,b,c,d,e,f){e||(a=Wd(a,this.sa,0),b=Xd(b,this.sa,1),c=Wd(c,this.sa,2),d=Xd(d,this.sa,3));return de(this.l,this.g,this.j,this.i,a,b,c,d,f)};T.prototype.mergeTopLeftBottomRight=T.prototype.sa;\nT.prototype.Qb=function(a,b){var c=this.g<=this.i,d=a.g<=a.i,e=this.g<a.i,f=a.g<this.i;if(!b&&!Va(a,T))throw new x(this.Qb,0,a);return this.j<=a.l&&a.j<=this.l&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};T.prototype.intersects=T.prototype.Qb;function ce(a,b){a=b-a;return a+(0>a?360:0)}function be(a,b){a+=b/2;return a-(180<a?360:0)}\nfunction de(a,b,c,d,e,f,g,h,k){c=Pc(c,g);a=Qc(a,e);e=ce(b,d);var m=be(b,e);g=ce(f,h);var n=be(f,g)-m;n+=0>n-1E-6?360:0;if(180>n-1E-6){m=b;var q=h}else n=360-n,m=f,q=d;n=n+e/2+g/2;360<=n+5E-7?(m=-180,q=180):n-5E-7<e?(m=b,q=d):n-5E-7<g&&(m=f,q=h);return k?ae(k,a,m,c,q):new T(a,m,c,q)}T.merge=de;function ee(a,b,c){c||(Zd(a,ee,0),Zd(b,ee,1));return new T(a.lat,a.lng,b.lat,b.lng)}T.fromPoints=ee;\nfunction fe(a,b){var c=1,d=a.length,e=null;var f=ta(a);if(\"array\"!=f&&(\"object\"!=f||\"number\"!=typeof a.length))throw new x(fe,0,a);if(0<d)for(f=a[0],e=ee(f,f,b);c<d;c++)f=a[c],e.V(f.lat,f.lng,b,e);return e}T.coverPoints=fe;function ge(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new x(ge,0,a);if(0<d)for(e=new T(a[0],a[1],a[0],a[1]);c<d;c+=3)e.V(a[c],a[c+1],b,e);return e}T.coverLatLngAlts=ge;\nfunction he(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new x(he,0,a);if(0<d)for(e=new T(a[0].l,a[0].g,a[0].j,a[0].i);c<d;c++)e.Pa(a[c],b,e);return e}T.coverRects=he;\nT.prototype.Yb=function(a,b){var c=this.g,d=this.l,e=this.i,f=this.j,g=this.T().lng;Zd(a,this.Yb,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?ae(b,d,a,f,e):new T(d,a,f,e)};T.prototype.resizeToCenter=T.prototype.Yb;T.prototype.kb=\"Polygon\";\nT.prototype.cc=function(){return[[this.g,this.l,0],[this.i,this.l,0],[this.i,this.j,0],[this.g,this.j,0],[this.g,this.l,0]]};T.prototype.ib=function(){return this.jb()};T.prototype.jb=function(){return[this.l,this.g,this.j,this.i]};function ie(){}function je(a){return Pc(1,Qc(0,.5-Vc(ad(fd+ed*a/180))/K/2))}ie.prototype.Oa=function(a,b,c){c?(c.x=b/360+.5,c.y=je(a)):c=new O(b/360+.5,je(a));return c};ie.prototype.latLngToPoint=ie.prototype.Oa;ie.prototype.Ac=function(a,b){return this.Oa(a.lat,a.lng,b)};ie.prototype.geoToPoint=ie.prototype.Ac;function ke(a){return 0>=a?90:1<=a?-90:jd*(2*bd(Xc(K*(1-2*a)))-ed)}\nie.prototype.ka=function(a,b,c){c?(c.lat=ke(b),c.lng=360*(1===a?1:ld(a,1))-180):c=new S(ke(b),360*(1===a?1:ld(a,1))-180);return c};ie.prototype.xyToGeo=ie.prototype.ka;ie.prototype.ed=function(a,b){return this.ka(a.x,a.y,b)};ie.prototype.pointToGeo=ie.prototype.ed;var le=new ie;r(\"H.geo.mercator\",le);r(\"H.util.constants.DEFAULT_MIN_ZOOM_LEVEL\",0);r(\"H.util.constants.DEFAULT_MAX_ZOOM_LEVEL\",22);function U(a,b){this.projection=a||le;this.ec=0;this.Da=this.exp=Vc(b||256)/dd;me(this);this.y=this.x=0}r(\"H.geo.PixelProjection\",U);var ne=Uc(24)+Uc(-8);U.prototype.hd=le;U.prototype.projection=U.prototype.hd;U.prototype.x=0;U.prototype.x=U.prototype.x;U.prototype.y=0;U.prototype.y=U.prototype.y;U.prototype.w=F(2,ne);U.prototype.w=U.prototype.w;U.prototype.Rc=F(2,ne);U.prototype.h=U.prototype.Rc;\nU.prototype.Aa=function(a){if(ab(a))throw new x(this.Aa,0,a);var b=this.x/this.w;var c=this.y/this.h;this.ec=a;this.Da=this.exp+a;me(this);this.x=b*this.w;this.y=c*this.h};U.prototype.rescale=U.prototype.Aa;function me(a){a.Da>ne&&(a.Da=ne);a.w=F(2,a.Da);a.h=F(2,a.Da)}U.prototype.Ob=function(){return this.ec||0};U.prototype.getZoomScale=U.prototype.Ob;U.prototype.zc=function(a,b){a=this.projection.Oa(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};U.prototype.geoToPixel=U.prototype.zc;\nU.prototype.xb=function(a,b){return this.projection.ka((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};U.prototype.pixelToGeo=U.prototype.xb;U.prototype.ka=function(a,b,c){return this.projection.ka((a+this.x)/this.w,(b+this.y)/this.h,c)};U.prototype.xyToGeo=U.prototype.ka;U.prototype.sb=function(a,b,c){a=this.projection.Oa(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};U.prototype.latLngToPixel=U.prototype.sb;U.prototype.fd=function(a){return new O(a.x*this.w-this.x,a.y*this.h-this.y)};\nU.prototype.pointToPixel=U.prototype.fd;function oe(a,b,c,d){if(!a||!b||!c)throw new x(oe,t,\"Must specify name, version and revision parameter\");this.name=a;this.version=b;this.revision=c;d&&Ma(this,d)}r(\"H.util.BuildInfo\",oe);oe.prototype.toString=function(){var a,b=[];for(a in this)$a(this[a])&&b.push(this[a]);return b.join(\";\")};var pe={};function qe(a,b,c,d){if(!a)throw new x(qe,1,\"Must specify a name parameter\");return pe[a]||(pe[a]=new oe(a,b,c,d))}oe.get=qe;function X(a,b,c,d,e,f){if(a&&b)this.Cb(a),this.Ra(b),this.Ab(c),this.Bb(e),this.ac(f),this.Ta(d);else throw new x(X,t,'Parameters \"scheme\" and \"host\" must be specified');}r(\"H.service.Url\",X);\nfunction re(a,b){var c=globalThis.document,d;var e=\"\";if(c){e=c.createElement(\"a\");if(b){var f=(d=c.getElementsByTagName(\"base\")[0])&&d.href;var g=c.head;var h=d||g.appendChild(c.createElement(\"base\"));h.href=b}e.href=a;e=e.href;b&&(d?d.href=f:g.removeChild(h))}else/[\\w]+:\\/\\//.test(a)&&(e=a);f=/(?:(\\w+):\\/\\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\\/[^?#]*)?(\\?[^#]+)?(#.*)?/.exec(e);a=f[1];g=f[4];b=f[5];h=f[6];c=f[7];d=f[8];!f[2]&&g&&/@/.test(g)&&(g=g.split(\"@\")[1]);f=X;h=h&&0<h.length?\nh.substr(1):\"\";e={};var k,m;if(c)for(k=/([?&]?([^=&+]+))(=([^&]+))?/g;m=k.exec(c);)e[decodeURIComponent(m[2])]=m[4]?decodeURIComponent(m[4]):void 0;return new f(a,g,h,e,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):\"\")}X.parse=re;X.prototype.clone=function(){var a={},b;for(b in this.A)a[b]=this.A[b];return new X(this.yb,this.Na,this.X,a,this.wa,this.la)};X.prototype.clone=X.prototype.clone;\nX.prototype.Cb=function(a){if(!a||\"string\"!==typeof a)throw new x(this.Cb,0,'The \"scheme\" parameter must be a non-empty string.');this.yb=a;return this};X.prototype.setScheme=X.prototype.Cb;X.prototype.Oc=function(){return this.yb};X.prototype.getScheme=X.prototype.Oc;X.prototype.Ra=function(a){if(!a||\"string\"!==typeof a||\"-\"===a.charAt(0)||\".\"===a.charAt(0)||\".\"===a.charAt(a.length-1))throw new x(this.Ra,0,'The \"host\" parameter is not a valid host name.');this.Na=a;return this};\nX.prototype.setHost=X.prototype.Ra;X.prototype.Fc=function(){return this.Na};X.prototype.getHost=X.prototype.Fc;X.prototype.Ab=function(a){this.X=a||void 0;return this};X.prototype.setPath=X.prototype.Ab;X.prototype.Lc=function(){return this.X};X.prototype.getPath=X.prototype.Lc;X.prototype.Ta=function(a){if(a)if(\"object\"==typeof a)this.A=a;else throw new x(this.Ta,0,'Parameter \"params\" must be an object.');else this.A={};return this};X.prototype.setQuery=X.prototype.Ta;X.prototype.Sc=function(){return!se(this)};\nX.prototype.hasQuery=X.prototype.Sc;X.prototype.getQuery=function(){return this.A};X.prototype.getQuery=X.prototype.getQuery;X.prototype.Bb=function(a){if(void 0===a)this.wa=a;else{var b=md(+a<<0,0,65535);if(b!=a)throw new x(this.Bb,0,'Parameter \"port\" must be an integer in range [0...65535]');this.wa=b}return this};X.prototype.setPort=X.prototype.Bb;X.prototype.Mc=function(){return this.wa};X.prototype.getPort=X.prototype.Mc;X.prototype.ac=function(a){this.la=a||void 0;return this};\nX.prototype.setAnchor=X.prototype.ac;X.prototype.Bc=function(){return this.la};X.prototype.getAnchor=X.prototype.Bc;X.prototype.ga=function(a){if(\"object\"!==typeof a)throw new x(this.ga,0,'Parameter \"other\" must be an object.');var b=this.A,c;for(c in a)a.hasOwnProperty(c)&&\"function\"!==typeof a[c]&&(b[c]=a[c]);return this};X.prototype.mergeQuery=X.prototype.ga;\nX.prototype.Gb=function(a){if(!a||\"string\"!==typeof a)throw new x(this.Gb,0,'Parameter \"subDomain\" must be a non-empty string');\".\"===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Ra(a+\".\"+this.Na)};X.prototype.addSubDomain=X.prototype.Gb;X.prototype.Hb=function(a){if(!a||\"string\"!==typeof a)throw new x(this.Hb,0,'Parameter \"subPath\" must be a non-empty string');return this.Ab((this.X?this.X+\"/\":\"\")+a)};X.prototype.addSubPath=X.prototype.Hb;\nX.prototype.toString=function(){return[this.yb+\"://\",this.Na,this.wa?\":\"+this.wa:\"\",this.X||!se(this)||this.la?\"/\":\"\",this.X?encodeURI(this.X):\"\",te(this),this.la?\"#\"+encodeURIComponent(this.la):\"\"].join(\"\")};X.prototype.toString=X.prototype.toString;function ue(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(b){return\"%\"+b.charCodeAt(0).toString(16)})}\nfunction te(a){var b=[],c=a.A,d={},e;for(e in c){if(c.hasOwnProperty(e)&&\"function\"!==typeof c[e]){var f=a.A[e];d.$=ue(e);Va(f,ve)?f.Va.forEach(function(g){return function(h){b.push(g.$+\"=\"+ue(h))}}(d)):Va(f,we)?b.push(d.$+\"=\"+f.Va.map(function(g){return ue(g)}).join(f.tc)):b.push(void 0===f?d.$:d.$+\"=\"+ue(f))}d={$:d.$}}return 0<b.length?\"?\"+b.join(\"&\"):\"\"}function se(a){var b,c=0;for(b in a.A)if(a.A.hasOwnProperty(b)&&\"function\"!==typeof a.A[b]&&(c++,0<c))break;return!c}\nfunction xe(a,b){if(Xa(a,void 0,void 0,void 0))for(var c=0;c<a.length;c++){var d=a[c];if(!$a(d)&&!bb(d)){var e=\"The Array does not contain only strings and numbers\";break}}else e=\"Not an Array\";if(e)throw new x(b,0,a);return a}function ve(a){this.Va=xe(a,ve)}X.MultiValueQueryParameter=ve;ve.prototype.Qc=function(){return this.Va};ve.prototype.getValues=ve.prototype.Qc;function we(a,b){this.Va=xe(a,we);if(!/^[!\\$\\(\\)\\*\\+,;]$/.test(b))throw new x(we,1,'Invalid delimiter \"'+b+'\"');this.tc=b}\nX.DelimitedQuerySubValues=we;function ye(a,b){b=180/(1<<b);var c=a.lat+90;a=(a.lng+180)%360;var d=0;180==c&&d--;d+=Math.floor(c/b);return[d,0+Math.floor(a/b)]}var ze=1/Math.pow(10,10);function Ae(a,b){var c=[],d=a.Nb();a=a.Mb();var e;180==a.lng&&(a.lng-=ze);d=ye(d,b);a=ye(a,b);for(e=d[0];e>=a[0];e--)for(b=d[1];b<=a[1];b++)c.push(e,b);return c};function Be(a,b,c,d){var e=!!c,f,g=0,h=0,k=0,m=0,n=0,q,u=-1;var I=globalThis.Float32Array;var L,w=[];if(b){b=Ta(b);a=Ta(a);e&&(f=Ta(c));c=b.length;d=d?1E-7:1E-5;for(L=new I(3*c);g<c;){I=b[g];var G=+I;var W=+a[g];e&&(q=+f[g]);Ce.test(I)?0<=u&&(0<g-u&&w.push(u,g+1),u=-1):0>u&&(u=g);g++;m=L[h++]=m+W*d;k=L[h++]=k+G*d;e&&(n=L[h]=n+q);h++}0<=u&&1<c-u&&w.push(u,c)}else L=new I(0);return{path:L,outlineIndices:w}}var Ce=/^-?0\\d/;\nfunction De(a,b){for(var c=0,d=a.length/3,e=new globalThis.Array(d),f=0;c<d;)e[c++]=b.sb(a[f],a[++f]),f+=2;return e};function Ee(a,b,c,d){this.key=\"\";this.x=a;this.y=b;this.Sb=c;this.ra=d;this.O=uc()}Ee.prototype.then=function(a,b,c){return this.O.promise.then(a,b,c)};Ee.prototype.resolve=function(a){this.O.resolve(a)};Ee.prototype.reject=function(a){this.O.reject(a)};Ee.prototype.cancel=function(){this.O.promise.cancel()};Ee.prototype.cancel=Ee.prototype.cancel;function Y(){}r(\"H.util.ICache\",Y);Y.prototype.add=function(){};Y.prototype.add=Y.prototype.add;Y.prototype.get=function(){};Y.prototype.get=Y.prototype.get;Y.prototype.fb=function(){};Y.prototype.drop=Y.prototype.fb;Y.prototype.forEach=function(){};Y.prototype.forEach=Y.prototype.forEach;Y.prototype.ia=function(){};Y.prototype.removeAll=Y.prototype.ia;Y.prototype.ya=function(){};Y.prototype.registerOnDrop=Y.prototype.ya;Y.prototype.bb=function(){};Y.prototype.deRegisterOnDrop=Y.prototype.bb;function Z(a,b,c){this.ta=[];b&&this.ya(b);if(c&&!Wa(c))throw new x(Z,2,c);this.J=0;this.filter=c;this.s={};this.qa=this.ea=null;this.zb(a)}r(\"H.util.Cache\",Z);Z.prototype.add=function(a,b,c){var d,e;c=+c;if(!bb(c)||0>c)throw new x(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.s[a])?(d.data!==b&&Fe(this,d),this.J+=c-d.size,d.size=c,d.data=b,Ge(this,d)):this.s[a]=He(this,{id:a,data:b,size:c,v:null,N:null},this.ea),Ie(this);return e};Z.prototype.add=Z.prototype.add;\nZ.prototype.ya=function(a){if(!Wa(a))throw new x(this.ya,0,a);this.ta.push(a)};Z.prototype.registerOnDrop=Z.prototype.ya;Z.prototype.bb=function(a){this.ta=this.ta.filter(function(b){return b!==a})};Z.prototype.deRegisterOnDrop=Z.prototype.bb;Z.prototype.get=function(a,b){return(a=b?this.s[a]:Ge(this,this.s[a]))&&a.data};Z.prototype.get=Z.prototype.get;Z.prototype.fb=function(a){var b;(b=this.s[a])&&Je(this,b,!0)};Z.prototype.drop=Z.prototype.fb;\nZ.prototype.forEach=function(a,b,c){var d;for(d in this.s){var e=this.s[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};Z.prototype.forEach=Z.prototype.forEach;Z.prototype.ia=function(a){var b;for(b in this.s){var c=this.s[b];(a?a(b,c.data,c.size):1)&&Je(this,this.s[b],!0)}};Z.prototype.removeAll=Z.prototype.ia;Z.prototype.zb=function(a){if(!(0<+a))throw new x(Z.prototype.zb,0,a);this.Tb=+a;Ie(this);return this};Z.prototype.setMaxSize=Z.prototype.zb;Z.prototype.Jc=function(){return this.Tb};\nZ.prototype.getMaxSize=Z.prototype.Jc;Z.prototype.Ec=function(){return this.J};Z.prototype.getCurrentSize=Z.prototype.Ec;function Ge(a,b){b&&(a.ea=He(a,b,a.ea));return b}function Ie(a){for(;a.J>a.Tb&&a.qa;)Je(a,a.qa,!0)}function He(a,b,c){if(c!==b){(b.v||b.N)&&Je(a,b,!1);if(b.v=c)b.N=c.N,c.N=b;b.N||(a.ea=b);b.v||(a.qa=b);a.J+=b.size}return b}function Je(a,b,c){var d=b.N,e=b.v;if(d||e||b==a.ea&&b==a.qa)d?d.v=e:a.ea=e,e?e.N=d:a.qa=d,a.J-=b.size,c&&(delete a.s[b.id],Fe(a,b));b.v=b.N=null}\nfunction Fe(a,b){for(var c=a.ta.length;c--;)a.ta[c].call(a,b.id,b.data,b.size)};function Ke(a,b){var c=a.tileSize||256;this.va={};this.$b=re(a.serverUrl);this.Ib=b;this.Zc=a.layerConfigs||[];this.Xb=a.projected;this.bc=c;this.lc=!1!==a.batchTiles;this.Tc=a.horizontalMargin||0;this.ad=a.onlyOutline;this.jd=new U(t,c);this.tb=new U(t,c);this.tb.Aa(22-Math.log(c)/Math.LN2+8)}Fa(Ke,z);\nKe.prototype.ld=function(a,b,c){var d=this.bc,e=this.Tc,f={x:a*d-e,y:b*d};d={x:(a+1)*d-1+e,y:(b+1)*d-1};e=this.jd;e.Aa(c);f=e.xb(f);d=e.xb(d);return Le(this,new T(f.lat,f.lng,d.lat,d.lng),this.Zc,{x:a,y:b,z:c})};Ke.prototype.kd=function(a,b,c,d,e){return Le(this,new T(a,b,c,d),e)};\nfunction Le(a,b,c,d){var e=Me(c),f=e.length,g={},h,k=a.va,m=[],n=[];for(c=0;c<f;c++){var q=e[c];var u=q.layerId;var I=q.level;g[u]=q.columns;q=Ae(b,I);var L=q.length-1;for(h=0;h<L;h+=2){var w=[u,q[h+1],q[h],I].join(\"_\");var G=k[w]||a.Ib.get(w);G||(G=new Ee(q[h+1],q[h],I,u),G.key=w,k[w]=G,n.push(G));m.push(G)}}n.length&&(a.lc?Ne(a,n):Oe(a,n));return tc(m.map(function(W){var ia=Pa(this.xc,this,g[W.ra]),N=Pa(this.gd,this,W,d||Pe),Ea=W.then,va=this.wc,wa=W.ra,xa={},v,R=e.length;for(v=0;v<R;v++){var J=\ne[v];if(J.rowFilter){var V=J.layerId;V=V!==t?V:J.layer;xa[V]=Pa(J.rowFilter,J.rowFilterContext)}}return Ea.call(W,Pa(va,this,wa,xa)).then(N).then(ia)},a))}var Pe={x:0,y:0,z:0};Ke.prototype.wc=function(a,b,c){var d=c.Rows,e=d.length,f,g;if(e&&(f=b[a])){b=new M(c.Rows);var h=[];for(g=0;g<e;g++){var k=d[g];f(b.Ja(g),a)&&h.push(k)}a={Rows:h};if(c=c.Meta)a.Meta=c}else a=c;return a};\nfunction Oe(a,b){function c(k,m,n){n?(delete a.va[k.key],k.reject(n)):Qe(a,k,m)}var d,e=b.length,f=a.$b;for(d=0;d<e;d++){var g=b[d];var h=f.clone().ga({tilex:g.x}).ga({tiley:g.y}).ga({level:g.Sb}).ga({layer:g.ra});new Pd(h.toString(),Pa(c,null,g),Ud)}}function Ne(a,b){var c=b.length,d;for(d=0;d<c;d+=15){var e=b.slice(d,d+15);Re(a,e)}}\nfunction Re(a,b){var c=a.$b.clone(),d=[],e=[],f=[],g=c.getQuery();b.length&&(b.forEach(function(h){d.push(h.x,h.y);e.push(h.Sb);f.push(h.ra)}),g.tilexy=d.join(\",\"),g.layers=f.join(\",\"),g.levels=e.join(\",\"),c.Ta(g),new Pd(c.toString(),function(h,k){k?b.forEach(function(m){delete a.va[m.key];m.reject(\"error\")}):Qe(a,b,h)},Ud))}\nfunction Qe(a,b,c){var d=b.length,e;if(Xa(b,void 0,void 0,void 0)){var f=c.indexOf(\"[\")+1;for(e=0;e<d;e++){var g=c.indexOf(\"]},{\",f+3)+2;g<f&&(g=c.lastIndexOf(\"]}\"));var h=c.substr(f,g-f);f=g+1;Se(a,b[e],h)}}else Se(a,b,c)}function Se(a,b,c){try{var d=c.length;var e=b.key;delete a.va[e];a.Ib.add(e,b,2*d);b.resolve(JSON.parse(c))}catch(f){b.reject(f.message)}}function Te(a,b,c,d,e){return e?[new O(a,b),new O(c,b),new O(c,d),new O(a,d),new O(a,b)]:[a,b,c,b,c,d,a,d]}\nKe.prototype.gd=function(a,b,c){var d=this.tb.Ob()-b.z,e=this.bc<<d,f=50<<d,g=b.x*e;b=b.y*e;var h=g+e;e=b+e;var k=g-f,m=b-f,n=h+f;f=e+f;var q,u,I=c.Rows,L=I.length,w,G=/^ADAS/.test(a.ra),W=this.tb,ia=this.ad,N,Ea=[],va=[],wa=[],xa=[];for(a=0;a<L;a++){var v=w=I[a];var R=(N=G)?\"HPY\":\"LAT\";var J=N?\"HPX\":\"LON\";var V=N?\"HPZ\":\"ZLEVEL\";if(v[R]){var P=Be(v[R],v[J],v[V],N);v.geometry=P;delete v[R];delete v[J];delete v[V];if(v.INNER_LAT)for(R=v.INNER_LAT.split(\";\"),P=v.INNER_LON.split(\";\"),delete v.INNER_LAT,\ndelete v.INNER_LON,v.interiors=V=[],J=R.length,v=0;v<J;v++)V.push(Be(R[v],P[v],\"\",N))}if(this.Xb){J=w;v=W;P=J.$$projected$$;R=0;if(!P){var aa=J.geometry;N=De(aa.path,v);w=[N];J.$$projected$$=P={dd:w};J=(V=J.interiors)?V.length:0;w.length+=J;R|=+Ue(w,N,aa.outlineIndices);if(J)for(P.Uc=1,q=0;q<J;q++)aa=V[q],N=De(aa.path,v),w[1+q]=N,R|=+Ue(w,N,aa.outlineIndices);R&&(P.bd=1+J)}v=P;N=v.dd;w=v.Uc;var kc=v.bd;P=[];R=J=kd;var Za=V=t;v=N[0];if(1===v.length){var lc=lc||(lc=Te(g,b,h,e,!1));w=v[0];pd(w.x,w.y,\nlc)&&P.push(Ve(v,g,b,d))}else{var Vd=N.length;for(aa=ia?kc:0;aa<Vd&&(ia||!aa||P.length);aa++)if(v=N[aa],aa>=kc){aa===kc&&(R=P.length);var ja=yd([v],k,m,n,f,!1);We(ja,g,b,d,P)}else{var Ab=Ab||(Ab=Te(k,m,n,f,!0));if(aa>=w)if(aa===w&&(J=P.length),Za)for(q=Za.length;q--;){if(ja=Xe(Za[q],v),u=ja.length){for(V=V||[];u--;)V.push(q);We(ja,g,b,d,P)}}else ja=Xe(Ab,v),We(ja,g,b,d,P);else if(ja=Xe(Ab,v),We(ja,g,b,d,P),1<ja.length&&w<Vd)for(Za=[],q=ja.length;q--;)Za[q]=ja[q]}}P.length&&(Ea[a]=P,va[a]=J,wa[a]=\nV,xa[a]=R)}}return{rd:c,pc:Ea,Vc:va,vc:wa,cd:xa}};function Ue(a,b,c){for(var d=c.length,e=0,f,g,h=b.length;e<d;)f=c[e++],g=c[e++],a.push(g-f===h?b:b.slice(f,g));return 0<c.length}function Xe(a,b){var c,d=[];if(c=Ad(a,b)){do{a=[];b=c;do a.push(b);while(b=b.next);d.push(a)}while(c=c.Vb)}else qd(b[0],rd(a))?d.push(b):qd(a[0],rd(b))&&d.push(a);return d}function We(a,b,c,d,e){for(var f=0,g=a.length;f<g;f++)e.push(Ve(a[f],b,c,d))}\nfunction Ve(a,b,c,d){var e,f=a.length,g=new Int32Array(2*f),h=0;for(e=0;e<f;e++){var k=a[e];g[h++]=k.x-b>>d;g[h++]=k.y-c>>d}return g}\nKe.prototype.xc=function(a,b){var c=b.rd,d=b.pc,e=b.Vc,f=b.cd;b=b.vc;for(var g=[],h,k={Rows:g},m,n=a?a.length:0,q=0,u,I=c.Rows,L=I.length,w;q<L;q+=1)if(d[q]||!this.Xb){h={};u=I[q];if(n)for(m=0;m<n;m++)u.hasOwnProperty(a[m])&&(h[a[m]]=u[a[m]]);else for(w in u)\"$$projected$$\"!==w&&(h[w]=u[w]);u.geometry&&(h.geometry=u.geometry);m=void 0;var G,W=h,ia=d[q],N=e[q],Ea=b[q],va=f[q],wa=g;if(ia){var xa=ia.length;if(Ea)for(G=N;G--;){if(G){var v={};for(m in W)v[m]=W[m]}else v=W;u=[ia[G]];var R=Pc(xa,va)-N;for(h=\n0;h<R;h++)Ea[h]===G&&u.push(ia[N+h]);R=u.length;if(!G)for(h=va;h<xa;h++)u.push(ia[h]);v.$HProjGeometry={paths:u,interiorsIndex:1,outlinesIndex:R};wa.push(v)}else W.$HProjGeometry={paths:ia,interiorsIndex:N,outlinesIndex:va},wa.push(W)}else wa.push(W)}c.Meta&&(k.Meta=c.Meta);return k};Ke.prototype.K=function(){var a,b=this.va;for(a in b)b.hasOwnProperty(a)&&(b[a].reject(\"disposed\"),delete b[a])};Ke.prototype.disposeInternal=Ke.prototype.K;\nfunction Me(a){for(var b=[],c,d=a.length,e=0;e<d;e++){c=Ka(a[e]);if(c.rowFilter&&(c.rowFilter=eval(\"(\"+c.rowFilter+\")\"),!Wa(c.rowFilter)))throw Error(\"Invalid row filter for layer \"+c.layerId);b.push(c)}return b};r(\"H.service.extension.worker.processor\",function(a,b,c){function d(h){e.postMessage(h)}var e=this,f=Ja[a];var g=function(h){e.postError(h.toString())};if(0===b)f||(Ja[a]=new Ke(c,Ye)),this.postMessage(void 0);else if(f)switch(b){case 1:try{f.ld.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 2:try{f.kd.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 3:f.C();delete Ja[a];Ia()&&Ye.ia();break;default:e.postError(\"Unsupported command\")}});\nvar Ye=new Z(26214400),Ja=Object.create(Sa,void 0);function Ze(a,b,c){var d=a[b];a=a[b+1];this.Pb=[];this.Eb=0;this.oc=b;this.mc=[a-c,d-c,a+c,d+c]}Ze.prototype.Ia=function(a,b){var c=a[b];a=a[b+1];b=this.mc;return b[1]<=c&&c<=b[3]&&b[0]<=a&&a<=b[2]};Ze.prototype.T=function(){return this.oc};var $e=new O(0,0);function af(a,b,c,d,e){d[e]=b;d[e+1]=a}var bf=new U;function cf(a,b,c,d,e){bf.sb(a,b,$e);d[e]=$e.x;d[e+1]=$e.y}\nr(\"H.clustering.dynamicgrid.worker\",function(a,b,c,d,e){var f=e?af:cf,g=0;e=!!self.ArrayBuffer;var h=a.byteLength?new Float64Array(a):a,k=h.length/3;a=[];var m=[],n=[],q=e?new Float64Array(2*k):[];k=0;var u=0;for(bf.Aa(d);g<h.length;){var I=h[g++];var L=h[g++];var w=h[g++];f(w,L,d,q,u);for(w=a.length;w--;)if(L=a[w],L.Ia(q,u)){var G=L;break}G||(G=new Ze(q,u,b),a.push(G));w=u/2;G.Eb+=I||1;G.Pb.push(w);G=null;u+=2}for(w=a.length;w--;)L=a[w],b=L.Eb>=c,f=L.Pb,d=f.length,b?(m.push(d),m=m.concat(f)):\n(k+=d,n=n.concat(f));c=[k].concat(n).concat(m);c=e?(new Uint32Array(c)).buffer:c;this.postMessage(c,[c])});self.addEventListener(\"message\",function(a){a=new Od(a.data);var b=Kd[a.Wb];if(b)try{b.apply(a,a.kc)}catch(c){a.postError(c.message)}else a.postError(\"processor_not_found\")});(function(){var a=new Od;var b=function(c,d){Nd.apply(a,[c,d,!0])};b(\"0\",Ld);b(\"1\",Nd);b(\"2\",Md);b(\"3\",Td)})();\n";
/**!
 * The code below uses open source software. Please visit the URL below for an overview of the licenses: 
 * https://sdk.venues.here.com/v3/3.1/HERE_NOTICE 
 */
this.H=this.H||{},this.H.venues=function(e){"use strict";function t(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function s(e){r(a,i,o,s,u,"next",e)}function u(e){r(a,i,o,s,u,"throw",e)}s(void 0)}))}}function o(e,t,n){return t=d(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,p()?Reflect.construct(t,n||[],d(e).constructor):t.apply(e,n))}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t,n){if(p())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&m(i,n.prototype),i}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,b(r.key),r)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t,n){return(t=b(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},h.apply(null,arguments)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}function p(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(p=function(){return!!e})()}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(){y=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),s=new w(r||[]);return i(a,"_invoke",{value:T(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var d="suspendedStart",f="suspendedYield",p="executing",v="completed",g={};function m(){}function E(){}function I(){}var _={};l(_,a,(function(){return this}));var b=Object.getPrototypeOf,S=b&&b(b(x([])));S&&S!==n&&r.call(S,a)&&(_=S);var L=I.prototype=m.prototype=Object.create(_);function M(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(c).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function T(t,n,r){var i=d;return function(o,a){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=O(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var l=h(t,n,r);if("normal"===l.type){if(i=r.done?v:f,l.arg===g)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=v,r.method="throw",r.arg=l.arg)}}}function O(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function x(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return E.prototype=I,i(L,"constructor",{value:I,configurable:!0}),i(I,"constructor",{value:E,configurable:!0}),E.displayName=l(I,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,I):(e.__proto__=I,l(e,u,"GeneratorFunction")),e.prototype=Object.create(L),e},t.awrap=function(e){return{__await:e}},M(A.prototype),l(A.prototype,s,(function(){return this})),t.AsyncIterator=A,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new A(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},M(L),l(L,u,"Generator"),l(L,a,(function(){return this})),l(L,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=x,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:x(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||L(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t,n,r){var i=h(d(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function _(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function L(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}t(".H_l_right .venues-ui__drawings .trigger.button--active .arrow {\n  transform: rotate(90deg);\n}\n.H_l_right .venues-ui__drawings .drawings {\n  right: 45px;\n  left: initial;\n}");var M=function(){function e(t){var n;return a(this,e),(n=o(this,e)).id=t.id,n.model=t,n}return f(e,H.map.Feature),l(e,[{key:"getData",value:function(){return this.model}},{key:"getAddress",value:function(){return this.model.getInternalAddress()}},{key:"getCenter",value:function(){var e=E(this.model.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"toGeoJSON",value:function(){return this.model.toJSON()}},{key:"getLevel",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getLevel().getDrawing().getParentEventTarget()}}])}(),A=function(){function e(t){var n;return a(this,e),(n=o(this,e)).id=t.id,n.model=t,n}return f(e,H.map.Feature),l(e,[{key:"getData",value:function(){return this.model}},{key:"getBoundingBox",value:function(){return s(H.geo.Rect,_(this.model.getBoundingBox()))}},{key:"getCenter",value:function(){var e=E(this.model.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getLevel",value:function(e){return this.getLevels().find((function(t){return t.getIdentifier()===e}))}},{key:"getLevels",value:function(){var e=this.getData().getLevels().map((function(e){return e.getIdentifier()}));return this.getVenue().getLevels().filter((function(t){return-1!==e.indexOf(t.id)}))}},{key:"getMainLevel",value:function(){return this.getLevel(this.model.getMainLevel().getIdentifier())}},{key:"getVenue",value:function(){return this.getParentEventTarget()}}])}(),T=function(){function e(t){var n;return a(this,e),(n=o(this,e)).id=t.id,n.model=t,n}return f(e,H.map.Feature),l(e,[{key:"getGeometry",value:function(e){return this.getGeometries().find((function(t){return t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){var e=this.getData().getGeometries().map((function(e){return e.getIdentifier()}));return this.getDrawing().getVenue().getGeometries().filter((function(t){return-1!==e.indexOf(t.id)}))}},{key:"getData",value:function(){return this.model}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getShortName",value:function(){return this.model.getShortName()}},{key:"getZIndex",value:function(){return this.model.getZIndex()}},{key:"isMain",value:function(){return this.model.isMain()}},{key:"getDrawing",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getDrawing().getParentEventTarget()}}])}();function O(e,t,n,r){for(var i,o=r,a=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],h=e[n+1],d=t+3;d<n;d+=3){var f=N(e[d],e[d+1],u,l,c,h);if(f>o)i=d,o=f;else if(f===o){var p=Math.abs(d-a);p<s&&(i=d,s=p)}}o>r&&(i-t>3&&O(e,t,i,r),e[i+2]=o,n-i>3&&O(e,i,n,r))}function N(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function k(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)w(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)w(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)w(e,t[r][i])}(i),i}function w(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function x(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)P(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)P(i[l],s);else if("LineString"===o)C(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],C(i[l],s,a,!1),e.push(k(u,"LineString",s,t.properties));return}D(i,s,a,!1)}else if("Polygon"===o)D(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)x(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];D(i[l],c,a,!0),s.push(c)}}e.push(k(u,o,s,t.properties))}}function P(e,t){t.push(j(e[0])),t.push(R(e[1])),t.push(0)}function C(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=j(e[s][0]),l=R(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,O(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function D(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];C(e[i],o,n,r),t.push(o)}}function j(e){return e/360+.5}function R(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function G(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,d=c.type,f=0===i?c.minX:c.minY,p=0===i?c.maxX:c.maxY;if(f>=n&&p<r)u.push(c);else if(!(p<n||f>=r)){var v=[];if("Point"===d||"MultiPoint"===d)V(h,v,n,r,i);else if("LineString"===d)z(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===d)U(h,v,n,r,i,!1);else if("Polygon"===d)U(h,v,n,r,i,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var y=[];U(h[g],y,n,r,i,!0),y.length&&v.push(y)}if(v.length){if(s.lineMetrics&&"LineString"===d){for(g=0;g<v.length;g++)u.push(k(c.id,d,v[g],c.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===v.length?(d="LineString",v=v[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===v.length?"Point":"MultiPoint"),u.push(k(c.id,d,v,c.tags))}}}return u.length?u:null}function V(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function z(e,t,n,r,i,o,a){for(var s,u,l=B(e),c=0===i?Y:Z,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],p=e[d+1],v=e[d+2],g=e[d+3],y=e[d+4],m=0===i?f:p,E=0===i?g:y,I=!1;a&&(s=Math.sqrt(Math.pow(f-g,2)+Math.pow(p-y,2))),m<n?E>n&&(u=c(l,f,p,g,y,n),a&&(l.start=h+s*u)):m>r?E<r&&(u=c(l,f,p,g,y,r),a&&(l.start=h+s*u)):F(l,f,p,v),E<n&&m>=n&&(u=c(l,f,p,g,y,n),I=!0),E>r&&m<=r&&(u=c(l,f,p,g,y,r),I=!0),!o&&I&&(a&&(l.end=h+s*u),t.push(l),l=B(e)),a&&(h+=s)}var _=e.length-3;f=e[_],p=e[_+1],v=e[_+2],(m=0===i?f:p)>=n&&m<=r&&F(l,f,p,v),_=l.length-3,o&&_>=3&&(l[_]!==l[0]||l[_+1]!==l[1])&&F(l,l[0],l[1],l[2]),l.length&&t.push(l)}function B(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function U(e,t,n,r,i,o){for(var a=0;a<e.length;a++)z(e[a],t,n,r,i,o,!1)}function F(e,t,n,r){e.push(t),e.push(n),e.push(r)}function Y(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function Z(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function W(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=J(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(J(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(J(o.geometry[s][l],t));i.push(u)}n.push(k(o.id,a,i,o.tags))}return n}function J(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function X(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(K(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(K(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function K(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function Q(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,q(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function q(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)$(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)$(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)$(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var d={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(d.id=t.id),e.features.push(d)}}function $(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function ee(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)x(n,e.features[r],t,r);else"Feature"===e.type?x(n,e,t):x(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){var n=t.buffer/t.extent,r=e,i=G(e,1,-1-n,n,0,-1,2,t),o=G(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=G(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=W(i,1).concat(r)),o&&(r=r.concat(W(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function te(e,t,n){return 32*((1<<e)*n+t)+e}ee.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ee.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=te(t,n,r),d=this.tiles[h];if(!d&&(l>1&&console.time("creation"),d=this.tiles[h]=Q(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(d.source=e,i){if(t===u.maxZoom||t===i)continue;var p=1<<i-t;if(n!==Math.floor(o/p)||r!==Math.floor(a/p))continue}else if(t===u.indexMaxZoom||d.numPoints<=u.indexMaxPoints)continue;if(d.source=null,0!==e.length){l>1&&console.time("clipping");var v,g,y,m,E,I,_=.5*u.buffer/u.extent,b=.5-_,S=.5+_,L=1+_;v=g=y=m=null,E=G(e,c,n-_,n+S,0,d.minX,d.maxX,u),I=G(e,c,n+b,n+L,0,d.minX,d.maxX,u),e=null,E&&(v=G(E,c,r-_,r+S,1,d.minY,d.maxY,u),g=G(E,c,r+b,r+L,1,d.minY,d.maxY,u),E=null),I&&(y=G(I,c,r-_,r+S,1,d.minY,d.maxY,u),m=G(I,c,r+b,r+L,1,d.minY,d.maxY,u),I=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(y||[],t+1,2*n+1,2*r),s.push(m||[],t+1,2*n+1,2*r+1)}}},ee.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=te(e,t=(t%a+a)%a,n);if(this.tiles[s])return X(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[te(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?X(this.tiles[s],i):null):null};var ne="Point",re="Polygon",ie="MultiPoint",oe="MultiLineString",ae="MultiPolygon",se={fillColor:"#e0e0e0",outlineColor:"#829DB4",outlineWidth:1},ue={fill:"#333333",size:13},le={fillColor:"#F2F285",outlineColor:"#0088BF",outlineWidth:1.2},ce=16,he=18,de=24,fe={FOOTPRINT:"FOOTPRINT",ICON:"ICON",TEXT:"TEXT",VECTOR:"VECTOR"},pe=Object.freeze({v1:1,v2:2}),ve=1,ge=2,ye=3,me="CW",Ee="CCW",Ie=function(e){var t=function(e){for(var t=0,n=e.length,r=0;r<n-1;r+=1){var i=e[r],o=e[r+1];t+=i[0]*o[1]-o[0]*i[1]}return t+(e[n-1][0]*e[0][1]-e[0][0]*e[n-1][1])}(e);return t>0?me:t<0?Ee:void 0},_e=function(e){for(var t,n=[],r=[],i=0,o=e.coordinates.length;i<o;i+=1){var a=e.coordinates[i],s=Ie(a);null!==s&&(s===(t=t||s)&&r.length&&(n.push(r),r=[]),r.push(a))}return r.length>0&&n.push(r),1===n.length?(e.type=re,e.coordinates=n[0]):n.length>1?(e.type=ae,e.coordinates=n):e=null,e},be=function(e,t,n,r,i){var o,a,s,u,l,c,h=function(e,t,n,r,i){var o=1<<t,a=[];return a[0]=(e[0]/i+n)/o,a[1]=(e[1]/i+r)/o,{x:a[0],y:a[1]}}(e,t,n,r,i);return a=(o=h).x,s=o.y,u=360*(a-.5),l=Math.exp(Math.PI*(.5-s)/.25)-1,c=Math.exp(Math.PI*(.5-s)/.25)+1,[u,180*Math.asin(l/c)/Math.PI]};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Se,Le,Me,Ae=(Se=function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==S(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==S(Symbol.iterator)?function(e){return S(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":S(e)})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1),a=n(7),s=a.get,u=(a.deepValue,a.isArray),l=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,a=void 0===o?100:o,u=n.threshold,l=void 0===u?.6:u,c=n.maxPatternLength,h=void 0===c?32:c,d=n.caseSensitive,f=void 0!==d&&d,p=n.tokenSeparator,v=void 0===p?/ +/g:p,g=n.findAllMatches,y=void 0!==g&&g,m=n.minMatchCharLength,E=void 0===m?1:m,I=n.id,_=void 0===I?null:I,b=n.keys,S=void 0===b?[]:b,L=n.shouldSort,M=void 0===L||L,A=n.getFn,T=void 0===A?s:A,O=n.sortFn,N=void 0===O?function(e,t){return e.score-t.score}:O,k=n.tokenize,w=void 0!==k&&k,x=n.matchAllTokens,P=void 0!==x&&x,C=n.includeMatches,D=void 0!==C&&C,j=n.includeScore,R=void 0!==j&&j,G=n.verbose,V=void 0!==G&&G;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:l,maxPatternLength:h,isCaseSensitive:f,tokenSeparator:v,findAllMatches:y,minMatchCharLength:E,id:_,keys:S,includeMatches:D,includeScore:R,shouldSort:M,getFn:T,sortFn:N,verbose:V,tokenize:w,matchAllTokens:P},this.setCollection(t),this._processKeys(S)}var t;return(t=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this._keyWeights[r]=1,this._keyNames.push(r)}else{for(var i=null,o=null,a=0,s=0,u=e.length;s<u;s+=1){var l=e[s];if(!l.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=l.name;if(this._keyNames.push(c),!l.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var h=l.weight;if(h<0||h>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?h:Math.max(o,h),i=null==i?h:Math.min(i,h),this._keyWeights[c]=h,a+=h}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),r=n.tokenSearchers,i=n.fullSearcher,o=this._search(r,i);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),r=0,i=n.length;r<i;r+=1)t.push(new o(n[r],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,r={},i=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t});return i}for(var s=0,u=n.length;s<u;s+=1)for(var l=n[s],c=0,h=this._keyNames.length;c<h;c+=1){var d=this._keyNames[c];this._analyze({key:d,value:this.options.getFn(l,d),record:l,index:s},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t})}return i}},{key:"_analyze",value:function(e,t){var n=this,r=e.key,i=e.arrayIndex,o=void 0===i?-1:i,a=e.value,s=e.record,l=e.index,c=t.tokenSearchers,h=void 0===c?[]:c,d=t.fullSearcher,f=t.resultMap,p=void 0===f?{}:f,v=t.results,g=void 0===v?[]:v;!function e(t,i,o,a){if(null!=i)if("string"==typeof i){var s=!1,l=-1,c=0;n._log("\nKey: ".concat(""===r?"--":r));var f=d.search(i);if(n._log('Full text: "'.concat(i,'", score: ').concat(f.score)),n.options.tokenize){for(var v=i.split(n.options.tokenSeparator),y=v.length,m=[],E=0,I=h.length;E<I;E+=1){var _=h[E];n._log('\nPattern: "'.concat(_.pattern,'"'));for(var b=!1,S=0;S<y;S+=1){var L=v[S],M=_.search(L),A={};M.isMatch?(A[L]=M.score,s=!0,b=!0,m.push(M.score)):(A[L]=1,n.options.matchAllTokens||m.push(1)),n._log('Token: "'.concat(L,'", score: ').concat(A[L]))}b&&(c+=1)}l=m[0];for(var T=m.length,O=1;O<T;O+=1)l+=m[O];l/=T,n._log("Token score average:",l)}var N=f.score;l>-1&&(N=(N+l)/2),n._log("Score average:",N);var k=!n.options.tokenize||!n.options.matchAllTokens||c>=h.length;if(n._log("\nCheck Matches: ".concat(k)),(s||f.isMatch)&&k){var w={key:r,arrayIndex:t,value:i,score:N};n.options.includeMatches&&(w.matchedIndices=f.matchedIndices);var x=p[a];x?x.output.push(w):(p[a]={item:o,output:[w]},g.push(p[a]))}}else if(u(i))for(var P=0,C=i.length;P<C;P+=1)e(P,i[P],o,a)}(o,a,s,l)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,r=0,i=e.length;r<i;r+=1){for(var o=e[r],a=o.output,s=a.length,u=1,l=0;l<s;l+=1){var c=a[l],h=c.key,d=n?t[h]:1,f=0===c.score&&t&&t[h]>0?Number.EPSILON:c.score;u*=Math.pow(f,d)}o.score=u,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===r(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var i=[];this.options.includeMatches&&i.push((function(e,t){var n=e.output;t.matches=[];for(var r=0,i=n.length;r<i;r+=1){var o=n[r];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&i.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),i.length){for(var u={item:s.item},l=0,c=i.length;l<c;l+=1)i[l](s,u);t.push(u)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&i(e.prototype,t),e}();e.exports=l},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,s=void 0===o?100:o,u=n.threshold,l=void 0===u?.6:u,c=n.maxPatternLength,h=void 0===c?32:c,d=n.isCaseSensitive,f=void 0!==d&&d,p=n.tokenSeparator,v=void 0===p?/ +/g:p,g=n.findAllMatches,y=void 0!==g&&g,m=n.minMatchCharLength,E=void 0===m?1:m,I=n.includeMatches,_=void 0!==I&&I;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:s,threshold:l,maxPatternLength:h,isCaseSensitive:f,tokenSeparator:v,findAllMatches:y,includeMatches:_,minMatchCharLength:E},this.pattern=f?t:t.toLowerCase(),this.pattern.length<=h&&(this.patternAlphabet=a(this.pattern))}var t;return(t=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,r=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return r&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,u=s.maxPatternLength,l=s.tokenSeparator;if(this.pattern.length>u)return i(e,this.pattern,l);var c=this.options,h=c.location,d=c.distance,f=c.threshold,p=c.findAllMatches,v=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:h,distance:d,threshold:f,findAllMatches:p,minMatchCharLength:v,includeMatches:r})}}])&&r(e.prototype,t),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,i=new RegExp(t.replace(n,"\\$&").replace(r,"|")),o=e.match(i),a=!!o,s=[];if(a)for(var u=0,l=o.length;u<l;u+=1){var c=o[u];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var r=n(4),i=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,u=o.distance,l=void 0===u?100:u,c=o.threshold,h=void 0===c?.6:c,d=o.findAllMatches,f=void 0!==d&&d,p=o.minMatchCharLength,v=void 0===p?1:p,g=o.includeMatches,y=void 0!==g&&g,m=s,E=e.length,I=h,_=e.indexOf(t,m),b=t.length,S=[],L=0;L<E;L+=1)S[L]=0;if(-1!==_){var M=r(t,{errors:0,currentLocation:_,expectedLocation:m,distance:l});if(I=Math.min(M,I),-1!==(_=e.lastIndexOf(t,m+b))){var A=r(t,{errors:0,currentLocation:_,expectedLocation:m,distance:l});I=Math.min(A,I)}}_=-1;for(var T=[],O=1,N=b+E,k=1<<(b<=31?b-1:30),w=0;w<b;w+=1){for(var x=0,P=N;x<P;)r(t,{errors:w,currentLocation:m+P,expectedLocation:m,distance:l})<=I?x=P:N=P,P=Math.floor((N-x)/2+x);N=P;var C=Math.max(1,m-P+1),D=f?E:Math.min(m+P,E)+b,j=Array(D+2);j[D+1]=(1<<w)-1;for(var R=D;R>=C;R-=1){var G=R-1,V=n[e.charAt(G)];if(V&&(S[G]=1),j[R]=(j[R+1]<<1|1)&V,0!==w&&(j[R]|=(T[R+1]|T[R])<<1|1|T[R+1]),j[R]&k&&(O=r(t,{errors:w,currentLocation:G,expectedLocation:m,distance:l}))<=I){if(I=O,(_=G)<=m)break;C=Math.max(1,2*m-_)}}if(r(t,{errors:w+1,currentLocation:m,expectedLocation:m,distance:l})>I)break;T=j}var z={isMatch:_>=0,score:0===O?.001:O};return y&&(z.matchedIndices=i(S,v)),z}},function(e,t){e.exports=function(e,t){var n=t.errors,r=void 0===n?0:n,i=t.currentLocation,o=void 0===i?0:i,a=t.expectedLocation,s=void 0===a?0:a,u=t.distance,l=void 0===u?100:u,c=r/e.length,h=Math.abs(s-o);return l?c+h/l:h?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=-1,i=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===r?r=o:s||-1===r||((i=o-1)-r+1>=t&&n.push([r,i]),r=-1)}return e[o-1]&&o-r>=t&&n.push([r,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,r=0;r<n;r+=1)t[e.charAt(r)]=0;for(var i=0;i<n;i+=1)t[e.charAt(i)]|=1<<n-i-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},r=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},i=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var u=s.indexOf("."),l=s,c=null;-1!==u&&(l=s.slice(0,u),c=s.slice(u+1));var h=t[l];if(null!=h)if(c||!i(h)&&!o(h))if(n(h))for(var d=0,f=h.length;d<f;d+=1)e(h[d],c);else c&&e(h,c);else a.push(r(h))}else a.push(t)}(e,t),a},isArray:n,isString:i,isNum:o,toString:r}}])},Se(Le={exports:{}},Le.exports),Le.exports),Te=(Me=Ae)&&Me.__esModule&&Object.prototype.hasOwnProperty.call(Me,"default")?Me.default:Me;Ae.Fuse;var Oe,Ne=l((function e(t){var n=t.addressList,r=void 0===n?[]:n,i=t.geometries,o=void 0===i?[]:i,s=t.entity,u=void 0===s?null:s,l=t.name,c=void 0===l?"":l,h=t.icon,d=void 0===h?"":h;a(this,e),this.addressList=r,this.geometries=o,this.icon=d,this.entity=u,this.name=c})),ke={keys:[{name:"name",weight:.6},{name:"addressList",weight:.4}],threshold:.2},we=function(){return l((function e(t){a(this,e),this.fuseSearch=null,this.levels_=null,this.searchListEntities_=[],this.searchListIcons_=[],this.searchList_=[],this.venueModel=t,this.init()}),[{key:"init",value:function(){var e=this.venueModel.getGeometries().reduce((function(e,t){var n=e;return n[t.getId()]=t,n}),{});this.initEntityList(this.venueModel.getOccupant()),this.initIconList(e),this.levels_=this.venueModel.getLevels().map((function(e){return{levelId:e.getId(),levelName:e.getName(),drawingId:e.getDrawing().getId(),drawingName:e.getDrawing().getName()}}));var t=[].concat(_(this.searchListEntities_),_(this.searchListIcons_));this.searchList_=t.sort((function(e,t){return e.name.localeCompare(t.name)})),this.fuseSearch_=new Te(this.searchList_,ke)}},{key:"initEntityList",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(e){return e.spaceIds?new Ne({geometries:e.space,addressList:e.spaceIds||[],name:e.properties.name||"",entity:e}):null})).filter((function(e){return null!==e}));this.searchListEntities_=e}},{key:"initIconList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.searchListIcons_=Object.values(e).filter((function(e){return e.isIcon()})).map((function(e){var t=e.getIcon();return new Ne({geometries:[e],icon:t,name:e.properties.name||""})}))}},{key:"all",value:function(){return this.searchList_}},{key:"allIconTypes",value:function(){var e=this.searchListIcons_.reduce((function(e,t){var n=e;return n[t.name]=t.name,n}),{});return Object.keys(e)}},{key:"find",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""===e?this.searchList_:this.fuseSearch_.search(e)}}])}(),xe=Object.freeze({SITE:"SITE",IMAGES:"IMAGES",THEME:"THEME"}),Pe={SITE:"indoor.Site",STRUCTURE:"indoor.Structure",OCCUPANT:"indoor.Occupant",SPACE:"indoor.Space",SPACEGROUPS:"indoor.SpaceGroups",TOPOLOGY:"Topology",ADDRESS:"Address",LEVEL:"indoor.Level",LEVELCONNECTOR:"indoor.LevelConnector",ENTRANCE:"indoor.Entrance"},Ce="OCCUPANT_NAMES",De="SPACE_NAME",je="INTERNAL_ADDRESS_SHORT",Re="INTERNAL_ADDRESS",Ge="INTERNAL_ADDRESS_LONG",Ve="SPACE_TYPE_NAME",He="SPACE_CATEGORY_NAME",ze="Point",Be="LineString",Ue="Polygon",Fe="MultiPoint",Ye="MultiLineString",Ze="MultiPolygon",We=Object.freeze({STANDARD:"STANDARD",FLATTEN:"FLATTEN",OUTDOOR_MAIN:"OUTDOOR_MAIN",INDOOR_MAIN:"INDOOR_MAIN",NO_OUTDOORS:"NO_OUTDOORS",FLATTEN_INDOOR_MAIN:"FLATTEN_INDOOR_MAIN",FLATTEN_OUTDOOR_COPY:"FLATTEN_OUTDOOR_COPY"}),Je="9999999999999",Xe="icons",Ke="config",Qe="https://interactive.data.api.platform.here.com/interactive/v1/catalogs",qe=Object.freeze({THEME:"THEME",THEME_MAP:"THEME_MAP",PRESETS:"PRESETS",SDK_STRINGS:"SDK_STRINGS",ICON_FILE:"ICON_FILE",INPUT_COLORS:"INPUT_COLORS",BASE_MAP_INFO:"BASE_MAP_INFO",CONFIG_PROFILE:"CONFIG_PROFILE",NAV_THEME:"NAV_THEME",NAV_NAME_THEME:"NAV_NAME_THEME",NAV_PROP_MAP:"NAV_PROP_MAP",NAV_STRINGS:"NAV_STRINGS",NAV_THEME_MAP:"NAV_THEME_MAP",NAV_NAME_THEME_MAP:"NAV_NAME_THEME_MAP",V4_THEME_FAMILY:"V4_THEME_FAMILY",V4_MAPTYPE_THEME:"V4_MAPTYPE_THEME",ICON:"ICON",MARKER:"MARKER",PERMISSIONS:"PERMISSIONS",NAICS_ARRAY:"NAICS_ARRAY",NAICS_MAP:"NAICS_MAP"});Object.freeze(c(c(c(c({},qe.THEME,"themeUrls"),qe.THEME_MAP,"themeMapUrl"),qe.PRESETS,"presetsUrl"),qe.SDK_STRINGS,"stringsUrl")),Object.freeze(c(c(c(c(c({},qe.THEME,"themeOverrides"),qe.THEME_MAP,"themeMapOverrides"),qe.PRESETS,"presetOverrides"),qe.SDK_STRINGS,"stringsOverrides"),qe.INPUT_COLORS,"inputColorOverrides")),Object.freeze(c(c(c(c(c(c({},qe.THEME,["Modern","Standard","Factory","Navteq","TheBase","Westfield_noLabels","Westfield","TDM_noLabel"]),qe.SDK_STRINGS,["Standard","SDK","sdk/standard"]),qe.V4_THEME_FAMILY,["modern","standard"]),qe.V4_MAPTYPE_THEME,["Airport Terminal","Airport","Casino","College Building","College Campus","Convention","General","Hospital","Outdoor","Retail","School Building","School Campus","Shopping Mall","Traffic","Train Station"]),qe.NAV_THEME,["Factory","MapEditor"]),qe.ICON,["Multicolor","Standard","TheBase","Factory"])),Object.freeze((c(c(c(c(c(c(c(c(c(c(Oe={},qe.THEME,"Modern"),qe.THEME_MAP,"Standard"),qe.PRESETS,"Standard"),qe.SDK_STRINGS,"Standard"),qe.ICON_FILE,"Standard"),qe.INPUT_COLORS,"Standard"),qe.BASE_MAP_INFO,"Standard"),qe.CONFIG_PROFILE,"factory"),qe.NAV_THEME,"Factory"),qe.NAV_NAME_THEME,"FactoryName"),c(c(c(c(c(c(c(c(Oe,qe.NAV_PROP_MAP,"Standard"),qe.NAV_STRINGS,"Standard"),qe.NAV_THEME_MAP,"Standard"),qe.NAV_NAME_THEME_MAP,"StandardName"),qe.V4_THEME_FAMILY,"Standard"),qe.V4_MAPTYPE_THEME,"Standard"),qe.ICON,"Multicolor"),qe.MARKER,"Standard")));var $e=Object.freeze({GEO_JSON:"GEO_JSON",V5_MAP:"V5_MAP",V5_NAV:"V5_NAV",V5_INFO:"V5_INFO",KML:"KML",SVG:"SVG",PNG:"PNG"});Object.freeze(c({},$e.GEO_JSON,{COMMUNITY_MAP:"COMMUNITY_MAP",COMMUNITY_ENTITY:"COMMUNITY_ENTITY",PATH_LEVEL_GEOMETRY:"PATH_LEVEL_GEOMETRY",GEOJSON_LEVEL_GEOMETRY:"GEOJSON_LEVEL_GEOMETRY"}));var et,tt=Object.freeze({ACCOUNT_API:"ACCOUNT_API",DEFAULT_COLLECTION:"DEFAULT_COLLECTION",CATALOG_LAYER:"CATALOG_LAYER"}),nt=Object.freeze(c(c(c({},tt.ACCOUNT_API,{BASE_URL:"https://account.api.here.com/authorization/v1.1/projects/me"}),tt.DEFAULT_COLLECTION,{BASE_URL:"https://config.data.api.platform.here.com/config/v1/catalogs",PARAMS:{CREATED:"created",COLLECTION:"-collection",VERBOSE:"true"}}),tt.CATALOG_LAYER,{BASE_URL:"https://interactive.data.api.platform.here.com/interactive/v1/catalogs",MOMDATA_LAYER:"9999999999999",ICON_LAYER:"icons",THEMERULE_LAYER:"config",COLLECTION_LAYER:"layers/9999999999999/search",PARAMS:{FEATURE_TYPE:{KEY:"p.featureType",VALUE:"indoor.Site"}}})),rt=Object.freeze({isIconsEnabled:!0,isMetaEnabled:!0,metaOptions:{},iconOptions:{}}),it=Object.freeze({GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH",OPTIONS:"OPTIONS",HEAD:"HEAD"}),ot=Object.freeze({DEV:"dev",SIT:"sit",PRD:"prd"}),at=Object.freeze(c(c(c({},ot.DEV,"https://indoor-routing-dev.indoor.sit.api.here.com"),ot.SIT,"https://indoor-routing-sit.indoor.sit.api.here.com"),ot.PRD,"https://indoor-routing.indoor.api.here.com")),st="object"===("undefined"==typeof Reflect?"undefined":S(Reflect))?Reflect:null,ut=st&&"function"==typeof st.apply?st.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};et=st&&"function"==typeof st.ownKeys?st.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var lt=Number.isNaN||function(e){return e!=e};function ct(){ct.init.call(this)}var ht=ct,dt=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}bt(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&bt(e,"error",t,n)}(e,i,{once:!0})}))};ct.EventEmitter=ct,ct.prototype._events=void 0,ct.prototype._eventsCount=0,ct.prototype._maxListeners=void 0;var ft=10;function pt(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+S(e))}function vt(e){return void 0===e._maxListeners?ct.defaultMaxListeners:e._maxListeners}function gt(e,t,n,r){var i,o,a,s;if(pt(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=vt(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return e}function yt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mt(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=yt.bind(r);return i.listener=n,r.wrapFn=i,i}function Et(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):_t(i,i.length)}function It(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function _t(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function bt(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+S(e));e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(ct,"defaultMaxListeners",{enumerable:!0,get:function(){return ft},set:function(e){if("number"!=typeof e||e<0||lt(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");ft=e}}),ct.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ct.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||lt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ct.prototype.getMaxListeners=function(){return vt(this)},ct.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var s=i[e];if(void 0===s)return!1;if("function"==typeof s)ut(s,this,t);else{var u=s.length,l=_t(s,u);for(n=0;n<u;++n)ut(l[n],this,t)}return!0},ct.prototype.addListener=function(e,t){return gt(this,e,t,!1)},ct.prototype.on=ct.prototype.addListener,ct.prototype.prependListener=function(e,t){return gt(this,e,t,!0)},ct.prototype.once=function(e,t){return pt(t),this.on(e,mt(this,e,t)),this},ct.prototype.prependOnceListener=function(e,t){return pt(t),this.prependListener(e,mt(this,e,t)),this},ct.prototype.removeListener=function(e,t){var n,r,i,o,a;if(pt(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},ct.prototype.off=ct.prototype.removeListener,ct.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},ct.prototype.listeners=function(e){return Et(this,e,!0)},ct.prototype.rawListeners=function(e){return Et(this,e,!1)},ct.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):It.call(e,t)},ct.prototype.listenerCount=It,ct.prototype.eventNames=function(){return this._eventsCount>0?et(this._events):[]},ht.once=dt;var St="venues-ui-button--active",Lt="venues-ui-button",Mt="venues-ui__drawings",At="data-drawing",Tt=function(){return l((function e(t,n,r){var i=this;a(this,e),this.clickHandler=r,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("class",Mt);var o=document.createElement("div");o.setAttribute("class","trigger ".concat(Lt));var s=document.createElement("div");s.setAttribute("class","arrow arrow--down"),o.appendChild(s),o.addEventListener("click",(function(){o.classList.toggle(St),i.containerButtons.classList.toggle("drawings--open")})),this.containerDiv.appendChild(o),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","drawings"),this.containerDiv.appendChild(this.containerButtons),n&&this.update(n),t.appendChild(this.containerDiv)}),[{key:"drawButton",value:function(e,t,n){var r=this,i=document.createElement("div"),o=Number(n)===Number(e);i.setAttribute("class",o?"".concat(Lt," ").concat(St):Lt),i.innerHTML=t,i.setAttribute(At,e),i.addEventListener("click",(function(){r.switch(e),r.clickHandler(e)})),this.containerButtons.appendChild(i)}},{key:"switch",value:function(e){this.containerButtons.querySelectorAll(".".concat(Mt," .").concat(St)).forEach((function(e){return e.setAttribute("class",Lt)}));var t=this.containerButtons.querySelector("[".concat(At,"='").concat(e,"']"));t&&t.setAttribute("class","".concat(Lt," ").concat(St))}},{key:"update",value:function(e){var t=this;this.containerButtons.innerHTML="";var n=function(e){var t=e.getDrawings();return new Map(t.map((function(e){var t=e.getDisplayName()||e.getName();return[e.getId(),t]})))}(e);n.size>0&&n.forEach((function(n,r){return t.drawButton(r,n,e.getRootDrawing().getId())}))}}])}(),Ot="venues-ui-button--active",Nt="venues-ui-button",kt="data-level",wt="venues-ui__levels",xt=function(){return l((function e(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;a(this,e),this.clickHandler=i,this.levelButtonCount=o,this.currentScrollIndex=0,this.containerUI=document.createElement("div"),this.containerUI.setAttribute("class","".concat(wt)),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","levels"),this.containerUI.appendChild(this.containerButtons),n&&this.update(n,r),t.appendChild(this.containerUI)}),[{key:"clear",value:function(){this.containerButtons.innerHTML="",this.buttonScrollUp&&(this.containerUI.removeChild(this.buttonScrollUp),this.buttonScrollUp=null),this.buttonScrollDown&&(this.containerUI.removeChild(this.buttonScrollDown),this.buttonScrollDown=null)}},{key:"drawLevelButton",value:function(e,t){var n=this,r=document.createElement("div");r.innerHTML=t,r.style.fontSize="".concat(Math.max(Math.min(28.8/t.length,11.52),10),"px"),r.style.display="block",r.setAttribute("class",Nt),r.setAttribute(kt,e),r.addEventListener("click",(function(){n.switch(e),n.clickHandler(e)})),this.containerButtons.appendChild(r)}},{key:"drawScrollButtons",value:function(){var e=this;this.buttonScrollUp=document.createElement("div"),this.buttonScrollUp.setAttribute("class","".concat(Nt," ").concat(Nt,"--up"));var t=document.createElement("div");t.setAttribute("class","arrow arrow--up"),this.buttonScrollUp.appendChild(t),this.buttonScrollUp.addEventListener("click",(function(){return e.scroll(1)})),this.containerUI.insertBefore(this.buttonScrollUp,this.containerButtons),this.buttonScrollDown=document.createElement("div"),this.buttonScrollDown.setAttribute("class","".concat(Nt," ").concat(Nt,"--down"));var n=document.createElement("div");n.setAttribute("class","arrow arrow--down"),this.buttonScrollDown.appendChild(n),this.buttonScrollDown.addEventListener("click",(function(){return e.scroll(-1)})),this.containerUI.appendChild(this.buttonScrollDown)}},{key:"scroll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=Array.from(this.containerButtons.querySelectorAll(".".concat(Nt))).reverse(),n=[];if(e>=0){this.currentScrollIndex=Math.min(this.currentScrollIndex+e,t.length-this.levelButtonCount);var r=Math.min(this.currentScrollIndex,t.length-this.levelButtonCount),i=Math.min(this.currentScrollIndex+this.levelButtonCount,t.length);n=t.slice(r,i)}else if(e<0){this.currentScrollIndex=Math.max(this.currentScrollIndex+e,0);var o=Math.max(0,this.currentScrollIndex),a=Math.min(t.length,this.currentScrollIndex+this.levelButtonCount);n=t.slice(o,a)}t.forEach((function(e){-1!==n.indexOf(e)?e.style.display="block":e.style.display="none"})),this.buttonScrollDown&&(0===this.currentScrollIndex?this.buttonScrollDown.setAttribute("disabled","disabled"):this.buttonScrollDown.removeAttribute("disabled")),this.buttonScrollUp&&(this.currentScrollIndex===t.length-this.levelButtonCount?this.buttonScrollUp.setAttribute("disabled","disabled"):this.buttonScrollUp.removeAttribute("disabled"))}},{key:"switch",value:function(e){this.containerButtons.querySelectorAll(".".concat(Ot)).forEach((function(e){return e.setAttribute("class",Nt)}));var t=this.containerButtons.querySelector(".".concat(wt," [").concat(kt,"='").concat(e,"']"));if(t){var n=Array.from(this.containerButtons.querySelectorAll(".".concat(Nt))).reverse();t.setAttribute("class","".concat(Nt," ").concat(Ot));var r=n.indexOf(t);(r<this.currentScrollIndex||r>=this.currentScrollIndex+4)&&this.scroll(r-this.currentScrollIndex)}}},{key:"update",value:function(e,t){var n=this,r=function(){return new Map((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(e){return[e.getZIndex(),e.getShortName()||e.getDisplayName()||e.getName()]})))}(function(e,t){if(t===We.FLATTEN){var n=e.getVenueModel().getLevelMapFlattenedByZIndex_();return Object.values(n).map((function(e){return e[0]}))}return e.getLevels()}(e,t).sort((function(e,t){return t.getZIndex()-e.getZIndex()}))),i=e.getMainLevel().getZIndex();this.clear(),r.forEach((function(e,t){return n.drawLevelButton(t,e)})),r.size>this.levelButtonCount&&(r.size>this.levelButtonCount+1?this.currentScrollIndex=Math.min(Array.from(r).reverse().findIndex((function(e){return e[0]===i})),r.size-this.levelButtonCount):this.currentScrollIndex=0,this.drawScrollButtons(),this.scroll(0)),this.switch(i)}}])}(),Pt=function(){return l((function e(t,n){a(this,e),this.baseTheme=t,this.metaInformation=n,this.labelStyleMap={},this.styleMap={},this.setStyleMap()}),[{key:"setStyleMap",value:function(){this.styleMap.ENTRANCE=this.baseTheme.entranceRules.default.styleProperties,this.labelStyleMap.ENTRANCE=this.baseTheme.entranceRules.default.textLabelStyleProperties;for(var e=0,t=Object.entries(this.baseTheme.spaceRules);e<t.length;e++){var n=E(t[e],2),r=n[0],i=n[1],o=i.properties.behavioralAppearance.default.styleProperties,a=i.properties.behavioralAppearance.default.textLabelStyleProperties;if(this.styleMap[r]=o,this.labelStyleMap[r]=a,i.spaceTypes)for(var s=0,u=Object.entries(i.spaceTypes);s<u.length;s++){var l=E(u[s],2),c=l[0],h=l[1],d=h.behavioralAppearance.default.styleProperties,f=h.behavioralAppearance.default.textLabelStyleProperties;this.styleMap["".concat(r,"_").concat(c)]=d&&0!==Object.keys(d)?d:o,this.labelStyleMap["".concat(r,"_").concat(c)]=f&&0!==Object.keys(f)?f:a}}}},{key:"getBaseTheme",value:function(){return this.baseTheme}},{key:"getStyleMap",value:function(){return this.styleMap}},{key:"getGeometryStyle",value:function(e){return this.styleMap&&Object.getOwnPropertyNames(this.styleMap)?this.styleMap[e]:null}},{key:"getLabelStyle",value:function(e){return this.labelStyleMap&&Object.getOwnPropertyNames(this.labelStyleMap)?this.labelStyleMap[e]:null}}],[{key:"getGeometryDefaultStyle",value:function(){return{fill:"#e5e5e5",fillOpacity:1,stroke:"#6c7a89",strokeOpacity:1,strokeWidth:2}}},{key:"getLabelDefaultStyle",value:function(){return{stroke:"#6c7a89",zmin:15}}}])}(),Ct=function(){return l((function e(){a(this,e),this.config=Object.seal({emitEventOnOverrideUpdate:!0}),this.imageCache={},this.releaseSettings_={displayOptions:{},mom:[]},this.theme={}}),[{key:"getMomData",value:function(){return this.releaseSettings_.mom}},{key:"getTheme",value:function(){return this.theme||{}}},{key:"getStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getTheme(),i=Pt.getGeometryDefaultStyle(),o=e.properties.spaceType,a=e.properties.spaceCategory,s=a;return o&&(s="".concat(a,"_").concat(o)),(t=r.getGeometryStyle(s))&&!n||(t=i),{m:t.fill&&t.fill.toLowerCase()||"#fff",w:t.strokeWidth/10||.1,o:t.stroke&&t.stroke.toLowerCase()||"#fff",l:"Dark"}||void 0}},{key:"getLabelStyle",value:function(e){this.getTheme();var t=Pt.getLabelDefaultStyle();return{fill:t.stroke,zmin:t.zmin}}}])}(),Dt=Math.PI/180,jt=180/Math.PI,Rt=function(){function e(){a(this,e)}return l(e,null,[{key:"toRadians",value:function(e){return e*Dt}},{key:"toDegrees",value:function(e){return e*jt}},{key:"getBoundingBox",value:function(t,n){var r=[];switch(t){case ze:r=[n,n];break;case Fe:case Be:r=n;break;case Ye:case Ue:r=n.reduce((function(e,t){return e.concat(t)}),[]);break;case Ze:r=n.reduce((function(e,t){return e.concat(t)}),[]).reduce((function(e,t){return e.concat(t)}),[])}return e.getBoundingBoxVertices(r)}},{key:"getInverseTransform",value:function(e){var t=e[0]*e[3]-e[1]*e[2],n=[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,0,0];return n[4]=-(n[0]*e[4]+n[2]*e[5]),n[5]=-(n[1]*e[4]+n[3]*e[5]),n}},{key:"applyTransformToPoint",value:function(e,t){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}},{key:"transformProduct",value:function(e,t){var n=[0,0,0,0,0,0];return n[0]=t[0]*e[0]+t[2]*e[1],n[1]=t[1]*e[0]+t[3]*e[1],n[2]=t[0]*e[2]+t[2]*e[3],n[3]=t[1]*e[2]+t[3]*e[3],n[4]=t[0]*e[4]+t[2]*e[5]+t[4],n[5]=t[1]*e[4]+t[3]*e[5]+t[5],n}},{key:"convertLonLatToMerc",value:function(e){var t=e[0]*Dt,n=e[1]*Dt,r=Math.sin(n);return[.5+t/(2*Math.PI),.5-Math.log((1+r)/(1-r))/(4*Math.PI)]}},{key:"convertMercToLatLon",value:function(e){var t=2*Math.PI*(e[0]-.5),n=Math.atan(Math.sinh(2*Math.PI*(.5-e[1])));return[t/Dt,n/Dt]}},{key:"getTransformScale",value:function(e){return Math.sqrt(e[0]*e[3]-e[1]*e[2])}},{key:"getLonLatToMercTransform",value:function(t){var n=[1/360,0,0,-1/(360*Math.cos(t[1]*Dt)),0,0],r=e.applyTransformToPoint(n,t),i=e.convertLonLatToMerc(t);return n[4]=i[0]-r[0],n[5]=i[1]-r[1],n}},{key:"getNatToMercTransform",value:function(t){var n=[t[4],t[5]],r=e.getLonLatToMercTransform(n);return e.transformProduct(t,r)}},{key:"convertMxMy2LonLat",value:function(t,n){return t.length&&n.length?e.applyTransformToPoint(t,n):[]}},{key:"convertLonLat2MxMy",value:function(t,n){if(!t.length||!n.length)return[];var r=e.getInverseTransform(t);return e.applyTransformToPoint(r,n)}},{key:"getFlattenedQuadraticBezierCurve",value:function(e,t,n){var r=[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;i<1&&(i=6);for(var o=0;o<=i;o+=1){var a=o/i,s=(1-a)*(1-a),u=2*a*(1-a),l=a*a,c=s*e[0]+u*t[0]+l*n[0],h=s*e[1]+u*t[1]+l*n[1];r.push([c,h])}return r}},{key:"getFlattenedCubicBezierCurve",value:function(e,t,n,r){var i=[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;o<1&&(o=6);for(var a=0;a<=o;a+=1){var s=a/o,u=(1-s)*(1-s)*(1-s),l=3*s*(1-s)*(1-s),c=3*s*s*(1-s),h=s*s*s,d=u*e[0]+l*t[0]+c*n[0]+h*r[0],f=u*e[1]+l*t[1]+c*n[1]+h*r[1];i.push([d,f])}return i}},{key:"getRectangularCoordinatesOfLabelArea",value:function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=E(t,6),o=i[0],a=i[1],s=i[2],u=i[3],l=i[5],c=e.getDeltaLonLatForMeterAtGivenLonLat(o,a),h=t[4];return r?(l&&(h*=-1),null!=n&&(h=(h+=n<0?2*Math.PI+n:n)<0?2*Math.PI+h:h)):h=0,e.getRectVerticesFromSignatureRectRepresentation([o,a],{xLength:s,yLength:u},h,c)}},{key:"getRotatedPoint",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],i=Math.cos(t),o=Math.sin(t),a=e[0]-r[0],s=e[1]-r[1],u=[];return[(u=n?[a*i+s*o,s*i-a*o]:[a*i-s*o,s*i+a*o])[0]+r[0],u[1]+r[1]]}},{key:"getRectVerticesFromSignatureRectRepresentation",value:function(t,n,r,i){var o=n.xLength,a=n.yLength,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=E(t,2),l=u[0],c=u[1],h=o/2,H=a/2,d=E(i,2),f=d[0],p=d[1];return[[1,1],[-1,1],[-1,-1],[1,-1]].map((function(e){return[e[0]*h,e[1]*H]})).map((function(t){return e.getRotatedPoint(t,r,s)})).map((function(e){return[e[0]*f,e[1]*p]})).map((function(e){return[e[0]+l,e[1]+c]}))}},{key:"getScaleFactorForRectInSpace",value:function(e,t,n,r){var i=e/n,o=t/r;return i>o?o:i}},{key:"getDeltaLonLatForMeterAtGivenLonLat",value:function(e,t){var n=6371e3;return[1/n*(180/Math.PI)/Math.cos(t*Math.PI/180),1/n*(180/Math.PI)]}},{key:"getBoundingBoxVertices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]];return e.reduce((function(e,t){return[[Math.min(t[0],e[0][0]),Math.min(t[1],e[0][1])],[Math.max(t[0],e[1][0]),Math.max(t[1],e[1][1])]]}),t)}},{key:"isPointInBoundingBox",value:function(e,t){if(e&&t){var n=E(e,2),r=n[0],i=n[1],o=E(t,2),a=E(o[0],2),s=a[0],u=a[1],l=E(o[1],2),c=l[0],h=l[1];return r<=c&&r>=s&&i<=h&&i>=u}}},{key:"isPointOnLineSegment",value:function(e,t,n){var r=E(e,2),i=r[0],o=r[1],a=E(t,2),s=a[0],u=a[1],l=E(n,2),c=l[0],h=l[1],d=(u-o)*(h-o)<=0;return s===c?s===i&&d:!(o-h!=(h-u)/(c-s)*(i-c)||!d)}},{key:"rayIntersectLineSegment",value:function(e,t,n){var r=E(e,2),i=r[0],o=r[1],a=E(t,2),s=a[0],u=a[1],l=E(n,2),c=l[0],h=l[1];if(s===c)return!1;var d=(i-s)/(c-s);return d>=0&&d<1&&(h-u)*d+u>o}},{key:"isPointInPolygon",value:function(t,n){var r=E(t,2),i=r[0],o=r[1],a=n.length;if(a<3)return!1;var s=0,u=n[a-1];return n.forEach((function(t){e.rayIntersectLineSegment([i,o],u,t)&&(s+=1),u=t})),s%2!=0}},{key:"isPointOnLineString",value:function(t,n){var r=E(t,2),i=r[0],o=r[1],a=n.length;if(a<2)return!1;for(var s=n[a-1],u=0;u<a;u+=1){var l=n[u];if(e.isPointOnLineSegment([i,o],s,l))return!0;s=n[u]}return!1}},{key:"getAreaOfPolygon",value:function(e){var t=e.length;if(t<3)return null;var n=0,r=e[t-1];return e.forEach((function(e){var t,i,o,a,s,u;n+=.5*(t=e,i=E(r,2),o=i[0],a=i[1],s=E(t,2),u=s[0],o*s[1]-a*u),r=e})),n}},{key:"getDistanceBetweenPoints",value:function(e,t){var n=E(e,2),r=n[0],i=n[1],o=E(t,2),a=r-o[0],s=i-o[1];return Math.sqrt(a*a+s*s)}}])}(),Gt=function(){return l((function e(){a(this,e),this.spaceRules={}}),null,[{key:"getDataEntriesOne",value:function(e,t){var n=[e,""];if(null!==t&&Array.isArray(t))n[1]=t.toString();else if(null!==t&&"object"===S(t)){var r=Object.entries(t);if(r.length>0){var i=this.getDataEntriesOne(r[0][0],r[0][1]);n[0]="".concat(n[0],".").concat(i[0]),n[1]=i[1]}}else n[1]=t;return n}},{key:"getDataEntriesAll",value:function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=E(r[n],2),o=i[0],a=i[1],s=this.getDataEntriesOne(o,a);t.push(s)}return t}},{key:"doFindComboMatch",value:function(e,t){var n="";if(e&&e.configuration&&e.configuration.combinations)for(var r=this.getDataEntriesAll(t),i=Object.entries(e.configuration.combinations),o=0,a=function(){var e=u[s],t=Object.keys(e[1]).filter((function(t){return r.some((function(n){return t===n[0]&&e[1][t]===n[1]}))}));t.length===Object.keys(e[1]).length&&t.length>o&&(n=e[0],o=t.length)},s=0,u=i;s<u.length;s++)a();return n}},{key:"getIconFromCombinations",value:function(e,t){if(e&&e.configuration.combinations&&t&&Object.keys(t).length>0&&e.behavioralAppearance.combinations&&Object.keys(e.behavioralAppearance.combinations).length>0){var n=this.doFindComboMatch(e,t);if(""===n||!e.behavioralAppearance.combinations[n].labelIcon)return"";if(e.behavioralAppearance.combinations&&e.behavioralAppearance.combinations[n]&&e.behavioralAppearance.combinations[n].labelIcon)return e.behavioralAppearance.combinations[n].labelIcon.referenceUri}return""}},{key:"findSpace",value:function(e,t){if(t.spaceTypes&&t.spaceTypes[e])return t.spaceTypes[e]}},{key:"findCategory",value:function(e){if(this.spaceRules[e])return this.spaceRules[e]}},{key:"setSpaceRules",value:function(e){this.spaceRules=e}},{key:"getSpaceIcon",value:function(e,t,n){var r="",i=this.findCategory(t);if(i){var o=this.findSpace(e,i);if(o){var a="";n&&(a=this.getIconFromCombinations(o,n)),a&&""!==a?r=a:o.behavioralAppearance.default.labelIcon?r=o.behavioralAppearance.default.labelIcon.referenceUri:i.properties.behavioralAppearance.default.labelIcon&&(r=i.properties.behavioralAppearance.default.labelIcon.referenceUri)}}return r}}])}(),Vt=function(){return l((function e(){a(this,e)}),null,[{key:"getFormattedIndoorMapId",value:function(e){var t=/^\d{5}$/.test(e),n="string"==typeof e&&e.includes("indoormap");return t||!n?"indoormap-00000000-0000-4000-a000-".concat(e.toString().padStart(12,"0")):e}},{key:"validateIsMicelloId",value:function(e){return new RegExp(/^indoormap-00000000-0000-4000-[a-f]000-[0-9]{12}$/).test(e)}}])}(),Ht=function(){return l((function e(){a(this,e),this.themeRule={},this.svgList={},this.defaultLang="ENG"}),null,[{key:"getNumberFromAlphaNumeric",value:function(e){try{var t=e.split("").reverse().join("").replace(/[^0-9]/g,"").substr(0,6);return parseInt(t,10)}catch(e){return null}}},{key:"extractNumFromSting",value:function(e){try{var t=e.replace(/[^0-9]/g,"");return parseInt(t,10)}catch(t){return console.warn("Exception in converting string to Id"),this.getNumberFromAlphaNumeric(e)}}},{key:"getVenueId",value:function(e){if("number"!=typeof e){var t=e.substr(e.length-6);return parseInt(t,10)}return e}},{key:"setSite",value:function(e,t){var n=this.getName(e),r={id:Vt.getFormattedIndoorMapId(t),location:e.referencePoint,properties:g({},e.properties),geometry:e.geometry,identifier:this.getVenueId(t),obj_type:"CommunityMap"},i=e.properties.indoorSiteMetadata,o=void 0===i?{}:i;return o.legacyVersion&&o.legacyVersion.mapVersion&&(r.map_version=o.legacyVersion.mapVersion),r.properties.name=n,r.properties.display_name=n,r}},{key:"setEntrance",value:function(e){var t=this.themeRule.entranceRules.default.labelIcon.referenceUri,n=this.extractNumFromSting(e.id),r=this.getName(e),i=e.properties;return i.icon=!0,i.svg=this.svgList[t.toLowerCase()],i.name=r||"entrance",i.display_name=r||"entrance",i.level={id:e.properties.level.id},{id:e.id,levelId:e.properties.level.id,momType:Pe.ENTRANCE,geometry:e.geometry,location:e.geometry,properties:i,identifier:n,label_area:[e.referencePoint.coordinates[0],e.referencePoint.coordinates[1],50,50,180]}}},{key:"setStructure",value:function(e){var t=this.extractNumFromSting(e.id),n=this.getName(e),r=e.properties;return r.is_root=0===e.properties.drawOrder,r.display_name=n,r.map_type=e.properties.structureType,r.name=n,{id:e.id,obj_type:"Drawing",identifier:t,properties:r}}},{key:"getNameByPriority",value:function(e,t){for(var n=this,r="",i=function(e){return"OFFICIAL"===e.nameType&&e.languageCode&&e.languageCode===n.defaultLang||"OFFICIAL"===e.nameType},o=0;o<e.length;o++){var a=e[o];if(i(a)&&(t&&t===a.nameType||!t)){r=a.name;break}if("ABBREVIATION"===a.nameType&&(t&&t===a.nameType||!t)){r=a.name;break}if("UNCLASSIFIED"===a.nameType&&(t&&t===a.nameType||!t)){r=a.name;break}if(!a.nameType&&a.name){r=a.name;break}}return r}},{key:"getName",value:function(e,t){return e.properties&&e.properties.names?this.getNameByPriority(e.properties.names,t):e.properties.placeProperties&&e.properties.placeProperties&&e.properties.placeProperties.names?this.getNameByPriority(e.properties.placeProperties.names,t):e.properties.locationDetails&&e.properties.locationDetails[0]&&e.properties.locationDetails[0].names?this.getNameByPriority(e.properties.locationDetails[0].names,t):""}},{key:"setLevel",value:function(e){var t=this.extractNumFromSting(e.id),n=e.properties.names,r=e.properties,i=e.geometry;return r["short name"]=this.getNameByPriority(n,n&&1!==n.length?"ABBREVIATION":""),r.name=this.getNameByPriority(n,n&&1!==n.length?"ABBREVIATION":""),{id:e.id,obj_type:"Level",identifier:t,properties:r,geometry:i}}},{key:"setLevelConnector",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"LevelConnector",properties:e.properties,geometry:e.geometry,identifier:t,location:e.geometry}}},{key:"setOccupant",value:function(e){var t=this.getName(e),n=this.extractNumFromSting(e.id),r=e.properties;return r.occupantName=t,r.email=e.properties.placeProperties&&e.properties.placeProperties.contacts&&e.properties.placeProperties.contacts.find((function(e){return"EMAIL"===e.contactType}))&&e.properties.placeProperties.contacts.find((function(e){return"EMAIL"===e.contactType})).value,r.name=t,r.tags=e.properties.attributes&&e.properties.attributes.tags,{geometry:e.geometry,id:e.id,obj_type:"Geometry",properties:r,identifier:n,spaceIds:e.properties.spaces?e.properties.spaces:[],type:"Feature",momType:Pe.OCCUPANT}}},{key:"getIcon",value:function(e){var t=!1,n="";return this.svgList[e]&&(t=!0,n=this.svgList[e]),{icon:t,svg:n}}},{key:"setSpace",value:function(e){var t=Gt.getSpaceIcon(e.properties.spaceType,e.properties.spaceCategory,e.properties.spaceTypeProperties),n=this.getName(e),r=this.getIcon(t),i=r.icon,o=r.svg,a=this.extractNumFromSting(e.id),s=e.properties.level.id,u=e.properties;u.spaceName=n,u[e.properties.spaceCategory]=e.properties.spaceType,u.spaceType=e.properties.spaceType,u.spaceCategory=e.properties.spaceCategory,u.icon=i,u.svg=o;var l={geometry:e.geometry,id:e.id,levelId:s,label_area:[e.referencePoint.coordinates[0],e.referencePoint.coordinates[1],50,50,180],location:e.referencePoint,obj_type:"Geometry",identifier:a,properties:u,momType:Pe.SPACE,type:"Feature"};return e.properties.spaceAddress&&e.properties.spaceAddress.id&&(l.addressId=e.properties.spaceAddress.id),l}},{key:"setSpaceGroups",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"SpaceGroups",properties:e.properties,geometry:e.geometry,location:e.referencePoint,identifier:t}}},{key:"setTopology",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"Topology",properties:e.properties,geometry:e.geometry,identifier:t}}},{key:"setAddress",value:function(e){var t=this.extractNumFromSting(e.id),n=this.getName(e),r=e.properties;return r.addressName=n,r.name=n,{id:e.id,properties:r,obj_type:"Address",identifier:t}}},{key:"manageSvgDimensions",value:function(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var i=E(r[n],2),o=i[0],a=i[1];if("string"==typeof a){var s=-1!==a.indexOf("<g")&&a.indexOf("<g")||a.indexOf("<p"),u=a.indexOf("</s");if(s&&u){var l=a.substring(s-1,u-1);t[o]="<svg width='64' height='64' viewBox='0 0 24 32' fill='none' xmlns='http://www.w3.org/2000/svg'>".concat(l,"</svg>")}}}return t}},{key:"getSiteBoundingBox",value:function(e){if(e){var t=E(Rt.getBoundingBox(e.geometry.type,e.geometry.coordinates),2),n=t[0],r=t[1];if(n)return"".concat(n[0],",").concat(n[1],",").concat(r[0],",").concat(r[1])}return"null, null, null, null"}}])}(),zt=function(){return l((function e(){a(this,e)}),null,[{key:"get",value:function(e){return fetch(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:"GET"}).then((function(t){return t.ok?t.json():Promise.reject(new Error("Call failed for ".concat(e," : ").concat(t.status," ").concat(t.statusText)))}))}},{key:"getConfigUrl",value:function(e,t,n){var r=n.apiKey,i=n.url,o=n.token,a=n.hrn,s={method:"GET",mode:"cors",cache:"default"},u="".concat(i||Qe,"/").concat(a),l="";return t===xe.SITE&&(l="".concat(u,"/layers/").concat(Je,"/search?p.featureType=indoor.Site&p.indoorMapId='").concat(Vt.getFormattedIndoorMapId(e),"'")),t===xe.IMAGES&&(l="".concat(u,"/layers/").concat(Xe,"/features/svg")),t===xe.Theme&&(l="".concat(u,"/layers/").concat(Ke,"/features/indoorMapRules")),o?s.headers={Authorization:"Bearer ".concat(o)}:l=l.concat("".concat(t===xe.SITE?"&":"?","apiKey=").concat(r)),this.get(l,s)}},{key:"getMomData",value:function(e,t){var n=t.apiKey,r=t.url,i=t.token,o=t.hrn,a={method:"GET",mode:"cors",cache:"default"},s="".concat(r||Qe,"/").concat(o),u=e&&e.features&&e.features.find((function(e){return e.momType===Pe.SITE})),l=Ht.getSiteBoundingBox(u),c=[Pe.TOPOLOGY,Pe.LEVELCONNECTOR],h=Object.values(Pe).filter((function(e){return!c.includes(e)})).join(),d="".concat(s,"/layers/").concat(Je,"/bbox?bbox=").concat(l,"&limit=100000&f.momType=").concat(h);return i?a.headers={Authorization:"Bearer ".concat(i)}:d=d.concat("&apiKey=".concat(n)),{mom:this.get(d,a),site:u}}},{key:"getIndoorMapsCollectionList",value:(e=i(y().mark((function e(t){var n,r,i,o,a,s,u,l,c,h,d;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.token,r=nt[tt.DEFAULT_COLLECTION],i=r.PARAMS,o=r.BASE_URL,a=encodeURI("".concat(o,"?sortBy=").concat(i.CREATED,"&verbose=").concat(i.VERBOSE)),s=a,!n){e.next=23;break}return u={method:"GET",headers:{Authorization:"Bearer ".concat(n)}},e.prev=6,e.next=9,this.get(s,u);case 9:if((l=e.sent).results&&0!==l.results.items.length){e.next=12;break}return e.abrupt("return",Promise.reject(new Error("empty catalogs, no result found")));case 12:if(c=l.results.items,h=/^indoormap.*-collection$/,d=c.filter((function(e){return h.test(e.id)})),!(Array.isArray(d)&&d.length<1)){e.next=17;break}return e.abrupt("return",Promise.reject(new Error("No indoormap collections found")));case 17:return e.abrupt("return",d);case 20:return e.prev=20,e.t0=e.catch(6),e.abrupt("return",Promise.reject(new Error("Error while accessing default collection")));case 23:return e.abrupt("return",Promise.reject(new Error("Please provide valid token")));case 24:case"end":return e.stop()}}),e,this,[[6,20]])}))),function(t){return e.apply(this,arguments)})},{key:"getProjectAccountDetails",value:function(e){var t=e.token,n=nt[tt.ACCOUNT_API].BASE_URL;if(t){var r={method:"GET",mode:"cors",headers:{Authorization:"Bearer ".concat(t)}};return this.get(n,r)}return Promise.reject(new Error("Please provide valid token"))}},{key:"fetchIndoorMapList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.hrn,n=e.url,r=nt[tt.CATALOG_LAYER],i=r.PARAMS,o=r.COLLECTION_LAYER;if(t){var a=encodeURI("".concat(n||Qe,"/").concat(t,"/").concat(o,"?").concat(i.FEATURE_TYPE.KEY,"=").concat(i.FEATURE_TYPE.VALUE)),s=this.createBaseUrl(a,it.GET,{},e),u=s.URL,l=s.options;return this.get(u,l)}return Promise.reject(new Error("Please provide valid hrn"))}},{key:"createBaseUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it.GET,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.token,o=r.apiKey,a=e,s={method:t,mode:"cors"};return i?s.headers=g({Authorization:"Bearer ".concat(i)},n):a=e.concat("&apiKey=".concat(o)),{URL:a,options:s}}}]);var e}(),Bt=function(){function e(){a(this,e)}return l(e,null,[{key:"isPointOnGeoJSONLineString",value:function(e,t){var n=!1;if(t&&t.length>1)for(var r=0,i=0,o=1;o<t.length;o+=1)if(r=t[o-1],i=t[o],Rt.isPointOnLineSegment(e,r,i)){n=!0;break}return n}},{key:"isPointOnGeoJSONMultiLineString",value:function(t,n){for(var r=!1,i=0;i<n.length;i+=1)if(e.isPointOnGeoJSONLineString(t,n[i])){r=!0;break}return r}},{key:"isPointInsideGeoJSONPolygon",value:function(e,t){var n=!1;if(Rt.isPointInPolygon(e,t[0])&&(n=!0),n)for(var r=1;r<t.length;r+=1)if(Rt.isPointInPolygon(e,t[r])){n=!1;break}return n}},{key:"isPointInsideGeoJSONMultiPolygon",value:function(t,n){for(var r=n.length,i=0;i<r;i+=1)if(e.isPointInsideGeoJSONPolygon(t,n[i]))return!0;return!1}},{key:"getGeometriesByLonLat",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=t.filter((function(t){return Rt.isPointInBoundingBox(e,t.getBoundingBox())})),o=0;o<i.length;o+=1){var a=i[o];if(a.isPointInsideGeometry(e,true)&&(r.push(a),!n))break}return r.sort((function(e,t){return t.getZIndex()-e.getZIndex()}))}}])}(),Ut=function(){return l((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;a(this,e),this.id=t.id,this.properties=t.properties||{},this.labelArea=t.label_area||[],this.geometry=t.geometry||{},this.location=t.location||{},this.address=t.address||{},this.level=n,this.zIndex=r,this.spaceId=t.spaceId,this.state_={isHighlighted:!1,highlightedStyle:{}},this.geometryData=t}),[{key:"getId",value:function(){return this.geometryData&&this.geometryData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getInternalAddress",value:function(){return this.address?this.address.properties&&this.address.properties.name:null}},{key:"getCenter",value:function(){return this.location.coordinates||[]}},{key:"getCoordinates",value:function(){return this.geometry.coordinates||[]}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getStyle",value:function(){return this.getMetaInformation_().getStyle(this)}},{key:"getIcon",value:function(){return this.properties.svg}},{key:"getLabelArea",value:function(){return this.labelArea||[]}},{key:"getLabelStyle",value:function(){return this.getMetaInformation_().getLabelStyle(this)||null}},{key:"getLevel",value:function(){return this.level}},{key:"getType",value:function(){return this.geometry.type}},{key:"getZIndex",value:function(){return this.zIndex}},{key:"getBoundingBox",value:function(){var e=this.getType(),t=this.getCoordinates(),n=[];switch(e){case ze:n=[t,t];break;case Fe:case Be:n=t;break;case Ye:case Ue:n=t.reduce((function(e,t){return e.concat(t)}),[]);break;case Ze:n=t.reduce((function(e,t){return e.concat(t)}),[]).reduce((function(e,t){return e.concat(t)}),[])}return Rt.getBoundingBoxVertices(n)}},{key:"isIcon",value:function(){return!!this.properties.icon}},{key:"isPointInsideGeometry",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1;switch(this.getType()){case ze:t=this.getLabelArea()&&Rt.getRectangularCoordinatesOfLabelArea(this.getLabelArea()),r=Rt.isPointInPolygon(e,t);break;case Fe:break;case Be:r=n&&Bt.isPointOnGeoJSONLineString(e,this.getCoordinates());break;case Ye:r=n&&Bt.isPointOnGeoJSONMultiLineString(e,this.getCoordinates());break;case Ue:r=Bt.isPointInsideGeoJSONPolygon(e,this.getCoordinates());break;case Ze:r=Bt.isPointInsideGeoJSONMultiPolygon(e,this.getCoordinates())}return r}},{key:"highlight",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.state_.isHighlighted=e,this.state_.highlightedStyle=e?t:{}}},{key:"isHighlighted",value:function(){return Boolean(this.state_.isHighlighted)}},{key:"getHighlightedStyle",value:function(){return this.state_.highlightedStyle||{}}},{key:"toJSON",value:function(){return g({},this.geometry)}},{key:"getMetaInformation_",value:function(){return this.getLevel()?this.getLevel().getDrawing().getVenueModel().metaInformation_:null}}])}(),Ft=function(){return l((function e(t,n){var r=this;a(this,e),this.id=t&&t.id,this.properties=t&&t.properties,this.zIndexCount=0,this.geometries=t&&t.features&&Object.values(t.features).reduce((function(e,t){return e[[t.id]]=new Ut(t,r,t.properties.drawOrder),e}),{}),this.drawing=n,this.levelData=t}),[{key:"getId",value:function(){return this.levelData&&this.levelData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getName",value:function(){return this.properties&&this.properties.name||""}},{key:"getDisplayName",value:function(){return this.properties&&this.properties.display_name||""}},{key:"getDrawing",value:function(){return this.drawing}},{key:"getShortName",value:function(){return this.properties&&this.properties["short name"]||""}},{key:"getZIndex",value:function(){return this.properties&&this.properties.zLevel}},{key:"getFeatureCollectionArray",value:function(){return this.getGeometries().map((function(e){return e.toJSON()}))}},{key:"getGeometryById",value:function(e){return this.geometries[e]}},{key:"getGeometries",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.geometries&&Object.values(this.geometries).sort((function(e,t){return t.getZIndex()-e.getZIndex()})):this.geometries&&Object.values(this.geometries).sort((function(e,t){return e.getZIndex()-t.getZIndex()}))}},{key:"getGeometriesByAddress",value:function(e){return Object.values(this.geometries).filter((function(t){return t.address&&t.address.properties&&t.address.properties.name&&t.address.properties.name===e}))}},{key:"isMain",value:function(){return Boolean(this.properties.isMain)}}])}(),Yt=function(){return l((function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0;a(this,e),this.venueModel=o,this.levels=i.map((function(e){return new Ft(e,n)})),this.structure=t,this.id=t&&t.id,this.properties=r}),[{key:"getId",value:function(){return this.structure&&this.structure&&this.structure.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"isRoot",value:function(){return Boolean(this.properties.is_root)}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getBoundingBox",value:function(){if(this.structure&&this.structure.geometry){var e=E(Rt.getBoundingBox(this.structure.geometry.type,this.structure.geometry.coordinates),2),t=e[0],n=e[1];if(t)return[n[1],t[0],t[1],n[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.structure&&this.structure.location&&this.structure.location.coordinates}},{key:"getGeometryById",value:function(e){return this.getGeometries().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.levels.flatMap((function(e){return e.getGeometries()}))}},{key:"getLevelById",value:function(e){return this.levels.find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getLevelByZIndex",value:function(e){return this.levels.find((function(t){return t.getZIndex()===e}))}},{key:"getLevels",value:function(){return this.levels}},{key:"getMainLevel",value:function(){return this.levels.find((function(e){return e.isMain()}))}},{key:"getVenueModel",value:function(){return this.venueModel}}])}(),Zt=We.STANDARD,Wt=function(){return l((function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ct;a(this,e),this.metaInformation_=r,this.momStructure=t,this.id=t&&t.site&&t.site.id,this.location=t&&t.site&&t.site.location||{},this.properties=t&&t.site&&g({},t.site.properties),this.drawings=t&&t.structure&&Object.values(t.structure).map((function(e){var r=t.getStructureWiseGeometry(e.id);return new Yt(e,e.properties,Object.values(r),n)}))}),[{key:"getDisplaySettings",value:function(){return(this.metaInformation_.releaseSettings_?this.metaInformation_.releaseSettings_.displayOptions:"").display||Zt}},{key:"getId",value:function(){return this.momStructure&&this.momStructure.site&&this.momStructure.site.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getName",value:function(){return this.properties.name}},{key:"getBoundingBox",value:function(){if(this.momStructure){var e=E(Rt.getBoundingBox(this.momStructure.site.geometry.type,this.momStructure.site.geometry.coordinates),2),t=e[0],n=e[1];if(t)return[n[1],t[0],t[1],n[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.location.coordinates}},{key:"getGeometryById",value:function(e){return this.getGeometries().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.getLevels().sort((function(e,t){return e.getZIndex()-t.getZIndex()})).flatMap((function(e){return e.getGeometries()}))}},{key:"getGeometriesByLonLat",value:function(e){var t=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map((function(e){return t.getLevelById(e)}));0===r.length&&(r=this.drawings.filter((function(t){var n=t.getBoundingBox();return Rt.isPointInBoundingBox(e,n)})).flatMap((function(e){return e.getLevels()})));return Bt.getGeometriesByLonLat(e,r.flatMap((function(e){return e.getGeometries(!0)})),n)}},{key:"getDrawingById",value:function(e){return this.drawings.find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getRootDrawing",value:function(){return this.drawings.find((function(e){return e.isRoot()}))}},{key:"getLevelById",value:function(e){return this.getLevels().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getLevelsByZIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.getLevels().filter((function(t){return Number(t.getZIndex())===Number(e)}))}},{key:"getLevels",value:function(){return this.drawings.flatMap((function(e){return e.getLevels()}))}},{key:"getMomStructure",value:function(){return this.momStructure}},{key:"getLevelMapFlattenedByZIndex_",value:function(){var e=this.getLevels().reduce((function(e,t){var n=t.getZIndex(),r=e;return r[n]||(r[n]=[]),r[n].push(t),r}),{});return e}},{key:"getOccupant",value:function(){var e=this.momStructure.occupant;return Object.values(e)}}])}(),Jt=function(){return l((function e(t){a(this,e),this.theme=t&&t.theme,this.level=t&&t.level,this.site=t&&t.site,this.spaces=t&&t.spaces,this.address=t&&t.address,this.levelConnector=t&&t.levelConnector,this.topology=t&&t.topology,this.entrance=t&&t.entrance,this.occupant=t&&t.occupant,this.structure=t&&t.structure,this.spaceGroups=t&&t.spaceGroups,this.levelWiseGeometry={},this.levelStructureMapping=t&&t.levelStructureMapping,this.outdoorLevelMapping=t&&t.outdoorLevelMapping||{},this.labelTextPreference=t&&t.labelTextPreference||null}),[{key:"setSpaceWithLevel",value:function(){var e=this;this.spaces&&Object.values(this.spaces).forEach((function(t){var n="";t.addressId&&(n=e.address&&e.address[t.addressId]&&e.address[t.addressId].properties.addressName);var r=t.properties;r.addressName=n;var i=e.getLabelAsPerPreference(g(g({},t),{},{properties:r})),o=t.properties;o.name=i,o.display_name=i,t.properties.icon&&(o.name=t.id,o.display_name=t.id);var a=t;a.properties=o,a.address=e.address[t.addressId],e.spaces[t.id]=t;var s=t.levelId;e.outdoorLevelMapping[s]&&(s=e.outdoorLevelMapping[s]),e.levelWiseGeometry[s]||(e.levelWiseGeometry[s]={}),e.levelWiseGeometry[s][a.id]=a}))}},{key:"setOccupantWithLevel",value:function(){var e=this;this.occupant&&Object.values(this.occupant).forEach((function(t){if(t.spaceIds&&t.properties.occupantName){var n=[],r=[];t.spaceIds.forEach((function(i){var o=i.id,a=e.spaces[o],s=null;e.spaceGroups&&Object.values(e.spaceGroups).forEach((function(e){e.properties.spaceGroups&&e.properties.spaceGroups&&e.properties.spaceGroups.forEach((function(e){e.mainSpace&&e.mainSpace.id===i.id&&(s=e.spaces.map((function(e){return e.id})))}))}));var u=function(i){var o=!1;e.labelTextPreference&&e.labelTextPreference.length&&(o=-1!==e.labelTextPreference.indexOf("OCCUPANT_NAMES"));var a=null===e.labelTextPreference||o,s=i,u=i.properties;u.name=i.properties.icon||!a?i.properties.name:t.properties.occupantName,u.display_name=i.properties.icon||!a?i.properties.display_name:t.properties.occupantName,u.address=i.address,u.occupantName=t.properties.occupantName;var l=i.levelId;e.outdoorLevelMapping[l]&&(l=e.outdoorLevelMapping[l]),e.levelWiseGeometry[l]||(e.levelWiseGeometry[l]={}),e.levelWiseGeometry[l][i.id]=s,n.push(s),r.push(i.id)};s&&s.length>0&&s.forEach((function(t){u(e.spaces[t])})),a&&u(a)})),e.occupant[t.id]=t,e.occupant[t.id].space=n,e.occupant[t.id].spaceIds=r}}))}},{key:"setEntrance",value:function(){var e=this;this.entrance&&Object.values(this.entrance).forEach((function(t){var n=t.properties.level.id;e.levelWiseGeometry[n]||(e.levelWiseGeometry[t.properties.level.id]={}),e.outdoorLevelMapping[n]&&(n=e.outdoorLevelMapping[n]),e.levelWiseGeometry[n][t.id]=t}))}},{key:"setLevelWiseGeometry",value:function(){var e=this;this.level&&Object.keys(this.level).forEach((function(t){e.levelWiseGeometry[t]={}})),this.setSpaceWithLevel(),this.setOccupantWithLevel(),this.setEntrance()}},{key:"getStructureWiseGeometry",value:function(e){for(var t={},n=0,r=Object.entries(this.levelWiseGeometry);n<r.length;n++){var i=E(r[n],2),o=i[0],a=i[1];e===this.levelStructureMapping[o]&&(t[o]=this.level[o],t[o].features=a)}return t}},{key:"getLabelAsPerPreference",value:function(e){var t=e.properties,n=t.spaceType,r=t.occupantName,i=t.spaceName,o=t.addressName,a=t.spaceCategory,s=c(c(c(c(c(c(c({},Ce,r),De,i),Ve,n?n.charAt(0).toUpperCase()+n.slice(1).toLowerCase():""),He,a?a.charAt(0).toUpperCase()+a.slice(1).toLowerCase():""),je,o),Re,o),Ge,o),u=this.theme.spaceRules,l="",h=a&&n&&u[a]&&u[a].spaceTypes&&u[a].spaceTypes[n].behavioralAppearance.default.labelType;if("NONE"===h){if(!this.labelTextPreference)return"";s[Ve]=""}var d=a&&n&&u[a]&&u[a].properties&&u[a].properties.behavioralAppearance&&u[a].properties.behavioralAppearance.default&&u[a].properties.behavioralAppearance.default.labelType;if(("NONE"===d||void 0===d)&&void 0===h){if(!this.labelTextPreference)return"";s[Ve]="",s[He]=""}var f=a&&n&&u[a]&&u[a].properties&&u[a].properties.behavioralAppearance&&u[a].properties.behavioralAppearance.default&&u[a].properties.behavioralAppearance.default.labelTextPreference,p=f&&this.labelTextPreference?this.labelTextPreference:f;if(p)for(var v=0;v<p.length;v++)if(s[p[v]]){l=s[p[v]];break}return l}}])}(),Xt=function(){return l((function e(t){var n=t.apiKey,r=t.baseUrl,i=t.token,o=t.hrn;a(this,e);var s={apiKey:n,url:r,token:i,hrn:o};this.hostOptions_=s,this.momData=[],this.theme={},this.loadOptions={}}),[{key:"setHostOptions",value:function(e){0===Object.keys(e).length||(this.hostOptions_=g(g({},this.hostOptions_),e))}},{key:"getToken",value:function(){return this.hostOptions_.token}},{key:"getHrn",value:function(){return this.hostOptions_.hrn}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadOptions=g(g(g({},rt),n),{},{venueId:e}),this.hostOptions_.mapData=n.mapData,this.hostOptions_.themeRule=n.themeRule,this.hostOptions_.svgList=n.svgList,this.hostOptions_.labelTextPreference=n.labelTextPreferenceOverride,this.getHrn()?this.getVenueModalInstance():this.getToken()?this.getDefaultCollectionWithToken().then((function(){return t.getVenueModalInstance()})).catch((function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))})):Promise.reject(new Error("In order to load indoor map, Please provide either hrn or token"))}},{key:"getVenueModalInstance",value:function(){var e=this;return Promise.resolve().then((function(){return e.loadOptions.isMetaEnabled?e.getMeta_(e.loadOptions.isIconsEnabled).catch((function(e){return console.warn(e),Promise.resolve()})):Promise.reject()})).then((function(t){return e.getVenue_(t)})).then((function(e){return e})).catch((function(e){console.debug("Captured event VENUE_ERROR_STATE",e)}))}},{key:"initializeMomStructure",value:function(){return{site:{},structure:{},level:{},levelConnector:{},occupant:{},spaces:{},spaceGroups:{},topology:{},address:{},outdoorLevelMapping:{},entrance:{},levelStructureMapping:{}}}},{key:"createMomStructure",value:function(){var e=this,t=this.initializeMomStructure();return this.momData.forEach((function(n){var r=Vt.getFormattedIndoorMapId(e.loadOptions.venueId),i=n.id;if(n.momType===Pe.ADDRESS||e.hostOptions_.mapData||n.properties.indoorMapId==e.loadOptions.venueId||n.properties.indoorMapId===r)if(n.momType===Pe.SITE)t.site=Ht.setSite(n,e.loadOptions.venueId);else if(n.momType===Pe.STRUCTURE)t.structure[i]=Ht.setStructure(n);else if(n.momType!==Pe.LEVEL||n.properties.isOutdoor&&(!n.properties.isOutdoor||n.properties.parentIndoorLevel)){if(n.momType===Pe.ENTRANCE)t.entrance[i]=Ht.setEntrance(n);else if(n.momType===Pe.OCCUPANT)t.occupant[i]=Ht.setOccupant(n);else if(n.momType===Pe.SPACE)t.spaces[i]=Ht.setSpace(n);else if(n.momType===Pe.SPACEGROUPS)t.spaceGroups[i]=Ht.setSpaceGroups(n);else if(n.momType===Pe.ADDRESS)t.address[i]=Ht.setAddress(n);else if(n.momType===Pe.LEVEL&&n.properties.isOutdoor&&n.properties.parentIndoorLevel){var o=n.properties.parentIndoorLevel.id;t.outdoorLevelMapping[n.id]=o}}else t.level[i]=Ht.setLevel(n),t.levelStructureMapping[i]=n.properties.structure.id})),t.theme=this.theme,t.labelTextPreference=this.hostOptions_.labelTextPreference,new Jt(t)}},{key:"getVenue_",value:function(e){this.momData=e.getMomData();var t=this.createMomStructure();return t.setLevelWiseGeometry(),new Wt(t,e)}},{key:"setConfigData",value:function(e){var t=e.themeRule,n=e.svgList,r=e.defaultLang;Gt.setSpaceRules(t.spaceRules),Ht.svgList=n,Ht.themeRule=t,Ht.defaultLang=r,this.theme=t}},{key:"getMeta_",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=new Ct,r=this.hostOptions_.mapData?{}:this.getMetaConfig_(this.loadOptions.venueId,xe.SITE),i=this.hostOptions_.themeRule||this.getMetaConfig_(this.loadOptions.venueId,xe.Theme),o=[];return t&&(o=this.hostOptions_.svgList||this.getMetaConfig_(this.loadOptions.venueId,xe.IMAGES)),new Promise((function(a){Promise.all([r,i,o]).then((function(r){var i=E(r,3),o=i[0],s=i[1],u=i[2],l=e.hostOptions_.mapData?{mom:new Promise((function(t){return t(e.hostOptions_.mapData)})),site:e.hostOptions_.mapData.features.find((function(e){return e.momType===Pe.SITE}))}:zt.getMomData(o,e.hostOptions_);l.mom.then((function(r){var i=s.properties;n.imageCache=t?Ht.manageSvgDimensions(u.properties):[],e.setConfigData({themeRule:i,svgList:n.imageCache,defaultLang:l&&l.site&&l.site.properties.defaultLanguageCode}),n.releaseSettings_={displayOptions:{display:i.entranceRules.default.displayName||We.STANDARD},mom:r.features},n.theme=new Pt(i,n),a(n)}))}))}))}},{key:"getMetaConfig_",value:function(e,t){return zt.getConfigUrl(e,t,this.hostOptions_)}},{key:"fetchCollections",value:function(){return zt.getIndoorMapsCollectionList(this.hostOptions_)}},{key:"fetchUserProjects",value:function(){return zt.getProjectAccountDetails(this.hostOptions_)}},{key:"getDefaultCollectionWithToken",value:(e=i(y().mark((function e(){var t=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.fetchCollections(),this.fetchUserProjects()]).then((function(e){var n=E(e,2),r=n[0],i=n[1],o=t.getDefaultCollection(r,i);if(o.hrn){var a={hrn:o.hrn};return t.setHostOptions(a),Promise.resolve()}return Promise.reject()})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"getDefaultCollection",value:function(e,t){if(Array.isArray(e)&&e.length){var n=this.getProjectRealm(t);return e.find((function(e){return e.hrn.includes(n)}))}return Promise.reject(new Error("Error while accessing default collection"))}},{key:"getProjectRealm",value:function(e){if(Array.isArray(e.items)&&e.items.length&&e.items[0].id.includes("indoor-")){var t=e.items[0].hrn;return this.getRealmNameFromHrn(t)}return""}},{key:"getRealmNameFromHrn",value:function(e){if(e){var t=e.split(":");return t.length&&t[4]}return""}},{key:"getSupportedMapList",value:function(){var e=this,t=this.hostOptions_,n=t.hrn,r=t.token;return n?this.fetchMapInfoList():r?this.getDefaultCollectionWithToken().then((function(){return e.fetchMapInfoList()})).catch((function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))})):Promise.reject(new Error("In order to load map list, Please provide either hrn or token"))}},{key:"fetchMapInfoList",value:function(){var e=this;return zt.fetchIndoorMapList(this.hostOptions_).then((function(t){var n=t.features;return n.length>0?n.map((function(t){var n=t.properties,r=n.placeProperties,i=n.indoorMapId,o=i;if(Vt.validateIsMicelloId(i)){var a=i.split("-").pop();o=parseInt(a.substring(a.length-Math.min(a.length,5)),10).toString()}return{mapIdentifier:i,mapName:e.getMapName(r.names).name,mapId:o}})):[]})).catch((function(e){Promise.reject(new Error("".concat(e,": Error while fetching map list")))}))}},{key:"getMapName",value:function(e){return Array.isArray(e)&&e.length>0?e.find((function(e){return"OFFICIAL"===e.nameType})):{}}}]);var e}(),Kt=["origin","destination"],Qt=at[ot.DEV],qt=function(){return l((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,e),!t.token)throw new Error("Token is mandatory in order to initialize the indoor routing service");this.config_=g({baseUrl:Qt},t)}),[{key:"calculateRoute",value:function(e){var t=e.origin,n=void 0===t?{}:t,r=e.destination,i=void 0===r?{}:r,o=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,Kt),a={method:"GET"};if(!n.coordinates||!i.coordinates)throw new Error("Waypoint coordinates are missing");if(!n.venueId||!i.levelId)throw new Error("venueId or levelId are missing");var s=function(e){var t=e.coordinates,n=e.venueId,r=e.levelId,i=t.join(",");return n&&r?i.concat(";indoorMapId=",n,";levelId=",r):i},u=new URL("".concat(this.config_.baseUrl,"/v1/routes")),l=new URLSearchParams({origin:s(n),destination:s(i)});return this.config_.token&&(a.headers={Authorization:"Bearer ".concat(this.config_.token)}),Object.entries(o).forEach((function(e){var t=E(e,2),n=t[0],r=t[1];l.append(n,"object"===S(r)?JSON.stringify(r):r)})),u.search=l,zt.get(u,a)}}])}(),$t={VENUE_DATA_LOADED:"VENUE_DATA_LOADED",VENUE_THEME_LOADED:"VENUE_THEME_LOADED",VENUE_ICONS_LOADED:"VENUE_ICONS_LOADED",VENUE_MOM_DATA_LOADED:"VENUE_MOM_DATA_LOADED",VENUE_ERROR_STATE:"VENUE_ERROR_STATE",VENUE_MAP_DATA_LOADED:"VENUE_MAP_DATA_LOADED",VENUE_ENTITY_DATA_LOADED:"VENUE_ENTITY_DATA_LOADED",VENUE_DATA_MODEL_LOADED:"VENUE_DATA_MODEL_LOADED",VENUE_NAV_DATA_LOADED:"VENUE_NAV_DATA_LOADED",META_DATA_LOADED:"META_DATA_LOADED",META_DATA_MODEL_LOADED:"META_DATA_MODEL_LOADED",META_DATA_MODEL_UPDATED:"META_DATA_MODEL_UPDATED"};Object.freeze(c(c(c(c(c(c(c(c(c({},$t.VENUE_DATA_LOADED,{description:"event fired when all requested files along with metadata & overrides are loaded",emitTemplate:{}}),$t.VENUE_MAP_DATA_LOADED,{description:"event fired when requested levels, drawings & community files are loaded",emitTemplate:{}}),$t.VENUE_ENTITY_DATA_LOADED,{description:"event fired when requested entity data is loaded",emitTemplate:{}}),$t.VENUE_DATA_MODEL_LOADED,{description:"event fired when a map file is loaded",emitTemplate:{}}),$t.VENUE_NAV_DATA_LOADED,{description:"event fired when requested navigation product is loaded",emitTemplate:{}}),$t.META_DATA_LOADED,{description:"event fired when all requested meta files are loaded except icon & marker",emitTemplate:{}}),$t.META_DATA_MODEL_LOADED,{description:"event fired when a specific model is loaded except icon & marker",emitTemplate:{}}),$t.META_DATA_MODEL_UPDATED,{description:"event fired when a specific meta override is added or removed",emitTemplate:{}}),$t.VENUE_ICONS_LOADED,{description:"event fired when all icons of venue are loaded",emitTemplate:{}}));var en=new ht;en.EVENT_NAME=$t,en.on("newListener",(function(e){$t[e]||console.warn("subscribing for un-registered/documented event")}));var tn=function(){function e(t){var n;if(a(this,e),n=o(this,e),!(t instanceof Wt))throw new Error("It is mandatory to provide valid instance of venueModel");return n.venueModel=t,n.search_=new we(t),n.status_={activeDrawingId:t.getRootDrawing().getIdentifier(),activeLevelIndex:t.getRootDrawing().getMainLevel().getZIndex()},n.mapObjectStore_=n.getDefaultMapObjectsStore_(),n.drawings=t.getDrawings().map((function(e){var t=new A(e);return t.setParentEventTarget(n),t})),n.levels=t.getLevels().map((function(e){var t=new T(e);return t.setParentEventTarget(n.drawings.find((function(e){return e.getIdentifier()===t.getData().getDrawing().getIdentifier()}))),t})),n.geometries=t.getGeometries().map((function(e){var t=new M(e);return t.setParentEventTarget(n.levels.find((function(e){return e.getIdentifier()===t.getData().getLevel().getIdentifier()}))),t})),n.mutualExclusiveHighlight_=!1,n}return f(e,H.map.Feature),l(e,[{key:"getData",value:function(){return this.venueModel}},{key:"getBoundingBox",value:function(){return s(H.geo.Rect,_(this.venueModel.getBoundingBox()))}},{key:"getCenter",value:function(){var e=E(this.venueModel.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.venueModel.getId()}},{key:"getIdentifier",value:function(){return this.venueModel.getIdentifier()}},{key:"getName",value:function(){return this.venueModel.getName()}},{key:"getDrawing",value:function(e){return this.drawings.find((function(t){return t.getIdentifier()===e}))}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getLevel",value:function(e){return this.levels.find((function(t){return t.getIdentifier()===e}))}},{key:"getLevels",value:function(){return this.levels}},{key:"getGeometry",value:function(e){return this.getGeometries().find((function(t){return t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.geometries}},{key:"getActiveLevels",value:function(){var e=this;return this.getData().getDisplaySettings()===We.FLATTEN?this.venueModel.getLevelsByZIndex(this.status_.activeLevelIndex).map((function(t){return e.getLevel(t.getIdentifier())})):[this.venueModel.getDrawingById(this.status_.activeDrawingId).getLevelByZIndex(this.status_.activeLevelIndex)].map((function(t){return e.getLevel(t.getIdentifier())}))}},{key:"getActiveDrawing",value:function(){return this.getDrawing(this.status_.activeDrawingId)}},{key:"setActiveDrawing",value:function(t){if(this.status_.activeDrawingId!==t){var n=this.venueModel.getDrawingById(t);if(!n)throw new Error("Drawing ".concat(t," was not found"));var r=this.status_.activeDrawingId;this.status_.activeDrawingId=n.id,this.setActiveLevelIndex(n.getMainLevel().getZIndex()),this.dispatchEvent(new H.util.ChangeEvent(e.EVENTS.DRAWING_CHANGE,t,r))}}},{key:"getActiveLevelIndex",value:function(){return this.status_.activeLevelIndex}},{key:"setActiveLevelIndex",value:function(t){if(this.venueModel.getLevelsByZIndex(t)){var n=this.status_.activeLevelIndex;this.status_.activeLevelIndex=t,this.dispatchEvent(new H.util.ChangeEvent(e.EVENTS.LEVEL_CHANGE,t,n))}}},{key:"isActive",value:function(){var e=this.getParentEventTarget();return!!e&&this===e.activeVenue}},{key:"getHighlightedGeometries",value:function(){var e=this;return this.venueModel.getGeometries().filter((function(e){return e.isHighlighted()})).map((function(t){return e.getGeometry(t.getIdentifier())}))}},{key:"setHighlightedGeometries",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=g(g({},le),r),a=o.fillColor,s=o.outlineColor,u=o.outlineWidth;(this.mutualExclusiveHighlight_=!!i,this.mutualExclusiveHighlight_)&&this.getHighlightedGeometries().forEach((function(e){e.getData().highlight(!1)}));n.forEach((function(e){e.getData().highlight(t,{m:a,o:s,w:u})})),this.dispatchEvent(e.EVENTS.GEOMETRY_HIGHLIGHT)}},{key:"getMapObjects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getActiveLevelIndex(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getActiveDrawing();return this.mapObjectStore_[e][t.getIdentifier()]}},{key:"setMapObjects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getActiveLevelIndex(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getActiveDrawing();this.mapObjectStore_[t]&&this.mapObjectStore_[t][n.getIdentifier()]&&(this.mapObjectStore_[t][n.getIdentifier()]=_(e)),this.updateMapObjectsVisibility_()}},{key:"search",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.search_.find(t).flatMap((function(t){return t.geometries.map((function(t){return e.getGeometry(t.id)}))}))}},{key:"updateMapObjectsVisibility_",value:function(){Object.values(this.mapObjectStore_).forEach((function(e){Object.values(e).forEach((function(e){return e.forEach((function(e){return e.setVisibility(!1)}))}))})),this.isActive()&&this.mapObjectStore_[this.getActiveLevelIndex()][this.getActiveDrawing().getIdentifier()].forEach((function(e){return e.setVisibility(!0)}))}},{key:"getDefaultMapObjectsStore_",value:function(){var e=this,t=this.getData().getDisplaySettings()===We.FLATTEN;return this.venueModel.getLevels().reduce((function(n,r){var i=r.getZIndex(),o=g({},n);return o[i]||(o[i]={}),o[i][r.getDrawing().getIdentifier()]=[],t&&(o[i][e.venueModel.getRootDrawing().getIdentifier()]=[]),o}),{})}}])}();tn.EVENTS={ACTIVE_VENUE_CHANGE:"activevenuechange",DRAWING_CHANGE:"drawingchange",LEVEL_CHANGE:"levelchange",GEOMETRY_HIGHLIGHT:"geometryhighlight"};var nn=function(){return l((function e(){a(this,e)}),null,[{key:"getIconLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.isIcon()&&e.getIcon()})).map((function(e){var t=E(e.getLabelArea(),2),n=t[0],r=t[1],i=e.getLevel(),o=e.getIcon(),a=e.properties.spaceType||e.properties.spaceCategory||e.getDisplayName();return{type:"Feature",properties:{id:e.getIdentifier(),geometryId:e.getIdentifier(),levelId:i.getIdentifier(),name:a,venueId:i.getDrawing().getVenueModel().getIdentifier(),url:o?"data:image/svg+xml;utf8,".concat(encodeURIComponent(o)):""},geometry:{type:ne,coordinates:[n,r]}}}))}}},{key:"getLabelLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.getDisplayName()&&!e.isIcon()})).map((function(e){var t=E(e.getLabelArea(),2),n=t[0],r=t[1],i=e.getLabelStyle(),o=i.fill,a=i.zmin,s=e.getLevel();return{type:"Feature",properties:{id:e.getIdentifier(),geometryId:e.getIdentifier(),levelId:s.getIdentifier(),venueId:s.getDrawing().getVenueModel().getIdentifier(),name:e.getDisplayName(),minZoom:a||15,textFillColor:o.toLowerCase()},geometry:{type:ne,coordinates:[n,r]}}}))}}},{key:"getGeometryLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.getType()!==ne})).map((function(e){var t=e.getHighlightedStyle()||{},n=t.m,r=t.o,i=t.w,o=g({},e.getStyle()),a=o.m,s=o.o,u=o.w,l=se,c=l.fillColor,h=l.outlineColor,d=l.outlineWidth,f=e.getLevel();return{type:"Feature",properties:{id:e.getIdentifier(),fillColor:(n||a||c).toLowerCase(),geometryId:e.getIdentifier(),levelId:f.getIdentifier(),venueId:f.getDrawing().getVenueModel().getIdentifier(),outlineColor:(r||s||h).toLowerCase(),outlineWidth:Number(((i||u||d)/3).toFixed(2)),zIndex:e.getZIndex()},geometry:{type:e.getType(),coordinates:e.getCoordinates()}}}))}}},{key:"getFootprintLayer",value:function(e){return{type:"FeatureCollection",features:e.flatMap((function(e){return e.getData().getLevels().map((function(t){var n=t.getGeometries().map((function(e){return e.zIndex})).filter((function(e){return void 0!==e})),r=t.getGeometries().map((function(e){return e.properties.stackIndex})).filter((function(e){return void 0!==e})),i=Math.max.apply(Math,_(r))||1,o=Math.max.apply(Math,_(n))||1,a=t.getIdentifier(),s=e.getLevel(a).getData().levelData.geometry;return{type:"Feature",properties:{isFootprint:!0,levelId:a,venueId:e.getIdentifier(),zIndex:o+1,priority:i+1},geometry:{type:"MultiPolygon",coordinates:s.coordinates}}}))}))}}}])}(),rn=function(){return l((function e(){a(this,e)}),null,[{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={styles:[{dataLayer:fe.FOOTPRINT,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#4E5663",width:["interpolate",["linear"],["zoom"],0,"1px",6,"1px",7,"2px",18,"2px",19,"4px",24,"4px"],renderOrder:["get","zIndex"]},{dataLayer:fe.FOOTPRINT,when:["==",["geometry-type"],"Point"],technique:"text",color:"black",size:16,text:["get","venueName"],priority:["get","priority"]},{dataLayer:fe.VECTOR,when:["==",["geometry-type"],"Polygon"],technique:"polygon",color:["get","fillColor"],renderOrder:["get","zIndex"]},{dataLayer:fe.VECTOR,technique:"solid-line",color:["get","outlineColor"],width:["get","outlineWidth"],renderOrder:["get","zIndex"]},{dataLayer:fe.TEXT,minZoomLevel:["get","minZoom"],technique:"text",color:["get","textFillColor"],size:ue.size,text:["get","name"],priority:60},{dataLayer:fe.ICON,minZoomLevel:ce,when:["==",["geometry-type"],"Point"],technique:"labeled-icon",textIsOptional:!0,size:0,text:["get","name"],imageTexture:["concat","texture",["get","name"]],screenWidth:["interpolate",["linear"],["zoom"],15,3,21,70],screenHeight:["interpolate",["linear"],["zoom"],15,3,21,70],priority:61}],images:{},imageTextures:[]};return e.forEach((function(e){var t="texture"+e.properties.name;n.images[t]||(n.images[t]={url:e.properties.url,preload:!0},n.imageTextures.push({name:t,image:t}))})),t.forEach((function(e){var t,r=e.getData().getHighlightedStyle(),i=r.m,o=r.o,a=r.w;(t=n.styles).push.apply(t,[{dataLayer:fe.VECTOR,when:["==",["get","id"],e.id],technique:"polygon",color:i,renderOrder:["get","zIndex"]},{dataLayer:fe.VECTOR,when:["==",["get","id"],e.id],technique:"solid-line",color:o,width:a,renderOrder:["get","zIndex"]}])})),new H.map.render.harp.Style(n)}}])}(),on=function(){function e(){a(this,e)}return l(e,null,[{key:"getIconsTextures",value:function(){var e={},t={},n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(e,t){var n=t.properties.name;return e[n]||(e[n]=[]),e[n].push(t),e}),{});return Object.keys(n).forEach((function(r){var i="texture".concat(r),o="sprite".concat(r),a=n[r][0].properties.url;e[i]={url:a,sprites:c({},o,[0,0,50,50])},n[r].forEach((function(e){var n=e.properties;t["icon".concat(n.name)]={filter:{name:n.name,$zoom:{min:ce}},draw:{points:{interactive:!0,priority:1,size:[[15,"50%"],[16,"55%"],[17,"60%"],[18,"65%"],[19,"75%"],[20,"80%"],[21,"100%"]],texture:i,sprite:o}}}}))})),{textures:e,iconLayers:t}}},{key:"getFootprintLayer",value:function(){return{data:{source:"venues",layer:fe.FOOTPRINT},draw:{lines:{color:"#4E5663",width:[[0,"1px"],[6,"1px"],[7,"2px"],[18,"2px"],[19,"4px"],[24,"4px"]],order:"function() { return feature.zIndex }"},points:{color:"[0, 0, 0, 0]",size:"0px",order:3,priority:"function() { return feature.priority }",text:{anchor:"center",collide:!1,font:{fill:"black",size:"16px"},text_source:"function() { return feature.venueName }"}}}}}},{key:"getGeometryLayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={};if(e.length){var n=e[0].getData().getHighlightedStyle(),r=n.m,i=n.o,o=n.w;t={filter:{id:e.map((function(e){return e.id}))},draw:{polygons:{interactive:!0,color:r},lines:{color:i,width:o}}}}return{data:{source:"venues",layer:fe.VECTOR},draw:{polygons:{interactive:!0,color:"function() { return feature.fillColor }",order:"function() { return feature.zIndex }"},lines:{color:"function() { return feature.outlineColor }",order:"function() { return feature.zIndex }",width:"function() { return feature.outlineWidth }"}},highlighted:t}}},{key:"getTextLayer",value:function(){return{filter:{$zoom:{min:he}},data:{source:"venues",layer:fe.TEXT},draw:{points:{filter:"function() { return $zoom > feature.minZoom }",color:"[0, 0, 0, 0]",size:"0px",offset:["0px","-10px"],priority:2,text:{font:{fill:"function() { return feature.textFillColor }",size:ue.size},text_source:"function() { return feature.name }"}}}}}},{key:"getIconLayer",value:function(e){return g({data:{source:"venues",layer:fe.ICON}},e)}},{key:"getStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.getIconsTextures(t),i=r.textures,o=r.iconLayers,a={venue_footprints:e.getFootprintLayer(),venue_geometries:e.getGeometryLayer(n),venue_labels:e.getTextLayer(),venue_icons:e.getIconLayer(o)},s=H.gl.yaml.dump({sources:{venues:{max_zoom:de,type:"GeoJSONTileSource"}},layers:a,textures:i});return new H.map.render.webgl.Style(s)}}])}(),an={type:"FeatureCollection",features:[]},sn={extent:4096,indexMaxZoom:0,maxZoom:24,tolerance:3},un=function(){function e(t){var n;return a(this,e),(n=o(this,e,[t])).venues=[],n.activeVenue=null,n.dataLayers_={},n.tileIndexes_={},n.addEventListener(tn.EVENTS.ACTIVE_VENUE_CHANGE,n.activeVenueChangeHandler_,void 0,n),n}return f(e,H.map.provider.RemoteTileProvider),l(e,[{key:"setStyle",value:function(e){return this.setStyleInternal(e)}},{key:"getStyle",value:function(){return this.getStyleInternal()}},{key:"isFeatureVisible_",value:function(e){var t=e.properties;return!!this.activeVenue.getActiveLevels().some((function(e){return e.id===t.levelId}))}},{key:"requestInternal",value:function(e,t,n,r){var i=this,o=function(r){for(var i=0;i<r.length;i+=1)r[i]=r[i].map((function(r){return be(r,n,e,t,sn.extent)}))},a={};return Object.keys(this.tileIndexes_).forEach((function(r){var s=i.tileIndexes_[r].getTile(n,e,t);a[r]=s?function(e){var t=[],n=e&&e.features;if(n)for(var r=0,i=n.length;r<i;r+=1){var o=n[r],a=o.type,s=void 0,u=!1;switch(a){case ve:s={type:ie,coordinates:o.geometry.map((function(e){return e.slice()}))};break;case ge:case ye:s={type:oe,coordinates:o.geometry.map((function(e){return e.map((function(e){return e.slice()}))}))},a===ye&&null==(s=_e(s))&&(u=!0);break;default:u=!0}u||t.push({geometry:s,id:o.id,properties:o.tags,type:"Feature"})}return{type:"FeatureCollection",features:t}}(s):an,a[r].features=a[r].features.filter((function(e){return i.isFeatureVisible_(e)}));for(var u=0;u<a[r].features.length;u+=1){var l=a[r].features[u],c=l.geometry.type;if(c===re||c===oe)o(l.geometry.coordinates);else if(c===ae)l.geometry.coordinates.map(o);else for(var h=l.geometry.coordinates,d=0;d<h.length;d+=1)h[d]=be(h[d],n,e,t,sn.extent)}})),r(a),{cancel:function(){}}}},{key:"getActiveVenue",value:function(){return this.activeVenue}},{key:"getVenue",value:function(e){return e?this.venues.find((function(t){return t.getIdentifier()===e})):this.activeVenue}},{key:"setActiveVenue",value:function(e){var t=this.activeVenue;this.activeVenue=e,this.dispatchEvent(new H.util.ChangeEvent(tn.EVENTS.ACTIVE_VENUE_CHANGE,e,t)),this.reload()}},{key:"addVenue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(e instanceof tn))throw new Error("Invalid argument");var n=e.getIdentifier();if(this.getVenue(n))throw new Error("Please invoke provider.removeVenue to remove old instance of venue ".concat(n," before adding new"));e.setParentEventTarget(this),this.venues.push(e),t||(this.reloadData_(),this.reloadStyle_())}},{key:"addVenues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length>0&&(t.forEach((function(t){t instanceof tn&&e.addVenue(t,!0)})),this.reloadData_(),this.reloadStyle_())}},{key:"removeVenue",value:function(e){if(e instanceof tn&&this.venues.indexOf(e)>-1){var t=e.getIdentifier();this.activeVenue&&this.activeVenue.getIdentifier()===t&&this.setActiveVenue(null),this.venues.splice(this.venues.indexOf(e),1),this.reloadData_(),this.reloadStyle_(),this.reload()}}},{key:"getFeatureProxy",value:function(e,t,n){var r=e.geometryId,i=e.venueId,o=this.getVenue(i);return r?n(o.getGeometries().find((function(e){return e.id===r}))):o&&n(o),!0}},{key:"addVenueEventListeners_",value:function(e){e&&(e.addEventListener(tn.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),e.addEventListener(tn.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),e.addEventListener(tn.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"removeVenueEventListeners_",value:function(e){e&&(e.removeEventListener(tn.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),e.removeEventListener(tn.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),e.removeEventListener(tn.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"activeVenueChangeHandler_",value:function(e){var t=e.oldValue,n=e.newValue;t&&(this.removeVenueEventListeners_(t),t.updateMapObjectsVisibility_()),n&&(this.addVenueEventListeners_(n),n.updateMapObjectsVisibility_())}},{key:"drawingChangeHandler_",value:function(){this.reload()}},{key:"levelChangeHandler_",value:function(){this.activeVenue&&(this.activeVenue.updateMapObjectsVisibility_(),this.reload())}},{key:"geometryHighlightHandler_",value:function(){this.reloadStyle_(this.activeVenue.getHighlightedGeometries())}},{key:"createDataLayers_",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(fe),n=fe.FOOTPRINT,r=fe.ICON,i=fe.TEXT,o=fe.VECTOR;t.forEach((function(t){switch(t){case o:e.dataLayers_[o]=nn.getGeometryLayer(e.venues);break;case n:e.dataLayers_[n]=nn.getFootprintLayer(e.venues);break;case r:e.dataLayers_[r]=nn.getIconLayer(e.venues);break;case i:e.dataLayers_[i]=nn.getLabelLayer(e.venues);break;default:throw new Error("Unsupported Layer ".concat(t))}}))}},{key:"createTileIndexes_",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(fe)).forEach((function(t){e.tileIndexes_[t]=new ee(e.dataLayers_[t],sn)}))}},{key:"reloadData_",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(fe);this.createDataLayers_(e),this.createTileIndexes_(e)}},{key:"reloadStyle_",value:function(e){var t=this.dataLayers_[fe.ICON]?this.dataLayers_[fe.ICON].features:[];this.getEngineType()===H.Map.EngineType.WEBGL?this.setStyle(on.getStyle(t,e)):this.getEngineType()===H.Map.EngineType.HARP&&this.setStyle(rn.getStyle(t,e))}},{key:"providesGeoJSON",value:function(){return!0}}])}(),ln=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),cn=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),hn=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImIiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PG1hc2sgaWQ9ImMiIHdpZHRoPSIzOCIgaGVpZ2h0PSI0NiIgeD0iMCIgeT0iMCIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjYSIvPjwvbWFzaz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZWxsaXBzZSBjeD0iMjAiIGN5PSI0NS4xNiIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjOTc5Nzk3IiBzdHJva2Utd2lkdGg9Ii4yNSIgcng9IjMuNSIgcnk9IjMuNSIvPjx1c2UgZmlsbD0iIzAxQjZCMiIgeGxpbms6aHJlZj0iI2IiLz48cGF0aCBmaWxsPSIjMzIzMjMyIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNMTEuODEgMzcuNjZoMTYuMzhsLTguMiA4eiIvPjx1c2Ugc3Ryb2tlPSIjNDE2QTg2IiBzdHJva2Utd2lkdGg9Ii41IiBtYXNrPSJ1cmwoI2MpIiB4bGluazpocmVmPSIjYSIvPjxlbGxpcHNlIGN4PSIxOS44MSIgY3k9IjE5LjE5IiBmaWxsPSIjRkZGIiByeD0iNC44MSIgcnk9IjQuODEiLz48L2c+PC9zdmc+"),dn=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzMi44MyAzMy4xMDRjLjQwNy0uMzc0IDEuNDE5LTEuNDUyIDEuNDE5LTEuNDUyeiIvPjxtYXNrIGlkPSJjIiB3aWR0aD0iMzgiIGhlaWdodD0iNDYiIHg9IjAiIHk9IjAiIGZpbGw9IiNmZmYiPjx1c2UgeGxpbms6aHJlZj0iI2EiLz48L21hc2s+PGVsbGlwc2UgaWQ9ImIiIGN4PSIxOS44MDciIGN5PSIxOS4xNjgiIHJ4PSIxMi4zNjMiIHJ5PSIxMi4xOTciLz48bWFzayBpZD0iZCIgd2lkdGg9IjI1LjcyNSIgaGVpZ2h0PSIyNS4zOTQiIHg9Ii0uNSIgeT0iLS41Ij48cGF0aCBmaWxsPSIjZmZmIiBkPSJNNi45NDQgNi40NzFoMjUuNzI1djI1LjM5NEg2Ljk0NHoiLz48dXNlIHhsaW5rOmhyZWY9IiNiIi8+PC9tYXNrPjwvZGVmcz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxlbGxpcHNlIGN4PSIyMCIgY3k9IjQ1LjE2IiBmaWxsPSIjRkZGIiBzdHJva2U9IiM5Nzk3OTciIHN0cm9rZS13aWR0aD0iLjI1IiByeD0iMy41IiByeT0iMy41Ii8+PHVzZSBmaWxsPSIjMzIzMjMyIiB4bGluazpocmVmPSIjYSIvPjxwYXRoIGZpbGw9IiM3RDdEN0QiIGQ9Ik0xMi4wMTEgMzcuODA1aDE1Ljk3OGwtNy45MTYgOHoiLz48dXNlIHN0cm9rZT0iIzdDN0M3QyIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNlKSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIHN0cm9rZT0iI0ZGRiIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNjKSIgeGxpbms6aHJlZj0iI2EiLz48ZWxsaXBzZSBmaWxsPSIjRkZGIiBjeD0iMTkuODA3IiBjeT0iMTkuMTY4IiByeD0iMTIuMzYzIiByeT0iMTIuMTk3Ii8+PHBhdGggZmlsbD0iIzMyMzIzMiIgZD0iTTYuODEyIDYuOTQ4aDYuNDV2Ni4zNjRoLTYuNDV6bTAgMTIuNzI3aDYuNDV2Ni4zNjRoLTYuNDV6bTYuNDUtNi4zNjNoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS0xOS4wOTFoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS02LjM2M2g2LjQ1djYuMzY0aC02LjQ1em0wIDEyLjcyN2g2LjQ1djYuMzY0aC02LjQ1eiIvPjx1c2Ugc3Ryb2tlPSIjRkZGIiBtYXNrPSJ1cmwoI2QpIiB4bGluazpocmVmPSIjYiIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIvPjwvZz48L3N2Zz4="),fn=function(e,t,n){return n===pn.ObjectType.SEGMENT_START_MARKER?0===e?hn:null:n===pn.ObjectType.SEGMENT_FINISH_MARKER?1===t.length||e===t.length-1?dn:null:"indoor"===t[e].departure.place.type?ln:cn},pn=function(){function e(t,n){a(this,e),this.indoorMapObjects_=null,this.outdoorMapObjects_=null,this.createRouteObjects_(t,n)}return l(e,[{key:"createRouteObjects_",value:function(t){var n=this,r=t.sections,i=void 0===r?[]:r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fn;this.indoorMapObjects_={},this.outdoorMapObjects_=new H.map.Group;for(var a=function(){var t,r,a=i[s],u=a.departure.place,l=u.id,c=u.type,h=H.util.flexiblePolyline.decode(a.polyline).polyline,d=o(s,i,e.ObjectType.SEGMENT_START_MARKER);d&&(t=new H.map.Marker(a.departure.place.location,{icon:d}));var f=o(s,i,e.ObjectType.SEGMENT_FINISH_MARKER);f&&(r=new H.map.Marker(a.arrival.place.location,{icon:f}));var p=o(s,i,e.ObjectType.SEGMENT_POLYLINE);if("indoor"===c){var v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new Map,n=new H.geo.LineString,r=E(e[0],3)[2];return t.set(r,[n]),e.forEach((function(e){var i;e[2]!==r&&(r=e[2],n=new H.geo.LineString,t.has(r)?t.get(r).push(n):t.set(r,[n])),(i=n).pushLatLngAlt.apply(i,_(e))})),t}(h),y=Array.from(v.keys()).reduce((function(e,t){return e[t]||(e[t]=new H.map.Group),e}),{});p&&v.forEach((function(e,t){e.forEach((function(e){if(e.getPointCount()>1){var n=new H.map.Polyline(e,{style:p});y[t].addObject(n)}}))})),t&&y[a.departure.place.location.lvl].addObject(t),r&&y[a.arrival.place.location.lvl].addObject(r),n.indoorMapObjects_[l]=g(g({},n.indoorMapObjects_[l]||{}),y)}else{if(p){var m=new H.geo.LineString(h.flatMap((function(e){return[e[0],e[1],0]}))),I=new H.map.Polyline(m,{style:p});n.outdoorMapObjects_.addObject(I)}t&&n.outdoorMapObjects_.addObject(t),r&&n.outdoorMapObjects_.addObject(r)}},s=0;s<i.length;s++)a()}},{key:"getIndoorObjects",value:function(){return this.indoorMapObjects_}},{key:"getOutdoorObjects",value:function(){return this.outdoorMapObjects_}}])}();pn.ObjectType={SEGMENT_START_MARKER:1,SEGMENT_FINISH_MARKER:2,SEGMENT_POLYLINE:3};var vn=function(){function e(t){var n;a(this,e),n=o(this,e,[e,g(g({},t),{},{baseUrl:void 0})]);var r={apiKey:t.apikey,baseUrl:t.baseUrl,token:t.token},i={apiKey:r.apiKey,token:r.token};r.apiKey||(r.apiKey=n.getUrl().getQuery().apikey);var s=t.useLegacy||!1;return n.venueService_=new Xt(r,s),i.apiKey||(i.apiKey=n.getUrl().getQuery().apikey),t.routingBaseUrl&&(i.baseUrl=t.routingBaseUrl),t.token&&(n.routingService_=new qt(i)),n}return f(e,H.service.Service),l(e,[{key:"loadVenue",value:function(e){return console.warn("Venue service version 1 is no longer supported hence "+e+" could not be loaded"),Promise.resolve()}},{key:"calculateRoute",value:function(e){return console.warn("HERE Indoor Routing is deprecated and will be removed soon."),this.routingService_.calculateRoute(e)}}])}();vn.CONFIG_KEY="venues";var gn=function(){function e(t){var n;a(this,e),n=o(this,e,[e,g(g({},t),{},{baseUrl:void 0})]);var r={apiKey:t.apikey,baseUrl:t.baseUrl,token:t.token,hrn:t.hrn};r.apiKey||(r.apiKey=n.getUrl().getQuery().apikey);var i=t.useLegacy||!1;return n.venueService_=new Xt(r,i),n}return f(e,H.service.Service),l(e,[{key:"loadVenue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.venueService_.load(e,t).then((function(e){return new tn(e)}))}},{key:"getMapInfoList",value:function(){return this.venueService_.getSupportedMapList()}}])}();gn.CONFIG_KEY="indoorMaps",H.service.Platform.prototype.getVenuesService=function(e,t){var n=gn;return 1!==t&&t?t!==pe.v2||e.token||(e.hrn?e.apikey||console.error("Venue Service version 2 requires either apikey or token"):console.error("Token is mandatory when Hrn is not provided in Venue Service version 2")):(console.warn("Venue service version 1 is no longer supported"),n=vn),this.createService(n,e)},gn.LABEL_TEXT_PREFERENCE_OVERRIDE={OCCUPANT_NAMES:"OCCUPANT_NAMES",SPACE_NAME:"SPACE_NAME",SPACE_TYPE_NAME:"SPACE_TYPE_NAME",SPACE_CATEGORY_NAME:"SPACE_CATEGORY_NAME",INTERNAL_ADDRESS:"INTERNAL_ADDRESS"};var yn=function(){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,e),(n=o(this,e)).provider_=null,n.levelSelectorUI_=null,n.setAlignment(r&&r.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),n.addClass("venues-ui"),t instanceof tn&&n.setVenue(t),n}return f(e,H.ui.Control),l(e,[{key:"renderInternal",value:function(t,n){I(e,"renderInternal",this,3)([t,n]),this.createLevelSelectorUI_(t),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(e){e instanceof tn&&(this.removeEventListeners_(),this.venue=e,this.provider_=e.getParentEventTarget(),this.update_(),this.addEventListeners_())}},{key:"createLevelSelectorUI_",value:function(e){var t=this;e.innerHTML="",this.levelSelectorUI_=null;this.levelSelectorUI_=new xt(e,null,null,(function(e){return t.venue.setActiveLevelIndex(e)}))}},{key:"update_",value:function(){if(this.levelSelectorUI_){var e=this.venue.getActiveDrawing().getData(),t=this.venue.getData().getDisplaySettings();this.levelSelectorUI_.update(e,t),this.levelChangeHandler_()}}},{key:"addEventListeners_",value:function(){this.venue&&(this.venue.addEventListener(tn.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.addEventListener(tn.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.addEventListener(tn.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&(this.venue.removeEventListener(tn.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.removeEventListener(tn.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.removeEventListener(tn.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"levelChangeHandler_",value:function(){this.levelSelectorUI_.switch(this.venue.getActiveLevelIndex())}},{key:"drawingChangeHandler_",value:function(){this.update_()}},{key:"activeVenueChangeHandler_",value:function(e){this.setVenue(e.newValue)}}])}(),mn=function(){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,e),(n=o(this,e)).provider_=null,n.drawingSelectorUI_=null,n.addClass("venues-ui"),n.setAlignment(r&&r.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),t instanceof tn&&n.setVenue(t),n}return f(e,H.ui.Control),l(e,[{key:"renderInternal",value:function(t,n){I(e,"renderInternal",this,3)([t,n]),this.createDrawingSelectorUI_(t),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(e){e instanceof tn&&(this.removeEventListeners_(),this.venue=e,this.provider_=e.getParentEventTarget(),this.drawingSelectorUI_&&this.drawingSelectorUI_.update(e.getData()),this.addEventListeners_())}},{key:"createDrawingSelectorUI_",value:function(e){var t=this;e.innerHTML="",this.drawingSelectorUI_=null,this.drawingSelectorUI_=new Tt(e,null,(function(e){return t.venue.setActiveDrawing(e)}))}},{key:"addEventListeners_",value:function(){this.venue&&this.venue.addEventListener(tn.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.addEventListener(tn.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&this.venue.removeEventListener(tn.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.removeEventListener(tn.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"drawingChangeHandler_",value:function(){this.drawingSelectorUI_.switch(this.venue.getActiveDrawing().id)}},{key:"activeVenueChangeHandler_",value:function(e){this.setVenue(e.newValue)}}])}(),En=Object.freeze({__proto__:null,DrawingControl:mn,LevelControl:yn});return t(".venues-ui * {\n  font-family: \"Fira Sans\", \"Helvetica Neue\", Helvetica, sans-serif;\n  color: #0F1621;\n}\n.venues-ui .arrow {\n  display: block;\n  width: 100%;\n  height: 100%;\n  background-repeat: no-repeat;\n  background-position: center;\n}\n.venues-ui .arrow--up {\n  background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-426.000000, -584.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls-Copy' transform='translate(417.753906, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(15.000000, 16.499023) rotate(-180.000000) translate(-15.000000, -16.499023) translate(9.000000, 12.749023)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n.venues-ui .arrow--down {\n  background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-347.000000, -704.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls' transform='translate(338.251953, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(9.000000, 132.746094)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n.venues-ui .venues-ui-button {\n  display: block;\n  width: 40px;\n  height: 40px;\n  line-height: 40px;\n  font-size: 16px;\n  font-weight: 600;\n  background-color: #fff;\n  border: none;\n  border-bottom: 1px solid #9FA2A6;\n  cursor: pointer;\n  overflow: hidden;\n  color: #6e737a;\n  text-align: center;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.venues-ui .venues-ui-button:hover, .venues-ui .venues-ui-button--active {\n  background-color: #f0f0f0;\n  color: #0F1621;\n}\n@keyframes fade {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n.venues-ui__drawings .drawings {\n  position: absolute;\n  top: 0;\n  right: 45px;\n  display: none;\n  opacity: 0;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__drawings .drawings--open {\n  display: block;\n  opacity: 1;\n  animation: fade 1s;\n  overflow-y: auto;\n  max-height: 250px;\n}\n.venues-ui__drawings .drawings .venues-ui-button {\n  width: auto;\n  padding: 0 10px;\n}\n.venues-ui__drawings .drawings .venues-ui-button:first-of-type {\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n.venues-ui__drawings .drawings .venues-ui-button:last-of-type {\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n.venues-ui__drawings .trigger {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__drawings .trigger .arrow {\n  transform: rotate(0);\n  transition: 0.4s;\n}\n.venues-ui__drawings .trigger.venues-ui-button--active .arrow {\n  transform: rotate(90deg);\n  transition: 0.4s;\n}\n.venues-ui__levels {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__levels .levels {\n  overflow: hidden;\n}\n.venues-ui__levels .venues-ui-button--up + .levels .venues-ui-button {\n  border-radius: 0;\n}\n.venues-ui__levels .venues-ui-button:first-of-type {\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n.venues-ui__levels .venues-ui-button:last-of-type {\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n.venues-ui__levels .venues-ui-button[disabled=disabled] .arrow {\n  opacity: 0.5;\n}\n.venues-ui__directory {\n  position: absolute;\n  top: 10px;\n  right: 60px;\n  bottom: calc(100% - 45px);\n  width: 350px;\n  overflow: hidden;\n  background: white;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__directory.active {\n  bottom: 10px;\n}\n.venues-ui__directory .directory__list {\n  top: 80px;\n  bottom: 20px;\n  position: absolute;\n  overflow-y: scroll;\n  right: 10px;\n  left: 10px;\n  font-size: 12px;\n}\n.venues-ui__directory .directory__list svg {\n  width: 25px;\n  height: 25px;\n}\n.venues-ui__directory .directory__heading {\n  margin: 8px;\n  font-size: 15px;\n  font-weight: normal;\n  cursor: pointer;\n}\n.venues-ui__directory .directory__input {\n  margin: 10px;\n}\n.venues-ui__directory .directory__input input {\n  width: 100%;\n  padding: 5px 0;\n}\n.venues-ui__directory .directory__trigger {\n  position: absolute;\n  right: 10px;\n  top: 15px;\n  width: 10px;\n  height: 10px;\n}\n.venues-ui__directory .directory__trigger .arrow {\n  transform: rotate(0);\n  transition: 0.4s;\n}\n.venues-ui__directory .directory__trigger--active .arrow {\n  transform: rotate(-180deg);\n  transition: 0.4s;\n}"),e.Drawing=A,e.Geometry=M,e.Level=T,e.Provider=un,e.Route=pn,e.Service=vn,e.Service2=gn,e.Venue=tn,e.ui=En,Object.defineProperty(e,"__esModule",{value:!0}),e}({});

H.__harp_worker_decoders__="(()=>{var __webpack_modules__={3577:(t,e,r)=>{\"use strict\";const i=r(5133);var n=r(5218),s=r(6918);s.util.Long=i,s.configure(),t.exports=n},5218:(t,e,r)=>{\"use strict\";var i,n,s,o=r(6918),a=o.Reader,u=o.util,l=o.roots.default||(o.roots.default={});l.com=((s={}).mapbox=((n={}).pb=((i={}).Tile=function(){function t(t){if(this.layers=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}var e,r;return t.prototype.layers=u.emptyArray,t.decode=function(t,e){t instanceof a||(t=a.create(t));for(var r=void 0===e?t.len:t.pos+e,i=new l.com.mapbox.pb.Tile;t.pos<r;){var n=t.uint32();n>>>3==3?(i.layers&&i.layers.length||(i.layers=[]),i.layers.push(l.com.mapbox.pb.Tile.Layer.decode(t,t.uint32()))):t.skipType(7&n)}return i},t.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},t.fromObject=function(t){if(t instanceof l.com.mapbox.pb.Tile)return t;var e=new l.com.mapbox.pb.Tile;if(t.layers){if(!Array.isArray(t.layers))throw TypeError(\".com.mapbox.pb.Tile.layers: array expected\");e.layers=[];for(var r=0;r<t.layers.length;++r){if(\"object\"!=typeof t.layers[r])throw TypeError(\".com.mapbox.pb.Tile.layers: object expected\");e.layers[r]=l.com.mapbox.pb.Tile.Layer.fromObject(t.layers[r])}}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.layers=[]),t.layers&&t.layers.length){r.layers=[];for(var i=0;i<t.layers.length;++i)r.layers[i]=l.com.mapbox.pb.Tile.Layer.toObject(t.layers[i],e)}return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},t.GeomType=(e={},(r=Object.create(e))[e[0]=\"UNKNOWN\"]=0,r[e[1]=\"POINT\"]=1,r[e[2]=\"LINESTRING\"]=2,r[e[3]=\"POLYGON\"]=3,r),t.Value=function(){function t(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.stringValue=\"\",t.prototype.floatValue=0,t.prototype.doubleValue=0,t.prototype.intValue=u.Long?u.Long.fromBits(0,0,!1):0,t.prototype.uintValue=u.Long?u.Long.fromBits(0,0,!0):0,t.prototype.sintValue=u.Long?u.Long.fromBits(0,0,!1):0,t.prototype.boolValue=!1,t.decode=function(t,e){t instanceof a||(t=a.create(t));for(var r=void 0===e?t.len:t.pos+e,i=new l.com.mapbox.pb.Tile.Value;t.pos<r;){var n=t.uint32();switch(n>>>3){case 1:i.stringValue=t.string();break;case 2:i.floatValue=t.float();break;case 3:i.doubleValue=t.double();break;case 4:i.intValue=t.int64();break;case 5:i.uintValue=t.uint64();break;case 6:i.sintValue=t.sint64();break;case 7:i.boolValue=t.bool();break;default:t.skipType(7&n)}}return i},t.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},t.fromObject=function(t){if(t instanceof l.com.mapbox.pb.Tile.Value)return t;var e=new l.com.mapbox.pb.Tile.Value;return null!=t.stringValue&&(e.stringValue=String(t.stringValue)),null!=t.floatValue&&(e.floatValue=Number(t.floatValue)),null!=t.doubleValue&&(e.doubleValue=Number(t.doubleValue)),null!=t.intValue&&(u.Long?(e.intValue=u.Long.fromValue(t.intValue)).unsigned=!1:\"string\"==typeof t.intValue?e.intValue=parseInt(t.intValue,10):\"number\"==typeof t.intValue?e.intValue=t.intValue:\"object\"==typeof t.intValue&&(e.intValue=new u.LongBits(t.intValue.low>>>0,t.intValue.high>>>0).toNumber())),null!=t.uintValue&&(u.Long?(e.uintValue=u.Long.fromValue(t.uintValue)).unsigned=!0:\"string\"==typeof t.uintValue?e.uintValue=parseInt(t.uintValue,10):\"number\"==typeof t.uintValue?e.uintValue=t.uintValue:\"object\"==typeof t.uintValue&&(e.uintValue=new u.LongBits(t.uintValue.low>>>0,t.uintValue.high>>>0).toNumber(!0))),null!=t.sintValue&&(u.Long?(e.sintValue=u.Long.fromValue(t.sintValue)).unsigned=!1:\"string\"==typeof t.sintValue?e.sintValue=parseInt(t.sintValue,10):\"number\"==typeof t.sintValue?e.sintValue=t.sintValue:\"object\"==typeof t.sintValue&&(e.sintValue=new u.LongBits(t.sintValue.low>>>0,t.sintValue.high>>>0).toNumber())),null!=t.boolValue&&(e.boolValue=Boolean(t.boolValue)),e},t.toObject=function(t,e){e||(e={});var r={};if(e.defaults){if(r.stringValue=\"\",r.floatValue=0,r.doubleValue=0,u.Long){var i=new u.Long(0,0,!1);r.intValue=e.longs===String?i.toString():e.longs===Number?i.toNumber():i}else r.intValue=e.longs===String?\"0\":0;u.Long?(i=new u.Long(0,0,!0),r.uintValue=e.longs===String?i.toString():e.longs===Number?i.toNumber():i):r.uintValue=e.longs===String?\"0\":0,u.Long?(i=new u.Long(0,0,!1),r.sintValue=e.longs===String?i.toString():e.longs===Number?i.toNumber():i):r.sintValue=e.longs===String?\"0\":0,r.boolValue=!1}return null!=t.stringValue&&t.hasOwnProperty(\"stringValue\")&&(r.stringValue=t.stringValue),null!=t.floatValue&&t.hasOwnProperty(\"floatValue\")&&(r.floatValue=e.json&&!isFinite(t.floatValue)?String(t.floatValue):t.floatValue),null!=t.doubleValue&&t.hasOwnProperty(\"doubleValue\")&&(r.doubleValue=e.json&&!isFinite(t.doubleValue)?String(t.doubleValue):t.doubleValue),null!=t.intValue&&t.hasOwnProperty(\"intValue\")&&(\"number\"==typeof t.intValue?r.intValue=e.longs===String?String(t.intValue):t.intValue:r.intValue=e.longs===String?u.Long.prototype.toString.call(t.intValue):e.longs===Number?new u.LongBits(t.intValue.low>>>0,t.intValue.high>>>0).toNumber():t.intValue),null!=t.uintValue&&t.hasOwnProperty(\"uintValue\")&&(\"number\"==typeof t.uintValue?r.uintValue=e.longs===String?String(t.uintValue):t.uintValue:r.uintValue=e.longs===String?u.Long.prototype.toString.call(t.uintValue):e.longs===Number?new u.LongBits(t.uintValue.low>>>0,t.uintValue.high>>>0).toNumber(!0):t.uintValue),null!=t.sintValue&&t.hasOwnProperty(\"sintValue\")&&(\"number\"==typeof t.sintValue?r.sintValue=e.longs===String?String(t.sintValue):t.sintValue:r.sintValue=e.longs===String?u.Long.prototype.toString.call(t.sintValue):e.longs===Number?new u.LongBits(t.sintValue.low>>>0,t.sintValue.high>>>0).toNumber():t.sintValue),null!=t.boolValue&&t.hasOwnProperty(\"boolValue\")&&(r.boolValue=t.boolValue),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},t}(),t.Feature=function(){function t(t){if(this.tags=[],this.geometry=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.id=u.Long?u.Long.fromBits(0,0,!0):0,t.prototype.tags=u.emptyArray,t.prototype.type=0,t.prototype.geometry=u.emptyArray,t.decode=function(t,e){t instanceof a||(t=a.create(t));for(var r=void 0===e?t.len:t.pos+e,i=new l.com.mapbox.pb.Tile.Feature;t.pos<r;){var n=t.uint32();switch(n>>>3){case 1:i.id=t.uint64();break;case 2:if(i.tags&&i.tags.length||(i.tags=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)i.tags.push(t.uint32());else i.tags.push(t.uint32());break;case 3:i.type=t.int32();break;case 4:if(i.geometry&&i.geometry.length||(i.geometry=[]),2==(7&n))for(s=t.uint32()+t.pos;t.pos<s;)i.geometry.push(t.uint32());else i.geometry.push(t.uint32());break;default:t.skipType(7&n)}}return i},t.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},t.fromObject=function(t){if(t instanceof l.com.mapbox.pb.Tile.Feature)return t;var e=new l.com.mapbox.pb.Tile.Feature;if(null!=t.id&&(u.Long?(e.id=u.Long.fromValue(t.id)).unsigned=!0:\"string\"==typeof t.id?e.id=parseInt(t.id,10):\"number\"==typeof t.id?e.id=t.id:\"object\"==typeof t.id&&(e.id=new u.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber(!0))),t.tags){if(!Array.isArray(t.tags))throw TypeError(\".com.mapbox.pb.Tile.Feature.tags: array expected\");e.tags=[];for(var r=0;r<t.tags.length;++r)e.tags[r]=t.tags[r]>>>0}switch(t.type){case\"UNKNOWN\":case 0:e.type=0;break;case\"POINT\":case 1:e.type=1;break;case\"LINESTRING\":case 2:e.type=2;break;case\"POLYGON\":case 3:e.type=3}if(t.geometry){if(!Array.isArray(t.geometry))throw TypeError(\".com.mapbox.pb.Tile.Feature.geometry: array expected\");for(e.geometry=[],r=0;r<t.geometry.length;++r)e.geometry[r]=t.geometry[r]>>>0}return e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.tags=[],r.geometry=[]),e.defaults){if(u.Long){var i=new u.Long(0,0,!0);r.id=e.longs===String?i.toString():e.longs===Number?i.toNumber():i}else r.id=e.longs===String?\"0\":0;r.type=e.enums===String?\"UNKNOWN\":0}if(null!=t.id&&t.hasOwnProperty(\"id\")&&(\"number\"==typeof t.id?r.id=e.longs===String?String(t.id):t.id:r.id=e.longs===String?u.Long.prototype.toString.call(t.id):e.longs===Number?new u.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber(!0):t.id),t.tags&&t.tags.length){r.tags=[];for(var n=0;n<t.tags.length;++n)r.tags[n]=t.tags[n]}if(null!=t.type&&t.hasOwnProperty(\"type\")&&(r.type=e.enums===String?l.com.mapbox.pb.Tile.GeomType[t.type]:t.type),t.geometry&&t.geometry.length)for(r.geometry=[],n=0;n<t.geometry.length;++n)r.geometry[n]=t.geometry[n];return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},t}(),t.Layer=function(){function t(t){if(this.features=[],this.keys=[],this.values=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)null!=t[e[r]]&&(this[e[r]]=t[e[r]])}return t.prototype.version=1,t.prototype.name=\"\",t.prototype.features=u.emptyArray,t.prototype.keys=u.emptyArray,t.prototype.values=u.emptyArray,t.prototype.extent=4096,t.decode=function(t,e){t instanceof a||(t=a.create(t));for(var r=void 0===e?t.len:t.pos+e,i=new l.com.mapbox.pb.Tile.Layer;t.pos<r;){var n=t.uint32();switch(n>>>3){case 15:i.version=t.uint32();break;case 1:i.name=t.string();break;case 2:i.features&&i.features.length||(i.features=[]),i.features.push(l.com.mapbox.pb.Tile.Feature.decode(t,t.uint32()));break;case 3:i.keys&&i.keys.length||(i.keys=[]),i.keys.push(t.string());break;case 4:i.values&&i.values.length||(i.values=[]),i.values.push(l.com.mapbox.pb.Tile.Value.decode(t,t.uint32()));break;case 5:i.extent=t.uint32();break;default:t.skipType(7&n)}}if(!i.hasOwnProperty(\"version\"))throw u.ProtocolError(\"missing required 'version'\",{instance:i});if(!i.hasOwnProperty(\"name\"))throw u.ProtocolError(\"missing required 'name'\",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},t.fromObject=function(t){if(t instanceof l.com.mapbox.pb.Tile.Layer)return t;var e=new l.com.mapbox.pb.Tile.Layer;if(null!=t.version&&(e.version=t.version>>>0),null!=t.name&&(e.name=String(t.name)),t.features){if(!Array.isArray(t.features))throw TypeError(\".com.mapbox.pb.Tile.Layer.features: array expected\");e.features=[];for(var r=0;r<t.features.length;++r){if(\"object\"!=typeof t.features[r])throw TypeError(\".com.mapbox.pb.Tile.Layer.features: object expected\");e.features[r]=l.com.mapbox.pb.Tile.Feature.fromObject(t.features[r])}}if(t.keys){if(!Array.isArray(t.keys))throw TypeError(\".com.mapbox.pb.Tile.Layer.keys: array expected\");for(e.keys=[],r=0;r<t.keys.length;++r)e.keys[r]=String(t.keys[r])}if(t.values){if(!Array.isArray(t.values))throw TypeError(\".com.mapbox.pb.Tile.Layer.values: array expected\");for(e.values=[],r=0;r<t.values.length;++r){if(\"object\"!=typeof t.values[r])throw TypeError(\".com.mapbox.pb.Tile.Layer.values: object expected\");e.values[r]=l.com.mapbox.pb.Tile.Value.fromObject(t.values[r])}}return null!=t.extent&&(e.extent=t.extent>>>0),e},t.toObject=function(t,e){e||(e={});var r={};if((e.arrays||e.defaults)&&(r.features=[],r.keys=[],r.values=[]),e.defaults&&(r.name=\"\",r.extent=4096,r.version=1),null!=t.name&&t.hasOwnProperty(\"name\")&&(r.name=t.name),t.features&&t.features.length){r.features=[];for(var i=0;i<t.features.length;++i)r.features[i]=l.com.mapbox.pb.Tile.Feature.toObject(t.features[i],e)}if(t.keys&&t.keys.length)for(r.keys=[],i=0;i<t.keys.length;++i)r.keys[i]=t.keys[i];if(t.values&&t.values.length)for(r.values=[],i=0;i<t.values.length;++i)r.values[i]=l.com.mapbox.pb.Tile.Value.toObject(t.values[i],e);return null!=t.extent&&t.hasOwnProperty(\"extent\")&&(r.extent=t.extent),null!=t.version&&t.hasOwnProperty(\"version\")&&(r.version=t.version),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},t}(),t}(),i),n),s),t.exports=l},7018:t=>{\"use strict\";t.exports=function(t,e){for(var r=new Array(arguments.length-1),i=0,n=2,s=!0;n<arguments.length;)r[i++]=arguments[n++];return new Promise((function(n,o){r[i]=function(t){if(s)if(s=!1,t)o(t);else{for(var e=new Array(arguments.length-1),r=0;r<e.length;)e[r++]=arguments[r];n.apply(null,e)}};try{t.apply(e||null,r)}catch(t){s&&(s=!1,o(t))}}))}},2647:(t,e)=>{\"use strict\";var r=e;r.length=function(t){var e=t.length;if(!e)return 0;for(var r=0;--e%4>1&&\"=\"===t.charAt(e);)++r;return Math.ceil(3*t.length)/4-r};for(var i=new Array(64),n=new Array(123),s=0;s<64;)n[i[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(t,e,r){for(var n,s=null,o=[],a=0,u=0;e<r;){var l=t[e++];switch(u){case 0:o[a++]=i[l>>2],n=(3&l)<<4,u=1;break;case 1:o[a++]=i[n|l>>4],n=(15&l)<<2,u=2;break;case 2:o[a++]=i[n|l>>6],o[a++]=i[63&l],u=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return u&&(o[a++]=i[n],o[a++]=61,1===u&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join(\"\")):String.fromCharCode.apply(String,o.slice(0,a))};var o=\"invalid encoding\";r.decode=function(t,e,r){for(var i,s=r,a=0,u=0;u<t.length;){var l=t.charCodeAt(u++);if(61===l&&a>1)break;if(void 0===(l=n[l]))throw Error(o);switch(a){case 0:i=l,a=1;break;case 1:e[r++]=i<<2|(48&l)>>4,i=l,a=2;break;case 2:e[r++]=(15&i)<<4|(60&l)>>2,i=l,a=3;break;case 3:e[r++]=(3&i)<<6|l,a=0}}if(1===a)throw Error(o);return r-s},r.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},2922:t=>{\"use strict\";function e(){this._listeners={}}t.exports=e,e.prototype.on=function(t,e,r){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:r||this}),this},e.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var r=this._listeners[t],i=0;i<r.length;)r[i].fn===e?r.splice(i,1):++i;return this},e.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<e.length;)e[i].fn.apply(e[i++].ctx,r)}return this}},7955:t=>{\"use strict\";function e(t){return\"undefined\"!=typeof Float32Array?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),i=128===r[3];function n(t,i,n){e[0]=t,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3]}function s(t,i,n){e[0]=t,i[n]=r[3],i[n+1]=r[2],i[n+2]=r[1],i[n+3]=r[0]}function o(t,i){return r[0]=t[i],r[1]=t[i+1],r[2]=t[i+2],r[3]=t[i+3],e[0]}function a(t,i){return r[3]=t[i],r[2]=t[i+1],r[1]=t[i+2],r[0]=t[i+3],e[0]}t.writeFloatLE=i?n:s,t.writeFloatBE=i?s:n,t.readFloatLE=i?o:a,t.readFloatBE=i?a:o}():function(){function e(t,e,r,i){var n=e<0?1:0;if(n&&(e=-e),0===e)t(1/e>0?0:2147483648,r,i);else if(isNaN(e))t(2143289344,r,i);else if(e>34028234663852886e22)t((n<<31|2139095040)>>>0,r,i);else if(e<11754943508222875e-54)t((n<<31|Math.round(e/1401298464324817e-60))>>>0,r,i);else{var s=Math.floor(Math.log(e)/Math.LN2);t((n<<31|s+127<<23|8388607&Math.round(e*Math.pow(2,-s)*8388608))>>>0,r,i)}}function o(t,e,r){var i=t(e,r),n=2*(i>>31)+1,s=i>>>23&255,o=8388607&i;return 255===s?o?NaN:n*(1/0):0===s?1401298464324817e-60*n*o:n*Math.pow(2,s-150)*(o+8388608)}t.writeFloatLE=e.bind(null,r),t.writeFloatBE=e.bind(null,i),t.readFloatLE=o.bind(null,n),t.readFloatBE=o.bind(null,s)}(),\"undefined\"!=typeof Float64Array?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),i=128===r[7];function n(t,i,n){e[0]=t,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3],i[n+4]=r[4],i[n+5]=r[5],i[n+6]=r[6],i[n+7]=r[7]}function s(t,i,n){e[0]=t,i[n]=r[7],i[n+1]=r[6],i[n+2]=r[5],i[n+3]=r[4],i[n+4]=r[3],i[n+5]=r[2],i[n+6]=r[1],i[n+7]=r[0]}function o(t,i){return r[0]=t[i],r[1]=t[i+1],r[2]=t[i+2],r[3]=t[i+3],r[4]=t[i+4],r[5]=t[i+5],r[6]=t[i+6],r[7]=t[i+7],e[0]}function a(t,i){return r[7]=t[i],r[6]=t[i+1],r[5]=t[i+2],r[4]=t[i+3],r[3]=t[i+4],r[2]=t[i+5],r[1]=t[i+6],r[0]=t[i+7],e[0]}t.writeDoubleLE=i?n:s,t.writeDoubleBE=i?s:n,t.readDoubleLE=i?o:a,t.readDoubleBE=i?a:o}():function(){function e(t,e,r,i,n,s){var o=i<0?1:0;if(o&&(i=-i),0===i)t(0,n,s+e),t(1/i>0?0:2147483648,n,s+r);else if(isNaN(i))t(0,n,s+e),t(2146959360,n,s+r);else if(i>17976931348623157e292)t(0,n,s+e),t((o<<31|2146435072)>>>0,n,s+r);else{var a;if(i<22250738585072014e-324)t((a=i/5e-324)>>>0,n,s+e),t((o<<31|a/4294967296)>>>0,n,s+r);else{var u=Math.floor(Math.log(i)/Math.LN2);1024===u&&(u=1023),t(4503599627370496*(a=i*Math.pow(2,-u))>>>0,n,s+e),t((o<<31|u+1023<<20|1048576*a&1048575)>>>0,n,s+r)}}}function o(t,e,r,i,n){var s=t(i,n+e),o=t(i,n+r),a=2*(o>>31)+1,u=o>>>20&2047,l=4294967296*(1048575&o)+s;return 2047===u?l?NaN:a*(1/0):0===u?5e-324*a*l:a*Math.pow(2,u-1075)*(l+4503599627370496)}t.writeDoubleLE=e.bind(null,r,0,4),t.writeDoubleBE=e.bind(null,i,4,0),t.readDoubleLE=o.bind(null,n,0,4),t.readDoubleBE=o.bind(null,s,4,0)}(),t}function r(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function i(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=255&t}function n(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function s(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}t.exports=e(e)},8446:module=>{\"use strict\";function inquire(moduleName){try{var mod=eval(\"quire\".replace(/^/,\"re\"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},5374:t=>{\"use strict\";t.exports=function(t,e,r){var i=r||8192,n=i>>>1,s=null,o=i;return function(r){if(r<1||r>n)return t(r);o+r>i&&(s=t(i),o=0);var a=e.call(s,o,o+=r);return 7&o&&(o=1+(7|o)),a}}},5226:(t,e)=>{\"use strict\";var r=e;r.length=function(t){for(var e=0,r=0,i=0;i<t.length;++i)(r=t.charCodeAt(i))<128?e+=1:r<2048?e+=2:55296==(64512&r)&&56320==(64512&t.charCodeAt(i+1))?(++i,e+=4):e+=3;return e},r.read=function(t,e,r){if(r-e<1)return\"\";for(var i,n=null,s=[],o=0;e<r;)(i=t[e++])<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],o>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,s)),o=0);return n?(o&&n.push(String.fromCharCode.apply(String,s.slice(0,o))),n.join(\"\")):String.fromCharCode.apply(String,s.slice(0,o))},r.write=function(t,e,r){for(var i,n,s=r,o=0;o<t.length;++o)(i=t.charCodeAt(o))<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=63&i|128):55296==(64512&i)&&56320==(64512&(n=t.charCodeAt(o+1)))?(i=65536+((1023&i)<<10)+(1023&n),++o,e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=63&i|128):(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=63&i|128);return r-s}},6925:(t,e)=>{var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function n(t){return t<0?0:t>1?1:t}function s(t){return\"%\"===t[t.length-1]?i(parseFloat(t)/100*255):i(parseInt(t))}function o(t){return\"%\"===t[t.length-1]?n(parseFloat(t)/100):n(parseFloat(t))}function a(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,n=t.replace(/ /g,\"\").toLowerCase();if(n in r)return r[n].slice();if(\"#\"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=n.indexOf(\"(\"),l=n.indexOf(\")\");if(-1!==u&&l+1===n.length){var h=n.substr(0,u),c=n.substr(u+1,l-(u+1)).split(\",\"),d=1;switch(h){case\"rgba\":if(4!==c.length)return null;d=o(c.pop());case\"rgb\":return 3!==c.length?null:[s(c[0]),s(c[1]),s(c[2]),d];case\"hsla\":if(4!==c.length)return null;d=o(c.pop());case\"hsl\":if(3!==c.length)return null;var p=(parseFloat(c[0])%360+360)%360/360,f=o(c[1]),m=o(c[2]),y=m<=.5?m*(f+1):m+f-m*f,g=2*m-y;return[i(255*a(g,y,p+1/3)),i(255*a(g,y,p)),i(255*a(g,y,p-1/3)),d];default:return null}}return null}}catch(t){}},242:(t,e,r)=>{\"use strict\";function i(t,e,r,s){for(var o,a=s,u=r-e>>1,l=r-e,h=t[e],c=t[e+1],d=t[r],p=t[r+1],f=e+3;f<r;f+=3){var m=n(t[f],t[f+1],h,c,d,p);if(m>a)o=f,a=m;else if(m===a){var y=Math.abs(f-u);y<l&&(o=f,l=y)}}a>s&&(o-e>3&&i(t,e,o,s),t[o+2]=a,r-o>3&&i(t,o,r,s))}function n(t,e,r,i,n,s){var o=n-r,a=s-i;if(0!==o||0!==a){var u=((t-r)*o+(e-i)*a)/(o*o+a*a);u>1?(r=n,i=s):u>0&&(r+=o*u,i+=a*u)}return(o=t-r)*o+(a=e-i)*a}function s(t,e,r,i){var n={id:void 0===t?null:t,type:e,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if(\"Point\"===r||\"MultiPoint\"===r||\"LineString\"===r)o(t,e);else if(\"Polygon\"===r||\"MultiLineString\"===r)for(var i=0;i<e.length;i++)o(t,e[i]);else if(\"MultiPolygon\"===r)for(i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++)o(t,e[i][n])}(n),n}function o(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function a(t,e,r,i){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,c=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),d=[],p=e.id;if(r.promoteId?p=e.properties[r.promoteId]:r.generateId&&(p=i||0),\"Point\"===o)u(n,d);else if(\"MultiPoint\"===o)for(var f=0;f<n.length;f++)u(n[f],d);else if(\"LineString\"===o)l(n,d,c,!1);else if(\"MultiLineString\"===o){if(r.lineMetrics){for(f=0;f<n.length;f++)d=[],l(n[f],d,c,!1),t.push(s(p,\"LineString\",d,e.properties));return}h(n,d,c,!1)}else if(\"Polygon\"===o)h(n,d,c,!0);else{if(\"MultiPolygon\"!==o){if(\"GeometryCollection\"===o){for(f=0;f<e.geometry.geometries.length;f++)a(t,{id:p,geometry:e.geometry.geometries[f],properties:e.properties},r,i);return}throw new Error(\"Input data is not a valid GeoJSON object.\")}for(f=0;f<n.length;f++){var m=[];h(n[f],m,c,!0),d.push(m)}}t.push(s(p,o,d,e.properties))}}function u(t,e){e.push(c(t[0])),e.push(d(t[1])),e.push(0)}function l(t,e,r,n){for(var s,o,a=0,u=0;u<t.length;u++){var l=c(t[u][0]),h=d(t[u][1]);e.push(l),e.push(h),e.push(0),u>0&&(a+=n?(s*h-l*o)/2:Math.sqrt(Math.pow(l-s,2)+Math.pow(h-o,2))),s=l,o=h}var p=e.length-3;e[2]=1,i(e,0,p,r),e[p+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function h(t,e,r,i){for(var n=0;n<t.length;n++){var s=[];l(t[n],s,r,i),e.push(s)}}function c(t){return t/360+.5}function d(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function p(t,e,r,i,n,o,a,u){if(i/=e,o>=(r/=e)&&a<i)return t;if(a<r||o>=i)return null;for(var l=[],h=0;h<t.length;h++){var c=t[h],d=c.geometry,p=c.type,y=0===n?c.minX:c.minY,x=0===n?c.maxX:c.maxY;if(y>=r&&x<i)l.push(c);else if(!(x<r||y>=i)){var v=[];if(\"Point\"===p||\"MultiPoint\"===p)f(d,v,r,i,n);else if(\"LineString\"===p)m(d,v,r,i,n,!1,u.lineMetrics);else if(\"MultiLineString\"===p)g(d,v,r,i,n,!1);else if(\"Polygon\"===p)g(d,v,r,i,n,!0);else if(\"MultiPolygon\"===p)for(var b=0;b<d.length;b++){var w=[];g(d[b],w,r,i,n,!0),w.length&&v.push(w)}if(v.length){if(u.lineMetrics&&\"LineString\"===p){for(b=0;b<v.length;b++)l.push(s(c.id,p,v[b],c.tags));continue}\"LineString\"!==p&&\"MultiLineString\"!==p||(1===v.length?(p=\"LineString\",v=v[0]):p=\"MultiLineString\"),\"Point\"!==p&&\"MultiPoint\"!==p||(p=3===v.length?\"Point\":\"MultiPoint\"),l.push(s(c.id,p,v,c.tags))}}}return l.length?l:null}function f(t,e,r,i,n){for(var s=0;s<t.length;s+=3){var o=t[s+n];o>=r&&o<=i&&(e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]))}}function m(t,e,r,i,n,s,o){for(var a,u,l=y(t),h=0===n?v:b,c=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],m=t[d+2],g=t[d+3],w=t[d+4],_=0===n?p:f,M=0===n?g:w,E=!1;o&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-w,2))),_<r?M>r&&(u=h(l,p,f,g,w,r),o&&(l.start=c+a*u)):_>i?M<i&&(u=h(l,p,f,g,w,i),o&&(l.start=c+a*u)):x(l,p,f,m),M<r&&_>=r&&(u=h(l,p,f,g,w,r),E=!0),M>i&&_<=i&&(u=h(l,p,f,g,w,i),E=!0),!s&&E&&(o&&(l.end=c+a*u),e.push(l),l=y(t)),o&&(c+=a)}var T=t.length-3;p=t[T],f=t[T+1],m=t[T+2],(_=0===n?p:f)>=r&&_<=i&&x(l,p,f,m),T=l.length-3,s&&T>=3&&(l[T]!==l[0]||l[T+1]!==l[1])&&x(l,l[0],l[1],l[2]),l.length&&e.push(l)}function y(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function g(t,e,r,i,n,s){for(var o=0;o<t.length;o++)m(t[o],e,r,i,n,s,!1)}function x(t,e,r,i){t.push(e),t.push(r),t.push(i)}function v(t,e,r,i,n,s){var o=(s-e)/(i-e);return t.push(s),t.push(r+(n-r)*o),t.push(1),o}function b(t,e,r,i,n,s){var o=(s-r)/(n-r);return t.push(e+(i-e)*o),t.push(s),t.push(1),o}function w(t,e){for(var r=[],i=0;i<t.length;i++){var n,o=t[i],a=o.type;if(\"Point\"===a||\"MultiPoint\"===a||\"LineString\"===a)n=_(o.geometry,e);else if(\"MultiLineString\"===a||\"Polygon\"===a){n=[];for(var u=0;u<o.geometry.length;u++)n.push(_(o.geometry[u],e))}else if(\"MultiPolygon\"===a)for(n=[],u=0;u<o.geometry.length;u++){for(var l=[],h=0;h<o.geometry[u].length;h++)l.push(_(o.geometry[u][h],e));n.push(l)}r.push(s(o.id,a,n,o.tags))}return r}function _(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var i=0;i<t.length;i+=3)r.push(t[i]+e,t[i+1],t[i+2]);return r}function M(t,e){if(t.transformed)return t;var r,i,n,s=1<<t.z,o=t.x,a=t.y;for(r=0;r<t.features.length;r++){var u=t.features[r],l=u.geometry,h=u.type;if(u.geometry=[],1===h)for(i=0;i<l.length;i+=2)u.geometry.push(E(l[i],l[i+1],e,s,o,a));else for(i=0;i<l.length;i++){var c=[];for(n=0;n<l[i].length;n+=2)c.push(E(l[i][n],l[i][n+1],e,s,o,a));u.geometry.push(c)}}return t.transformed=!0,t}function E(t,e,r,i,n,s){return[Math.round(r*(t*i-n)),Math.round(r*(e*i-s))]}function T(t,e,r,i,n){for(var s=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){o.numFeatures++,S(o,t[a],s,n);var u=t[a].minX,l=t[a].minY,h=t[a].maxX,c=t[a].maxY;u<o.minX&&(o.minX=u),l<o.minY&&(o.minY=l),h>o.maxX&&(o.maxX=h),c>o.maxY&&(o.maxY=c)}return o}function S(t,e,r,i){var n=e.geometry,s=e.type,o=[];if(\"Point\"===s||\"MultiPoint\"===s)for(var a=0;a<n.length;a+=3)o.push(n[a]),o.push(n[a+1]),t.numPoints++,t.numSimplified++;else if(\"LineString\"===s)A(o,n,t,r,!1,!1);else if(\"MultiLineString\"===s||\"Polygon\"===s)for(a=0;a<n.length;a++)A(o,n[a],t,r,\"Polygon\"===s,0===a);else if(\"MultiPolygon\"===s)for(var u=0;u<n.length;u++){var l=n[u];for(a=0;a<l.length;a++)A(o,l[a],t,r,!0,0===a)}if(o.length){var h=e.tags||null;if(\"LineString\"===s&&i.lineMetrics){for(var c in h={},e.tags)h[c]=e.tags[c];h.mapbox_clip_start=n.start/n.size,h.mapbox_clip_end=n.end/n.size}var d={geometry:o,type:\"Polygon\"===s||\"MultiPolygon\"===s?3:\"LineString\"===s||\"MultiLineString\"===s?2:1,tags:h};null!==e.id&&(d.id=e.id),t.features.push(d)}}function A(t,e,r,i,n,s){var o=i*i;if(i>0&&e.size<(n?o:i))r.numPoints+=e.length/3;else{for(var a=[],u=0;u<e.length;u+=3)(0===i||e[u+2]>o)&&(r.numSimplified++,a.push(e[u]),a.push(e[u+1])),r.numPoints++;n&&function(t,e){for(var r=0,i=0,n=t.length,s=n-2;i<n;s=i,i+=2)r+=(t[i]-t[s])*(t[i+1]+t[s+1]);if(r>0===e)for(i=0,n=t.length;i<n/2;i+=2){var o=t[i],a=t[i+1];t[i]=t[n-2-i],t[i+1]=t[n-1-i],t[n-2-i]=o,t[n-1-i]=a}}(a,s),t.push(a)}}function z(t,e){return new P(t,e)}function P(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time(\"preprocess data\"),e.maxZoom<0||e.maxZoom>24)throw new Error(\"maxZoom should be in the 0-24 range\");if(e.promoteId&&e.generateId)throw new Error(\"promoteId and generateId cannot be used together.\");var i=function(t,e){var r=[];if(\"FeatureCollection\"===t.type)for(var i=0;i<t.features.length;i++)a(r,t.features[i],e,i);else\"Feature\"===t.type?a(r,t,e):a(r,{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd(\"preprocess data\"),console.log(\"index: maxZoom: %d, maxPoints: %d\",e.indexMaxZoom,e.indexMaxPoints),console.time(\"generate tiles\"),this.stats={},this.total=0),i=function(t,e){var r=e.buffer/e.extent,i=t,n=p(t,1,-1-r,r,0,-1,2,e),s=p(t,1,1-r,2+r,0,-1,2,e);return(n||s)&&(i=p(t,1,-r,1+r,0,-1,2,e)||[],n&&(i=w(n,1).concat(i)),s&&(i=i.concat(w(s,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log(\"features: %d, points: %d\",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd(\"generate tiles\"),console.log(\"tiles generated:\",this.total,JSON.stringify(this.stats)))}function L(t,e,r){return 32*((1<<t)*r+e)+t}r.r(e),r.d(e,{default:()=>z}),P.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},P.prototype.splitTile=function(t,e,r,i,n,s,o){for(var a=[t,e,r,i],u=this.options,l=u.debug;a.length;){i=a.pop(),r=a.pop(),e=a.pop(),t=a.pop();var h=1<<e,c=L(e,r,i),d=this.tiles[c];if(!d&&(l>1&&console.time(\"creation\"),d=this.tiles[c]=T(t,e,r,i,u),this.tileCoords.push({z:e,x:r,y:i}),l)){l>1&&(console.log(\"tile z%d-%d-%d (features: %d, points: %d, simplified: %d)\",e,r,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd(\"creation\"));var f=\"z\"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(d.source=t,n){if(e===u.maxZoom||e===n)continue;var m=1<<n-e;if(r!==Math.floor(s/m)||i!==Math.floor(o/m))continue}else if(e===u.indexMaxZoom||d.numPoints<=u.indexMaxPoints)continue;if(d.source=null,0!==t.length){l>1&&console.time(\"clipping\");var y,g,x,v,b,w,_=.5*u.buffer/u.extent,M=.5-_,E=.5+_,S=1+_;y=g=x=v=null,b=p(t,h,r-_,r+E,0,d.minX,d.maxX,u),w=p(t,h,r+M,r+S,0,d.minX,d.maxX,u),t=null,b&&(y=p(b,h,i-_,i+E,1,d.minY,d.maxY,u),g=p(b,h,i+M,i+S,1,d.minY,d.maxY,u),b=null),w&&(x=p(w,h,i-_,i+E,1,d.minY,d.maxY,u),v=p(w,h,i+M,i+S,1,d.minY,d.maxY,u),w=null),l>1&&console.timeEnd(\"clipping\"),a.push(y||[],e+1,2*r,2*i),a.push(g||[],e+1,2*r,2*i+1),a.push(x||[],e+1,2*r+1,2*i),a.push(v||[],e+1,2*r+1,2*i+1)}}},P.prototype.getTile=function(t,e,r){var i=this.options,n=i.extent,s=i.debug;if(t<0||t>24)return null;var o=1<<t,a=L(t,e=(e%o+o)%o,r);if(this.tiles[a])return M(this.tiles[a],n);s>1&&console.log(\"drilling down to z%d-%d-%d\",t,e,r);for(var u,l=t,h=e,c=r;!u&&l>0;)l--,h=Math.floor(h/2),c=Math.floor(c/2),u=this.tiles[L(l,h,c)];return u&&u.source?(s>1&&console.log(\"found parent tile z%d-%d-%d\",l,h,c),s>1&&console.time(\"drilling down\"),this.splitTile(u.source,l,h,c,t,e,r),s>1&&console.timeEnd(\"drilling down\"),this.tiles[a]?M(this.tiles[a],n):null):null}},5133:t=>{t.exports=r;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function r(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function i(t){return!0===(t&&t.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,\"__isLong__\",{value:!0}),r.isLong=i;var n={},s={};function o(t,e){var r,i,o;return e?(o=0<=(t>>>=0)&&t<256)&&(i=s[t])?i:(r=u(t,(0|t)<0?-1:0,!0),o&&(s[t]=r),r):(o=-128<=(t|=0)&&t<128)&&(i=n[t])?i:(r=u(t,t<0?-1:0,!1),o&&(n[t]=r),r)}function a(t,e){if(isNaN(t))return e?g:y;if(e){if(t<0)return g;if(t>=p)return _}else{if(t<=-f)return M;if(t+1>=f)return w}return t<0?a(-t,e).neg():u(t%d|0,t/d|0,e)}function u(t,e,i){return new r(t,e,i)}r.fromInt=o,r.fromNumber=a,r.fromBits=u;var l=Math.pow;function h(t,e,r){if(0===t.length)throw Error(\"empty string\");if(\"NaN\"===t||\"Infinity\"===t||\"+Infinity\"===t||\"-Infinity\"===t)return y;if(\"number\"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError(\"radix\");var i;if((i=t.indexOf(\"-\"))>0)throw Error(\"interior hyphen\");if(0===i)return h(t.substring(1),e,r).neg();for(var n=a(l(r,8)),s=y,o=0;o<t.length;o+=8){var u=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+u),r);if(u<8){var d=a(l(r,u));s=s.mul(d).add(a(c))}else s=(s=s.mul(n)).add(a(c))}return s.unsigned=e,s}function c(t,e){return\"number\"==typeof t?a(t,e):\"string\"==typeof t?h(t,e):u(t.low,t.high,\"boolean\"==typeof e?e:t.unsigned)}r.fromString=h,r.fromValue=c;var d=4294967296,p=d*d,f=p/2,m=o(1<<24),y=o(0);r.ZERO=y;var g=o(0,!0);r.UZERO=g;var x=o(1);r.ONE=x;var v=o(1,!0);r.UONE=v;var b=o(-1);r.NEG_ONE=b;var w=u(-1,2147483647,!1);r.MAX_VALUE=w;var _=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=_;var M=u(0,-2147483648,!1);r.MIN_VALUE=M;var E=r.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},E.toString=function(t){if((t=t||10)<2||36<t)throw RangeError(\"radix\");if(this.isZero())return\"0\";if(this.isNegative()){if(this.eq(M)){var e=a(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}return\"-\"+this.neg().toString(t)}for(var n=a(l(t,6),this.unsigned),s=this,o=\"\";;){var u=s.div(n),h=(s.sub(u.mul(n)).toInt()>>>0).toString(t);if((s=u).isZero())return h+o;for(;h.length<6;)h=\"0\"+h;o=\"\"+h+o}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(M)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return 0!=this.high?e+33:e+1},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return!(1&~this.low)},E.isEven=function(){return!(1&this.low)},E.equals=function(t){return i(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},E.eq=E.equals,E.notEquals=function(t){return!this.eq(t)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(t){return this.comp(t)<0},E.lt=E.lessThan,E.lessThanOrEqual=function(t){return this.comp(t)<=0},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(t){return this.comp(t)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(t){return this.comp(t)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(t){if(i(t)||(t=c(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(M)?M:this.not().add(x)},E.neg=E.negate,E.add=function(t){i(t)||(t=c(t));var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,s=65535&this.low,o=t.high>>>16,a=65535&t.high,l=t.low>>>16,h=0,d=0,p=0,f=0;return p+=(f+=s+(65535&t.low))>>>16,d+=(p+=n+l)>>>16,h+=(d+=r+a)>>>16,h+=e+o,u((p&=65535)<<16|(f&=65535),(h&=65535)<<16|(d&=65535),this.unsigned)},E.subtract=function(t){return i(t)||(t=c(t)),this.add(t.neg())},E.sub=E.subtract,E.multiply=function(t){if(this.isZero())return y;if(i(t)||(t=c(t)),e)return u(e.mul(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned);if(t.isZero())return y;if(this.eq(M))return t.isOdd()?M:y;if(t.eq(M))return this.isOdd()?M:y;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return a(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,s=this.low>>>16,o=65535&this.low,l=t.high>>>16,h=65535&t.high,d=t.low>>>16,p=65535&t.low,f=0,g=0,x=0,v=0;return x+=(v+=o*p)>>>16,g+=(x+=s*p)>>>16,x&=65535,g+=(x+=o*d)>>>16,f+=(g+=n*p)>>>16,g&=65535,f+=(g+=s*d)>>>16,g&=65535,f+=(g+=o*h)>>>16,f+=r*p+n*d+s*h+o*l,u((x&=65535)<<16|(v&=65535),(f&=65535)<<16|(g&=65535),this.unsigned)},E.mul=E.multiply,E.divide=function(t){if(i(t)||(t=c(t)),t.isZero())throw Error(\"division by zero\");var r,n,s;if(e)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?u((this.unsigned?e.div_u:e.div_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:y;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return g;if(t.gt(this.shru(1)))return v;s=g}else{if(this.eq(M))return t.eq(x)||t.eq(b)?M:t.eq(M)?x:(r=this.shr(1).div(t).shl(1)).eq(y)?t.isNegative()?x:b:(n=this.sub(t.mul(r)),s=r.add(n.div(t)));if(t.eq(M))return this.unsigned?g:y;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=y}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),h=o<=48?1:l(2,o-48),d=a(r),p=d.mul(t);p.isNegative()||p.gt(n);)p=(d=a(r-=h,this.unsigned)).mul(t);d.isZero()&&(d=x),s=s.add(d),n=n.sub(p)}return s},E.div=E.divide,E.modulo=function(t){return i(t)||(t=c(t)),e?u((this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return u(~this.low,~this.high,this.unsigned)},E.and=function(t){return i(t)||(t=c(t)),u(this.low&t.low,this.high&t.high,this.unsigned)},E.or=function(t){return i(t)||(t=c(t)),u(this.low|t.low,this.high|t.high,this.unsigned)},E.xor=function(t){return i(t)||(t=c(t)),u(this.low^t.low,this.high^t.high,this.unsigned)},E.shiftLeft=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?u(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):u(0,this.low<<t-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?u(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):u(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(t){if(i(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?u(this.low>>>t|e<<32-t,e>>>t,this.unsigned):u(32===t?e:e>>>t-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},E.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},E.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},r.fromBytes=function(t,e,i){return i?r.fromBytesLE(t,e):r.fromBytesBE(t,e)},r.fromBytesLE=function(t,e){return new r(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},r.fromBytesBE=function(t,e){return new r(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},6918:(t,e,r)=>{\"use strict\";t.exports=r(3729)},3729:(t,e,r)=>{\"use strict\";var i=e;function n(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}i.build=\"minimal\",i.Writer=r(8116),i.BufferWriter=r(1819),i.Reader=r(2461),i.BufferReader=r(9117),i.util=r(1679),i.rpc=r(8082),i.roots=r(575),i.configure=n,n()},2461:(t,e,r)=>{\"use strict\";t.exports=u;var i,n=r(1679),s=n.LongBits,o=n.utf8;function a(t,e){return RangeError(\"index out of range: \"+t.pos+\" + \"+(e||1)+\" > \"+t.len)}function u(t){this.buf=t,this.pos=0,this.len=t.length}var l,h=\"undefined\"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new u(t);throw Error(\"illegal buffer\")}:function(t){if(Array.isArray(t))return new u(t);throw Error(\"illegal buffer\")},c=function(){return n.Buffer?function(t){return(u.create=function(t){return n.Buffer.isBuffer(t)?new i(t):h(t)})(t)}:h};function d(){var t=new s(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error(\"invalid varint encoding\")}function p(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new s(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}u.create=c(),u.prototype._slice=n.Array.prototype.subarray||n.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=n.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=n.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},u.prototype.bytes=function(){var t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw a(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,r):e===r?new this.buf.constructor(0):this._slice.call(this.buf,e,r)},u.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},u.prototype.skip=function(t){if(\"number\"==typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(\"invalid wire type \"+t+\" at offset \"+this.pos)}return this},u._configure=function(t){i=t,u.create=c(),i._configure();var e=n.Long?\"toLong\":\"toNumber\";n.merge(u.prototype,{int64:function(){return d.call(this)[e](!1)},uint64:function(){return d.call(this)[e](!0)},sint64:function(){return d.call(this).zzDecode()[e](!1)},fixed64:function(){return f.call(this)[e](!0)},sfixed64:function(){return f.call(this)[e](!1)}})}},9117:(t,e,r)=>{\"use strict\";t.exports=s;var i=r(2461);(s.prototype=Object.create(i.prototype)).constructor=s;var n=r(1679);function s(t){i.call(this,t)}s._configure=function(){n.Buffer&&(s.prototype._slice=n.Buffer.prototype.slice)},s.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString(\"utf-8\",this.pos,this.pos=Math.min(this.pos+t,this.len))},s._configure()},575:t=>{\"use strict\";t.exports={}},8082:(t,e,r)=>{\"use strict\";e.Service=r(7927)},7927:(t,e,r)=>{\"use strict\";t.exports=n;var i=r(1679);function n(t,e,r){if(\"function\"!=typeof t)throw TypeError(\"rpcImpl must be a function\");i.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(r)}(n.prototype=Object.create(i.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function t(e,r,n,s,o){if(!s)throw TypeError(\"request must be specified\");var a=this;if(!o)return i.asPromise(t,a,e,r,n,s);if(a.rpcImpl)try{return a.rpcImpl(e,r[a.requestDelimited?\"encodeDelimited\":\"encode\"](s).finish(),(function(t,r){if(t)return a.emit(\"error\",t,e),o(t);if(null!==r){if(!(r instanceof n))try{r=n[a.responseDelimited?\"decodeDelimited\":\"decode\"](r)}catch(t){return a.emit(\"error\",t,e),o(t)}return a.emit(\"data\",r,e),o(null,r)}a.end(!0)}))}catch(t){return a.emit(\"error\",t,e),void setTimeout((function(){o(t)}),0)}else setTimeout((function(){o(Error(\"already ended\"))}),0)},n.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit(\"end\").off()),this}},8294:(t,e,r)=>{\"use strict\";t.exports=n;var i=r(1679);function n(t,e){this.lo=t>>>0,this.hi=e>>>0}var s=n.zero=new n(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=n.zeroHash=\"\\0\\0\\0\\0\\0\\0\\0\\0\";n.fromNumber=function(t){if(0===t)return s;var e=t<0;e&&(t=-t);var r=t>>>0,i=(t-r)/4294967296>>>0;return e&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new n(r,i)},n.from=function(t){if(\"number\"==typeof t)return n.fromNumber(t);if(i.isString(t)){if(!i.Long)return n.fromNumber(parseInt(t,10));t=i.Long.fromString(t)}return t.low||t.high?new n(t.low>>>0,t.high>>>0):s},n.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+4294967296*r)}return this.lo+4294967296*this.hi},n.prototype.toLong=function(t){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var a=String.prototype.charCodeAt;n.fromHash=function(t){return t===o?s:new n((a.call(t,0)|a.call(t,1)<<8|a.call(t,2)<<16|a.call(t,3)<<24)>>>0,(a.call(t,4)|a.call(t,5)<<8|a.call(t,6)<<16|a.call(t,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},n.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},n.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:r<128?9:10}},1679:function(t,e,r){\"use strict\";var i=e;function n(t,e,r){for(var i=Object.keys(e),n=0;n<i.length;++n)void 0!==t[i[n]]&&r||(t[i[n]]=e[i[n]]);return t}function s(t){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,\"message\",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,\"stack\",{value:(new Error).stack||\"\"}),r&&n(this,r)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,\"name\",{get:function(){return t}}),e.prototype.toString=function(){return this.name+\": \"+this.message},e}i.asPromise=r(7018),i.base64=r(2647),i.EventEmitter=r(2922),i.float=r(7955),i.inquire=r(8446),i.utf8=r(5226),i.pool=r(5374),i.LongBits=r(8294),i.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),i.global=i.isNode&&r.g||\"undefined\"!=typeof window&&window||\"undefined\"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(t){return\"number\"==typeof t&&isFinite(t)&&Math.floor(t)===t},i.isString=function(t){return\"string\"==typeof t||t instanceof String},i.isObject=function(t){return t&&\"object\"==typeof t},i.isset=i.isSet=function(t,e){var r=t[e];return!(null==r||!t.hasOwnProperty(e))&&(\"object\"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},i.Buffer=function(){try{var t=i.inquire(\"buffer\").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(t){return\"number\"==typeof t?i.Buffer?i._Buffer_allocUnsafe(t):new i.Array(t):i.Buffer?i._Buffer_from(t):\"undefined\"==typeof Uint8Array?t:new Uint8Array(t)},i.Array=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire(\"long\"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\\\x00-\\\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(t){return t?i.LongBits.from(t).toHash():i.LongBits.zeroHash},i.longFromHash=function(t,e){var r=i.LongBits.fromHash(t);return i.Long?i.Long.fromBits(r.lo,r.hi,e):r.toNumber(Boolean(e))},i.merge=n,i.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},i.newError=s,i.ProtocolError=s(\"ProtocolError\"),i.oneOfGetter=function(t){for(var e={},r=0;r<t.length;++r)e[t[r]]=1;return function(){for(var t=Object.keys(this),r=t.length-1;r>-1;--r)if(1===e[t[r]]&&void 0!==this[t[r]]&&null!==this[t[r]])return t[r]}},i.oneOfSetter=function(t){return function(e){for(var r=0;r<t.length;++r)t[r]!==e&&delete this[t[r]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var t=i.Buffer;t?(i._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,r){return new t(e,r)},i._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):i._Buffer_from=i._Buffer_allocUnsafe=null}},8116:(t,e,r)=>{\"use strict\";t.exports=c;var i,n=r(1679),s=n.LongBits,o=n.base64,a=n.utf8;function u(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function l(){}function h(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function c(){this.len=0,this.head=new u(l,0,0),this.tail=this.head,this.states=null}var d=function(){return n.Buffer?function(){return(c.create=function(){return new i})()}:function(){return new c}};function p(t,e,r){e[r]=255&t}function f(t,e){this.len=t,this.next=void 0,this.val=e}function m(t,e,r){for(;t.hi;)e[r++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=127&t.lo|128,t.lo=t.lo>>>7;e[r++]=t.lo}function y(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}c.create=d(),c.alloc=function(t){return new n.Array(t)},n.Array!==Array&&(c.alloc=n.pool(c.alloc,n.Array.prototype.subarray)),c.prototype._push=function(t,e,r){return this.tail=this.tail.next=new u(t,e,r),this.len+=e,this},f.prototype=Object.create(u.prototype),f.prototype.fn=function(t,e,r){for(;t>127;)e[r++]=127&t|128,t>>>=7;e[r]=t},c.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new f((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},c.prototype.int32=function(t){return t<0?this._push(m,10,s.fromNumber(t)):this.uint32(t)},c.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},c.prototype.uint64=function(t){var e=s.from(t);return this._push(m,e.length(),e)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(t){var e=s.from(t).zzEncode();return this._push(m,e.length(),e)},c.prototype.bool=function(t){return this._push(p,1,t?1:0)},c.prototype.fixed32=function(t){return this._push(y,4,t>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(t){var e=s.from(t);return this._push(y,4,e.lo)._push(y,4,e.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(t){return this._push(n.float.writeFloatLE,4,t)},c.prototype.double=function(t){return this._push(n.float.writeDoubleLE,8,t)};var g=n.Array.prototype.set?function(t,e,r){e.set(t,r)}:function(t,e,r){for(var i=0;i<t.length;++i)e[r+i]=t[i]};c.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(p,1,0);if(n.isString(t)){var r=c.alloc(e=o.length(t));o.decode(t,r,0),t=r}return this.uint32(e)._push(g,e,t)},c.prototype.string=function(t){var e=a.length(t);return e?this.uint32(e)._push(a.write,e,t):this._push(p,1,0)},c.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new u(l,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(l,0,0),this.len=0),this},c.prototype.ldelim=function(){var t=this.head,e=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=t.next,this.tail=e,this.len+=r),this},c.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),r=0;t;)t.fn(t.val,e,r),r+=t.len,t=t.next;return e},c._configure=function(t){i=t,c.create=d(),i._configure()}},1819:(t,e,r)=>{\"use strict\";t.exports=s;var i=r(8116);(s.prototype=Object.create(i.prototype)).constructor=s;var n=r(1679);function s(){i.call(this)}function o(t,e,r){t.length<40?n.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}s._configure=function(){s.alloc=n._Buffer_allocUnsafe,s.writeBytesBuffer=n.Buffer&&n.Buffer.prototype instanceof Uint8Array&&\"set\"===n.Buffer.prototype.set.name?function(t,e,r){e.set(t,r)}:function(t,e,r){if(t.copy)t.copy(e,r,0,t.length);else for(var i=0;i<t.length;)e[r++]=t[i++]}},s.prototype.bytes=function(t){n.isString(t)&&(t=n._Buffer_from(t,\"base64\"));var e=t.length>>>0;return this.uint32(e),e&&this._push(s.writeBytesBuffer,e,t),this},s.prototype.string=function(t){var e=n.Buffer.byteLength(t);return this.uint32(e),e&&this._push(o,e,t),this},s._configure()},7769:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(5185),e),n(r(6406),e),n(r(6114),e),n(r(8934),e),n(r(1072),e),n(r(7259),e),n(r(8284),e),n(r(1017),e),n(r(1370),e),n(r(1216),e),n(r(8131),e)},8152:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(7395),e),n(r(8920),e),n(r(4835),e),n(r(9421),e),n(r(9362),e),n(r(7980),e),n(r(2286),e),n(r(3253),e),n(r(8770),e),n(r(1072),e)},3253:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.scaleHeight=e.getFeatureText=e.getFeatureName=e.getFeatureId=e.getProjectionName=e.getProjection=e.GeometryType=e.getArrayConstructor=void 0;const i=r(2616),n=r(1984),s=r(3561);function o(t,e,r){var i;let n;if(void 0===e&&(e=\"name\"),void 0!==r)for(const s of r)if(n=null!==(i=t.lookup(`${e}:${s}`))&&void 0!==i?i:t.lookup(`${e}_${s}`),\"string\"==typeof n&&n.length>0)return n;if(n=t.lookup(e),\"string\"==typeof n)return n}var a;e.getArrayConstructor=function(t){switch(t){case\"float\":return Float32Array;case\"uint8\":return Uint8Array;case\"uint16\":return Uint16Array;case\"uint32\":return Uint32Array;case\"int8\":return Int8Array;case\"int16\":return Int16Array;case\"int32\":return Int32Array}},(a=e.GeometryType||(e.GeometryType={}))[a.Unspecified=0]=\"Unspecified\",a[a.Point=1]=\"Point\",a[a.Line=2]=\"Line\",a[a.SolidLine=3]=\"SolidLine\",a[a.Text=4]=\"Text\",a[a.TextPath=5]=\"TextPath\",a[a.ExtrudedLine=6]=\"ExtrudedLine\",a[a.Polygon=7]=\"Polygon\",a[a.ExtrudedPolygon=8]=\"ExtrudedPolygon\",a[a.Object3D=9]=\"Object3D\",a[a.Other=1e3]=\"Other\",e.getProjection=function(t){switch(t){case\"mercator\":return i.mercatorProjection;case\"webMercator\":return i.webMercatorProjection;case\"sphere\":return i.sphereProjection;case\"normalizedEquirectangular\":return i.normalizedEquirectangularProjection;case\"equirectangular\":return i.equirectangularProjection;default:throw new Error(`Unknown projection ${t}`)}},e.getProjectionName=function(t){if(t===i.mercatorProjection)return\"mercator\";if(t===i.webMercatorProjection)return\"webMercator\";if(t===i.sphereProjection)return\"sphere\";if(t===i.normalizedEquirectangularProjection)return\"normalizedEquirectangular\";if(t===i.equirectangularProjection)return\"equirectangular\";throw new Error(\"Unknown projection\")},e.getFeatureId=function(t){if(void 0===t)return 0;if(\"string\"==typeof t||\"number\"==typeof t)return t;if(t.hasOwnProperty(\"$id\")){const e=t.$id;if(\"string\"==typeof e||\"number\"==typeof e)return e}return 0},e.getFeatureName=o,e.getFeatureText=function(t,e,r){const i=t instanceof n.Env?t:t.env;if((0,n.isTextTechnique)(e)||(0,n.isIconTextTechnique)(e)||(0,n.isLineMarkerTechnique)(e)){if(void 0!==e.text)return(0,s.evaluateTechniqueAttr)(t,e.text);if((0,n.isIconTextTechnique)(e)||(0,n.isLineMarkerTechnique)(e))return}return o(i,\"name\",r)},e.scaleHeight=function(t,e,r){return!(0,s.evaluateTechniqueAttr)(t,e.constantHeight,r<12)}},1072:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isFeatureGeometry=void 0,e.isFeatureGeometry=function(t){const e=t.type;return\"Point\"===e||\"MultiPoint\"===e||\"LineString\"===e||\"MultiLineString\"===e||\"Polygon\"===e||\"MultiPolygon\"===e}},6406:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},7980:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},2286:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},6114:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.addPolygonEdges=void 0;const i=r(5448),n=new i.Vector2,s=new i.Vector2,o=new i.Vector2,a=new i.Vector2;e.addPolygonEdges=function(t,e,r,i,u,l,h,c){for(let d=0;d<u.length;++d)if(u[d])if(!0===l){const l=e+2*d,p=l+1,f=e+(d+1)%u.length*2,m=f+1;!0===h&&t.push(l,f),t.push(p,m);const y=(0===d?u.length:d)-1;if(u[y])if(void 0!==c){const e=i[d*r],h=i[d*r+1],f=i[(d+1)%u.length*r],m=i[(d+1)%u.length*r+1];n.set(e,h),s.set(f,m),o.set(i[y*r],i[y*r+1]),a.set(n.x,n.y),a.sub(o).normalize().dot(s.sub(n).normalize())<=c&&t.push(l,p)}else t.push(l,p)}else{const r=e+d,i=e+(d+1)%u.length;t.push(r,i)}}},7395:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},8920:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.getPropertyValue=void 0;const i=r(1984),n=r(4342).LoggerManager.instance.create(\"PropertyValue\");e.getPropertyValue=function(t,e,r){try{return(0,i.getPropertyValue)(t,e,r)}catch(e){return n.error(\"failed to evaluate expression\",JSON.stringify(t),\"error\",String(e)),null}}},5185:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.makeDecodedTechnique=e.StyleSetEvaluator=void 0;const i=r(1984),n=r(8023),s=r(8797),o=r(8628),a=r(4342),u=r(5535),l=a.LoggerManager.instance.create(\"StyleSetEvaluator\"),h=u.AttrScope.TechniqueGeometry;class c{classify(t){if(t._whenExpr){const e=this.switchStyle(t);t._whenExpr=t._whenExpr.accept(this,void 0),this._style=e}}visitNullLiteralExpr(t,e){return t}visitBooleanLiteralExpr(t,e){return t}visitNumberLiteralExpr(t,e){return t}visitStringLiteralExpr(t,e){return t}visitObjectLiteralExpr(t,e){return t}visitVarExpr(t,e){return t}visitHasAttributeExpr(t,e){return t}visitMatchExpr(t,e){return t}visitCaseExpr(t,e){return t}visitCallExpr(t,e){if(\"all\"===t.op){const e=t.args.map((e=>e.accept(this,t))).filter((t=>void 0!==t));return new n.CallExpr(t.op,e)}if(e){const e=this.matchVarStringComparison(t);if(e){if(void 0===this._style.dataLayer&&\"$layer\"===e.name)return void(this._style.dataLayer=e.value);if(void 0===this._style._geometryType&&\"$geometryType\"===e.name)return void(this._style._geometryType=e.value)}}return t}visitLookupExpr(t,e){return this.visitCallExpr(t,e)}visitStepExpr(t,e){return t}visitInterpolateExpr(t,e){return t}matchVarStringComparison(t){if(\"==\"===t.op){const e=t.args[0],r=t.args[1];if(e instanceof n.VarExpr&&r instanceof n.StringLiteralExpr)return{name:e.name,value:r.value};if(r instanceof n.VarExpr&&e instanceof n.StringLiteralExpr)return{name:r.name,value:e.value}}}switchStyle(t){const e=this._style;return this._style=t,e}}class d{constructor(t,e){this.key=\"\",this.set(t,e)}set(t,e,r){let i=!1;if(void 0===t){const e=void 0!==r?r.lookup(\"$layer\"):void 0;t=\"string\"==typeof e?e:void 0}if(this.layer!==t&&(this.layer=t,i=!0),void 0===e){const t=void 0!==r?r.lookup(\"$geometryType\"):void 0;e=\"string\"==typeof t?t:void 0}return this.geometryType!==e&&(this.geometryType=e,i=!0),i&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key=\"all\",this.cachedStyleSet=void 0}}function p(t){const e={};for(const r in t){if(!t.hasOwnProperty(r))continue;let i=t[r];\"object\"==typeof i&&(i.isVector2||i.isVector3||i.isVector4)&&(i=n.LiteralExpr.fromValue(i)),n.Expr.isExpr(i)&&(i=i.toJSON()),e[r]=i}return e}e.StyleSetEvaluator=class{constructor(t){this.m_options=t,this.styleSet=[],this.m_techniques=[],this.m_exprPool=new s.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new c,this.m_subStyleSetCache=new Map,this.m_areCurrentDefinitionsOverridden=!0,this.m_definitionsContainVerbose=!1,this.m_disabledStyles={byId:new Set,byLayer:new Set},this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new d,this.m_emptyEnv=new i.Env,this.m_featureDependencies=[\"$layer\",\"$geometryType\",\"$zoom\"],this.m_nextArrayBufferId=0,this.m_definitions=this.m_options.definitions;for(const t in this.m_definitions)this.m_definitionsContainVerbose||(this.m_definitionsContainVerbose=(0,i.isVerboseDefinition)(this.m_definitions[t]));this.styleSet=this.m_options.styleSet.map((t=>{const e=Object.assign(Object.assign({},t),{_forceCompile:!0});return t.attr&&(e.attr=Object.assign({},t.attr)),e})),function(t){var e;let r=0,i=0;for(const n of t)n._styleIndex=i++,void 0!==n.technique&&void 0===(null===(e=n.attr)||void 0===e?void 0:e.renderOrder)&&(void 0===n.attr?n.attr={renderOrder:r++}:n.attr.renderOrder=r++)}(this.styleSet),this.m_features=this.validateFeatures(this.m_options.features);const e=[];for(const t in this.m_features)this.m_features[t].modes.forEach((t=>{t.extendedDefinitions&&Array.prototype.push.apply(e,Object.keys(t.extendedDefinitions))}));this.m_modesDefinitions=new Set(e),this.setEnabledFeatures(t.enabledFeatures)}setEnabledFeatures(t){this.applyFeaturesAndModes(null!=t?t:this.getFeaturesEnabledByDefault())}getFeaturesEnabledByDefault(){var t;const e=[];if(this.m_features)for(const r in this.m_features){const i=this.m_features[r];i.enabledByDefault&&e.push({feature:r,mode:null===(t=i.modes[0])||void 0===t?void 0:t.name})}return e}applyFeaturesAndModes(t){if(this.m_disabledStyles.byId.clear(),this.m_disabledStyles.byLayer.clear(),this.resetTechniques(),this.m_areCurrentDefinitionsOverridden&&(this.m_definitionsContainVerbose?this.m_currentDefinitions=JSON.parse(JSON.stringify(this.m_definitions)):this.m_currentDefinitions=Object.assign({},this.m_definitions),this.m_areCurrentDefinitionsOverridden=!1),this.m_features)for(const e in this.m_features){const r=this.m_features[e];let i;const n=t.find((t=>t.feature===e));n?(i=r.modes.find((t=>t.name===n.mode)),i||(i=r.modes[0])):i=r.disabledMode,i.disabledLayers&&i.disabledLayers.forEach((t=>{this.m_disabledStyles.byLayer.add(t)})),i.disabledStyleRules&&i.disabledStyleRules.forEach((t=>{this.m_disabledStyles.byId.add(t)})),this.m_currentDefinitions&&(null==i?void 0:i.extendedDefinitions)&&(this.m_areCurrentDefinitionsOverridden=!0,Object.assign(this.m_currentDefinitions,null==i?void 0:i.extendedDefinitions))}this.m_definitionExprCache.clear(),this.m_cachedResults.clear(),this.m_subStyleSetCache.clear(),this.compileStyleSet()}validateFeatures(t){const e={};for(const r in t){const i=t[r];Array.isArray(i.modes)&&0!==i.modes.length&&void 0!==i.disabledMode?e[r]=i:l.error(`The style configuration is invalid. The feature \"${r}\" must be an array, have at least one mode and specify a value for disabledMode property`)}if(Object.keys(e).length>0)return e}isStyleDisabled(t){if(void 0!==this.m_disabledStyles){if(void 0!==t.layer&&this.m_disabledStyles.byLayer.has(t.layer))return!0;if(void 0!==t.id&&this.m_disabledStyles.byId.has(t.id))return!0}return!1}getMatchingTechniques(t,e,r){if(this.m_previousResult&&this.m_previousEnv&&this.m_featureDependencies.every((e=>{var r;return(null===(r=this.m_previousEnv)||void 0===r?void 0:r.lookup(e))===t.lookup(e)})))return this.m_previousResult;const i=[];this.m_cachedResults.clear();const n=this.m_tmpOptimizedSubSetKey;n.set(e,r,t),this.m_dataLayer=n.layer,this.m_geometryType=n.geometryType,this.m_zoomLevel=t.lookup(\"$zoom\");const s=this.getOptimizedStyleSet(n);for(const e of s)if(this.processStyle(t,e,i))break;return this.m_previousResult=i,this.m_previousEnv=t,i}wantsDataLayer(t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(t,void 0)).length>0}wantsFeature(t,e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(t,e)).length>0}resetTechniques(){for(const t of this.m_techniques)t._index=void 0;this.m_techniques.length=0,this.m_previousResult=void 0,this.m_previousEnv=void 0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(p)}getOptimizedStyleSet(t){if(void 0!==t.cachedStyleSet)return t.cachedStyleSet;let e=this.m_subStyleSetCache.get(t.key);return void 0!==e?(t.cachedStyleSet=e,e):(e=this.createPreFilteredStyleSet(t),this.m_subStyleSetCache.set(t.key,e),t.cachedStyleSet=e,e)}createPreFilteredStyleSet(t){const{layer:e,geometryType:r}=t;return this.styleSet.filter((t=>!(void 0!==e&&void 0!==t.dataLayer&&t.dataLayer!==e||void 0!==r&&void 0!==t._geometryType&&t._geometryType!==r)))}compileStyleSet(){this.styleSet.forEach((t=>this.compileStyle(t))),this.styleSet.forEach((t=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(t.dataLayer,t._geometryType))}))}compileStyle(t){var e,r;try{this.compileStyleAttributes(t)}catch(e){l.error(\"failed to evaluate style rule\",t,String(e))}if(void 0!==t.when)try{t._whenExpr=n.Expr.fromJSON(t.when,this.m_currentDefinitions,this.m_definitionExprCache),this.m_styleConditionClassifier.classify(t),void 0!==t._whenExpr&&(t._whenExpr=t._whenExpr.intern(this.m_exprPool));const s=t._whenExpr.dependencies();null==s||s.properties.forEach((t=>{this.m_featureDependencies.includes(t)||this.m_featureDependencies.push(t)})),(0,i.isJsonExpr)(null===(e=t.attr)||void 0===e?void 0:e.minZoomLevel)&&(t._minZoomLevelExpr=n.Expr.fromJSON(t.attr.minZoomLevel,this.m_currentDefinitions).intern(this.m_exprPool)),(0,i.isJsonExpr)(null===(r=t.attr)||void 0===r?void 0:r.maxZoomLevel)&&(t._maxZoomLevelExpr=n.Expr.fromJSON(t.attr.maxZoomLevel,this.m_currentDefinitions).intern(this.m_exprPool))}catch(e){l.error(\"failed to evaluate expression\",JSON.stringify(t.when),String(e))}}processStyle(t,e,r){if(!this.checkZoomLevel(t,e))return!1;if(this.isStyleDisabled(e))return!1;if(void 0!==this.m_dataLayer&&void 0!==e.dataLayer&&e.dataLayer!==this.m_dataLayer)return!1;if(void 0!==this.m_geometryType&&void 0!==e._geometryType&&e._geometryType!==this.m_geometryType)return!1;if(e._whenExpr)try{if(!e._whenExpr.evaluate(t,n.ExprScope.Condition,this.m_cachedResults))return!1}catch(t){return l.error(`failed to evaluate expression '${JSON.stringify(e.when)}': ${t}`),!1}return void 0!==e.technique&&(\"none\"!==e.technique&&r.push(this.getTechniqueForStyleMatch(t,e)),!0===e.final)}checkZoomLevel(t,e){var r,i,s,o,a;const u=this.m_zoomLevel;if(void 0===u||u>=17)return!0;let h=null===(r=e.attr)||void 0===r?void 0:r.minZoomLevel,c=null===(i=e.attr)||void 0===i?void 0:i.maxZoomLevel;if(void 0===h&&void 0===c)return!0;if(void 0!==h){if(!1===(null===(s=e._minZoomLevelExpr)||void 0===s?void 0:s.isDynamic()))try{h=e._minZoomLevelExpr.evaluate(t,n.ExprScope.Condition,this.m_cachedResults)}catch(t){l.error(`failed to evaluate expression '${JSON.stringify(e._minZoomLevelExpr)}': ${t}`)}if(\"number\"==typeof h&&u<Math.floor(h))return!1}if(void 0!==(null===(o=e.attr)||void 0===o?void 0:o.maxZoomLevel)){if(!1===(null===(a=e._maxZoomLevelExpr)||void 0===a?void 0:a.isDynamic()))try{c=e._maxZoomLevelExpr.evaluate(t,n.ExprScope.Condition,this.m_cachedResults)}catch(t){l.error(`failed to evaluate expression '${JSON.stringify(e._maxZoomLevelExpr)}': ${t}`)}if(\"number\"==typeof c&&u>=Math.ceil(c))return!1}return!0}getTechniqueForStyleMatch(t,e){let r;if(void 0!==e._dynamicTechniques){const i=this.evaluateTechniqueProperties(e,t),n=this.getDynamicTechniqueKey(e,i);r=e._dynamicTechniques.get(n),void 0===r&&(r=this.createTechnique(e,i),e._dynamicTechniques.set(n,r))}else r=e._staticTechnique,void 0===r&&(e._staticTechnique=r=this.createTechnique(e,[]));return void 0===r._index&&(r._index=this.m_techniques.length,this.m_techniques.push(r)),r}getDynamicTechniqueKey(t,e){const r=e.map((([t,e])=>void 0===e?\"U\":\"object\"==typeof e?JSON.stringify(e,((t,e)=>{if(e instanceof ArrayBuffer){let t=e.id;return void 0===t&&(t=e.id=this.m_nextArrayBufferId++),t}return e})):JSON.stringify(e))).join(\":\");return`${t._styleIndex}:${r}`}compileStyleAttributes(t){var e;if(!t._forceCompile&&(void 0!==t._dynamicTechniqueAttributes||\"none\"===t.technique))return;t._dynamicTechniqueAttributes=[],t._dynamicFeatureAttributes=[],t._dynamicForwardedAttributes=[],t._staticAttributes=[],t._staticTechnique=void 0,t._dynamicTechniques=void 0;const r=t._dynamicFeatureAttributes,s=t._dynamicTechniqueAttributes,a=t._dynamicForwardedAttributes,c=t._staticAttributes,d=(e,d)=>{if(void 0===d)return;const p=new Set;if((0,i.isJsonExpr)(d)?d=n.Expr.fromJSON(d,this.m_currentDefinitions,this.m_definitionExprCache,p).intern(this.m_exprPool):(0,o.isInterpolatedPropertyDefinition)(d)&&(d=n.Expr.fromJSON((0,o.interpolatedPropertyDefinitionToJsonExpr)(d)).intern(this.m_exprPool)),n.Expr.isExpr(d)){const r=d.dependencies();r.featureState&&(\"enabled\"!==e?l.log(\"feature-state is not supported in this context\"):t._usesFeatureState=!0),0!==r.properties.size||d.isDynamic()||(d=d.evaluate(this.m_emptyEnv))}if(n.Expr.isExpr(d)){const i=function(t,e){var r,i,n;return\"extruded-polygon\"===t.technique&&\"color\"===e&&!1!==(null===(r=t.attr)||void 0===r?void 0:r.vertexColors)?h:null!==(n=null===(i=(0,u.getTechniqueAttributeDescriptor)(t.technique,e))||void 0===i?void 0:i.scope)&&void 0!==n?n:h}(t,e),n=d.dependencies();switch(n.properties.forEach((t=>{this.m_featureDependencies.includes(t)||this.m_featureDependencies.push(t)})),i){case u.AttrScope.FeatureGeometry:r.push([e,d]);break;case u.AttrScope.TechniqueGeometry:s.push([e,d]);break;case u.AttrScope.TechniqueRendering:0===n.properties.size?a.push([e,d]):s.push([e,d])}}else null!=d&&c.push([e,d]);for(const e of p.values())if(this.m_modesDefinitions.has(e)){t._forceCompile=!0;break}};t._forceCompile=!1;for(const e in t)t.hasOwnProperty(e)&&(e.startsWith(\"_\")||[\"when\",\"technique\",\"layer\",\"attr\",\"category\",\"description\"].includes(e)||d(e,t[e]));const p=new Map([[\"category\",\"_category\"]]);if(void 0!==t.attr)for(const r in t.attr)t.attr.hasOwnProperty(r)&&d(null!==(e=p.get(r))&&void 0!==e?e:r,t.attr[r]);s.length>0&&(t._dynamicTechniques=new Map)}evaluateTechniqueProperties(t,e){return void 0===t._dynamicTechniqueAttributes?[]:t._dynamicTechniqueAttributes.map((([t,r])=>{try{return[t,r.evaluate(e,n.ExprScope.Value,this.m_cachedResults)]}catch(e){return l.error(`failed to evaluate expression '${r.toJSON()}': ${e}`),[t,null]}}))}createTechnique(t,e){var r,n;const s={};if(s.name=t.technique,void 0!==t._staticAttributes)for(const[e,r]of t._staticAttributes)null!==r&&(s[e]=r);for(const[t,r]of e)null!==r&&(s[t]=r);if(void 0!==t._dynamicFeatureAttributes)for(const[e,r]of t._dynamicFeatureAttributes)s[e]=r;if(void 0!==t._dynamicForwardedAttributes)for(const[e,r]of t._dynamicForwardedAttributes)s[e]=r;return s._index=this.m_techniques.length,s._styleIndex=t._styleIndex,void 0!==t.layer&&(s._layer=t.layer),void 0!==t._usesFeatureState&&(s._usesFeatureState=t._usesFeatureState),(0,i.setTechniqueRenderOrderOrPriority)(s,null!==(r=this.m_options.priorities)&&void 0!==r?r:[],null!==(n=this.m_options.labelPriorities)&&void 0!==n?n:[]),this.m_techniques.push(s),s}},e.makeDecodedTechnique=p},3561:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.evaluateTechniqueAttr=void 0;const i=r(1984),n=r(8920);e.evaluateTechniqueAttr=function(t,e,r){if(void 0===e)return r;const s=i.Env.isEnv(t)?(0,n.getPropertyValue)(e,t):(0,n.getPropertyValue)(e,t.env,t.cachedExprResults);return null!=s?s:r}},5535:(t,e)=>{\"use strict\";var r;function i(...t){const e={attrDescriptors:{}};for(const r of t)void 0!==r.attrTransparencyColor&&(e.attrTransparencyColor=r.attrTransparencyColor),void 0!==r.attrDescriptors&&(e.attrDescriptors=Object.assign(Object.assign({},e.attrDescriptors),r.attrDescriptors));return e}Object.defineProperty(e,\"__esModule\",{value:!0}),e.getTechniqueAutomaticAttrs=e.getTechniqueAttributeDescriptor=e.getTechniqueDescriptor=e.AttrScope=void 0,function(t){t[t.FeatureGeometry=0]=\"FeatureGeometry\",t[t.TechniqueGeometry=1]=\"TechniqueGeometry\",t[t.TechniqueRendering=2]=\"TechniqueRendering\"}(r=e.AttrScope||(e.AttrScope={}));const n={attrTransparencyColor:\"color\",attrDescriptors:{constantHeight:r.FeatureGeometry,visible:r.FeatureGeometry,fadeFar:r.TechniqueRendering,fadeNear:r.TechniqueRendering,transparent:{scope:r.TechniqueRendering,automatic:!0},side:{scope:r.TechniqueRendering,automatic:!0}}},s=i(n,{attrDescriptors:{color:{scope:r.TechniqueRendering,automatic:!0},size:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0}}}),o=i(n,s),a=i(n,s),u=i(n,{attrDescriptors:{text:r.FeatureGeometry,imageTexture:r.FeatureGeometry,iconColor:r.TechniqueRendering,iconBrightness:r.TechniqueRendering,textBrightness:r.TechniqueRendering,backgroundColor:r.TechniqueRendering,backgroundSize:r.TechniqueRendering,backgroundOpacity:r.TechniqueRendering,color:r.TechniqueRendering,opacity:r.TechniqueRendering,size:r.TechniqueRendering,priority:r.TechniqueRendering,zOrder:r.TechniqueRendering,margin:r.TechniqueRendering,\"check-margin\":r.TechniqueRendering,\"anchor-point-density\":r.TechniqueRendering}}),l={attrDescriptors:{polygonOffset:{scope:r.TechniqueRendering,automatic:!0},polygonOffsetFactor:{scope:r.TechniqueRendering,automatic:!0},polygonOffsetUnits:{scope:r.TechniqueRendering,automatic:!0},depthTest:{scope:r.TechniqueRendering,automatic:!0},transparent:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},color:{scope:r.TechniqueRendering,automatic:!0},lineColor:r.TechniqueRendering,lineFadeFar:r.TechniqueRendering,lineFadeNear:r.TechniqueRendering}},h=i(n,l,{attrDescriptors:{width:r.TechniqueRendering,cap:{scope:r.TechniqueRendering,automatic:!0},drawRangeStart:{scope:r.TechniqueRendering,automatic:!0},drawRangeEnd:{scope:r.TechniqueRendering,automatic:!0},dashes:{scope:r.TechniqueRendering,automatic:!0},dashColor:{scope:r.TechniqueRendering,automatic:!0},\"dash-pattern\":{scope:r.TechniqueRendering,automatic:!0},\"dash-image\":{scope:r.TechniqueRendering,automatic:!0}}}),c=i(n,{attrDescriptors:{color:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},width:r.FeatureGeometry}}),d=i(n,l,{attrDescriptors:{wireframe:{scope:r.TechniqueRendering,automatic:!0},color:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},transparent:{scope:r.TechniqueRendering,automatic:!0},lineWidth:r.TechniqueRendering,map:{scope:r.TechniqueRendering,automatic:!0}}}),p=i(n,{attrDescriptors:{color:{scope:r.TechniqueRendering,automatic:!0},vertexColors:{scope:r.TechniqueRendering,automatic:!0},wireframe:{scope:r.TechniqueRendering,automatic:!0},roughness:{scope:r.TechniqueRendering,automatic:!0},metalness:{scope:r.TechniqueRendering,automatic:!0},alphaTest:{scope:r.TechniqueRendering,automatic:!0},depthTest:{scope:r.TechniqueRendering,automatic:!0},transparent:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},emissive:{scope:r.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:r.TechniqueRendering,automatic:!0},refractionRatio:{scope:r.TechniqueRendering,automatic:!0},normalMapType:{scope:r.TechniqueRendering,automatic:!0},map:{scope:r.TechniqueRendering,automatic:!0},normalMap:{scope:r.TechniqueRendering,automatic:!0},displacementMap:{scope:r.TechniqueRendering,automatic:!0},roughnessMap:{scope:r.TechniqueRendering,automatic:!0},emissiveMap:{scope:r.TechniqueRendering,automatic:!0},bumpMap:{scope:r.TechniqueRendering,automatic:!0},metalnessMap:{scope:r.TechniqueRendering,automatic:!0},alphaMap:{scope:r.TechniqueRendering,automatic:!0}}}),f={\"extruded-polygon\":i(n,{attrDescriptors:{depthTest:{scope:r.TechniqueRendering,automatic:!0},vertexColors:{scope:r.TechniqueRendering,automatic:!0},opacity:{scope:r.TechniqueRendering,automatic:!0},color:{scope:r.TechniqueRendering,automatic:!0},colorIntensity:{scope:r.TechniqueRendering,automatic:!0},specular:{scope:r.TechniqueRendering,automatic:!0},emissive:{scope:r.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:r.TechniqueRendering,automatic:!0},shininess:{scope:r.TechniqueRendering,automatic:!0},displacementMap:{scope:r.TechniqueRendering,automatic:!0},height:r.FeatureGeometry,floorHeight:r.FeatureGeometry,defaultColor:r.FeatureGeometry,defaultHeight:r.FeatureGeometry,boundaryWalls:r.FeatureGeometry,footprint:r.FeatureGeometry,maxSlope:r.FeatureGeometry,animateExtrusion:r.TechniqueRendering,lineWidth:r.TechniqueRendering,lineFadeNear:r.TechniqueRendering,lineFadeFar:r.TechniqueRendering,lineColor:r.TechniqueRendering}}),\"line-marker\":u,\"labeled-icon\":u,\"solid-line\":h,\"dashed-line\":h,terrain:p,standard:p,squares:o,circles:a,line:c,segments:c,polygon:d,text:i(n,{attrDescriptors:{text:r.FeatureGeometry,backgroundColor:r.TechniqueRendering,backgroundSize:r.TechniqueRendering,backgroundOpacity:r.TechniqueRendering,color:r.TechniqueRendering,opacity:r.TechniqueRendering,size:r.TechniqueRendering,priority:r.TechniqueRendering,zOrder:r.TechniqueRendering}}),raster:i(n,{attrDescriptors:{brightness:{scope:r.TechniqueRendering,automatic:!0},gamma:{scope:r.TechniqueRendering,automatic:!0}}})};function m(t){return\"string\"!=typeof t&&(t=t.name),f[t]}e.getTechniqueDescriptor=m,e.getTechniqueAttributeDescriptor=function(t,e){const r=m(t),i=null==r?void 0:r.attrDescriptors,n=null==i?void 0:i[e];if(void 0!==typeof n)return\"object\"==typeof n?n:{scope:n}};const y=new Map;e.getTechniqueAutomaticAttrs=function(t){var e;if(\"string\"!=typeof t&&(t=t.name),y.has(t))return y.get(t);const r=[],i=null===(e=m(t))||void 0===e?void 0:e.attrDescriptors;if(void 0===i)return r;for(const t in i){if(!i.hasOwnProperty(t))continue;const e=i[t];void 0!==e&&\"number\"!=typeof e&&!0===e.automatic&&r.push(t)}return y.set(t,r),r}},8934:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ThreeBufferUtils=void 0;const i=r(3253);!function(t){function e(t){if(t instanceof Int8Array)return\"int8\";if(t instanceof Uint8Array)return\"uint8\";if(t instanceof Int16Array)return\"int16\";if(t instanceof Uint16Array)return\"uint16\";if(t instanceof Int32Array)return\"int32\";if(t instanceof Uint32Array)return\"uint32\";if(t instanceof Float32Array)return\"float\";throw new Error(`Unsupported buffer type ${name}`)}function r(t){const r=t.array;return{name:t.name,buffer:r.buffer,type:e(r),itemCount:t.itemSize,normalized:t.normalized}}t.getBufferElementType=e,t.fromThreeBufferAttribute=r,t.fromThreeInterleavedBufferAttribute=function(t){throw new Error(\"Not implemented yet\")},t.fromThreeBufferGeometry=function(t,e){const n=[],s=Object.getOwnPropertyNames(t.attributes);for(const e of s){const i=r(t.attributes[e]);i.name=e,n.push(i)}const o=null!==t.index?r(t.index):void 0;let a=0;if(void 0!==o)a=null===t.index?0:t.index.count;else{const e=t.attributes.position;if(void 0===e)throw new Error(\"Missing position attibute to deduce item count\");a=e.count}return{type:i.GeometryType.Unspecified,vertexAttributes:n,index:o,groups:[{start:0,count:a,technique:e}]}}}(e.ThreeBufferUtils||(e.ThreeBufferUtils={}))},8770:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},9362:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.WorkerDecoderProtocol=e.RequestController=void 0,e.RequestController=class{constructor(t=0,e=new AbortController){this.priority=t,this.abortController=e}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(t){let e,r;!function(t){t.Configuration=\"configuration\"}(e=t.DecoderMessageName||(t.DecoderMessageName={})),t.isConfigurationMessage=function(t){return t&&\"string\"==typeof t.service&&\"string\"==typeof t.type&&t.type===e.Configuration},function(t){t.DecodeTileRequest=\"decode-tile-request\",t.TileInfoRequest=\"tile-info-request\"}(r=t.Requests||(t.Requests={})),t.isDecodeTileRequest=function(t){return t&&\"string\"==typeof t.type&&t.type===r.DecodeTileRequest},t.isTileInfoRequest=function(t){return t&&\"string\"==typeof t.type&&t.type===r.TileInfoRequest}}(e.WorkerDecoderProtocol||(e.WorkerDecoderProtocol={}))},4835:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.WorkerServiceProtocol=void 0,function(t){let e,r;t.WORKER_SERVICE_MANAGER_SERVICE_ID=\"worker-service-manager\",function(t){t.Initialized=\"initialized\",t.Request=\"request\",t.Response=\"response\"}(e=t.ServiceMessageName||(t.ServiceMessageName={})),t.isInitializedMessage=function(t){return t&&\"string\"==typeof t.service&&\"string\"==typeof t.type&&t.type===e.Initialized},function(t){t.CreateService=\"create-service\",t.DestroyService=\"destroy-service\"}(r=t.Requests||(t.Requests={})),t.isUnknownServiceError=function(t){return t.message.includes(\"unknown targetServiceType requested: \")},t.isRequestMessage=function(t){return t&&\"string\"==typeof t.service&&\"string\"==typeof t.type&&t.type===e.Request},t.isResponseMessage=function(t){return t&&\"string\"==typeof t.service&&\"string\"==typeof t.type&&t.type===e.Response}}(e.WorkerServiceProtocol||(e.WorkerServiceProtocol={}))},9421:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.WorkerTilerProtocol=void 0,function(t){let e;!function(t){t.RegisterIndex=\"register-index\",t.UpdateIndex=\"update-index\",t.TileRequest=\"tile-request\"}(e=t.Requests||(t.Requests={})),t.isRegisterIndexRequest=function(t){return t&&\"string\"==typeof t.type&&t.type===e.RegisterIndex},t.isUpdateIndexRequest=function(t){return t&&\"string\"==typeof t.type&&t.type===e.UpdateIndex},t.isTileRequest=function(t){return t&&\"string\"==typeof t.type&&t.type===e.TileRequest}}(e.WorkerTilerProtocol||(e.WorkerTilerProtocol={}))},6112:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.wrapLineString=e.clipLineString=void 0;const i=r(5448),n=r(6815),s=r(2616),o=r(4342);class a{constructor(t,e,r,n,s){this.isInside=s,this.p0=new i.Vector2(t,e),this.p1=new i.Vector2(r,n)}inside(t){return this.isInside(t)}computeIntersection(t,e){const r=new i.Vector2;return o.Math2D.intersectLines(t.x,t.y,e.x,e.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,r),r}clipLine(t){const e=t,r=[];t=[],r.push(t);const i=e=>{0!==t.length&&t[t.length-1].equals(e)||t.push(e)};for(let n=0;n<e.length;++n){const s=e[n],o=n>0?e[n-1]:void 0;this.inside(s)?(void 0===o||this.inside(o)||(t.length>0&&(t=[],r.push(t)),i(this.computeIntersection(o,s))),i(s)):void 0!==o&&this.inside(o)&&i(this.computeIntersection(o,s))}return 0===r[r.length-1].length&&(r.length=r.length-1),r}clipLines(t){const e=[];return t.forEach((t=>{this.clipLine(t).forEach((t=>{e.push(t)}))})),e}}function u(t,e,r){for(const r of e)t=r.clipLines(t);const i=new n.Vector3,o=[];return t.forEach((t=>{if(0===t.length)return;const e=t.map((({x:t,y:e})=>{i.set(t,e,0);const n=s.webMercatorProjection.unprojectPoint(i);return n.longitude+=r,n}));o.push(e)})),o.length>0?o:void 0}e.clipLineString=function(t,e,r,i,n){const s=new a(e,r,e,n,(t=>t.x>e)),o=new a(e,n,i,n,(t=>t.y<n)),u=new a(i,n,i,r,(t=>t.x<i)),l=new a(i,r,e,r,(t=>t.y>r));let h=s.clipLine(t);return h=o.clipLines(h),h=u.clipLines(h),h=l.clipLines(h),h},e.wrapLineString=function(t){const e=new n.Vector3,r=[t.map((t=>{const{x:r,y:n}=s.webMercatorProjection.projectPoint(t,e);return new i.Vector2(r,n)}))];return{left:u(r,c,360),middle:u(r,h,0),right:u(r,d,-360)}};const l=s.EarthConstants.EQUATORIAL_CIRCUMFERENCE,h=[new a(0,l,0,0,(t=>t.x>0)),new a(l+0,0,l+0,l,(t=>t.x<l+0))],c=[new a(-l-0,l,-l-0,0,(t=>t.x>-l-0)),new a(0,0,0,l,(t=>t.x<0))],d=[new a(l-0,l,l-0,0,(t=>t.x>l-0)),new a(2*l+0,0,2*l+0,l,(t=>t.x<2*l+0))]},2982:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.clipPolygon=e.ClippingEdge=void 0;const i=r(5448);class n{clipPolygon(t,e){const r=t;t=[];const i=e=>{const r=t[t.length-1];(!(null==r?void 0:r.equals(e))||!0===e.isClipped&&!(null==r?void 0:r.isClipped)||!e.isClipped&&!0===(null==r?void 0:r.isClipped))&&t.push(e)};for(let t=0;t<r.length;++t){const n=r[t],s=r[(t+r.length-1)%r.length];if(this.inside(n,e)){if(!this.inside(s,e)){const t=this.computeIntersection(s,n,e);t.isClipped=!0,i(t)}i(n)}else if(this.inside(s,e)){const t=this.computeIntersection(s,n,e);t.isClipped=!0,i(t)}}return t}}e.ClippingEdge=n;const s=[new class extends n{inside(t){return t.y>=0}computeIntersection(t,e){const{x:r,y:n}=t,{x:s,y:o}=e;return new i.Vector2((r*o-n*s)/-(n-o),0).round()}},new class extends n{inside(t,e){return t.x<=e}computeIntersection(t,e,r){const{x:n,y:s}=t,{x:o,y:a}=e;return new i.Vector2(r,(n*a-s*o-(s-a)*-r)/(n-o)).round()}},new class extends n{inside(t,e){return t.y<=e}computeIntersection(t,e,r){const{x:n,y:s}=t,{x:o,y:a}=e;return new i.Vector2((n*a-s*o-(n-o)*r)/-(s-a),r).round()}},new class extends n{inside(t){return t.x>=0}computeIntersection(t,e){const{x:r,y:n}=t,{x:s,y:o}=e;return new i.Vector2(0,(r*o-n*s)/(r-s)).round()}}];e.clipPolygon=function(t,e){if(0===t.length)return t;t[0].equals(t[t.length-1])||(t=[...t,t[0]]);for(const r of s)t=r.clipPolygon(t,e);return t.length<3?[]:t}},6525:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.EdgeLengthGeometrySubdivisionModifier=e.SubdivisionMode=void 0;const i=r(6815),n=r(2616),s=r(4342),o=r(3386),a=[new i.Vector3,new i.Vector3];var u;!function(t){t[t.All=0]=\"All\",t[t.NoDiagonals=1]=\"NoDiagonals\"}(u=e.SubdivisionMode||(e.SubdivisionMode={}));class l extends o.SubdivisionModifier{constructor(t,e,r=u.All,i){super(),this.subdivision=t,this.geoBox=e,this.subdivisionMode=r,this.projection=i,(0,s.assert)(i.type===n.ProjectionType.Planar,\"EdgeLengthGeometrySubdivisionModifier only supports planar projections\");const o=i.projectPoint(e.northEast,a[0]),l=i.projectPoint(e.southWest,a[1]);this.m_projectedBox={min:{x:Math.min(o.x,l.x),y:Math.min(o.y,l.y),z:Math.min(o.z,l.z)},max:{x:Math.max(o.x,l.x),y:Math.max(o.y,l.y),z:Math.max(o.z,l.z)}},this.m_maxLengthX=(this.m_projectedBox.max.x-this.m_projectedBox.min.x)/t,this.m_maxLengthY=(this.m_projectedBox.max.y-this.m_projectedBox.min.y)/t,this.subdivisionMode===u.All&&(this.m_maxLengthX*=1.1,this.m_maxLengthY*=1.1),this.m_maxLength=Math.sqrt(this.m_maxLengthX*this.m_maxLengthX+this.m_maxLengthY*this.m_maxLengthY)}get maxLength(){return this.m_maxLength}get maxLengthX(){return this.m_maxLengthX}get maxLengthY(){return this.m_maxLengthY}shouldSplitTriangle(t,e,r){const i=this.shouldSplitEdge(t,e),n=this.shouldSplitEdge(e,r),s=this.shouldSplitEdge(r,t);if(!(i||n||s))return;const o=t.distanceTo(e),a=e.distanceTo(r),u=r.distanceTo(t),l=Math.max(i?o:0,n?a:0,s?u:0);if(o===l)return 0;if(a===l)return 1;if(u===l)return 2;throw new Error(\"Could not split triangle.\")}shouldSplitEdge(t,e){switch(this.subdivisionMode){case u.All:return t.y===e.y&&Math.abs(t.x-e.x)>this.m_maxLengthX||t.x===e.x&&Math.abs(t.y-e.y)>this.m_maxLengthY||t.distanceTo(e)>this.m_maxLength;case u.NoDiagonals:return t.y===e.y&&Math.abs(t.x-e.x)>this.m_maxLengthX||t.x===e.x&&Math.abs(t.y-e.y)>this.m_maxLengthY}}}e.EdgeLengthGeometrySubdivisionModifier=l},6189:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.SphericalGeometrySubdivisionModifier=void 0;const i=r(6815),n=r(2616),s=r(3386),o=[new i.Vector3,new i.Vector3,new i.Vector3];class a extends s.SubdivisionModifier{constructor(t,e=n.sphereProjection){super(),this.angle=t,this.projection=e}shouldSplitTriangle(t,e,r){const i=n.sphereProjection.reprojectPoint(this.projection,t,o[0]),s=n.sphereProjection.reprojectPoint(this.projection,e,o[1]),a=n.sphereProjection.reprojectPoint(this.projection,r,o[2]),u=i.angleTo(s),l=s.angleTo(a),h=a.angleTo(i),c=Math.max(u,Math.max(l,h));if(!(c<this.angle)){if(c===u)return 0;if(c===l)return 1;if(c===h)return 2;throw new Error(\"failed to split triangle\")}}}e.SphericalGeometrySubdivisionModifier=a},3386:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.SubdivisionModifier=void 0;const i=r(6815),n=new i.Vector3,s=new i.Vector3,o=new i.Vector3;e.SubdivisionModifier=class{constructor(){}modify(t){const e=t.getAttribute(\"position\"),r=Array.from(e.array),i=t.getAttribute(\"uv\"),a=void 0!==i?Array.from(i.array):void 0,u=t.getAttribute(\"edge\"),l=void 0!==u?Array.from(u.array):void 0,h=t.getAttribute(\"wall\"),c=void 0!==h?Array.from(h.array):void 0,d=t.getIndex(),p=Array.from(d.array),f=new Map;function m(t,e){const i=`${Math.min(t,e)}_${Math.max(t,e)}`,u=f.get(i);if(void 0!==u)return u;n.set(r[3*t],r[3*t+1],r[3*t+2]),s.set(r[3*e],r[3*e+1],r[3*e+2]),o.lerpVectors(n,s,.5);const h=r.length/3;return r.push(...o.toArray()),f.set(i,h),void 0!==a&&(n.set(a[2*t],a[2*t+1],0),s.set(a[2*e],a[2*e+1],0),o.lerpVectors(n,s,.5),a.push(o.x,o.y)),void 0!==l&&(l[t]===e?(l.push(e),l[t]=h):l[e]===t?(l.push(t),l[e]=h):l.push(-1)),void 0!==c&&(c[t]===e?(c.push(e),c[t]=h):c[e]===t?(c.push(t),c[e]=h):c.push(-1)),h}const y=[];for(;p.length>=3;){const t=p.shift(),e=p.shift(),i=p.shift();switch(n.set(r[3*t],r[3*t+1],r[3*t+2]),s.set(r[3*e],r[3*e+1],r[3*e+2]),o.set(r[3*i],r[3*i+1],r[3*i+2]),this.shouldSplitTriangle(n,s,o)){case 0:{const r=m(t,e);p.push(t,r,i,r,e,i);break}case 1:{const r=m(e,i);p.push(t,e,r,t,r,i);break}case 2:{const r=m(i,t);p.push(t,e,r,r,e,i);break}case void 0:y.push(t,e,i);break;default:throw new Error(\"failed to subdivide the given geometry\")}}return e.array=e.array instanceof Float32Array?new Float32Array(r):new Float64Array(r),e.count=r.length/e.itemSize,e.needsUpdate=!0,t.setIndex(y),void 0!==a&&(i.array=new Float32Array(a),i.count=a.length/i.itemSize,i.needsUpdate=!0),void 0!==l&&(u.array=new Float32Array(l),u.count=l.length/u.itemSize,u.needsUpdate=!0),t}}},2616:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(3068),e),n(r(5999),e),n(r(6306),e),n(r(4860),e),n(r(8248),e),n(r(9019),e),n(r(6482),e),n(r(7870),e),n(r(5610),e),n(r(1515),e),n(r(9686),e),n(r(5234),e),n(r(9885),e),n(r(7289),e),n(r(6322),e),n(r(9861),e),n(r(435),e),n(r(9447),e),n(r(7171),e),n(r(3424),e),n(r(4948),e),n(r(6541),e),n(r(7841),e),n(r(2801),e),n(r(6557),e),n(r(4490),e),n(r(2224),e),n(r(1635),e),n(r(1871),e),n(r(2953),e),n(r(1383),e),n(r(9264),e),n(r(58),e),n(r(7523),e),n(r(2683),e),n(r(2334),e)},3068:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.GeoBox=void 0;const i=r(3334),n=r(4860);class s{static fromCoordinates(t,e){return new s(t,e)}static fromCenterAndExtents(t,e){return new s(new n.GeoCoordinates(t.latitude-e.latitudeSpan/2,t.longitude-e.longitudeSpan/2),new n.GeoCoordinates(t.latitude+e.latitudeSpan/2,t.longitude+e.longitudeSpan/2))}constructor(t,e){this.southWest=t,this.northEast=e,this.west>this.east&&(this.northEast.longitude+=360)}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const t=.5*(this.south+this.north),{west:e,east:r}=this,{minAltitude:i,altitudeSpan:s}=this;let o;if(void 0!==i&&void 0!==s&&(o=i+.5*s),e<=r)return new n.GeoCoordinates(t,.5*(e+r),o);let a=.5*(360+r+e);return a>360&&(a-=360),new n.GeoCoordinates(t,a,o)}get latitudeSpanInRadians(){return(0,i.degToRad)(this.latitudeSpan)}get longitudeSpanInRadians(){return(0,i.degToRad)(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let t=this.northEast.longitude-this.southWest.longitude;return t<0&&(t+=360),t}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(t){if(void 0===t.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(t);const e=this.minAltitude===this.maxAltitude,r=this.minAltitude===t.altitude,i=this.minAltitude<=t.altitude&&this.maxAltitude>t.altitude;return!!(e?r:i)&&this.containsHelper(t)}clone(){return new s(this.southWest.clone(),this.northEast.clone())}growToContain(t){this.southWest.latitude=Math.min(this.southWest.latitude,t.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,t.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==t.altitude?Math.min(this.southWest.altitude,t.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==t.altitude?t.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,t.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,t.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==t.altitude?Math.max(this.northEast.altitude,t.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==t.altitude?t.altitude:void 0}containsHelper(t){if(t.latitude<this.southWest.latitude||t.latitude>=this.northEast.latitude)return!1;const{west:e,east:r}=this;let i=t.longitude;if(r>n.MAX_LONGITUDE)for(;i<e;)i+=360;if(i>r)for(;i>e+360;)i-=360;return i>=e&&i<r}}e.GeoBox=s},5999:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isGeoBoxExtentLike=void 0,e.isGeoBoxExtentLike=function(t){return t&&\"object\"==typeof t&&\"number\"==typeof t.latitudeSpan&&\"number\"==typeof t.longitudeSpan}},680:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isGeoCoordLike=e.geoCoordLikeToGeoPointLike=e.geoCoordLikeToGeoCoordinatesLike=void 0;const i=r(6306),n=r(8248),s=r(7870);e.geoCoordLikeToGeoCoordinatesLike=function(t){return(0,i.isGeoCoordinatesLike)(t)?t:(0,s.isLatLngLike)(t)?{latitude:t.lat,longitude:t.lng}:{latitude:t[1],longitude:t[0]}},e.geoCoordLikeToGeoPointLike=function(t){return(0,n.isGeoPointLike)(t)?t:(0,s.isLatLngLike)(t)?[t.lng,t.lat]:[t.longitude,t.latitude]},e.isGeoCoordLike=function(t){return(0,i.isGeoCoordinatesLike)(t)||(0,s.isLatLngLike)(t)||!(0,n.isGeoPointLike)(t)}},4860:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.GeoCoordinates=e.MIN_LONGITUDE=e.MAX_LONGITUDE=e.MIN_LATITUDE=e.MAX_LATITUDE=void 0;const i=r(6815),n=r(3334),s=r(6306),o=r(8248),a=r(7870);e.MAX_LATITUDE=90,e.MIN_LATITUDE=-90,e.MAX_LONGITUDE=180,e.MIN_LONGITUDE=-180;const u=new i.Vector3,l=new i.Vector3;class h{static fromDegrees(t,e,r){return new h(t,e,r)}static fromRadians(t,e,r){return new h((0,n.radToDeg)(t),(0,n.radToDeg)(e),r)}static fromLatLng(t){return new h(t.lat,t.lng)}static fromGeoPoint(t){return new h(t[1],t[0],t[2])}static fromObject(t){if((0,o.isGeoPointLike)(t))return h.fromGeoPoint(t);if((0,s.isGeoCoordinatesLike)(t))return h.fromDegrees(t.latitude,t.longitude,t.altitude);if((0,a.isLatLngLike)(t))return h.fromDegrees(t.lat,t.lng);throw new Error(\"Invalid input coordinate format.\")}static lerp(t,e,r,i=!1,n=!1){var s,o;if(i){if(t.lng<e.lng){const i=t.clone();return i.longitude+=360,this.lerp(e,i,1-r)}{const i=e.clone();return i.longitude+=360,this.lerp(t,i,r)}}const a=u.set(t.lat,t.lng,null!==(s=t.altitude)&&void 0!==s?s:0),c=l.set(e.lat,e.lng,null!==(o=e.altitude)&&void 0!==o?o:0);a.lerp(c,r);const d=new h(a.x,a.y,a.z);return n?d.normalized():d}constructor(t,e,r){this.latitude=t,this.longitude=e,this.altitude=r}get latitudeInRadians(){return(0,n.degToRad)(this.latitude)}get longitudeInRadians(){return(0,n.degToRad)(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:t,longitude:e}=this;return isNaN(t)||isNaN(e)?this:((e<-180||e>180)&&(e=function(t){const e=t%360;return e<0==0?e:e+360}(e+180)-180),t=(0,n.clamp)(t,-90,90),new h(t,e,this.altitude))}equals(t){return this.latitude===t.latitude&&this.longitude===t.longitude&&this.altitude===t.altitude}copy(t){return this.latitude=t.latitude,this.longitude=t.longitude,this.altitude=t.altitude,this}clone(){return new h(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}minLongitudeSpanTo(t){const e=Math.min(this.longitude,t.longitude),r=Math.max(this.longitude,t.longitude);return Math.min(r-e,360+e-r)}}e.GeoCoordinates=h},6306:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isGeoCoordinatesLike=void 0,e.isGeoCoordinatesLike=function(t){return t&&\"number\"==typeof t.latitude&&\"number\"==typeof t.longitude&&(\"number\"==typeof t.altitude||void 0===t.altitude)}},8248:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isGeoPointLike=void 0,e.isGeoPointLike=function(t){if(Array.isArray(t)){const[e,r,i]=t;return\"number\"==typeof e&&\"number\"==typeof r&&(void 0===i||\"number\"==typeof i)}return!1}},6482:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.GeoPolygon=e.isAntimeridianCrossing=void 0;const i=r(5448),n=r(3068),s=r(4860),o=r(680);function a(t,e){return Math.max(t,e)-Math.min(t,e)}function u(t,e){return t>0&&e<0&&a(t,e)>180}e.isAntimeridianCrossing=function(t,e){return Math.sign(t)===-Math.sign(e)&&a(t,e)>180},e.GeoPolygon=class{constructor(t,e=!1,r=!1){this.m_coordinates=t.map((t=>(0,o.geoCoordLikeToGeoCoordinatesLike)(t))),e&&this.sortCCW(),r&&this.wrapCoordinatesAround()}get coordinates(){return this.m_coordinates}getGeoBoundingBox(){const t=this.getCentroid();if(void 0===t)return n.GeoBox.fromCoordinates(this.coordinates[0],this.coordinates[0]);const{east:e,west:r}=this.getEastAndWest(t),{north:i,south:o}=this.getNorthAndSouth();return n.GeoBox.fromCoordinates(new s.GeoCoordinates(o,r),new s.GeoCoordinates(i,e))}getCentroid(){const t=this.getArea();if(0===t)return;let e,r=0,i=0,n=this.m_coordinates.length-1;return this.m_coordinates.forEach(((t,s)=>{const o=this.m_coordinates[n];e=t.latitude*o.longitude-o.latitude*t.longitude,r+=(t.latitude+o.latitude)*e,i+=(t.longitude+o.longitude)*e,n=s})),e=6*t,new s.GeoCoordinates(r/e,t<0?i/e-180:i/e)}sortCCW(){const t=this.getPolyAverageCenter();t&&this.m_coordinates.sort(((e,r)=>{const n=new i.Vector2(e.latitude-t.latitude,e.longitude-t.longitude).normalize();return new i.Vector2(r.latitude-t.latitude,r.longitude-t.longitude).normalize().angle()-n.angle()}))}wrapCoordinatesAround(){const t=this.m_coordinates.findIndex(((t,e)=>{const r=0===e?this.m_coordinates.length-1:e-1;return u(this.m_coordinates[r].longitude,t.longitude)}));if(t<0)return;let e=!0;for(let r=0;r<this.m_coordinates.length;r++){const i=(t+r)%this.m_coordinates.length,n=this.m_coordinates[i].longitude,s=this.m_coordinates[(i+1)%this.m_coordinates.length].longitude;e&&(this.m_coordinates[i].longitude+=360),u(s,n)?e=!1:u(n,s)&&(e=!0)}}getPolyAverageCenter(){const t=this.m_coordinates.reduce(((t,e)=>new s.GeoCoordinates(t.latitude+e.latitude,t.longitude+e.longitude)));return new s.GeoCoordinates(t.latitude/this.m_coordinates.length,t.longitude/this.m_coordinates.length)}getArea(){let t=0,e=this.m_coordinates.length-1;return this.m_coordinates.forEach(((r,i)=>{const n=this.m_coordinates[e];t+=r.latitude*n.longitude,t-=r.longitude*n.latitude,e=i})),t/=2}getEastAndWest(t){let e=t.longitude,r=t.longitude,n=this.m_coordinates.length-1;return this.m_coordinates.forEach(((s,o)=>{const a=this.m_coordinates[n];n=o;const u=new i.Vector2(s.latitude-t.latitude,s.longitude-t.longitude).normalize(),l=new i.Vector2(a.latitude-t.latitude,a.longitude-t.longitude).normalize();let h=1===Math.sign(l.angle()-u.angle());l.y>=0&&u.y<0&&(h=!0);const c=s.longitude;c<t.longitude?h?e=Math.min(e,c):r=Math.min(r,c):h?r=Math.max(r,c):e=Math.max(e,c)})),{east:r,west:e}}getNorthAndSouth(){let t=s.MIN_LATITUDE,e=s.MAX_LATITUDE;return this.m_coordinates.forEach(((r,i)=>{t=Math.max(t,r.latitude),e=Math.min(e,r.latitude)})),{north:t,south:e}}}},9019:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isGeoPolygonLike=void 0;const i=r(680);e.isGeoPolygonLike=function(t){if(!t||!Array.isArray(t.coordinates)&&t.coordinates.length>2)return!1;let e=!0;return t.coordinates.forEach((r=>{(0,i.isGeoCoordLike)(t)||(e=!1)})),e}},7870:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isLatLngLike=void 0,e.isLatLngLike=function(t){return t&&\"number\"==typeof t.lat&&\"number\"==typeof t.lng}},9264:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isBox3Like=void 0,e.isBox3Like=function(t){const e=t;return void 0!==e.min&&void 0!==e.max}},7523:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.MathUtils=void 0;const i=r(3334);!function(t){function e(t){return(t%=360)<0&&(t+=360),t}function r(t,r){const i=(t=e(t))-(r=e(r));return i>180?i-360:i<=-180?i+360:i}t.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},t.newVector3=function(t,e,r,i){return void 0===i?{x:t,y:e,z:r}:(i.x=t,i.y=e,i.z=r,i)},t.copyVector3=function(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e},t.degToRad=i.degToRad,t.radToDeg=i.radToDeg,t.clamp=i.clamp,t.normalizeAngleDeg=e,t.normalizeLongitudeDeg=function(t){return(t=e(t))>180&&(t-=360),t},t.angleDistanceDeg=r,t.interpolateAnglesDeg=function(t,e,i){return(t+r(e,t)*i)%360}}(e.MathUtils||(e.MathUtils={}))},2334:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.OrientedBox3=void 0;const i=r(8333),n=r(6815);function s(t,e,r,i,n){const s=r.dot(e),o=r.dot(t);if(Math.abs(o)<1e-20)return Math.abs(s)<=i;const a=1/o,u=(s+i)*a,l=(s-i)*a;return u>l?(l>n.min&&(n.min=l),u<n.max&&(n.max=u)):(u>n.min&&(n.min=u),l<n.max&&(n.max=l)),n.min<=n.max&&n.max>=0}const o=new n.Vector3,a={min:-1/0,max:1/0};class u{constructor(t,e,r){this.position=new n.Vector3,this.xAxis=new n.Vector3(1,0,0),this.yAxis=new n.Vector3(0,1,0),this.zAxis=new n.Vector3(0,0,1),this.extents=new n.Vector3,void 0!==t&&this.position.copy(t),void 0!==e&&e.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==r&&this.extents.copy(r)}clone(){const t=new u;return t.copy(this),t}copy(t){this.position.copy(t.position),this.xAxis.copy(t.xAxis),this.yAxis.copy(t.yAxis),this.zAxis.copy(t.zAxis),this.extents.copy(t.extents)}getCenter(t=new n.Vector3){return t.copy(this.position)}getSize(t=new n.Vector3){return t.copy(this.extents).multiplyScalar(2)}getRotationMatrix(t=new i.Matrix4){return t.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(t){const e=Array.isArray(t)?t:t.planes;for(const t of e){const e=Math.abs(t.normal.dot(this.xAxis)*this.extents.x)+Math.abs(t.normal.dot(this.yAxis)*this.extents.y)+Math.abs(t.normal.dot(this.zAxis)*this.extents.z);if(t.distanceToPoint(this.position)+e<0)return!1}return!0}intersectsRay(t){if(a.min=-1/0,a.max=1/0,o.copy(this.position).sub(t.origin),s(t.direction,o,this.xAxis,this.extents.x,a)&&s(t.direction,o,this.yAxis,this.extents.y,a)&&s(t.direction,o,this.zAxis,this.extents.z,a))return a.min>0?a.min:a.max}contains(t){const e=t.x-this.position.x,r=t.y-this.position.y,i=t.z-this.position.z,n=Math.abs(e*this.xAxis.x+r*this.xAxis.y+i*this.xAxis.z),s=Math.abs(e*this.yAxis.x+r*this.yAxis.y+i*this.yAxis.z),o=Math.abs(e*this.zAxis.x+r*this.zAxis.y+i*this.zAxis.z);return!(n>this.extents.x||s>this.extents.y||o>this.extents.z)}distanceToPoint(t){return Math.sqrt(this.distanceToPointSquared(t))}distanceToPointSquared(t){const e=new n.Vector3;e.subVectors(t,this.position);const r=[e.dot(this.xAxis),e.dot(this.yAxis),e.dot(this.zAxis)];let i=0;for(let t=0;t<3;++t){const e=r[t],n=this.extents.getComponent(t);if(e<-n){const t=n+e;i+=t*t}else if(e>n){const t=e-n;i+=t*t}}return i}}e.OrientedBox3=u},58:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isOrientedBox3Like=void 0,e.isOrientedBox3Like=function(t){const e=t;return void 0!==e.position&&void 0!==e.xAxis&&void 0!==e.yAxis&&void 0!==e.zAxis&&void 0!==e.extents}},2683:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isTransformLike=void 0,e.isTransformLike=function(t){const e=t;return void 0!==e.position&&void 0!==e.xAxis&&void 0!==e.yAxis&&void 0!==e.zAxis}},2953:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isVector2Like=void 0,e.isVector2Like=function(t){return t&&\"number\"==typeof t.x&&\"number\"==typeof t.y}},1383:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isVector3Like=void 0,e.isVector3Like=function(t){return t&&\"number\"==typeof t.x&&\"number\"==typeof t.y&&\"number\"==typeof t.z}},5610:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.EarthConstants=void 0;class r{}e.EarthConstants=r,r.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,r.EQUATORIAL_RADIUS=6378137,r.MIN_ELEVATION=-433,r.MAX_ELEVATION=8848,r.MAX_BUILDING_HEIGHT=828},1515:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.equirectangularProjection=e.normalizedEquirectangularProjection=void 0;const i=r(3334),n=r(2754),s=r(3068),o=r(4860),a=r(9264),u=r(7523),l=r(58),h=r(5610),c=r(5234);class d extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}getScaleFactor(t){return 1}worldExtent(t,e,r){return r||(r=new n.Box3),r.min.x=0,r.min.y=0,r.min.z=t,r.max.x=this.unitScale,r.max.y=this.unitScale/2,r.max.z=e,r}projectPoint(t,e){var r;return void 0===e&&(e={x:0,y:0,z:0}),e.x=((0,i.degToRad)(t.longitude)+Math.PI)*d.geoToWorldScale*this.unitScale,e.y=((0,i.degToRad)(t.latitude)+.5*Math.PI)*d.geoToWorldScale*this.unitScale,e.z=null!==(r=t.altitude)&&void 0!==r?r:0,e}unprojectPoint(t){return o.GeoCoordinates.fromRadians(t.y*d.worldToGeoScale/this.unitScale-.5*Math.PI,t.x*d.worldToGeoScale/this.unitScale-Math.PI,t.z)}unprojectAltitude(t){return t.z}projectBox(t,e){const r=this.projectPoint(new o.GeoCoordinates(t.center.latitude,t.center.longitude,0)),{latitudeSpanInRadians:i,longitudeSpanInRadians:s,altitudeSpan:h}=t,c=s*d.geoToWorldScale,p=i*d.geoToWorldScale;return e||(e=new n.Box3),(0,a.isBox3Like)(e)?(e.min.x=r.x-.5*c*this.unitScale,e.min.y=r.y-.5*p*this.unitScale,e.max.x=r.x+.5*c*this.unitScale,e.max.y=r.y+.5*p*this.unitScale,void 0!==h?(e.min.z=r.z-.5*h,e.max.z=r.z+.5*h):(e.min.z=0,e.max.z=0)):(0,l.isOrientedBox3Like)(e)&&(u.MathUtils.newVector3(1,0,0,e.xAxis),u.MathUtils.newVector3(0,1,0,e.yAxis),u.MathUtils.newVector3(0,0,1,e.zAxis),e.position.x=r.x,e.position.y=r.y,e.position.z=r.z,e.extents.x=.5*c*this.unitScale,e.extents.y=.5*p*this.unitScale,e.extents.z=Math.max(Number.EPSILON,.5*(null!=h?h:0))),e}unprojectBox(t){const e=this.unprojectPoint(t.min),r=this.unprojectPoint(t.max);return s.GeoBox.fromCoordinates(e,r)}groundDistance(t){return t.z}scalePointToSurface(t){return t.z=0,t}surfaceNormal(t,e){return void 0===e?e={x:0,y:0,z:1}:(e.x=0,e.y=0,e.z=1),e}}d.geoToWorldScale=1/(2*Math.PI),d.worldToGeoScale=2*Math.PI/1,e.normalizedEquirectangularProjection=new d(1),e.equirectangularProjection=new d(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},9686:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.identityProjection=void 0;const i=r(2754),n=r(3334),s=r(3068),o=r(4860),a=r(9264),u=r(7523),l=r(58),h=r(5234);class c extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Planar}getScaleFactor(t){return 1}worldExtent(t,e,r){return r||(r=new i.Box3),r.min.x=-Math.PI,r.min.y=.5*-Math.PI,r.min.z=t,r.max.x=Math.PI,r.max.y=.5*Math.PI,r.max.z=e,r}projectPoint(t,e){var r;return e||(e={x:0,y:0,z:0}),e.x=(0,n.degToRad)(t.longitude),e.y=(0,n.degToRad)(t.latitude),e.z=null!==(r=t.altitude)&&void 0!==r?r:0,e}unprojectPoint(t){return o.GeoCoordinates.fromRadians(t.y,t.x,t.z)}unprojectAltitude(t){return t.z}projectBox(t,e){e||(e=new i.Box3);const r=this.projectPoint(new o.GeoCoordinates(t.south,t.west,t.minAltitude)),n=this.projectPoint(new o.GeoCoordinates(t.north,t.east,t.maxAltitude));return(0,a.isBox3Like)(e)?(e.min.x=r.x,e.min.y=r.y,e.min.z=r.z,e.max.x=n.x,e.max.y=n.y,e.max.z=n.z):(0,l.isOrientedBox3Like)(e)&&(u.MathUtils.newVector3(1,0,0,e.xAxis),u.MathUtils.newVector3(0,1,0,e.yAxis),u.MathUtils.newVector3(0,0,1,e.zAxis),e.position.x=.5*(r.x+n.x),e.position.y=.5*(r.y+n.y),e.position.z=.5*(r.z+n.z),e.extents.x=.5*(n.x-r.x),e.extents.y=.5*(n.y-r.y),e.extents.z=Math.max(Number.EPSILON,.5*(n.z-r.z))),e}unprojectBox(t){const e=this.unprojectPoint(t.min),r=this.unprojectPoint(t.max);return s.GeoBox.fromCoordinates(e,r)}groundDistance(t){return t.z}scalePointToSurface(t){return t.z=0,t}surfaceNormal(t,e){return void 0===e?e={x:0,y:0,z:1}:(e.x=0,e.y=0,e.z=1),e}}e.identityProjection=new c(1)},9885:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.webMercatorProjection=e.mercatorProjection=e.MercatorConstants=void 0;const i=r(2754),n=r(3068),s=r(4860),o=r(6306),a=r(9264),u=r(7523),l=r(58),h=r(5610),c=r(5234);class d extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}static clamp(t,e,r){return Math.min(Math.max(e,t),r)}static latitudeClamp(t){return d.clamp(t,-p.MAXIMUM_LATITUDE,p.MAXIMUM_LATITUDE)}static latitudeProject(t){return Math.log(Math.tan(.25*Math.PI+.5*t))/Math.PI}static latitudeClampProject(t){return d.latitudeProject(d.latitudeClamp(t))}static unprojectLatitude(t){return 2*Math.atan(Math.exp(Math.PI*t))-.5*Math.PI}getScaleFactor(t){return Math.cosh(2*Math.PI*(t.y/this.unitScale-.5))}worldExtent(t,e,r){return r||(r=new i.Box3),r.min.x=0,r.min.y=0,r.min.z=t,r.max.x=this.unitScale,r.max.y=this.unitScale,r.max.z=e,r}projectPoint(t,e){var r;let i;return i=t instanceof s.GeoCoordinates?t:new s.GeoCoordinates(t.latitude,t.longitude,t.altitude),e||(e={x:0,y:0,z:0}),e.x=(i.longitude+180)/360*this.unitScale,e.y=(.5*d.latitudeClampProject(i.latitudeInRadians)+.5)*this.unitScale,e.z=null!==(r=i.altitude)&&void 0!==r?r:0,e}unprojectPoint(t){return s.GeoCoordinates.fromRadians(d.unprojectLatitude(2*(t.y/this.unitScale-.5)),t.x/this.unitScale*2*Math.PI-Math.PI,t.z)}unprojectAltitude(t){return t.z}projectBox(t,e){var r;const n=this.projectPoint(t.center),s=(.5*d.latitudeClampProject(t.northEast.latitudeInRadians)+.5)*this.unitScale,o=(.5*d.latitudeClampProject(t.southWest.latitudeInRadians)+.5)*this.unitScale,h=.5*(s+o);n.y=h;const c=s-o,p=t.longitudeSpan/360*this.unitScale;if(e||(e=new i.Box3),(0,a.isBox3Like)(e)){e.min.x=n.x-.5*p,e.min.y=n.y-.5*c,e.max.x=n.x+.5*p,e.max.y=n.y+.5*c;const r=t.altitudeSpan;void 0!==r?(e.min.z=n.z-.5*r,e.max.z=n.z+.5*r):(e.min.z=0,e.max.z=0)}else{if(!(0,l.isOrientedBox3Like)(e))throw new Error(\"invalid bounding box\");u.MathUtils.newVector3(1,0,0,e.xAxis),u.MathUtils.newVector3(0,1,0,e.yAxis),u.MathUtils.newVector3(0,0,1,e.zAxis),e.position.x=n.x,e.position.y=n.y,e.position.z=n.z,e.extents.x=.5*p,e.extents.y=.5*c,e.extents.z=Math.max(Number.EPSILON,.5*(null!==(r=t.altitudeSpan)&&void 0!==r?r:0))}return e}unprojectBox(t){const e=this.unprojectPoint(t.min),r=this.unprojectPoint(t.max);return n.GeoBox.fromCoordinates(e,r)}groundDistance(t){return t.z}scalePointToSurface(t){return t.z=0,t}surfaceNormal(t,e){return void 0===e?e={x:0,y:0,z:1}:(e.x=0,e.y=0,e.z=1),e}reprojectPoint(t,r,i){return t===this||t!==e.webMercatorProjection&&t!==e.mercatorProjection?super.reprojectPoint(t,r,i):(void 0===i&&(i={}),i.x=r.x,i.y=this.unitScale-r.y,i.z=r.z,i)}}class p{}e.MercatorConstants=p,p.MAXIMUM_LATITUDE=1.4844222297453322,e.mercatorProjection=new d(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE),e.webMercatorProjection=new class extends d{projectPoint(t,e){var r;let i;i=t instanceof s.GeoCoordinates?t:new s.GeoCoordinates(t.latitude,t.longitude,t.altitude),e||(e={x:0,y:0,z:0}),e.x=(i.longitude+180)/360*this.unitScale;const n=Math.sin(d.latitudeClamp(i.latitudeInRadians));return e.y=(.5-Math.log((1+n)/(1-n))/(4*Math.PI))*this.unitScale,e.z=null!==(r=i.altitude)&&void 0!==r?r:0,e}unprojectPoint(t){const e=t.x/this.unitScale-.5,r=.5-t.y/this.unitScale,i=360*e,n=90-360*Math.atan(Math.exp(2*-r*Math.PI))/Math.PI;return new s.GeoCoordinates(n,i,t.z)}projectBox(t,e){const r=super.projectBox(t,e);if((0,a.isBox3Like)(r)){const t=r.max.y;r.max.y=this.unitScale-r.min.y,r.min.y=this.unitScale-t}else(0,l.isOrientedBox3Like)(r)&&(u.MathUtils.newVector3(1,0,0,r.xAxis),u.MathUtils.newVector3(0,-1,0,r.yAxis),u.MathUtils.newVector3(0,0,-1,r.zAxis),r.position.y=this.unitScale-r.position.y);return r}unprojectBox(t){const e=this.unprojectPoint(t.min),r=this.unprojectPoint(t.max);return new n.GeoBox(new s.GeoCoordinates(r.latitude,e.longitude,e.altitude),new s.GeoCoordinates(e.latitude,r.longitude,r.altitude))}surfaceNormal(t,e){return void 0===e?e={x:0,y:0,z:-1}:(e.x=0,e.y=0,e.z=-1),e}localTangentSpace(t,e){return(0,o.isGeoCoordinatesLike)(t)?this.projectPoint(t,e.position):u.MathUtils.copyVector3(t,e.position),u.MathUtils.newVector3(1,0,0,e.xAxis),u.MathUtils.newVector3(0,-1,0,e.yAxis),u.MathUtils.newVector3(0,0,-1,e.zAxis),e}}(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},5234:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.Projection=e.ProjectionType=void 0;const i=r(6306),n=r(7523);var s;(s=e.ProjectionType||(e.ProjectionType={}))[s.Planar=0]=\"Planar\",s[s.Spherical=1]=\"Spherical\",e.Projection=class{constructor(t){this.unitScale=t}localTangentSpace(t,e){return(0,i.isGeoCoordinatesLike)(t)?this.projectPoint(t,e.position):n.MathUtils.copyVector3(t,e.position),n.MathUtils.newVector3(1,0,0,e.xAxis),n.MathUtils.newVector3(0,1,0,e.yAxis),n.MathUtils.newVector3(0,0,1,e.zAxis),e}reprojectPoint(t,e,r){return t===this?void 0===r?{x:e.x,y:e.y,z:e.z}:(r.x=e.x,r.y=e.y,r.z=e.z,r):this.projectPoint(t.unprojectPoint(e),r)}}},6322:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.sphereProjection=void 0;const i=r(2754),n=r(3334),s=r(4860),o=r(6306),a=r(9264),u=r(7523),l=r(58),h=r(5610),c=r(9885),d=r(5234);function p(t){const e=1/Math.PI,r=Math.floor(2*(t*e+1));return(0,n.clamp)(r,0,4)}function f(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}function m(t,e,r){var i;const s=.5*(r+(null!==(i=t.maxAltitude)&&void 0!==i?i:0)),o=(0,n.degToRad)(t.west),a=(0,n.degToRad)(t.east),u=p(o),l=p(a);let h=Math.cos(o),c=h,d=Math.sin(o),f=d;for(let t=u+1;t<=l;t++){const e=(t+1&1)*((2&t)-1);h=Math.min(e,h),c=Math.max(e,c);const r=(1&t)*((2&t)-1);d=Math.min(r,d),f=Math.max(r,f)}const m=Math.cos(a);h=Math.min(m,h),c=Math.max(m,c);const y=Math.sin(a);d=Math.min(y,d),f=Math.max(y,f);const g=(c+h)*s,x=(c-h)*s,v=(f+d)*s,b=(f-d)*s,w=(0,n.degToRad)(t.south),_=(0,n.degToRad)(t.north),M=Math.sin(_),E=Math.sin(w),T=(M+E)*s,S=(M-E)*s;return e.min.x=g-x,e.min.y=v-b,e.min.z=T-S,e.max.x=g+x,e.max.y=v+b,e.max.z=T+S,e}class y extends d.Projection{constructor(){super(...arguments),this.type=d.ProjectionType.Spherical}worldExtent(t,e,r=new i.Box3){const n=this.unitScale+e;return r.min.x=-n,r.min.y=-n,r.min.z=-n,r.max.x=n,r.max.y=n,r.max.z=n,r}projectPoint(t,e=u.MathUtils.newVector3(0,0,0)){return function(t,e,r){var i;const s=r+(null!==(i=t.altitude)&&void 0!==i?i:0),o=(0,n.degToRad)(t.latitude),a=(0,n.degToRad)(t.longitude),u=Math.cos(o);return e.x=s*u*Math.cos(a),e.y=s*u*Math.sin(a),e.z=s*Math.sin(o),e}(t,e,this.unitScale)}unprojectPoint(t){const e=t.x*t.x+t.y*t.y,r=Math.sqrt(e),i=t.z/r;if(isNaN(i))return s.GeoCoordinates.fromRadians(0,0,-this.unitScale);const n=Math.sqrt(e+t.z*t.z);return s.GeoCoordinates.fromRadians(Math.atan(i),Math.atan2(t.y,t.x),n-this.unitScale)}unprojectAltitude(t){const e=t.x*t.x+t.y*t.y+t.z*t.z;return Math.sqrt(e)-h.EarthConstants.EQUATORIAL_RADIUS}projectBox(t,e=new i.Box3){var r,s;if((0,a.isBox3Like)(e))return m(t,e,this.unitScale);if((0,l.isOrientedBox3Like)(e)){if(t.longitudeSpan>=90){const r=m(t,new i.Box3,this.unitScale);return u.MathUtils.newVector3(1,0,0,e.xAxis),u.MathUtils.newVector3(0,1,0,e.yAxis),u.MathUtils.newVector3(0,0,1,e.zAxis),e.position.x=.5*(r.max.x+r.min.x),e.position.y=.5*(r.max.y+r.min.y),e.position.z=.5*(r.max.z+r.min.z),e.extents.x=.5*(r.max.x-r.min.x),e.extents.y=.5*(r.max.y-r.min.y),e.extents.z=.5*(r.max.z-r.min.z),e}const{south:o,west:a,north:l,east:h,center:c}=t,d=c.longitude,p=c.latitude,f=Math.cos((0,n.degToRad)(o)),y=Math.sin((0,n.degToRad)(o)),g=Math.cos((0,n.degToRad)(a)),x=Math.sin((0,n.degToRad)(a)),v=Math.cos((0,n.degToRad)(l)),b=Math.sin((0,n.degToRad)(l)),w=Math.cos((0,n.degToRad)(h)),_=Math.sin((0,n.degToRad)(h)),M=Math.cos((0,n.degToRad)(d)),E=Math.sin((0,n.degToRad)(d)),T=Math.cos((0,n.degToRad)(p)),S=Math.sin((0,n.degToRad)(p));let A,z,P;u.MathUtils.newVector3(M*T,E*T,S,e.zAxis),u.MathUtils.newVector3(-E,M,0,e.xAxis),u.MathUtils.newVector3(-M*S,-E*S,T,e.yAxis),o>=0?(A=Math.abs(f*(M*(x-_)+E*(w-g))),z=T*y-S*f,P=T*b-S*v*(M*w+E*_)):(l<=0?(A=Math.abs(v*(M*(x-_)+E*(w-g))),P=T*b-S*v):(A=Math.abs(M*(x-_)+E*(w-g)),P=T*b-S*v*(E*_+M*w)),z=T*y-S*f*(M*w+E*_));const L=.5*(this.unitScale+(null!==(r=t.maxAltitude)&&void 0!==r?r:0)),O=.5*(this.unitScale+(null!==(s=t.minAltitude)&&void 0!==s?s:0)),C=T*(M*w+E*_),k=Math.min(v*C+b*S,f*C+y*S);return u.MathUtils.newVector3(A*L,(P-z)*L,L-k*O,e.extents),u.MathUtils.newVector3(0,(z+P)*L,L+L,e.position),function(t,e,r,i){const n=t.x*i.x+e.x*i.y+r.x*i.z,s=t.y*i.x+e.y*i.y+r.y*i.z,o=t.z*i.x+e.z*i.y+r.z*i.z;i.x=n,i.y=s,i.z=o}(e.xAxis,e.yAxis,e.zAxis,e.position),e.position.x=e.position.x-e.zAxis.x*e.extents.z,e.position.y=e.position.y-e.zAxis.y*e.extents.z,e.position.z=e.position.z-e.zAxis.z*e.extents.z,e}throw new Error(\"Invalid bounding box\")}unprojectBox(t){throw new Error(\"Method not implemented.\")}getScaleFactor(t){return 1}groundDistance(t){return f(t)-this.unitScale}scalePointToSurface(t){const e=this.unitScale/(f(t)||1);return t.x*=e,t.y*=e,t.z*=e,t}surfaceNormal(t,e){void 0===e&&(e={x:0,y:0,z:0});const r=1/(f(t)||1);return e.x=t.x*r,e.y=t.y*r,e.z=t.z*r,e}reprojectPoint(t,e,r){if(t===c.mercatorProjection||t===c.webMercatorProjection){const{x:i,y:n,z:s}=e,o=this.unitScale,a=i/o-Math.PI,u=n/o-Math.PI,l=Math.exp(u),h=l*l,d=2*l/(h+1),p=(h-1)/(h+1),f=o+s;return void 0===r&&(r={}),r.x=Math.cos(a)*d*f,r.y=Math.sin(a)*d*f,r.z=p*f,t===c.webMercatorProjection&&(r.z=-r.z),r}return super.reprojectPoint(t,e,r)}localTangentSpace(t,e){let r;(0,o.isGeoCoordinatesLike)(t)?(this.projectPoint(t,e.position),r=t):(u.MathUtils.copyVector3(t,e.position),r=this.unprojectPoint(t));const i=(0,n.degToRad)(r.latitude),s=(0,n.degToRad)(r.longitude),a=Math.cos(s),l=Math.sin(s),h=Math.cos(i),c=Math.sin(i);return u.MathUtils.newVector3(a*h,l*h,c,e.zAxis),u.MathUtils.newVector3(-l,a,0,e.xAxis),u.MathUtils.newVector3(-a*c,-l*c,h,e.yAxis),e}}e.sphereProjection=new y(h.EarthConstants.EQUATORIAL_RADIUS)},7289:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.transverseMercatorProjection=e.TransverseMercatorUtils=void 0;const i=r(2754),n=r(3334),s=r(3068),o=r(4860),a=r(9264),u=r(7523),l=r(58),h=r(5610),c=r(5234);class d extends c.Projection{static clampGeoPoint(t,e){const r=t.latitude,i=t.longitude,n=p.POLE_RADIUS,s=p.POLE_RADIUS_SQ,a=Math.round(i/90),u=90*a-i;if(a%2==0||Math.abs(u)>n)return t;const l=r-0,h=u*u+l*l;if(h<s){const t=Math.sqrt(h),e=(n-t)/t,s=0===u&&0===l?1*n:u;return new o.GeoCoordinates(r+l*e,i+s*e)}return t}constructor(t){super(t),this.unitScale=t,this.type=c.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}getScaleFactor(t){return Math.cosh(2*(t.x/this.unitScale-.5)*Math.PI)}worldExtent(t,e,r){return r||(r=new i.Box3),r.min.x=0,r.min.y=0,r.min.z=t,r.max.x=this.unitScale,r.max.y=this.unitScale,r.max.z=e,r}projectPoint(t,e){var r;e||(e={x:0,y:0,z:0});const i=d.clampGeoPoint(t,this.unitScale),s=i.longitude/360+.5,o=1===s?0:Math.floor(s),a=(0,n.degToRad)(i.latitude),u=(0,n.degToRad)(i.longitude-360*o)-this.m_lambda0,l=Math.cos(a)*Math.sin(u);e.x=Math.atanh(l),e.y=Math.atan2(Math.tan(a),Math.cos(u))-this.m_phi0;const h=.5/Math.PI;return e.x=this.unitScale*((0,n.clamp)(e.x*h+.5,0,1)+o),e.y=this.unitScale*(0,n.clamp)(e.y*h+.5,0,1),e.z=null!==(r=t.altitude)&&void 0!==r?r:0,e}unprojectPoint(t){const e=2*Math.PI,r=t.x/this.unitScale,i=t.y/this.unitScale,n=1===r?0:Math.floor(r),s=e*(r-.5-n),a=e*(i-.5),u=t.z||0,l=a+this.m_phi0,h=Math.asin(Math.sin(l)/Math.cosh(s)),c=this.m_lambda0+Math.atan2(Math.sinh(s),Math.cos(l))+n*e;return o.GeoCoordinates.fromRadians(h,c,u)}projectBox(t,e){const{north:r,south:n,east:s,west:h}=t,c=[t.center,t.northEast,t.southWest,new o.GeoCoordinates(n,s),new o.GeoCoordinates(r,h)],d=p.POLE_EDGE_DEG,f=h<90&&s>90,m=h<0&&s>0,y=h<d&&s>-d&&r>0&&n<0;h<-90&&s>-90&&(c.push(new o.GeoCoordinates(r,-90)),c.push(new o.GeoCoordinates(n,-90))),f&&(c.push(new o.GeoCoordinates(r,90)),c.push(new o.GeoCoordinates(n,90))),m&&(c.push(new o.GeoCoordinates(r,0)),c.push(new o.GeoCoordinates(n,0))),y&&(c.push(new o.GeoCoordinates(0,h)),c.push(new o.GeoCoordinates(0,s))),p.alignLatitude(c,c[0]);const g=c.map((t=>this.projectPoint(t))),x=g.map((t=>t.x)),v=g.map((t=>t.y)),b=g.map((t=>t.z)),w=Math.min(...x),_=Math.min(...v),M=Math.min(...b),E=Math.max(...x),T=Math.max(...v),S=Math.max(...b);if(e||(e=new i.Box3),(0,a.isBox3Like)(e))e.min.x=w,e.min.y=_,e.min.z=M,e.max.x=E,e.max.y=T,e.max.z=S;else{if(!(0,l.isOrientedBox3Like)(e))throw new Error(\"invalid bounding box\");u.MathUtils.newVector3(1,0,0,e.xAxis),u.MathUtils.newVector3(0,1,0,e.yAxis),u.MathUtils.newVector3(0,0,1,e.zAxis),e.position.x=(w+E)/2,e.position.y=(_+T)/2,e.position.z=(M+S)/2,e.extents.x=(E-w)/2,e.extents.y=(T-_)/2,e.extents.z=(S-M)/2}return e}unprojectBox(t){const e=this.unitScale,r=t.min,i=t.max,n=[{x:(r.x+i.x)/2,y:(r.y+i.y)/2,z:0},r,i,{x:r.x,y:i.y,z:0},{x:i.x,y:r.y,z:0}],a=.5*e,u=.25*e,l=.75*e,h=r.x<a&&i.x>a,c=r.y<a&&i.y>a,d=r.y<u&&i.y>u,f=r.y<l&&i.y>l;c&&(n.push({x:r.x,y:a,z:0}),n.push({x:i.x,y:a,z:0}),h&&n.push({x:a,y:a,z:0})),d&&(n.push({x:r.x,y:u,z:0}),n.push({x:i.x,y:u,z:0}),h&&n.push({x:a,y:u,z:0})),f&&(n.push({x:r.x,y:l,z:0}),n.push({x:i.x,y:l,z:0}),h&&n.push({x:a,y:l,z:0}));const m=n.map((t=>this.unprojectPoint(t)));p.alignLongitude(m,m[0]);const y=m.map((t=>t.latitude)),g=m.filter((t=>Math.abs(t.latitude)<90)).map((t=>t.longitude)),x=m.map((t=>{var e;return null!==(e=t.altitude)&&void 0!==e?e:0})),v=new o.GeoCoordinates(Math.min(...y),Math.min(...g),Math.min(...x)),b=new o.GeoCoordinates(Math.max(...y),Math.max(...g),Math.max(...x));return s.GeoBox.fromCoordinates(v,b)}unprojectAltitude(t){return t.z}groundDistance(t){return t.z}scalePointToSurface(t){return t.z=0,t}surfaceNormal(t,e){return void 0===e?e={x:0,y:0,z:-1}:(e.x=0,e.y=0,e.z=-1),e}}class p{static alignLatitude(t,e){for(const r of t)0===r.latitude&&(r.latitude=1e-9*e.latitude)}static alignLongitude(t,e){const r=e.longitude<0?180:-180,i=e.longitude<0?-180:180;for(const e of t)e.longitude===r&&(e.longitude=i)}}e.TransverseMercatorUtils=p,p.POLE_EDGE=1.4844222297453322,p.POLE_EDGE_DEG=(0,n.radToDeg)(p.POLE_EDGE),p.POLE_RADIUS=90-p.POLE_EDGE_DEG,p.POLE_RADIUS_SQ=Math.pow(p.POLE_RADIUS,2),e.transverseMercatorProjection=new d(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},9861:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.FlatTileBoundingBoxGenerator=void 0;const i=r(2754);e.FlatTileBoundingBoxGenerator=class{constructor(t,e=0,r=0){this.tilingScheme=t,this.minElevation=e,this.maxElevation=r,this.m_tilingScheme=t,this.m_worldBox=t.projection.worldExtent(e,r);const{min:i,max:n}=this.m_worldBox;this.m_worldDimensions={x:n.x-i.x,y:n.y-i.y,z:n.z-i.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(t,e){const r=t.level,n=this.subdivisionScheme.getLevelDimensionX(r),s=this.subdivisionScheme.getLevelDimensionY(r),o=this.m_worldDimensions.x/n,a=this.m_worldDimensions.y/s,u=this.m_worldBox.min.x+o*t.column,l=this.m_worldBox.min.y+a*t.row;return e||(e=new i.Box3),e.min.x=u,e.min.y=l,e.min.z=this.m_worldBox.min.z,e.max.x=u+o,e.max.y=l+a,e.max.z=this.m_worldBox.max.z,e}getGeoBox(t){const e=this.getWorldBox(t);return this.projection.unprojectBox(e)}}},435:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.halfQuadTreeSubdivisionScheme=void 0,e.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(t){return 0===t?1:2}getLevelDimensionX(t){return 1<<t}getLevelDimensionY(t){return 0!==t?1<<t-1:1}}},4490:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.hereTilingScheme=void 0;const i=r(1515),n=r(435),s=r(6557);e.hereTilingScheme=new s.TilingScheme(n.halfQuadTreeSubdivisionScheme,i.normalizedEquirectangularProjection)},1635:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.mercatorTilingScheme=void 0;const i=r(9885),n=r(9447),s=r(6557);e.mercatorTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,i.mercatorProjection)},1871:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.polarTilingScheme=void 0;const i=r(7289),n=r(9447),s=r(6557);e.polarTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,i.transverseMercatorProjection)},7171:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.QuadTree=void 0;const i=r(6541);e.QuadTree=class{constructor(t){this.tilingScheme=t}visit(t){this.visitTileKey(i.TileKey.fromRowColumnLevel(0,0,0),t)}visitTileKey(t,e){if(e(t,this.tilingScheme.getGeoBox(t)))for(const r of this.tilingScheme.getSubTileKeys(t))this.visitTileKey(r,e)}}},9447:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.quadTreeSubdivisionScheme=void 0,e.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(t){return 1<<t}getLevelDimensionY(t){return 1<<t}}},3424:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.SubTiles=void 0;const i=r(6541);class n{constructor(t,e,r){this.tileKey=t,this.sizeX=e,this.sizeY=r}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?n.ZCurveIterator(this.tileKey):n.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}e.SubTiles=n,function(t){t.RowColumnIterator=function*(t,e,r){for(let n=0;n<r;n++)for(let s=0;s<e;s++)yield i.TileKey.fromRowColumnLevel(t.row*r+n,t.column*e+s,t.level+1)},t.ZCurveIterator=function*(t){for(let e=0;e<4;e++)yield i.TileKey.fromRowColumnLevel(t.row<<1|e>>1,t.column<<1|1&e,t.level+1)}}(n=e.SubTiles||(e.SubTiles={}))},4948:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},6541:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.TileKey=void 0;const r=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class i{static fromRowColumnLevel(t,e,r){return new i(t,e,r)}static fromQuadKey(t){const e=t.length;let r=0,n=0;for(let i=0;i<t.length;++i){const s=1<<i,o=parseInt(t.charAt(e-i-1),10);1&o&&(n|=s),2&o&&(r|=s)}return i.fromRowColumnLevel(r,n,e)}static fromMortonCode(t){let e=0,r=0,n=0,s=t;for(;s>1;){const t=1<<e;1&s&&(n|=t),2&s&&(r|=t),e++,s=(s-(3&s))/4}const o=i.fromRowColumnLevel(r,n,e);return o.m_mortonCode=t,o}static fromHereTile(t){const e=i.fromMortonCode(parseInt(t,10));return e.m_hereTile=t,e}static columnsAtLevel(t){return Math.pow(2,t)}static rowsAtLevel(t){return Math.pow(2,t)}static atCoords(t,e,r,n,s){return i.fromRowColumnLevel(Math.floor(r/(s/i.rowsAtLevel(t))),Math.floor(e/(n/i.columnsAtLevel(t))),t)}static parentMortonCode(t){return Math.floor(t/4)}constructor(t,e,r){this.row=t,this.column=e,this.level=r}parent(){if(0===this.level)throw new Error(\"Cannot get the parent of the root tile key\");return i.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(t){const e=Math.max(0,this.level+t);let r=this.row,n=this.column;return t>=0?(r<<=t,n<<=t):(r>>>=-t,n>>>=-t),i.fromRowColumnLevel(r,n,e)}changedLevelTo(t){return this.changedLevelBy(t-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let t=this.column,e=this.row,i=r[this.level<<1];for(let n=0;n<this.level;++n)1&t&&(i+=r[2*n]),1&e&&(i+=r[2*n+1]),t>>>=1,e>>>=1;this.m_mortonCode=i}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let t=\"\";for(let e=this.level;e>0;--e){const r=1<<e-1,i=!!(this.column&r),n=!!(this.row&r);t+=i&&n?\"3\":n?\"2\":i?\"1\":\"0\"}return t}equals(t){return this.row===t.row&&this.column===t.column&&this.level===t.level}addedSubKey(t){const e=i.fromQuadKey(0===t.length?\"-\":t),r=this.changedLevelBy(e.level);return i.fromRowColumnLevel(r.row+e.row,r.column+e.column,r.level)}addedSubHereTile(t){const e=i.fromHereTile(t),r=this.changedLevelBy(e.level);return i.fromRowColumnLevel(r.row+e.row,r.column+e.column,r.level)}getSubHereTile(t){const e=1<<2*t;return(this.mortonCode()&e-1|e).toString()}rowCount(){return i.rowsAtLevel(this.level)}columnCount(){return i.columnsAtLevel(this.level)}}e.TileKey=i},7841:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.TileKeyUtils=e.powerOfTwo=void 0;const i=r(4860),n=r(6541);e.powerOfTwo=(()=>{let t=.5;return new Array(53).fill(0).map((()=>t*=2))})(),function(t){function r(t,e,r){const i=t.projection,s=t.subdivisionScheme,o=s.getLevelDimensionX(r),a=s.getLevelDimensionY(r),{min:u,max:l}=i.worldExtent(0,0),h=l.x-u.x,c=l.y-u.y;if(e.x<u.x||e.x>l.x)return null;if(e.y<u.y||e.y>l.y)return null;const d=Math.min(o-1,Math.floor(o*(e.x-u.x)/h)),p=Math.min(a-1,Math.floor(a*(e.y-u.y)/c));return n.TileKey.fromRowColumnLevel(p,d,r)}function s(t,r,i=4){const n=function(t,r=4){let i=0;const n=e.powerOfTwo[r];for(t+=n/2;t<0;)t+=n;for(;t>=n;)t-=n;for(let n=0;n<r&&t>0;n++)1&t&&(i+=e.powerOfTwo[53-r+n]),t>>>=1;return i}(r,i);return t.mortonCode()+n}function o(t,r=4){let i=0,n=t,s=0;for(;s<r;s++){const t=e.powerOfTwo[52-s];n>=t&&(n-=t,i+=e.powerOfTwo[r-1-s])}return i-=e.powerOfTwo[r-1],{offset:i,mortonCode:n}}t.geoCoordinatesToTileKey=function(t,e,i){return r(t,t.projection.projectPoint(e),i)},t.worldCoordinatesToTileKey=r,t.geoRectangleToTileKeys=function(e,r,s){const o=(t,e,r)=>t<e?r-(e-t)%(r-e):e+(t-e)%(r-e),a=(t,e,r)=>Math.min(Math.max(t,e),r),u=o(r.southWest.longitudeInRadians,-Math.PI,Math.PI),l=a(r.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=o(r.northEast.longitudeInRadians,-Math.PI,Math.PI),c=a(r.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),d=t.geoCoordinatesToTileKey(e,i.GeoCoordinates.fromRadians(l,u),s),p=t.geoCoordinatesToTileKey(e,i.GeoCoordinates.fromRadians(c,h),s),f=e.subdivisionScheme.getLevelDimensionX(s);if(!d||!p)throw new Error(\"Invalid coordinates\");const m=d.column;let y=p.column;u>h&&(y+=y!==m?f:f-1);const g=Math.min(d.row,p.row),x=Math.max(d.row,p.row),v=new Array;for(let t=g;t<=x;++t)for(let e=m;e<=y;++e)v.push(n.TileKey.fromRowColumnLevel(t,e%f,s));return v},t.getKeyForTileKeyAndOffset=s,t.extractOffsetAndMortonKeyFromKey=o,t.getParentKeyFromKey=function(t,e=4){const{offset:r,mortonCode:i}=o(t,e);return s(n.TileKey.fromMortonCode(n.TileKey.parentMortonCode(i)),r,e)}}(e.TileKeyUtils||(e.TileKeyUtils={}))},2801:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.TileTreeTraverse=void 0;const i=r(3424);e.TileTreeTraverse=class{constructor(t){this.m_subdivisionScheme=t}subTiles(t){const e=this.m_subdivisionScheme.getSubdivisionX(t.level),r=this.m_subdivisionScheme.getSubdivisionY(t.level);return new i.SubTiles(t,e,r)}}},6557:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.TilingScheme=void 0;const i=r(9861),n=r(7841),s=r(2801);e.TilingScheme=class{constructor(t,e){this.subdivisionScheme=t,this.projection=e,this.boundingBoxGenerator=new i.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new s.TileTreeTraverse(t)}getSubTileKeys(t){return this.tileTreeTraverse.subTiles(t)}getTileKey(t,e){return n.TileKeyUtils.geoCoordinatesToTileKey(this,t,e)}getTileKeys(t,e){return n.TileKeyUtils.geoRectangleToTileKeys(this,t,e)}getGeoBox(t){return this.boundingBoxGenerator.getGeoBox(t)}getWorldBox(t,e){return this.boundingBoxGenerator.getWorldBox(t,e)}}},2224:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.webMercatorTilingScheme=void 0;const i=r(9885),n=r(9447),s=r(6557);e.webMercatorTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,i.webMercatorProjection)},4388:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.LineGroup=e.createSimpleLineGeometry=e.createLineGeometry=e.LineGeometry=void 0;const i=r(9365),n=r(1405),s=r(9044),o=r(6280),a=r(6815),u=r(4342),l=new a.Vector3,h=new a.Vector3,c=new a.Vector3,d=new a.Vector3,p={attributes:[{name:\"extrusionCoord\",itemSize:3,offset:0},{name:\"position\",itemSize:3,offset:3},{name:\"tangent\",itemSize:3,offset:6},{name:\"biTangent\",itemSize:4,offset:9}],stride:13},f={attributes:[{name:\"uv\",itemSize:2,offset:p.stride},{name:\"normal\",itemSize:3,offset:p.stride+2}],stride:5},m={attributes:[...p.attributes,...f.attributes],stride:p.stride+f.stride},y={attributes:[{name:\"extrusionCoord\",itemSize:2,offset:0},{name:\"position\",itemSize:3,offset:2},{name:\"positionLow\",itemSize:3,offset:5},{name:\"tangent\",itemSize:3,offset:8},{name:\"biTangent\",itemSize:4,offset:11}],stride:15},g={attributes:[...y.attributes,...f.attributes],stride:y.stride+f.stride};class x{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function v(t,e){return e?t?g:y:t?m:p}function b(t,e,r,i,n,s,o=new x,p=!1){if(0===e.length)return o;const f=v(void 0!==n,p).stride,m=e.length,y=m/3,g=new Array(y),b=new Array(m-3),w=o.vertices.length/f,_=void 0!==i&&i.length>0,M=void 0!==n&&n.length>0,E=void 0!==s&&s.length&&m;(0,u.assert)(!_||i.length===y),(0,u.assert)(!M||n.length/2===y),(0,u.assert)(!E||s.length===m);let T=.1;g[0]=T;for(let t=0;t<y-1;++t){let r=0;for(let i=0;i<3;++i){const n=e[3*(t+1)+i]-e[3*t+i];b[3*t+i]=n,r+=n*n}T+=Math.sqrt(r),g[t+1]=T}const S=_?Math.abs(i[i.length-1]-i[0]):1,A=g[g.length-1]/S;if(_)for(let t=0;t<y;++t)g[t]=i[t]*A+.1;let z=!0;for(let t=0;t<3;++t)z=z&&e[t]===e[e.length-3+t];const P=(i,u,f,m,y)=>{const g=[],x=[];g.push(m,-1*y,A),x.push(m,1*y,A);for(let t=0;t<3;++t){if(p){const r=Math.fround(e[3*i+t]),n=e[3*i+t]-r;g.push(r,n),x.push(r,n)}else g.push(e[3*i+t]),x.push(e[3*i+t]);l.setComponent(t,e[3*i+t]),h.setComponent(t,b[u+t]),c.setComponent(t,b[f+t])}h.normalize(),c.normalize(),g.push(h.x,h.y,h.z),x.push(h.x,h.y,h.z),l.add(t),r.surfaceNormal(l,l);const v=function(t,e,r,i){let n=0;if(!e.equals(r)){n=e.angleTo(r);const i=(new a.Vector3).crossVectors(e,r),s=Math.sign(i.dot(t));0!==s&&(n*=s),Number.isNaN(n)&&(n=0)}return i.copy(e).add(r).normalize().cross(t).normalize(),n}(l,h,c,d);g.push(d.x,d.y,d.z,v),x.push(d.x,d.y,d.z,v),M&&(g.push(n[2*i],n[2*i+1]),x.push(n[2*i],n[2*i+1]),g.push(l.x,l.y,l.z),x.push(l.x,l.y,l.z)),o.vertices.push(...g,...x),E&&(o.vertexColors.push(s[3*i],s[3*i+1],s[3*i+2]),o.vertexColors.push(s[3*i],s[3*i+1],s[3*i+2]))};for(let t=0;t<y;++t){const e=z&&0===t?b.length-3:3*Math.max(0,t-1),r=z&&t===y-1?0:Math.min(3*t,b.length-3);t>0&&P(t,e,r,g[t-1],g[t]),t+1<y&&P(t,e,r,-1*g[Math.min(t,g.length-1)],g[Math.min(t+1,g.length-1)])}for(let t=0;t<y-1;++t){const e=w+4*t;o.indices.push(e,e+1,e+2,e+2,e+1,e+3)}return o}function w(t,e,r=new x){if(0===t.length)return r;const i=t.length/3;let n=r.vertices.length/3;const s=void 0!==e&&e.length&&t.length;for(let o=0;o<i;++o,n++){o>0&&r.indices.push(n),o<i-1&&r.indices.push(n);for(let i=0;i<3;++i)r.vertices.push(t[3*o+i]),s&&r.vertexColors.push(e[3*o+i])}return r}e.LineGeometry=x,e.createLineGeometry=b,e.createSimpleLineGeometry=w;class _{static createGeometry(t,e,r,n,a=!1,u=!1,l=!1){if(l)return n.setAttribute(\"position\",new i.BufferAttribute(new Float32Array(t),3)),e.length===t.length&&n.setAttribute(\"color\",new i.BufferAttribute(new Float32Array(e),3)),n.setIndex(new i.BufferAttribute(new Uint32Array(r),1)),n;{const l=v(a,u),h=new s.InterleavedBuffer(new Float32Array(t),l.stride);return l.attributes.forEach((t=>{const e=new o.InterleavedBufferAttribute(h,t.itemSize,t.offset,!1);n.setAttribute(t.name,e)})),e.length===t.length&&n.setAttribute(\"color\",new i.BufferAttribute(new Float32Array(e),3)),n.setIndex(new i.BufferAttribute(new Uint32Array(r),1)),n}}constructor(t=!1,e=!1,r=!1){this.hasNormalsAndUvs=t,this.highPrecision=e,this.isSimple=r,this.m_geometry=new x}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(t,e,r,i,n,s){return this.isSimple?w(e,s,this.m_geometry):((0,u.assert)(!this.hasNormalsAndUvs||void 0!==n),b(t,e,r,i,n,s,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return v(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return v(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(t){return void 0===t&&(t=new n.BufferGeometry),_.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,t,this.hasNormalsAndUvs,this.highPrecision)}}e.LineGroup=_},3711:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.reconstructLineWidth=e.reconstructLine=e.triangulateLine=e.numCirclePoints=void 0;const i=r(5448),n=r(6815),s=new n.Vector3(0,0,1),o=[0,1,2,1,3,2],a=[0,1,3,3,1,2,0,3,4,5,4,3],u=Math.PI/8;function l(t,e,r,i,n,s){const o=n.length/3;n.push(t,e,0);for(let a=0;a<9;++a){const l=u*a+Math.PI/2+r;n.push(t+i*Math.cos(l),e+i*Math.sin(l),0),s.push(o,o+a+1,o+(a+1)%9+1)}}e.numCirclePoints=function(t){return 9},e.triangulateLine=function(t,e,r,u,h=!0,c=h){if(t.length<3)return;const d=new i.Vector2;if(h){const i=3!==t.length?d.set(t[3]-t[0],t[4]-t[1]).angle():0;l(t[0],t[1],i,e,r,u)}const p=r.length/3,f=new n.Vector3,m=new n.Vector3,y=new n.Vector3,g=new n.Vector3,x=new n.Vector3,v=new n.Vector3,b=new n.Vector3,w=new n.Vector3,_=new n.Vector3,M=t.length/3;let E=0;for(let i=0;i<M;++i){let n=!1;if(m.set(t[3*i],t[3*i+1],t[3*i+2]),i+1<M){if(y.set(t[3*(i+1)],t[3*(i+1)+1],t[3*(i+1)+2]),g.copy(y).sub(m).normalize().cross(s),x.copy(g),i>0&&(x.add(f).multiplyScalar(1-.5*g.dot(f)),n=f.angleTo(g)>Math.PI/2,n)){const t=e/Math.cos(g.angleTo(f)/2);v.copy(g).add(f).normalize().multiplyScalar(-t).add(m),b.copy(f).multiplyScalar(e).add(m),w.copy(g).add(f).normalize().multiplyScalar(t).add(m),_.copy(g).multiplyScalar(e).add(m)}n?r.push(v.x,v.y,v.z,b.x,b.y,b.z,w.x,w.y,w.z,_.x,_.y,_.z):(v.copy(x).multiplyScalar(-e).add(m),b.copy(x).multiplyScalar(e).add(m),r.push(v.x,v.y,v.z,b.x,b.y,b.z)),f.copy(g)}else v.copy(f).multiplyScalar(-e).add(m),b.copy(f).multiplyScalar(e).add(m),r.push(v.x,v.y,v.z,b.x,b.y,b.z);i!==M-1&&((n?a:o).forEach((t=>u.push(p+E+t))),E+=n?4:2)}if(c){const i=2!==t.length?d.set(t[3*(M-3)]-t[3*(M-2)],t[3*(M-3)+1]-t[3*(M-2)+1]).angle():Math.PI;l(t[3*(M-2)],t[3*(M-2)+1],i,e,r,u)}},e.reconstructLine=function(t,e){const r=new Float32Array(t.length/2);for(let i=3*e,n=2*i;i<r.length;i+=3,n+=6)r[i]=t[n]+.5*(t[n+3]-t[n]),r[i+1]=t[n+1]+.5*(t[n+3+1]-t[n+1]),r[i+2]=t[n+2]+.5*(t[n+3+2]-t[n+2]);return r},e.reconstructLineWidth=function(t,e){const r=t[2*e+3]-t[2*e],i=t[2*e+3+1]-t[2*e+1],n=t[2*e+3+2]-t[2*e+2];return.5*Math.sqrt(r*r+i*i+n*n)}},8263:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(8759),e)},8759:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.LRUCache=e.Entry=void 0;const i=r(4342);class n{constructor(t,e,r,i,n){this.key=t,this.value=e,this.size=r,this.newer=i,this.older=n}}e.Entry=n,e.LRUCache=class{constructor(t,e=()=>1){this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=t,this.m_sizeFunction=e}forEach(t,e){let r=this.m_newest;for(;null!==r;){const i=r.older;t.call(e,r.value,r.key,this),r=i}}get size(){return this.m_size}get capacity(){return this.m_capacity}get map(){return this.m_map}get newest(){return this.m_newest}get oldest(){return this.m_oldest}setCapacity(t){this.m_capacity=t,this.evict()}setCapacityAndMeasure(t,e=()=>1){this.m_capacity=t,this.m_sizeFunction=e,this.shrinkToCapacity()}shrinkToCapacity(){let t=0;const e=this.m_sizeFunction;let r=this.m_newest;for(;null!==r;){const i=e(r.value);r.size=i,t+=i,r=r.older}this.m_size=t,this.evict()}set(t,e){const r=this.m_sizeFunction(e);let s=this.m_map.get(t);if(void 0!==s)this.m_size=this.m_size-s.size+r,s.value=e,s.size=r,this.promoteEntry(s),this.evict();else{if(r>this.m_capacity)return;if(s=new n(t,e,r,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=s;else{(0,i.assert)(null!==this.m_newest);const t=this.m_newest;s.older=this.m_newest,t.newer=s,this.m_newest=s}this.m_map.set(t,s),this.m_size+=r,this.evict()}}get(t){const e=this.m_map.get(t);if(void 0!==e)return this.promoteEntry(e),e.value}has(t){return this.m_map.has(t)}clear(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()}evictAll(){const t=this.evictionCallback;void 0!==t&&this.forEach(((e,r)=>t(r,e))),this.clear()}evictSelected(t,e){const r=this.evictionCallback;let i=this.m_newest;for(;null!==i;){const n=i.older;t.call(e,i.value,i.key)&&(void 0!==r&&r(i.key,i.value),this.deleteEntry(i),this.m_map.delete(i.key)),i=n}}delete(t){const e=this.m_map.get(t);return void 0!==e&&(this.deleteEntry(e),this.m_map.delete(t))}evict(){for(;null!==this.m_oldest&&this.m_size>this.m_capacity;)if(void 0===this.evictOldest())return}evictOldest(){(0,i.assert)(null!==this.m_oldest);const t=this.m_oldest;(0,i.assert)(null===t.older);let e=t;if(void 0!==this.canEvict)for(;!this.canEvict(e.key,e.value);){if(null===e.newer)return;e=e.newer}if(e===t)this.m_oldest=e.newer,null!==e.newer&&((0,i.assert)(e.newer.older===e),e.newer.older=null);else{if(null===e.newer)return;(0,i.assert)(e.newer.older===e),e.newer.older=e.older,null!==e.older&&(e.older.newer=e.newer)}const r=this.m_map.delete(e.key);return(0,i.assert)(!0===r),r&&void 0!==this.evictionCallback&&this.evictionCallback(e.key,e.value),this.m_size-=e.size,e}deleteEntry(t){t===this.m_newest?this.m_newest=t.older:t.newer?t.newer.older=t.older:(0,i.assert)(!1),t===this.m_oldest?this.m_oldest=t.newer:t.older?t.older.newer=t.newer:(0,i.assert)(!1),this.m_size-=t.size}promoteEntry(t){if(t===this.m_newest)return;t.newer&&((0,i.assert)(t.newer.older===t),t.newer.older=t.older),t.older&&((0,i.assert)(t.older.newer===t),t.older.newer=t.newer),t===this.m_oldest&&(this.m_oldest=t.newer),t.newer=null,t.older=this.m_newest,(0,i.assert)(null!==this.m_newest);const e=this.m_newest;(0,i.assert)(null===e.newer),e.newer=t,this.m_newest=t}}},2626:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(1153),e),n(r(6802),e),n(r(4773),e),n(r(2369),e),n(r(5199),e),n(r(1781),e)},1781:(t,e,r)=>{\"use strict\";var i;Object.defineProperty(e,\"__esModule\",{value:!0}),e.GeoJsonTiler=void 0;const n=r(242),s=r(8152),o=null!==(i=n.default)&&void 0!==i?i:n,a=-(-2&-Math.ceil(204.8));e.GeoJsonTiler=class{constructor(){this.indexes=new Map}dispose(){}async connect(){return await Promise.resolve()}async registerIndex(t,e){if(!this.indexes.has(t))return await this.updateIndex(t,e)}async updateIndex(t,e){if(e instanceof URL){const t=await fetch(e.href);if(!t.ok)throw new Error(`GeoJsonTiler: Unable to fetch ${e.href}: ${t.statusText}`);e=await t.json()}const r=(0,s.isFeatureGeometry)(e)||\"GeometryCollection\"===e.type||\"Feature\"===e.type&&void 0===e.id||\"FeatureCollection\"===e.type&&e.features.length>0&&void 0===e.features[0].id,i=o(e,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:a,lineMetrics:!1,promoteId:null,generateId:r,debug:0});i.geojson=e,this.indexes.set(t,i)}async getTile(t,e){const r=this.indexes.get(t);if(void 0===r)throw new Error(\"Tile not found\");const i=r.getTile(e.level,e.column,e.row);return null!==i&&(i.layer=t),i||{}}}},1153:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ThemedTileDecoder=void 0;const i=r(7769),n=r(4342).LoggerManager.instance.create(\"ThemedTileDecoder\");e.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(t,e,r){return void 0===this.m_styleSetEvaluator?(n.info(\"cannot decode tile, as there is not style available\"),Promise.resolve(void 0)):this.decodeThemedTile(t,e,this.m_styleSetEvaluator,r)}getTileInfo(t,e,r){return Promise.resolve(void 0)}configure(t,e){void 0!==(null==t?void 0:t.styleSet)&&(this.m_styleSetEvaluator=new i.StyleSetEvaluator(t)),this.m_styleSetEvaluator&&this.m_styleSetEvaluator.setEnabledFeatures(null==t?void 0:t.enabledFeatures),void 0!==(null==t?void 0:t.languages)&&(this.languages=t.languages),void 0!==e&&void 0!==e.storageLevelOffset&&(this.m_storageLevelOffset=e.storageLevelOffset)}}},6802:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.TileDecoderService=void 0;const i=r(8152),n=r(2616),s=r(1984),o=r(4342),a=r(2369),u=o.LoggerManager.instance.create(\"TileDecoderService\");class l extends a.WorkerService{static start(t,e){return new l(t,e)}constructor(t,e){super(t),this.serviceId=t,this.m_decoder=e,this.m_decoder.connect()}handleRequest(t){return i.WorkerDecoderProtocol.isDecodeTileRequest(t)?this.handleDecodeTileRequest(t):i.WorkerDecoderProtocol.isTileInfoRequest(t)?this.handleTileInfoRequest(t):super.handleRequest(t)}handleMessage(t){i.WorkerDecoderProtocol.isConfigurationMessage(t)?this.handleConfigurationMessage(t):u.error(`[${this.serviceId}]: invalid message ${t.type}`)}async handleDecodeTileRequest(t){const e=n.TileKey.fromMortonCode(t.tileKey),r=(0,i.getProjection)(t.projection),o=await this.m_decoder.decodeTile(t.data,e,r),a=[],u=t=>{void 0!==t&&t.buffer.byteLength>0&&!a.includes(t.buffer)&&a.push(t.buffer)};return null==o||o.geometries.forEach((t=>{var e,r,i;if(null===(e=t.vertexAttributes)||void 0===e||e.forEach((t=>u(t))),null===(r=t.interleavedVertexAttributes)||void 0===r||r.forEach((t=>u(t))),u(t.index),u(t.edgeIndex),Array.isArray(t.objInfos)&&1===t.objInfos.length&&\"object\"==typeof t.objInfos[0]&&(null===(i=t.objInfos[0])||void 0===i?void 0:i.hasOwnProperty(\"displacementMap\"))){const e=t.objInfos[0];u(e.displacementMap)}Array.isArray(t.attachments)&&t.attachments.forEach((t=>{u(t.index),u(t.edgeIndex)}))})),null==o||o.techniques.forEach((t=>{(0,s.addBuffersToTransferList)(t,a)})),{response:o,transferList:a}}handleTileInfoRequest(t){const e=n.TileKey.fromMortonCode(t.tileKey),r=(0,i.getProjection)(t.projection);return this.m_decoder.getTileInfo(t.data,e,r).then((t=>({response:t,transferList:void 0!==t&&void 0!==t.transferList?t.transferList:[]})))}handleConfigurationMessage(t){this.m_decoder.configure(t,t.options)}}e.TileDecoderService=l},4773:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.TilerService=void 0;const i=r(8152),n=r(2616),s=r(1781),o=r(2369);class a extends o.WorkerService{static start(t){return new a(t)}constructor(t){super(t),this.serviceId=t,this.tiler=new s.GeoJsonTiler}handleRequest(t){return i.WorkerTilerProtocol.isRegisterIndexRequest(t)?this.handleRegisterIndexRequest(t):i.WorkerTilerProtocol.isUpdateIndexRequest(t)?this.handleUpdateIndexRequest(t):i.WorkerTilerProtocol.isTileRequest(t)?this.handleTileRequest(t):super.handleRequest(t)}async handleTileRequest(t){const e=n.TileKey.fromMortonCode(t.tileKey);return{response:await this.tiler.getTile(t.index,e)||{}}}async handleRegisterIndexRequest(t){const e=\"string\"==typeof t.input?new URL(t.input):t.input;return await this.tiler.registerIndex(t.id,e),{response:{}}}async handleUpdateIndexRequest(t){const e=\"string\"==typeof t.input?new URL(t.input):t.input;return this.tiler.updateIndex(t.id,e),{response:{}}}}e.TilerService=a},2369:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.WorkerService=void 0;const i=r(8152),n=r(4342).LoggerManager.instance.create(\"WorkerService\",{enabled:!0});e.WorkerService=class{constructor(t){this.serviceId=t,this.m_pendingRequests=new Map,this.onMessage=t=>{if(\"string\"==typeof t.data.service&&t.data.service===this.serviceId)try{if(i.WorkerServiceProtocol.isRequestMessage(t.data)){const e=t.data,r={service:e.service,messageId:e.messageId,responseSent:!1};this.m_pendingRequests.set(e.messageId,r),this.tryHandleRequest(e.request).then((t=>{this.doSendResponse(r,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,response:t.response},t.transferList)})).catch((t=>{this.doSendResponse(r,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,errorMessage:t.toString(),errorStack:t.stack})}))}else this.tryHandleMessage(t.data)}catch(e){n.error(`[${this.serviceId}]: Unhandled exception when handling ${t.type}`)}},self.addEventListener(\"message\",this.onMessage);const e={service:t,type:i.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(e)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener(\"message\",this.onMessage)}handleMessage(t){n.error(`[${this.serviceId}]: Invalid message ${t.type}`)}handleRequest(t){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${t.type}'`)}tryHandleMessage(t){try{this.handleMessage(t)}catch(e){n.error(`[${this.serviceId}]: Failed, handling message ${t.type}`)}}tryHandleRequest(t){try{return this.handleRequest(t)}catch(t){return n.error(`[${this.serviceId}]: Failure`,t),Promise.reject(t)}}doSendResponse(t,e,r){t.responseSent||(void 0!==r?self.postMessage(e,r):self.postMessage(e),t.responseSent=!0,this.m_pendingRequests.delete(t.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach((t=>{this.doSendResponse(t,{service:this.serviceId,type:i.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,errorMessage:\"cancelled\"})}))}}},5199:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.WorkerServiceManager=void 0;const i=r(8152),n=r(2369);class s extends n.WorkerService{static getInstance(){return void 0===this.m_service&&(this.m_service=new s(i.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}constructor(t=i.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(t),this.m_factories=new Map,this.m_services=new Map}register(t){this.m_factories.set(t.serviceType,t.factory)}handleRequest(t){if(t.type===i.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(t.targetServiceId))throw Error(`error - service with targetServiceId='${t.targetServiceId}' already running, ignoring CreateService request`);const e=this.m_factories.get(t.targetServiceType);if(void 0===e)throw Error(`unknown targetServiceType requested: '${t.targetServiceType}'`);const r=e(t.targetServiceId);this.m_services.set(t.targetServiceId,r)}if(t.type===i.WorkerServiceProtocol.Requests.DestroyService){const e=this.m_services.get(t.targetServiceId);if(void 0===e)throw Error(`unknown targetServiceId '${t.targetServiceId}'`);e.destroy(),this.m_services.delete(t.targetServiceId)}return Promise.resolve({response:{}})}}e.WorkerServiceManager=s},5033:(t,e)=>{\"use strict\";var r;Object.defineProperty(e,\"__esModule\",{value:!0}),e.ExtrusionFeatureDefs=void 0,(r=e.ExtrusionFeatureDefs||(e.ExtrusionFeatureDefs={})).DEFAULT_RATIO_MIN=0,r.DEFAULT_RATIO_MAX=1,r.MIN_BUILDING_HEIGHT=.1},1509:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),e.OmvTilerService=e.OmvTileDecoder=e.OmvTileDecoderService=e.OmvDecoder=void 0,n(r(952),e);var s=r(952);Object.defineProperty(e,\"OmvDecoder\",{enumerable:!0,get:function(){return s.VectorTileDataProcessor}}),Object.defineProperty(e,\"OmvTileDecoderService\",{enumerable:!0,get:function(){return s.VectorTileDecoderService}}),Object.defineProperty(e,\"OmvTileDecoder\",{enumerable:!0,get:function(){return s.VectorTileDecoder}}),Object.defineProperty(e,\"OmvTilerService\",{enumerable:!0,get:function(){return s.GeoJsonTilerService}})},1984:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(7259),e),n(r(8284),e),n(r(1017),e),n(r(1370),e),n(r(1216),e),n(r(5771),e),n(r(8131),e),n(r(6304),e),n(r(8023),e)},1667:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ColorUtils=void 0;const i=r(3096),n=r(3334),s=r(8263),o=r(797),a=r(7610),u=255,l=new i.Color,h={h:0,s:0,l:0};!function(t){function e(t,e){return(0,n.clamp)(t+(e<0?t:1-t)*e,0,1)}function r(t,e,r){let i;if(a.RGBA.isRGBA(e))i=t.equals(e)===r;else if(\"string\"==typeof e){const n=c.get(e);if(n)i=t.equals(n)===r;else{const n=a.RGBA.parse(e);void 0!==n&&(c.set(e,n),i=t.equals(n)===r)}}return i}t.getHexFromRgba=function(t,e,r,i){return(0,o.assert)(i>=0&&i<=1),u-Math.floor(i*u)<<24^t*u<<16^e*u<<8^r*u},t.getHexFromRgb=function(t,e,r){return(0,o.assert)(t>=0&&t<=1),(0,o.assert)(e>=0&&e<=1),(0,o.assert)(r>=0&&r<=1),t*u<<16^e*u<<8^r*u},t.getHexFromHsl=function(t,e,r){return(0,o.assert)(t>=0&&t<=1),(0,o.assert)(e>=0&&e<=1),(0,o.assert)(r>=0&&r<=1),l.setHSL(t,e,r).getHex()},t.darken=function(t,e){return l.setRGB(t.r,t.g,t.b),l.getHSL(h),h.l=(0,n.clamp)(h.l-e,0,1),l.setHSL(h.h,h.s,h.l),t.r=l.r,t.g=l.g,t.b=l.b,t},t.scaleColor=function(t,r){return l.setRGB(t.r,t.g,t.b),l.getHSL(h),h.s=e(h.s,r.s),h.l=e(h.l,r.l),l.setHSL(h.h,h.s,h.l),t.r=l.r,t.g=l.g,t.b=l.b,t.a=e(t.a,r.a),t},t.getRgbaFromHex=function(t,e=new a.RGBA){return(0,o.assert)(!0,\"Wrong hex format\"),e.r=(t>>16&u)/u,e.g=(t>>8&u)/u,e.b=(t&u)/u,e.a=(u-(t>>24&u))/u,e},t.hasAlphaInHex=function(t){return(0,o.assert)(!0,\"Wrong hex format\"),!!(t>>24)},t.getAlphaFromHex=function(t){return(0,o.assert)(!0,\"Wrong hex format\"),(u-(t>>24)&u)/u},t.removeAlphaFromHex=function(t){return(0,o.assert)(!0,\"Wrong hex format\"),16777215&t},t.comparePotentiallyRGBA=function(t,e,i){let n;return a.RGBA.isRGBA(t)?n=r(t,e,i):a.RGBA.isRGBA(e)&&(n=r(e,t,i)),n}}(e.ColorUtils||(e.ColorUtils={}));const c=new s.LRUCache(500)},7259:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.MapEnv=e.Env=void 0;class r{static isEnv(t){return t instanceof r}lookup(t){}unmap(){return{}}}e.Env=r,e.MapEnv=class extends r{constructor(t,e){super(),this.entries=t,this.parent=e}lookup(t){if(this.entries.hasOwnProperty(t)){const e=this.entries[t];if(void 0!==e)return e}return this.parent?this.parent.lookup(t):void 0}unmap(){const t=this.parent?this.parent.unmap():{};for(const e in this.entries)this.entries.hasOwnProperty(e)&&(t[e]=this.entries[e]);return t}}},8284:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.evaluateJsonExpr=void 0;const i=r(7259),n=r(8023);e.evaluateJsonExpr=function(t,e,r){return n.Expr.fromJSON(t,r).evaluate(new i.MapEnv(e),n.ExprScope.Value)}},8023:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),e.InterpolateExpr=e.StepExpr=e.CaseExpr=e.MatchExpr=e.LookupExpr=e.CallExpr=e.HasAttributeExpr=e.ObjectLiteralExpr=e.StringLiteralExpr=e.NumberLiteralExpr=e.BooleanLiteralExpr=e.NullLiteralExpr=e.LiteralExpr=e.VarExpr=e.Expr=e.ExprScope=e.ExprDependencies=void 0;const s=r(5448),o=r(6815),a=r(6577),u=r(2302),l=r(908),h=r(8628),c=r(1017),d=r(1324),p=r(7610),f=r(5771);n(r(7259),e);const m=new u.ExprEvaluator,y=new l.ExprInstantiator;class g{constructor(){this.properties=new Set}}e.ExprDependencies=g;class x{static of(t){const e=new g;return t.accept(this.instance,e),e}visitNullLiteralExpr(t,e){}visitBooleanLiteralExpr(t,e){}visitNumberLiteralExpr(t,e){}visitStringLiteralExpr(t,e){}visitObjectLiteralExpr(t,e){}visitVarExpr(t,e){e.properties.add(t.name)}visitHasAttributeExpr(t,e){e.properties.add(t.name)}visitCallExpr(t,e){switch(t.args.forEach((t=>t.accept(this,e))),t.op){case\"dynamic-properties\":e.volatile=!0;break;case\"feature-state\":e.featureState=!0,e.properties.add(\"$state\"),e.properties.add(\"$id\");break;case\"id\":e.properties.add(\"$id\");break;case\"zoom\":case\"world-ppi-scale\":case\"world-discrete-ppi-scale\":e.properties.add(\"$zoom\");break;case\"pixel-world-scale\":e.properties.add(\"$pixelToMeters\");break;case\"geometry-type\":e.properties.add(\"$geometryType\")}}visitLookupExpr(t,e){return this.visitCallExpr(t,e)}visitMatchExpr(t,e){t.value.accept(this,e),t.branches.forEach((([t,r])=>r.accept(this,e))),t.fallback.accept(this,e)}visitCaseExpr(t,e){t.branches.forEach((([t,r])=>{t.accept(this,e),r.accept(this,e)})),t.fallback.accept(this,e)}visitStepExpr(t,e){t.input.accept(this,e),t.defaultValue.accept(this,e),t.stops.forEach((([t,r])=>r.accept(this,e)))}visitInterpolateExpr(t,e){t.input.accept(this,e),t.stops.forEach((([t,r])=>r.accept(this,e)))}}var v;x.instance=new x,function(t){t[t.Value=0]=\"Value\",t[t.Condition=1]=\"Condition\",t[t.Dynamic=2]=\"Dynamic\"}(v=e.ExprScope||(e.ExprScope={}));class b{static isExpr(t){return t instanceof b}static fromJSON(t,e,r,i){return I(t,void 0!==e?{definitions:e,lockedNames:new Set,cache:null!=r?r:new Map,referencedDefinitions:null!=i?i:new Set}:void 0)}evaluate(t,e=v.Value,r){return this.accept(m,new u.ExprEvaluatorContext(m,t,e,r))}instantiate(t){return this.accept(y,t)}dependencies(){return this.m_dependencies||(this.m_dependencies=x.of(this)),this.m_dependencies}intern(t){return t.add(this)}toJSON(){return(new V).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}getPoolKey(t=!1){return\"E\"}}e.Expr=b;class w extends b{constructor(t){super(),this.name=t}accept(t,e){return t.visitVarExpr(this,e)}exprIsDynamic(){return!1}getPoolKey(){return this.name}}e.VarExpr=w;class _ extends b{static fromValue(t,e){switch(typeof t){case\"boolean\":return new E(t);case\"number\":return new T(t);case\"string\":return new S(t);case\"object\":return null===t?M.instance:new A(t,e);default:throw new Error(`failed to create a literal from '${t}'`)}}exprIsDynamic(){return!1}}e.LiteralExpr=_;class M extends _{constructor(){super(),this.value=null}accept(t,e){return t.visitNullLiteralExpr(this,e)}exprIsDynamic(){return!1}getPoolKey(){return\"N\"}}e.NullLiteralExpr=M,M.instance=new M;class E extends _{constructor(t){super(),this.value=t}accept(t,e){return t.visitBooleanLiteralExpr(this,e)}getPoolKey(){return\"B\"}}e.BooleanLiteralExpr=E,E.trueInstance=new E(!0),E.falseInstance=new E(!1);class T extends _{constructor(t){super(),this.value=t}accept(t,e){return t.visitNumberLiteralExpr(this,e)}getPoolKey(){return this.value}}e.NumberLiteralExpr=T;class S extends _{constructor(t){super(),this.value=t}get promotedValue(){var t,e,r;return void 0===this.m_promotedValue&&(this.m_promotedValue=null!==(e=null!==(t=p.RGBA.parse(this.value))&&void 0!==t?t:d.Pixels.parse(this.value))&&void 0!==e?e:null),null!==(r=this.m_promotedValue)&&void 0!==r?r:void 0}accept(t,e){return t.visitStringLiteralExpr(this,e)}getPoolKey(){return this.value.length}}e.StringLiteralExpr=S;class A extends _{constructor(t,e){super(),this.value=t,this.id=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(t,e){return t.visitObjectLiteralExpr(this,e)}static get nextID(){return this.m_nextID++}}e.ObjectLiteralExpr=A,A.m_nextID=0;class z extends b{constructor(t){super(),this.name=t}accept(t,e){return t.visitHasAttributeExpr(this,e)}exprIsDynamic(){return!1}getPoolKey(){return this.name}}e.HasAttributeExpr=z;class P extends b{constructor(t,e){super(),this.op=t,this.args=e}get children(){return this.args}accept(t,e){return t.visitCallExpr(this,e)}exprIsDynamic(){var t,e;const r=null!==(t=this.descriptor)&&void 0!==t?t:u.ExprEvaluator.getOperator(this.op);return!!(null===(e=null==r?void 0:r.isDynamicOperator)||void 0===e?void 0:e.call(r,this))||this.args.some((t=>t.isDynamic()))}getPoolKey(t=!1){return t?this.args[0].getPoolKey():this.op}}e.CallExpr=P;class L extends P{static parseArray(t,e){const r=t[1];if(void 0===r)throw new Error(\"missing lookup table in 'lookup' expression\");const i=I(r,e);if(!(Array.isArray(r)&&i instanceof A))throw new Error(\"Invalid lookup table expression for operator 'lookup'. It must be a literal or a ref to one.\");const n=i.value;if(!(Array.isArray(n)||n instanceof Map))throw new Error(`Invalid lookup table type (${typeof n}) for operator 'lookup'`);const s=t.slice(2).map((t=>I(t,e)));return s.unshift(i),new L(s)}constructor(t){super(\"lookup\",t),this.args=t}accept(t,e){return t.visitLookupExpr(this,e)}}e.LookupExpr=L;class O extends b{static isValidMatchLabel(t){switch(typeof t){case\"number\":case\"string\":return!0;case\"object\":if(!Array.isArray(t)||0===t.length)return!1;const e=typeof t[0];return(\"number\"===e||\"string\"===e)&&t.every((t=>typeof t===e));default:return!1}}constructor(t,e,r){super(),this.value=t,this.branches=e,this.fallback=r}accept(t,e){return t.visitMatchExpr(this,e)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some((([t,e])=>e.isDynamic()))||this.fallback.isDynamic()}getPoolKey(){return this.fallback.getPoolKey()}}e.MatchExpr=O;class C extends b{constructor(t,e){super(),this.branches=t,this.fallback=e}accept(t,e){return t.visitCaseExpr(this,e)}exprIsDynamic(){return this.branches.some((([t,e])=>t.isDynamic()||e.isDynamic()))||this.fallback.isDynamic()}getPoolKey(t=!1){return t?this.fallback.getPoolKey():this.branches.length}}e.CaseExpr=C;class k extends b{constructor(t,e,r){super(),this.input=t,this.defaultValue=e,this.stops=r}accept(t,e){return t.visitStepExpr(this,e)}exprIsDynamic(){return this.input.isDynamic()||this.defaultValue.isDynamic()||this.stops.some((([t,e])=>e.isDynamic()))}getPoolKey(t=!1){return t?this.defaultValue.getPoolKey():this.stops.length}}e.StepExpr=k;class j extends b{constructor(t,e,r){super(),this.mode=t,this.input=e,this.stops=r}accept(t,e){return t.visitInterpolateExpr(this,e)}exprIsDynamic(){return this.input.isDynamic()||this.stops.some((([t,e])=>e.isDynamic()))}getPoolKey(t=!1){return t?this.stops[0][0]:this.stops.length}}e.InterpolateExpr=j;class V{serialize(t){return t.accept(this,void 0)}visitNullLiteralExpr(t,e){return null}visitBooleanLiteralExpr(t,e){return t.value}visitNumberLiteralExpr(t,e){return t.value}visitStringLiteralExpr(t,e){return t.value}visitObjectLiteralExpr(t,e){if(t.value instanceof s.Vector2)return[\"make-vector\",t.value.x,t.value.y];if(t.value instanceof o.Vector3)return[\"make-vector\",t.value.x,t.value.y,t.value.z];if(t.value instanceof a.Vector4)return[\"make-vector\",t.value.x,t.value.y,t.value.z,t.value.w];const r=[\"literal\",t.value];return void 0!==t.id&&(r[2]=t.id),r}visitVarExpr(t,e){return[\"get\",t.name]}visitHasAttributeExpr(t,e){return[\"has\",t.name]}visitCallExpr(t,e){return[t.op,...t.args.map((t=>this.serialize(t)))]}visitLookupExpr(t,e){return this.visitCallExpr(t,e)}visitMatchExpr(t,e){const r=[];for(const[e,i]of t.branches)r.push(e,this.serialize(i));return[\"match\",this.serialize(t.value),...r,this.serialize(t.fallback)]}visitCaseExpr(t,e){const r=[];for(const[e,i]of t.branches)r.push(this.serialize(e),this.serialize(i));return[\"case\",...r,this.serialize(t.fallback)]}visitStepExpr(t,e){const r=[\"step\"];return r.push(this.serialize(t.input)),r.push(this.serialize(t.defaultValue)),t.stops.forEach((([t,e])=>{r.push(t),r.push(this.serialize(e))})),r}visitInterpolateExpr(t,e){const r=[\"interpolate\",t.mode];return r.push(this.serialize(t.input)),t.stops.forEach((([t,e])=>{r.push(t),r.push(this.serialize(e))})),r}}function I(t,e){if(Array.isArray(t))return R(t,e);if(null===t)return M.instance;switch(typeof t){case\"number\":return new T(t);case\"string\":return new S(t);case\"boolean\":return new E(t);default:if(p.RGBA.isRGBA(t))return new A(t);throw new Error(`failed to create expression from: ${JSON.stringify(t)}`)}}function R(t,e){const r=t[0];if(\"string\"!=typeof r)throw new Error(\"expected a builtin function name\");switch(r){case\"!has\":case\"!in\":return new P(\"!\",[R([r.slice(1),...t.slice(1)])]);case\"ref\":return function(t,e){if(\"string\"!=typeof t[1])throw new Error(\"expected the name of an attribute\");if(void 0===e)throw new Error(\"ref used with no definitions\");const r=t[1];if(e.lockedNames.has(r))throw new Error(`circular reference to '${r}'`);if(!(r in e.definitions))throw new Error(`definition '${r}' not found`);e.referencedDefinitions.add(r);const i=e.cache.get(r);if(void 0!==i)return i;let n,s=e.definitions[r];const o=(0,f.getDefinitionValue)(s);if((0,h.isInterpolatedPropertyDefinition)(o))return b.fromJSON((0,h.interpolatedPropertyDefinitionToJsonExpr)(s));if(!(0,c.isJsonExpr)(o))return b.fromJSON(o);if(s=o,!(0,c.isJsonExpr)(s))throw new Error(`unsupported definition ${r}`);e.lockedNames.add(r);try{n=I(s,e)}finally{e.lockedNames.delete(r)}return e.cache.set(r,n),n.isCached=!0,n}(t,e);case\"get\":return function(t,e){if(void 0!==t[2])return B(\"get\",t,e);const r=t[1];if(\"string\"!=typeof r)throw new Error(\"expected the name of an attribute\");return new w(r)}(t,e);case\"has\":return function(t,e){if(void 0!==t[2])return B(\"has\",t,e);const r=t[1];if(\"string\"!=typeof r)throw new Error(\"expected the name of an attribute\");return new z(r)}(t,e);case\"literal\":return function(t){const e=t[1];if(null===e||\"object\"!=typeof e)throw new Error(\"expected an object or array literal\");const r=t[2];return new A(e,r)}(t);case\"match\":return function(t,e){if(t.length<4)throw new Error(\"not enough arguments\");if(!(t.length%2))throw new Error(\"fallback is missing in 'match' expression\");const r=I(t[1],e),i=[];for(let r=2;r<t.length-1;r+=2){const n=t[r];if(!O.isValidMatchLabel(n))throw new Error(`'${JSON.stringify(n)}' is not a valid label for 'match'`);const s=I(t[r+1],e);i.push([n,s])}const n=I(t[t.length-1],e);return new O(r,i,n)}(t,e);case\"case\":return function(t,e){if(t.length<3)throw new Error(\"not enough arguments\");if(t.length%2)throw new Error(\"fallback is missing in 'case' expression\");const r=[];for(let i=1;i<t.length-1;i+=2){const n=I(t[i],e),s=I(t[i+1],e);r.push([n,s])}const i=I(t[t.length-1],e);return new C(r,i)}(t,e);case\"interpolate\":return function(t,e){const r=t[1];if(!function(t){if(!Array.isArray(t))return!1;switch(t[0]){case\"discrete\":case\"linear\":case\"cubic\":case\"exponential\":return!0;default:return!1}}(r))throw new Error(\"expected an interpolation type\");if(\"exponential\"===r[0]&&\"number\"!=typeof r[1])throw new Error(\"expected the base of the exponential interpolation\");const i=void 0!==t[2]?I(t[2],e):void 0;if(!b.isExpr(i))throw new Error(\"expected the input of the interpolation\");if(3===t.length||!(t.length%2))throw new Error(\"invalid number of samples\");const n=[];for(let r=3;r<t.length-1;r+=2){const i=t[r],s=I(t[r+1],e);n.push([i,s])}return new j(r,i,n)}(t,e);case\"step\":return function(t,e){if(t.length<2)throw new Error(\"expected the input of the 'step' operator\");if(t.length<3||!(t.length%2))throw new Error(\"not enough arguments\");const r=I(t[1],e),i=I(t[2],e),n=[];for(let r=3;r<t.length;r+=2){const i=t[r],s=I(t[r+1],e);n.push([i,s])}return new k(r,i,n)}(t,e);case\"lookup\":return L.parseArray(t,e);default:return B(r,t,e)}}function B(t,e,r){return new P(t,e.slice(1).map((t=>I(t,r))))}},2302:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ExprEvaluator=e.ExprEvaluatorContext=void 0;const i=r(3096),n=r(3334),s=r(5448),o=r(6815),a=r(6577),u=r(8023),l=r(6073),h=r(7290),c=r(4672),d=r(8998),p=r(1954),f=r(2181),m=r(202),y=r(4054),g=r(9764),x=r(7029),v=r(3501),b=r(5113),w=r(545),_=r(1324),M=r(7610),E=new Map;function T(t,e){var r,i,n;if(e instanceof u.StringLiteralExpr)return null!==(r=e.promotedValue)&&void 0!==r?r:e.value;const s=t.evaluate(e);return\"string\"==typeof s&&null!==(n=null!==(i=M.RGBA.parse(s))&&void 0!==i?i:_.Pixels.parse(s))&&void 0!==n?n:s}e.ExprEvaluatorContext=class{constructor(t,e,r,i){this.evaluator=t,this.env=e,this.scope=r,this.cache=i}evaluate(t){var e,r;if(void 0===t)throw new Error(\"Failed to evaluate expression\");const i=null===(e=this.cache)||void 0===e?void 0:e.get(t);if(void 0!==i)return i;const n=t.accept(this.evaluator,this);return null===(r=this.cache)||void 0===r||r.set(t,n),n}wrapValue(t,e){return u.Expr.isExpr(t)?t:u.LiteralExpr.fromValue(t,e)}};class S{static defineOperator(t,e){E.set(t,e)}static defineOperators(t){Object.getOwnPropertyNames(t).forEach((e=>{this.defineOperator(e,t[e])}))}static getOperator(t){return E.get(t)}visitVarExpr(t,e){const r=e.env.lookup(t.name);return void 0!==r?r:null}visitNullLiteralExpr(t,e){return null}visitBooleanLiteralExpr(t,e){return t.value}visitNumberLiteralExpr(t,e){return t.value}visitStringLiteralExpr(t,e){return t.value}visitObjectLiteralExpr(t,e){return t.value}visitHasAttributeExpr(t,e){return void 0!==e.env.lookup(t.name)}visitMatchExpr(t,e){const r=e.evaluate(t.value);for(const[i,n]of t.branches){if(Array.isArray(i)&&i.includes(r))return e.evaluate(n);if(i===r)return e.evaluate(n)}return e.evaluate(t.fallback)}visitCaseExpr(t,e){if(e.scope===u.ExprScope.Value){const r=t.branches.findIndex((([t,e])=>t.isDynamic()));if(-1!==r){let i;for(let n=0;n<t.branches.length;++n){const[s,o]=t.branches[n],a=e.evaluate(s),l=e.evaluate(o);if(n<r&&Boolean(a))return l;if((u.Expr.isExpr(a)||Boolean(a))&&(void 0===i&&(i=[]),null==i||i.push([e.wrapValue(a),e.wrapValue(l)]),!u.Expr.isExpr(a)&&Boolean(a)))return new u.CaseExpr(i,u.LiteralExpr.fromValue(null))}const n=e.evaluate(t.fallback);return void 0===i?n:new u.CaseExpr(i,e.wrapValue(n))}}for(const[r,i]of t.branches)if(e.evaluate(r))return e.evaluate(i);return e.evaluate(t.fallback)}visitCallExpr(t,e){var r;const i=null!==(r=t.descriptor)&&void 0!==r?r:E.get(t.op);if(i){let r;if(t.descriptor=i,e.scope===u.ExprScope.Value&&t.isDynamic()){if(t.descriptor.partialEvaluate)return t.descriptor.partialEvaluate(e,t);const i=t.args.map((t=>e.wrapValue(e.evaluate(t),t.id)));if(i.every(((e,r)=>e===t.args[r])))return t;r=new u.CallExpr(t.op,i)}else r=i.call(e,t);return r}throw new Error(`undefined operator '${t.op}'`)}visitLookupExpr(t,e){return this.visitCallExpr(t,e)}visitStepExpr(t,e){if(e.scope===u.ExprScope.Value){const r=e.evaluate(t.input),i=e.evaluate(t.defaultValue);return new u.StepExpr(e.wrapValue(r),e.wrapValue(i),t.stops.map((([t,r])=>{const i=e.evaluate(r);return[t,e.wrapValue(i)]})))}{const r=e.evaluate(t.input);if(\"number\"!=typeof r)throw new Error(`input '${r}' must be a number`);if(r<t.stops[0][0])return e.evaluate(t.defaultValue);let i=t.stops.findIndex((t=>t[0]>r));return-1===i&&(i=t.stops.length),e.evaluate(t.stops[i-1][1])}}visitInterpolateExpr(t,e){if(e.scope===u.ExprScope.Value){const r=e.evaluate(t.input);return new u.InterpolateExpr(t.mode,e.wrapValue(r),t.stops.map((([t,r])=>{const i=e.evaluate(r);return[t,e.wrapValue(i)]})))}{const r=e.evaluate(t.input);if(\"number\"!=typeof r)throw new Error(\"input must be a number\");if(\"cubic\"===t.mode[0])return function(t,e,r){if(r<e.stops[0][0])return T(t,e.stops[0][1]);if(r>=e.stops[e.stops.length-1][0])return T(t,e.stops[e.stops.length-1][1]);const u=e.stops.findIndex((t=>t[0]>r)),l=Math.max(0,u-1),h=0===l?u:l-1,c=u<e.stops.length-1?u+1:u-1,d=e.stops[h][0],p=e.stops[l][0],f=e.stops[u][0],m=.5*(f-p),y=m/(p-d),g=m/(e.stops[c][0]-f),x=(r-p)/(f-p),v=x*x,b=v*x,w=-y*b+2*y*v-y*x,E=(1+y)*b+(-1.5-2*y)*v+(-.5+y)*x+1,S=(-1-g)*b+(1.5+g)*v+.5*x,A=g*b-g*v,z=T(t,e.stops[h][1]),P=T(t,e.stops[l][1]),L=T(t,e.stops[u][1]),O=T(t,e.stops[c][1]);if(\"number\"==typeof z&&\"number\"==typeof P&&\"number\"==typeof L&&\"number\"==typeof O)return w*z+E*P+S*L+A*O;if(z instanceof M.RGBA&&P instanceof M.RGBA&&L instanceof M.RGBA&&O instanceof M.RGBA)return new M.RGBA((0,n.clamp)(w*z.r+E*P.r+S*L.r+A*O.r,0,1),(0,n.clamp)(w*z.g+E*P.g+S*L.g+A*O.g,0,1),(0,n.clamp)(w*z.b+E*P.b+S*L.b+A*O.b,0,1),(0,n.clamp)(w*z.a+E*P.a+S*L.a+A*O.a,0,1));if(z instanceof _.Pixels&&P instanceof _.Pixels&&L instanceof _.Pixels&&O instanceof _.Pixels)return new _.Pixels(w*z.value+E*P.value+S*L.value+A*O.value);if(z instanceof i.Color&&P instanceof i.Color&&L instanceof i.Color&&O instanceof i.Color)return new i.Color(w*z.r+E*P.r+S*L.r+A*O.r,w*z.g+E*P.g+S*L.g+A*O.g,w*z.b+E*P.b+S*L.b+A*O.b);if(z instanceof s.Vector2&&P instanceof s.Vector2&&L instanceof s.Vector2&&O instanceof s.Vector2)return new s.Vector2(w*z.x+E*P.x+S*L.x+A*O.x,w*z.y+E*P.y+S*L.y+A*O.y);if(z instanceof o.Vector3&&P instanceof o.Vector3&&L instanceof o.Vector3&&O instanceof o.Vector3)return new o.Vector3(w*z.x+E*P.x+S*L.x+A*O.x,w*z.y+E*P.y+S*L.y+A*O.y,w*z.z+E*P.z+S*L.z+A*O.z);if(z instanceof a.Vector4&&P instanceof a.Vector4&&L instanceof a.Vector4&&O instanceof a.Vector4)return new a.Vector4(w*z.x+E*P.x+S*L.x+A*O.x,w*z.y+E*P.y+S*L.y+A*O.y,w*z.z+E*P.z+S*L.z+A*O.z,w*z.w+E*P.w+S*L.w+A*O.w);if(Array.isArray(z)&&Array.isArray(P)&&Array.isArray(L)&&Array.isArray(O)){const t=z.length,e=[];for(let r=0;r<t;++r)e[r]=w*z[r]+E*P[r]+S*L[r]+A*O[r];return e}throw new Error(\"failed to interpolate values\")}(e,t,r);const u=t.stops.findIndex((t=>t[0]>r));if(-1===u)return e.evaluate(t.stops[t.stops.length-1][1]);if(0===u)return e.evaluate(t.stops[0][1]);const[l,h]=t.stops[u],[c,d]=t.stops[u-1],p=T(e,d);let f=0;switch(t.mode[0]){case\"discrete\":return p;case\"linear\":f=(r-c)/(l-c);break;case\"exponential\":{const e=t.mode[1];f=1===e?(r-c)/(l-c):(Math.pow(e,r-c)-1)/(Math.pow(e,l-c)-1);break}default:throw new Error(`interpolation mode ${JSON.stringify(t.mode)} is not supported`)}const m=T(e,h);if(\"number\"==typeof p&&\"number\"==typeof m)return(0,n.lerp)(p,m,f);if(p instanceof M.RGBA&&m instanceof M.RGBA)return p.clone().lerp(m,f);if(p instanceof _.Pixels&&m instanceof _.Pixels)return new _.Pixels((0,n.lerp)(p.value,m.value,f));if(p instanceof i.Color&&m instanceof i.Color)return p.clone().lerp(m,f);if(p instanceof s.Vector2&&m instanceof s.Vector2)return p.clone().lerp(m,f);if(p instanceof o.Vector3&&m instanceof o.Vector3)return p.clone().lerp(m,f);if(p instanceof a.Vector4&&m instanceof a.Vector4)return p.clone().lerp(m,f);if(Array.isArray(p)&&Array.isArray(m)&&p.length===m.length)return p.map(((t,e)=>(0,n.lerp)(t,m[e],f)));throw new Error(`todo: mix(${JSON.stringify(p)}, ${JSON.stringify(m)}, ${f})`)}}}e.ExprEvaluator=S,S.defineOperators(h.CastOperators),S.defineOperators(d.ComparisonOperators),S.defineOperators(y.MathOperators),S.defineOperators(v.StringOperators),S.defineOperators(c.ColorOperators),S.defineOperators(b.TypeOperators),S.defineOperators(g.MiscOperators),S.defineOperators(f.FlowOperators),S.defineOperators(l.ArrayOperators),S.defineOperators(x.ObjectOperators),S.defineOperators(p.FeatureOperators),S.defineOperators(m.MapOperators),S.defineOperators(w.VectorOperators)},908:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ExprInstantiator=void 0;const i=r(7259),n=r(8023),s=new i.Env;e.ExprInstantiator=class{visitNullLiteralExpr(t,e){return t}visitBooleanLiteralExpr(t,e){return t}visitNumberLiteralExpr(t,e){return t}visitStringLiteralExpr(t,e){return t}visitObjectLiteralExpr(t,e){return t}visitVarExpr(t,e){if(e.preserve&&e.preserve.has(t.name))return t;const r=e.env.lookup(t.name);return n.LiteralExpr.fromValue(void 0!==r?r:null)}visitHasAttributeExpr(t,e){if(e.preserve&&e.preserve.has(t.name))return t;const r=void 0!==e.env.lookup(t.name);return n.LiteralExpr.fromValue(r)}visitCallExprImpl(t,e,r){const i=t.args.map((t=>t.accept(this,e)));return i.some(((e,r)=>e!==t.args[r]))?r(t.op,i):t}visitCallExpr(t,e){return this.visitCallExprImpl(t,e,((t,e)=>new n.CallExpr(t,e)))}visitLookupExpr(t,e){return this.visitCallExprImpl(t,e,((t,e)=>new n.LookupExpr(e)))}visitMatchExpr(t,e){const r=t.value.accept(this,e);if(r instanceof n.LiteralExpr){const i=r.value;for(const[r,n]of t.branches){if(Array.isArray(r)&&r.includes(i))return n.accept(this,e);if(r===i)return n.accept(this,e)}return t.fallback.accept(this,e)}let i=t.value!==r;const s=t.branches.map((([t,r])=>{const n=r.accept(this,e);return n!==r&&(i=!0),[t,n]})),o=t.fallback.accept(this,e);return o!==t.fallback&&(i=!0),i?new n.MatchExpr(r,s,o):t}visitCaseExpr(t,e){const r=[];let i=!1;for(const[o,a]of t.branches){const t=o.accept(this,e),u=t.dependencies();if(o.isDynamic()||0!==u.properties.size)t!==o&&(i=!0),r.push([t,a]);else if(Boolean(t.evaluate(s,n.ExprScope.Condition)))return a.accept(this,e)}if(0===r.length)return t.fallback.accept(this,e);r.length!==t.branches.length&&(i=!0),r.forEach((t=>{const r=t[1].accept(this,e);r!==t[1]&&(i=!0),t[1]=r}));const o=t.fallback.accept(this,e);return o!==t.fallback&&(i=!0),i?new n.CaseExpr(r,o):t}visitStepExpr(t,e){const r=t.input.accept(this,e),i=t.defaultValue.accept(this,e),s=t.stops.map((([t,r])=>[t,r.accept(this,e)]));return new n.StepExpr(r,i,s)}visitInterpolateExpr(t,e){const r=t.input.accept(this,e),i=t.stops.map((([t,r])=>[t,r.accept(this,e)]));return new n.InterpolateExpr(t.mode,r,i)}}},8797:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ExprPool=e.INTERNED=void 0;const i=r(797),n=r(8023);var s;!function(t){t[t.CALL=0]=\"CALL\",t[t.LOOKUP=1]=\"LOOKUP\"}(s||(s={})),e.INTERNED=Symbol(\"i\");const o=(t,e=!1)=>{var r,i,n,s;let a;return a=t instanceof Object?Array.isArray(t)?o(null!==(r=t[1])&&void 0!==r?r:t[0],e):null!==(s=null!==(n=null===(i=null==t?void 0:t.getPoolKey)||void 0===i?void 0:i.call(t,e))&&void 0!==n?n:null==t?void 0:t.constructor.name.substring(0,3))&&void 0!==s?s:\"?\":\"number\"==typeof t?t:String(t).substring(0,3),a};e.ExprPool=class{constructor(){this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiteralsByID=new Map,this.m_objectLiterals=[],this.m_arrayLiterals=[],this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_matchExprs=[],this.m_caseExprs=new Map,this.m_interpolateExprs=new Map,this.m_stepExprs=[],this.m_callExprs=new Map,this.m_arrays=new Map,this.m_objects=new Map}add(t){return t.accept(this,void 0)}clear(){this.m_numberLiterals.clear(),this.m_stringLiterals.clear(),this.m_objectLiteralsByID.clear(),this.m_objectLiterals.length=0,this.m_arrayLiterals.length=0,this.m_varExprs.clear(),this.m_hasAttributeExprs.clear(),this.m_matchExprs.length=0,this.m_caseExprs.clear(),this.m_interpolateExprs.clear(),this.m_stepExprs.length=0,this.m_callExprs.clear(),this.m_arrays.clear(),this.m_objects.clear()}stats(){const t=new Map;t.set(\"m_numberLiterals\",this.m_numberLiterals.size),t.set(\"m_stringLiterals\",this.m_stringLiterals.size),t.set(\"m_objectLiteralsByID\",this.m_objectLiteralsByID.size),t.set(\"m_objectLiterals\",this.m_objectLiterals.length),t.set(\"m_arrayLiterals\",this.m_arrayLiterals.length),t.set(\"m_varExprs\",this.m_varExprs.size),t.set(\"m_hasAttributeExprs\",this.m_varExprs.size),t.set(\"m_matchExprs\",this.m_matchExprs.length),t.set(\"m_caseExprs\",Array.from(this.m_caseExprs).reduce(((t,e)=>Array.from(e[1]).reduce(((t,e)=>t+e[1].length),t)),0)),t.set(\"m_interpolateExprs\",Array.from(this.m_interpolateExprs).reduce(((t,e)=>t+e[1].length),0)),t.set(\"m_stepExprs\",this.m_stepExprs.length),t.set(\"m_callExprs\",Array.from(this.m_callExprs).reduce(((t,e)=>Array.from(e[1]).reduce(((t,e)=>t+e[1].length),t)),0)),t.set(\"m_arrays\",Array.from(this.m_arrays).reduce(((t,e)=>Array.from(e[1]).reduce(((t,e)=>Array.from(e[1]).reduce(((t,e)=>t+e[1].length),t)),t)),0)),t.set(\"m_objects\",Array.from(this.m_objects).reduce(((t,e)=>Array.from(e[1]).reduce(((t,e)=>Array.from(e[1]).reduce(((t,e)=>t+e[1].length),t)),t)),0)),t.set(\"TOTAL interned\",Array.from(t).reduce(((t,e)=>t+e[1]),0)),console.dir(t)}internValue(t,r){if(null==t?void 0:t[e.INTERNED])return t;let i;return i=Array.isArray(t)?this.internArray(t,r):t instanceof n.Expr?t.accept(this,r):null!==t&&t instanceof Object?this.internObject(t):t,i}internArray(t,r){if(t[e.INTERNED])return t;const i=this.m_arrays;let n=t.length,s=i.get(n);s||i.set(n,s=new Map);let a=o(t[0]),u=s.get(a);u||s.set(a,u=new Map);const l=a;a=n<2?o(t[0],!0):o(t[1]),a===l&&(a=o(t[0],!0));let h=u.get(a);h||u.set(a,h=[]);let c=0;for(const e of t)t[c++]=this.internValue(e);for(const e of h){for(c=n;c--&&e[c]===t[c];);if(c<0)return e}return h.push(t),t[e.INTERNED]=!0,t}internObject(t,r){var i,n;if(t[e.INTERNED])return t;const s=this.m_objects,o=Object.keys(t);let a=o.length,u=s.get(a);u||s.set(a,u=new Map),a=o[0];let l=u.get(a);l||u.set(a,l=new Map);let h=t[a];if(h instanceof Object)for(const t in h){h=h[t];break}a=h instanceof Object?null!==(n=null===(i=null==h?void 0:h.getPoolKey)||void 0===i?void 0:i.call(h))&&void 0!==n?n:h.constructor.name:h;let c=l.get(a);c||l.set(a,c=[]);for(const e of o)t[e]=this.internValue(t[e]);for(const e of c){let r=0;for(const i of o){if(e[i]!==t[i])break;r++}if(r===a)return e}return c.push(t),t[e.INTERNED]=!0,t}visitNullLiteralExpr(t,e){return n.NullLiteralExpr.instance}visitBooleanLiteralExpr(t,e){return t.value?n.BooleanLiteralExpr.trueInstance:n.BooleanLiteralExpr.falseInstance}visitNumberLiteralExpr(t,e){var r;const i=this.m_numberLiterals,n=t.value;return null!==(r=i.get(n))&&void 0!==r?r:(i.set(n,t),t)}visitStringLiteralExpr(t,e){var r;const i=this.m_stringLiterals,n=t.value;return null!==(r=i.get(n))&&void 0!==r?r:(i.set(n,t),t)}visitObjectLiteralExpr(t,e){let r;const s=t.id;if(void 0!==s){if(r=this.m_objectLiteralsByID.get(s),!r){const e=this.internValue(t.value);r=new n.ObjectLiteralExpr(e,s),this.m_objectLiteralsByID.set(s,r)}}else{(0,i.assert)(!1,\"ObjectLiteralExpr without id\");const e=t.isArrayLiteral?this.m_arrayLiterals:this.m_objectLiterals;if(e.includes(t))r=t;else{const i=this.internValue(t.value);for(const t of e)if(t.value===i){r=t;break}r||(r=new n.ObjectLiteralExpr(i),e.push(r))}}return r}visitVarExpr(t,e){var r;const i=this.m_varExprs,n=t.name;return null!==(r=i.get(n))&&void 0!==r?r:(i.set(n,t),t)}visitHasAttributeExpr(t,e){var r;const i=this.m_hasAttributeExprs,n=t.name;return null!==(r=i.get(n))&&void 0!==r?r:(i.set(n,t),t)}visitMatchExpr(t,e){const r=this.m_matchExprs;if(r.includes(t))return t;const i=t.value.accept(this,e),s=this.internArray(t.branches,e),o=t.fallback.accept(this,e);for(const t of r)if(t.value===i&&t.branches===s&&t.fallback===o)return t;const a=new n.MatchExpr(i,s,o);return r.push(a),a}visitCaseExpr(t,e){const r=this.m_caseExprs;let i=t.branches.length,s=r.get(i);s||r.set(i,s=new Map),i=t.branches[0][0].getPoolKey();let o=s.get(i);if(o){if(o.includes(t))return t}else s.set(i,o=[]);const a=this.internArray(t.branches),u=t.fallback.accept(this,e);for(const t of o)if(t.branches===a&&t.fallback===u)return t;const l=new n.CaseExpr(a,u);return o.push(l),l}visitCallExprImpl(t,e,r){if(t.isCached)return t;const i=this.m_callExprs;let a=t.op,u=i.get(a);u||i.set(a,u=new Map),a=o(t.args[0]);let l=u.get(a);l||u.set(a,l=[]);const h=this.internArray(t.args);for(const t of l)if(t.args===h)return t;const c=r===s.CALL?new n.CallExpr(t.op,h):new n.LookupExpr(h);return t.descriptor&&(c.descriptor=t.descriptor),l.push(c),c}visitCallExpr(t,e){return this.visitCallExprImpl(t,e,s.CALL)}visitLookupExpr(t,e){return this.visitCallExprImpl(t,e,s.LOOKUP)}visitStepExpr(t,e){const r=this.m_stepExprs;if(r.includes(t))return t;const i=t.input.accept(this,e),s=t.defaultValue.accept(this,e),o=this.internArray(t.stops);for(const t of r)if(t.input===i&&t.defaultValue===s&&t.stops===o)return t;const a=new n.StepExpr(i,s,o);return r.push(a),a}visitInterpolateExpr(t,e){const r=this.m_interpolateExprs,i=t.stops.length*(t.stops[0][0]+3);let s=r.get(i);if(s){if(s.includes(t))return t}else r.set(i,s=[]);const o=this.internArray(t.mode),a=t.input.accept(this,e),u=this.internArray(t.stops);for(const t of s)if(t.mode===o&&t.input===a&&t.stops===u)return t;const l=new n.InterpolateExpr(o,a,u);return s.push(l),l}}},8628:(t,e)=>{\"use strict\";var r;Object.defineProperty(e,\"__esModule\",{value:!0}),e.interpolatedPropertyDefinitionToJsonExpr=e.isInterpolatedPropertyDefinition=e.InterpolationMode=void 0,(r=e.InterpolationMode||(e.InterpolationMode={}))[r.Discrete=0]=\"Discrete\",r[r.Linear=1]=\"Linear\",r[r.Cubic=2]=\"Cubic\",r[r.Exponential=3]=\"Exponential\",e.isInterpolatedPropertyDefinition=function(t){return!!(t&&void 0===t.interpolationMode&&Array.isArray(t.values)&&t.values.length>0&&void 0!==t.values[0]&&Array.isArray(t.zoomLevels)&&t.zoomLevels.length>0&&void 0!==t.zoomLevels[0]&&t.values.length===t.zoomLevels.length)},e.interpolatedPropertyDefinitionToJsonExpr=function(t){if(void 0===t.interpolation||\"Discrete\"===t.interpolation){const e=[\"step\",[\"zoom\"],t.values[0]];for(let r=1;r<t.zoomLevels.length;++r)e.push(t.zoomLevels[r],t.values[r]);return e}const e=[\"interpolate\"];switch(t.interpolation){case\"Linear\":e.push([\"linear\"]);break;case\"Cubic\":e.push([\"cubic\"]);break;case\"Exponential\":e.push([\"exponential\",void 0!==t.exponent?t.exponent:2]);break;default:throw new Error(`interpolation mode '${t.interpolation}' is not supported`)}e.push([\"zoom\"]);for(let r=0;r<t.zoomLevels.length;++r)e.push(t.zoomLevels[r],t.values[r]);return e}},1017:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isJsonExpr=void 0,e.isJsonExpr=function(t){return Array.isArray(t)&&t.length>0&&\"string\"==typeof t[0]}},1324:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.Pixels=void 0;const r=/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))px$/;class i{static parse(t){const e=r.exec(t);if(null!==e)return new i(Number(e[1]))}constructor(t){this.value=t}toJSON(){return`${this.value}px`}}e.Pixels=i},7610:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.RGBA=void 0;const i=r(3334),n=r(6577),s=r(1667),o=r(6331);class a{static parse(t){const e=(0,o.parseStringEncodedColor)(t);if(void 0!==e)return s.ColorUtils.getRgbaFromHex(e)}static isRGBA(t){return t instanceof a}constructor(t=1,e=1,r=1,i=1,n=!0){this.r=t,this.g=e,this.b=r,this.a=i,this.isRGBA=n}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}clone(){return new a(this.r,this.g,this.b,this.a)}fromVector(t){return this.r=t.x,this.g=t.y,this.b=t.z,this.a=t.w,this}toVector(t){return t||(t=new n.Vector4),t.set(this.r,this.g,this.b,this.a),t}fromHex(t){return s.ColorUtils.getRgbaFromHex(t,this),this}getHex(){return s.ColorUtils.getHexFromRgba(this.r,this.g,this.b,this.a)}lerp(t,e){return this.r=(0,i.lerp)(this.r,t.r,e),this.g=(0,i.lerp)(this.g,t.g,e),this.b=(0,i.lerp)(this.b,t.b,e),this.a=(0,i.lerp)(this.a,t.a,e),this}toJSON(){return`rgba(${255*this.r|0}, ${255*this.g|0}, ${255*this.b|0}, ${this.a})`}}e.RGBA=a},6331:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.parseStringEncodedColor=e.parseStringEncodedNumeral=e.StringEncodedNumeralFormatMaxSize=e.StringEncodedNumeralFormats=e.StringEncodedColorFormats=e.StringEncodedMetricFormats=e.StringEncodedNumeralType=void 0;const i=r(6925),n=r(797),s=r(1667);var o;!function(t){t[t.Meters=0]=\"Meters\",t[t.Pixels=1]=\"Pixels\",t[t.Hex=2]=\"Hex\"}(o=e.StringEncodedNumeralType||(e.StringEncodedNumeralType={}));const a={type:o.Meters,size:1,regExp:/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))m$/,decoder:(t,e)=>{const r=a.regExp.exec(t);return!!r&&void 0!==(e[0]=Number(r[1]))}},u={type:o.Pixels,size:1,mask:1,regExp:/^((?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))px$/,decoder:(t,e)=>{const r=u.regExp.exec(t);return null!==r&&(e[0]=Number(r[1]),!0)}},l={type:o.Hex,size:4,regExp:/^\\#((?:[0-9A-Fa-f][0-9A-Fa-f]){4}|[0-9A-Fa-f]{4})$/,decoder:(t,e)=>{const r=l.regExp.exec(t);if(null===r)return!1;const i=r[1],s=i.length;return(0,n.assert)(4===s||8===s,\"Matched incorrect hex color format\"),4===s?(e[0]=parseInt(i.charAt(0)+i.charAt(0),16)/255,e[1]=parseInt(i.charAt(1)+i.charAt(1),16)/255,e[2]=parseInt(i.charAt(2)+i.charAt(2),16)/255,e[3]=4===s?parseInt(i.charAt(3)+i.charAt(3),16)/255:1):8===s&&(e[0]=parseInt(i.charAt(0)+i.charAt(1),16)/255,e[1]=parseInt(i.charAt(2)+i.charAt(3),16)/255,e[2]=parseInt(i.charAt(4)+i.charAt(5),16)/255,e[3]=8===s?parseInt(i.charAt(6)+i.charAt(7),16)/255:1),!0}};e.StringEncodedMetricFormats=[a,u];const h=e.StringEncodedMetricFormats.reduce(((t,e)=>Math.max(t,e.size)),0);e.StringEncodedColorFormats=[l];const c=e.StringEncodedColorFormats.reduce(((t,e)=>Math.max(t,e.size)),0);e.StringEncodedNumeralFormats=[...e.StringEncodedMetricFormats,...e.StringEncodedColorFormats],e.StringEncodedNumeralFormatMaxSize=Math.max(c,h);const d=new Array(e.StringEncodedNumeralFormatMaxSize);function p(t,e,r=1){const n=e.find((e=>!!e.decoder(t,d)));if(void 0===n){const e=(0,i.parseCSSColor)(t);return Array.isArray(e)&&!e.some((t=>isNaN(t)))?s.ColorUtils.getHexFromRgba(e[0]/255,e[1]/255,e[2]/255,e[3]):void 0}switch(null==n?void 0:n.type){case o.Pixels:return d[0]*r;case o.Hex:return s.ColorUtils.getHexFromRgba(d[0],d[1],d[2],d[3]);default:return d[0]}}e.parseStringEncodedNumeral=function(t,r=1){return p(t,e.StringEncodedNumeralFormats,r)},e.parseStringEncodedColor=function(t){return p(t,e.StringEncodedColorFormats)}},1370:(t,e)=>{\"use strict\";var r,i,n;Object.defineProperty(e,\"__esModule\",{value:!0}),e.isTextureBuffer=e.PlacementToken=e.transientToPickability=e.Pickability=e.TextureCoordinateType=void 0,(n=e.TextureCoordinateType||(e.TextureCoordinateType={})).TileSpace=\"tile-space\",n.EquirectangularSpace=\"equirectangular-space\",n.FeatureSpace=\"feature-space\",function(t){t.onlyVisible=\"only-visible\",t.transient=\"transient\",t.all=\"all\"}(r=e.Pickability||(e.Pickability={})),e.transientToPickability=function(t){let e=r.onlyVisible;return null!=t&&(e=\"string\"==typeof t?t:!0===t?r.transient:r.onlyVisible),e},(i=e.PlacementToken||(e.PlacementToken={})).TopLeft=\"TL\",i.Top=\"T\",i.TopRight=\"TR\",i.Right=\"R\",i.BottomRight=\"BR\",i.Bottom=\"B\",i.BottomLeft=\"BL\",i.Left=\"L\",i.Center=\"C\",i.NorthWest=\"NW\",i.North=\"N\",i.NorthEast=\"NE\",i.East=\"E\",i.SouthEast=\"SE\",i.South=\"S\",i.SouthWest=\"SW\",i.West=\"W\",e.isTextureBuffer=function(t){return t&&t.buffer&&\"string\"==typeof t.type}},1216:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.setTechniqueRenderOrderOrPriority=e.addBuffersToTransferList=e.textureCoordinateType=e.supportsTextures=e.needsVertexNormals=e.isLabelRejectionLineTechnique=e.isTextTechnique=e.isTerrainTechnique=e.isStandardTechnique=e.isExtrudedPolygonTechnique=e.isPolygonTechnique=e.isStandardExtrudedLineTechnique=e.isBasicExtrudedLineTechnique=e.isExtrudedLineTechnique=e.isSegmentsTechnique=e.isSpecialDashesLineTechnique=e.isRasterTechnique=e.isSolidLineTechnique=e.isLineTechnique=e.isLineMarkerTechnique=e.isIconTextTechnique=e.isSquaresTechnique=e.isCirclesTechnique=e.TRANSPARENCY_PROPERTY_KEYS=e.TEXTURE_PROPERTY_KEYS=void 0;const i=r(1370);function n(t){return\"labeled-icon\"===t.name}function s(t){return\"line-marker\"===t.name}function o(t){return\"solid-line\"===t.name||\"dashed-line\"===t.name}function a(t){return\"extruded-line\"===t.name}function u(t){return a(t)&&\"standard\"===t.shading}function l(t){return\"polygon\"===t.name}function h(t){return\"extruded-polygon\"===t.name}function c(t){return\"standard\"===t.name}function d(t){return\"terrain\"===t.name}function p(t){return\"text\"===t.name}function f(t){return l(t)||c(t)||h(t)||d(t)||o(t)}e.TEXTURE_PROPERTY_KEYS=[\"map\",\"normalMap\",\"displacementMap\",\"roughnessMap\",\"emissiveMap\",\"alphaMap\",\"metalnessMap\",\"bumpMap\",\"dash-image\"],e.TRANSPARENCY_PROPERTY_KEYS=[\"opacity\",\"transparent\"],e.isCirclesTechnique=function(t){return\"circles\"===t.name},e.isSquaresTechnique=function(t){return\"squares\"===t.name},e.isIconTextTechnique=n,e.isLineMarkerTechnique=s,e.isLineTechnique=function(t){return\"line\"===t.name},e.isSolidLineTechnique=o,e.isRasterTechnique=function(t){return\"raster\"===t.name},e.isSpecialDashesLineTechnique=function(t){return(\"solid-line\"===t.name||\"dashed-line\"===t.name)&&void 0!==t.dashes&&\"Square\"!==t.dashes},e.isSegmentsTechnique=function(t){return\"segments\"===t.name},e.isExtrudedLineTechnique=a,e.isBasicExtrudedLineTechnique=function(t){return a(t)&&\"basic\"===t.shading},e.isStandardExtrudedLineTechnique=u,e.isPolygonTechnique=l,e.isExtrudedPolygonTechnique=h,e.isStandardTechnique=c,e.isTerrainTechnique=d,e.isTextTechnique=p,e.isLabelRejectionLineTechnique=function(t){return\"label-rejection-line\"===t.name},e.needsVertexNormals=function(t){return h(t)||l(t)||c(t)||d(t)||u(t)},e.supportsTextures=f,e.textureCoordinateType=function(t){return f(t)?t.textureCoordinateType:void 0},e.addBuffersToTransferList=function(t,r){if(c(t)||h(t)||d(t))for(const n of e.TEXTURE_PROPERTY_KEYS){const e=t[n];(0,i.isTextureBuffer)(e)&&e.buffer instanceof ArrayBuffer&&r.push(e.buffer)}},e.setTechniqueRenderOrderOrPriority=function(t,e,r){if(p(t)||n(t)||s(t)){if(r&&\"string\"==typeof t._category){const e=r.indexOf(t._category);-1!==e&&(t.priority=r.length-e)}}else if(e&&void 0!==t._layer){const r=r=>{const i=null==e?void 0:e.findIndex((e=>e.layer===t._layer&&e.category===r));return void 0!==i&&-1!==i?10*(i+1):void 0};if(\"string\"==typeof t._category){const e=r(t._category);void 0!==e&&(t.renderOrder=e)}}}},5771:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.isConditionalExtendsEntry=e.isDirectionalLight=e.isAmbientLight=e.getStyles=e.isStylesDictionary=e.isJsonExprReference=e.getDefinitionValue=e.isVerboseDefinition=void 0;const i=r(1017);function n(t){return void 0!==(null==t?void 0:t.value)}function s(t){return void 0!==t&&!Array.isArray(t)}e.isVerboseDefinition=n,e.getDefinitionValue=function(t){return n(t)?t.value:t},e.isJsonExprReference=function(t){return Array.isArray(t)&&2===t.length&&\"ref\"===t[0]&&\"string\"==typeof t[1]},e.isStylesDictionary=s,e.getStyles=function(t){return void 0===t?[]:s(t)?function(t){const e=[];for(const r in t)t[r].forEach((t=>{void 0===t.layer&&(t.layer=r),e.push(t)}));return e}(t):t},e.isAmbientLight=function(t){return\"ambient\"===t.type},e.isDirectionalLight=function(t){return\"directional\"===t.type},e.isConditionalExtendsEntry=function(t){return void 0!==t&&(0,i.isJsonExpr)(t.when)&&/^(object|string)$/.test(typeof t.value)}},8131:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ThemeVisitor=void 0;const i=r(1017),n=r(5771);e.ThemeVisitor=class{constructor(t){this.theme=t}visitStyles(t){const e=e=>!(0,i.isJsonExpr)(e)&&!!t(e);if(void 0!==this.theme.styles)for(const t of(0,n.getStyles)(this.theme.styles))if(e(t))return!0;return!1}}},797:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.assert=void 0,e.assert=function(t,e){}},6304:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.getPropertyValue=void 0;const i=r(8023),n=r(1324),s=r(7610),o=r(6331);e.getPropertyValue=function(t,e,r){var a,u,l;if(i.Expr.isExpr(t)){let o=t.evaluate(e,i.ExprScope.Dynamic,r);return\"string\"==typeof o&&(o=null!==(u=null!==(a=s.RGBA.parse(o))&&void 0!==a?a:n.Pixels.parse(o))&&void 0!==u?u:o),o instanceof s.RGBA?o.getHex():o instanceof n.Pixels?o.value*(null!==(l=Number(e.lookup(\"$pixelToMeters\")))&&void 0!==l?l:1):o}if(null==t)return null;if(\"string\"!=typeof t)return t;{const r=e.lookup(\"$pixelToMeters\")||1,i=(0,o.parseStringEncodedNumeral)(t,r);return void 0!==i?i:t}}},6073:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ArrayOperators=void 0;const i=r(8023),n=[\"boolean\",\"number\",\"string\"];function s(t,e){if(!(t instanceof i.StringLiteralExpr&&n.includes(t.value)))throw new Error(`expected \"boolean\", \"number\" or \"string\" instead of '${JSON.stringify(t)}'`);const r=t.value;e.forEach(((t,e)=>{if(typeof t!==r)throw new Error(`expected array element at index ${e} to have type '${r}'`)}))}function o(t,e){const r=t.evaluate(e);if(!Array.isArray(r))throw new Error(`'${r}' is not an array`);return r}const a={array:{call:(t,e)=>{switch(e.args.length){case 0:throw new Error(\"not enough arguments\");case 1:return o(t,e.args[0]);case 2:{const r=o(t,e.args[1]);return s(e.args[0],r),r}case 3:{const r=o(t,e.args[2]);return function(t,e){if(!(t instanceof i.NumberLiteralExpr))throw new Error(\"missing expected number of elements\");const r=t.value;if(e.length!==r)throw new Error(`the array must have ${r} element(s)`)}(e.args[1],r),s(e.args[0],r),r}default:throw new Error(\"too many arguments\")}}},\"make-array\":{call:(t,e)=>{if(0===e.args.length)throw new Error(\"not enough arguments\");return[...e.args.map((e=>t.evaluate(e)))]}},at:{call:(t,e)=>{const r=e.args,i=t.evaluate(r[0]);if(\"number\"!=typeof i)throw new Error(\"expected the index of the element to retrieve\");const n=t.evaluate(r[1]);if(!Array.isArray(n))throw new Error(\"expected an array\");return i>=0&&i<n.length?n[i]:null}},slice:{call:(t,e)=>{if(e.args.length<2)throw new Error(\"not enough arguments\");const r=t.evaluate(e.args[0]);if(\"string\"!=typeof r&&!Array.isArray(r))throw new Error(\"input must be a string or an array\");const i=t.evaluate(e.args[1]);if(\"number\"!=typeof i)throw new Error(\"expected an index\");let n;if(e.args.length>2&&(n=t.evaluate(e.args[2]),\"number\"!=typeof n))throw new Error(\"expected an index\");return r.slice(i,n)}}};e.ArrayOperators=a},7290:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.CastOperators=void 0;const r={\"to-boolean\":{call:(t,e)=>Boolean(t.evaluate(e.args[0]))},\"to-string\":{call:(t,e)=>String(t.evaluate(e.args[0]))},\"to-number\":{call:(t,e)=>{for(const r of e.args){const e=Number(t.evaluate(r));if(!isNaN(e))return e}throw new Error(\"cannot convert the value to a number\")}}};e.CastOperators=r},4672:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ColorOperators=void 0;const i=r(3334),n=r(1667),s=r(7610),o=r(6331),a={alpha:{call:(t,e)=>{let r=t.evaluate(e.args[0]);return\"string\"==typeof r&&(r=(0,o.parseStringEncodedColor)(r)),\"number\"==typeof r?n.ColorUtils.getAlphaFromHex(r):1}},rgba:{call:(t,e)=>{const r=t.evaluate(e.args[0]),s=t.evaluate(e.args[1]),o=t.evaluate(e.args[2]),a=t.evaluate(e.args[3]);if(\"number\"==typeof r&&\"number\"==typeof s&&\"number\"==typeof o&&\"number\"==typeof a&&r>=0&&s>=0&&o>=0&&a>=0&&a<=1)return function(t,e,r,s){return n.ColorUtils.getHexFromRgba((0,i.clamp)(t,0,255)/255,(0,i.clamp)(e,0,255)/255,(0,i.clamp)(r,0,255)/255,(0,i.clamp)(s,0,1))}(r,s,o,a);throw new Error(`unknown color 'rgba(${r},${s},${o},${a})'`)}},rgb:{call:(t,e)=>{const r=t.evaluate(e.args[0]),s=t.evaluate(e.args[1]),o=t.evaluate(e.args[2]);if(\"number\"==typeof r&&\"number\"==typeof s&&\"number\"==typeof o&&r>=0&&s>=0&&o>=0)return function(t,e,r){return n.ColorUtils.getHexFromRgb((0,i.clamp)(t,0,255)/255,(0,i.clamp)(e,0,255)/255,(0,i.clamp)(r,0,255)/255)}(r,s,o);throw new Error(`unknown color 'rgb(${r},${s},${o})'`)}},hsl:{call:(t,e)=>{const r=t.evaluate(e.args[0]),s=t.evaluate(e.args[1]),o=t.evaluate(e.args[2]);if(\"number\"==typeof r&&\"number\"==typeof s&&\"number\"==typeof o&&r>=0&&s>=0&&o>=0)return function(t,e,r){return n.ColorUtils.getHexFromHsl((0,i.euclideanModulo)(t,360)/360,(0,i.clamp)(e,0,100)/100,(0,i.clamp)(r,0,100)/100)}(r,s,o);throw new Error(`unknown color 'hsl(${r},${s}%,${o}%)'`)}},\"to-color\":{call:(t,e)=>h(t.evaluate(e.args[0]))},darken:{call:(t,e)=>{const r=h(t.evaluate(e.args[0])),i=t.evaluate(e.args[1]);if(Number(i)!==i)throw new Error(`invalid darken amount '${i}'`);return n.ColorUtils.darken(r.clone(),i)}},\"scale-color\":{call:(t,e)=>{const r=e.args,i=r.length,s=h(t.evaluate(r[0]));u.h=u.s=u.l=u.a=0;for(let e=1;e<i;){const i=t.evaluate(r[e++]);if(!l.test(i))throw new Error(`invalid component \"${i}\"`);const n=t.evaluate(r[e++]);if(n!==Number(n))throw new Error(`invalid factor \"${n}\"`);u[i]=n}return n.ColorUtils.scaleColor(s.clone(),u)}}},u={h:0,s:0,l:0,a:0},l=/^[sla]$/;function h(t){const e=t;return s.RGBA.isRGBA(t)?t:(null==e?void 0:e.isRGBA)?new s.RGBA(e.r,e.g,e.b,e.a):n.ColorUtils.getRgbaFromHex(function(t){if(\"string\"==typeof t){const e=(0,o.parseStringEncodedColor)(t);if(void 0!==e)return e}throw new Error(`unknown color '${t}'`)}(t))}e.ColorOperators=a},8998:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ComparisonOperators=void 0;const i=r(1667),n=r(8023);function s(t,e,r=!1){const i=t.evaluate(e.args[0]),n=t.evaluate(e.args[1]),s=typeof i;if((\"number\"!==s&&\"string\"!==s||s!==typeof n)&&r)throw new Error(`invalid operands '${i}' and '${n}' for operator '${e.op}'`);switch(e.op){case\"<\":return i<n;case\">\":return i>n;case\"<=\":return i<=n;case\">=\":return i>=n;default:throw new Error(`invalid comparison operator '${e.op}'`)}}function o(t,e,r=!1){if(\"number\"!=typeof t||isNaN(t)){if(r)throw new Error(`invalid operand '${t}' for operator '${e}'`);return NaN}return t}const a={\"!\":{call:(t,e)=>!t.evaluate(e.args[0])},\"==\":{call:(t,e)=>{var r;const n=t.evaluate(e.args[0]),s=t.evaluate(e.args[1]);return null!==(r=i.ColorUtils.comparePotentiallyRGBA(n,s,!0))&&void 0!==r?r:n===s}},\"!=\":{call:(t,e)=>{var r;const n=t.evaluate(e.args[0]),s=t.evaluate(e.args[1]);return null!==(r=i.ColorUtils.comparePotentiallyRGBA(n,s,!1))&&void 0!==r?r:n!==s}},\"<\":{call:(t,e)=>s(t,e)},\">\":{call:(t,e)=>s(t,e)},\"<=\":{call:(t,e)=>s(t,e)},\">=\":{call:(t,e)=>s(t,e)},\"inside-range\":{call:(t,e)=>{const r=e.args;let i,s,a,u,l;r[1]instanceof n.ObjectLiteralExpr&&r[1].isArrayLiteral?(i=r[1].value,a=2,s=0,u=0,l=!0):(i=r,a=3,s=1,u=1,l=!1);let h=i.length,c=!1;if(h>=a&&h%2===u){const n=o(t.evaluate(r[0]),e.op);for(isNaN(n)&&(c=null);!1===c&&h>s;){const r=o(l?i[--h]:t.evaluate(i[--h]),e.op),s=o(l?i[--h]:t.evaluate(i[--h]),e.op);c=isNaN(s)||isNaN(r)?null:n>=s&&n<r}}else c=null;return c}}};e.ComparisonOperators=a},1954:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.FeatureOperators=void 0;const i=r(7259),n=r(8023),s={\"geometry-type\":{call:(t,e)=>{switch(t.env.lookup(\"$geometryType\")){case\"point\":return\"Point\";case\"line\":return\"LineString\";case\"polygon\":return\"Polygon\";default:return null}}},\"feature-state\":{isDynamicOperator:()=>!0,call:(t,e)=>{var r,s;if(t.scope!==n.ExprScope.Dynamic)throw new Error(\"feature-state cannot be used in this context\");const o=t.evaluate(e.args[0]);if(\"string\"!=typeof o)throw new Error(\"expected the name of the property of the feature state\");const a=t.env.lookup(\"$state\");return i.Env.isEnv(a)?null!==(r=a.lookup(o))&&void 0!==r?r:null:a instanceof Map&&null!==(s=a.get(o))&&void 0!==s?s:null}},id:{call:(t,e)=>{var r;return null!==(r=t.env.lookup(\"$id\"))&&void 0!==r?r:null}}};e.FeatureOperators=s},2181:(t,e)=>{\"use strict\";function r(t,e,r){switch(e){case\"boolean\":case\"number\":case\"string\":for(const i of r){const r=t.evaluate(i);if(typeof r===e)return r}throw new Error(`expected a '${e}'`);default:throw new Error(`invalid type '${e}'`)}}Object.defineProperty(e,\"__esModule\",{value:!0}),e.FlowOperators=void 0;const i={all:{call:(t,e)=>{for(const r of e.args)if(!t.evaluate(r))return!1;return!0}},any:{call:(t,e)=>{for(const r of e.args)if(t.evaluate(r))return!0;return!1}},none:{call:(t,e)=>{for(const r of e.args)if(t.evaluate(r))return!1;return!0}},boolean:{call:(t,e)=>r(t,\"boolean\",e.args)},number:{call:(t,e)=>r(t,\"number\",e.args)},string:{call:(t,e)=>r(t,\"string\",e.args)}};e.FlowOperators=i},202:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.MapOperators=void 0;const i=r(8023),n={\"ppi-scale\":{call:(t,e)=>t.evaluate(e.args[0])*(e.args[1]?t.evaluate(e.args[1]):1)},\"world-ppi-scale\":{isDynamicOperator:()=>!0,call:(t,e)=>{const r=t.evaluate(e.args[0]),i=e.args[1]?t.evaluate(e.args[1]):1,n=t.env.lookup(\"$zoom\");return r*(Math.pow(2,17)/Math.pow(2,n))*i}},\"world-discrete-ppi-scale\":{isDynamicOperator:()=>!0,call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.env.lookup(\"$zoom\");return r*(40075016.68557849/(256*Math.pow(2,Math.floor(i))))}},\"pixel-world-scale\":{isDynamicOperator:()=>!0,call:(t,e)=>t.evaluate(e.args[0])*(t.env.lookup(\"$pixelToMeters\")||1)},ppi:{call:t=>{const e=t.env.lookup(\"$ppi\");return\"number\"==typeof e?e:72}},zoom:{isDynamicOperator:()=>!0,call:(t,e)=>{var r;return t.scope===i.ExprScope.Value?e:null!==(r=t.env.lookup(\"$zoom\"))&&void 0!==r?r:null}}};e.MapOperators=n},4054:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.MathOperators=void 0;const i=r(3334),n=r(5448),s=r(6815),o=r(6577),a={\"^\":{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);if(\"number\"!=typeof r||\"number\"!=typeof i)throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '^'`);return Math.pow(r,i)}},\"-\":{call:(t,e)=>{if(1===e.args.length){const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`ìnvalid operand '${typeof r} for operator '-'`);return-r}const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);if(\"number\"!=typeof r||\"number\"!=typeof i)throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '-'`);return r-i}},\"/\":{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);if(\"number\"!=typeof r||\"number\"!=typeof i)throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '/'`);return r/i}},\"%\":{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);if(\"number\"!=typeof r||\"number\"!=typeof i)throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '%'`);return r%i}},\"+\":{call:(t,e)=>e.args.reduce(((e,r)=>Number(e)+Number(t.evaluate(r))),0)},\"*\":{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]),a=\"number\"==typeof r,u=\"number\"==typeof i;let l;if(a&&u)l=r*i;else if(u&&(r instanceof n.Vector2||r instanceof s.Vector3||r instanceof o.Vector4))l=r.clone().multiplyScalar(i);else{if(!a||!(i instanceof n.Vector2||i instanceof s.Vector3||i instanceof o.Vector4))throw new Error(`invalid operands '${typeof r}' and '${typeof i}' for operator '*'`);l=i.clone().multiplyScalar(r)}return l}},abs:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'abs'`);return Math.abs(r)}},acos:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'acos'`);return Math.acos(r)}},asin:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'asin'`);return Math.asin(r)}},atan:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'atan'`);return Math.atan(r)}},ceil:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ceil'`);return Math.ceil(r)}},cos:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'cos'`);return Math.cos(r)}},e:{call:()=>Math.E},floor:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'floor'`);return Math.floor(r)}},ln:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ln'`);return Math.log(r)}},ln2:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ln2'`);return Math.log2(r)}},log10:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'log10'`);return Math.log10(r)}},max:{call:(t,e)=>Math.max(...e.args.map((e=>Number(t.evaluate(e)))))},min:{call:(t,e)=>Math.min(...e.args.map((e=>Number(t.evaluate(e)))))},clamp:{call:(t,e)=>{const r=t.evaluate(e.args[0]),n=t.evaluate(e.args[1]),s=t.evaluate(e.args[2]);if(\"number\"!=typeof r||\"number\"!=typeof n||\"number\"!=typeof s)throw new Error(`invalid operands '${r}', ${n}, ${s} for operator 'clamp'`);return(0,i.clamp)(r,n,s)}},pi:{call:()=>Math.PI},round:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'round'`);return Math.round(r)}},sin:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'sin'`);return Math.sin(r)}},sqrt:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'sqrt'`);return Math.sqrt(r)}},tan:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(\"number\"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'tan'`);return Math.tan(r)}}};e.MathOperators=a},9764:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.MiscOperators=void 0;const i=r(797),n=r(8023);function s(t){return t.join(\"&\")}function o(t,e){return t+\"=\"+JSON.stringify(e)}function a(t,e=0){if(e>=t.length)return[];const r=a(t,e+1),i=r.length;for(let n=0;n<i;n+=1)r.push([...r[n],t[e]]);return r.push([t[e]]),r}function u(t,e){const r=t.args.slice(1),i=[];for(let t=0;t<r.length;t+=2){const n=e.evaluate(r[t+1]);if(null===n)continue;const s=e.evaluate(r[t]);i.push(o(s,n))}return i.sort().reverse(),function(t){t.sort(((t,e)=>e.length-t.length));const e=t.map((t=>s(t)));return e.push(\"\"),e}(a(i))}const l={length:{call:(t,e)=>{const r=t.evaluate(e.args[0]);if(Array.isArray(r)||\"string\"==typeof r)return r.length;throw new Error(`invalid operand '${r}' for operator 'length'`)}},coalesce:{call:(t,e)=>{for(const r of e.args){const e=t.evaluate(r);if(null!==e)return e}return null}},lookup:{call:(t,e)=>{(0,i.assert)(e.args.length>0,\"missing lookup table\");const r=u(e,t);let a=t.evaluate(e.args[0]);if((0,i.assert)(Array.isArray(a)||a instanceof Map,\"wrong lookup table type\"),Array.isArray(a)){a=function(t){const e=new Map;for(const r of t){if(\"object\"!=typeof r)throw new Error(`Invalid lookup table entry type (${typeof r})`);if(!r.keys)throw new Error(\"Lookup table entry has no 'keys' property.\");if(!r.attributes)throw new Error(\"Lookup table entry has no 'attributes' property.\");const t=s(Object.getOwnPropertyNames(r.keys).sort().map((t=>o(t,r.keys[t]))));e.set(t,r.attributes)}return e}(a);const t=new n.ObjectLiteralExpr(a,e.args[0].id);e.args[0]=t}return function(t,e){for(const r of t){const t=e.get(r);if(t)return t}return null}(r,a)}},trace:{call:(t,e)=>{const r=[];for(const i of e.args)r.push(t.evaluate(i));return console.error(\"trace: \",...r),r[0]}}};e.MiscOperators=l},7029:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ObjectOperators=void 0;const i=r(7259),n=r(8023),s=Object.prototype.hasOwnProperty;var o;function a(t,e,r){var n;const a=t.evaluate(e[0]);if(\"string\"!=typeof a)throw new Error(\"expected the name of an attribute\");const u=t.evaluate(e[1]);if(u&&\"object\"==typeof u){if(i.Env.isEnv(u)){const t=null!==(n=u.lookup(a))&&void 0!==n?n:null;return r===o.get?t:null!==t}if(s.call(u,a))return r!==o.get||u[a]}return r===o.get&&null}!function(t){t[t.get=0]=\"get\",t[t.has=1]=\"has\"}(o||(o={}));const u={in:{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);return(\"string\"==typeof r&&\"string\"==typeof i||!!Array.isArray(i))&&i.includes(r)}},get:{call:(t,e)=>a(t,e.args,o.get)},has:{call:(t,e)=>a(t,e.args,o.has)},\"dynamic-properties\":{isDynamicOperator:()=>!0,call:(t,e)=>t.scope===n.ExprScope.Dynamic?t.env:e}};e.ObjectOperators=u},3501:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.StringOperators=void 0;const r={concat:{call:(t,e)=>\"\".concat(...e.args.map((e=>String(t.evaluate(e)))))},downcase:{call:(t,e)=>String(t.evaluate(e.args[0])).toLocaleLowerCase()},upcase:{call:(t,e)=>String(t.evaluate(e.args[0])).toLocaleUpperCase()},\"regex-replace\":{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]),n=t.evaluate(e.args[2]);return\"string\"==typeof r&&\"string\"==typeof i&&\"string\"==typeof n?r.replace(new RegExp(i,\"g\"),n):r}},\"~=\":{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);return\"string\"==typeof r&&\"string\"==typeof i&&r.includes(i)}},\"^=\":{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);return\"string\"==typeof r&&\"string\"==typeof i&&r.startsWith(i)}},\"$=\":{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);return\"string\"==typeof r&&\"string\"==typeof i&&r.endsWith(i)}},split:{call:(t,e)=>{const r=t.evaluate(e.args[0]),i=t.evaluate(e.args[1]);if(\"string\"==typeof r&&\"string\"==typeof i)return r.split(i);throw new Error(`expected '${r}' and '${i}' to be a string`)}}};e.StringOperators=r},5113:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.TypeOperators=void 0,e.TypeOperators={typeof:{call:(t,e)=>typeof t.evaluate(e.args[0])}}},545:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.VectorOperators=void 0;const i=r(5448),n=r(6815),s=r(6577),o=r(8023);function a(t,e,r){let o;switch(r){case\"vector2\":o=i.Vector2;break;case\"vector3\":o=n.Vector3;break;case\"vector4\":o=s.Vector4}for(const r of e.args){const e=t.evaluate(r);if(e instanceof o)return e}throw new Error(`expected a \"${r}\"`)}function u(t,e,r){let o,a;switch(r){case\"vector2\":o=i.Vector2,a=2;break;case\"vector3\":o=n.Vector3,a=3;break;case\"vector4\":o=s.Vector4,a=4}for(const r of e.args){const e=t.evaluate(r);if(e instanceof o)return e;if(Array.isArray(e)&&e.length===a&&e.every((t=>\"number\"==typeof t)))return(new o).fromArray(e)}throw new Error(`expected a \"${r}\"`)}const l={\"make-vector\":{call:(t,e)=>{if(void 0!==e._value)return e._value;if(e.args.length<2)throw new Error(\"not enough arguments\");if(e.args.length>4)throw new Error(\"too many arguments\");const r=e.args.map((e=>t.evaluate(e)));let a;switch(r.forEach(((t,e)=>{if(\"number\"!=typeof t)throw new Error(`expected vector component at index ${e} to have type \"number\"`)})),r.length){case 2:a=(new i.Vector2).fromArray(r);break;case 3:a=(new n.Vector3).fromArray(r);break;case 4:a=(new s.Vector4).fromArray(r);break;default:throw new Error(\"too many arguments\")}return e.args.every((t=>t instanceof o.NumberLiteralExpr))&&(e._value=a),a}},vector2:{call:(t,e)=>a(t,e,\"vector2\")},vector3:{call:(t,e)=>a(t,e,\"vector3\")},vector4:{call:(t,e)=>a(t,e,\"vector4\")},\"to-vector2\":{call:(t,e)=>u(t,e,\"vector2\")},\"to-vector3\":{call:(t,e)=>u(t,e,\"vector3\")},\"to-vector4\":{call:(t,e)=>u(t,e,\"vector4\")}};e.VectorOperators=l},6463:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(4992),e),n(r(5337),e),n(r(197),e),n(r(9172),e),n(r(5200),e),n(r(8154),e),n(r(9246),e),n(r(5681),e),n(r(7314),e),n(r(4954),e),n(r(173),e),n(r(34),e),n(r(7250),e),n(r(5177),e),n(r(4713),e),n(r(9276),e),n(r(5704),e),n(r(7427),e),n(r(9206),e)},4342:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(6463),e),n(r(5323),e)},7427:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},5681:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},7314:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ContextLogger=void 0,e.ContextLogger=class{constructor(t,e){this.m_logger=t,this.headerMessage=e,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod(\"warn\"),this.info=this.createLogMethod(\"info\"),this.error=this.createLogMethod(\"error\")}pushAttr(t){this.context.push(`${this.context.length>0?\".\":\"\"}${t}`)}pushIndex(t){this.context.push(`[${t}]`)}pop(){this.context.pop()}createLogMethod(t){return(e,...r)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[t](`${this.context.join(\"\")}: ${e}`,...r)}}}},4992:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.DOMUtils=void 0,function(t){function e(t){return t.substring(0,2)}t.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const t=[];for(const r of navigator.languages)t.push(e(r));return t}if(void 0!==navigator.language)return[e(navigator.language)]}}(e.DOMUtils||(e.DOMUtils={}))},9276:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.chainCallbacks=void 0,e.chainCallbacks=function(t,e){return function(...r){return t&&t.apply(this,r),e.apply(this,r)}}},9206:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.convertFragmentShaderToWebGL2=e.convertVertexShaderToWebGL2=void 0,e.convertVertexShaderToWebGL2=function(t){return[\"#define attribute in\",\"#define varying out\",\"#define texture2D texture\"].join(\"\\n\")+\"\\n\"+t},e.convertFragmentShaderToWebGL2=function(t){return[\"#define varying in\",\"out highp vec4 pc_fragColor;\",\"#define gl_FragColor pc_fragColor\",\"#define gl_FragDepthEXT gl_FragDepth\",\"#define texture2D texture\",\"#define textureCube texture\",\"#define texture2DProj textureProj\",\"#define texture2DLodEXT textureLod\",\"#define texture2DProjLodEXT textureProjLod\",\"#define textureCubeLodEXT textureLod\",\"#define texture2DGradEXT textureGrad\",\"#define texture2DProjGradEXT textureProjGrad\",\"#define textureCubeGradEXT textureGrad\"].join(\"\\n\")+\"\\n\"+t}},5337:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.GroupedPriorityList=e.PriorityListGroup=void 0;class r{constructor(t,e,r=new Array){this.priority=t,this.zOrder=e,this.elements=r}}e.PriorityListGroup=r,e.GroupedPriorityList=class{constructor(){this.groups=new Map}getGroupKey(t){return`${t.priority}_${t.zOrder}`}add(t){this.getGroup(t).elements.push(t)}clear(){this.groups.clear()}forEachElement(t){this.forEachGroup((e=>{e.elements.forEach(t)}))}forEachGroup(t){for(const[,e]of this.groups)t(e)}count(){let t=0;for(const[,e]of this.groups)t+=e.elements.length;return t}findGroup(t){return this.groups.get(t)}getGroup(t){const e=this.getGroupKey(t);let i=this.findGroup(e);return void 0===i&&(i=new r(t.priority,t.zOrder),this.groups.set(e,i)),i}}},4015:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.ConsoleChannel=void 0,e.ConsoleChannel=class{error(t,...e){console.error(t,...e)}debug(t,...e){console.debug(t,...e)}info(t,...e){console.info(t,...e)}log(t,...e){console.log(t,...e)}trace(t,...e){console.trace(t,...e)}warn(t,...e){console.warn(t,...e)}}},3140:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},6781:(t,e)=>{\"use strict\";var r;Object.defineProperty(e,\"__esModule\",{value:!0}),e.LoggerOptions=e.LogLevel=void 0,(r=e.LogLevel||(e.LogLevel={}))[r.Trace=0]=\"Trace\",r[r.Debug=1]=\"Debug\",r[r.Log=2]=\"Log\",r[r.Info=3]=\"Info\",r[r.Warn=4]=\"Warn\",r[r.Error=5]=\"Error\",r[r.None=6]=\"None\",e.LoggerOptions=class{}},8648:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.Logger=void 0;const i=r(6781);e.Logger=class{constructor(t,e,r){this.name=t,this.m_channel=e,this.enabled=!0,this.level=i.LogLevel.Trace,void 0!==r&&this.update(r)}error(t,...e){this.enabled&&this.level<=i.LogLevel.Error&&this.m_channel.error(this.prefix,t,...e)}debug(t,...e){this.enabled&&this.level<=i.LogLevel.Debug&&this.m_channel.debug(this.prefix,t,...e)}info(t,...e){this.enabled&&this.level<=i.LogLevel.Info&&this.m_channel.info(this.prefix,t,...e)}log(t,...e){this.enabled&&this.level<=i.LogLevel.Log&&this.m_channel.log(this.prefix,t,...e)}trace(t,...e){this.enabled&&this.level<=i.LogLevel.Trace&&this.m_channel.trace(this.prefix,t,...e)}warn(t,...e){this.enabled&&this.level<=i.LogLevel.Warn&&this.m_channel.warn(this.prefix,t,...e)}update(t){this.enabled=void 0===t.enabled?this.enabled:t.enabled,this.level=void 0===t.level?this.level:t.level}get prefix(){return this.name+\":\"}}},6562:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.LoggerManager=void 0;const i=r(2531);e.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new i.LoggerManagerImpl)}}},2531:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.LoggerManagerImpl=void 0;const i=r(4015),n=r(8648),s=r(7698);e.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel=\"undefined\"==typeof self||void 0!==self.document?new i.ConsoleChannel:new s.WorkerChannel}getLoggerNames(){return this.m_loggers.map((t=>t.name))}getLogger(t){return this.m_loggers.find((e=>e.name===t))}create(t,e={}){void 0!==this.m_levelSetForAll&&(void 0===e.level||e.level<this.m_levelSetForAll)&&(e.level=this.m_levelSetForAll);const r=new n.Logger(t,this.channel,e);return this.m_loggers.push(r),r}dispose(t){const e=this.m_loggers.indexOf(t);if(e<0)throw new Error(`Cannot unregister \"${t}\" : no such logger registered.`);this.m_loggers.splice(e,1)}updateAll(t){for(const e of this.m_loggers)e.update(t)}update(t,e){for(const r of this.m_loggers)r.name===t&&r.update(e)}enableAll(t){for(const e of this.m_loggers)e.enabled=t}enable(t,e){this.update(t,{enabled:e})}setLogLevelForAll(t){this.m_levelSetForAll=t;for(const e of this.m_loggers)e.level=t}setLogLevel(t,e){this.update(t,{level:e})}setChannel(t){this.channel=t}}},3069:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.MultiChannel=void 0,e.MultiChannel=class{constructor(...t){this.channels=[],this.channels=t}error(t,...e){for(const r of this.channels)r.error(t,...e)}debug(t,...e){for(const r of this.channels)r.debug(t,...e)}info(t,...e){for(const r of this.channels)r.info(t,...e)}log(t,...e){for(const r of this.channels)r.log(t,...e)}trace(t,...e){for(const r of this.channels)r.trace(t,...e)}warn(t,...e){for(const r of this.channels)r.warn(t,...e)}}},7698:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.WorkerChannel=e.WORKERCHANNEL_MSG_TYPE=void 0;const i=r(6781);e.WORKERCHANNEL_MSG_TYPE=\"worker-channel-message\",e.WorkerChannel=class{error(t,...r){const n={message:[t,...r],type:e.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Error};self.postMessage(n)}debug(t,...r){const n={message:[t,...r],type:e.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Debug};self.postMessage(n)}info(t,...r){const n={message:[t,...r],type:e.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Info};self.postMessage(n)}log(t,...r){const n={message:[t,...r],type:e.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Log};self.postMessage(n)}trace(t,...r){const n={message:[t,...r],type:e.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Trace};self.postMessage(n)}warn(t,...r){const n={message:[t,...r],type:e.WORKERCHANNEL_MSG_TYPE,level:i.LogLevel.Warn};self.postMessage(n)}}},197:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(4015),e),n(r(3140),e),n(r(6781),e),n(r(8648),e),n(r(6562),e),n(r(3069),e),n(r(7698),e)},9172:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.Math2D=void 0,function(t){function e(t,e,r,i){return(t-r)*(t-r)+(e-i)*(e-i)}t.Box=class{constructor(t=0,e=0,r=0,i=0){this.x=t,this.y=e,this.w=r,this.h=i}set(t,e,r,i){this.x=t,this.y=e,this.w=r,this.h=i}copy(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h}contains(t,e){return this.x<=t&&this.x+this.w>=t&&this.y<=e&&this.y+this.h>=e}containsBox(t){const e=t.x+t.w,r=t.y+t.h;return this.contains(t.x,t.y)&&this.contains(e,t.y)&&this.contains(t.x,r)&&this.contains(e,r)}intersects(t){return this.x<=t.x+t.w&&this.x+this.w>=t.x&&this.y<=t.y+t.h&&this.y+this.h>=t.y}},t.distSquared=e,t.computeSquaredLineLength=function(t){let e=0;const r=t.length-4;for(let i=0;i<r;i+=3){const r=t[i+3]-t[i],n=t[i+4]-t[i+1];e+=r*r+n*n}return e},t.distToSegmentSquared=function(t,r,i,n,s,o){const a=e(i,n,s,o);if(0===a)return e(t,r,i,n);let u=((t-i)*(s-i)+(r-n)*(o-n))/a;return u=Math.max(0,Math.min(1,u)),e(t,r,i+u*(s-i),n+u*(o-n))},t.intersectLineAndCircle=function(t,e,r,i,n,s=0,o=0){const a=r-t,u=i-e,l=a*a+u*u,h=t*i-r*e-u*s+a*o,c=n*n*l-h*h;if(c<-1e-10)return;const d=h*u,p=-h*a;if(c<1e-10)return{x1:s+d/l,y1:o+p/l};const f=Math.sqrt(c),m=(u<0?-1:1)*a*f,y=Math.abs(u)*f;return{x1:s+(d+m)/l,y1:o+(p+y)/l,x2:s+(d-m)/l,y2:o+(p-y)/l}},t.intersectLines=function(t,e,r,i,n,s,o,a,u={x:0,y:0}){const l=(t-r)*(s-a)-(e-i)*(n-o);if(0===l)return;const h=((t*i-e*r)*(n-o)-(t-r)*(n*a-s*o))/l,c=((t*i-e*r)*(s-a)-(e-i)*(n*a-s*o))/l;return u.x=h,u.y=c,u}}(e.Math2D||(e.Math2D={}))},5200:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.MathUtils=void 0,function(t){function e(t,e,r){return t<e?e:t>r?r:t}t.clamp=e,t.smoothStep=function(t,r,i){return(i=e((i-t)/(r-t),0,1))*i*(3-2*i)},t.smootherStep=function(t,r,i){return(i=e((i-t)/(r-t),0,1))*i*i*(i*(6*i-15)+10)},t.map=function(t,e,r,i,n){return(t-e)*(n-i)/(r-e)+i},t.min2=function(t,e){let r;return void 0!==t&&(r=t),void 0!==e&&(r=void 0===r?e:Math.min(r,e)),r},t.max2=function(t,e){let r;return void 0!==t&&(r=t),void 0!==e&&(r=void 0===r?e:Math.max(r,e)),r},t.isWithinBounds=function(t,e,r){return!(void 0!==e&&t<e||void 0!==r&&t>r)},t.easeInOutCubic=function(t,e,r){return t+(e-t)*(r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1)}}(e.MathUtils||(e.MathUtils={}))},8154:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.applyMixinsWithoutProperties=e.applyMixins=void 0,e.applyMixins=function(t,e){e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((r=>{t.prototype[r]=e.prototype[r]}))}))},e.applyMixinsWithoutProperties=function(t,e){e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((r=>{const i=Object.getOwnPropertyDescriptor(e.prototype,r);void 0!==i&&void 0===i.get&&\"constructor\"!==r&&(t.prototype[r]=e.prototype[r])}))}))}},173:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.pick=e.cloneDeep=void 0,e.cloneDeep=function(t){const e=new Map,r=function t(r){if(null===r)return null;if(\"object\"==typeof r){const i=e.get(r);if(void 0!==i)return i;if(Array.isArray(r)){const i=[];e.set(r,i),i.length=r.length;for(let e=0;e<i.length;++e)i[e]=t(r[e]);return i}if(r instanceof Date){const t=new Date(r.getTime());return e.set(r,t),t}if(r instanceof RegExp){const t=new RegExp(r.source,r.flags);return e.set(r,t),t}if(r.constructor!==Object)throw new Error(\"cloneDeep doesn't support objects with custom prototypes\");{const i={};e.set(r,i);for(const e in r)r.hasOwnProperty(e)&&(i[e]=t(r[e]));return i}}return r}(t);return e.clear(),r},e.pick=function(t,e){const r={};for(const i of e)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}},34:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.getOptionValue=void 0,e.getOptionValue=function(...t){for(const e of t)if(null!=e)return e}},4954:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.PerformanceTimer=void 0;class r{static now(){return r.nowFunc()}static getNowFunc(){return\"undefined\"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}e.PerformanceTimer=r,r.instance=new r,r.nowFunc=r.getNowFunc()},5704:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.sampleBilinear=void 0,e.sampleBilinear=function(t,e,r,i,n){const s=e-1,o=r-1,a=i*s,u=Math.floor(a),l=n*o,h=Math.floor(l),c=h*e+u,d=u<s?c+1:c,p=h<o?c+e:c,f=u<s?p+1:p,m=t[c],y=t[d],g=t[p],x=t[f],v=Number.isInteger(a)?0:a-u,b=1-v,w=Number.isInteger(l)?0:l-h,_=1-w;return m*b*_+y*v*_+g*b*w+x*v*w}},7250:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.TaskQueue=void 0,e.TaskQueue=class{constructor(t){var e;this.m_options=t,this.m_taskLists=new Map,null===(e=this.m_options.groups)||void 0===e||e.forEach((t=>{this.m_taskLists.set(t,[])})),this.m_options.prioSortFn&&(this.sort=this.m_options.prioSortFn)}update(t){if(void 0===t)this.m_taskLists.forEach((t=>{this.updateTaskList(t)}));else{const e=this.getTaskList(t);e&&this.updateTaskList(e)}}add(t){var e;if(this.m_taskLists.has(t.group)){const r=this.m_taskLists.get(t.group);if(!(null==r?void 0:r.includes(t)))return null===(e=this.m_taskLists.get(t.group))||void 0===e||e.push(t),!0}return!1}remove(t){var e,r;if(this.m_taskLists.has(t.group)){const i=null===(e=this.m_taskLists.get(t.group))||void 0===e?void 0:e.indexOf(t);if(-1!==i)return null===(r=this.m_taskLists.get(t.group))||void 0===r||r.splice(i,1),!0}return!1}numItemsLeft(t){var e,r;let i=0;return void 0===t?this.m_taskLists.forEach((t=>{i+=t.length})):i+=null!==(r=null===(e=this.getTaskList(t))||void 0===e?void 0:e.length)&&void 0!==r?r:0,i}processNext(t,e,r=1){if(!this.getTaskList(t)||this.numItemsLeft(t)<=0)return!1;for(let i=0;i<r&&this.numItemsLeft(t)>0;i++){const r=this.pull(t,!0);void 0!==r&&(!e||(null==e?void 0:e(r))?r.execute():this.add(r))}return!0}clear(){this.m_taskLists.clear()}pull(t,e=!1){var r,i;let n;return this.getTaskList(t)&&(n=null===(r=this.getTaskList(t))||void 0===r?void 0:r.pop(),e&&n&&(null===(i=n.isExpired)||void 0===i?void 0:i.call(n)))?this.pull(t,e):n}sort(t,e){return e.getPriority()-t.getPriority()}getTaskList(t){return this.m_taskLists.get(t)}updateTaskList(t){var e;for(let r=0;r<t.length;r++){const i=t[r];(null===(e=null==i?void 0:i.isExpired)||void 0===e?void 0:e.call(i))&&(t.splice(r,1),r--)}t.sort(this.sort)}}},5177:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},5323:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.getAppBaseUrl=void 0;const i=r(4713);e.getAppBaseUrl=function(){return\"undefined\"==typeof window?`file://${process.cwd()}/`:(0,i.baseUrl)(window.location.href)}},4713:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.getUrlHostAndProtocol=e.getUrlOrigin=e.baseUrl=e.resolveReferenceUri=void 0,e.resolveReferenceUri=function(t,e){return r.test(e)?e:e.startsWith(\"/\")?n(t)+e:(e.startsWith(\"./\")&&(e=e.substr(2)),i(t)+e)};const r=new RegExp(\"^(((?:[a-z]+:)?//)|(file:/)|(data:))\",\"i\");function i(t){if(void 0===t)return\"./\";let e=t.indexOf(\"#\");return-1!==e&&(t=t.slice(0,e)),e=t.indexOf(\"?\"),-1!==e&&(t=t.slice(0,e)),e=t.lastIndexOf(\"/\"),-1===e?\"./\":t.substring(0,e+1)}function n(t){if(void 0===t)return\"\";const e=s(t);return\"file:\"===e.protocol?\"file://\":e.host&&e.protocol?e.protocol+\"//\"+e.host:e.host?\"//\"+e.host:e.protocol?e.protocol+\"//\":\"\"}function s(t){const e=new RegExp(/^(?:([a-z]+:))?\\/\\/([^\\/]*)/,\"i\"),r=t.match(e);if(!r)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${t}'`);return{protocol:r[1],host:r[2]}}e.baseUrl=i,e.getUrlOrigin=n,e.getUrlHostAndProtocol=s},9246:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.assertExists=e.assert=void 0,e.assert=function(t,e){},e.assertExists=function(t,e){return t}},952:function(t,e,r){\"use strict\";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!(\"get\"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)\"default\"===r||Object.prototype.hasOwnProperty.call(e,r)||i(e,t,r)};Object.defineProperty(e,\"__esModule\",{value:!0}),n(r(1503),e),n(r(6133),e),n(r(9959),e),n(r(5863),e)},9287:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.computeLineAnchorPoints=e.MAX_SEARCH_DEPTH=void 0;const i=r(6815),n=new i.Vector3,s=new i.Vector3;e.MAX_SEARCH_DEPTH=3,e.computeLineAnchorPoints=function(t,r){if(t.count<2)return(new Float64Array).buffer;const i=function(t){const e=[];let r=0;for(let i=0;i<t.count-1;++i)r+=n.fromBufferAttribute(t,i).distanceTo(s.fromBufferAttribute(t,i+1)),e.push(r);return e}(t);if(i[i.length-1]<=Number.EPSILON)return(new Float64Array).buffer;const o=function(t,r,i){const o=[],a=t[t.length-1],u=Math.min(e.MAX_SEARCH_DEPTH+1,Math.floor(Math.log2(a/r))),l=u>0?Math.pow(2,u):0,h=l+1,c=a/l;let d=0;for(let e=0;e<h;e++){const r=1===h?a/2:e*c;let u=t.length-1;for(;u!==d;){const e=Math.floor((u+d)/2);r>=t[e]?d=e+1:u=e}const l=t[d],p=1-(l-r)/(l-(0===d?0:t[d-1])),f=n.fromBufferAttribute(i,d).lerp(s.fromBufferAttribute(i,d+1),p);o.push(...f.toArray())}return o}(i,r,t);return new Float64Array(o).buffer}},5863:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})},9252:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.DecodeInfo=void 0;const i=r(2754),n=r(6815),s=r(2616);e.DecodeInfo=class{constructor(t,e,r=0){this.targetProjection=t,this.tileKey=e,this.storageLevelOffset=r,this.projectedBoundingBox=new s.OrientedBox3,this.tileBounds=new i.Box3,this.tileSize=new n.Vector3,this.center=new n.Vector3,this.geoBox=this.tilingScheme.getGeoBox(e),this.targetProjection.projectBox(this.geoBox,this.projectedBoundingBox),this.projectedBoundingBox.getCenter(this.center),this.tilingScheme.getWorldBox(e,this.tileBounds),this.tileBounds.getSize(this.tileSize),this.tileSizeOnScreen=256*Math.pow(2,-this.storageLevelOffset),this.columnCount=s.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionX(this.tileKey.level),this.rowCount=s.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionY(this.tileKey.level)}get tilingScheme(){return s.webMercatorTilingScheme}get sourceProjection(){return this.tilingScheme.projection}}},6133:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.GeoJsonTilerService=void 0;const i=r(2626),n=r(9959);e.GeoJsonTilerService=class{static start(){i.WorkerServiceManager.getInstance().register({serviceType:n.GEOJSON_TILER_SERVICE_TYPE,factory:t=>i.TilerService.start(t)})}}},9959:(t,e)=>{\"use strict\";var r;Object.defineProperty(e,\"__esModule\",{value:!0}),e.GEOJSON_TILER_SERVICE_TYPE=e.VECTOR_TILE_DECODER_SERVICE_TYPE=e.OmvGeometryType=void 0,(r=e.OmvGeometryType||(e.OmvGeometryType={}))[r.UNKNOWN=0]=\"UNKNOWN\",r[r.POINT=1]=\"POINT\",r[r.LINESTRING=2]=\"LINESTRING\",r[r.POLYGON=3]=\"POLYGON\",e.VECTOR_TILE_DECODER_SERVICE_TYPE=\"vector-tile-decoder\",e.GEOJSON_TILER_SERVICE_TYPE=\"geojson-tiler\"},7305:(t,e)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.OmvPoliticalViewFeatureModifier=void 0,e.OmvPoliticalViewFeatureModifier=class{constructor(t){this.m_countryCode=t}doProcessPointFeature(t,e,r){return this.processFeature(t,e)}doProcessLineFeature(t,e,r){return this.processFeature(t,e)}doProcessPolygonFeature(t,e,r){return!0}rewriteEnvironment(t,e){this.isPoliticalViewLayer(t)&&this.updateEnvironment(e,this.m_countryCode,\"kind\")}updateEnvironment(t,e,r){const i=this.getAlternativePov(t,e,r);void 0!==i&&(t.entries[r]=i)}getAlternativePov(t,e,r){const i=e,n=t.lookup(`${r}:${i}`);return\"string\"==typeof n&&n.length>0?n:void 0}isPoliticalViewLayer(t){return\"boundaries\"===t||\"places\"===t}processFeature(t,e){let r=!1;if(this.isPoliticalViewLayer(t)){const i=Object.keys(e.unmap()).filter((t=>t.includes(\"kind:\"))).length>0,n=!!e.lookup(`kind:${this.m_countryCode}`),s=!!e.lookup(\"kind\"),o=Boolean(this.m_countryCode);r=!o&&!s&&i||o&&(!s&&i&&!n||s&&n),!r&&o&&n&&this.rewriteEnvironment(t,e)}return!r}}},6441:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.webMercatorTile2TargetTile=e.webMercatorTile2TargetWorld=e.world2tile=e.tile2world=e.createWorldTileTransformationCookie=e.tile2lat=e.lat2tile=e.isArrayBufferLike=void 0;const i=r(6815),n=r(2616);function s(t,e){return Math.round((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e))}function o(t,e){const{north:r,west:i}=e.geoBox,n=Math.log2(t),o=Math.pow(2,e.tileKey.level+n);return{extents:t,scale:o,top:s(r,e.tileKey.level+n),left:Math.round((i+180)/360*o)}}function a(t,e,r,i=!1,s){void 0!==e.worldTileProjectionCookie&&e.worldTileProjectionCookie.extents===t||(e.worldTileProjectionCookie=o(t,e));const{top:a,left:u,scale:l}=e.worldTileProjectionCookie,h=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return s.x=(u+r.x)/l*h,s.y=(a+(i?-r.y:r.y))/l*h,s.z=(0,n.isVector3Like)(r)?r.z:0,s}function u(t,e,r,s,o,u=!1){a(t,e,r,u,s),e.targetProjection.reprojectPoint(n.webMercatorProjection,s,s),r instanceof i.Vector3&&o&&(s.z*=e.targetProjection.getScaleFactor(s))}e.isArrayBufferLike=function(t){return\"undefined\"!=typeof SharedArrayBuffer?t instanceof ArrayBuffer||t instanceof SharedArrayBuffer:t instanceof ArrayBuffer},e.lat2tile=s,e.tile2lat=function(t,e){const r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},e.createWorldTileTransformationCookie=o,e.tile2world=a,e.world2tile=function(t,e,r,i=!1,s){void 0!==e.worldTileProjectionCookie&&e.worldTileProjectionCookie.extents===t||(e.worldTileProjectionCookie=o(t,e));const{top:a,left:u,scale:l}=e.worldTileProjectionCookie,h=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return s.x=Math.round(r.x/h*l-u),s.y=Math.round((i?-1:1)*(r.y/h*l-a)),(0,n.isVector3Like)(s)&&(s.z=r.z),s},e.webMercatorTile2TargetWorld=u,e.webMercatorTile2TargetTile=function(t,e,r,i,n,s=!1){u(t,e,r,i,n,s),i.sub(e.center)}},627:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.Ring=void 0;const i=r(9776);e.Ring=class{constructor(t,e,r=4096,n=!1){if(this.points=t,this.textureCoords=e,this.extents=r,this.hasClipInfo=n,void 0!==e&&e.length!==t.length)throw new Error(\"the array of texture coordinates must have the same number of elements of the array of points\");this.vertexStride=2,void 0!==e&&(this.vertexStride=this.vertexStride+2),this.area=i.ShapeUtils.area(this.points),this.winding=this.area<0}toArray(t=[],e=0){var r;return this.points.forEach(((r,i)=>r.toArray(t,e+this.vertexStride*i))),null===(r=this.textureCoords)||void 0===r||r.forEach(((r,i)=>r.toArray(t,e+this.vertexStride*i+2))),t}isProperEdge(t){const e=this.extents,r=(t+1)%this.points.length,i=this.points[t],n=this.points[r];if(this.hasClipInfo){if(i.x!==n.x&&i.y!==n.y)return!0;if(i.x%this.extents!=0&&i.y%this.extents!=0)return!0;if(n.x%this.extents!=0&&n.y%this.extents!=0)return!0;const t=!0===i.isClipped,e=!0===n.isClipped;return!t&&!e}return!(i.x<=0&&n.x<=0||i.x>=e&&n.x>=e||i.y<=0&&n.y<=0||i.y>=e&&n.y>=e)}}},1140:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.VectorTileDataEmitter=void 0;const i=r(6782),n=r(9365),s=r(1405),o=r(9776),a=r(2754),u=r(3096),l=r(414),h=r(3334),c=r(5448),d=r(6815),p=r(8152),f=r(3561),m=r(2982),y=r(6525),g=r(6189),x=r(2616),v=r(4388),b=r(3711),w=r(5033),_=r(1984),M=r(4342),E=r(9287),T=r(6441),S=r(627),A=M.LoggerManager.instance.create(\"OmvDecodedTileEmitter\"),z=new d.Vector3,P=new d.Vector3,L=new d.Vector3,O=new d.Vector3,C=new c.Vector2,k=new c.Vector2,j=new d.Vector3,V=new d.Vector3,I=new d.Vector3,R=new c.Vector2,B=new c.Vector2,q=new c.Vector2,N=new d.Vector3,D=new d.Vector3,F=new d.Vector3,G=new d.Vector3,U=new d.Vector3,W=new l.Line3,$=Math.PI/8;function H(t,e,r=\"index\"){const i=e>65535?\"uint32\":\"uint16\";return{itemCount:1,name:r,buffer:(\"uint32\"===i?new Uint32Array(t):new Uint16Array(t)).buffer,type:i}}class X{constructor(t){this.type=t,this.positions=[],this.normals=[],this.textureCoordinates=[],this.colors=[],this.extrusionAxis=[],this.indices=[],this.edgeIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.textBackgroundImageTextures=[],this.featureStarts=[],this.edgeFeatureStarts=[],this.objInfos=[],this.offsetDirections=[]}addText(t){let e=this.stringCatalog.indexOf(t);return e<0&&(e=this.stringCatalog.length,this.stringCatalog.push(t)),e}}var Y;!function(t){t[t.Simple=0]=\"Simple\",t[t.Complex=1]=\"Complex\"}(Y||(Y={}));const K=new u.Color;e.VectorTileDataEmitter=class{constructor(t,e,r={}){var i,n,s;this.m_decodeInfo=t,this.m_styleSetEvaluator=e,this.m_options=r,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_pathGeometries=[],this.m_iconTextGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_sources=[],this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_options.gatherFeatureAttributes=null!==(i=r.gatherFeatureAttributes)&&void 0!==i&&i,this.m_options.skipShortLabels=null===(n=r.skipShortLabels)||void 0===n||n,this.m_options.enableElevationOverlay=null!==(s=r.enableElevationOverlay)&&void 0!==s&&s}get projection(){return this.m_decodeInfo.targetProjection}get center(){return this.m_decodeInfo.center}processPointFeature(t,e,r,i,n){var s;const o=i.env;this.processFeatureCommon(o);const{tileKey:a,columnCount:u,rowCount:l}=this.m_decodeInfo,h=a.column+1<u?e-1:e,c=a.row+1<l?e-1:e,d=r.filter((t=>t.x>=0&&t.x<=h&&t.y>=0&&t.y<=c));if(0!==d.length)for(const t of n){if(void 0===t)continue;const r=t._index,n=this.findOrCreateMeshBuffers(r,p.GeometryType.Point);if(void 0===n)continue;const{positions:a,texts:u,imageTextures:l,textBackgroundImageTextures:h,objInfos:c,offsetDirections:m}=n,y=(0,_.isTextTechnique)(t)||(0,_.isIconTextTechnique)(t);let g,v;const b=(0,_.isIconTextTechnique)(t);if(b){const e=t;g=(0,f.evaluateTechniqueAttr)(i,e.imageTexture),void 0!==e[\"background-image\"]&&(v=(0,f.evaluateTechniqueAttr)(i,e[\"background-image\"]))}const w=(0,p.scaleHeight)(i,t,this.m_decodeInfo.tileKey.level),M=(0,p.getFeatureId)(o.entries);for(const r of d){if(y){const e=t,r=(0,p.getFeatureText)(i,e,this.m_options.languages);void 0!==r?u.push(n.addText(r)):u.push(-1)}y?(0,T.webMercatorTile2TargetWorld)(e,this.m_decodeInfo,r,j,w):(0,T.webMercatorTile2TargetTile)(e,this.m_decodeInfo,r,j,w);const d=this.projection.type===x.ProjectionType.Planar?j.z:r.z;d>this.m_maxGeometryHeight?this.m_maxGeometryHeight=d:d<this.m_minGeometryHeight&&(this.m_minGeometryHeight=d),a.push(j.x,j.y,j.z),c.push(this.m_options.gatherFeatureAttributes?o.entries:M),m.push(null!==(s=o.lookup(\"offset_direction\"))&&void 0!==s?s:0),b&&(void 0===g?l.push(-1):l.push(n.addText(g)),void 0===v?h.push(-1):h.push(n.addText(v)))}}}processLineFeature(t,e,r,i,s){var o;const a=i.env;this.processFeatureCommon(a);const u=[],l=[],h=[],c=[],m=this.m_decodeInfo.projectedBoundingBox;let y;const g=2*m.extents.x,x=2*m.extents.y,v=Math.max(g,x);let w,S;const z=void 0!==r[0].untiledPositions,P=!1;let L=!1,O=!1;for(const t of s)if(void 0!==t){if(w){const e=this.getTextureCoordinateType(t);(0,M.assert)(void 0===e||S===e)}else w=this.getComputeTexCoordsFunc(t),S=this.getTextureCoordinateType(t);L=L||(0,_.isSpecialDashesLineTechnique)(t),O=O||!L}for(const t of r){const r=[];let i=0;if(z&&(this.m_decodeInfo.targetProjection.projectPoint(t.untiledPositions[0],V),t.untiledPositions.forEach((t=>{this.m_decodeInfo.targetProjection.projectPoint(t,j),i+=j.distanceTo(V),V.copy(j),this.m_decodeInfo.targetProjection.projectPoint(t.normalized(),j),r.push(j.x,j.y,j.z,i)}))),L){y=[];let n=0;const s=t.positions.length;if(s>1){let o=0;for(let a=0;a<s-1;a++){const s=[],u=[],d=[],p=[],f=t.positions[a],m=t.positions[a+1];if((0,T.webMercatorTile2TargetWorld)(e,this.m_decodeInfo,f,j,P),u.push(j.x,j.y,j.z),(0,T.webMercatorTile2TargetWorld)(e,this.m_decodeInfo,m,I,P),u.push(I.x,I.y,I.z),w&&(w(f,e).toArray(d,d.length),w(m,e).toArray(d,d.length)),z){let t=this.findRelativePositionInLine(j,r)/i;p.push(t),t=this.findRelativePositionInLine(I,r)/i,p.push(t)}else{p.push(o);const t=j.distanceTo(I);n+=t,o+=t,p.push(o)}j.sub(this.m_decodeInfo.center),s.push(j.x,j.y,j.z),I.sub(this.m_decodeInfo.center),s.push(I.x,I.y,I.z),y.push(s),l.push(u),h.push(d),c.push(p)}}if(!z&&n>0)for(const t of c)t.forEach(((e,r)=>{t[r]=e/n}))}if(O){const n=[],s=[],o=[],a=[];t.positions.forEach((t=>{if((0,T.webMercatorTile2TargetWorld)(e,this.m_decodeInfo,t,j,P),s.push(j.x,j.y,j.z),w&&w(t,e).toArray(o,o.length),z){const t=this.findRelativePositionInLine(j,r)/i;a.push(t)}j.sub(this.m_decodeInfo.center),n.push(j.x,j.y,j.z)})),u.push(n),l.push(s),h.push(o),c.push(a)}}const C=this.m_decodeInfo.tileKey.level>=11;for(const t of s){if(void 0===t)continue;const e=t._index,r=t.name;if((0,_.isLineTechnique)(t)||(0,_.isSolidLineTechnique)(t)){const r=(0,_.isLineTechnique)(t)?this.m_simpleLines:this.m_solidLines,n=(0,_.isLineTechnique)(t)?Y.Simple:Y.Complex;L&&((0,M.assert)(void 0!==y,\"OmvDecodedTileEmitter#processLineFeature: Internal error - No localLineSegments\"),this.applyLineTechnique(r,t,e,n,a.entries,y,i,this.getTextureCoordinateType(t)?h:void 0,c)),u.length>0&&this.applyLineTechnique(r,t,e,n,a.entries,u,i,this.getTextureCoordinateType(t)?h:void 0,z?c:void 0)}else if((0,_.isTextTechnique)(t)||(0,_.isIconTextTechnique)(t)||(0,_.isLineMarkerTechnique)(t)){const r=t,s=(0,p.getFeatureText)(i,r,this.m_options.languages);if(void 0===s&&!(0,_.isIconTextTechnique)(t)&&!(0,_.isLineMarkerTechnique)(t))continue;if((0,_.isTextTechnique)(t)){let t=[];if(this.m_options.skipShortLabels){const e=v/this.m_decodeInfo.tileSizeOnScreen,r=5*String(s).length*e*.5,i=r*r;t=this.splitJaggyLines(l,i,$)}else t=l;if(0===t.length)continue;for(const r of t){const t=M.Math2D.computeSquaredLineLength(r);this.m_textPathGeometries.push({technique:e,path:r,pathLengthSqr:t,text:String(s),objInfos:this.m_options.gatherFeatureAttributes?a.entries:(0,p.getFeatureId)(a.entries)})}}else{const r=t,u=(0,f.evaluateTechniqueAttr)(i,r.imageTexture),h=Math.max(Number.EPSILON,null!==(o=(0,f.evaluateTechniqueAttr)(i,r[\"anchor-point-density\"]))&&void 0!==o?o:20),c=this.m_decodeInfo.projectedBoundingBox.extents,d=2*Math.min(c.x,c.y)/h,m=new n.BufferAttribute(new Float64Array,3);for(const t of l)m.array=t,m.count=t.length/m.itemSize,this.m_iconTextGeometries.push({technique:e,positions:{name:\"position\",type:\"float\",buffer:(0,E.computeLineAnchorPoints)(m,d),itemCount:m.itemSize},texts:[0],stringCatalog:[s,u],imageTextures:[1],objInfos:this.m_options.gatherFeatureAttributes?[a.entries]:[(0,p.getFeatureId)(a.entries)]})}}else if((0,_.isLabelRejectionLineTechnique)(t))for(const t of l){const e=[];for(let r=0;r<t.length;r+=3)e.push((new d.Vector3).fromArray(t,r));this.m_pathGeometries.push({path:e})}else if((0,_.isExtrudedLineTechnique)(t)){const r=this.findOrCreateMeshBuffers(e,p.GeometryType.ExtrudedLine);if(void 0===r)continue;const{positions:n,indices:s,groups:o,featureStarts:l,objInfos:h}=r,c=s.length,d=(0,f.evaluateTechniqueAttr)(i,t.width);if(void 0===d)continue;const m=(0,f.evaluateTechniqueAttr)(i,t.cap,\"Circle\"),y=C&&\"Circle\"===m;u.forEach((t=>{(0,b.triangulateLine)(t,d,n,s,y),l.push(c),h.push(this.m_options.gatherFeatureAttributes?a.entries:(0,p.getFeatureId)(a.entries))}));const g=s.length-c;o.push({start:c,count:g,technique:e})}else A.warn(`OmvDecodedTileEmitter#processLineFeature: Invalid line technique\\n                     ${r} for layer: ${a.entries.$layer} `)}}processPolygonFeature(t,e,r,i,n){const s=i.env;this.processFeatureCommon(s);const u=!1;n.forEach((t=>{if(void 0===t)return;const n=t._index;if(void 0===n)throw new Error(\"OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index\");let l;const h=s.lookup(\"bbox\");if(Array.isArray(h)){const[t,e,r,i]=h,n=new x.GeoBox(new x.GeoCoordinates(e,t),new x.GeoCoordinates(i,r));l=new a.Box3,x.webMercatorProjection.projectBox(n,l)}const c=[],d=(0,_.isExtrudedPolygonTechnique)(t),p=(0,_.isPolygonTechnique)(t),f=(0,_.isStandardTechnique)(t),y=d||p||f,g=this.getComputeTexCoordsFunc(t,l),v=y&&!d;for(const t of r){const r=[];for(let i=0;i<t.rings.length;i++){const n=0===i;let s=t.rings[i];v&&s.some((t=>t.x<0||t.x>e||t.y<0||t.y>e))&&(s=(0,m.clipPolygon)(s,e));const a=o.ShapeUtils.area(s);if(n&&0===a)break;if(0!==a){let t;void 0!==g&&(t=s.map((t=>g(t,e)))),r.push(new S.Ring(s,t,e,v))}}r.length>0&&c.push(r)}const b=(0,_.isSolidLineTechnique)(t)||(0,_.isLineTechnique)(t);if(y)this.applyPolygonTechnique(c,t,n,i,e);else if(b){const r=\"line\"===t.name?this.m_simpleLines:this.m_solidLines,o=\"line\"===t.name?Y.Simple:Y.Complex,a=(0,_.isSpecialDashesLineTechnique)(t);c.forEach((l=>{const h=[],c=a?[]:void 0;l.forEach((t=>{const r=t.points.length;let i=[],n=0,s=0,o=a?[]:void 0;for(let l=0;l<r;++l){a&&i.length>0&&(i=[],o=[]);const d=(l+1)%r,p=t.points[l],f=t.points[d],m=t.isProperEdge(l);if(m||0===i.length){if(m&&0===i.length&&((0,T.webMercatorTile2TargetTile)(e,this.m_decodeInfo,C.copy(p),j,u),i.push(j.x,j.y,j.z),a)){(0,T.webMercatorTile2TargetTile)(e,this.m_decodeInfo,C.copy(f),I,u),i.push(I.x,I.y,I.z),o.push(s);const t=j.distanceTo(I);n+=t,s+=t,o.push(s)}}else h.push(i),i=[];m&&!a&&((0,T.webMercatorTile2TargetTile)(e,this.m_decodeInfo,C.copy(f),j,u),i.push(j.x,j.y,j.z)),a&&i.length>0&&n>0&&(o.forEach(((t,e)=>{o[e]=t/n})),h.push(i),c.push(o))}!a&&i.length>0&&h.push(i)})),0!==h.length&&this.applyLineTechnique(r,t,n,o,s.entries,h,i,void 0,c)}))}}))}getDecodedTile(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines);const t={techniques:this.m_styleSetEvaluator.decodedTechniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(t.textGeometries=this.m_textGeometries),this.m_iconTextGeometries.length>0&&(t.iconTextGeometries=this.m_iconTextGeometries),this.m_textPathGeometries.length>0&&(t.textPathGeometries=this.m_textPathGeometries),this.m_pathGeometries.length>0&&(t.pathGeometries=this.m_pathGeometries),0!==this.m_sources.length&&(t.copyrightHolderIds=this.m_sources),t.maxGeometryHeight=this.m_maxGeometryHeight,t.minGeometryHeight=this.m_minGeometryHeight,t}splitJaggyLines(t,e,r){const i=[],n=(t,e,r)=>{let i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(let a=e;a<r;a+=3){const e=t[a],r=t[a+1];e<i&&(i=e),e>n&&(n=e),r<s&&(s=r),r>o&&(o=r)}return(n-i)*(n-i)+(o-s)*(o-s)},s=t.slice();for(;s.length>0;){const t=s.pop();if(void 0===t||t.length<6)continue;let o=-1;for(let e=0;e<t.length-3;e+=3){R.set(t[e],t[e+1]),B.set(t[e+3],t[e+4]);const i=B.sub(R).normalize();if(e>0){const t=Math.atan2(q.x*i.y-i.x*q.y,i.dot(q));if(Math.abs(t)>r){o=e;break}}q.set(i.x,i.y)}if(o>0){const r=n(t,0,o+3),a=n(t,o,t.length);r>e&&i.push(t.slice(0,o+3)),a>e&&s.push(t.slice(o))}else n(t,0,t.length)>e&&i.push(t)}return i}getTextureCoordinateType(t){return((0,_.isPolygonTechnique)(t)||(0,_.isSolidLineTechnique)(t)||(0,_.isExtrudedPolygonTechnique)(t))&&this.m_options.enableElevationOverlay?_.TextureCoordinateType.TileSpace:(0,_.textureCoordinateType)(t)}getComputeTexCoordsFunc(t,e){switch(this.getTextureCoordinateType(t)){case _.TextureCoordinateType.TileSpace:return(t,e)=>{const r=t.clone().divideScalar(e);return r.y=1-r.y,r};case _.TextureCoordinateType.EquirectangularSpace:return(t,e)=>{const r=(0,T.tile2world)(e,this.m_decodeInfo,t,!1,V),i=x.normalizedEquirectangularProjection.reprojectPoint(x.webMercatorProjection,r);return new c.Vector2(i.x,i.y)};case _.TextureCoordinateType.FeatureSpace:if(!e)return;return(t,r)=>{const i=(0,T.tile2world)(r,this.m_decodeInfo,t,!1,V),n=new c.Vector2(i.x,i.y);return e&&(n.x-=e.min.x,n.y-=e.min.y,n.x/=e.max.x-e.min.x,n.y/=e.max.y-e.min.y),n.y=1-n.y,n};default:return}}applyLineTechnique(t,e,r,i=Y.Complex,n,s,o,a,u){let l;const h=t.find((t=>t.technique===r)),c=void 0!==a;if(void 0===h){l=new v.LineGroup(c,void 0,i===Y.Simple);const e={type:i===Y.Complex?p.GeometryType.SolidLine:p.GeometryType.Line,technique:r,lines:l};this.m_options.gatherFeatureAttributes&&(e.objInfos=[n],e.featureStarts=[0]),t.push(e)}else l=h.lines,this.m_options.gatherFeatureAttributes&&h.objInfos&&h.featureStarts&&(h.objInfos.push(n),h.featureStarts.push(l.indices.length));let d=0;s.forEach((t=>{l.add(this.m_decodeInfo.center,t,this.projection,u?u[d]:void 0,a?a[d]:void 0),d++}))}applyPolygonTechnique(t,e,r,o,a){var u,l;if(0===t.length)return;const c=(0,_.isExtrudedPolygonTechnique)(e),d=c?p.GeometryType.ExtrudedPolygon:p.GeometryType.Polygon,m=this.findOrCreateMeshBuffers(r,d);if(void 0===m)return;const v=e,b=e,E=!0===v.boundaryWalls,S=(0,_.isPolygonTechnique)(e),I=this.getTextureCoordinateType(e);let R=(0,f.evaluateTechniqueAttr)(o,v.height),B=(0,f.evaluateTechniqueAttr)(o,v.floorHeight);if(void 0===R){const t=o.env.lookup(\"height\"),e=(0,f.evaluateTechniqueAttr)(o,v.defaultHeight);R=void 0!==t?t:void 0!==e?e:0}if(void 0===B){const t=o.env.lookup(\"min_height\");B=void 0===t||S?0:t}R=Math.max(B+w.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT,R);const q=this.m_decodeInfo.tileKey.level,N=c&&(0,p.scaleHeight)(o,v,q);this.m_decodeInfo.tileBounds.getCenter(z);const{positions:D,normals:F,textureCoordinates:G,colors:U,extrusionAxis:W,indices:$,edgeIndices:X,groups:Y}=m,Z=this.m_decodeInfo.targetProjection.type===x.ProjectionType.Spherical,J=c?null!==(u=v.lineWidth)&&void 0!==u?u:0:S&&null!==(l=b.lineWidth)&&void 0!==l?l:0,Q=\"number\"!=typeof J||J>0;let tt;if((0,_.isExtrudedPolygonTechnique)(e)&&(0,M.getOptionValue)(e.vertexColors,!1)){let t=(0,f.evaluateTechniqueAttr)(o,e.color);if(void 0===t){const e=o.env.lookup(\"color\");this.isColorStringValid(e)&&(t=String(e))}void 0===t&&(t=(0,f.evaluateTechniqueAttr)(o,e.defaultColor,0)),void 0===t&&(t=0),K.set(t),tt=K}for(const e of t){const t=$.length,u=X.length,l=[],d=D.length/3,p=e[0],f=p.vertexStride,b=f+2;for(let t=0;t<p.points.length;++t){const e=p.points[t];l.push(e.x,-e.y),void 0!==p.textureCoords&&l.push(p.textureCoords[t].x,p.textureCoords[t].y);const r=(t+1)%p.points.length,i=p.isProperEdge(t);l.push(i?r:-1,E||i?r:-1)}const w=[];let _=1;for(;_<e.length;){const t=l.length/b;w.push(t);const r=e[_++];for(let e=0;e<r.points.length;++e){const i=(e+1)%r.points.length,n=r.points[e];l.push(n.x,-n.y),void 0!==r.textureCoords&&l.push(r.textureCoords[e].x,r.textureCoords[e].y);const s=r.isProperEdge(e);l.push(s?t+i:-1,E||s?t+i:-1)}}try{const t=i.Earcut.triangulate(l,w,b),e=l.length/b;if(Z){const e=new s.BufferGeometry,r=[],i=[],o=[],u=[];for(let t=0;t<l.length;t+=b){const e=(0,T.tile2world)(a,this.m_decodeInfo,C.set(l[t],l[t+1]),!0,V);r.push(e.x,e.y,0),void 0!==I&&i.push(l[t+2],l[t+3]),o.push(l[t+f]),u.push(l[t+f+1])}const c=new n.BufferAttribute(new Float32Array(r),3);let d;e.setAttribute(\"position\",c),void 0!==I&&(d=new n.BufferAttribute(new Float32Array(i),2),e.setAttribute(\"uv\",d));const p=new n.BufferAttribute(new Float32Array(o),1);e.setAttribute(\"edge\",p);const m=new n.BufferAttribute(new Float32Array(u),1);e.setAttribute(\"wall\",p);const v=H(t,c.count-1),w=\"uint32\"===v.type?new n.Uint32BufferAttribute(v.buffer,1):new n.Uint16BufferAttribute(v.buffer,1);e.setIndex(w);const _=this.m_decodeInfo.tileKey.level;if(_>=3&&_<9){const t=Math.pow(2,9-_),{geoBox:r}=this.m_decodeInfo;new y.EdgeLengthGeometrySubdivisionModifier(t,r,y.SubdivisionMode.NoDiagonals,x.webMercatorProjection).modify(e)}new g.SphericalGeometrySubdivisionModifier((0,h.degToRad)(10),x.webMercatorProjection).modify(e),l.length=0,t.length=0;for(let t=0;t<c.array.length;t+=3){const e=(0,T.world2tile)(a,this.m_decodeInfo,j.set(c.array[t],c.array[t+1],0),!0,k);l.push(e.x,e.y),void 0!==I&&(l.push(d.array[t/3*2]),l.push(d.array[t/3*2+1])),l.push(p.array[t/3]),l.push(m.array[t/3])}const M=e.getIndex();null!==M&&t.push(...M.array)}P.set(0,0,1);for(let t=0;t<l.length;t+=b){(0,T.webMercatorTile2TargetWorld)(a,this.m_decodeInfo,C.set(l[t],l[t+1]),j,!1,!0);const e=N?this.m_decodeInfo.targetProjection.getScaleFactor(j):1;this.m_maxGeometryHeight=Math.max(this.m_maxGeometryHeight,e*R),this.m_minGeometryHeight=Math.min(this.m_minGeometryHeight,e*R),Z&&P.set(j.x,j.y,j.z).normalize(),j.sub(this.center),L.copy(P).multiplyScalar(B*e),D.push(j.x+L.x,j.y+L.y,j.z+L.z),void 0!==I&&G.push(l[t+2],l[t+3]),this.m_options.enableElevationOverlay&&F.push(...P.toArray()),c&&(O.copy(P).multiplyScalar(R*e),D.push(j.x+O.x,j.y+O.y,j.z+O.z),W.push(0,0,0,0,O.x-L.x,O.y-L.y,O.z-L.z,1),void 0!==I&&G.push(l[t+2],l[t+3]),this.m_options.enableElevationOverlay&&F.push(...P.toArray()),void 0!==tt&&U.push(tt.r,tt.g,tt.b,tt.r,tt.g,tt.b))}for(let e=0;e<t.length;e+=3)if(c){const r=d+2*t[e+0]+1,i=d+2*t[e+1]+1,n=d+2*t[e+2]+1;$.push(r,i,n)}else{const r=d+t[e+0],i=d+t[e+1],n=d+t[e+2];$.push(r,i,n)}Q&&this.addEdges(d,e,b,f,D,l,X,c,v.footprint,v.maxSlope),c&&this.addWalls(d,e,b,f,l,$)}catch(t){A.error(\"cannot triangulate geometry\",t)}this.m_options.gatherFeatureAttributes&&(m.objInfos.push(o.env.entries),m.featureStarts.push(t),m.edgeFeatureStarts.push(u));const M=$.length-t;M>0&&Y.push({start:t,count:M,technique:r})}}createGeometries(){this.m_meshBuffers.forEach(((t,e)=>{if(0===t.positions.length)return;if(!this.m_styleSetEvaluator.techniques||this.m_styleSetEvaluator.techniques.length<=e)throw new Error(\"Invalid technique index\");const r=this.m_styleSetEvaluator.techniques[e];if(void 0===r)return;if(t.texts.length>0){const i={positions:{name:\"position\",type:\"float\",buffer:new Float64Array(t.positions).buffer,itemCount:3},texts:t.texts,technique:e,stringCatalog:t.stringCatalog,objInfos:t.objInfos};if((0,_.isTextTechnique)(r))this.m_textGeometries.push(i);else{(0,M.assert)((0,_.isIconTextTechnique)(r));const e=i;e.imageTextures=t.imageTextures,e.textBackgroundImageTextures=t.textBackgroundImageTextures,e.offsetDirections=t.offsetDirections,this.m_iconTextGeometries.push(e)}return}const i=new Float32Array(t.positions);0===t.groups.length&&t.groups.push({start:0,count:i.length/3,technique:e});const n=[{name:\"position\",buffer:i.buffer,itemCount:3,type:\"float\"}],s={type:t.type,vertexAttributes:n,groups:t.groups};if(t.normals.length>0){const e=new Float32Array(t.normals);(0,M.assert)(e.length===i.length,\"length of normals buffer is different than the length of the position buffer\"),n.push({name:\"normal\",buffer:e.buffer,itemCount:3,type:\"float\"})}if(t.colors.length>0){const e=new Float32Array(t.colors);(0,M.assert)(e.length===i.length,\"length of colors buffer is different than the length of the position buffer\"),n.push({name:\"color\",buffer:e.buffer,itemCount:3,type:\"float\"})}const o=t.positions.length/3;if(t.textureCoordinates.length>0){const e=t.textureCoordinates.length/2;(0,M.assert)(e===o,\"length of textureCoordinates buffer is different than the length of theposition buffer\");const r=new Float32Array(t.textureCoordinates);n.push({name:\"uv\",buffer:r.buffer,itemCount:2,type:\"float\"})}if(t.extrusionAxis.length>0){const e=new Float32Array(t.extrusionAxis);(0,M.assert)(e.length/4==i.length/3,\"length of extrusionAxis buffer is different than the length of the position buffer\"),n.push({name:\"extrusionAxis\",buffer:e.buffer,itemCount:4,type:\"float\"})}t.indices.length>0&&(s.index=H(t.indices,o-1)),t.edgeIndices.length>0&&(s.edgeIndex=H(t.edgeIndices,o-1,\"edgeIndex\")),s.featureStarts=t.featureStarts,s.edgeFeatureStarts=t.edgeFeatureStarts,s.objInfos=t.objInfos,this.m_geometries.push(s)}))}processLines(t){t.forEach((t=>{const{vertices:e,indices:r}=t.lines,i=t.technique,n=new Float32Array(e).buffer,s=H(r,e.length/t.lines.stride-1),o={type:\"float\",stride:t.lines.stride,buffer:n,attributes:t.lines.vertexAttributes},a={type:p.GeometryType.SolidLine,index:s,interleavedVertexAttributes:[o],groups:[{start:0,count:r.length,technique:i}],vertexAttributes:[],featureStarts:t.featureStarts,objInfos:t.objInfos};this.m_geometries.push(a)}))}processSimpleLines(t){t.forEach((t=>{const{vertices:e,indices:r}=t.lines,i=t.technique,n={buffer:new Float32Array(e).buffer,itemCount:3,type:\"float\",name:\"position\"},s={type:p.GeometryType.Line,index:H(r,e.length/n.itemCount-1),vertexAttributes:[n],groups:[{start:0,count:r.length,technique:i}],featureStarts:t.featureStarts,objInfos:t.objInfos};this.m_geometries.push(s)}))}findOrCreateMeshBuffers(t,e){let r=this.m_meshBuffers.get(t);return void 0!==r?r.type!==e?void A.error(`MeshBuffer has been created with wrong type \"${p.GeometryType[e]}\"\\n                instead of \"${p.GeometryType[r.type]}\"`):r:(r=new X(e),this.m_meshBuffers.set(t,r),r)}processFeatureCommon(t){const e=t.lookup(\"source\");\"string\"==typeof e&&\"\"!==e&&(this.m_sources.includes(e)||this.m_sources.push(e))}isColorStringValid(t){return\"string\"==typeof t&&t.length>0}addEdges(t,e,r,i,n,s,o,a,u,l){const h=new d.Vector3,c=new d.Vector3;let p,f,m=0,y=0;for(;m<e;){for(;m!==p;){void 0===p&&(p=m),m<e&&(y=Math.max(y,m));const d=s[m*r+i];if(d<0)break;if(a)if(!0===u&&o.push(t+2*m,t+2*d),o.push(t+2*m+1,t+2*d+1),void 0!==l){if(void 0!==f){const e=3*(t+2*f),r=3*(t+2*m),i=3*(t+2*d);h.set(n[r]-n[e],n[r+1]-n[e+1],n[r+2]-n[e+2]).normalize(),c.set(n[i]-n[r],n[i+1]-n[r+1],n[i+2]-n[r+2]).normalize(),h.dot(c)<=l&&o.push(t+2*m,t+2*m+1)}}else o.push(t+2*m,t+2*m+1);else o.push(t+m,t+d);f=m,m=d}m=y+1,p=void 0,f=void 0}}addWalls(t,e,r,i,n,s){let o,a=0,u=0;for(;a<e;){for(;a!==o;){void 0===o&&(o=a),a<e&&(u=Math.max(u,a));const l=n[a*r+i+1];if(l<0)break;s.push(t+2*a,t+2*a+1,t+2*l+1,t+2*l+1,t+2*l,t+2*a),a=l}a=u+1,o=void 0}}findRelativePositionInLine(t,e){let r=1/0,i=0;for(let n=0;n<e.length;n+=4){W.set(N.set(e[n],e[n+1],e[n+2]),D.set(e[n+4],e[n+5],e[n+6])),W.closestPointToPoint(t,!0,F);const s=F.distanceTo(t);s<r&&(G.copy(F),U.copy(N),r=s,i=e[n+3])}return i+G.distanceTo(U)}}},1503:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.VectorTileDecoderService=e.VectorTileDecoder=e.VectorTileDataProcessor=void 0;const i=r(7769),n=r(2626),s=r(4342),o=r(5156),a=r(2926),u=r(4585),l=r(9252),h=r(9959),c=r(1140),d=s.LoggerManager.instance.create(\"VectorTileDecoder\",{enabled:!1});class p{constructor(t,e,r,i,n={}){var s,o;this.m_tileKey=t,this.m_projection=e,this.m_styleSetEvaluator=r,this.m_dataAdapter=i,this.m_options=n,n.storageLevelOffset=null!==(s=n.storageLevelOffset)&&void 0!==s?s:0,n.showMissingTechniques=null!==(o=n.showMissingTechniques)&&void 0!==o&&o}getDecodedTile(t){this.m_styleSetEvaluator.resetTechniques();const e=new l.DecodeInfo(this.m_projection,this.m_tileKey,this.m_options.storageLevelOffset);return this.m_decodedTileEmitter=new c.VectorTileDataEmitter(e,this.m_styleSetEvaluator,this.m_options),this.m_dataAdapter.process(t,e,this),this.m_decodedTileEmitter.getDecodedTile()}processPointFeature(t,e,r,i,n){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(t,e,r,\"point\",i,n,this.m_decodedTileEmitter.processPointFeature)}processLineFeature(t,e,r,i,n){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(t,e,r,\"line\",i,n,this.m_decodedTileEmitter.processLineFeature)}processPolygonFeature(t,e,r,i,n){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(t,e,r,\"polygon\",i,n,this.m_decodedTileEmitter.processPolygonFeature)}processFeature(t,e,r,i,n,s,o){const a=this.createMapEnv(n,s,t,i),u=this.m_styleSetEvaluator.getMatchingTechniques(a,t,i);if(0===u.length)return void(this.m_options.showMissingTechniques&&d.log(\"VectorTileDataProcessor#processFeature: no techniques for object:\",JSON.stringify(a.unmap())));const l={env:a,cachedExprResults:new Map};this.m_decodedTileEmitter&&o.apply(this.m_decodedTileEmitter,[t,e,r,l,u])}createMapEnv(t,e,r,n){const s=this.m_tileKey.level;return new i.MapEnv(Object.assign(Object.assign({$layer:r,$id:null!=e?e:null,$level:s,$zoom:Math.max(0,s-this.m_options.storageLevelOffset),$geometryType:n},this.getLocalizedNames(t)),t))}getLocalizedNames(t){var e,r;const[i,n]=null!==(r=null===(e=this.m_options.languages)||void 0===e?void 0:e.map((e=>t[`name:${e}`])))&&void 0!==r?r:[];return{\"$localized-name\":null!=i?i:t.name,\"$secondary-localized-name\":n}}}e.VectorTileDataProcessor=p;class f extends n.ThemedTileDecoder{constructor(t){super(),this.m_dataAdapter=t,this.m_options={map:{},changed:!1},this.m_defaultDataAdapters=[],this.m_defaultDataAdapters.push(new u.OmvDataAdapter,new a.GeoJsonVtDataAdapter,new o.GeoJsonDataAdapter)}connect(){return Promise.resolve()}decodeThemedTile(t,e,r,i){const n=s.PerformanceTimer.now();if(!this.m_dataAdapter&&(this.m_dataAdapter=this.findDefaultDataAdapter(t),!this.m_dataAdapter))return Promise.reject(new Error(\"Unsupported data format.\"));const o=this.m_dataAdapter;if((0,s.assert)(o.canProcess(t)),this.m_options.changed){if(o instanceof u.OmvDataAdapter){const t=this.m_options.map;o.configure(t)}this.m_options.changed=!1}const a=new p(e,i,r,o,this.m_options.map).getDecodedTile(t);return a.decodeTime=s.PerformanceTimer.now()-n,Promise.resolve(a)}configure(t,e){super.configure(t,e),this.m_options.map=Object.assign(Object.assign(Object.assign({},this.m_options.map),t),e),this.m_options.changed=!0}findDefaultDataAdapter(t){for(const e of this.m_defaultDataAdapters)if(e.canProcess(t))return e}}e.VectorTileDecoder=f,e.VectorTileDecoderService=class{static start(){n.WorkerServiceManager.getInstance().register({serviceType:h.VECTOR_TILE_DECODER_SERVICE_TYPE,factory:t=>n.TileDecoderService.start(t,new f)})}}},2926:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.GeoJsonVtDataAdapter=void 0;const i=r(9776),n=r(5448),s=r(6815),o=r(2616),a=r(6441),u=4096;var l;!function(t){t[t.Unknown=0]=\"Unknown\",t[t.Point=1]=\"Point\",t[t.LineString=2]=\"LineString\",t[t.Polygon=3]=\"Polygon\"}(l||(l={}));const h=new s.Vector3;e.GeoJsonVtDataAdapter=class{canProcess(t){if((0,a.isArrayBufferLike)(t))return!1;const e=t;return void 0!==e.features&&void 0!==e.source&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z}process(t,e,r){for(const c of t.features)switch(c.type){case l.Point:for(const e of c.geometry){const i=e[0],n=e[1],o=new s.Vector3(i,n,0);r.processPointFeature(t.layer,u,[o],c.tags,c.id)}break;case l.LineString:{const i=c.geometry;let s;const l=[];i.forEach((t=>{const e=null==s?void 0:s.positions[s.positions.length-1],[r,i]=t[0];if((null==e?void 0:e.x)===r&&(null==e?void 0:e.y)===i)for(let e=1;e<t.length;++e){const[r,i]=t[e];null==s||s.positions.push(new n.Vector2(r,i))}else{const e=t.map((([t,e])=>new n.Vector2(t,e)));l.push({positions:e}),s=l[l.length-1]}})),l.forEach((t=>{t.untiledPositions=t.positions.map((t=>((0,a.tile2world)(u,e,t,!1,h),o.webMercatorProjection.unprojectPoint(h))))})),r.processLineFeature(t.layer,u,l,c.tags,c.id);break}case l.Polygon:{const e=[];let s;for(const t of c.geometry){const r=[];for(const[e,i]of t){const t=new n.Vector2(e,i);r.push(t)}i.ShapeUtils.area(r)>0&&(s={rings:[]},e.push(s)),null==s||s.rings.push(r)}r.processPolygonFeature(t.layer,u,e,c.tags,c.id);break}case l.Unknown:}}}},5156:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.GeoJsonDataAdapter=void 0;const i=r(9776),n=r(5448),s=r(6815),o=r(6112),a=r(2616),u=r(6441),l=4096,h=new s.Vector3;function c(t,e,r){return a.webMercatorProjection.projectPoint(a.GeoCoordinates.fromGeoPoint(t),h),(0,u.world2tile)(l,e,h,!1,r)}function d(t,e){return{untiledPositions:t.map((t=>a.GeoCoordinates.fromGeoPoint(t))),positions:t.map((t=>c(t,e,new n.Vector2)))}}function p(t,e){return\"LineString\"===t.type?[d(t.coordinates,e)]:t.coordinates.map((t=>d(t,e)))}function f(t,e){return{rings:t.map(((t,r)=>{const n=0===r,{positions:s}=d(t,e),o=i.ShapeUtils.area(s)>0;return(n&&!o||!n&&o)&&s.reverse(),s}))}}function m(t,e){return\"Polygon\"===t.type?[f(t.coordinates,e)]:t.coordinates.map((t=>f(t,e)))}function y(t,e){return\"Point\"===t.type?[c(t.coordinates,e,new s.Vector3)]:t.coordinates.map((t=>c(t,e,new s.Vector3)))}e.GeoJsonDataAdapter=class{canProcess(t){return t&&\"FeatureCollection\"===t.type&&Array.isArray(t.features)}process(t,e,r,i=\"geojson\"){if(Array.isArray(t.features)&&0!==t.features.length)for(const n of t.features)switch(n.geometry.type){case\"LineString\":case\"MultiLineString\":{let t=p(n.geometry,e);const s=[],a=100;t.forEach((t=>{(0,o.clipLineString)(t.positions,-a,-a,l+a,l+a).forEach((t=>{s.push({positions:t})}))})),t=s,t.length>0&&r.processLineFeature(i,l,s,n.properties,n.id);break}case\"Polygon\":case\"MultiPolygon\":{const t=m(n.geometry,e);r.processPolygonFeature(i,l,t,n.properties,n.id);break}case\"Point\":case\"MultiPoint\":{const t=y(n.geometry,e);r.processPointFeature(i,l,t,n.properties,n.id);break}}}}},9607:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.GeometryCommands=e.FeatureAttributes=e.visitOmvLayer=e.visitOmv=e.isClosePathCommand=e.isLineToCommand=e.isMoveToCommand=e.CommandKind=void 0;const i=r(5448),n=r(3577);var s;function o(t,e){if((!e.visitLayer||e.visitLayer(t))&&t.features)for(const r of t.features)switch(r.type){case n.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case n.com.mapbox.pb.Tile.GeomType.POINT:e.visitPointFeature&&e.visitPointFeature(r);break;case n.com.mapbox.pb.Tile.GeomType.LINESTRING:e.visitLineFeature&&e.visitLineFeature(r);break;case n.com.mapbox.pb.Tile.GeomType.POLYGON:e.visitPolygonFeature&&e.visitPolygonFeature(r)}e.endVisitLayer&&e.endVisitLayer(t)}!function(t){t[t.MoveTo=1]=\"MoveTo\",t[t.LineTo=2]=\"LineTo\",t[t.ClosePath=7]=\"ClosePath\"}(s=e.CommandKind||(e.CommandKind={})),e.isMoveToCommand=function(t){return t.kind===s.MoveTo},e.isLineToCommand=function(t){return t.kind===s.LineTo},e.isClosePathCommand=function(t){return t.kind===s.ClosePath},e.visitOmv=function(t,e){if(t.layers)for(const r of t.layers)e.visitLayer&&!e.visitLayer(r)||o(r,e),e.endVisitLayer&&e.endVisitLayer(r)},e.visitOmvLayer=o,e.FeatureAttributes=class{accept(t,e,r){const{keys:i,values:n}=t,s=e.tags;if(s&&i&&n)for(let t=0;t<s.length;t+=2){const e=i[s[t]],o=n[s[t+1]];if(!r.visitAttribute(e,o))break}}},e.GeometryCommands=class{accept(t,e){if(!t)return;const r=t.length;let n=0,o=0;const a=[],u=[],l=[];for(let h=0;h<r;){const r=7&t[h],c=t[h]>>3;if(++h,r===s.MoveTo||r===s.LineTo)for(let s=0;s<c;++s){const s=t[h++],c=t[h++];n+=s>>1^-(1&s),o+=c>>1^-(1&c),\"Polygon\"===e.type&&(a.push(n),u.push(o));const d=new i.Vector2(n,o);l.push({kind:r,position:d})}else{for(const t of l)e.visitCommand(t);e.visitCommand({kind:r}),a.length=0,u.length=0,l.length=0}}if(l.length>0)for(const t of l)e.visitCommand(t)}}},4585:(t,e,r)=>{\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.OmvDataAdapter=e.asGeometryType=void 0;const i=r(5133),n=r(9776),s=r(6815),o=r(7769),a=r(4342),u=r(9959),l=r(7305),h=r(6441),c=r(9607),d=r(3577),p=[\"stringValue\",\"floatValue\",\"doubleValue\",\"intValue\",\"uintValue\",\"sintValue\",\"boolValue\"],f=a.LoggerManager.instance.create(\"OmvDataAdapter\",{enabled:!1}),m=i.fromNumber(Number.MAX_SAFE_INTEGER,!0),y=i.fromNumber(Number.MIN_SAFE_INTEGER,!1);function g(t,e,r){if(void 0!==e.id&&null!==e.id)return e.id;if(t.hasOwnProperty(\"id\")){const e=t.id;if(\"number\"==typeof e)return e;if(e)return void 0!==r&&e.greaterThan(Number.MAX_SAFE_INTEGER)&&r.error(\"Invalid ID: Larger than largest available Number in feature: \",t),e.toNumber()}}function x(t){if(void 0===t)return u.OmvGeometryType.UNKNOWN;switch(t.type){case d.com.mapbox.pb.Tile.GeomType.UNKNOWN:return u.OmvGeometryType.UNKNOWN;case d.com.mapbox.pb.Tile.GeomType.POINT:return u.OmvGeometryType.POINT;case d.com.mapbox.pb.Tile.GeomType.LINESTRING:return u.OmvGeometryType.LINESTRING;case d.com.mapbox.pb.Tile.GeomType.POLYGON:return u.OmvGeometryType.POLYGON;default:return u.OmvGeometryType.UNKNOWN}}function v(t,e){t.forEach((t=>{t.x===e-1&&(t.x=e)}))}e.asGeometryType=x,e.OmvDataAdapter=class{constructor(){this.m_geometryCommands=new c.GeometryCommands,this.m_roundUpCoordinatesIfNeeded=!1}configure(t){var e;const r=t.politicalView;this.m_dataFilter=void 0,this.m_featureModifiers=[new l.OmvPoliticalViewFeatureModifier(null!=r?r:\"\")],this.m_roundUpCoordinatesIfNeeded=null!==(e=t.roundUpCoordinatesIfNeeded)&&void 0!==e&&e}canProcess(t){return(0,h.isArrayBufferLike)(t)}process(t,e,r){const{tileKey:i}=e,n=new Uint8Array(t),s=d.com.mapbox.pb.Tile.decode(n);this.m_tileKey=i,this.m_processor=r,(0,c.visitOmv)(s,this)}visitLayer(t){this.m_layer=t;const e=this.m_tileKey.level,r=t.name;return!(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLayer(r,e))}visitPointFeature(t){var e;if(void 0===t.geometry)return;const r=this.filterAndModifyFeature(t,\"doProcessPointFeature\",\"wantsPointFeature\");if(!r)return;const i=this.m_layer.name,n=null!==(e=this.m_layer.extent)&&void 0!==e?e:4096,o=[];this.m_geometryCommands.accept(t.geometry,{type:\"Point\",visitCommand:t=>{(0,c.isMoveToCommand)(t)&&o.push(new s.Vector3(t.position.x,t.position.y,0))}}),0!==o.length&&this.m_processor.processPointFeature(i,n,o,r,g(t,r,f))}visitLineFeature(t){var e;if(void 0===t.geometry)return;const r=this.filterAndModifyFeature(t,\"doProcessLineFeature\",\"wantsLineFeature\");if(!r)return;const i=this.m_layer.name,n=null!==(e=this.m_layer.extent)&&void 0!==e?e:4096,s=[];let o;this.m_geometryCommands.accept(t.geometry,{type:\"Line\",visitCommand:t=>{(0,c.isMoveToCommand)(t)?(o=[t.position],s.push({positions:o})):(0,c.isLineToCommand)(t)&&o.push(t.position)}}),0!==s.length&&(this.mustRoundUpCoordinates&&function(t,e){t.forEach((t=>v(t.positions,e)))}(s,n),this.m_processor.processLineFeature(i,n,s,r,g(t,r,f)))}visitPolygonFeature(t){var e;if(void 0===t.geometry)return;const r=this.filterAndModifyFeature(t,\"doProcessPolygonFeature\",\"wantsPolygonFeature\");if(!r)return;const i=this.m_layer.name,s=null!==(e=this.m_layer.extent)&&void 0!==e?e:4096,o=[];let a,u,l;this.m_geometryCommands.accept(t.geometry,{type:\"Polygon\",visitCommand:t=>{if((0,c.isMoveToCommand)(t))u=[t.position];else if((0,c.isLineToCommand)(t))u.push(t.position);else if((0,c.isClosePathCommand)(t)&&void 0!==u&&u.length>0){const t=Math.sign(n.ShapeUtils.area(u));void 0===l&&(l=t),t===l&&(a={rings:[]},o.push(a)),u.push(u[0].clone()),null==a||a.rings.push(u)}}}),0!==o.length&&(this.mustRoundUpCoordinates&&function(t,e){t.forEach((t=>t.rings.forEach((t=>v(t,e)))))}(o,s),function(t){const e=t[0];if(void 0!==e&&0!==e.rings.length&&!(n.ShapeUtils.area(e.rings[0])>0))for(const e of t)for(const t of e.rings)t.reverse()}(o),this.m_processor.processPolygonFeature(i,s,o,r,g(t,r,f)))}filterAndModifyFeature(t,e,r){const n=this.m_tileKey.level,s=this.m_layer.name,a=x(t);if(this.m_dataFilter&&!1===this.m_dataFilter[r](s,a,n))return;const u=function(t,e){const r=new c.FeatureAttributes,n={};return r.accept(t,e,{visitAttribute:(t,e)=>(n[t]=function(t){const e=Object.prototype.hasOwnProperty;for(const r of p)if(e.call(t,r)){const e=t[r];if(void 0===e)throw new Error(\"unpexted undefined value\");return i.isLong(e)?e.comp(m)>0||e.comp(y)<0?e.toString():e.toNumber():e}throw new Error(\"not happening\")}(e),!0)}),n}(this.m_layer,t),l=new o.MapEnv(u);return this.m_featureModifiers&&this.m_featureModifiers.find((t=>!t[e](s,l,this.m_tileKey.level)))?void 0:u}get mustRoundUpCoordinates(){return this.m_roundUpCoordinatesIfNeeded&&this.m_tileKey.level<5&&this.m_tileKey.column===this.m_tileKey.columnCount()-1}}},6271:(t,e,r)=>{\"use strict\";r.d(e,{GUF:()=>n,KI_:()=>i,W2J:()=>o,ntt:()=>s});const i=\"srgb\",n=\"srgb-linear\",s=\"display-p3\",o=35044},9365:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{BufferAttribute:()=>p,Float16BufferAttribute:()=>w,Float32BufferAttribute:()=>_,Float64BufferAttribute:()=>M,Int16BufferAttribute:()=>g,Int32BufferAttribute:()=>v,Int8BufferAttribute:()=>f,Uint16BufferAttribute:()=>x,Uint32BufferAttribute:()=>b,Uint8BufferAttribute:()=>m,Uint8ClampedBufferAttribute:()=>y});var i=r(6815),n=r(5448),s=r(3334),o=r(6271);const a=u();function u(){const t=new ArrayBuffer(4),e=new Float32Array(t),r=new Uint32Array(t),i=new Uint32Array(512),n=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(i[t]=0,i[256|t]=32768,n[t]=24,n[256|t]=24):e<-14?(i[t]=1024>>-e-14,i[256|t]=1024>>-e-14|32768,n[t]=-e-1,n[256|t]=-e-1):e<=15?(i[t]=e+15<<10,i[256|t]=e+15<<10|32768,n[t]=13,n[256|t]=13):e<128?(i[t]=31744,i[256|t]=64512,n[t]=24,n[256|t]=24):(i[t]=31744,i[256|t]=64512,n[t]=13,n[256|t]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;!(8388608&e);)e<<=1,r-=8388608;e&=-8388609,r+=947912704,s[t]=e|r}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(a[t]=1024);return{floatView:e,uint32View:r,baseTable:i,shiftTable:n,mantissaTable:s,exponentTable:o,offsetTable:a}}function l(t){Math.abs(t)>65504&&console.warn(\"THREE.DataUtils.toHalfFloat(): Value out of range.\"),t=(0,s.clamp)(t,-65504,65504),a.floatView[0]=t;const e=a.uint32View[0],r=e>>23&511;return a.baseTable[r]+((8388607&e)>>a.shiftTable[r])}function h(t){const e=t>>10;return a.uint32View[0]=a.mantissaTable[a.offsetTable[e]+(1023&t)]+a.exponentTable[e],a.floatView[0]}const c=new i.Vector3,d=new n.Vector2;class p{constructor(t,e,r=!1){if(Array.isArray(t))throw new TypeError(\"THREE.BufferAttribute: array should be a Typed Array.\");this.isBufferAttribute=!0,this.name=\"\",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=r,this.usage=o.W2J,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,r){t*=this.itemSize,r*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[r+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,r=this.count;e<r;e++)d.fromBufferAttribute(this,e),d.applyMatrix3(t),this.setXY(e,d.x,d.y);else if(3===this.itemSize)for(let e=0,r=this.count;e<r;e++)c.fromBufferAttribute(this,e),c.applyMatrix3(t),this.setXYZ(e,c.x,c.y,c.z);return this}applyMatrix4(t){for(let e=0,r=this.count;e<r;e++)c.fromBufferAttribute(this,e),c.applyMatrix4(t),this.setXYZ(e,c.x,c.y,c.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)c.fromBufferAttribute(this,e),c.applyNormalMatrix(t),this.setXYZ(e,c.x,c.y,c.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)c.fromBufferAttribute(this,e),c.transformDirection(t),this.setXYZ(e,c.x,c.y,c.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setX(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setY(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setZ(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setW(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,r){return t*=this.itemSize,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array)),this.array[t+0]=e,this.array[t+1]=r,this}setXYZ(t,e,r,i){return t*=this.itemSize,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array),i=(0,s.normalize)(i,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this}setXYZW(t,e,r,i,n){return t*=this.itemSize,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return\"\"!==this.name&&(t.name=this.name),this.usage!==o.W2J&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}copyColorsArray(){console.error(\"THREE.BufferAttribute: copyColorsArray() was removed in r144.\")}copyVector2sArray(){console.error(\"THREE.BufferAttribute: copyVector2sArray() was removed in r144.\")}copyVector3sArray(){console.error(\"THREE.BufferAttribute: copyVector3sArray() was removed in r144.\")}copyVector4sArray(){console.error(\"THREE.BufferAttribute: copyVector4sArray() was removed in r144.\")}}class f extends p{constructor(t,e,r){super(new Int8Array(t),e,r)}}class m extends p{constructor(t,e,r){super(new Uint8Array(t),e,r)}}class y extends p{constructor(t,e,r){super(new Uint8ClampedArray(t),e,r)}}class g extends p{constructor(t,e,r){super(new Int16Array(t),e,r)}}class x extends p{constructor(t,e,r){super(new Uint16Array(t),e,r)}}class v extends p{constructor(t,e,r){super(new Int32Array(t),e,r)}}class b extends p{constructor(t,e,r){super(new Uint32Array(t),e,r)}}class w extends p{constructor(t,e,r){super(new Uint16Array(t),e,r),this.isFloat16BufferAttribute=!0}getX(t){let e=h(this.array[t*this.itemSize]);return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setX(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.array[t*this.itemSize]=l(e),this}getY(t){let e=h(this.array[t*this.itemSize+1]);return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setY(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.array[t*this.itemSize+1]=l(e),this}getZ(t){let e=h(this.array[t*this.itemSize+2]);return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setZ(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.array[t*this.itemSize+2]=l(e),this}getW(t){let e=h(this.array[t*this.itemSize+3]);return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setW(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.array[t*this.itemSize+3]=l(e),this}setXY(t,e,r){return t*=this.itemSize,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array)),this.array[t+0]=l(e),this.array[t+1]=l(r),this}setXYZ(t,e,r,i){return t*=this.itemSize,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array),i=(0,s.normalize)(i,this.array)),this.array[t+0]=l(e),this.array[t+1]=l(r),this.array[t+2]=l(i),this}setXYZW(t,e,r,i,n){return t*=this.itemSize,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array)),this.array[t+0]=l(e),this.array[t+1]=l(r),this.array[t+2]=l(i),this.array[t+3]=l(n),this}}class _ extends p{constructor(t,e,r){super(new Float32Array(t),e,r)}}class M extends p{constructor(t,e,r){super(new Float64Array(t),e,r)}}},1405:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{BufferGeometry:()=>D});var i=r(6815),n=r(5448),s=r(2754);class o{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const r=this._listeners[t];if(void 0!==r){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const r=e.slice(0);for(let e=0,i=r.length;e<i;e++)r[e].call(this,t);t.target=null}}}var a=r(9365);const u=new s.Box3,l=new i.Vector3,h=new i.Vector3;class c{constructor(t=new i.Vector3,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const r=this.center;void 0!==e?r.copy(e):u.setFromPoints(t).getCenter(r);let i=0;for(let e=0,n=t.length;e<n;e++)i=Math.max(i,r.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const r=this.center.distanceToSquared(t);return e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;l.subVectors(t,this.center);const e=l.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),r=.5*(t-this.radius);this.center.addScaledVector(l,r/t),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(h.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(l.copy(t.center).add(h)),this.expandByPoint(l.copy(t.center).sub(h))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}var d=r(9747),p=r(8333),f=r(3334);const m=new p.Matrix4,y=new d._;class g{constructor(t=0,e=0,r=0,i=g.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,r,i=this._order){return this._x=t,this._y=e,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,r=!0){const i=t.elements,n=i[0],s=i[4],o=i[8],a=i[1],u=i[5],l=i[9],h=i[2],c=i[6],d=i[10];switch(e){case\"XYZ\":this._y=Math.asin((0,f.clamp)(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(c,u),this._z=0);break;case\"YXZ\":this._x=Math.asin(-(0,f.clamp)(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,u)):(this._y=Math.atan2(-h,n),this._z=0);break;case\"ZXY\":this._x=Math.asin((0,f.clamp)(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(a,n));break;case\"ZYX\":this._y=Math.asin(-(0,f.clamp)(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(c,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-s,u));break;case\"YZX\":this._z=Math.asin((0,f.clamp)(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(o,d));break;case\"XZY\":this._z=Math.asin(-(0,f.clamp)(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(c,u),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn(\"THREE.Euler: .setFromRotationMatrix() encountered an unknown order: \"+e)}return this._order=e,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,e,r){return m.makeRotationFromQuaternion(t),this.setFromRotationMatrix(m,e,r)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return y.setFromEuler(this),this.setFromQuaternion(y,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}g.DEFAULT_ORDER=\"XYZ\";class x{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}var v=r(8955);let b=0;const w=new i.Vector3,_=new d._,M=new p.Matrix4,E=new i.Vector3,T=new i.Vector3,S=new i.Vector3,A=new d._,z=new i.Vector3(1,0,0),P=new i.Vector3(0,1,0),L=new i.Vector3(0,0,1),O={type:\"added\"},C={type:\"removed\"};class k extends o{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,\"id\",{value:b++}),this.uuid=f.generateUUID(),this.name=\"\",this.type=\"Object3D\",this.parent=null,this.children=[],this.up=k.DEFAULT_UP.clone();const t=new i.Vector3,e=new g,r=new d._,n=new i.Vector3(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new p.Matrix4},normalMatrix:{value:new v.V}}),this.matrix=new p.Matrix4,this.matrixWorld=new p.Matrix4,this.matrixAutoUpdate=k.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=k.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new x,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return _.setFromAxisAngle(t,e),this.quaternion.multiply(_),this}rotateOnWorldAxis(t,e){return _.setFromAxisAngle(t,e),this.quaternion.premultiply(_),this}rotateX(t){return this.rotateOnAxis(z,t)}rotateY(t){return this.rotateOnAxis(P,t)}rotateZ(t){return this.rotateOnAxis(L,t)}translateOnAxis(t,e){return w.copy(t).applyQuaternion(this.quaternion),this.position.add(w.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(z,t)}translateY(t){return this.translateOnAxis(P,t)}translateZ(t){return this.translateOnAxis(L,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(M.copy(this.matrixWorld).invert())}lookAt(t,e,r){t.isVector3?E.copy(t):E.set(t,e,r);const i=this.parent;this.updateWorldMatrix(!0,!1),T.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?M.lookAt(T,E,this.up):M.lookAt(E,T,this.up),this.quaternion.setFromRotationMatrix(M),i&&(M.extractRotation(i.matrixWorld),_.setFromRotationMatrix(M),this.quaternion.premultiply(_.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error(\"THREE.Object3D.add: object can't be added as a child of itself.\",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(O)):console.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(C)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(C)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),M.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),M.multiply(t.parent.matrixWorld)),t.applyMatrix4(M),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty(\"id\",t)}getObjectByName(t){return this.getObjectByProperty(\"name\",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let r=0,i=this.children.length;r<i;r++){const i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e){let r=[];this[t]===e&&r.push(this);for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectsByProperty(t,e);n.length>0&&(r=r.concat(n))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(T,t,S),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(T,A,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let r=0,i=e.length;r<i;r++){const i=e[r];!0!==i.matrixWorldAutoUpdate&&!0!==t||i.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const r=this.parent;if(!0===t&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,r=t.length;e<r;e++){const r=t[e];!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||\"string\"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:\"Object\",generator:\"Object3D.toJSON\"});const i={};function n(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,\"\"!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type=\"InstancedMesh\",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const r=e.shapes;if(Array.isArray(r))for(let e=0,i=r.length;e<i;e++){const i=r[e];n(t.shapes,i)}else n(t.shapes,r)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let r=0,i=this.material.length;r<i;r++)e.push(n(t.materials,this.material[r]));i.material=e}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const r=this.animations[e];i.animations.push(n(t.animations,r))}}if(e){const e=s(t.geometries),i=s(t.materials),n=s(t.textures),o=s(t.images),a=s(t.shapes),u=s(t.skeletons),l=s(t.animations),h=s(t.nodes);e.length>0&&(r.geometries=e),i.length>0&&(r.materials=i),n.length>0&&(r.textures=n),o.length>0&&(r.images=o),a.length>0&&(r.shapes=a),u.length>0&&(r.skeletons=u),l.length>0&&(r.animations=l),h.length>0&&(r.nodes=h)}return r.object=i,r;function s(t){const e=[];for(const r in t){const i=t[r];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const r=t.children[e];this.add(r.clone())}return this}}k.DEFAULT_UP=new i.Vector3(0,1,0),k.DEFAULT_MATRIX_AUTO_UPDATE=!0,k.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let j=0;const V=new p.Matrix4,I=new k,R=new i.Vector3,B=new s.Box3,q=new s.Box3,N=new i.Vector3;class D extends o{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,\"id\",{value:j++}),this.uuid=f.generateUUID(),this.name=\"\",this.type=\"BufferGeometry\",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?a.Uint32BufferAttribute:a.Uint16BufferAttribute)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,r=0){this.groups.push({start:t,count:e,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const e=(new v.V).getNormalMatrix(t);r.applyNormalMatrix(e),r.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return V.makeRotationFromQuaternion(t),this.applyMatrix4(V),this}rotateX(t){return V.makeRotationX(t),this.applyMatrix4(V),this}rotateY(t){return V.makeRotationY(t),this.applyMatrix4(V),this}rotateZ(t){return V.makeRotationZ(t),this.applyMatrix4(V),this}translate(t,e,r){return V.makeTranslation(t,e,r),this.applyMatrix4(V),this}scale(t,e,r){return V.makeScale(t,e,r),this.applyMatrix4(V),this}lookAt(t){return I.lookAt(t),I.updateMatrix(),this.applyMatrix4(I.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(R).negate(),this.translate(R.x,R.y,R.z),this}setFromPoints(t){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];e.push(i.x,i.y,i.z||0)}return this.setAttribute(\"position\",new a.Float32BufferAttribute(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new s.Box3);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".',this),void this.boundingBox.set(new i.Vector3(-1/0,-1/0,-1/0),new i.Vector3(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const r=e[t];B.setFromBufferAttribute(r),this.morphTargetsRelative?(N.addVectors(this.boundingBox.min,B.min),this.boundingBox.expandByPoint(N),N.addVectors(this.boundingBox.max,B.max),this.boundingBox.expandByPoint(N)):(this.boundingBox.expandByPoint(B.min),this.boundingBox.expandByPoint(B.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new c);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".',this),void this.boundingSphere.set(new i.Vector3,1/0);if(t){const r=this.boundingSphere.center;if(B.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const r=e[t];q.setFromBufferAttribute(r),this.morphTargetsRelative?(N.addVectors(B.min,q.min),B.expandByPoint(N),N.addVectors(B.max,q.max),B.expandByPoint(N)):(B.expandByPoint(q.min),B.expandByPoint(q.max))}B.getCenter(r);let i=0;for(let e=0,n=t.count;e<n;e++)N.fromBufferAttribute(t,e),i=Math.max(i,r.distanceToSquared(N));if(e)for(let n=0,s=e.length;n<s;n++){const s=e[n],o=this.morphTargetsRelative;for(let e=0,n=s.count;e<n;e++)N.fromBufferAttribute(s,e),o&&(R.fromBufferAttribute(t,e),N.add(R)),i=Math.max(i,r.distanceToSquared(N))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error(\"THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)\");const r=t.array,s=e.position.array,o=e.normal.array,u=e.uv.array,l=s.length/3;!1===this.hasAttribute(\"tangent\")&&this.setAttribute(\"tangent\",new a.BufferAttribute(new Float32Array(4*l),4));const h=this.getAttribute(\"tangent\").array,c=[],d=[];for(let t=0;t<l;t++)c[t]=new i.Vector3,d[t]=new i.Vector3;const p=new i.Vector3,f=new i.Vector3,m=new i.Vector3,y=new n.Vector2,g=new n.Vector2,x=new n.Vector2,v=new i.Vector3,b=new i.Vector3;function w(t,e,r){p.fromArray(s,3*t),f.fromArray(s,3*e),m.fromArray(s,3*r),y.fromArray(u,2*t),g.fromArray(u,2*e),x.fromArray(u,2*r),f.sub(p),m.sub(p),g.sub(y),x.sub(y);const i=1/(g.x*x.y-x.x*g.y);isFinite(i)&&(v.copy(f).multiplyScalar(x.y).addScaledVector(m,-g.y).multiplyScalar(i),b.copy(m).multiplyScalar(g.x).addScaledVector(f,-x.x).multiplyScalar(i),c[t].add(v),c[e].add(v),c[r].add(v),d[t].add(b),d[e].add(b),d[r].add(b))}let _=this.groups;0===_.length&&(_=[{start:0,count:r.length}]);for(let t=0,e=_.length;t<e;++t){const e=_[t],i=e.start;for(let t=i,n=i+e.count;t<n;t+=3)w(r[t+0],r[t+1],r[t+2])}const M=new i.Vector3,E=new i.Vector3,T=new i.Vector3,S=new i.Vector3;function A(t){T.fromArray(o,3*t),S.copy(T);const e=c[t];M.copy(e),M.sub(T.multiplyScalar(T.dot(e))).normalize(),E.crossVectors(S,e);const r=E.dot(d[t])<0?-1:1;h[4*t]=M.x,h[4*t+1]=M.y,h[4*t+2]=M.z,h[4*t+3]=r}for(let t=0,e=_.length;t<e;++t){const e=_[t],i=e.start;for(let t=i,n=i+e.count;t<n;t+=3)A(r[t+0]),A(r[t+1]),A(r[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute(\"position\");if(void 0!==e){let r=this.getAttribute(\"normal\");if(void 0===r)r=new a.BufferAttribute(new Float32Array(3*e.count),3),this.setAttribute(\"normal\",r);else for(let t=0,e=r.count;t<e;t++)r.setXYZ(t,0,0,0);const n=new i.Vector3,s=new i.Vector3,o=new i.Vector3,u=new i.Vector3,l=new i.Vector3,h=new i.Vector3,c=new i.Vector3,d=new i.Vector3;if(t)for(let i=0,a=t.count;i<a;i+=3){const a=t.getX(i+0),p=t.getX(i+1),f=t.getX(i+2);n.fromBufferAttribute(e,a),s.fromBufferAttribute(e,p),o.fromBufferAttribute(e,f),c.subVectors(o,s),d.subVectors(n,s),c.cross(d),u.fromBufferAttribute(r,a),l.fromBufferAttribute(r,p),h.fromBufferAttribute(r,f),u.add(c),l.add(c),h.add(c),r.setXYZ(a,u.x,u.y,u.z),r.setXYZ(p,l.x,l.y,l.z),r.setXYZ(f,h.x,h.y,h.z)}else for(let t=0,i=e.count;t<i;t+=3)n.fromBufferAttribute(e,t+0),s.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),c.subVectors(o,s),d.subVectors(n,s),c.cross(d),r.setXYZ(t+0,c.x,c.y,c.z),r.setXYZ(t+1,c.x,c.y,c.z),r.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error(\"THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead.\"),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,r=t.count;e<r;e++)N.fromBufferAttribute(t,e),N.normalize(),t.setXYZ(e,N.x,N.y,N.z)}toNonIndexed(){function t(t,e){const r=t.array,i=t.itemSize,n=t.normalized,s=new r.constructor(e.length*i);let o=0,u=0;for(let n=0,a=e.length;n<a;n++){o=t.isInterleavedBufferAttribute?e[n]*t.data.stride+t.offset:e[n]*i;for(let t=0;t<i;t++)s[u++]=r[o++]}return new a.BufferAttribute(s,i,n)}if(null===this.index)return console.warn(\"THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.\"),this;const e=new D,r=this.index.array,i=this.attributes;for(const n in i){const s=t(i[n],r);e.setAttribute(n,s)}const n=this.morphAttributes;for(const i in n){const s=[],o=n[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],r);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,r=s.length;t<r;t++){const r=s[t];e.addGroup(r.start,r.count,r.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:\"BufferGeometry\",generator:\"BufferGeometry.toJSON\"}};if(t.uuid=this.uuid,t.type=this.type,\"\"!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const r=this.attributes;for(const e in r){const i=r[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let n=!1;for(const e in this.morphAttributes){const r=this.morphAttributes[e],s=[];for(let e=0,i=r.length;e<i;e++){const i=r[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const r=t.index;null!==r&&this.setIndex(r.clone(e));const i=t.attributes;for(const t in i){const r=i[t];this.setAttribute(t,r.clone(e))}const n=t.morphAttributes;for(const t in n){const r=[],i=n[t];for(let t=0,n=i.length;t<n;t++)r.push(i[t].clone(e));this.morphAttributes[t]=r}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:\"dispose\"})}}},9044:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{InterleavedBuffer:()=>s});var i=r(3334),n=r(6271);class s{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=n.W2J,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=i.generateUUID()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,r){t*=this.stride,r*=e.stride;for(let i=0,n=this.stride;i<n;i++)this.array[t+i]=e.array[r+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=i.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(e,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=i.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}},6280:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{InterleavedBufferAttribute:()=>a});var i=r(6815),n=r(9365),s=r(3334);const o=new i.Vector3;class a{constructor(t,e,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name=\"\",this.data=t,this.itemSize=e,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,r=this.data.count;e<r;e++)o.fromBufferAttribute(this,e),o.applyMatrix4(t),this.setXYZ(e,o.x,o.y,o.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)o.fromBufferAttribute(this,e),o.applyNormalMatrix(t),this.setXYZ(e,o.x,o.y,o.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)o.fromBufferAttribute(this,e),o.transformDirection(t),this.setXYZ(e,o.x,o.y,o.z);return this}setX(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=(0,s.normalize)(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=(0,s.denormalize)(e,this.array)),e}setXY(t,e,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=r,this}setXYZ(t,e,r,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array),i=(0,s.normalize)(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=i,this}setXYZW(t,e,r,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=(0,s.normalize)(e,this.array),r=(0,s.normalize)(r,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=i,this.data.array[t+3]=n,this}clone(t){if(void 0===t){console.log(\"THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.\");const t=[];for(let e=0;e<this.count;e++){const r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return new n.BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new a(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log(\"THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.\");const t=[];for(let e=0;e<this.count;e++){const r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}},6782:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{Earcut:()=>i});const i={triangulate:function(t,e,r=2){const i=e&&e.length,s=i?e[0]*r:t.length;let a=n(t,0,s,r,!0);const u=[];if(!a||a.next===a.prev)return u;let l,h,p,f,y,g,x;if(i&&(a=function(t,e,r,i){const s=[];let o,a,u,l,h;for(o=0,a=e.length;o<a;o++)u=e[o]*i,l=o<a-1?e[o+1]*i:t.length,h=n(t,u,l,i,!1),h===h.next&&(h.steiner=!0),s.push(m(h));for(s.sort(c),o=0;o<s.length;o++)r=d(s[o],r);return r}(t,e,a,r)),t.length>80*r){l=p=t[0],h=f=t[1];for(let e=r;e<s;e+=r)y=t[e],g=t[e+1],y<l&&(l=y),g<h&&(h=g),y>p&&(p=y),g>f&&(f=g);x=Math.max(p-l,f-h),x=0!==x?32767/x:0}return o(a,u,r,l,h,x,0),u}};function n(t,e,r,i,n){let s,o;if(n===function(t,e,r,i){let n=0;for(let s=e,o=r-i;s<r;s+=i)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}(t,e,r,i)>0)for(s=e;s<r;s+=i)o=T(s,t[s],t[s+1],o);else for(s=r-i;s>=e;s-=i)o=T(s,t[s],t[s+1],o);return o&&v(o,o.next)&&(S(o),o=o.next),o}function s(t,e){if(!t)return t;e||(e=t);let r,i=t;do{if(r=!1,i.steiner||!v(i,i.next)&&0!==x(i.prev,i,i.next))i=i.next;else{if(S(i),i=e=i.prev,i===i.next)break;r=!0}}while(r||i!==e);return e}function o(t,e,r,i,n,c,d){if(!t)return;!d&&c&&function(t,e,r,i){let n=t;do{0===n.z&&(n.z=f(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){let e,r,i,n,s,o,a,u,l=1;do{for(r=t,t=null,s=null,o=0;r;){for(o++,i=r,a=0,e=0;e<l&&(a++,i=i.nextZ,i);e++);for(u=l;a>0||u>0&&i;)0!==a&&(0===u||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,u--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;r=i}s.nextZ=null,l*=2}while(o>1)}(n)}(t,i,n,c);let p,m,y=t;for(;t.prev!==t.next;)if(p=t.prev,m=t.next,c?u(t,i,n,c):a(t))e.push(p.i/r|0),e.push(t.i/r|0),e.push(m.i/r|0),S(t),t=m.next,y=m.next;else if((t=m)===y){d?1===d?o(t=l(s(t),e,r),e,r,i,n,c,2):2===d&&h(t,e,r,i,n,c):o(s(t),e,r,i,n,c,1);break}}function a(t){const e=t.prev,r=t,i=t.next;if(x(e,r,i)>=0)return!1;const n=e.x,s=r.x,o=i.x,a=e.y,u=r.y,l=i.y,h=n<s?n<o?n:o:s<o?s:o,c=a<u?a<l?a:l:u<l?u:l,d=n>s?n>o?n:o:s>o?s:o,p=a>u?a>l?a:l:u>l?u:l;let f=i.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=c&&f.y<=p&&y(n,a,s,u,o,l,f.x,f.y)&&x(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function u(t,e,r,i){const n=t.prev,s=t,o=t.next;if(x(n,s,o)>=0)return!1;const a=n.x,u=s.x,l=o.x,h=n.y,c=s.y,d=o.y,p=a<u?a<l?a:l:u<l?u:l,m=h<c?h<d?h:d:c<d?c:d,g=a>u?a>l?a:l:u>l?u:l,v=h>c?h>d?h:d:c>d?c:d,b=f(p,m,e,r,i),w=f(g,v,e,r,i);let _=t.prevZ,M=t.nextZ;for(;_&&_.z>=b&&M&&M.z<=w;){if(_.x>=p&&_.x<=g&&_.y>=m&&_.y<=v&&_!==n&&_!==o&&y(a,h,u,c,l,d,_.x,_.y)&&x(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,M.x>=p&&M.x<=g&&M.y>=m&&M.y<=v&&M!==n&&M!==o&&y(a,h,u,c,l,d,M.x,M.y)&&x(M.prev,M,M.next)>=0)return!1;M=M.nextZ}for(;_&&_.z>=b;){if(_.x>=p&&_.x<=g&&_.y>=m&&_.y<=v&&_!==n&&_!==o&&y(a,h,u,c,l,d,_.x,_.y)&&x(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;M&&M.z<=w;){if(M.x>=p&&M.x<=g&&M.y>=m&&M.y<=v&&M!==n&&M!==o&&y(a,h,u,c,l,d,M.x,M.y)&&x(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function l(t,e,r){let i=t;do{const n=i.prev,s=i.next.next;!v(n,s)&&b(n,i,i.next,s)&&M(n,s)&&M(s,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(s.i/r|0),S(i),S(i.next),i=t=s),i=i.next}while(i!==t);return s(i)}function h(t,e,r,i,n,a){let u=t;do{let t=u.next.next;for(;t!==u.prev;){if(u.i!==t.i&&g(u,t)){let l=E(u,t);return u=s(u,u.next),l=s(l,l.next),o(u,e,r,i,n,a,0),void o(l,e,r,i,n,a,0)}t=t.next}u=u.next}while(u!==t)}function c(t,e){return t.x-e.x}function d(t,e){const r=function(t,e){let r,i=e,n=-1/0;const s=t.x,o=t.y;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){const t=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>n&&(n=t,r=i.x<i.next.x?i:i.next,t===s))return r}i=i.next}while(i!==e);if(!r)return null;const a=r,u=r.x,l=r.y;let h,c=1/0;i=r;do{s>=i.x&&i.x>=u&&s!==i.x&&y(o<l?s:n,o,u,l,o<l?n:s,o,i.x,i.y)&&(h=Math.abs(o-i.y)/(s-i.x),M(i,t)&&(h<c||h===c&&(i.x>r.x||i.x===r.x&&p(r,i)))&&(r=i,c=h)),i=i.next}while(i!==a);return r}(t,e);if(!r)return e;const i=E(r,t);return s(i,i.next),s(r,r.next)}function p(t,e){return x(t.prev,t,e.prev)<0&&x(e.next,t,t.next)<0}function f(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function m(t){let e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function y(t,e,r,i,n,s,o,a){return(n-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(n-o)*(i-a)}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&b(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(M(t,e)&&M(e,t)&&function(t,e){let r=t,i=!1;const n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(x(t.prev,t,e.prev)||x(t,e.prev,e))||v(t,e)&&x(t.prev,t,t.next)>0&&x(e.prev,e,e.next)>0)}function x(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,r,i){const n=_(x(t,e,r)),s=_(x(t,e,i)),o=_(x(r,i,t)),a=_(x(r,i,e));return n!==s&&o!==a||!(0!==n||!w(t,r,e))||!(0!==s||!w(t,i,e))||!(0!==o||!w(r,t,i))||!(0!==a||!w(r,e,i))}function w(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function _(t){return t>0?1:t<0?-1:0}function M(t,e){return x(t.prev,t,t.next)<0?x(t,e,t.next)>=0&&x(t,t.prev,e)>=0:x(t,e,t.prev)<0||x(t,t.next,e)<0}function E(t,e){const r=new A(t.i,t.x,t.y),i=new A(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function T(t,e,r,i){const n=new A(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function A(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}},9776:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{ShapeUtils:()=>n});var i=r(6782);class n{static area(t){const e=t.length;let r=0;for(let i=e-1,n=0;n<e;i=n++)r+=t[i].x*t[n].y-t[n].x*t[i].y;return.5*r}static isClockWise(t){return n.area(t)<0}static triangulateShape(t,e){const r=[],n=[],a=[];s(t),o(r,t);let u=t.length;e.forEach(s);for(let t=0;t<e.length;t++)n.push(u),u+=e[t].length,o(r,e[t]);const l=i.Earcut.triangulate(r,n);for(let t=0;t<l.length;t+=3)a.push(l.slice(t,t+3));return a}}function s(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function o(t,e){for(let r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}},2754:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{Box3:()=>n});var i=r(6815);class n{constructor(t=new i.Vector3(1/0,1/0,1/0),e=new i.Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e+=3)this.expandByPoint(o.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,r=t.count;e<r;e++)this.expandByPoint(o.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=o.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),void 0!==t.boundingBox)null===t.boundingBox&&t.computeBoundingBox(),a.copy(t.boundingBox),a.applyMatrix4(t.matrixWorld),this.union(a);else{const r=t.geometry;if(void 0!==r)if(e&&void 0!==r.attributes&&void 0!==r.attributes.position){const e=r.attributes.position;for(let r=0,i=e.count;r<i;r++)o.fromBufferAttribute(e,r).applyMatrix4(t.matrixWorld),this.expandByPoint(o)}else null===r.boundingBox&&r.computeBoundingBox(),a.copy(r.boundingBox),a.applyMatrix4(t.matrixWorld),this.union(a)}const r=t.children;for(let t=0,i=r.length;t<i;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,o),o.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(f),m.subVectors(this.max,f),u.subVectors(t.a,f),l.subVectors(t.b,f),h.subVectors(t.c,f),c.subVectors(l,u),d.subVectors(h,l),p.subVectors(u,h);let e=[0,-c.z,c.y,0,-d.z,d.y,0,-p.z,p.y,c.z,0,-c.x,d.z,0,-d.x,p.z,0,-p.x,-c.y,c.x,0,-d.y,d.x,0,-p.y,p.x,0];return!!x(e,u,l,h,m)&&(e=[1,0,0,0,1,0,0,0,1],!!x(e,u,l,h,m)&&(y.crossVectors(c,d),e=[y.x,y.y,y.z],x(e,u,l,h,m)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,o).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(o).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(s[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),s[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),s[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),s[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),s[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),s[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),s[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),s[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(s)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const s=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3],o=new i.Vector3,a=new n,u=new i.Vector3,l=new i.Vector3,h=new i.Vector3,c=new i.Vector3,d=new i.Vector3,p=new i.Vector3,f=new i.Vector3,m=new i.Vector3,y=new i.Vector3,g=new i.Vector3;function x(t,e,r,i,n){for(let s=0,o=t.length-3;s<=o;s+=3){g.fromArray(t,s);const o=n.x*Math.abs(g.x)+n.y*Math.abs(g.y)+n.z*Math.abs(g.z),a=e.dot(g),u=r.dot(g),l=i.dot(g);if(Math.max(-Math.max(a,u,l),Math.min(a,u,l))>o)return!1}return!0}},3096:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{Color:()=>g});var i=r(3334),n=r(6271),s=r(8955);function o(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function a(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const u=(new s.V).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),l=(new s.V).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),h={[n.GUF]:t=>t,[n.KI_]:t=>t.convertSRGBToLinear(),[n.ntt]:function(t){return t.convertSRGBToLinear().applyMatrix3(l)}},c={[n.GUF]:t=>t,[n.KI_]:t=>t.convertLinearToSRGB(),[n.ntt]:function(t){return t.applyMatrix3(u).convertLinearToSRGB()}},d={enabled:!0,get legacyMode(){return console.warn(\"THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150.\"),!this.enabled},set legacyMode(t){console.warn(\"THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150.\"),this.enabled=!t},get workingColorSpace(){return n.GUF},set workingColorSpace(t){console.warn(\"THREE.ColorManagement: .workingColorSpace is readonly.\")},convert:function(t,e,r){if(!1===this.enabled||e===r||!e||!r)return t;const i=h[e],n=c[r];if(void 0===i||void 0===n)throw new Error(`Unsupported color space conversion, \"${e}\" to \"${r}\".`);return n(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},p={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},f={h:0,s:0,l:0},m={h:0,s:0,l:0};function y(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}class g{constructor(t,e,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}set(t){return t&&t.isColor?this.copy(t):\"number\"==typeof t?this.setHex(t):\"string\"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=n.KI_){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,d.toWorkingColorSpace(this,e),this}setRGB(t,e,r,i=d.workingColorSpace){return this.r=t,this.g=e,this.b=r,d.toWorkingColorSpace(this,i),this}setHSL(t,e,r,n=d.workingColorSpace){if(t=(0,i.euclideanModulo)(t,1),e=(0,i.clamp)(e,0,1),r=(0,i.clamp)(r,0,1),0===e)this.r=this.g=this.b=r;else{const i=r<=.5?r*(1+e):r+e-r*e,n=2*r-i;this.r=y(n,i,t+1/3),this.g=y(n,i,t),this.b=y(n,i,t-1/3)}return d.toWorkingColorSpace(this,n),this}setStyle(t,e=n.KI_){function r(e){void 0!==e&&parseFloat(e)<1&&console.warn(\"THREE.Color: Alpha component of \"+t+\" will be ignored.\")}let i;if(i=/^(\\w+)\\(([^\\)]*)\\)/.exec(t)){let n;const s=i[1],o=i[2];switch(s){case\"rgb\":case\"rgba\":if(n=/^\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(o))return r(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(o))return r(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case\"hsl\":case\"hsla\":if(n=/^\\s*(\\d*\\.?\\d+)\\s*,\\s*(\\d*\\.?\\d+)\\%\\s*,\\s*(\\d*\\.?\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(o))return r(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn(\"THREE.Color: Unknown color model \"+t)}}else if(i=/^\\#([A-Fa-f\\d]+)$/.exec(t)){const r=i[1],n=r.length;if(3===n)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(6===n)return this.setHex(parseInt(r,16),e);console.warn(\"THREE.Color: Invalid hex color \"+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=n.KI_){const r=p[t.toLowerCase()];return void 0!==r?this.setHex(r,e):console.warn(\"THREE.Color: Unknown color \"+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=o(t.r),this.g=o(t.g),this.b=o(t.b),this}copyLinearToSRGB(t){return this.r=a(t.r),this.g=a(t.g),this.b=a(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=n.KI_){return d.fromWorkingColorSpace(x.copy(this),t),65536*Math.round((0,i.clamp)(255*x.r,0,255))+256*Math.round((0,i.clamp)(255*x.g,0,255))+Math.round((0,i.clamp)(255*x.b,0,255))}getHexString(t=n.KI_){return(\"000000\"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=d.workingColorSpace){d.fromWorkingColorSpace(x.copy(this),e);const r=x.r,i=x.g,n=x.b,s=Math.max(r,i,n),o=Math.min(r,i,n);let a,u;const l=(o+s)/2;if(o===s)a=0,u=0;else{const t=s-o;switch(u=l<=.5?t/(s+o):t/(2-s-o),s){case r:a=(i-n)/t+(i<n?6:0);break;case i:a=(n-r)/t+2;break;case n:a=(r-i)/t+4}a/=6}return t.h=a,t.s=u,t.l=l,t}getRGB(t,e=d.workingColorSpace){return d.fromWorkingColorSpace(x.copy(this),e),t.r=x.r,t.g=x.g,t.b=x.b,t}getStyle(t=n.KI_){d.fromWorkingColorSpace(x.copy(this),t);const e=x.r,r=x.g,i=x.b;return t!==n.KI_?`color(${t} ${e.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*i)})`}offsetHSL(t,e,r){return this.getHSL(f),f.h+=t,f.s+=e,f.l+=r,this.setHSL(f.h,f.s,f.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,r){return this.r=t.r+(e.r-t.r)*r,this.g=t.g+(e.g-t.g)*r,this.b=t.b+(e.b-t.b)*r,this}lerpHSL(t,e){this.getHSL(f),t.getHSL(m);const r=(0,i.lerp)(f.h,m.h,e),n=(0,i.lerp)(f.s,m.s,e),s=(0,i.lerp)(f.l,m.l,e);return this.setHSL(r,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,r=this.g,i=this.b,n=t.elements;return this.r=n[0]*e+n[3]*r+n[6]*i,this.g=n[1]*e+n[4]*r+n[7]*i,this.b=n[2]*e+n[5]*r+n[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const x=new g;g.NAMES=p},414:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{Line3:()=>a});var i=r(6815),n=r(3334);const s=new i.Vector3,o=new i.Vector3;class a{constructor(t=new i.Vector3,e=new i.Vector3){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){s.subVectors(t,this.start),o.subVectors(this.end,this.start);const r=o.dot(o);let i=o.dot(s)/r;return e&&(i=n.clamp(i,0,1)),i}closestPointToPoint(t,e,r){const i=this.closestPointToPointParameter(t,e);return this.delta(r).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}},3334:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{DEG2RAD:()=>s,MathUtils:()=>P,RAD2DEG:()=>o,ceilPowerOfTwo:()=>E,clamp:()=>u,damp:()=>p,degToRad:()=>w,denormalize:()=>A,euclideanModulo:()=>l,floorPowerOfTwo:()=>T,generateUUID:()=>a,inverseLerp:()=>c,isPowerOfTwo:()=>M,lerp:()=>d,mapLinear:()=>h,normalize:()=>z,pingpong:()=>f,radToDeg:()=>_,randFloat:()=>x,randFloatSpread:()=>v,randInt:()=>g,seededRandom:()=>b,setQuaternionFromProperEuler:()=>S,smootherstep:()=>y,smoothstep:()=>m});const i=[\"00\",\"01\",\"02\",\"03\",\"04\",\"05\",\"06\",\"07\",\"08\",\"09\",\"0a\",\"0b\",\"0c\",\"0d\",\"0e\",\"0f\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"1a\",\"1b\",\"1c\",\"1d\",\"1e\",\"1f\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"2a\",\"2b\",\"2c\",\"2d\",\"2e\",\"2f\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"3a\",\"3b\",\"3c\",\"3d\",\"3e\",\"3f\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"4a\",\"4b\",\"4c\",\"4d\",\"4e\",\"4f\",\"50\",\"51\",\"52\",\"53\",\"54\",\"55\",\"56\",\"57\",\"58\",\"59\",\"5a\",\"5b\",\"5c\",\"5d\",\"5e\",\"5f\",\"60\",\"61\",\"62\",\"63\",\"64\",\"65\",\"66\",\"67\",\"68\",\"69\",\"6a\",\"6b\",\"6c\",\"6d\",\"6e\",\"6f\",\"70\",\"71\",\"72\",\"73\",\"74\",\"75\",\"76\",\"77\",\"78\",\"79\",\"7a\",\"7b\",\"7c\",\"7d\",\"7e\",\"7f\",\"80\",\"81\",\"82\",\"83\",\"84\",\"85\",\"86\",\"87\",\"88\",\"89\",\"8a\",\"8b\",\"8c\",\"8d\",\"8e\",\"8f\",\"90\",\"91\",\"92\",\"93\",\"94\",\"95\",\"96\",\"97\",\"98\",\"99\",\"9a\",\"9b\",\"9c\",\"9d\",\"9e\",\"9f\",\"a0\",\"a1\",\"a2\",\"a3\",\"a4\",\"a5\",\"a6\",\"a7\",\"a8\",\"a9\",\"aa\",\"ab\",\"ac\",\"ad\",\"ae\",\"af\",\"b0\",\"b1\",\"b2\",\"b3\",\"b4\",\"b5\",\"b6\",\"b7\",\"b8\",\"b9\",\"ba\",\"bb\",\"bc\",\"bd\",\"be\",\"bf\",\"c0\",\"c1\",\"c2\",\"c3\",\"c4\",\"c5\",\"c6\",\"c7\",\"c8\",\"c9\",\"ca\",\"cb\",\"cc\",\"cd\",\"ce\",\"cf\",\"d0\",\"d1\",\"d2\",\"d3\",\"d4\",\"d5\",\"d6\",\"d7\",\"d8\",\"d9\",\"da\",\"db\",\"dc\",\"dd\",\"de\",\"df\",\"e0\",\"e1\",\"e2\",\"e3\",\"e4\",\"e5\",\"e6\",\"e7\",\"e8\",\"e9\",\"ea\",\"eb\",\"ec\",\"ed\",\"ee\",\"ef\",\"f0\",\"f1\",\"f2\",\"f3\",\"f4\",\"f5\",\"f6\",\"f7\",\"f8\",\"f9\",\"fa\",\"fb\",\"fc\",\"fd\",\"fe\",\"ff\"];let n=1234567;const s=Math.PI/180,o=180/Math.PI;function a(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(i[255&t]+i[t>>8&255]+i[t>>16&255]+i[t>>24&255]+\"-\"+i[255&e]+i[e>>8&255]+\"-\"+i[e>>16&15|64]+i[e>>24&255]+\"-\"+i[63&r|128]+i[r>>8&255]+\"-\"+i[r>>16&255]+i[r>>24&255]+i[255&n]+i[n>>8&255]+i[n>>16&255]+i[n>>24&255]).toLowerCase()}function u(t,e,r){return Math.max(e,Math.min(r,t))}function l(t,e){return(t%e+e)%e}function h(t,e,r,i,n){return i+(t-e)*(n-i)/(r-e)}function c(t,e,r){return t!==e?(r-t)/(e-t):0}function d(t,e,r){return(1-r)*t+r*e}function p(t,e,r,i){return d(t,e,1-Math.exp(-r*i))}function f(t,e=1){return e-Math.abs(l(t,2*e)-e)}function m(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)}function y(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)}function g(t,e){return t+Math.floor(Math.random()*(e-t+1))}function x(t,e){return t+Math.random()*(e-t)}function v(t){return t*(.5-Math.random())}function b(t){void 0!==t&&(n=t);let e=n+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}function w(t){return t*s}function _(t){return t*o}function M(t){return!(t&t-1)&&0!==t}function E(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function T(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function S(t,e,r,i,n){const s=Math.cos,o=Math.sin,a=s(r/2),u=o(r/2),l=s((e+i)/2),h=o((e+i)/2),c=s((e-i)/2),d=o((e-i)/2),p=s((i-e)/2),f=o((i-e)/2);switch(n){case\"XYX\":t.set(a*h,u*c,u*d,a*l);break;case\"YZY\":t.set(u*d,a*h,u*c,a*l);break;case\"ZXZ\":t.set(u*c,u*d,a*h,a*l);break;case\"XZX\":t.set(a*h,u*f,u*p,a*l);break;case\"YXY\":t.set(u*p,a*h,u*f,a*l);break;case\"ZYZ\":t.set(u*f,u*p,a*h,a*l);break;default:console.warn(\"THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: \"+n)}}function A(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error(\"Invalid component type.\")}}function z(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error(\"Invalid component type.\")}}const P={DEG2RAD:s,RAD2DEG:o,generateUUID:a,clamp:u,euclideanModulo:l,mapLinear:h,inverseLerp:c,lerp:d,damp:p,pingpong:f,smoothstep:m,smootherstep:y,randInt:g,randFloat:x,randFloatSpread:v,seededRandom:b,degToRad:w,radToDeg:_,isPowerOfTwo:M,ceilPowerOfTwo:E,floorPowerOfTwo:T,setQuaternionFromProperEuler:S,normalize:z,denormalize:A}},8955:(t,e,r)=>{\"use strict\";r.d(e,{V:()=>i});class i{constructor(){i.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,r,i,n,s,o,a,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=o,l[3]=e,l[4]=n,l[5]=a,l[6]=r,l[7]=s,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,n=this.elements,s=r[0],o=r[3],a=r[6],u=r[1],l=r[4],h=r[7],c=r[2],d=r[5],p=r[8],f=i[0],m=i[3],y=i[6],g=i[1],x=i[4],v=i[7],b=i[2],w=i[5],_=i[8];return n[0]=s*f+o*g+a*b,n[3]=s*m+o*x+a*w,n[6]=s*y+o*v+a*_,n[1]=u*f+l*g+h*b,n[4]=u*m+l*x+h*w,n[7]=u*y+l*v+h*_,n[2]=c*f+d*g+p*b,n[5]=c*m+d*x+p*w,n[8]=c*y+d*v+p*_,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],l=t[8];return e*s*l-e*o*u-r*n*l+r*o*a+i*n*u-i*s*a}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],l=t[8],h=l*s-o*u,c=o*a-l*n,d=u*n-s*a,p=e*h+r*c+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(i*u-l*r)*f,t[2]=(o*r-i*s)*f,t[3]=c*f,t[4]=(l*e-i*a)*f,t[5]=(i*n-o*e)*f,t[6]=d*f,t[7]=(r*a-u*e)*f,t[8]=(s*e-r*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,i,n,s,o){const a=Math.cos(n),u=Math.sin(n);return this.set(r*a,r*u,-r*(a*s+u*o)+s+t,-i*u,i*a,-i*(-u*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(n.makeScale(t,e)),this}rotate(t){return this.premultiply(n.makeRotation(-t)),this}translate(t,e){return this.premultiply(n.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,r,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,r=t.elements;for(let t=0;t<9;t++)if(e[t]!==r[t])return!1;return!0}fromArray(t,e=0){for(let r=0;r<9;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const n=new i},8333:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{Matrix4:()=>n});var i=r(6815);class n{constructor(){n.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,r,i,n,s,o,a,u,l,h,c,d,p,f,m){const y=this.elements;return y[0]=t,y[4]=e,y[8]=r,y[12]=i,y[1]=n,y[5]=s,y[9]=o,y[13]=a,y[2]=u,y[6]=l,y[10]=h,y[14]=c,y[3]=d,y[7]=p,y[11]=f,y[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new n).fromArray(this.elements)}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}copyPosition(t){const e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,r=t.elements,i=1/s.setFromMatrixColumn(t,0).length(),n=1/s.setFromMatrixColumn(t,1).length(),o=1/s.setFromMatrixColumn(t,2).length();return e[0]=r[0]*i,e[1]=r[1]*i,e[2]=r[2]*i,e[3]=0,e[4]=r[4]*n,e[5]=r[5]*n,e[6]=r[6]*n,e[7]=0,e[8]=r[8]*o,e[9]=r[9]*o,e[10]=r[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,r=t.x,i=t.y,n=t.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(i),u=Math.sin(i),l=Math.cos(n),h=Math.sin(n);if(\"XYZ\"===t.order){const t=s*l,r=s*h,i=o*l,n=o*h;e[0]=a*l,e[4]=-a*h,e[8]=u,e[1]=r+i*u,e[5]=t-n*u,e[9]=-o*a,e[2]=n-t*u,e[6]=i+r*u,e[10]=s*a}else if(\"YXZ\"===t.order){const t=a*l,r=a*h,i=u*l,n=u*h;e[0]=t+n*o,e[4]=i*o-r,e[8]=s*u,e[1]=s*h,e[5]=s*l,e[9]=-o,e[2]=r*o-i,e[6]=n+t*o,e[10]=s*a}else if(\"ZXY\"===t.order){const t=a*l,r=a*h,i=u*l,n=u*h;e[0]=t-n*o,e[4]=-s*h,e[8]=i+r*o,e[1]=r+i*o,e[5]=s*l,e[9]=n-t*o,e[2]=-s*u,e[6]=o,e[10]=s*a}else if(\"ZYX\"===t.order){const t=s*l,r=s*h,i=o*l,n=o*h;e[0]=a*l,e[4]=i*u-r,e[8]=t*u+n,e[1]=a*h,e[5]=n*u+t,e[9]=r*u-i,e[2]=-u,e[6]=o*a,e[10]=s*a}else if(\"YZX\"===t.order){const t=s*a,r=s*u,i=o*a,n=o*u;e[0]=a*l,e[4]=n-t*h,e[8]=i*h+r,e[1]=h,e[5]=s*l,e[9]=-o*l,e[2]=-u*l,e[6]=r*h+i,e[10]=t-n*h}else if(\"XZY\"===t.order){const t=s*a,r=s*u,i=o*a,n=o*u;e[0]=a*l,e[4]=-h,e[8]=u*l,e[1]=t*h+n,e[5]=s*l,e[9]=r*h-i,e[2]=i*h-r,e[6]=o*l,e[10]=n*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(a,t,u)}lookAt(t,e,r){const i=this.elements;return c.subVectors(t,e),0===c.lengthSq()&&(c.z=1),c.normalize(),l.crossVectors(r,c),0===l.lengthSq()&&(1===Math.abs(r.z)?c.x+=1e-4:c.z+=1e-4,c.normalize(),l.crossVectors(r,c)),l.normalize(),h.crossVectors(c,l),i[0]=l.x,i[4]=h.x,i[8]=c.x,i[1]=l.y,i[5]=h.y,i[9]=c.y,i[2]=l.z,i[6]=h.z,i[10]=c.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,n=this.elements,s=r[0],o=r[4],a=r[8],u=r[12],l=r[1],h=r[5],c=r[9],d=r[13],p=r[2],f=r[6],m=r[10],y=r[14],g=r[3],x=r[7],v=r[11],b=r[15],w=i[0],_=i[4],M=i[8],E=i[12],T=i[1],S=i[5],A=i[9],z=i[13],P=i[2],L=i[6],O=i[10],C=i[14],k=i[3],j=i[7],V=i[11],I=i[15];return n[0]=s*w+o*T+a*P+u*k,n[4]=s*_+o*S+a*L+u*j,n[8]=s*M+o*A+a*O+u*V,n[12]=s*E+o*z+a*C+u*I,n[1]=l*w+h*T+c*P+d*k,n[5]=l*_+h*S+c*L+d*j,n[9]=l*M+h*A+c*O+d*V,n[13]=l*E+h*z+c*C+d*I,n[2]=p*w+f*T+m*P+y*k,n[6]=p*_+f*S+m*L+y*j,n[10]=p*M+f*A+m*O+y*V,n[14]=p*E+f*z+m*C+y*I,n[3]=g*w+x*T+v*P+b*k,n[7]=g*_+x*S+v*L+b*j,n[11]=g*M+x*A+v*O+b*V,n[15]=g*E+x*z+v*C+b*I,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[4],i=t[8],n=t[12],s=t[1],o=t[5],a=t[9],u=t[13],l=t[2],h=t[6],c=t[10],d=t[14];return t[3]*(+n*a*h-i*u*h-n*o*c+r*u*c+i*o*d-r*a*d)+t[7]*(+e*a*d-e*u*c+n*s*c-i*s*d+i*u*l-n*a*l)+t[11]*(+e*u*h-e*o*d-n*s*h+r*s*d+n*o*l-r*u*l)+t[15]*(-i*o*l-e*a*h+e*o*c+i*s*h-r*s*c+r*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,r){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=r),this}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],l=t[8],h=t[9],c=t[10],d=t[11],p=t[12],f=t[13],m=t[14],y=t[15],g=h*m*u-f*c*u+f*a*d-o*m*d-h*a*y+o*c*y,x=p*c*u-l*m*u-p*a*d+s*m*d+l*a*y-s*c*y,v=l*f*u-p*h*u+p*o*d-s*f*d-l*o*y+s*h*y,b=p*h*a-l*f*a-p*o*c+s*f*c+l*o*m-s*h*m,w=e*g+r*x+i*v+n*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/w;return t[0]=g*_,t[1]=(f*c*n-h*m*n-f*i*d+r*m*d+h*i*y-r*c*y)*_,t[2]=(o*m*n-f*a*n+f*i*u-r*m*u-o*i*y+r*a*y)*_,t[3]=(h*a*n-o*c*n-h*i*u+r*c*u+o*i*d-r*a*d)*_,t[4]=x*_,t[5]=(l*m*n-p*c*n+p*i*d-e*m*d-l*i*y+e*c*y)*_,t[6]=(p*a*n-s*m*n-p*i*u+e*m*u+s*i*y-e*a*y)*_,t[7]=(s*c*n-l*a*n+l*i*u-e*c*u-s*i*d+e*a*d)*_,t[8]=v*_,t[9]=(p*h*n-l*f*n-p*r*d+e*f*d+l*r*y-e*h*y)*_,t[10]=(s*f*n-p*o*n+p*r*u-e*f*u-s*r*y+e*o*y)*_,t[11]=(l*o*n-s*h*n-l*r*u+e*h*u+s*r*d-e*o*d)*_,t[12]=b*_,t[13]=(l*f*i-p*h*i+p*r*c-e*f*c-l*r*m+e*h*m)*_,t[14]=(p*o*i-s*f*i-p*r*a+e*f*a+s*r*m-e*o*m)*_,t[15]=(s*h*i-l*o*i+l*r*a-e*h*a-s*r*c+e*o*c)*_,this}scale(t){const e=this.elements,r=t.x,i=t.y,n=t.z;return e[0]*=r,e[4]*=i,e[8]*=n,e[1]*=r,e[5]*=i,e[9]*=n,e[2]*=r,e[6]*=i,e[10]*=n,e[3]*=r,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}makeTranslation(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const r=Math.cos(e),i=Math.sin(e),n=1-r,s=t.x,o=t.y,a=t.z,u=n*s,l=n*o;return this.set(u*s+r,u*o-i*a,u*a+i*o,0,u*o+i*a,l*o+r,l*a-i*s,0,u*a-i*o,l*a+i*s,n*a*a+r,0,0,0,0,1),this}makeScale(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,e,r,i,n,s){return this.set(1,r,n,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,r){const i=this.elements,n=e._x,s=e._y,o=e._z,a=e._w,u=n+n,l=s+s,h=o+o,c=n*u,d=n*l,p=n*h,f=s*l,m=s*h,y=o*h,g=a*u,x=a*l,v=a*h,b=r.x,w=r.y,_=r.z;return i[0]=(1-(f+y))*b,i[1]=(d+v)*b,i[2]=(p-x)*b,i[3]=0,i[4]=(d-v)*w,i[5]=(1-(c+y))*w,i[6]=(m+g)*w,i[7]=0,i[8]=(p+x)*_,i[9]=(m-g)*_,i[10]=(1-(c+f))*_,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,r){const i=this.elements;let n=s.set(i[0],i[1],i[2]).length();const a=s.set(i[4],i[5],i[6]).length(),u=s.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],o.copy(this);const l=1/n,h=1/a,c=1/u;return o.elements[0]*=l,o.elements[1]*=l,o.elements[2]*=l,o.elements[4]*=h,o.elements[5]*=h,o.elements[6]*=h,o.elements[8]*=c,o.elements[9]*=c,o.elements[10]*=c,e.setFromRotationMatrix(o),r.x=n,r.y=a,r.z=u,this}makePerspective(t,e,r,i,n,s){const o=this.elements,a=2*n/(e-t),u=2*n/(r-i),l=(e+t)/(e-t),h=(r+i)/(r-i),c=-(s+n)/(s-n),d=-2*s*n/(s-n);return o[0]=a,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,r,i,n,s){const o=this.elements,a=1/(e-t),u=1/(r-i),l=1/(s-n),h=(e+t)*a,c=(r+i)*u,d=(s+n)*l;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,r=t.elements;for(let t=0;t<16;t++)if(e[t]!==r[t])return!1;return!0}fromArray(t,e=0){for(let r=0;r<16;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}const s=new i.Vector3,o=new n,a=new i.Vector3(0,0,0),u=new i.Vector3(1,1,1),l=new i.Vector3,h=new i.Vector3,c=new i.Vector3},9747:(t,e,r)=>{\"use strict\";r.d(e,{_:()=>n});var i=r(3334);class n{constructor(t=0,e=0,r=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=r,this._w=i}static slerpFlat(t,e,r,i,n,s,o){let a=r[i+0],u=r[i+1],l=r[i+2],h=r[i+3];const c=n[s+0],d=n[s+1],p=n[s+2],f=n[s+3];if(0===o)return t[e+0]=a,t[e+1]=u,t[e+2]=l,void(t[e+3]=h);if(1===o)return t[e+0]=c,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==c||u!==d||l!==p){let t=1-o;const e=a*c+u*d+l*p+h*f,r=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const n=Math.sqrt(i),s=Math.atan2(n,e*r);t=Math.sin(t*s)/n,o=Math.sin(o*s)/n}const n=o*r;if(a=a*t+c*n,u=u*t+d*n,l=l*t+p*n,h=h*t+f*n,t===1-o){const t=1/Math.sqrt(a*a+u*u+l*l+h*h);a*=t,u*=t,l*=t,h*=t}}t[e]=a,t[e+1]=u,t[e+2]=l,t[e+3]=h}static multiplyQuaternionsFlat(t,e,r,i,n,s){const o=r[i],a=r[i+1],u=r[i+2],l=r[i+3],h=n[s],c=n[s+1],d=n[s+2],p=n[s+3];return t[e]=o*p+l*h+a*d-u*c,t[e+1]=a*p+l*c+u*h-o*d,t[e+2]=u*p+l*d+o*c-a*h,t[e+3]=l*p-o*h-a*c-u*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const r=t._x,i=t._y,n=t._z,s=t._order,o=Math.cos,a=Math.sin,u=o(r/2),l=o(i/2),h=o(n/2),c=a(r/2),d=a(i/2),p=a(n/2);switch(s){case\"XYZ\":this._x=c*l*h+u*d*p,this._y=u*d*h-c*l*p,this._z=u*l*p+c*d*h,this._w=u*l*h-c*d*p;break;case\"YXZ\":this._x=c*l*h+u*d*p,this._y=u*d*h-c*l*p,this._z=u*l*p-c*d*h,this._w=u*l*h+c*d*p;break;case\"ZXY\":this._x=c*l*h-u*d*p,this._y=u*d*h+c*l*p,this._z=u*l*p+c*d*h,this._w=u*l*h-c*d*p;break;case\"ZYX\":this._x=c*l*h-u*d*p,this._y=u*d*h+c*l*p,this._z=u*l*p-c*d*h,this._w=u*l*h+c*d*p;break;case\"YZX\":this._x=c*l*h+u*d*p,this._y=u*d*h+c*l*p,this._z=u*l*p-c*d*h,this._w=u*l*h-c*d*p;break;case\"XZY\":this._x=c*l*h-u*d*p,this._y=u*d*h-c*l*p,this._z=u*l*p+c*d*h,this._w=u*l*h+c*d*p;break;default:console.warn(\"THREE.Quaternion: .setFromEuler() encountered an unknown order: \"+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const r=e/2,i=Math.sin(r);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,r=e[0],i=e[4],n=e[8],s=e[1],o=e[5],a=e[9],u=e[2],l=e[6],h=e[10],c=r+o+h;if(c>0){const t=.5/Math.sqrt(c+1);this._w=.25/t,this._x=(l-a)*t,this._y=(n-u)*t,this._z=(s-i)*t}else if(r>o&&r>h){const t=2*Math.sqrt(1+r-o-h);this._w=(l-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(n+u)/t}else if(o>h){const t=2*Math.sqrt(1+o-r-h);this._w=(n-u)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+h-r-o);this._w=(s-i)/t,this._x=(n+u)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let r=t.dot(e)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(i.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const r=this.angleTo(t);if(0===r)return this;const i=Math.min(1,e/r);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const r=t._x,i=t._y,n=t._z,s=t._w,o=e._x,a=e._y,u=e._z,l=e._w;return this._x=r*l+s*o+i*u-n*a,this._y=i*l+s*a+n*o-r*u,this._z=n*l+s*u+r*a-i*o,this._w=s*l-r*o-i*a-n*u,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const r=this._x,i=this._y,n=this._z,s=this._w;let o=s*t._w+r*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=r,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*r+e*this._x,this._y=t*i+e*this._y,this._z=t*n+e*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(a),l=Math.atan2(u,o),h=Math.sin((1-e)*l)/u,c=Math.sin(e*l)/u;return this._w=s*h+this._w*c,this._x=r*h+this._x*c,this._y=i*h+this._y*c,this._z=n*h+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,r){return this.copy(t).slerp(e,r)}random(){const t=Math.random(),e=Math.sqrt(1-t),r=Math.sqrt(t),i=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(i),r*Math.sin(n),r*Math.cos(n),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}},5448:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{Vector2:()=>n});var i=r(3334);class n{constructor(t=0,e=0){n.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error(\"index is out of range: \"+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error(\"index is out of range: \"+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,r=this.y,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6],this.y=i[1]*e+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(i.clamp(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y;return e*e+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const r=Math.cos(e),i=Math.sin(e),n=this.x-t.x,s=this.y-t.y;return this.x=n*r-s*i+t.x,this.y=n*i+s*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}},6815:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{Vector3:()=>s});var i=r(3334),n=r(9747);class s{constructor(t=0,e=0,r=0){s.prototype.isVector3=!0,this.x=t,this.y=e,this.z=r}set(t,e,r){return void 0===r&&(r=this.z),this.x=t,this.y=e,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error(\"index is out of range: \"+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(\"index is out of range: \"+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(a.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(a.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6]*i,this.y=n[1]*e+n[4]*r+n[7]*i,this.z=n[2]*e+n[5]*r+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,r=this.y,i=this.z,n=t.elements,s=1/(n[3]*e+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*r+n[8]*i+n[12])*s,this.y=(n[1]*e+n[5]*r+n[9]*i+n[13])*s,this.z=(n[2]*e+n[6]*r+n[10]*i+n[14])*s,this}applyQuaternion(t){const e=this.x,r=this.y,i=this.z,n=t.x,s=t.y,o=t.z,a=t.w,u=a*e+s*i-o*r,l=a*r+o*e-n*i,h=a*i+n*r-s*e,c=-n*e-s*r-o*i;return this.x=u*a+c*-n+l*-o-h*-s,this.y=l*a+c*-s+h*-n-u*-o,this.z=h*a+c*-o+u*-s-l*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*r+n[8]*i,this.y=n[1]*e+n[5]*r+n[9]*i,this.z=n[2]*e+n[6]*r+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const r=t.x,i=t.y,n=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*s-r*a,this.z=r*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return o.copy(this).projectOnVector(t),this.sub(o)}reflect(t){return this.sub(o.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(i.clamp(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,r){const i=Math.sin(e)*t;return this.x=i*Math.sin(r),this.y=Math.cos(e)*t,this.z=i*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(e),this.y=r*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const o=new s,a=new n._},6577:(t,e,r)=>{\"use strict\";r.r(e),r.d(e,{Vector4:()=>i});class i{constructor(t=0,e=0,r=0,n=1){i.prototype.isVector4=!0,this.x=t,this.y=e,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error(\"index is out of range: \"+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error(\"index is out of range: \"+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,r=this.y,i=this.z,n=this.w,s=t.elements;return this.x=s[0]*e+s[4]*r+s[8]*i+s[12]*n,this.y=s[1]*e+s[5]*r+s[9]*i+s[13]*n,this.z=s[2]*e+s[6]*r+s[10]*i+s[14]*n,this.w=s[3]*e+s[7]*r+s[11]*i+s[15]*n,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,r,i,n;const s=.01,o=.1,a=t.elements,u=a[0],l=a[4],h=a[8],c=a[1],d=a[5],p=a[9],f=a[2],m=a[6],y=a[10];if(Math.abs(l-c)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(l+c)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(u+d+y-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(u+1)/2,a=(d+1)/2,g=(y+1)/2,x=(l+c)/4,v=(h+f)/4,b=(p+m)/4;return t>a&&t>g?t<s?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(t),i=x/r,n=v/r):a>g?a<s?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(a),r=x/i,n=b/i):g<s?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(g),r=v/n,i=b/n),this.set(r,i,n,e),this}let g=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(c-l)*(c-l));return Math.abs(g)<.001&&(g=1),this.x=(m-p)/g,this.y=(h-f)/g,this.z=(c-l)/g,this.w=Math.acos((u+d+y-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this.w=t.w+(e.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var r=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(t,e)=>{for(var r in e)__webpack_require__.o(e,r)&&!__webpack_require__.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},__webpack_require__.g=function(){if(\"object\"==typeof globalThis)return globalThis;try{return this||new Function(\"return this\")()}catch(t){if(\"object\"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})};var __webpack_exports__={};(()=>{\"use strict\";const t=__webpack_require__(1509);t.OmvTileDecoderService.start(),t.OmvTilerService.start()})()})();";
/*! For license information please see mapsjs-harp.js.LICENSE.txt */
(()=>{var __webpack_modules__={3577:(e,t,i)=>{"use strict";const n=i(5133);var r=i(5218),s=i(6918);s.util.Long=n,s.configure(),e.exports=r},5218:(e,t,i)=>{"use strict";var n,r,s,o=i(6918),a=o.Reader,l=o.util,c=o.roots.default||(o.roots.default={});c.com=((s={}).mapbox=((r={}).pb=((n={}).Tile=function(){function e(e){if(this.layers=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}var t,i;return e.prototype.layers=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile;e.pos<i;){var r=e.uint32();r>>>3==3?(n.layers&&n.layers.length||(n.layers=[]),n.layers.push(c.com.mapbox.pb.Tile.Layer.decode(e,e.uint32()))):e.skipType(7&r)}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile)return e;var t=new c.com.mapbox.pb.Tile;if(e.layers){if(!Array.isArray(e.layers))throw TypeError(".com.mapbox.pb.Tile.layers: array expected");t.layers=[];for(var i=0;i<e.layers.length;++i){if("object"!=typeof e.layers[i])throw TypeError(".com.mapbox.pb.Tile.layers: object expected");t.layers[i]=c.com.mapbox.pb.Tile.Layer.fromObject(e.layers[i])}}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.layers=[]),e.layers&&e.layers.length){i.layers=[];for(var n=0;n<e.layers.length;++n)i.layers[n]=c.com.mapbox.pb.Tile.Layer.toObject(e.layers[n],t)}return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.GeomType=(t={},(i=Object.create(t))[t[0]="UNKNOWN"]=0,i[t[1]="POINT"]=1,i[t[2]="LINESTRING"]=2,i[t[3]="POLYGON"]=3,i),e.Value=function(){function e(e){if(e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.stringValue="",e.prototype.floatValue=0,e.prototype.doubleValue=0,e.prototype.intValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.uintValue=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.sintValue=l.Long?l.Long.fromBits(0,0,!1):0,e.prototype.boolValue=!1,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Value;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.stringValue=e.string();break;case 2:n.floatValue=e.float();break;case 3:n.doubleValue=e.double();break;case 4:n.intValue=e.int64();break;case 5:n.uintValue=e.uint64();break;case 6:n.sintValue=e.sint64();break;case 7:n.boolValue=e.bool();break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Value)return e;var t=new c.com.mapbox.pb.Tile.Value;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.floatValue&&(t.floatValue=Number(e.floatValue)),null!=e.doubleValue&&(t.doubleValue=Number(e.doubleValue)),null!=e.intValue&&(l.Long?(t.intValue=l.Long.fromValue(e.intValue)).unsigned=!1:"string"==typeof e.intValue?t.intValue=parseInt(e.intValue,10):"number"==typeof e.intValue?t.intValue=e.intValue:"object"==typeof e.intValue&&(t.intValue=new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber())),null!=e.uintValue&&(l.Long?(t.uintValue=l.Long.fromValue(e.uintValue)).unsigned=!0:"string"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):"number"==typeof e.uintValue?t.uintValue=e.uintValue:"object"==typeof e.uintValue&&(t.uintValue=new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),null!=e.sintValue&&(l.Long?(t.sintValue=l.Long.fromValue(e.sintValue)).unsigned=!1:"string"==typeof e.sintValue?t.sintValue=parseInt(e.sintValue,10):"number"==typeof e.sintValue?t.sintValue=e.sintValue:"object"==typeof e.sintValue&&(t.sintValue=new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber())),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),t},e.toObject=function(e,t){t||(t={});var i={};if(t.defaults){if(i.stringValue="",i.floatValue=0,i.doubleValue=0,l.Long){var n=new l.Long(0,0,!1);i.intValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.intValue=t.longs===String?"0":0;l.Long?(n=new l.Long(0,0,!0),i.uintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):i.uintValue=t.longs===String?"0":0,l.Long?(n=new l.Long(0,0,!1),i.sintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):i.sintValue=t.longs===String?"0":0,i.boolValue=!1}return null!=e.stringValue&&e.hasOwnProperty("stringValue")&&(i.stringValue=e.stringValue),null!=e.floatValue&&e.hasOwnProperty("floatValue")&&(i.floatValue=t.json&&!isFinite(e.floatValue)?String(e.floatValue):e.floatValue),null!=e.doubleValue&&e.hasOwnProperty("doubleValue")&&(i.doubleValue=t.json&&!isFinite(e.doubleValue)?String(e.doubleValue):e.doubleValue),null!=e.intValue&&e.hasOwnProperty("intValue")&&("number"==typeof e.intValue?i.intValue=t.longs===String?String(e.intValue):e.intValue:i.intValue=t.longs===String?l.Long.prototype.toString.call(e.intValue):t.longs===Number?new l.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber():e.intValue),null!=e.uintValue&&e.hasOwnProperty("uintValue")&&("number"==typeof e.uintValue?i.uintValue=t.longs===String?String(e.uintValue):e.uintValue:i.uintValue=t.longs===String?l.Long.prototype.toString.call(e.uintValue):t.longs===Number?new l.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),null!=e.sintValue&&e.hasOwnProperty("sintValue")&&("number"==typeof e.sintValue?i.sintValue=t.longs===String?String(e.sintValue):e.sintValue:i.sintValue=t.longs===String?l.Long.prototype.toString.call(e.sintValue):t.longs===Number?new l.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber():e.sintValue),null!=e.boolValue&&e.hasOwnProperty("boolValue")&&(i.boolValue=e.boolValue),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Feature=function(){function e(e){if(this.tags=[],this.geometry=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.id=l.Long?l.Long.fromBits(0,0,!0):0,e.prototype.tags=l.emptyArray,e.prototype.type=0,e.prototype.geometry=l.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Feature;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:n.id=e.uint64();break;case 2:if(n.tags&&n.tags.length||(n.tags=[]),2==(7&r))for(var s=e.uint32()+e.pos;e.pos<s;)n.tags.push(e.uint32());else n.tags.push(e.uint32());break;case 3:n.type=e.int32();break;case 4:if(n.geometry&&n.geometry.length||(n.geometry=[]),2==(7&r))for(s=e.uint32()+e.pos;e.pos<s;)n.geometry.push(e.uint32());else n.geometry.push(e.uint32());break;default:e.skipType(7&r)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Feature)return e;var t=new c.com.mapbox.pb.Tile.Feature;if(null!=e.id&&(l.Long?(t.id=l.Long.fromValue(e.id)).unsigned=!0:"string"==typeof e.id?t.id=parseInt(e.id,10):"number"==typeof e.id?t.id=e.id:"object"==typeof e.id&&(t.id=new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0))),e.tags){if(!Array.isArray(e.tags))throw TypeError(".com.mapbox.pb.Tile.Feature.tags: array expected");t.tags=[];for(var i=0;i<e.tags.length;++i)t.tags[i]=e.tags[i]>>>0}switch(e.type){case"UNKNOWN":case 0:t.type=0;break;case"POINT":case 1:t.type=1;break;case"LINESTRING":case 2:t.type=2;break;case"POLYGON":case 3:t.type=3}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(".com.mapbox.pb.Tile.Feature.geometry: array expected");for(t.geometry=[],i=0;i<e.geometry.length;++i)t.geometry[i]=e.geometry[i]>>>0}return t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.tags=[],i.geometry=[]),t.defaults){if(l.Long){var n=new l.Long(0,0,!0);i.id=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else i.id=t.longs===String?"0":0;i.type=t.enums===String?"UNKNOWN":0}if(null!=e.id&&e.hasOwnProperty("id")&&("number"==typeof e.id?i.id=t.longs===String?String(e.id):e.id:i.id=t.longs===String?l.Long.prototype.toString.call(e.id):t.longs===Number?new l.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0):e.id),e.tags&&e.tags.length){i.tags=[];for(var r=0;r<e.tags.length;++r)i.tags[r]=e.tags[r]}if(null!=e.type&&e.hasOwnProperty("type")&&(i.type=t.enums===String?c.com.mapbox.pb.Tile.GeomType[e.type]:e.type),e.geometry&&e.geometry.length)for(i.geometry=[],r=0;r<e.geometry.length;++r)i.geometry[r]=e.geometry[r];return i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Layer=function(){function e(e){if(this.features=[],this.keys=[],this.values=[],e)for(var t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.version=1,e.prototype.name="",e.prototype.features=l.emptyArray,e.prototype.keys=l.emptyArray,e.prototype.values=l.emptyArray,e.prototype.extent=4096,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var i=void 0===t?e.len:e.pos+t,n=new c.com.mapbox.pb.Tile.Layer;e.pos<i;){var r=e.uint32();switch(r>>>3){case 15:n.version=e.uint32();break;case 1:n.name=e.string();break;case 2:n.features&&n.features.length||(n.features=[]),n.features.push(c.com.mapbox.pb.Tile.Feature.decode(e,e.uint32()));break;case 3:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;case 4:n.values&&n.values.length||(n.values=[]),n.values.push(c.com.mapbox.pb.Tile.Value.decode(e,e.uint32()));break;case 5:n.extent=e.uint32();break;default:e.skipType(7&r)}}if(!n.hasOwnProperty("version"))throw l.ProtocolError("missing required 'version'",{instance:n});if(!n.hasOwnProperty("name"))throw l.ProtocolError("missing required 'name'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof c.com.mapbox.pb.Tile.Layer)return e;var t=new c.com.mapbox.pb.Tile.Layer;if(null!=e.version&&(t.version=e.version>>>0),null!=e.name&&(t.name=String(e.name)),e.features){if(!Array.isArray(e.features))throw TypeError(".com.mapbox.pb.Tile.Layer.features: array expected");t.features=[];for(var i=0;i<e.features.length;++i){if("object"!=typeof e.features[i])throw TypeError(".com.mapbox.pb.Tile.Layer.features: object expected");t.features[i]=c.com.mapbox.pb.Tile.Feature.fromObject(e.features[i])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(".com.mapbox.pb.Tile.Layer.keys: array expected");for(t.keys=[],i=0;i<e.keys.length;++i)t.keys[i]=String(e.keys[i])}if(e.values){if(!Array.isArray(e.values))throw TypeError(".com.mapbox.pb.Tile.Layer.values: array expected");for(t.values=[],i=0;i<e.values.length;++i){if("object"!=typeof e.values[i])throw TypeError(".com.mapbox.pb.Tile.Layer.values: object expected");t.values[i]=c.com.mapbox.pb.Tile.Value.fromObject(e.values[i])}}return null!=e.extent&&(t.extent=e.extent>>>0),t},e.toObject=function(e,t){t||(t={});var i={};if((t.arrays||t.defaults)&&(i.features=[],i.keys=[],i.values=[]),t.defaults&&(i.name="",i.extent=4096,i.version=1),null!=e.name&&e.hasOwnProperty("name")&&(i.name=e.name),e.features&&e.features.length){i.features=[];for(var n=0;n<e.features.length;++n)i.features[n]=c.com.mapbox.pb.Tile.Feature.toObject(e.features[n],t)}if(e.keys&&e.keys.length)for(i.keys=[],n=0;n<e.keys.length;++n)i.keys[n]=e.keys[n];if(e.values&&e.values.length)for(i.values=[],n=0;n<e.values.length;++n)i.values[n]=c.com.mapbox.pb.Tile.Value.toObject(e.values[n],t);return null!=e.extent&&e.hasOwnProperty("extent")&&(i.extent=e.extent),null!=e.version&&e.hasOwnProperty("version")&&(i.version=e.version),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e}(),n),r),s),e.exports=c},7018:e=>{"use strict";e.exports=function(e,t){for(var i=new Array(arguments.length-1),n=0,r=2,s=!0;r<arguments.length;)i[n++]=arguments[r++];return new Promise((function(r,o){i[n]=function(e){if(s)if(s=!1,e)o(e);else{for(var t=new Array(arguments.length-1),i=0;i<t.length;)t[i++]=arguments[i];r.apply(null,t)}};try{e.apply(t||null,i)}catch(e){s&&(s=!1,o(e))}}))}},2647:(e,t)=>{"use strict";var i=t;i.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&"="===e.charAt(t);)++i;return Math.ceil(3*e.length)/4-i};for(var n=new Array(64),r=new Array(123),s=0;s<64;)r[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;i.encode=function(e,t,i){for(var r,s=null,o=[],a=0,l=0;t<i;){var c=e[t++];switch(l){case 0:o[a++]=n[c>>2],r=(3&c)<<4,l=1;break;case 1:o[a++]=n[r|c>>4],r=(15&c)<<2,l=2;break;case 2:o[a++]=n[r|c>>6],o[a++]=n[63&c],l=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return l&&(o[a++]=n[r],o[a++]=61,1===l&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var o="invalid encoding";i.decode=function(e,t,i){for(var n,s=i,a=0,l=0;l<e.length;){var c=e.charCodeAt(l++);if(61===c&&a>1)break;if(void 0===(c=r[c]))throw Error(o);switch(a){case 0:n=c,a=1;break;case 1:t[i++]=n<<2|(48&c)>>4,n=c,a=2;break;case 2:t[i++]=(15&n)<<4|(60&c)>>2,n=c,a=3;break;case 3:t[i++]=(3&n)<<6|c,a=0}}if(1===a)throw Error(o);return i-s},i.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},2922:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var i=this._listeners[e],n=0;n<i.length;)i[n].fn===t?i.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],n=1;n<arguments.length;)i.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,i)}return this}},7955:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),i=new Uint8Array(t.buffer),n=128===i[3];function r(e,n,r){t[0]=e,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3]}function s(e,n,r){t[0]=e,n[r]=i[3],n[r+1]=i[2],n[r+2]=i[1],n[r+3]=i[0]}function o(e,n){return i[0]=e[n],i[1]=e[n+1],i[2]=e[n+2],i[3]=e[n+3],t[0]}function a(e,n){return i[3]=e[n],i[2]=e[n+1],i[1]=e[n+2],i[0]=e[n+3],t[0]}e.writeFloatLE=n?r:s,e.writeFloatBE=n?s:r,e.readFloatLE=n?o:a,e.readFloatBE=n?a:o}():function(){function t(e,t,i,n){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,i,n);else if(isNaN(t))e(2143289344,i,n);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,i,n);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,i,n);else{var s=Math.floor(Math.log(t)/Math.LN2);e((r<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,i,n)}}function o(e,t,i){var n=e(t,i),r=2*(n>>31)+1,s=n>>>23&255,o=8388607&n;return 255===s?o?NaN:r*(1/0):0===s?1401298464324817e-60*r*o:r*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,n),e.readFloatLE=o.bind(null,r),e.readFloatBE=o.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),i=new Uint8Array(t.buffer),n=128===i[7];function r(e,n,r){t[0]=e,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3],n[r+4]=i[4],n[r+5]=i[5],n[r+6]=i[6],n[r+7]=i[7]}function s(e,n,r){t[0]=e,n[r]=i[7],n[r+1]=i[6],n[r+2]=i[5],n[r+3]=i[4],n[r+4]=i[3],n[r+5]=i[2],n[r+6]=i[1],n[r+7]=i[0]}function o(e,n){return i[0]=e[n],i[1]=e[n+1],i[2]=e[n+2],i[3]=e[n+3],i[4]=e[n+4],i[5]=e[n+5],i[6]=e[n+6],i[7]=e[n+7],t[0]}function a(e,n){return i[7]=e[n],i[6]=e[n+1],i[5]=e[n+2],i[4]=e[n+3],i[3]=e[n+4],i[2]=e[n+5],i[1]=e[n+6],i[0]=e[n+7],t[0]}e.writeDoubleLE=n?r:s,e.writeDoubleBE=n?s:r,e.readDoubleLE=n?o:a,e.readDoubleBE=n?a:o}():function(){function t(e,t,i,n,r,s){var o=n<0?1:0;if(o&&(n=-n),0===n)e(0,r,s+t),e(1/n>0?0:2147483648,r,s+i);else if(isNaN(n))e(0,r,s+t),e(2146959360,r,s+i);else if(n>17976931348623157e292)e(0,r,s+t),e((o<<31|2146435072)>>>0,r,s+i);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,r,s+t),e((o<<31|a/4294967296)>>>0,r,s+i);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=n*Math.pow(2,-l))>>>0,r,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,r,s+i)}}}function o(e,t,i,n,r){var s=e(n,r+t),o=e(n,r+i),a=2*(o>>31)+1,l=o>>>20&2047,c=4294967296*(1048575&o)+s;return 2047===l?c?NaN:a*(1/0):0===l?5e-324*a*c:a*Math.pow(2,l-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=o.bind(null,r,0,4),e.readDoubleBE=o.bind(null,s,4,0)}(),e}function i(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}function n(e,t,i){t[i]=e>>>24,t[i+1]=e>>>16&255,t[i+2]=e>>>8&255,t[i+3]=255&e}function r(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},8446:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},5374:e=>{"use strict";e.exports=function(e,t,i){var n=i||8192,r=n>>>1,s=null,o=n;return function(i){if(i<1||i>r)return e(i);o+i>n&&(s=e(n),o=0);var a=t.call(s,o,o+=i);return 7&o&&(o=1+(7|o)),a}}},5226:(e,t)=>{"use strict";var i=t;i.length=function(e){for(var t=0,i=0,n=0;n<e.length;++n)(i=e.charCodeAt(n))<128?t+=1:i<2048?t+=2:55296==(64512&i)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},i.read=function(e,t,i){if(i-t<1)return"";for(var n,r=null,s=[],o=0;t<i;)(n=e[t++])<128?s[o++]=n:n>191&&n<224?s[o++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(n>>10),s[o++]=56320+(1023&n)):s[o++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))},i.write=function(e,t,i){for(var n,r,s=i,o=0;o<e.length;++o)(n=e.charCodeAt(o))<128?t[i++]=n:n<2048?(t[i++]=n>>6|192,t[i++]=63&n|128):55296==(64512&n)&&56320==(64512&(r=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&r),++o,t[i++]=n>>18|240,t[i++]=n>>12&63|128,t[i++]=n>>6&63|128,t[i++]=63&n|128):(t[i++]=n>>12|224,t[i++]=n>>6&63|128,t[i++]=63&n|128);return i-s}},6925:(e,t)=>{var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return e<0?0:e>1?1:e}function s(e){return"%"===e[e.length-1]?n(parseFloat(e)/100*255):n(parseInt(e))}function o(e){return"%"===e[e.length-1]?r(parseFloat(e)/100):r(parseFloat(e))}function a(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in i)return i[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=r.indexOf("("),c=r.indexOf(")");if(-1!==l&&c+1===r.length){var h=r.substr(0,l),u=r.substr(l+1,c-(l+1)).split(","),d=1;switch(h){case"rgba":if(4!==u.length)return null;d=o(u.pop());case"rgb":return 3!==u.length?null:[s(u[0]),s(u[1]),s(u[2]),d];case"hsla":if(4!==u.length)return null;d=o(u.pop());case"hsl":if(3!==u.length)return null;var m=(parseFloat(u[0])%360+360)%360/360,p=o(u[1]),f=o(u[2]),g=f<=.5?f*(p+1):f+p-f*p,v=2*f-g;return[n(255*a(v,g,m+1/3)),n(255*a(v,g,m)),n(255*a(v,g,m-1/3)),d];default:return null}}return null}}catch(e){}},242:(e,t,i)=>{"use strict";function n(e,t,i,s){for(var o,a=s,l=i-t>>1,c=i-t,h=e[t],u=e[t+1],d=e[i],m=e[i+1],p=t+3;p<i;p+=3){var f=r(e[p],e[p+1],h,u,d,m);if(f>a)o=p,a=f;else if(f===a){var g=Math.abs(p-l);g<c&&(o=p,c=g)}}a>s&&(o-t>3&&n(e,t,o,s),e[o+2]=a,i-o>3&&n(e,o,i,s))}function r(e,t,i,n,r,s){var o=r-i,a=s-n;if(0!==o||0!==a){var l=((e-i)*o+(t-n)*a)/(o*o+a*a);l>1?(i=r,n=s):l>0&&(i+=o*l,n+=a*l)}return(o=e-i)*o+(a=t-n)*a}function s(e,t,i,n){var r={id:void 0===e?null:e,type:t,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)o(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<t.length;n++)o(e,t[n]);else if("MultiPolygon"===i)for(n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)o(e,t[n][r])}(r),r}function o(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function a(e,t,i,n){if(t.geometry){var r=t.geometry.coordinates,o=t.geometry.type,u=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),d=[],m=t.id;if(i.promoteId?m=t.properties[i.promoteId]:i.generateId&&(m=n||0),"Point"===o)l(r,d);else if("MultiPoint"===o)for(var p=0;p<r.length;p++)l(r[p],d);else if("LineString"===o)c(r,d,u,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(p=0;p<r.length;p++)d=[],c(r[p],d,u,!1),e.push(s(m,"LineString",d,t.properties));return}h(r,d,u,!1)}else if("Polygon"===o)h(r,d,u,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(p=0;p<t.geometry.geometries.length;p++)a(e,{id:m,geometry:t.geometry.geometries[p],properties:t.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(p=0;p<r.length;p++){var f=[];h(r[p],f,u,!0),d.push(f)}}e.push(s(m,o,d,t.properties))}}function l(e,t){t.push(u(e[0])),t.push(d(e[1])),t.push(0)}function c(e,t,i,r){for(var s,o,a=0,l=0;l<e.length;l++){var c=u(e[l][0]),h=d(e[l][1]);t.push(c),t.push(h),t.push(0),l>0&&(a+=r?(s*h-c*o)/2:Math.sqrt(Math.pow(c-s,2)+Math.pow(h-o,2))),s=c,o=h}var m=t.length-3;t[2]=1,n(t,0,m,i),t[m+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function h(e,t,i,n){for(var r=0;r<e.length;r++){var s=[];c(e[r],s,i,n),t.push(s)}}function u(e){return e/360+.5}function d(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function m(e,t,i,n,r,o,a,l){if(n/=t,o>=(i/=t)&&a<n)return e;if(a<i||o>=n)return null;for(var c=[],h=0;h<e.length;h++){var u=e[h],d=u.geometry,m=u.type,g=0===r?u.minX:u.minY,_=0===r?u.maxX:u.maxY;if(g>=i&&_<n)c.push(u);else if(!(_<i||g>=n)){var y=[];if("Point"===m||"MultiPoint"===m)p(d,y,i,n,r);else if("LineString"===m)f(d,y,i,n,r,!1,l.lineMetrics);else if("MultiLineString"===m)v(d,y,i,n,r,!1);else if("Polygon"===m)v(d,y,i,n,r,!0);else if("MultiPolygon"===m)for(var x=0;x<d.length;x++){var S=[];v(d[x],S,i,n,r,!0),S.length&&y.push(S)}if(y.length){if(l.lineMetrics&&"LineString"===m){for(x=0;x<y.length;x++)c.push(s(u.id,m,y[x],u.tags));continue}"LineString"!==m&&"MultiLineString"!==m||(1===y.length?(m="LineString",y=y[0]):m="MultiLineString"),"Point"!==m&&"MultiPoint"!==m||(m=3===y.length?"Point":"MultiPoint"),c.push(s(u.id,m,y,u.tags))}}}return c.length?c:null}function p(e,t,i,n,r){for(var s=0;s<e.length;s+=3){var o=e[s+r];o>=i&&o<=n&&(t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]))}}function f(e,t,i,n,r,s,o){for(var a,l,c=g(e),h=0===r?y:x,u=e.start,d=0;d<e.length-3;d+=3){var m=e[d],p=e[d+1],f=e[d+2],v=e[d+3],S=e[d+4],b=0===r?m:p,T=0===r?v:S,M=!1;o&&(a=Math.sqrt(Math.pow(m-v,2)+Math.pow(p-S,2))),b<i?T>i&&(l=h(c,m,p,v,S,i),o&&(c.start=u+a*l)):b>n?T<n&&(l=h(c,m,p,v,S,n),o&&(c.start=u+a*l)):_(c,m,p,f),T<i&&b>=i&&(l=h(c,m,p,v,S,i),M=!0),T>n&&b<=n&&(l=h(c,m,p,v,S,n),M=!0),!s&&M&&(o&&(c.end=u+a*l),t.push(c),c=g(e)),o&&(u+=a)}var w=e.length-3;m=e[w],p=e[w+1],f=e[w+2],(b=0===r?m:p)>=i&&b<=n&&_(c,m,p,f),w=c.length-3,s&&w>=3&&(c[w]!==c[0]||c[w+1]!==c[1])&&_(c,c[0],c[1],c[2]),c.length&&t.push(c)}function g(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function v(e,t,i,n,r,s){for(var o=0;o<e.length;o++)f(e[o],t,i,n,r,s,!1)}function _(e,t,i,n){e.push(t),e.push(i),e.push(n)}function y(e,t,i,n,r,s){var o=(s-t)/(n-t);return e.push(s),e.push(i+(r-i)*o),e.push(1),o}function x(e,t,i,n,r,s){var o=(s-i)/(r-i);return e.push(t+(n-t)*o),e.push(s),e.push(1),o}function S(e,t){for(var i=[],n=0;n<e.length;n++){var r,o=e[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)r=b(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){r=[];for(var l=0;l<o.geometry.length;l++)r.push(b(o.geometry[l],t))}else if("MultiPolygon"===a)for(r=[],l=0;l<o.geometry.length;l++){for(var c=[],h=0;h<o.geometry[l].length;h++)c.push(b(o.geometry[l][h],t));r.push(c)}i.push(s(o.id,a,r,o.tags))}return i}function b(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var n=0;n<e.length;n+=3)i.push(e[n]+t,e[n+1],e[n+2]);return i}function T(e,t){if(e.transformed)return e;var i,n,r,s=1<<e.z,o=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,h=l.type;if(l.geometry=[],1===h)for(n=0;n<c.length;n+=2)l.geometry.push(M(c[n],c[n+1],t,s,o,a));else for(n=0;n<c.length;n++){var u=[];for(r=0;r<c[n].length;r+=2)u.push(M(c[n][r],c[n][r+1],t,s,o,a));l.geometry.push(u)}}return e.transformed=!0,e}function M(e,t,i,n,r,s){return[Math.round(i*(e*n-r)),Math.round(i*(t*n-s))]}function w(e,t,i,n,r){for(var s=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){o.numFeatures++,E(o,e[a],s,r);var l=e[a].minX,c=e[a].minY,h=e[a].maxX,u=e[a].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),h>o.maxX&&(o.maxX=h),u>o.maxY&&(o.maxY=u)}return o}function E(e,t,i,n){var r=t.geometry,s=t.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<r.length;a+=3)o.push(r[a]),o.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)C(o,r,e,i,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<r.length;a++)C(o,r[a],e,i,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)C(o,c[a],e,i,!0,0===a)}if(o.length){var h=t.tags||null;if("LineString"===s&&n.lineMetrics){for(var u in h={},t.tags)h[u]=t.tags[u];h.mapbox_clip_start=r.start/r.size,h.mapbox_clip_end=r.end/r.size}var d={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:h};null!==t.id&&(d.id=t.id),e.features.push(d)}}function C(e,t,i,n,r,s){var o=n*n;if(n>0&&t.size<(r?o:n))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>o)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;r&&function(e,t){for(var i=0,n=0,r=e.length,s=r-2;n<r;s=n,n+=2)i+=(e[n]-e[s])*(e[n+1]+e[s+1]);if(i>0===t)for(n=0,r=e.length;n<r/2;n+=2){var o=e[n],a=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=o,e[r-1-n]=a}}(a,s),e.push(a)}}function A(e,t){return new P(e,t)}function P(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)a(i,e.features[n],t,n);else"Feature"===e.type?a(i,e,t):a(i,{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(e,t){var i=t.buffer/t.extent,n=e,r=m(e,1,-1-i,i,0,-1,2,t),s=m(e,1,1-i,2+i,0,-1,2,t);return(r||s)&&(n=m(e,1,-i,1+i,0,-1,2,t)||[],r&&(n=S(r,1).concat(n)),s&&(n=n.concat(S(s,-1)))),n}(n,t),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function R(e,t,i){return 32*((1<<e)*i+t)+e}i.r(t),i.d(t,{default:()=>A}),P.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},P.prototype.splitTile=function(e,t,i,n,r,s,o){for(var a=[e,t,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var h=1<<t,u=R(t,i,n),d=this.tiles[u];if(!d&&(c>1&&console.time("creation"),d=this.tiles[u]=w(e,t,i,n,l),this.tileCoords.push({z:t,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var f=1<<r-t;if(i!==Math.floor(s/f)||n!==Math.floor(o/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var g,v,_,y,x,S,b=.5*l.buffer/l.extent,T=.5-b,M=.5+b,E=1+b;g=v=_=y=null,x=m(e,h,i-b,i+M,0,d.minX,d.maxX,l),S=m(e,h,i+T,i+E,0,d.minX,d.maxX,l),e=null,x&&(g=m(x,h,n-b,n+M,1,d.minY,d.maxY,l),v=m(x,h,n+T,n+E,1,d.minY,d.maxY,l),x=null),S&&(_=m(S,h,n-b,n+M,1,d.minY,d.maxY,l),y=m(S,h,n+T,n+E,1,d.minY,d.maxY,l),S=null),c>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*i,2*n),a.push(v||[],t+1,2*i,2*n+1),a.push(_||[],t+1,2*i+1,2*n),a.push(y||[],t+1,2*i+1,2*n+1)}}},P.prototype.getTile=function(e,t,i){var n=this.options,r=n.extent,s=n.debug;if(e<0||e>24)return null;var o=1<<e,a=R(e,t=(t%o+o)%o,i);if(this.tiles[a])return T(this.tiles[a],r);s>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,h=t,u=i;!l&&c>0;)c--,h=Math.floor(h/2),u=Math.floor(u/2),l=this.tiles[R(c,h,u)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",c,h,u),s>1&&console.time("drilling down"),this.splitTile(l.source,c,h,u,e,t,i),s>1&&console.timeEnd("drilling down"),this.tiles[a]?T(this.tiles[a],r):null):null}},5133:e=>{e.exports=i;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function i(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function n(e){return!0===(e&&e.__isLong__)}i.prototype.__isLong__,Object.defineProperty(i.prototype,"__isLong__",{value:!0}),i.isLong=n;var r={},s={};function o(e,t){var i,n,o;return t?(o=0<=(e>>>=0)&&e<256)&&(n=s[e])?n:(i=l(e,(0|e)<0?-1:0,!0),o&&(s[e]=i),i):(o=-128<=(e|=0)&&e<128)&&(n=r[e])?n:(i=l(e,e<0?-1:0,!1),o&&(r[e]=i),i)}function a(e,t){if(isNaN(e))return t?v:g;if(t){if(e<0)return v;if(e>=m)return b}else{if(e<=-p)return T;if(e+1>=p)return S}return e<0?a(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,n){return new i(e,t,n)}i.fromInt=o,i.fromNumber=a,i.fromBits=l;var c=Math.pow;function h(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,i).neg();for(var r=a(c(i,8)),s=g,o=0;o<e.length;o+=8){var l=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+l),i);if(l<8){var d=a(c(i,l));s=s.mul(d).add(a(u))}else s=(s=s.mul(r)).add(a(u))}return s.unsigned=t,s}function u(e,t){return"number"==typeof e?a(e,t):"string"==typeof e?h(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}i.fromString=h,i.fromValue=u;var d=4294967296,m=d*d,p=m/2,f=o(1<<24),g=o(0);i.ZERO=g;var v=o(0,!0);i.UZERO=v;var _=o(1);i.ONE=_;var y=o(1,!0);i.UONE=y;var x=o(-1);i.NEG_ONE=x;var S=l(-1,2147483647,!1);i.MAX_VALUE=S;var b=l(-1,-1,!0);i.MAX_UNSIGNED_VALUE=b;var T=l(0,-2147483648,!1);i.MIN_VALUE=T;var M=i.prototype;M.toInt=function(){return this.unsigned?this.low>>>0:this.low},M.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},M.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var t=a(e),i=this.div(t),n=i.mul(t).sub(this);return i.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=a(c(e,6),this.unsigned),s=this,o="";;){var l=s.div(r),h=(s.sub(l.mul(r)).toInt()>>>0).toString(e);if((s=l).isZero())return h+o;for(;h.length<6;)h="0"+h;o=""+h+o}},M.getHighBits=function(){return this.high},M.getHighBitsUnsigned=function(){return this.high>>>0},M.getLowBits=function(){return this.low},M.getLowBitsUnsigned=function(){return this.low>>>0},M.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},M.isZero=function(){return 0===this.high&&0===this.low},M.eqz=M.isZero,M.isNegative=function(){return!this.unsigned&&this.high<0},M.isPositive=function(){return this.unsigned||this.high>=0},M.isOdd=function(){return!(1&~this.low)},M.isEven=function(){return!(1&this.low)},M.equals=function(e){return n(e)||(e=u(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},M.eq=M.equals,M.notEquals=function(e){return!this.eq(e)},M.neq=M.notEquals,M.ne=M.notEquals,M.lessThan=function(e){return this.comp(e)<0},M.lt=M.lessThan,M.lessThanOrEqual=function(e){return this.comp(e)<=0},M.lte=M.lessThanOrEqual,M.le=M.lessThanOrEqual,M.greaterThan=function(e){return this.comp(e)>0},M.gt=M.greaterThan,M.greaterThanOrEqual=function(e){return this.comp(e)>=0},M.gte=M.greaterThanOrEqual,M.ge=M.greaterThanOrEqual,M.compare=function(e){if(n(e)||(e=u(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},M.comp=M.compare,M.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(_)},M.neg=M.negate,M.add=function(e){n(e)||(e=u(e));var t=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,o=e.high>>>16,a=65535&e.high,c=e.low>>>16,h=0,d=0,m=0,p=0;return m+=(p+=s+(65535&e.low))>>>16,d+=(m+=r+c)>>>16,h+=(d+=i+a)>>>16,h+=t+o,l((m&=65535)<<16|(p&=65535),(h&=65535)<<16|(d&=65535),this.unsigned)},M.subtract=function(e){return n(e)||(e=u(e)),this.add(e.neg())},M.sub=M.subtract,M.multiply=function(e){if(this.isZero())return g;if(n(e)||(e=u(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(T))return e.isOdd()?T:g;if(e.eq(T))return this.isOdd()?T:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(f)&&e.lt(f))return a(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=65535&this.high,s=this.low>>>16,o=65535&this.low,c=e.high>>>16,h=65535&e.high,d=e.low>>>16,m=65535&e.low,p=0,v=0,_=0,y=0;return _+=(y+=o*m)>>>16,v+=(_+=s*m)>>>16,_&=65535,v+=(_+=o*d)>>>16,p+=(v+=r*m)>>>16,v&=65535,p+=(v+=s*d)>>>16,v&=65535,p+=(v+=o*h)>>>16,p+=i*m+r*d+s*h+o*c,l((_&=65535)<<16|(y&=65535),(p&=65535)<<16|(v&=65535),this.unsigned)},M.mul=M.multiply,M.divide=function(e){if(n(e)||(e=u(e)),e.isZero())throw Error("division by zero");var i,r,s;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return y;s=v}else{if(this.eq(T))return e.eq(_)||e.eq(x)?T:e.eq(T)?_:(i=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?_:x:(r=this.sub(e.mul(i)),s=i.add(r.div(e)));if(e.eq(T))return this.unsigned?v:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=g}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),h=o<=48?1:c(2,o-48),d=a(i),m=d.mul(e);m.isNegative()||m.gt(r);)m=(d=a(i-=h,this.unsigned)).mul(e);d.isZero()&&(d=_),s=s.add(d),r=r.sub(m)}return s},M.div=M.divide,M.modulo=function(e){return n(e)||(e=u(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},M.mod=M.modulo,M.rem=M.modulo,M.not=function(){return l(~this.low,~this.high,this.unsigned)},M.and=function(e){return n(e)||(e=u(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},M.or=function(e){return n(e)||(e=u(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},M.xor=function(e){return n(e)||(e=u(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},M.shiftLeft=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},M.shl=M.shiftLeft,M.shiftRight=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},M.shr=M.shiftRight,M.shiftRightUnsigned=function(e){if(n(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},M.shru=M.shiftRightUnsigned,M.shr_u=M.shiftRightUnsigned,M.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},M.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},M.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},M.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},M.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},i.fromBytes=function(e,t,n){return n?i.fromBytesLE(e,t):i.fromBytesBE(e,t)},i.fromBytesLE=function(e,t){return new i(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},i.fromBytesBE=function(e,t){return new i(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},6918:(e,t,i)=>{"use strict";e.exports=i(3729)},3729:(e,t,i)=>{"use strict";var n=t;function r(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=i(8116),n.BufferWriter=i(1819),n.Reader=i(2461),n.BufferReader=i(9117),n.util=i(1679),n.rpc=i(8082),n.roots=i(575),n.configure=r,r()},2461:(e,t,i)=>{"use strict";e.exports=l;var n,r=i(1679),s=r.LongBits,o=r.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},u=function(){return r.Buffer?function(e){return(l.create=function(e){return r.Buffer.isBuffer(e)?new n(e):h(e)})(e)}:h};function d(){var e=new s(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function m(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new s(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}l.create=u(),l.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,l.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return c}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return m(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|m(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,i):t===i?new this.buf.constructor(0):this._slice.call(this.buf,t,i)},l.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=u(),n._configure();var t=r.Long?"toLong":"toNumber";r.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},9117:(e,t,i)=>{"use strict";e.exports=s;var n=i(2461);(s.prototype=Object.create(n.prototype)).constructor=s;var r=i(1679);function s(e){n.call(this,e)}s._configure=function(){r.Buffer&&(s.prototype._slice=r.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},575:e=>{"use strict";e.exports={}},8082:(e,t,i)=>{"use strict";t.Service=i(7927)},7927:(e,t,i)=>{"use strict";e.exports=r;var n=i(1679);function r(e,t,i){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(i)}(r.prototype=Object.create(n.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function e(t,i,r,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,i,r,s);if(a.rpcImpl)try{return a.rpcImpl(t,i[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(e,i){if(e)return a.emit("error",e,t),o(e);if(null!==i){if(!(i instanceof r))try{i=r[a.responseDelimited?"decodeDelimited":"decode"](i)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",i,t),o(null,i)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},r.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},8294:(e,t,i)=>{"use strict";e.exports=r;var n=i(1679);function r(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=r.zero=new r(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=r.zeroHash="\0\0\0\0\0\0\0\0";r.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var i=e>>>0,n=(e-i)/4294967296>>>0;return t&&(n=~n>>>0,i=~i>>>0,++i>4294967295&&(i=0,++n>4294967295&&(n=0))),new r(i,n)},r.from=function(e){if("number"==typeof e)return r.fromNumber(e);if(n.isString(e)){if(!n.Long)return r.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new r(e.low>>>0,e.high>>>0):s},r.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+4294967296*i)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;r.fromHash=function(e){return e===o?s:new r((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},r.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},r.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}},1679:function(e,t,i){"use strict";var n=t;function r(e,t,i){for(var n=Object.keys(t),r=0;r<n.length;++r)void 0!==e[n[r]]&&i||(e[n[r]]=t[n[r]]);return e}function s(e){function t(e,i){if(!(this instanceof t))return new t(e,i);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&r(this,i)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=i(7018),n.base64=i(2647),n.EventEmitter=i(2922),n.float=i(7955),n.inquire=i(8446),n.utf8=i(5226),n.pool=i(5374),n.LongBits=i(8294),n.isNode=Boolean(void 0!==i.g&&i.g&&i.g.process&&i.g.process.versions&&i.g.process.versions.node),n.global=n.isNode&&i.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var i=e[t];return!(null==i||!e.hasOwnProperty(t))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var i=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(i.lo,i.hi,t):i.toNumber(Boolean(t))},n.merge=r,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var e=Object.keys(this),i=e.length-1;i>-1;--i)if(1===t[e[i]]&&void 0!==this[e[i]]&&null!==this[e[i]])return e[i]}},n.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,i){return new e(t,i)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},8116:(e,t,i)=>{"use strict";e.exports=u;var n,r=i(1679),s=r.LongBits,o=r.base64,a=r.utf8;function l(e,t,i){this.fn=e,this.len=t,this.next=void 0,this.val=i}function c(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function u(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var d=function(){return r.Buffer?function(){return(u.create=function(){return new n})()}:function(){return new u}};function m(e,t,i){t[i]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function f(e,t,i){for(;e.hi;)t[i++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[i++]=127&e.lo|128,e.lo=e.lo>>>7;t[i++]=e.lo}function g(e,t,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24}u.create=d(),u.alloc=function(e){return new r.Array(e)},r.Array!==Array&&(u.alloc=r.pool(u.alloc,r.Array.prototype.subarray)),u.prototype._push=function(e,t,i){return this.tail=this.tail.next=new l(e,t,i),this.len+=t,this},p.prototype=Object.create(l.prototype),p.prototype.fn=function(e,t,i){for(;e>127;)t[i++]=127&e|128,e>>>=7;t[i]=e},u.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},u.prototype.int32=function(e){return e<0?this._push(f,10,s.fromNumber(e)):this.uint32(e)},u.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},u.prototype.uint64=function(e){var t=s.from(e);return this._push(f,t.length(),t)},u.prototype.int64=u.prototype.uint64,u.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(f,t.length(),t)},u.prototype.bool=function(e){return this._push(m,1,e?1:0)},u.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},u.prototype.sfixed32=u.prototype.fixed32,u.prototype.fixed64=function(e){var t=s.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},u.prototype.sfixed64=u.prototype.fixed64,u.prototype.float=function(e){return this._push(r.float.writeFloatLE,4,e)},u.prototype.double=function(e){return this._push(r.float.writeDoubleLE,8,e)};var v=r.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var n=0;n<e.length;++n)t[i+n]=e[n]};u.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(m,1,0);if(r.isString(e)){var i=u.alloc(t=o.length(e));o.decode(e,i,0),e=i}return this.uint32(t)._push(v,t,e)},u.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(m,1,0)},u.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new l(c,0,0),this.len=0,this},u.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},u.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this},u.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t},u._configure=function(e){n=e,u.create=d(),n._configure()}},1819:(e,t,i)=>{"use strict";e.exports=s;var n=i(8116);(s.prototype=Object.create(n.prototype)).constructor=s;var r=i(1679);function s(){n.call(this)}function o(e,t,i){e.length<40?r.utf8.write(e,t,i):t.utf8Write?t.utf8Write(e,i):t.write(e,i)}s._configure=function(){s.alloc=r._Buffer_allocUnsafe,s.writeBytesBuffer=r.Buffer&&r.Buffer.prototype instanceof Uint8Array&&"set"===r.Buffer.prototype.set.name?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var n=0;n<e.length;)t[i++]=e[n++]}},s.prototype.bytes=function(e){r.isString(e)&&(e=r._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=r.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},1102:function(e){e.exports=function(){"use strict";function e(e,n,r,s,o){!function e(i,n,r,s,o){for(;s>r;){if(s-r>600){var a=s-r+1,l=n-r+1,c=Math.log(a),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-l*h/a+u)),Math.min(s,Math.floor(n+(a-l)*h/a+u)),o)}var d=i[n],m=r,p=s;for(t(i,r,n),o(i[s],d)>0&&t(i,r,s);m<p;){for(t(i,m,p),m++,p--;o(i[m],d)<0;)m++;for(;o(i[p],d)>0;)p--}0===o(i[r],d)?t(i,r,p):t(i,++p,s),p<=n&&(r=p+1),n<=p&&(s=p-1)}}(e,n,r||0,s||e.length-1,o||i)}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function s(e,t){o(e,0,e.children.length,t,e)}function o(e,t,i,n,r){r||(r=p(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var s=t;s<i;s++){var o=e.children[s];a(r,e.leaf?n(o):o)}return r}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function u(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,i,n,r,s){for(var o=[i,n];o.length;)if(!((n=o.pop())-(i=o.pop())<=r)){var a=i+Math.ceil((n-i)/r/2)*r;e(t,a,i,n,s),o.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,i=[];if(!m(e,t))return i;for(var n=this.toBBox,r=[];t;){for(var s=0;s<t.children.length;s++){var o=t.children[s],a=t.leaf?n(o):o;m(e,a)&&(t.leaf?i.push(o):d(e,a)?this._all(o,i):r.push(o))}t=r.pop()}return i},n.prototype.collides=function(e){var t=this.data;if(!m(e,t))return!1;for(var i=[];t;){for(var n=0;n<t.children.length;n++){var r=t.children[n],s=t.leaf?this.toBBox(r):r;if(m(e,s)){if(t.leaf||d(e,s))return!0;i.push(r)}}t=i.pop()}return!1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=p([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var i,n,s,o=this.data,a=this.toBBox(e),l=[],c=[];o||l.length;){if(o||(o=l.pop(),n=l[l.length-1],i=c.pop(),s=!0),o.leaf){var h=r(e,o.children,t);if(-1!==h)return o.children.splice(h,1),l.push(o),this._condense(l),this}s||o.leaf||!d(o,a)?n?(i++,o=n.children[i],s=!1):o=null:(l.push(o),c.push(i),i=0,n=o,o=o.children[0])}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},n.prototype._build=function(e,t,i,n){var r,o=i-t+1,a=this._maxEntries;if(o<=a)return s(r=p(e.slice(t,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(r=p([])).leaf=!1,r.height=n;var l=Math.ceil(o/a),c=l*Math.ceil(Math.sqrt(a));f(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var u=Math.min(h+c-1,i);f(e,h,u,l,this.compareMinY);for(var d=h;d<=u;d+=l){var m=Math.min(d+l-1,u);r.children.push(this._build(e,d,m,n-1))}}return s(r,this.toBBox),r},n.prototype._chooseSubtree=function(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){for(var r=1/0,s=1/0,o=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),u=(d=e,m=l,(Math.max(m.maxX,d.maxX)-Math.min(m.minX,d.minX))*(Math.max(m.maxY,d.maxY)-Math.min(m.minY,d.minY))-c);u<s?(s=u,r=c<r?c:r,o=l):u===s&&c<r&&(r=c,o=l)}t=o||t.children[0]}var d,m;return t},n.prototype._insert=function(e,t,i){var n=i?e:this.toBBox(e),r=[],s=this._chooseSubtree(n,this.data,t,r);for(s.children.push(e),a(s,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)},n.prototype._split=function(e,t){var i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),a=p(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(e,t,i){for(var n,r,s,a,l,c,u,d=1/0,m=1/0,p=t;p<=i-t;p++){var f=o(e,0,p,this.toBBox),g=o(e,p,i,this.toBBox),v=(r=f,s=g,void 0,void 0,void 0,void 0,a=Math.max(r.minX,s.minX),l=Math.max(r.minY,s.minY),c=Math.min(r.maxX,s.maxX),u=Math.min(r.maxY,s.maxY),Math.max(0,c-a)*Math.max(0,u-l)),_=h(f)+h(g);v<d?(d=v,n=p,m=_<m?_:m):v===d&&_<m&&(m=_,n=p)}return n||i-t},n.prototype._chooseSplitAxis=function(e,t,i){var n=e.leaf?this.compareMinX:l,r=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)},n.prototype._allDistMargin=function(e,t,i,n){e.children.sort(n);for(var r=this.toBBox,s=o(e,0,t,r),l=o(e,i-t,i,r),c=u(s)+u(l),h=t;h<i-t;h++){var d=e.children[h];a(s,e.leaf?r(d):d),c+=u(s)}for(var m=i-t-1;m>=t;m--){var p=e.children[m];a(l,e.leaf?r(p):p),c+=u(l)}return c},n.prototype._adjustParentBBoxes=function(e,t,i){for(var n=i;n>=0;n--)a(t[n],e)},n.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():s(e[t],this.toBBox)},n}()},7769:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(5185),t),r(i(6406),t),r(i(6114),t),r(i(8934),t),r(i(1072),t),r(i(7259),t),r(i(8284),t),r(i(1017),t),r(i(1370),t),r(i(1216),t),r(i(8131),t)},8152:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7395),t),r(i(8920),t),r(i(4835),t),r(i(9421),t),r(i(9362),t),r(i(7980),t),r(i(2286),t),r(i(3253),t),r(i(8770),t),r(i(1072),t)},3253:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scaleHeight=t.getFeatureText=t.getFeatureName=t.getFeatureId=t.getProjectionName=t.getProjection=t.GeometryType=t.getArrayConstructor=void 0;const n=i(2616),r=i(1984),s=i(3561);function o(e,t,i){var n;let r;if(void 0===t&&(t="name"),void 0!==i)for(const s of i)if(r=null!==(n=e.lookup(`${t}:${s}`))&&void 0!==n?n:e.lookup(`${t}_${s}`),"string"==typeof r&&r.length>0)return r;if(r=e.lookup(t),"string"==typeof r)return r}var a;t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array}},(a=t.GeometryType||(t.GeometryType={}))[a.Unspecified=0]="Unspecified",a[a.Point=1]="Point",a[a.Line=2]="Line",a[a.SolidLine=3]="SolidLine",a[a.Text=4]="Text",a[a.TextPath=5]="TextPath",a[a.ExtrudedLine=6]="ExtrudedLine",a[a.Polygon=7]="Polygon",a[a.ExtrudedPolygon=8]="ExtrudedPolygon",a[a.Object3D=9]="Object3D",a[a.Other=1e3]="Other",t.getProjection=function(e){switch(e){case"mercator":return n.mercatorProjection;case"webMercator":return n.webMercatorProjection;case"sphere":return n.sphereProjection;case"normalizedEquirectangular":return n.normalizedEquirectangularProjection;case"equirectangular":return n.equirectangularProjection;default:throw new Error(`Unknown projection ${e}`)}},t.getProjectionName=function(e){if(e===n.mercatorProjection)return"mercator";if(e===n.webMercatorProjection)return"webMercator";if(e===n.sphereProjection)return"sphere";if(e===n.normalizedEquirectangularProjection)return"normalizedEquirectangular";if(e===n.equirectangularProjection)return"equirectangular";throw new Error("Unknown projection")},t.getFeatureId=function(e){if(void 0===e)return 0;if("string"==typeof e||"number"==typeof e)return e;if(e.hasOwnProperty("$id")){const t=e.$id;if("string"==typeof t||"number"==typeof t)return t}return 0},t.getFeatureName=o,t.getFeatureText=function(e,t,i){const n=e instanceof r.Env?e:e.env;if((0,r.isTextTechnique)(t)||(0,r.isIconTextTechnique)(t)||(0,r.isLineMarkerTechnique)(t)){if(void 0!==t.text)return(0,s.evaluateTechniqueAttr)(e,t.text);if((0,r.isIconTextTechnique)(t)||(0,r.isLineMarkerTechnique)(t))return}return o(n,"name",i)},t.scaleHeight=function(e,t,i){return!(0,s.evaluateTechniqueAttr)(e,t.constantHeight,i<12)}},1072:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureGeometry=void 0,t.isFeatureGeometry=function(e){const t=e.type;return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}},6406:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7980:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2286:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6114:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addPolygonEdges=void 0;const n=i(5448),r=new n.Vector2,s=new n.Vector2,o=new n.Vector2,a=new n.Vector2;t.addPolygonEdges=function(e,t,i,n,l,c,h,u){for(let d=0;d<l.length;++d)if(l[d])if(!0===c){const c=t+2*d,m=c+1,p=t+(d+1)%l.length*2,f=p+1;!0===h&&e.push(c,p),e.push(m,f);const g=(0===d?l.length:d)-1;if(l[g])if(void 0!==u){const t=n[d*i],h=n[d*i+1],p=n[(d+1)%l.length*i],f=n[(d+1)%l.length*i+1];r.set(t,h),s.set(p,f),o.set(n[g*i],n[g*i+1]),a.set(r.x,r.y),a.sub(o).normalize().dot(s.sub(r).normalize())<=u&&e.push(c,m)}else e.push(c,m)}else{const i=t+d,n=t+(d+1)%l.length;e.push(i,n)}}},7395:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8920:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPropertyValue=void 0;const n=i(1984),r=i(4342).LoggerManager.instance.create("PropertyValue");t.getPropertyValue=function(e,t,i){try{return(0,n.getPropertyValue)(e,t,i)}catch(t){return r.error("failed to evaluate expression",JSON.stringify(e),"error",String(t)),null}}},5185:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDecodedTechnique=t.StyleSetEvaluator=void 0;const n=i(1984),r=i(8023),s=i(8797),o=i(8628),a=i(4342),l=i(5535),c=a.LoggerManager.instance.create("StyleSetEvaluator"),h=l.AttrScope.TechniqueGeometry;class u{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if("all"===e.op){const t=e.args.map((t=>t.accept(this,e))).filter((e=>void 0!==e));return new r.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.dataLayer&&"$layer"===t.name)return void(this._style.dataLayer=t.value);if(void 0===this._style._geometryType&&"$geometryType"===t.name)return void(this._style._geometryType=t.value)}}return e}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitStepExpr(e,t){return e}visitInterpolateExpr(e,t){return e}matchVarStringComparison(e){if("=="===e.op){const t=e.args[0],i=e.args[1];if(t instanceof r.VarExpr&&i instanceof r.StringLiteralExpr)return{name:t.name,value:i.value};if(i instanceof r.VarExpr&&t instanceof r.StringLiteralExpr)return{name:i.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class d{constructor(e,t){this.key="",this.set(e,t)}set(e,t,i){let n=!1;if(void 0===e){const t=void 0!==i?i.lookup("$layer"):void 0;e="string"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,n=!0),void 0===t){const e=void 0!==i?i.lookup("$geometryType"):void 0;t="string"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,n=!0),n&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key="all",this.cachedStyleSet=void 0}}function m(e){const t={};for(const i in e){if(!e.hasOwnProperty(i))continue;let n=e[i];"object"==typeof n&&(n.isVector2||n.isVector3||n.isVector4)&&(n=r.LiteralExpr.fromValue(n)),r.Expr.isExpr(n)&&(n=n.toJSON()),t[i]=n}return t}t.StyleSetEvaluator=class{constructor(e){this.m_options=e,this.styleSet=[],this.m_techniques=[],this.m_exprPool=new s.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new u,this.m_subStyleSetCache=new Map,this.m_areCurrentDefinitionsOverridden=!0,this.m_definitionsContainVerbose=!1,this.m_disabledStyles={byId:new Set,byLayer:new Set},this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new d,this.m_emptyEnv=new n.Env,this.m_featureDependencies=["$layer","$geometryType","$zoom"],this.m_nextArrayBufferId=0,this.m_definitions=this.m_options.definitions;for(const e in this.m_definitions)this.m_definitionsContainVerbose||(this.m_definitionsContainVerbose=(0,n.isVerboseDefinition)(this.m_definitions[e]));this.styleSet=this.m_options.styleSet.map((e=>{const t=Object.assign(Object.assign({},e),{_forceCompile:!0});return e.attr&&(t.attr=Object.assign({},e.attr)),t})),function(e){var t;let i=0,n=0;for(const r of e)r._styleIndex=n++,void 0!==r.technique&&void 0===(null===(t=r.attr)||void 0===t?void 0:t.renderOrder)&&(void 0===r.attr?r.attr={renderOrder:i++}:r.attr.renderOrder=i++)}(this.styleSet),this.m_features=this.validateFeatures(this.m_options.features);const t=[];for(const e in this.m_features)this.m_features[e].modes.forEach((e=>{e.extendedDefinitions&&Array.prototype.push.apply(t,Object.keys(e.extendedDefinitions))}));this.m_modesDefinitions=new Set(t),this.setEnabledFeatures(e.enabledFeatures)}setEnabledFeatures(e){this.applyFeaturesAndModes(null!=e?e:this.getFeaturesEnabledByDefault())}getFeaturesEnabledByDefault(){var e;const t=[];if(this.m_features)for(const i in this.m_features){const n=this.m_features[i];n.enabledByDefault&&t.push({feature:i,mode:null===(e=n.modes[0])||void 0===e?void 0:e.name})}return t}applyFeaturesAndModes(e){if(this.m_disabledStyles.byId.clear(),this.m_disabledStyles.byLayer.clear(),this.resetTechniques(),this.m_areCurrentDefinitionsOverridden&&(this.m_definitionsContainVerbose?this.m_currentDefinitions=JSON.parse(JSON.stringify(this.m_definitions)):this.m_currentDefinitions=Object.assign({},this.m_definitions),this.m_areCurrentDefinitionsOverridden=!1),this.m_features)for(const t in this.m_features){const i=this.m_features[t];let n;const r=e.find((e=>e.feature===t));r?(n=i.modes.find((e=>e.name===r.mode)),n||(n=i.modes[0])):n=i.disabledMode,n.disabledLayers&&n.disabledLayers.forEach((e=>{this.m_disabledStyles.byLayer.add(e)})),n.disabledStyleRules&&n.disabledStyleRules.forEach((e=>{this.m_disabledStyles.byId.add(e)})),this.m_currentDefinitions&&(null==n?void 0:n.extendedDefinitions)&&(this.m_areCurrentDefinitionsOverridden=!0,Object.assign(this.m_currentDefinitions,null==n?void 0:n.extendedDefinitions))}this.m_definitionExprCache.clear(),this.m_cachedResults.clear(),this.m_subStyleSetCache.clear(),this.compileStyleSet()}validateFeatures(e){const t={};for(const i in e){const n=e[i];Array.isArray(n.modes)&&0!==n.modes.length&&void 0!==n.disabledMode?t[i]=n:c.error(`The style configuration is invalid. The feature "${i}" must be an array, have at least one mode and specify a value for disabledMode property`)}if(Object.keys(t).length>0)return t}isStyleDisabled(e){if(void 0!==this.m_disabledStyles){if(void 0!==e.layer&&this.m_disabledStyles.byLayer.has(e.layer))return!0;if(void 0!==e.id&&this.m_disabledStyles.byId.has(e.id))return!0}return!1}getMatchingTechniques(e,t,i){if(this.m_previousResult&&this.m_previousEnv&&this.m_featureDependencies.every((t=>{var i;return(null===(i=this.m_previousEnv)||void 0===i?void 0:i.lookup(t))===e.lookup(t)})))return this.m_previousResult;const n=[];this.m_cachedResults.clear();const r=this.m_tmpOptimizedSubSetKey;r.set(t,i,e),this.m_dataLayer=r.layer,this.m_geometryType=r.geometryType,this.m_zoomLevel=e.lookup("$zoom");const s=this.getOptimizedStyleSet(r);for(const t of s)if(this.processStyle(e,t,n))break;return this.m_previousResult=n,this.m_previousEnv=e,n}wantsDataLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0,this.m_previousResult=void 0,this.m_previousEnv=void 0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(m)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:i}=e;return this.styleSet.filter((e=>!(void 0!==t&&void 0!==e.dataLayer&&e.dataLayer!==t||void 0!==i&&void 0!==e._geometryType&&e._geometryType!==i)))}compileStyleSet(){this.styleSet.forEach((e=>this.compileStyle(e))),this.styleSet.forEach((e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.dataLayer,e._geometryType))}))}compileStyle(e){var t,i;try{this.compileStyleAttributes(e)}catch(t){c.error("failed to evaluate style rule",e,String(t))}if(void 0!==e.when)try{e._whenExpr=r.Expr.fromJSON(e.when,this.m_currentDefinitions,this.m_definitionExprCache),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool));const s=e._whenExpr.dependencies();null==s||s.properties.forEach((e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)})),(0,n.isJsonExpr)(null===(t=e.attr)||void 0===t?void 0:t.minZoomLevel)&&(e._minZoomLevelExpr=r.Expr.fromJSON(e.attr.minZoomLevel,this.m_currentDefinitions).intern(this.m_exprPool)),(0,n.isJsonExpr)(null===(i=e.attr)||void 0===i?void 0:i.maxZoomLevel)&&(e._maxZoomLevelExpr=r.Expr.fromJSON(e.attr.maxZoomLevel,this.m_currentDefinitions).intern(this.m_exprPool))}catch(t){c.error("failed to evaluate expression",JSON.stringify(e.when),String(t))}}processStyle(e,t,i){if(!this.checkZoomLevel(e,t))return!1;if(this.isStyleDisabled(t))return!1;if(void 0!==this.m_dataLayer&&void 0!==t.dataLayer&&t.dataLayer!==this.m_dataLayer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return c.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&("none"!==t.technique&&i.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){var i,n,s,o,a;const l=this.m_zoomLevel;if(void 0===l||l>=17)return!0;let h=null===(i=t.attr)||void 0===i?void 0:i.minZoomLevel,u=null===(n=t.attr)||void 0===n?void 0:n.maxZoomLevel;if(void 0===h&&void 0===u)return!0;if(void 0!==h){if(!1===(null===(s=t._minZoomLevelExpr)||void 0===s?void 0:s.isDynamic()))try{h=t._minZoomLevelExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if("number"==typeof h&&l<Math.floor(h))return!1}if(void 0!==(null===(o=t.attr)||void 0===o?void 0:o.maxZoomLevel)){if(!1===(null===(a=t._maxZoomLevelExpr)||void 0===a?void 0:a.isDynamic()))try{u=t._maxZoomLevelExpr.evaluate(e,r.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if("number"==typeof u&&l>=Math.ceil(u))return!1}return!0}getTechniqueForStyleMatch(e,t){let i;if(void 0!==t._dynamicTechniques){const n=this.evaluateTechniqueProperties(t,e),r=this.getDynamicTechniqueKey(t,n);i=t._dynamicTechniques.get(r),void 0===i&&(i=this.createTechnique(t,n),t._dynamicTechniques.set(r,i))}else i=t._staticTechnique,void 0===i&&(t._staticTechnique=i=this.createTechnique(t,[]));return void 0===i._index&&(i._index=this.m_techniques.length,this.m_techniques.push(i)),i}getDynamicTechniqueKey(e,t){const i=t.map((([e,t])=>void 0===t?"U":"object"==typeof t?JSON.stringify(t,((e,t)=>{if(t instanceof ArrayBuffer){let e=t.id;return void 0===e&&(e=t.id=this.m_nextArrayBufferId++),e}return t})):JSON.stringify(t))).join(":");return`${e._styleIndex}:${i}`}compileStyleAttributes(e){var t;if(!e._forceCompile&&(void 0!==e._dynamicTechniqueAttributes||"none"===e.technique))return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[],e._staticTechnique=void 0,e._dynamicTechniques=void 0;const i=e._dynamicFeatureAttributes,s=e._dynamicTechniqueAttributes,a=e._dynamicForwardedAttributes,u=e._staticAttributes,d=(t,d)=>{if(void 0===d)return;const m=new Set;if((0,n.isJsonExpr)(d)?d=r.Expr.fromJSON(d,this.m_currentDefinitions,this.m_definitionExprCache,m).intern(this.m_exprPool):(0,o.isInterpolatedPropertyDefinition)(d)&&(d=r.Expr.fromJSON((0,o.interpolatedPropertyDefinitionToJsonExpr)(d)).intern(this.m_exprPool)),r.Expr.isExpr(d)){const i=d.dependencies();i.featureState&&("enabled"!==t?c.log("feature-state is not supported in this context"):e._usesFeatureState=!0),0!==i.properties.size||d.isDynamic()||(d=d.evaluate(this.m_emptyEnv))}if(r.Expr.isExpr(d)){const n=function(e,t){var i,n,r;return"extruded-polygon"===e.technique&&"color"===t&&!1!==(null===(i=e.attr)||void 0===i?void 0:i.vertexColors)?h:null!==(r=null===(n=(0,l.getTechniqueAttributeDescriptor)(e.technique,t))||void 0===n?void 0:n.scope)&&void 0!==r?r:h}(e,t),r=d.dependencies();switch(r.properties.forEach((e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)})),n){case l.AttrScope.FeatureGeometry:i.push([t,d]);break;case l.AttrScope.TechniqueGeometry:s.push([t,d]);break;case l.AttrScope.TechniqueRendering:0===r.properties.size?a.push([t,d]):s.push([t,d])}}else null!=d&&u.push([t,d]);for(const t of m.values())if(this.m_modesDefinitions.has(t)){e._forceCompile=!0;break}};e._forceCompile=!1;for(const t in e)e.hasOwnProperty(t)&&(t.startsWith("_")||["when","technique","layer","attr","category","description"].includes(t)||d(t,e[t]));const m=new Map([["category","_category"]]);if(void 0!==e.attr)for(const i in e.attr)e.attr.hasOwnProperty(i)&&d(null!==(t=m.get(i))&&void 0!==t?t:i,e.attr[i]);s.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){return void 0===e._dynamicTechniqueAttributes?[]:e._dynamicTechniqueAttributes.map((([e,i])=>{try{return[e,i.evaluate(t,r.ExprScope.Value,this.m_cachedResults)]}catch(t){return c.error(`failed to evaluate expression '${i.toJSON()}': ${t}`),[e,null]}}))}createTechnique(e,t){var i,r;const s={};if(s.name=e.technique,void 0!==e._staticAttributes)for(const[t,i]of e._staticAttributes)null!==i&&(s[t]=i);for(const[e,i]of t)null!==i&&(s[e]=i);if(void 0!==e._dynamicFeatureAttributes)for(const[t,i]of e._dynamicFeatureAttributes)s[t]=i;if(void 0!==e._dynamicForwardedAttributes)for(const[t,i]of e._dynamicForwardedAttributes)s[t]=i;return s._index=this.m_techniques.length,s._styleIndex=e._styleIndex,void 0!==e.layer&&(s._layer=e.layer),void 0!==e._usesFeatureState&&(s._usesFeatureState=e._usesFeatureState),(0,n.setTechniqueRenderOrderOrPriority)(s,null!==(i=this.m_options.priorities)&&void 0!==i?i:[],null!==(r=this.m_options.labelPriorities)&&void 0!==r?r:[]),this.m_techniques.push(s),s}},t.makeDecodedTechnique=m},3561:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateTechniqueAttr=void 0;const n=i(1984),r=i(8920);t.evaluateTechniqueAttr=function(e,t,i){if(void 0===t)return i;const s=n.Env.isEnv(e)?(0,r.getPropertyValue)(t,e):(0,r.getPropertyValue)(t,e.env,e.cachedExprResults);return null!=s?s:i}},5535:(e,t)=>{"use strict";var i;function n(...e){const t={attrDescriptors:{}};for(const i of e)void 0!==i.attrTransparencyColor&&(t.attrTransparencyColor=i.attrTransparencyColor),void 0!==i.attrDescriptors&&(t.attrDescriptors=Object.assign(Object.assign({},t.attrDescriptors),i.attrDescriptors));return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getTechniqueAutomaticAttrs=t.getTechniqueAttributeDescriptor=t.getTechniqueDescriptor=t.AttrScope=void 0,function(e){e[e.FeatureGeometry=0]="FeatureGeometry",e[e.TechniqueGeometry=1]="TechniqueGeometry",e[e.TechniqueRendering=2]="TechniqueRendering"}(i=t.AttrScope||(t.AttrScope={}));const r={attrTransparencyColor:"color",attrDescriptors:{constantHeight:i.FeatureGeometry,visible:i.FeatureGeometry,fadeFar:i.TechniqueRendering,fadeNear:i.TechniqueRendering,transparent:{scope:i.TechniqueRendering,automatic:!0},side:{scope:i.TechniqueRendering,automatic:!0}}},s=n(r,{attrDescriptors:{color:{scope:i.TechniqueRendering,automatic:!0},size:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0}}}),o=n(r,s),a=n(r,s),l=n(r,{attrDescriptors:{text:i.FeatureGeometry,imageTexture:i.FeatureGeometry,iconColor:i.TechniqueRendering,iconBrightness:i.TechniqueRendering,textBrightness:i.TechniqueRendering,backgroundColor:i.TechniqueRendering,backgroundSize:i.TechniqueRendering,backgroundOpacity:i.TechniqueRendering,color:i.TechniqueRendering,opacity:i.TechniqueRendering,size:i.TechniqueRendering,priority:i.TechniqueRendering,zOrder:i.TechniqueRendering,margin:i.TechniqueRendering,"check-margin":i.TechniqueRendering,"anchor-point-density":i.TechniqueRendering}}),c={attrDescriptors:{polygonOffset:{scope:i.TechniqueRendering,automatic:!0},polygonOffsetFactor:{scope:i.TechniqueRendering,automatic:!0},polygonOffsetUnits:{scope:i.TechniqueRendering,automatic:!0},depthTest:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},color:{scope:i.TechniqueRendering,automatic:!0},lineColor:i.TechniqueRendering,lineFadeFar:i.TechniqueRendering,lineFadeNear:i.TechniqueRendering}},h=n(r,c,{attrDescriptors:{width:i.TechniqueRendering,cap:{scope:i.TechniqueRendering,automatic:!0},drawRangeStart:{scope:i.TechniqueRendering,automatic:!0},drawRangeEnd:{scope:i.TechniqueRendering,automatic:!0},dashes:{scope:i.TechniqueRendering,automatic:!0},dashColor:{scope:i.TechniqueRendering,automatic:!0},"dash-pattern":{scope:i.TechniqueRendering,automatic:!0},"dash-image":{scope:i.TechniqueRendering,automatic:!0}}}),u=n(r,{attrDescriptors:{color:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},width:i.FeatureGeometry}}),d=n(r,c,{attrDescriptors:{wireframe:{scope:i.TechniqueRendering,automatic:!0},color:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},lineWidth:i.TechniqueRendering,map:{scope:i.TechniqueRendering,automatic:!0}}}),m=n(r,{attrDescriptors:{color:{scope:i.TechniqueRendering,automatic:!0},vertexColors:{scope:i.TechniqueRendering,automatic:!0},wireframe:{scope:i.TechniqueRendering,automatic:!0},roughness:{scope:i.TechniqueRendering,automatic:!0},metalness:{scope:i.TechniqueRendering,automatic:!0},alphaTest:{scope:i.TechniqueRendering,automatic:!0},depthTest:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},emissive:{scope:i.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:i.TechniqueRendering,automatic:!0},refractionRatio:{scope:i.TechniqueRendering,automatic:!0},normalMapType:{scope:i.TechniqueRendering,automatic:!0},map:{scope:i.TechniqueRendering,automatic:!0},normalMap:{scope:i.TechniqueRendering,automatic:!0},displacementMap:{scope:i.TechniqueRendering,automatic:!0},roughnessMap:{scope:i.TechniqueRendering,automatic:!0},emissiveMap:{scope:i.TechniqueRendering,automatic:!0},bumpMap:{scope:i.TechniqueRendering,automatic:!0},metalnessMap:{scope:i.TechniqueRendering,automatic:!0},alphaMap:{scope:i.TechniqueRendering,automatic:!0}}}),p={"extruded-polygon":n(r,{attrDescriptors:{depthTest:{scope:i.TechniqueRendering,automatic:!0},vertexColors:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},color:{scope:i.TechniqueRendering,automatic:!0},colorIntensity:{scope:i.TechniqueRendering,automatic:!0},specular:{scope:i.TechniqueRendering,automatic:!0},emissive:{scope:i.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:i.TechniqueRendering,automatic:!0},shininess:{scope:i.TechniqueRendering,automatic:!0},displacementMap:{scope:i.TechniqueRendering,automatic:!0},height:i.FeatureGeometry,floorHeight:i.FeatureGeometry,defaultColor:i.FeatureGeometry,defaultHeight:i.FeatureGeometry,boundaryWalls:i.FeatureGeometry,footprint:i.FeatureGeometry,maxSlope:i.FeatureGeometry,animateExtrusion:i.TechniqueRendering,lineWidth:i.TechniqueRendering,lineFadeNear:i.TechniqueRendering,lineFadeFar:i.TechniqueRendering,lineColor:i.TechniqueRendering}}),"line-marker":l,"labeled-icon":l,"solid-line":h,"dashed-line":h,terrain:m,standard:m,squares:o,circles:a,line:u,segments:u,polygon:d,text:n(r,{attrDescriptors:{text:i.FeatureGeometry,backgroundColor:i.TechniqueRendering,backgroundSize:i.TechniqueRendering,backgroundOpacity:i.TechniqueRendering,color:i.TechniqueRendering,opacity:i.TechniqueRendering,size:i.TechniqueRendering,priority:i.TechniqueRendering,zOrder:i.TechniqueRendering}}),raster:n(r,{attrDescriptors:{brightness:{scope:i.TechniqueRendering,automatic:!0},gamma:{scope:i.TechniqueRendering,automatic:!0}}})};function f(e){return"string"!=typeof e&&(e=e.name),p[e]}t.getTechniqueDescriptor=f,t.getTechniqueAttributeDescriptor=function(e,t){const i=f(e),n=null==i?void 0:i.attrDescriptors,r=null==n?void 0:n[t];if(void 0!==typeof r)return"object"==typeof r?r:{scope:r}};const g=new Map;t.getTechniqueAutomaticAttrs=function(e){var t;if("string"!=typeof e&&(e=e.name),g.has(e))return g.get(e);const i=[],n=null===(t=f(e))||void 0===t?void 0:t.attrDescriptors;if(void 0===n)return i;for(const e in n){if(!n.hasOwnProperty(e))continue;const t=n[e];void 0!==t&&"number"!=typeof t&&!0===t.automatic&&i.push(e)}return g.set(e,i),i}},8934:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThreeBufferUtils=void 0;const n=i(3253);!function(e){function t(e){if(e instanceof Int8Array)return"int8";if(e instanceof Uint8Array)return"uint8";if(e instanceof Int16Array)return"int16";if(e instanceof Uint16Array)return"uint16";if(e instanceof Int32Array)return"int32";if(e instanceof Uint32Array)return"uint32";if(e instanceof Float32Array)return"float";throw new Error(`Unsupported buffer type ${name}`)}function i(e){const i=e.array;return{name:e.name,buffer:i.buffer,type:t(i),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=i,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error("Not implemented yet")},e.fromThreeBufferGeometry=function(e,t){const r=[],s=Object.getOwnPropertyNames(e.attributes);for(const t of s){const n=i(e.attributes[t]);n.name=t,r.push(n)}const o=null!==e.index?i(e.index):void 0;let a=0;if(void 0!==o)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error("Missing position attibute to deduce item count");a=t.count}return{type:n.GeometryType.Unspecified,vertexAttributes:r,index:o,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},8770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9362:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerDecoderProtocol=t.RequestController=void 0,t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,i;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(i=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},4835:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerServiceProtocol=void 0,function(e){let t,i;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(i=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return e.message.includes("unknown targetServiceType requested: ")},e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},9421:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerTilerProtocol=void 0,function(e){let t;!function(e){e.RegisterIndex="register-index",e.UpdateIndex="update-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},6892:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6112:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapLineString=t.clipLineString=void 0;const n=i(5448),r=i(6815),s=i(2616),o=i(4342);class a{constructor(e,t,i,r,s){this.isInside=s,this.p0=new n.Vector2(e,t),this.p1=new n.Vector2(i,r)}inside(e){return this.isInside(e)}computeIntersection(e,t){const i=new n.Vector2;return o.Math2D.intersectLines(e.x,e.y,t.x,t.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,i),i}clipLine(e){const t=e,i=[];e=[],i.push(e);const n=t=>{0!==e.length&&e[e.length-1].equals(t)||e.push(t)};for(let r=0;r<t.length;++r){const s=t[r],o=r>0?t[r-1]:void 0;this.inside(s)?(void 0===o||this.inside(o)||(e.length>0&&(e=[],i.push(e)),n(this.computeIntersection(o,s))),n(s)):void 0!==o&&this.inside(o)&&n(this.computeIntersection(o,s))}return 0===i[i.length-1].length&&(i.length=i.length-1),i}clipLines(e){const t=[];return e.forEach((e=>{this.clipLine(e).forEach((e=>{t.push(e)}))})),t}}function l(e,t,i){for(const i of t)e=i.clipLines(e);const n=new r.Vector3,o=[];return e.forEach((e=>{if(0===e.length)return;const t=e.map((({x:e,y:t})=>{n.set(e,t,0);const r=s.webMercatorProjection.unprojectPoint(n);return r.longitude+=i,r}));o.push(t)})),o.length>0?o:void 0}t.clipLineString=function(e,t,i,n,r){const s=new a(t,i,t,r,(e=>e.x>t)),o=new a(t,r,n,r,(e=>e.y<r)),l=new a(n,r,n,i,(e=>e.x<n)),c=new a(n,i,t,i,(e=>e.y>i));let h=s.clipLine(e);return h=o.clipLines(h),h=l.clipLines(h),h=c.clipLines(h),h},t.wrapLineString=function(e){const t=new r.Vector3,i=[e.map((e=>{const{x:i,y:r}=s.webMercatorProjection.projectPoint(e,t);return new n.Vector2(i,r)}))];return{left:l(i,u,360),middle:l(i,h,0),right:l(i,d,-360)}};const c=s.EarthConstants.EQUATORIAL_CIRCUMFERENCE,h=[new a(0,c,0,0,(e=>e.x>0)),new a(c+0,0,c+0,c,(e=>e.x<c+0))],u=[new a(-c-0,c,-c-0,0,(e=>e.x>-c-0)),new a(0,0,0,c,(e=>e.x<0))],d=[new a(c-0,c,c-0,0,(e=>e.x>c-0)),new a(2*c+0,0,2*c+0,c,(e=>e.x<2*c+0))]},2982:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clipPolygon=t.ClippingEdge=void 0;const n=i(5448);class r{clipPolygon(e,t){const i=e;e=[];const n=t=>{const i=e[e.length-1];(!(null==i?void 0:i.equals(t))||!0===t.isClipped&&!(null==i?void 0:i.isClipped)||!t.isClipped&&!0===(null==i?void 0:i.isClipped))&&e.push(t)};for(let e=0;e<i.length;++e){const r=i[e],s=i[(e+i.length-1)%i.length];if(this.inside(r,t)){if(!this.inside(s,t)){const e=this.computeIntersection(s,r,t);e.isClipped=!0,n(e)}n(r)}else if(this.inside(s,t)){const e=this.computeIntersection(s,r,t);e.isClipped=!0,n(e)}}return e}}t.ClippingEdge=r;const s=[new class extends r{inside(e){return e.y>=0}computeIntersection(e,t){const{x:i,y:r}=e,{x:s,y:o}=t;return new n.Vector2((i*o-r*s)/-(r-o),0).round()}},new class extends r{inside(e,t){return e.x<=t}computeIntersection(e,t,i){const{x:r,y:s}=e,{x:o,y:a}=t;return new n.Vector2(i,(r*a-s*o-(s-a)*-i)/(r-o)).round()}},new class extends r{inside(e,t){return e.y<=t}computeIntersection(e,t,i){const{x:r,y:s}=e,{x:o,y:a}=t;return new n.Vector2((r*a-s*o-(r-o)*i)/-(s-a),i).round()}},new class extends r{inside(e){return e.x>=0}computeIntersection(e,t){const{x:i,y:r}=e,{x:s,y:o}=t;return new n.Vector2(0,(i*o-r*s)/(i-s)).round()}}];t.clipPolygon=function(e,t){if(0===e.length)return e;e[0].equals(e[e.length-1])||(e=[...e,e[0]]);for(const i of s)e=i.clipPolygon(e,t);return e.length<3?[]:e}},6525:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeLengthGeometrySubdivisionModifier=t.SubdivisionMode=void 0;const n=i(6815),r=i(2616),s=i(4342),o=i(3386),a=[new n.Vector3,new n.Vector3];var l;!function(e){e[e.All=0]="All",e[e.NoDiagonals=1]="NoDiagonals"}(l=t.SubdivisionMode||(t.SubdivisionMode={}));class c extends o.SubdivisionModifier{constructor(e,t,i=l.All,n){super(),this.subdivision=e,this.geoBox=t,this.subdivisionMode=i,this.projection=n,(0,s.assert)(n.type===r.ProjectionType.Planar,"EdgeLengthGeometrySubdivisionModifier only supports planar projections");const o=n.projectPoint(t.northEast,a[0]),c=n.projectPoint(t.southWest,a[1]);this.m_projectedBox={min:{x:Math.min(o.x,c.x),y:Math.min(o.y,c.y),z:Math.min(o.z,c.z)},max:{x:Math.max(o.x,c.x),y:Math.max(o.y,c.y),z:Math.max(o.z,c.z)}},this.m_maxLengthX=(this.m_projectedBox.max.x-this.m_projectedBox.min.x)/e,this.m_maxLengthY=(this.m_projectedBox.max.y-this.m_projectedBox.min.y)/e,this.subdivisionMode===l.All&&(this.m_maxLengthX*=1.1,this.m_maxLengthY*=1.1),this.m_maxLength=Math.sqrt(this.m_maxLengthX*this.m_maxLengthX+this.m_maxLengthY*this.m_maxLengthY)}get maxLength(){return this.m_maxLength}get maxLengthX(){return this.m_maxLengthX}get maxLengthY(){return this.m_maxLengthY}shouldSplitTriangle(e,t,i){const n=this.shouldSplitEdge(e,t),r=this.shouldSplitEdge(t,i),s=this.shouldSplitEdge(i,e);if(!(n||r||s))return;const o=e.distanceTo(t),a=t.distanceTo(i),l=i.distanceTo(e),c=Math.max(n?o:0,r?a:0,s?l:0);if(o===c)return 0;if(a===c)return 1;if(l===c)return 2;throw new Error("Could not split triangle.")}shouldSplitEdge(e,t){switch(this.subdivisionMode){case l.All:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY||e.distanceTo(t)>this.m_maxLength;case l.NoDiagonals:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY}}}t.EdgeLengthGeometrySubdivisionModifier=c},6189:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphericalGeometrySubdivisionModifier=void 0;const n=i(6815),r=i(2616),s=i(3386),o=[new n.Vector3,new n.Vector3,new n.Vector3];class a extends s.SubdivisionModifier{constructor(e,t=r.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,i){const n=r.sphereProjection.reprojectPoint(this.projection,e,o[0]),s=r.sphereProjection.reprojectPoint(this.projection,t,o[1]),a=r.sphereProjection.reprojectPoint(this.projection,i,o[2]),l=n.angleTo(s),c=s.angleTo(a),h=a.angleTo(n),u=Math.max(l,Math.max(c,h));if(!(u<this.angle)){if(u===l)return 0;if(u===c)return 1;if(u===h)return 2;throw new Error("failed to split triangle")}}}t.SphericalGeometrySubdivisionModifier=a},3386:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubdivisionModifier=void 0;const n=i(6815),r=new n.Vector3,s=new n.Vector3,o=new n.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute("position"),i=Array.from(t.array),n=e.getAttribute("uv"),a=void 0!==n?Array.from(n.array):void 0,l=e.getAttribute("edge"),c=void 0!==l?Array.from(l.array):void 0,h=e.getAttribute("wall"),u=void 0!==h?Array.from(h.array):void 0,d=e.getIndex(),m=Array.from(d.array),p=new Map;function f(e,t){const n=`${Math.min(e,t)}_${Math.max(e,t)}`,l=p.get(n);if(void 0!==l)return l;r.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.lerpVectors(r,s,.5);const h=i.length/3;return i.push(...o.toArray()),p.set(n,h),void 0!==a&&(r.set(a[2*e],a[2*e+1],0),s.set(a[2*t],a[2*t+1],0),o.lerpVectors(r,s,.5),a.push(o.x,o.y)),void 0!==c&&(c[e]===t?(c.push(t),c[e]=h):c[t]===e?(c.push(e),c[t]=h):c.push(-1)),void 0!==u&&(u[e]===t?(u.push(t),u[e]=h):u[t]===e?(u.push(e),u[t]=h):u.push(-1)),h}const g=[];for(;m.length>=3;){const e=m.shift(),t=m.shift(),n=m.shift();switch(r.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.set(i[3*n],i[3*n+1],i[3*n+2]),this.shouldSplitTriangle(r,s,o)){case 0:{const i=f(e,t);m.push(e,i,n,i,t,n);break}case 1:{const i=f(t,n);m.push(e,t,i,e,i,n);break}case 2:{const i=f(n,e);m.push(e,t,i,i,t,n);break}case void 0:g.push(e,t,n);break;default:throw new Error("failed to subdivide the given geometry")}}return t.array=t.array instanceof Float32Array?new Float32Array(i):new Float64Array(i),t.count=i.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(n.array=new Float32Array(a),n.count=a.length/n.itemSize,n.needsUpdate=!0),void 0!==c&&(l.array=new Float32Array(c),l.count=c.length/l.itemSize,l.needsUpdate=!0),e}}},3997:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapLineString=void 0;var n=i(6112);Object.defineProperty(t,"wrapLineString",{enumerable:!0,get:function(){return n.wrapLineString}})},8965:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapPolygon=void 0;const n=i(5448),r=i(6815),s=i(2616),o=i(4342),a=i(2982);class l extends a.ClippingEdge{constructor(e,t,i){super(),this.isInside=i,this.p0=(new n.Vector2).fromArray(e),this.p1=(new n.Vector2).fromArray(t)}inside(e,t){return this.isInside(e)}computeIntersection(e,t,i){const r=new n.Vector2;return o.Math2D.intersectLines(e.x,e.y,t.x,t.y,this.p0.x,this.p0.y,this.p1.x,this.p1.y,r),r}}const c=s.EarthConstants.EQUATORIAL_CIRCUMFERENCE,h=.05*c,u=[new l([0-h,c],[0-h,0],(e=>e.x>0-h)),new l([c+h,0],[c+h,c],(e=>e.x<c+h))],d=[new l([-c-h,c],[-c-h,0],(e=>e.x>-c-h)),new l([0+h,0],[0+h,c],(e=>e.x<0+h))],m=[new l([c-h,c],[c-h,0],(e=>e.x>c-h)),new l([2*c+h,0],[2*c+h,c],(e=>e.x<2*c+h))];function p(e,t,i){for(const i of t)e=i.clipPolygon(e,0);const n=new r.Vector3,o=e.map((({x:e,y:t})=>{n.set(e,t,0);const r=s.webMercatorProjection.unprojectPoint(n);return r.longitude+=i,r}));return o.length>0?o:void 0}t.wrapPolygon=function(e){const t=new r.Vector3,i=e.map((e=>{const{x:i,y:r}=s.webMercatorProjection.projectPoint(e,t);return new n.Vector2(i,r)}));return{left:p(i,d,360),middle:p(i,u,0),right:p(i,m,-360)}}},2616:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(3068),t),r(i(5999),t),r(i(6306),t),r(i(4860),t),r(i(8248),t),r(i(9019),t),r(i(6482),t),r(i(7870),t),r(i(5610),t),r(i(1515),t),r(i(9686),t),r(i(5234),t),r(i(9885),t),r(i(7289),t),r(i(6322),t),r(i(9861),t),r(i(435),t),r(i(9447),t),r(i(7171),t),r(i(3424),t),r(i(4948),t),r(i(6541),t),r(i(7841),t),r(i(2801),t),r(i(6557),t),r(i(4490),t),r(i(2224),t),r(i(1635),t),r(i(1871),t),r(i(2953),t),r(i(1383),t),r(i(9264),t),r(i(58),t),r(i(7523),t),r(i(2683),t),r(i(2334),t)},3068:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoBox=void 0;const n=i(3334),r=i(4860);class s{static fromCoordinates(e,t){return new s(e,t)}static fromCenterAndExtents(e,t){return new s(new r.GeoCoordinates(e.latitude-t.latitudeSpan/2,e.longitude-t.longitudeSpan/2),new r.GeoCoordinates(e.latitude+t.latitudeSpan/2,e.longitude+t.longitudeSpan/2))}constructor(e,t){this.southWest=e,this.northEast=t,this.west>this.east&&(this.northEast.longitude+=360)}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:i}=this,{minAltitude:n,altitudeSpan:s}=this;let o;if(void 0!==n&&void 0!==s&&(o=n+.5*s),t<=i)return new r.GeoCoordinates(e,.5*(t+i),o);let a=.5*(360+i+t);return a>360&&(a-=360),new r.GeoCoordinates(e,a,o)}get latitudeSpanInRadians(){return(0,n.degToRad)(this.latitudeSpan)}get longitudeSpanInRadians(){return(0,n.degToRad)(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,i=this.minAltitude===e.altitude,n=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!!(t?i:n)&&this.containsHelper(e)}clone(){return new s(this.southWest.clone(),this.northEast.clone())}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:i}=this;let n=e.longitude;if(i>r.MAX_LONGITUDE)for(;n<t;)n+=360;if(n>i)for(;n>t+360;)n-=360;return n>=t&&n<i}}t.GeoBox=s},5999:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoBoxExtentLike=void 0,t.isGeoBoxExtentLike=function(e){return e&&"object"==typeof e&&"number"==typeof e.latitudeSpan&&"number"==typeof e.longitudeSpan}},680:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordLike=t.geoCoordLikeToGeoPointLike=t.geoCoordLikeToGeoCoordinatesLike=void 0;const n=i(6306),r=i(8248),s=i(7870);t.geoCoordLikeToGeoCoordinatesLike=function(e){return(0,n.isGeoCoordinatesLike)(e)?e:(0,s.isLatLngLike)(e)?{latitude:e.lat,longitude:e.lng}:{latitude:e[1],longitude:e[0]}},t.geoCoordLikeToGeoPointLike=function(e){return(0,r.isGeoPointLike)(e)?e:(0,s.isLatLngLike)(e)?[e.lng,e.lat]:[e.longitude,e.latitude]},t.isGeoCoordLike=function(e){return(0,n.isGeoCoordinatesLike)(e)||(0,s.isLatLngLike)(e)||!(0,r.isGeoPointLike)(e)}},4860:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoCoordinates=t.MIN_LONGITUDE=t.MAX_LONGITUDE=t.MIN_LATITUDE=t.MAX_LATITUDE=void 0;const n=i(6815),r=i(3334),s=i(6306),o=i(8248),a=i(7870);t.MAX_LATITUDE=90,t.MIN_LATITUDE=-90,t.MAX_LONGITUDE=180,t.MIN_LONGITUDE=-180;const l=new n.Vector3,c=new n.Vector3;class h{static fromDegrees(e,t,i){return new h(e,t,i)}static fromRadians(e,t,i){return new h((0,r.radToDeg)(e),(0,r.radToDeg)(t),i)}static fromLatLng(e){return new h(e.lat,e.lng)}static fromGeoPoint(e){return new h(e[1],e[0],e[2])}static fromObject(e){if((0,o.isGeoPointLike)(e))return h.fromGeoPoint(e);if((0,s.isGeoCoordinatesLike)(e))return h.fromDegrees(e.latitude,e.longitude,e.altitude);if((0,a.isLatLngLike)(e))return h.fromDegrees(e.lat,e.lng);throw new Error("Invalid input coordinate format.")}static lerp(e,t,i,n=!1,r=!1){var s,o;if(n){if(e.lng<t.lng){const n=e.clone();return n.longitude+=360,this.lerp(t,n,1-i)}{const n=t.clone();return n.longitude+=360,this.lerp(e,n,i)}}const a=l.set(e.lat,e.lng,null!==(s=e.altitude)&&void 0!==s?s:0),u=c.set(t.lat,t.lng,null!==(o=t.altitude)&&void 0!==o?o:0);a.lerp(u,i);const d=new h(a.x,a.y,a.z);return r?d.normalized():d}constructor(e,t,i){this.latitude=e,this.longitude=t,this.altitude=i}get latitudeInRadians(){return(0,r.degToRad)(this.latitude)}get longitudeInRadians(){return(0,r.degToRad)(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;return isNaN(e)||isNaN(t)?this:((t<-180||t>180)&&(t=function(e){const t=e%360;return t<0==0?t:t+360}(t+180)-180),e=(0,r.clamp)(e,-90,90),new h(e,t,this.altitude))}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new h(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}minLongitudeSpanTo(e){const t=Math.min(this.longitude,e.longitude),i=Math.max(this.longitude,e.longitude);return Math.min(i-t,360+t-i)}}t.GeoCoordinates=h},6306:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=void 0,t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},8248:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPointLike=void 0,t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,i,n]=e;return"number"==typeof t&&"number"==typeof i&&(void 0===n||"number"==typeof n)}return!1}},6482:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPolygon=t.isAntimeridianCrossing=void 0;const n=i(5448),r=i(3068),s=i(4860),o=i(680);function a(e,t){return Math.max(e,t)-Math.min(e,t)}function l(e,t){return e>0&&t<0&&a(e,t)>180}t.isAntimeridianCrossing=function(e,t){return Math.sign(e)===-Math.sign(t)&&a(e,t)>180},t.GeoPolygon=class{constructor(e,t=!1,i=!1){this.m_coordinates=e.map((e=>(0,o.geoCoordLikeToGeoCoordinatesLike)(e))),t&&this.sortCCW(),i&&this.wrapCoordinatesAround()}get coordinates(){return this.m_coordinates}getGeoBoundingBox(){const e=this.getCentroid();if(void 0===e)return r.GeoBox.fromCoordinates(this.coordinates[0],this.coordinates[0]);const{east:t,west:i}=this.getEastAndWest(e),{north:n,south:o}=this.getNorthAndSouth();return r.GeoBox.fromCoordinates(new s.GeoCoordinates(o,i),new s.GeoCoordinates(n,t))}getCentroid(){const e=this.getArea();if(0===e)return;let t,i=0,n=0,r=this.m_coordinates.length-1;return this.m_coordinates.forEach(((e,s)=>{const o=this.m_coordinates[r];t=e.latitude*o.longitude-o.latitude*e.longitude,i+=(e.latitude+o.latitude)*t,n+=(e.longitude+o.longitude)*t,r=s})),t=6*e,new s.GeoCoordinates(i/t,e<0?n/t-180:n/t)}sortCCW(){const e=this.getPolyAverageCenter();e&&this.m_coordinates.sort(((t,i)=>{const r=new n.Vector2(t.latitude-e.latitude,t.longitude-e.longitude).normalize();return new n.Vector2(i.latitude-e.latitude,i.longitude-e.longitude).normalize().angle()-r.angle()}))}wrapCoordinatesAround(){const e=this.m_coordinates.findIndex(((e,t)=>{const i=0===t?this.m_coordinates.length-1:t-1;return l(this.m_coordinates[i].longitude,e.longitude)}));if(e<0)return;let t=!0;for(let i=0;i<this.m_coordinates.length;i++){const n=(e+i)%this.m_coordinates.length,r=this.m_coordinates[n].longitude,s=this.m_coordinates[(n+1)%this.m_coordinates.length].longitude;t&&(this.m_coordinates[n].longitude+=360),l(s,r)?t=!1:l(r,s)&&(t=!0)}}getPolyAverageCenter(){const e=this.m_coordinates.reduce(((e,t)=>new s.GeoCoordinates(e.latitude+t.latitude,e.longitude+t.longitude)));return new s.GeoCoordinates(e.latitude/this.m_coordinates.length,e.longitude/this.m_coordinates.length)}getArea(){let e=0,t=this.m_coordinates.length-1;return this.m_coordinates.forEach(((i,n)=>{const r=this.m_coordinates[t];e+=i.latitude*r.longitude,e-=i.longitude*r.latitude,t=n})),e/=2}getEastAndWest(e){let t=e.longitude,i=e.longitude,r=this.m_coordinates.length-1;return this.m_coordinates.forEach(((s,o)=>{const a=this.m_coordinates[r];r=o;const l=new n.Vector2(s.latitude-e.latitude,s.longitude-e.longitude).normalize(),c=new n.Vector2(a.latitude-e.latitude,a.longitude-e.longitude).normalize();let h=1===Math.sign(c.angle()-l.angle());c.y>=0&&l.y<0&&(h=!0);const u=s.longitude;u<e.longitude?h?t=Math.min(t,u):i=Math.min(i,u):h?i=Math.max(i,u):t=Math.max(t,u)})),{east:i,west:t}}getNorthAndSouth(){let e=s.MIN_LATITUDE,t=s.MAX_LATITUDE;return this.m_coordinates.forEach(((i,n)=>{e=Math.max(e,i.latitude),t=Math.min(t,i.latitude)})),{north:e,south:t}}}},9019:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPolygonLike=void 0;const n=i(680);t.isGeoPolygonLike=function(e){if(!e||!Array.isArray(e.coordinates)&&e.coordinates.length>2)return!1;let t=!0;return e.coordinates.forEach((i=>{(0,n.isGeoCoordLike)(e)||(t=!1)})),t}},7870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLatLngLike=void 0,t.isLatLngLike=function(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}},9264:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=void 0,t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},7523:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0;const n=i(3334);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function i(e,i){const n=(e=t(e))-(i=t(i));return n>180?n-360:n<=-180?n+360:n}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,i,n){return void 0===n?{x:e,y:t,z:i}:(n.x=e,n.y=t,n.z=i,n)},e.copyVector3=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.degToRad=n.degToRad,e.radToDeg=n.radToDeg,e.clamp=n.clamp,e.normalizeAngleDeg=t,e.normalizeLongitudeDeg=function(e){return(e=t(e))>180&&(e-=360),e},e.angleDistanceDeg=i,e.interpolateAnglesDeg=function(e,t,n){return(e+i(t,e)*n)%360}}(t.MathUtils||(t.MathUtils={}))},2334:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrientedBox3=void 0;const n=i(8333),r=i(6815);function s(e,t,i,n,r){const s=i.dot(t),o=i.dot(e);if(Math.abs(o)<1e-20)return Math.abs(s)<=n;const a=1/o,l=(s+n)*a,c=(s-n)*a;return l>c?(c>r.min&&(r.min=c),l<r.max&&(r.max=l)):(l>r.min&&(r.min=l),c<r.max&&(r.max=c)),r.min<=r.max&&r.max>=0}const o=new r.Vector3,a={min:-1/0,max:1/0};class l{constructor(e,t,i){this.position=new r.Vector3,this.xAxis=new r.Vector3(1,0,0),this.yAxis=new r.Vector3(0,1,0),this.zAxis=new r.Vector3(0,0,1),this.extents=new r.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==i&&this.extents.copy(i)}clone(){const e=new l;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new r.Vector3){return e.copy(this.position)}getSize(e=new r.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new n.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}intersectsRay(e){if(a.min=-1/0,a.max=1/0,o.copy(this.position).sub(e.origin),s(e.direction,o,this.xAxis,this.extents.x,a)&&s(e.direction,o,this.yAxis,this.extents.y,a)&&s(e.direction,o,this.zAxis,this.extents.z,a))return a.min>0?a.min:a.max}contains(e){const t=e.x-this.position.x,i=e.y-this.position.y,n=e.z-this.position.z,r=Math.abs(t*this.xAxis.x+i*this.xAxis.y+n*this.xAxis.z),s=Math.abs(t*this.yAxis.x+i*this.yAxis.y+n*this.yAxis.z),o=Math.abs(t*this.zAxis.x+i*this.zAxis.y+n*this.zAxis.z);return!(r>this.extents.x||s>this.extents.y||o>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new r.Vector3;t.subVectors(e,this.position);const i=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let n=0;for(let e=0;e<3;++e){const t=i[e],r=this.extents.getComponent(e);if(t<-r){const e=r+t;n+=e*e}else if(t>r){const e=t-r;n+=e*e}}return n}}t.OrientedBox3=l},58:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=void 0,t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},2683:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTransformLike=void 0,t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},2953:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector2Like=void 0,t.isVector2Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y}},1383:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=void 0,t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},5610:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EarthConstants=void 0;class i{}t.EarthConstants=i,i.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,i.EQUATORIAL_RADIUS=6378137,i.MIN_ELEVATION=-433,i.MAX_ELEVATION=8848,i.MAX_BUILDING_HEIGHT=828},1515:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.equirectangularProjection=t.normalizedEquirectangularProjection=void 0;const n=i(3334),r=i(2754),s=i(3068),o=i(4860),a=i(9264),l=i(7523),c=i(58),h=i(5610),u=i(5234);class d extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new r.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale/2,i.max.z=t,i}projectPoint(e,t){var i;return void 0===t&&(t={x:0,y:0,z:0}),t.x=((0,n.degToRad)(e.longitude)+Math.PI)*d.geoToWorldScale*this.unitScale,t.y=((0,n.degToRad)(e.latitude)+.5*Math.PI)*d.geoToWorldScale*this.unitScale,t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return o.GeoCoordinates.fromRadians(e.y*d.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*d.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const i=this.projectPoint(new o.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:n,longitudeSpanInRadians:s,altitudeSpan:h}=e,u=s*d.geoToWorldScale,m=n*d.geoToWorldScale;return t||(t=new r.Box3),(0,a.isBox3Like)(t)?(t.min.x=i.x-.5*u*this.unitScale,t.min.y=i.y-.5*m*this.unitScale,t.max.x=i.x+.5*u*this.unitScale,t.max.y=i.y+.5*m*this.unitScale,void 0!==h?(t.min.z=i.z-.5*h,t.max.z=i.z+.5*h):(t.min.z=0,t.max.z=0)):(0,c.isOrientedBox3Like)(t)&&(l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=i.x,t.position.y=i.y,t.position.z=i.z,t.extents.x=.5*u*this.unitScale,t.extents.y=.5*m*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(null!=h?h:0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return s.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}d.geoToWorldScale=1/(2*Math.PI),d.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new d(1),t.equirectangularProjection=new d(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},9686:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.identityProjection=void 0;const n=i(2754),r=i(3334),s=i(3068),o=i(4860),a=i(9264),l=i(7523),c=i(58),h=i(5234);class u extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=-Math.PI,i.min.y=.5*-Math.PI,i.min.z=e,i.max.x=Math.PI,i.max.y=.5*Math.PI,i.max.z=t,i}projectPoint(e,t){var i;return t||(t={x:0,y:0,z:0}),t.x=(0,r.degToRad)(e.longitude),t.y=(0,r.degToRad)(e.latitude),t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return o.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=new n.Box3);const i=this.projectPoint(new o.GeoCoordinates(e.south,e.west,e.minAltitude)),r=this.projectPoint(new o.GeoCoordinates(e.north,e.east,e.maxAltitude));return(0,a.isBox3Like)(t)?(t.min.x=i.x,t.min.y=i.y,t.min.z=i.z,t.max.x=r.x,t.max.y=r.y,t.max.z=r.z):(0,c.isOrientedBox3Like)(t)&&(l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.x+r.x),t.position.y=.5*(i.y+r.y),t.position.z=.5*(i.z+r.z),t.extents.x=.5*(r.x-i.x),t.extents.y=.5*(r.y-i.y),t.extents.z=Math.max(Number.EPSILON,.5*(r.z-i.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return s.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new u(1)},9885:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorProjection=t.mercatorProjection=t.MercatorConstants=void 0;const n=i(2754),r=i(3068),s=i(4860),o=i(6306),a=i(9264),l=i(7523),c=i(58),h=i(5610),u=i(5234);class d extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Planar}static clamp(e,t,i){return Math.min(Math.max(t,e),i)}static latitudeClamp(e){return d.clamp(e,-m.MAXIMUM_LATITUDE,m.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return d.latitudeProject(d.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){var i;let n;return n=e instanceof s.GeoCoordinates?e:new s.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*this.unitScale,t.y=(.5*d.latitudeClampProject(n.latitudeInRadians)+.5)*this.unitScale,t.z=null!==(i=n.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(d.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){var i;const r=this.projectPoint(e.center),s=(.5*d.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,o=(.5*d.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,h=.5*(s+o);r.y=h;const u=s-o,m=e.longitudeSpan/360*this.unitScale;if(t||(t=new n.Box3),(0,a.isBox3Like)(t)){t.min.x=r.x-.5*m,t.min.y=r.y-.5*u,t.max.x=r.x+.5*m,t.max.y=r.y+.5*u;const i=e.altitudeSpan;void 0!==i?(t.min.z=r.z-.5*i,t.max.z=r.z+.5*i):(t.min.z=0,t.max.z=0)}else{if(!(0,c.isOrientedBox3Like)(t))throw new Error("invalid bounding box");l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z,t.extents.x=.5*m,t.extents.y=.5*u,t.extents.z=Math.max(Number.EPSILON,.5*(null!==(i=e.altitudeSpan)&&void 0!==i?i:0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,i,n){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,i,n):(void 0===n&&(n={}),n.x=i.x,n.y=this.unitScale-i.y,n.z=i.z,n)}}class m{}t.MercatorConstants=m,m.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new d(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends d{projectPoint(e,t){var i;let n;n=e instanceof s.GeoCoordinates?e:new s.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(n.longitude+180)/360*this.unitScale;const r=Math.sin(d.latitudeClamp(n.latitudeInRadians));return t.y=(.5-Math.log((1+r)/(1-r))/(4*Math.PI))*this.unitScale,t.z=null!==(i=n.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,i=.5-e.y/this.unitScale,n=360*t,r=90-360*Math.atan(Math.exp(2*-i*Math.PI))/Math.PI;return new s.GeoCoordinates(r,n,e.z)}projectBox(e,t){const i=super.projectBox(e,t);if((0,a.isBox3Like)(i)){const e=i.max.y;i.max.y=this.unitScale-i.min.y,i.min.y=this.unitScale-e}else(0,c.isOrientedBox3Like)(i)&&(l.MathUtils.newVector3(1,0,0,i.xAxis),l.MathUtils.newVector3(0,-1,0,i.yAxis),l.MathUtils.newVector3(0,0,-1,i.zAxis),i.position.y=this.unitScale-i.position.y);return i}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return new r.GeoBox(new s.GeoCoordinates(i.latitude,t.longitude,t.altitude),new s.GeoCoordinates(t.latitude,i.longitude,i.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return(0,o.isGeoCoordinatesLike)(e)?this.projectPoint(e,t.position):l.MathUtils.copyVector3(e,t.position),l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,-1,0,t.yAxis),l.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},5234:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Projection=t.ProjectionType=void 0;const n=i(6306),r=i(7523);var s;(s=t.ProjectionType||(t.ProjectionType={}))[s.Planar=0]="Planar",s[s.Spherical=1]="Spherical",t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return(0,n.isGeoCoordinatesLike)(e)?this.projectPoint(e,t.position):r.MathUtils.copyVector3(e,t.position),r.MathUtils.newVector3(1,0,0,t.xAxis),r.MathUtils.newVector3(0,1,0,t.yAxis),r.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,i){return e===this?void 0===i?{x:t.x,y:t.y,z:t.z}:(i.x=t.x,i.y=t.y,i.z=t.z,i):this.projectPoint(e.unprojectPoint(t),i)}}},6322:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sphereProjection=void 0;const n=i(2754),r=i(3334),s=i(4860),o=i(6306),a=i(9264),l=i(7523),c=i(58),h=i(5610),u=i(9885),d=i(5234);function m(e){const t=1/Math.PI,i=Math.floor(2*(e*t+1));return(0,r.clamp)(i,0,4)}function p(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function f(e,t,i){var n;const s=.5*(i+(null!==(n=e.maxAltitude)&&void 0!==n?n:0)),o=(0,r.degToRad)(e.west),a=(0,r.degToRad)(e.east),l=m(o),c=m(a);let h=Math.cos(o),u=h,d=Math.sin(o),p=d;for(let e=l+1;e<=c;e++){const t=(e+1&1)*((2&e)-1);h=Math.min(t,h),u=Math.max(t,u);const i=(1&e)*((2&e)-1);d=Math.min(i,d),p=Math.max(i,p)}const f=Math.cos(a);h=Math.min(f,h),u=Math.max(f,u);const g=Math.sin(a);d=Math.min(g,d),p=Math.max(g,p);const v=(u+h)*s,_=(u-h)*s,y=(p+d)*s,x=(p-d)*s,S=(0,r.degToRad)(e.south),b=(0,r.degToRad)(e.north),T=Math.sin(b),M=Math.sin(S),w=(T+M)*s,E=(T-M)*s;return t.min.x=v-_,t.min.y=y-x,t.min.z=w-E,t.max.x=v+_,t.max.y=y+x,t.max.z=w+E,t}class g extends d.Projection{constructor(){super(...arguments),this.type=d.ProjectionType.Spherical}worldExtent(e,t,i=new n.Box3){const r=this.unitScale+t;return i.min.x=-r,i.min.y=-r,i.min.z=-r,i.max.x=r,i.max.y=r,i.max.z=r,i}projectPoint(e,t=l.MathUtils.newVector3(0,0,0)){return function(e,t,i){var n;const s=i+(null!==(n=e.altitude)&&void 0!==n?n:0),o=(0,r.degToRad)(e.latitude),a=(0,r.degToRad)(e.longitude),l=Math.cos(o);return t.x=s*l*Math.cos(a),t.y=s*l*Math.sin(a),t.z=s*Math.sin(o),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,i=Math.sqrt(t),n=e.z/i;if(isNaN(n))return s.GeoCoordinates.fromRadians(0,0,-this.unitScale);const r=Math.sqrt(t+e.z*e.z);return s.GeoCoordinates.fromRadians(Math.atan(n),Math.atan2(e.y,e.x),r-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-h.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=new n.Box3){var i,s;if((0,a.isBox3Like)(t))return f(e,t,this.unitScale);if((0,c.isOrientedBox3Like)(t)){if(e.longitudeSpan>=90){const i=f(e,new n.Box3,this.unitScale);return l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.max.x+i.min.x),t.position.y=.5*(i.max.y+i.min.y),t.position.z=.5*(i.max.z+i.min.z),t.extents.x=.5*(i.max.x-i.min.x),t.extents.y=.5*(i.max.y-i.min.y),t.extents.z=.5*(i.max.z-i.min.z),t}const{south:o,west:a,north:c,east:h,center:u}=e,d=u.longitude,m=u.latitude,p=Math.cos((0,r.degToRad)(o)),g=Math.sin((0,r.degToRad)(o)),v=Math.cos((0,r.degToRad)(a)),_=Math.sin((0,r.degToRad)(a)),y=Math.cos((0,r.degToRad)(c)),x=Math.sin((0,r.degToRad)(c)),S=Math.cos((0,r.degToRad)(h)),b=Math.sin((0,r.degToRad)(h)),T=Math.cos((0,r.degToRad)(d)),M=Math.sin((0,r.degToRad)(d)),w=Math.cos((0,r.degToRad)(m)),E=Math.sin((0,r.degToRad)(m));let C,A,P;l.MathUtils.newVector3(T*w,M*w,E,t.zAxis),l.MathUtils.newVector3(-M,T,0,t.xAxis),l.MathUtils.newVector3(-T*E,-M*E,w,t.yAxis),o>=0?(C=Math.abs(p*(T*(_-b)+M*(S-v))),A=w*g-E*p,P=w*x-E*y*(T*S+M*b)):(c<=0?(C=Math.abs(y*(T*(_-b)+M*(S-v))),P=w*x-E*y):(C=Math.abs(T*(_-b)+M*(S-v)),P=w*x-E*y*(M*b+T*S)),A=w*g-E*p*(T*S+M*b));const R=.5*(this.unitScale+(null!==(i=e.maxAltitude)&&void 0!==i?i:0)),L=.5*(this.unitScale+(null!==(s=e.minAltitude)&&void 0!==s?s:0)),D=w*(T*S+M*b),I=Math.min(y*D+x*E,p*D+g*E);return l.MathUtils.newVector3(C*R,(P-A)*R,R-I*L,t.extents),l.MathUtils.newVector3(0,(A+P)*R,R+R,t.position),function(e,t,i,n){const r=e.x*n.x+t.x*n.y+i.x*n.z,s=e.y*n.x+t.y*n.y+i.y*n.z,o=e.z*n.x+t.z*n.y+i.z*n.z;n.x=r,n.y=s,n.z=o}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return p(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(p(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const i=1/(p(e)||1);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t}reprojectPoint(e,t,i){if(e===u.mercatorProjection||e===u.webMercatorProjection){const{x:n,y:r,z:s}=t,o=this.unitScale,a=n/o-Math.PI,l=r/o-Math.PI,c=Math.exp(l),h=c*c,d=2*c/(h+1),m=(h-1)/(h+1),p=o+s;return void 0===i&&(i={}),i.x=Math.cos(a)*d*p,i.y=Math.sin(a)*d*p,i.z=m*p,e===u.webMercatorProjection&&(i.z=-i.z),i}return super.reprojectPoint(e,t,i)}localTangentSpace(e,t){let i;(0,o.isGeoCoordinatesLike)(e)?(this.projectPoint(e,t.position),i=e):(l.MathUtils.copyVector3(e,t.position),i=this.unprojectPoint(e));const n=(0,r.degToRad)(i.latitude),s=(0,r.degToRad)(i.longitude),a=Math.cos(s),c=Math.sin(s),h=Math.cos(n),u=Math.sin(n);return l.MathUtils.newVector3(a*h,c*h,u,t.zAxis),l.MathUtils.newVector3(-c,a,0,t.xAxis),l.MathUtils.newVector3(-a*u,-c*u,h,t.yAxis),t}}t.sphereProjection=new g(h.EarthConstants.EQUATORIAL_RADIUS)},7289:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transverseMercatorProjection=t.TransverseMercatorUtils=void 0;const n=i(2754),r=i(3334),s=i(3068),o=i(4860),a=i(9264),l=i(7523),c=i(58),h=i(5610),u=i(5234);class d extends u.Projection{static clampGeoPoint(e,t){const i=e.latitude,n=e.longitude,r=m.POLE_RADIUS,s=m.POLE_RADIUS_SQ,a=Math.round(n/90),l=90*a-n;if(a%2==0||Math.abs(l)>r)return e;const c=i-0,h=l*l+c*c;if(h<s){const e=Math.sqrt(h),t=(r-e)/e,s=0===l&&0===c?1*r:l;return new o.GeoCoordinates(i+c*t,n+s*t)}return e}constructor(e){super(e),this.unitScale=e,this.type=u.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,i){return i||(i=new n.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){var i;t||(t={x:0,y:0,z:0});const n=d.clampGeoPoint(e,this.unitScale),s=n.longitude/360+.5,o=1===s?0:Math.floor(s),a=(0,r.degToRad)(n.latitude),l=(0,r.degToRad)(n.longitude-360*o)-this.m_lambda0,c=Math.cos(a)*Math.sin(l);t.x=Math.atanh(c),t.y=Math.atan2(Math.tan(a),Math.cos(l))-this.m_phi0;const h=.5/Math.PI;return t.x=this.unitScale*((0,r.clamp)(t.x*h+.5,0,1)+o),t.y=this.unitScale*(0,r.clamp)(t.y*h+.5,0,1),t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){const t=2*Math.PI,i=e.x/this.unitScale,n=e.y/this.unitScale,r=1===i?0:Math.floor(i),s=t*(i-.5-r),a=t*(n-.5),l=e.z||0,c=a+this.m_phi0,h=Math.asin(Math.sin(c)/Math.cosh(s)),u=this.m_lambda0+Math.atan2(Math.sinh(s),Math.cos(c))+r*t;return o.GeoCoordinates.fromRadians(h,u,l)}projectBox(e,t){const{north:i,south:r,east:s,west:h}=e,u=[e.center,e.northEast,e.southWest,new o.GeoCoordinates(r,s),new o.GeoCoordinates(i,h)],d=m.POLE_EDGE_DEG,p=h<90&&s>90,f=h<0&&s>0,g=h<d&&s>-d&&i>0&&r<0;h<-90&&s>-90&&(u.push(new o.GeoCoordinates(i,-90)),u.push(new o.GeoCoordinates(r,-90))),p&&(u.push(new o.GeoCoordinates(i,90)),u.push(new o.GeoCoordinates(r,90))),f&&(u.push(new o.GeoCoordinates(i,0)),u.push(new o.GeoCoordinates(r,0))),g&&(u.push(new o.GeoCoordinates(0,h)),u.push(new o.GeoCoordinates(0,s))),m.alignLatitude(u,u[0]);const v=u.map((e=>this.projectPoint(e))),_=v.map((e=>e.x)),y=v.map((e=>e.y)),x=v.map((e=>e.z)),S=Math.min(..._),b=Math.min(...y),T=Math.min(...x),M=Math.max(..._),w=Math.max(...y),E=Math.max(...x);if(t||(t=new n.Box3),(0,a.isBox3Like)(t))t.min.x=S,t.min.y=b,t.min.z=T,t.max.x=M,t.max.y=w,t.max.z=E;else{if(!(0,c.isOrientedBox3Like)(t))throw new Error("invalid bounding box");l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(S+M)/2,t.position.y=(b+w)/2,t.position.z=(T+E)/2,t.extents.x=(M-S)/2,t.extents.y=(w-b)/2,t.extents.z=(E-T)/2}return t}unprojectBox(e){const t=this.unitScale,i=e.min,n=e.max,r=[{x:(i.x+n.x)/2,y:(i.y+n.y)/2,z:0},i,n,{x:i.x,y:n.y,z:0},{x:n.x,y:i.y,z:0}],a=.5*t,l=.25*t,c=.75*t,h=i.x<a&&n.x>a,u=i.y<a&&n.y>a,d=i.y<l&&n.y>l,p=i.y<c&&n.y>c;u&&(r.push({x:i.x,y:a,z:0}),r.push({x:n.x,y:a,z:0}),h&&r.push({x:a,y:a,z:0})),d&&(r.push({x:i.x,y:l,z:0}),r.push({x:n.x,y:l,z:0}),h&&r.push({x:a,y:l,z:0})),p&&(r.push({x:i.x,y:c,z:0}),r.push({x:n.x,y:c,z:0}),h&&r.push({x:a,y:c,z:0}));const f=r.map((e=>this.unprojectPoint(e)));m.alignLongitude(f,f[0]);const g=f.map((e=>e.latitude)),v=f.filter((e=>Math.abs(e.latitude)<90)).map((e=>e.longitude)),_=f.map((e=>{var t;return null!==(t=e.altitude)&&void 0!==t?t:0})),y=new o.GeoCoordinates(Math.min(...g),Math.min(...v),Math.min(..._)),x=new o.GeoCoordinates(Math.max(...g),Math.max(...v),Math.max(..._));return s.GeoBox.fromCoordinates(y,x)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class m{static alignLatitude(e,t){for(const i of e)0===i.latitude&&(i.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const i=t.longitude<0?180:-180,n=t.longitude<0?-180:180;for(const t of e)t.longitude===i&&(t.longitude=n)}}t.TransverseMercatorUtils=m,m.POLE_EDGE=1.4844222297453322,m.POLE_EDGE_DEG=(0,r.radToDeg)(m.POLE_EDGE),m.POLE_RADIUS=90-m.POLE_EDGE_DEG,m.POLE_RADIUS_SQ=Math.pow(m.POLE_RADIUS,2),t.transverseMercatorProjection=new d(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},9861:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlatTileBoundingBoxGenerator=void 0;const n=i(2754);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,i=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=i,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,i);const{min:n,max:r}=this.m_worldBox;this.m_worldDimensions={x:r.x-n.x,y:r.y-n.y,z:r.z-n.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const i=e.level,r=this.subdivisionScheme.getLevelDimensionX(i),s=this.subdivisionScheme.getLevelDimensionY(i),o=this.m_worldDimensions.x/r,a=this.m_worldDimensions.y/s,l=this.m_worldBox.min.x+o*e.column,c=this.m_worldBox.min.y+a*e.row;return t||(t=new n.Box3),t.min.x=l,t.min.y=c,t.min.z=this.m_worldBox.min.z,t.max.x=l+o,t.max.y=c+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},435:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.halfQuadTreeSubdivisionScheme=void 0,t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},4490:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hereTilingScheme=void 0;const n=i(1515),r=i(435),s=i(6557);t.hereTilingScheme=new s.TilingScheme(r.halfQuadTreeSubdivisionScheme,n.normalizedEquirectangularProjection)},1635:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mercatorTilingScheme=void 0;const n=i(9885),r=i(9447),s=i(6557);t.mercatorTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.mercatorProjection)},1871:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.polarTilingScheme=void 0;const n=i(7289),r=i(9447),s=i(6557);t.polarTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.transverseMercatorProjection)},7171:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuadTree=void 0;const n=i(6541);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(n.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const i of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(i,t)}}},9447:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quadTreeSubdivisionScheme=void 0,t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},3424:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubTiles=void 0;const n=i(6541);class r{constructor(e,t,i){this.tileKey=e,this.sizeX=t,this.sizeY=i}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?r.ZCurveIterator(this.tileKey):r.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=r,function(e){e.RowColumnIterator=function*(e,t,i){for(let r=0;r<i;r++)for(let s=0;s<t;s++)yield n.TileKey.fromRowColumnLevel(e.row*i+r,e.column*t+s,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield n.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(r=t.SubTiles||(t.SubTiles={}))},4948:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6541:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKey=void 0;const i=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class n{static fromRowColumnLevel(e,t,i){return new n(e,t,i)}static fromQuadKey(e){const t=e.length;let i=0,r=0;for(let n=0;n<e.length;++n){const s=1<<n,o=parseInt(e.charAt(t-n-1),10);1&o&&(r|=s),2&o&&(i|=s)}return n.fromRowColumnLevel(i,r,t)}static fromMortonCode(e){let t=0,i=0,r=0,s=e;for(;s>1;){const e=1<<t;1&s&&(r|=e),2&s&&(i|=e),t++,s=(s-(3&s))/4}const o=n.fromRowColumnLevel(i,r,t);return o.m_mortonCode=e,o}static fromHereTile(e){const t=n.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,i,r,s){return n.fromRowColumnLevel(Math.floor(i/(s/n.rowsAtLevel(e))),Math.floor(t/(r/n.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}constructor(e,t,i){this.row=e,this.column=t,this.level=i}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return n.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let i=this.row,r=this.column;return e>=0?(i<<=e,r<<=e):(i>>>=-e,r>>>=-e),n.fromRowColumnLevel(i,r,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,n=i[this.level<<1];for(let r=0;r<this.level;++r)1&e&&(n+=i[2*r]),1&t&&(n+=i[2*r+1]),e>>>=1,t>>>=1;this.m_mortonCode=n}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const i=1<<t-1,n=!!(this.column&i),r=!!(this.row&i);e+=n&&r?"3":r?"2":n?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=n.fromQuadKey(0===e.length?"-":e),i=this.changedLevelBy(t.level);return n.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}addedSubHereTile(e){const t=n.fromHereTile(e),i=this.changedLevelBy(t.level);return n.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return n.rowsAtLevel(this.level)}columnCount(){return n.columnsAtLevel(this.level)}}t.TileKey=n},7841:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKeyUtils=t.powerOfTwo=void 0;const n=i(4860),r=i(6541);t.powerOfTwo=(()=>{let e=.5;return new Array(53).fill(0).map((()=>e*=2))})(),function(e){function i(e,t,i){const n=e.projection,s=e.subdivisionScheme,o=s.getLevelDimensionX(i),a=s.getLevelDimensionY(i),{min:l,max:c}=n.worldExtent(0,0),h=c.x-l.x,u=c.y-l.y;if(t.x<l.x||t.x>c.x)return null;if(t.y<l.y||t.y>c.y)return null;const d=Math.min(o-1,Math.floor(o*(t.x-l.x)/h)),m=Math.min(a-1,Math.floor(a*(t.y-l.y)/u));return r.TileKey.fromRowColumnLevel(m,d,i)}function s(e,i,n=4){const r=function(e,i=4){let n=0;const r=t.powerOfTwo[i];for(e+=r/2;e<0;)e+=r;for(;e>=r;)e-=r;for(let r=0;r<i&&e>0;r++)1&e&&(n+=t.powerOfTwo[53-i+r]),e>>>=1;return n}(i,n);return e.mortonCode()+r}function o(e,i=4){let n=0,r=e,s=0;for(;s<i;s++){const e=t.powerOfTwo[52-s];r>=e&&(r-=e,n+=t.powerOfTwo[i-1-s])}return n-=t.powerOfTwo[i-1],{offset:n,mortonCode:r}}e.geoCoordinatesToTileKey=function(e,t,n){return i(e,e.projection.projectPoint(t),n)},e.worldCoordinatesToTileKey=i,e.geoRectangleToTileKeys=function(t,i,s){const o=(e,t,i)=>e<t?i-(t-e)%(i-t):t+(e-t)%(i-t),a=(e,t,i)=>Math.min(Math.max(e,t),i),l=o(i.southWest.longitudeInRadians,-Math.PI,Math.PI),c=a(i.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=o(i.northEast.longitudeInRadians,-Math.PI,Math.PI),u=a(i.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),d=e.geoCoordinatesToTileKey(t,n.GeoCoordinates.fromRadians(c,l),s),m=e.geoCoordinatesToTileKey(t,n.GeoCoordinates.fromRadians(u,h),s),p=t.subdivisionScheme.getLevelDimensionX(s);if(!d||!m)throw new Error("Invalid coordinates");const f=d.column;let g=m.column;l>h&&(g+=g!==f?p:p-1);const v=Math.min(d.row,m.row),_=Math.max(d.row,m.row),y=new Array;for(let e=v;e<=_;++e)for(let t=f;t<=g;++t)y.push(r.TileKey.fromRowColumnLevel(e,t%p,s));return y},e.getKeyForTileKeyAndOffset=s,e.extractOffsetAndMortonKeyFromKey=o,e.getParentKeyFromKey=function(e,t=4){const{offset:i,mortonCode:n}=o(e,t);return s(r.TileKey.fromMortonCode(r.TileKey.parentMortonCode(n)),i,t)}}(t.TileKeyUtils||(t.TileKeyUtils={}))},2801:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTreeTraverse=void 0;const n=i(3424);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),i=this.m_subdivisionScheme.getSubdivisionY(e.level);return new n.SubTiles(e,t,i)}}},6557:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilingScheme=void 0;const n=i(9861),r=i(7841),s=i(2801);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new n.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new s.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return r.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return r.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},2224:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorTilingScheme=void 0;const n=i(9885),r=i(9447),s=i(6557);t.webMercatorTilingScheme=new s.TilingScheme(r.quadTreeSubdivisionScheme,n.webMercatorProjection)},3211:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(4388),t),r(i(3711),t),r(i(8487),t),r(i(3674),t)},8487:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionLine=t.HighPrecisionWireFrameLine=void 0;const n=i(8333),r=i(4246),s=i(5269),o=i(3674);class a extends r.Line{constructor(e,t,i){super(e,t),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){o.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,n,r,s)=>{o.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionWireFrameLine=a;class l extends s.Mesh{constructor(e,t,i){super(e,t),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){o.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,n,r,s)=>{o.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionLine=l},1939:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionPoints=void 0;const n=i(3148),r=i(8333),s=i(4994),o=i(4250),a=i(3674);class l extends s.Points{constructor(e,t,i,s,a){void 0===t&&(t=new o.HighPrecisionPointMaterial({color:s||o.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==a?a:1})),super(void 0===e?new n.BufferGeometry:e,t),this.matrixWorldInverse=new r.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}clearGeometry(){return this.geometry=new n.BufferGeometry}get shaderMaterial(){return this.material}setPositions(e){a.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=(e,t,i,n,r,s)=>{a.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionPoints=l},3674:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionUtils=void 0;const n=i(9365),r=i(3148),s=i(9044),o=i(6280),a=i(8333),l=i(6815),c=i(4250),h=i(8487),u=i(1939),d=i(3711);!function(e){function t(e){return new l.Vector3(Math.fround(e.x),Math.fround(e.y),Math.fround(e.z))}function i(e,i){const n=(new a.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),r=new l.Vector3(0,0,0).applyMatrix4(i),s=t(r);return{viewProjection:n,eyePosHi:s,eyePosLo:t(r.sub(s))}}function m(e){if(e.length>0){const t=e[0];if(null==t)throw Error("Empty element in positions");const i=new Array,r=new Array,s=(...e)=>{for(const t of e){const e=Math.fround(t);r.push(t-e),i.push(e)}},o=e=>{s(e.x,e.y,e.z)};if(void 0!==t.z)e.forEach((e=>{o(e)}));else{if(i.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach((e=>{s(e)}))}return{positionHigh:new n.Float32BufferAttribute(i,3),positionLow:new n.Float32BufferAttribute(r,3)}}return{positionHigh:new n.Float32BufferAttribute([],3),positionLow:new n.Float32BufferAttribute([],3)}}function p(e,t,i=0){const n=new Array,r=e.length;for(let s=0;s<r;s+=t){for(let t=0;t<i;t++)n.push(e[s+t]);const r=e[s+i],o=e[s+i+1],a=e[s+i+2],l=Math.fround(r),c=r-l,h=Math.fround(o),u=o-h,d=Math.fround(a),m=a-d;n.push(l,h,d,c,u,m);for(let r=i+3;r<t;r++)n.push(e[s+r])}return n}function f(e,t){const i=m(t);return e.bufferGeometry.setAttribute("position",i.positionHigh),e.bufferGeometry.setAttribute("positionLow",i.positionLow),i.positionHigh.itemSize}e.doubleToFloatVec=t,e.makeFloatVec=function(e){const t=Math.fround(e.x),i=Math.fround(e.y),n=Math.fround(e.z),r=new l.Vector3(e.x-t,e.y-i,e.z-n);return e.x=Math.fround(t),e.y=Math.fround(i),e.z=Math.fround(n),r},e.createHighPrecisionCameraPos=i,e.updateHpUniforms=function(e,t,n){const r=i(t,e.matrixWorldInverse),s=r.viewProjection;if(void 0===n||!n.isMaterial)throw Error("High pecision line has no high precision material");if(!(n.uniforms&&n.uniforms.u_mvp&&n.uniforms.u_eyepos&&n.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");n.uniforms.u_mvp.value=new Float32Array(s.elements),n.uniforms.u_eyepos.value=new Float32Array(r.eyePosHi.toArray()),n.uniforms.u_eyepos_lowpart.value=new Float32Array(r.eyePosLo.toArray())},e.createAttributes=m,e.addInterleavedAttributes3=p,e.setPositions=f,e.convertPositions=function(e){if(e.length<=0)return{positions:[]};const t=e[0];if(null==t)throw Error("Empty element in positions");const i=t;if(void 0===i.y&&void 0===i.z)return{positions:e};const n=new Array;return e.forEach((e=>{n.push(e.x,e.y,e.z)})),{positions:n}},e.createLine=function(e,t){const i=void 0!==t.lineWidth?t.lineWidth:5,a=void 0!==t.addCircles&&t.addCircles,l=void 0!==t.wireFrame&&t.wireFrame,u=[],m=[];(0,d.triangulateLine)(e,i,u,m,a);const f=new r.BufferGeometry,g=p(u,3),v=new s.InterleavedBuffer(new Float32Array(g),6),_=new o.InterleavedBufferAttribute(v,3,0,!1),y=new o.InterleavedBufferAttribute(v,3,3,!1);f.setAttribute("position",_),f.setAttribute("positionLow",y),f.setIndex(new n.BufferAttribute(new Uint32Array(m),1));const x=new c.HighPrecisionLineMaterial(t),S=l?new h.HighPrecisionWireFrameLine(f,x):new h.HighPrecisionLine(f,x);return S.setupForRendering(),S},e.createPoints=function(e,t){const i=[];for(let t=0;t<e.length;t++)i.push(i.length/3);const n=new r.BufferGeometry,s=(0,c.isHighPrecisionPointMaterial)(t)?t:new c.HighPrecisionPointMaterial(t),o=new u.HighPrecisionPoints(n,s);return f(o,e),o.setupForRendering(),o}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},4388:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineGroup=t.createSimpleLineGeometry=t.createLineGeometry=t.LineGeometry=void 0;const n=i(9365),r=i(3148),s=i(9044),o=i(6280),a=i(6815),l=i(4342),c=new a.Vector3,h=new a.Vector3,u=new a.Vector3,d=new a.Vector3,m={attributes:[{name:"extrusionCoord",itemSize:3,offset:0},{name:"position",itemSize:3,offset:3},{name:"tangent",itemSize:3,offset:6},{name:"biTangent",itemSize:4,offset:9}],stride:13},p={attributes:[{name:"uv",itemSize:2,offset:m.stride},{name:"normal",itemSize:3,offset:m.stride+2}],stride:5},f={attributes:[...m.attributes,...p.attributes],stride:m.stride+p.stride},g={attributes:[{name:"extrusionCoord",itemSize:2,offset:0},{name:"position",itemSize:3,offset:2},{name:"positionLow",itemSize:3,offset:5},{name:"tangent",itemSize:3,offset:8},{name:"biTangent",itemSize:4,offset:11}],stride:15},v={attributes:[...g.attributes,...p.attributes],stride:g.stride+p.stride};class _{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function y(e,t){return t?e?v:g:e?f:m}function x(e,t,i,n,r,s,o=new _,m=!1){if(0===t.length)return o;const p=y(void 0!==r,m).stride,f=t.length,g=f/3,v=new Array(g),x=new Array(f-3),S=o.vertices.length/p,b=void 0!==n&&n.length>0,T=void 0!==r&&r.length>0,M=void 0!==s&&s.length&&f;(0,l.assert)(!b||n.length===g),(0,l.assert)(!T||r.length/2===g),(0,l.assert)(!M||s.length===f);let w=.1;v[0]=w;for(let e=0;e<g-1;++e){let i=0;for(let n=0;n<3;++n){const r=t[3*(e+1)+n]-t[3*e+n];x[3*e+n]=r,i+=r*r}w+=Math.sqrt(i),v[e+1]=w}const E=b?Math.abs(n[n.length-1]-n[0]):1,C=v[v.length-1]/E;if(b)for(let e=0;e<g;++e)v[e]=n[e]*C+.1;let A=!0;for(let e=0;e<3;++e)A=A&&t[e]===t[t.length-3+e];const P=(n,l,p,f,g)=>{const v=[],_=[];v.push(f,-1*g,C),_.push(f,1*g,C);for(let e=0;e<3;++e){if(m){const i=Math.fround(t[3*n+e]),r=t[3*n+e]-i;v.push(i,r),_.push(i,r)}else v.push(t[3*n+e]),_.push(t[3*n+e]);c.setComponent(e,t[3*n+e]),h.setComponent(e,x[l+e]),u.setComponent(e,x[p+e])}h.normalize(),u.normalize(),v.push(h.x,h.y,h.z),_.push(h.x,h.y,h.z),c.add(e),i.surfaceNormal(c,c);const y=function(e,t,i,n){let r=0;if(!t.equals(i)){r=t.angleTo(i);const n=(new a.Vector3).crossVectors(t,i),s=Math.sign(n.dot(e));0!==s&&(r*=s),Number.isNaN(r)&&(r=0)}return n.copy(t).add(i).normalize().cross(e).normalize(),r}(c,h,u,d);v.push(d.x,d.y,d.z,y),_.push(d.x,d.y,d.z,y),T&&(v.push(r[2*n],r[2*n+1]),_.push(r[2*n],r[2*n+1]),v.push(c.x,c.y,c.z),_.push(c.x,c.y,c.z)),o.vertices.push(...v,..._),M&&(o.vertexColors.push(s[3*n],s[3*n+1],s[3*n+2]),o.vertexColors.push(s[3*n],s[3*n+1],s[3*n+2]))};for(let e=0;e<g;++e){const t=A&&0===e?x.length-3:3*Math.max(0,e-1),i=A&&e===g-1?0:Math.min(3*e,x.length-3);e>0&&P(e,t,i,v[e-1],v[e]),e+1<g&&P(e,t,i,-1*v[Math.min(e,v.length-1)],v[Math.min(e+1,v.length-1)])}for(let e=0;e<g-1;++e){const t=S+4*e;o.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return o}function S(e,t,i=new _){if(0===e.length)return i;const n=e.length/3;let r=i.vertices.length/3;const s=void 0!==t&&t.length&&e.length;for(let o=0;o<n;++o,r++){o>0&&i.indices.push(r),o<n-1&&i.indices.push(r);for(let n=0;n<3;++n)i.vertices.push(e[3*o+n]),s&&i.vertexColors.push(t[3*o+n])}return i}t.LineGeometry=_,t.createLineGeometry=x,t.createSimpleLineGeometry=S;class b{static createGeometry(e,t,i,r,a=!1,l=!1,c=!1){if(c)return r.setAttribute("position",new n.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r;{const c=y(a,l),h=new s.InterleavedBuffer(new Float32Array(e),c.stride);return c.attributes.forEach((e=>{const t=new o.InterleavedBufferAttribute(h,e.itemSize,e.offset,!1);r.setAttribute(e.name,t)})),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r}}constructor(e=!1,t=!1,i=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=i,this.m_geometry=new _}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,i,n,r,s){return this.isSimple?S(t,s,this.m_geometry):((0,l.assert)(!this.hasNormalsAndUvs||void 0!==r),x(e,t,i,n,r,s,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return y(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return y(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new r.BufferGeometry),b.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=b},3711:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructLineWidth=t.reconstructLine=t.triangulateLine=t.numCirclePoints=void 0;const n=i(5448),r=i(6815),s=new r.Vector3(0,0,1),o=[0,1,2,1,3,2],a=[0,1,3,3,1,2,0,3,4,5,4,3],l=Math.PI/8;function c(e,t,i,n,r,s){const o=r.length/3;r.push(e,t,0);for(let a=0;a<9;++a){const c=l*a+Math.PI/2+i;r.push(e+n*Math.cos(c),t+n*Math.sin(c),0),s.push(o,o+a+1,o+(a+1)%9+1)}}t.numCirclePoints=function(e){return 9},t.triangulateLine=function(e,t,i,l,h=!0,u=h){if(e.length<3)return;const d=new n.Vector2;if(h){const n=3!==e.length?d.set(e[3]-e[0],e[4]-e[1]).angle():0;c(e[0],e[1],n,t,i,l)}const m=i.length/3,p=new r.Vector3,f=new r.Vector3,g=new r.Vector3,v=new r.Vector3,_=new r.Vector3,y=new r.Vector3,x=new r.Vector3,S=new r.Vector3,b=new r.Vector3,T=e.length/3;let M=0;for(let n=0;n<T;++n){let r=!1;if(f.set(e[3*n],e[3*n+1],e[3*n+2]),n+1<T){if(g.set(e[3*(n+1)],e[3*(n+1)+1],e[3*(n+1)+2]),v.copy(g).sub(f).normalize().cross(s),_.copy(v),n>0&&(_.add(p).multiplyScalar(1-.5*v.dot(p)),r=p.angleTo(v)>Math.PI/2,r)){const e=t/Math.cos(v.angleTo(p)/2);y.copy(v).add(p).normalize().multiplyScalar(-e).add(f),x.copy(p).multiplyScalar(t).add(f),S.copy(v).add(p).normalize().multiplyScalar(e).add(f),b.copy(v).multiplyScalar(t).add(f)}r?i.push(y.x,y.y,y.z,x.x,x.y,x.z,S.x,S.y,S.z,b.x,b.y,b.z):(y.copy(_).multiplyScalar(-t).add(f),x.copy(_).multiplyScalar(t).add(f),i.push(y.x,y.y,y.z,x.x,x.y,x.z)),p.copy(v)}else y.copy(p).multiplyScalar(-t).add(f),x.copy(p).multiplyScalar(t).add(f),i.push(y.x,y.y,y.z,x.x,x.y,x.z);n!==T-1&&((r?a:o).forEach((e=>l.push(m+M+e))),M+=r?4:2)}if(u){const n=2!==e.length?d.set(e[3*(T-3)]-e[3*(T-2)],e[3*(T-3)+1]-e[3*(T-2)+1]).angle():Math.PI;c(e[3*(T-2)],e[3*(T-2)+1],n,t,i,l)}},t.reconstructLine=function(e,t){const i=new Float32Array(e.length/2);for(let n=3*t,r=2*n;n<i.length;n+=3,r+=6)i[n]=e[r]+.5*(e[r+3]-e[r]),i[n+1]=e[r+1]+.5*(e[r+3+1]-e[r+1]),i[n+2]=e[r+2]+.5*(e[r+3+2]-e[r+2]);return i},t.reconstructLineWidth=function(e,t){const i=e[2*t+3]-e[2*t],n=e[2*t+3+1]-e[2*t+1],r=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(i*i+n*n+r*r)}},8263:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(8759),t)},8759:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=t.Entry=void 0;const n=i(4342);class r{constructor(e,t,i,n,r){this.key=e,this.value=t,this.size=i,this.newer=n,this.older=r}}t.Entry=r,t.LRUCache=class{constructor(e,t=()=>1){this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}forEach(e,t){let i=this.m_newest;for(;null!==i;){const n=i.older;e.call(t,i.value,i.key,this),i=n}}get size(){return this.m_size}get capacity(){return this.m_capacity}get map(){return this.m_map}get newest(){return this.m_newest}get oldest(){return this.m_oldest}setCapacity(e){this.m_capacity=e,this.evict()}setCapacityAndMeasure(e,t=()=>1){this.m_capacity=e,this.m_sizeFunction=t,this.shrinkToCapacity()}shrinkToCapacity(){let e=0;const t=this.m_sizeFunction;let i=this.m_newest;for(;null!==i;){const n=t(i.value);i.size=n,e+=n,i=i.older}this.m_size=e,this.evict()}set(e,t){const i=this.m_sizeFunction(t);let s=this.m_map.get(e);if(void 0!==s)this.m_size=this.m_size-s.size+i,s.value=t,s.size=i,this.promoteEntry(s),this.evict();else{if(i>this.m_capacity)return;if(s=new r(e,t,i,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=s;else{(0,n.assert)(null!==this.m_newest);const e=this.m_newest;s.older=this.m_newest,e.newer=s,this.m_newest=s}this.m_map.set(e,s),this.m_size+=i,this.evict()}}get(e){const t=this.m_map.get(e);if(void 0!==t)return this.promoteEntry(t),t.value}has(e){return this.m_map.has(e)}clear(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()}evictAll(){const e=this.evictionCallback;void 0!==e&&this.forEach(((t,i)=>e(i,t))),this.clear()}evictSelected(e,t){const i=this.evictionCallback;let n=this.m_newest;for(;null!==n;){const r=n.older;e.call(t,n.value,n.key)&&(void 0!==i&&i(n.key,n.value),this.deleteEntry(n),this.m_map.delete(n.key)),n=r}}delete(e){const t=this.m_map.get(e);return void 0!==t&&(this.deleteEntry(t),this.m_map.delete(e))}evict(){for(;null!==this.m_oldest&&this.m_size>this.m_capacity;)if(void 0===this.evictOldest())return}evictOldest(){(0,n.assert)(null!==this.m_oldest);const e=this.m_oldest;(0,n.assert)(null===e.older);let t=e;if(void 0!==this.canEvict)for(;!this.canEvict(t.key,t.value);){if(null===t.newer)return;t=t.newer}if(t===e)this.m_oldest=t.newer,null!==t.newer&&((0,n.assert)(t.newer.older===t),t.newer.older=null);else{if(null===t.newer)return;(0,n.assert)(t.newer.older===t),t.newer.older=t.older,null!==t.older&&(t.older.newer=t.newer)}const i=this.m_map.delete(t.key);return(0,n.assert)(!0===i),i&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t}deleteEntry(e){e===this.m_newest?this.m_newest=e.older:e.newer?e.newer.older=e.older:(0,n.assert)(!1),e===this.m_oldest?this.m_oldest=e.newer:e.older?e.older.newer=e.newer:(0,n.assert)(!1),this.m_size-=e.size}promoteEntry(e){if(e===this.m_newest)return;e.newer&&((0,n.assert)(e.newer.older===e),e.newer.older=e.older),e.older&&((0,n.assert)(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,(0,n.assert)(null!==this.m_newest);const t=this.m_newest;(0,n.assert)(null===t.newer),t.newer=e,this.m_newest=e}}},2505:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraAnimationBuilder=void 0;const n=i(2616),r=i(2344),s=i(5448),o=i(6815),a=i(1350),l=i(9026);class c{static getLookAtFromView(e){return{target:e.target,heading:e.heading,tilt:e.tilt,distance:e.targetDistance}}static appendControlPoint(e,t,i){i=null!=i?i:10,e.controlPoints.length>0&&(void 0===t.timestamp||t.timestamp<=e.controlPoints[e.controlPoints.length-1].timestamp)&&(t.timestamp=e.controlPoints[e.controlPoints.length-1].timestamp+i),e.controlPoints.push(t)}static prependControlPoint(e,t,i){i=void 0!==i?i:10;for(const t of e.controlPoints)t.timestamp+=i;t.timestamp=0,e.controlPoints.unshift(t)}static createFlyToOptions(e,t,i,h,u){var d,m,p,f;const g=new l.ControlPoint(Object.assign({},c.getLookAtFromView(e))),v=void 0!==t.target?n.GeoCoordinates.fromObject(t.target):void 0;let _=null!=v?v:g.target;const y=void 0!==t.zoomLevel?r.MapViewUtils.calculateDistanceFromZoomLevel(e,t.zoomLevel):t.distance;let x=null!=y?y:e.targetDistance;if(void 0!==t.bounds){const i=Math.min(null!==(d=t.tilt)&&void 0!==d?d:e.tilt,r.MapViewUtils.MAX_TILT_DEG),n=-(null!==(m=t.heading)&&void 0!==m?m:e.heading),o=(0,a.getFitLookAtBoundsDistance)({target:e.target,camera:e.camera,cameraSettings:e,projection:e.projection,maxZoomLevel:e.maxZoomLevel,viewportSize:e.renderer.getSize(new s.Vector2),tileWrapping:e.tileWrappingEnabled},{bounds:t.bounds,target:v,distance:y,yaw:n,tilt:i,padding:t.padding});x=o.distance,_=o.target}if(h){const t=0|r.MapViewUtils.calculateZoomLevelFromDistance(e,x);x=r.MapViewUtils.calculateDistanceFromZoomLevel(e,t)}const S=new l.ControlPoint({target:_,distance:x,tilt:null!==(p=t.tilt)&&void 0!==p?p:g.tilt,heading:null!==(f=t.heading)&&void 0!==f?f:g.heading});if(r.MapViewUtils.closeToFrustum(e.projection.projectPoint(_,new o.Vector3),e.camera))return S.timestamp=i(g,S),{controlPoints:[g,S]};const b=[g],T=new o.Vector3;e.projection.projectPoint(g.target,T);let M=null!=u?u:2*T.distanceTo(e.projection.projectPoint(S.target));M=Math.max(g.distance+S.distance,M);const w=n.GeoCoordinates.lerp(g.target,S.target,.25),E=new l.ControlPoint({target:w,distance:M,timestamp:0,tilt:n.MathUtils.interpolateAnglesDeg(g.tilt,S.tilt,.25),heading:n.MathUtils.interpolateAnglesDeg(g.heading,S.heading,.25)});E.timestamp=E.timestamp+i(g,E),b.push(E);const C=n.GeoCoordinates.lerp(g.target,S.target,.75),A=new l.ControlPoint({target:C,distance:M,timestamp:0,tilt:n.MathUtils.interpolateAnglesDeg(g.tilt,S.tilt,.75),heading:n.MathUtils.interpolateAnglesDeg(g.heading,S.heading,.75)});return A.timestamp=E.timestamp+i(E,A),b.push(A),S.timestamp=A.timestamp+i(A,S),b.push(S),{controlPoints:b}}static createOrbitOptions(e,t=10){const i=[e],n=t/3;for(let e=1;e<4;e++){const t=i[e-1];i.push(Object.assign(Object.assign({},t),{heading:t.heading-120,timestamp:t.timestamp+n}))}return{controlPoints:i}}}t.CameraAnimationBuilder=c},9026:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraKeyTrackAnimation=t.ControlPoint=void 0;const n=i(3827),r=i(4839),s=i(1993),o=i(2997),a=i(5760),l=i(6271),c=i(2481),h=i(3334),u=i(9747),d=i(6815),m=i(2616),p=i(2344),f=i(4342).LoggerManager.instance.create("CameraKeyTrackAnimation");t.ControlPoint=class{constructor(e){var t,i,n,r,s;this.timestamp=0,this.timestamp=null!==(t=e.timestamp)&&void 0!==t?t:0,this.target=e.target?m.GeoCoordinates.fromObject(e.target):new m.GeoCoordinates(0,0),this.tilt=null!==(i=e.tilt)&&void 0!==i?i:0,this.heading=null!==(n=e.heading)&&void 0!==n?n:0,this.distance=null!==(r=e.distance)&&void 0!==r?r:0,this.name=null!==(s=e.name)&&void 0!==s?s:Date.now().toString()}};class g extends c.Object3D{constructor(e){super(),this.distance=0,this.name=e}}t.CameraKeyTrackAnimation=class{constructor(e,t){var i,c,m,p;this.m_mapView=e,this.m_options=t,this.m_dummy=new g("dummy"),this.m_azimuthAxis=new d.Vector3(0,0,1),this.m_altitudeAxis=new d.Vector3(1,0,0),this.m_running=!1,this.m_lastFrameTime=0;const v=void 0!==this.m_options.interpolation?this.m_options.interpolation:l.InterpolateSmooth;this.m_options.loop=null!==(i=this.m_options.loop)&&void 0!==i?i:l.LoopOnce,this.m_options.repetitions=null!==(c=this.m_options.repetitions)&&void 0!==c?c:1,this.m_options.rotateOnlyClockwise=null===(m=this.m_options.rotateOnlyClockwise)||void 0===m||m,this.m_name=(null!==(p=this.m_options.name)&&void 0!==p?p:"CameraKeyTrackAnimation")+Date.now();const _=this.m_options.controlPoints.map((e=>e.timestamp)),y=[],x=[];this.m_options.controlPoints.map((e=>{const t=this.m_mapView.projection.projectPoint(e.target);y.push(t.x),y.push(t.y),y.push(t.z);const i=new u.Quaternion;i.setFromAxisAngle(this.m_azimuthAxis,(0,h.degToRad)(e.heading)),i.multiply((new u.Quaternion).setFromAxisAngle(this.m_altitudeAxis,(0,h.degToRad)(e.tilt))),x.push(i.x),x.push(i.y),x.push(i.z),x.push(i.w)}));const S=new a.VectorKeyframeTrack(".position",_,y,v),b=new o.QuaternionKeyframeTrack(".quaternion",_,x,v),T=new s.NumberKeyframeTrack(".distance",_,this.m_options.controlPoints.map((e=>e.distance)),v);this.m_animationClip=new n.AnimationClip("cameraflyoveranimation",-1,[S,b,T]),this.m_animationClip.validate()||f.error("Review the entered controlpoints for: ",this.m_name,", The Animation was provided with invalid track data"),this.m_animationClip.resetDuration(),this.m_animationClip.trim(),this.m_animationMixer=new r.AnimationMixer(this.m_dummy),this.m_animationAction=this.m_animationMixer.clipAction(this.m_animationClip),this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions),this.m_animationAction.clampWhenFinished=!0,this.m_animateCb=this.animate.bind(this),this.m_animationMixer.addEventListener("finished",this.stop.bind(this))}set loop(e){this.m_options.loop=e,this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions)}set repetitions(e){this.m_options.repetitions=e,this.m_animationAction.setLoop(this.m_options.loop,this.m_options.repetitions)}set rotateOnlyClockwise(e){this.m_options.rotateOnlyClockwise=e}start(e,t){this.stop(),this.m_onFinished=t,this.m_animationAction.reset().play(),this.m_lastFrameTime=Date.now(),this.m_mapView.addEventListener(p.MapViewEventNames.Render,this.m_animateCb),this.m_mapView.beginAnimation(),this.m_running=!0}stop(){this.m_running&&(this.m_mapView.removeEventListener(p.MapViewEventNames.Render,this.m_animateCb),this.m_mapView.endAnimation(),void 0!==this.m_onFinished&&window.setTimeout((()=>{var e;null===(e=this.m_onFinished)||void 0===e||e.call(this),this.m_onFinished=void 0}),0),this.m_running=!1)}isRunning(){return this.m_running}updateCameraFromDummy(){let e=(0,h.radToDeg)(this.m_azimuthAxis.clone().applyQuaternion(this.m_dummy.quaternion).angleTo(this.m_azimuthAxis));e=(0,h.clamp)(e,0,p.MapViewUtils.MAX_TILT_DEG);const t=this.m_altitudeAxis.clone().applyQuaternion(this.m_dummy.quaternion);let i=t.angleTo(this.m_altitudeAxis);this.m_options.rotateOnlyClockwise&&this.m_azimuthAxis.dot(t.normalize().cross(this.m_altitudeAxis))>=0&&(i=2*Math.PI-i);const n=(0,h.radToDeg)(i),r=this.m_mapView.projection.unprojectPoint(this.m_dummy.position),s=Math.max(0,this.m_dummy.distance);(isNaN(e)||isNaN(n)||isNaN(s)||!r.isValid())&&f.error("Cannot update due to invalid data",e,n,s,r),this.m_mapView.lookAt({target:r,distance:s,tilt:e,heading:n})}animate(e){const t=(Date.now()-this.m_lastFrameTime)/1e3;this.m_animationMixer.update(t),this.m_lastFrameTime=Date.now(),this.updateCameraFromDummy()}}},1555:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWidthAndHeightFromCanvas=t.safeParseDecimalInt=t.azimuthAltitudeToDirection=t.calculateNormalizedDeviceCoordinates=void 0;const n=i(5448),r=i(6815);function s(e,t){if(null==e||""===e)return t;if(!e.match(o))return t;const i=Number.parseInt(e,10);return isNaN(i)?t:i}t.calculateNormalizedDeviceCoordinates=function(e,t,i,r){return new n.Vector2(e/i*2-1,-t/r*2+1)},t.azimuthAltitudeToDirection=function(e,t){const i=new r.Vector3,n=Math.cos(t);return i.setX(Math.sin(e)*n),i.setY(Math.cos(e)*n),i.setZ(Math.sin(t)),i},t.safeParseDecimalInt=s;const o=/^\d+$/;t.getWidthAndHeightFromCanvas=function(e){return{width:s(e.style.width,e.clientWidth),height:s(e.style.height,e.clientHeight)}}},2626:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(1153),t),r(i(5805),t),r(i(4773),t),r(i(2369),t),r(i(5199),t),r(i(1781),t)},8449:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(8635),t),r(i(1930),t),r(i(4069),t)},8635:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProvider=void 0;const n=i(2356);class r extends n.EventDispatcher{constructor(){super(...arguments),this.m_clients=new Set}register(e){return 0===this.m_clients.size&&(this.m_connectPromise=this.connect()),this.m_clients.add(e),this.m_connectPromise}unregister(e){this.m_clients.delete(e)&&0===this.m_clients.size&&this.dispose()}}t.DataProvider=r},1781:(e,t,i)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonTiler=void 0;const r=i(242),s=i(8152),o=null!==(n=r.default)&&void 0!==n?n:r,a=-(-2&-Math.ceil(204.8));t.GeoJsonTiler=class{constructor(){this.indexes=new Map}dispose(){}async connect(){return await Promise.resolve()}async registerIndex(e,t){if(!this.indexes.has(e))return await this.updateIndex(e,t)}async updateIndex(e,t){if(t instanceof URL){const e=await fetch(t.href);if(!e.ok)throw new Error(`GeoJsonTiler: Unable to fetch ${t.href}: ${e.statusText}`);t=await e.json()}const i=(0,s.isFeatureGeometry)(t)||"GeometryCollection"===t.type||"Feature"===t.type&&void 0===t.id||"FeatureCollection"===t.type&&t.features.length>0&&void 0===t.features[0].id,n=o(t,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:a,lineMetrics:!1,promoteId:null,generateId:i,debug:0});n.geojson=t,this.indexes.set(e,n)}async getTile(e,t){const i=this.indexes.get(e);if(void 0===i)throw new Error("Tile not found");const n=i.getTile(t.level,t.column,t.row);return null!==n&&(n.layer=e),n||{}}}},1153:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemedTileDecoder=void 0;const n=i(7769),r=i(4342).LoggerManager.instance.create("ThemedTileDecoder");t.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(e,t,i){return void 0===this.m_styleSetEvaluator?(r.info("cannot decode tile, as there is not style available"),Promise.resolve(void 0)):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,i)}getTileInfo(e,t,i){return Promise.resolve(void 0)}configure(e,t){void 0!==(null==e?void 0:e.styleSet)&&(this.m_styleSetEvaluator=new n.StyleSetEvaluator(e)),this.m_styleSetEvaluator&&this.m_styleSetEvaluator.setEnabledFeatures(null==e?void 0:e.enabledFeatures),void 0!==(null==e?void 0:e.languages)&&(this.languages=e.languages),void 0!==t&&void 0!==t.storageLevelOffset&&(this.m_storageLevelOffset=t.storageLevelOffset)}}},1930:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataSource=t.TileFactory=void 0;const n=i(2344),r=i(6586),s=i(1984),o=i(4342),a=i(4069);t.TileFactory=class{constructor(e){this.m_modelConstructor=e}create(e,t){const i=new this.m_modelConstructor(e,t);return i.tileLoader=new a.TileLoader(e,t,e.dataProvider(),e.decoder,e.mapView.taskQueue),i}};class l extends n.DataSource{constructor(e,t){var i,r;if(super(t),this.m_tileFactory=e,this.m_options=t,this.logger=o.LoggerManager.instance.create("TileDataSource"),this.m_isReady=!1,t.decoder)this.m_decoder=t.decoder;else{if(!t.concurrentDecoderServiceName)throw new Error(`TileDataSource[${this.name}]: unable to create, missing decoder or concurrentDecoderServiceName`);this.m_decoder=n.ConcurrentDecoderFacade.getTileDecoder(t.concurrentDecoderServiceName,t.concurrentDecoderScriptUrl,t.concurrentDecoderWorkerCount,t.workerConnectionTimeout)}this.useGeometryLoader=!0,this.cacheable=!0,this.m_unregisterClearTileCache=null===(r=(i=this.dataProvider()).onDidInvalidate)||void 0===r?void 0:r.call(i,(()=>this.mapView.markTilesDirty(this)))}dispose(){var e;null===(e=this.m_unregisterClearTileCache)||void 0===e||e.call(this),this.decoder.dispose(),this.dataProvider().unregister(this)}ready(){return this.m_isReady&&this.m_options.dataProvider.ready()}get decoder(){return this.m_decoder}async connect(){await Promise.all([this.m_options.dataProvider.register(this),this.m_decoder.connect()]),this.m_isReady=!0;let e={};void 0!==this.m_options.storageLevelOffset&&(e={storageLevelOffset:this.m_options.storageLevelOffset}),this.m_decoder.configure({languages:super.languages},e)}set languages(e){super.languages=e,this.m_decoder.configure({languages:e}),this.mapView.markTilesDirty(this)}get languages(){return super.languages}async setTheme(e,t){var i;e=await(0,r.load)(e,{baseUrl:t});const n=(0,s.getStyles)(e.styles).filter((e=>{var t;return!e.layer||(null===(t=this.layerNames)||void 0===t?void 0:t.includes(e.layer))}));n.length>0&&(this.m_decoder.configure({styleSet:n,definitions:e.definitions,features:e.features,priorities:e.priorities,labelPriorities:e.labelPriorities,enabledFeatures:this.enabledFeatures}),this.isDetached()||null===(i=this.mapView)||void 0===i||i.markTilesDirty(this))}get enabledFeatures(){return this.m_enabledFeatures}set enabledFeatures(e){this.m_enabledFeatures=e,this.m_decoder.configure({enabledFeatures:e}),this.isDetached()||this.mapView.markTilesDirty(this)}dataProvider(){return this.m_options.dataProvider}getTilingScheme(){return this.m_options.tilingScheme}getTile(e,t=!1){const i=this.m_tileFactory.create(this,e);return i.copyrightInfo=this.m_options.copyrightInfo,void 0!==this.m_options.copyrightProvider&&this.m_options.copyrightProvider.getCopyrights(i.geoBox,e.level).then((e=>{i.copyrightInfo=void 0===i.copyrightInfo?e:[...i.copyrightInfo,...e],this.requestUpdate()})),t||i.load(),i}getTileInfo(e){return new Promise(((t,i)=>{const r=new a.TileInfoLoader(this,e,this.m_options.dataProvider,this.decoder);r.loadAndDecode().then((e=>{e===n.TileLoaderState.Ready?t(r.tileInfo):i(new Error(`TileDataSource#getInfoTile wrong final state: ${e}`))}))}))}}t.TileDataSource=l},5805:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDecoderService=void 0;const n=i(8152),r=i(2616),s=i(1984),o=i(4342),a=i(2369),l=o.LoggerManager.instance.create("TileDecoderService");class c extends a.WorkerService{static start(e,t){return new c(e,t)}constructor(e,t){super(e),this.serviceId=e,this.m_decoder=t,this.m_decoder.connect()}handleRequest(e){return n.WorkerDecoderProtocol.isDecodeTileRequest(e)?this.handleDecodeTileRequest(e):n.WorkerDecoderProtocol.isTileInfoRequest(e)?this.handleTileInfoRequest(e):super.handleRequest(e)}handleMessage(e){n.WorkerDecoderProtocol.isConfigurationMessage(e)?this.handleConfigurationMessage(e):l.error(`[${this.serviceId}]: invalid message ${e.type}`)}async handleDecodeTileRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey),i=(0,n.getProjection)(e.projection),o=await this.m_decoder.decodeTile(e.data,t,i),a=[],l=e=>{void 0!==e&&e.buffer.byteLength>0&&!a.includes(e.buffer)&&a.push(e.buffer)};return null==o||o.geometries.forEach((e=>{var t,i,n;if(null===(t=e.vertexAttributes)||void 0===t||t.forEach((e=>l(e))),null===(i=e.interleavedVertexAttributes)||void 0===i||i.forEach((e=>l(e))),l(e.index),l(e.edgeIndex),Array.isArray(e.objInfos)&&1===e.objInfos.length&&"object"==typeof e.objInfos[0]&&(null===(n=e.objInfos[0])||void 0===n?void 0:n.hasOwnProperty("displacementMap"))){const t=e.objInfos[0];l(t.displacementMap)}Array.isArray(e.attachments)&&e.attachments.forEach((e=>{l(e.index),l(e.edgeIndex)}))})),null==o||o.techniques.forEach((e=>{(0,s.addBuffersToTransferList)(e,a)})),{response:o,transferList:a}}handleTileInfoRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey),i=(0,n.getProjection)(e.projection);return this.m_decoder.getTileInfo(e.data,t,i).then((e=>({response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]})))}handleConfigurationMessage(e){this.m_decoder.configure(e,e.options)}}t.TileDecoderService=c},4069:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileInfoLoader=t.TileLoader=void 0;const n=i(8152),r=i(2344),s=i(1406),o=i(4342).LoggerManager.instance.create("TileLoader");class a extends r.BaseTileLoader{constructor(e,t,i,n,r){super(e,t),this.dataSource=e,this.tileKey=t,this.dataProvider=i,this.tileDecoder=n,this.m_taskQueue=r}get priority(){return this.m_priority}set priority(e){this.m_priority=e,this.requestController&&(this.requestController.priority=e)}loadImpl(e,t,i){this.m_taskQueue?this.m_taskQueue.add({execute:this.loadData.bind(this,e,t,i),group:r.TileTaskGroups.FETCH_AND_DECODE,getPriority:()=>{var e;return null!==(e=this.priority)&&void 0!==e?e:0},isExpired:()=>e.aborted,estimatedProcessTime:()=>1}):this.loadData(e,t,i)}cancelImpl(){this.requestController=void 0}startDecodeTile(e,t,i){const r=this.payload;void 0!==r?(this.state=s.TileLoaderState.Decoding,this.payload=void 0,0===r.byteLength||r.constructor===Object&&0===Object.keys(r).length?this.onDecoded({geometries:[],techniques:[]},t):(this.requestController=new n.RequestController(this.priority,this.loadAbortController),this.tileDecoder.decodeTile(r,this.tileKey,this.dataSource.projection,this.requestController).then((i=>{e.aborted||this.onDecoded(i,t)})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&i(e)})))):o.error("TileLoader#startDecodeTile: Cannot decode without payload")}loadData(e,t,i){this.dataProvider.getTile(this.tileKey,e).then((n=>{if(e.aborted){const e=new Error("Aborted");throw e.name="AbortError",e}this.onLoaded(n,t,i,e)})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&i(e)}))}onLoaded(e,t,i,n){this.state===s.TileLoaderState.Loading&&(this.state=s.TileLoaderState.Loaded,this.payload=e,this.startDecodeTile(n,t,i))}onDecoded(e,t){this.decodedTile=e,t(s.TileLoaderState.Ready)}}t.TileLoader=a,t.TileInfoLoader=class extends a{startDecodeTile(e,t,i){const r=this.payload;void 0!==r?(this.state=s.TileLoaderState.Decoding,this.requestController=new n.RequestController(this.priority),this.tileDecoder.getTileInfo(r,this.tileKey,this.dataSource.projection,this.requestController).then((i=>{e.aborted||(this.tileInfo=i,t(s.TileLoaderState.Ready))})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&i(e)}))):o.error("TileInfoLoader#startDecodeTile: Cannot decode without payload")}}},4773:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilerService=void 0;const n=i(8152),r=i(2616),s=i(1781),o=i(2369);class a extends o.WorkerService{static start(e){return new a(e)}constructor(e){super(e),this.serviceId=e,this.tiler=new s.GeoJsonTiler}handleRequest(e){return n.WorkerTilerProtocol.isRegisterIndexRequest(e)?this.handleRegisterIndexRequest(e):n.WorkerTilerProtocol.isUpdateIndexRequest(e)?this.handleUpdateIndexRequest(e):n.WorkerTilerProtocol.isTileRequest(e)?this.handleTileRequest(e):super.handleRequest(e)}async handleTileRequest(e){const t=r.TileKey.fromMortonCode(e.tileKey);return{response:await this.tiler.getTile(e.index,t)||{}}}async handleRegisterIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return await this.tiler.registerIndex(e.id,t),{response:{}}}async handleUpdateIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return this.tiler.updateIndex(e.id,t),{response:{}}}}t.TilerService=a},2369:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerService=void 0;const n=i(8152),r=i(4342).LoggerManager.instance.create("WorkerService",{enabled:!0});t.WorkerService=class{constructor(e){this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=e=>{if("string"==typeof e.data.service&&e.data.service===this.serviceId)try{if(n.WorkerServiceProtocol.isRequestMessage(e.data)){const t=e.data,i={service:t.service,messageId:t.messageId,responseSent:!1};this.m_pendingRequests.set(t.messageId,i),this.tryHandleRequest(t.request).then((e=>{this.doSendResponse(i,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,response:e.response},e.transferList)})).catch((e=>{this.doSendResponse(i,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,errorMessage:e.toString(),errorStack:e.stack})}))}else this.tryHandleMessage(e.data)}catch(t){r.error(`[${this.serviceId}]: Unhandled exception when handling ${e.type}`)}},self.addEventListener("message",this.onMessage);const t={service:e,type:n.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(t)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener("message",this.onMessage)}handleMessage(e){r.error(`[${this.serviceId}]: Invalid message ${e.type}`)}handleRequest(e){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${e.type}'`)}tryHandleMessage(e){try{this.handleMessage(e)}catch(t){r.error(`[${this.serviceId}]: Failed, handling message ${e.type}`)}}tryHandleRequest(e){try{return this.handleRequest(e)}catch(e){return r.error(`[${this.serviceId}]: Failure`,e),Promise.reject(e)}}doSendResponse(e,t,i){e.responseSent||(void 0!==i?self.postMessage(t,i):self.postMessage(t),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach((e=>{this.doSendResponse(e,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,errorMessage:"cancelled"})}))}}},5199:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerServiceManager=void 0;const n=i(8152),r=i(2369);class s extends r.WorkerService{static getInstance(){return void 0===this.m_service&&(this.m_service=new s(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}constructor(e=n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(e),this.m_factories=new Map,this.m_services=new Map}register(e){this.m_factories.set(e.serviceType,e.factory)}handleRequest(e){if(e.type===n.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(e.targetServiceId))throw Error(`error - service with targetServiceId='${e.targetServiceId}' already running, ignoring CreateService request`);const t=this.m_factories.get(e.targetServiceType);if(void 0===t)throw Error(`unknown targetServiceType requested: '${e.targetServiceType}'`);const i=t(e.targetServiceId);this.m_services.set(e.targetServiceId,i)}if(e.type===n.WorkerServiceProtocol.Requests.DestroyService){const t=this.m_services.get(e.targetServiceId);if(void 0===t)throw Error(`unknown targetServiceId '${e.targetServiceId}'`);t.destroy(),this.m_services.delete(e.targetServiceId)}return Promise.resolve({response:{}})}}t.WorkerServiceManager=s},2344:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeLoader=void 0,r(i(2541),t),r(i(3509),t),r(i(7220),t),r(i(8907),t),r(i(4442),t),r(i(9978),t),r(i(207),t),r(i(5307),t),r(i(1818),t),r(i(7511),t),r(i(4549),t),r(i(8380),t),r(i(9348),t),r(i(9993),t),r(i(4757),t),r(i(4303),t),r(i(4055),t),r(i(1774),t),r(i(3103),t),r(i(5187),t),r(i(8427),t),r(i(2476),t),r(i(5071),t),r(i(2175),t),r(i(4988),t),r(i(1406),t),r(i(9237),t),r(i(5159),t),r(i(5482),t),r(i(3977),t),r(i(4247),t),r(i(3061),t),r(i(5146),t),r(i(8881),t),r(i(5738),t),r(i(8015),t),r(i(2967),t),r(i(304),t),r(i(3800),t),r(i(1797),t),t.ThemeLoader=i(6586),r(i(1447),t),r(i(5571),t),r(i(4269),t),r(i(541),t),r(i(5008),t),r(i(9931),t),r(i(3373),t),r(i(1973),t)},2541:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimatedExtrusionHandler=t.AnimatedExtrusionState=void 0;const n=i(8152),r=i(4250),s=i(1984),o=i(4342);var a;!function(e){e[e.None=0]="None",e[e.Started=1]="Started",e[e.Finished=2]="Finished"}(a=t.AnimatedExtrusionState||(t.AnimatedExtrusionState={})),t.AnimatedExtrusionHandler=class{constructor(e){this.m_mapView=e,this.enabled=!0,this.duration=750,this.m_minZoomLevel=1,this.m_forceEnabled=!1,this.m_dataSourceMap=new Map,this.m_state=a.None,this.m_startTime=-1}get forceEnabled(){return this.m_forceEnabled}set forceEnabled(e){this.m_forceEnabled=e,this.duration=750}get minZoomLevel(){return this.m_minZoomLevel}setAnimationProperties(e,t){if(!(0,s.isExtrudedPolygonTechnique)(e))return!1;if(e.hasOwnProperty("minZoomLevel")&&(this.m_minZoomLevel=e.minZoomLevel),this.forceEnabled)return this.enabled;void 0!==e.animateExtrusionDuration&&(this.duration=e.animateExtrusionDuration);const i=(0,n.getPropertyValue)(e.animateExtrusion,t);return null===i?this.enabled:"boolean"==typeof i?i:"number"==typeof i&&0!==i}update(e){const t=this.m_dataSourceMap.size>0&&e>=this.m_minZoomLevel;this.m_state===a.None&&t?this.m_state=a.Started:this.m_state===a.None||t||this.resetAnimation(!0),this.animateExtrusion()}add(e,t){e.addDisposeCallback(this.removeTile.bind(this));let i=!1;this.m_state!==a.None&&(i=this.skipAnimation(e),i?this.setTileExtrusionRatio(t,1):this.m_state===a.Finished&&this.resetAnimation(!1)),this.getOrCreateTileMap(e.dataSource).set(e.tileKey.mortonCode(),{materials:t,animated:i})}get isAnimating(){return this.m_state!==a.Finished&&this.m_state!==a.None}getTileMap(e,t=!1){return this.m_dataSourceMap.get(e)}getOrCreateTileMap(e){let t=this.m_dataSourceMap.get(e);return t||(t=new Map,this.m_dataSourceMap.set(e,t)),t}skipAnimation(e){return this.wasAnyAncestorAnimated(e)||this.wasAnyDescendantAnimated(e)}wasAnyAncestorAnimated(e){var t,i;const n=e.dataSource.getDataZoomLevel(this.m_minZoomLevel),r=Math.max(0,e.tileKey.level-n),s=Math.min(r,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceUp),o=this.getTileMap(e.dataSource);if(!o)return!1;let a=e.tileKey;for(let e=1;e<=s;++e)if(a=a.parent(),null!==(i=null===(t=o.get(a.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;return!1}wasAnyDescendantAnimated(e){var t,i;const n=e.dataSource.maxDataLevel-e.tileKey.level,r=Math.min(n,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceDown),s=this.getTileMap(e.dataSource);if(!s)return!1;const o=e.dataSource.getTilingScheme();let a=[e.tileKey],l=[];for(let e=1;e<=r;++e){l.length=0;for(const e of a)for(const n of o.getSubTileKeys(e)){if(null!==(i=null===(t=s.get(n.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;l.push(n)}[a,l]=[l,a]}return!1}removeTile(e){const t=this.getTileMap(e.dataSource);t&&(t.delete(e.tileKey.mortonCode()),0===t.size&&this.m_dataSourceMap.delete(e.dataSource))}animateExtrusion(){if(this.m_state!==a.Started)return;const e=Date.now();this.m_startTime<0&&(this.m_startTime=e);const t=this.duration,i=Math.min(e-this.m_startTime,t),n=o.MathUtils.easeInOutCubic(r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN,r.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX,i/t);this.setExtrusionRatio(n),i>=t&&(this.m_state=a.Finished),this.m_mapView.update()}resetAnimation(e){this.m_state=a.None,this.m_startTime=-1,e&&this.m_dataSourceMap.forEach((e=>{e.forEach((e=>{e.animated=!1}))}))}setExtrusionRatio(e){this.m_dataSourceMap.forEach((t=>{t.forEach((t=>{t.animated||(this.setTileExtrusionRatio(t.materials,e),e>=1&&(t.animated=!0))}))}))}setTileExtrusionRatio(e,t){e.forEach((e=>{e.extrusionRatio=t}))}}},5863:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundDataSource=void 0;const n=i(2616),r=i(8023),s=i(4303),o=i(8024),a=i(1447);class l extends s.DataSource{constructor(e){super({name:l.NAME,dataSourceOrder:l.GROUND_RENDER_ORDER}),this.m_backgroundColor=l.DEFAULT_COLOR,this.cacheable=!0,this.addGroundPlane=!0,this.enablePicking=!1,this.m_tilingScheme=null!=e?e:l.DEFAULT_TILING_SCHEME}canProvideIconText(){return!1}get backgroundColor(){return this.m_backgroundColor}updateStorageLevelOffset(){let e;this.mapView.dataSources.forEach((t=>{t!==this&&t.getTilingScheme()===this.m_tilingScheme&&(e=void 0===e?t.storageLevelOffset:Math.max(e,t.storageLevelOffset))})),void 0===e&&(e=0),e!==this.storageLevelOffset&&(this.storageLevelOffset=e,this.mapView.clearTileCache(this.name))}async setTheme(e){if(this.mapView.clearTileCache(this.name),void 0!==e.clearColor){const t=r.Expr.fromJSON(e.clearColor,e.definitions);this.m_backgroundColor=t.isDynamic()?t:t.evaluate(this.mapView.env,r.ExprScope.Value)}else this.m_backgroundColor=l.DEFAULT_COLOR}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new a.Tile(this,e);return t.forceHasGeometry(!0),(0,o.addGroundPlane)(t,l.GROUND_RENDER_ORDER,this.m_backgroundColor),t}}t.BackgroundDataSource=l,l.NAME="background",l.DEFAULT_COLOR=16777215,l.GROUND_RENDER_ORDER=Number.MIN_SAFE_INTEGER,l.DEFAULT_TILING_SCHEME=n.webMercatorTilingScheme},3509:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTileLoader=void 0;const n=i(4342),r=i(1406),s=n.LoggerManager.instance.create("BaseTileLoader");t.BaseTileLoader=class{constructor(e,t){this.dataSource=e,this.tileKey=t,this.state=r.TileLoaderState.Initialized,this.m_priority=0,this.loadAbortController=new AbortController}get priority(){return this.m_priority}set priority(e){this.m_priority=e}loadAndDecode(){switch(this.state){case r.TileLoaderState.Loading:case r.TileLoaderState.Loaded:case r.TileLoaderState.Decoding:return this.donePromise;case r.TileLoaderState.Ready:case r.TileLoaderState.Failed:case r.TileLoaderState.Initialized:case r.TileLoaderState.Canceled:return this.startLoading(),this.donePromise}}waitSettled(){return this.donePromise?this.donePromise:Promise.resolve(this.state)}cancel(){this.isFinished||(this.loadAbortController.abort(),this.loadAbortController=new AbortController,this.cancelImpl()),this.onDone(r.TileLoaderState.Canceled)}get isFinished(){return this.state===r.TileLoaderState.Ready||this.state===r.TileLoaderState.Canceled||this.state===r.TileLoaderState.Failed}cancelImpl(){}startLoading(){(0,n.assert)(this.state!==r.TileLoaderState.Loading),this.state=r.TileLoaderState.Loading,this.loadImpl(this.loadAbortController.signal,this.onDone.bind(this),this.onError.bind(this)),void 0===this.donePromise&&(this.donePromise=new Promise(((e,t)=>{this.resolveDonePromise=e,this.rejectedDonePromise=t})))}onDone(e){this.resolveDonePromise&&e===r.TileLoaderState.Ready?this.resolveDonePromise(e):this.rejectedDonePromise&&this.rejectedDonePromise(e),this.resolveDonePromise=void 0,this.rejectedDonePromise=void 0,this.donePromise=void 0,this.state=e}onError(e){if(this.state===r.TileLoaderState.Canceled)return;const t=this.dataSource;s.error(`[${t.name}]: failed to load tile ${this.tileKey.mortonCode()}`,e),this.error=e,this.onDone(r.TileLoaderState.Failed)}}},7220:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoundsGenerator=void 0;const n=i(2616),r=i(6313),s=i(7284);t.BoundsGenerator=class{constructor(e){this.m_view=e,this.createViewBounds()}generate(){return this.m_view.projection!==this.m_viewBounds.projection&&this.createViewBounds(),this.m_viewBounds.generate()}createViewBounds(){this.m_viewBounds=this.m_view.projection.type===n.ProjectionType.Planar?new r.PlaneViewBounds(this.m_view.camera,this.m_view.projection,this.m_view):new s.SphereViewBounds(this.m_view.camera,this.m_view.projection)}}},8907:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraMovementDetector=void 0;const n=i(6815),r=i(541);t.CameraMovementDetector=class{constructor(e,t,i){this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=i,this.m_lastCameraPos=new n.Vector3,this.m_newCameraPos=new n.Vector3,this.m_throttlingTimerId=void 0,this.m_movementDetectorDeadline=0,this.onDeadlineTimer=()=>{this.m_throttlingTimerId=void 0;const e=performance.now();e>=this.m_movementDetectorDeadline?this.movementFinished():this.startMovementFinishedTimer(e)},void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=300)}checkCameraMoved(e,t){const i=r.MapViewUtils.extractAttitude(e,e.camera),n=e.camera.getWorldPosition(this.m_newCameraPos);if(void 0===this.m_lastAttitude)return this.m_lastCameraPos.copy(n),this.m_lastAttitude=i,!1;const s=!this.m_lastCameraPos.equals(n)||i.yaw!==this.m_lastAttitude.yaw||i.pitch!==this.m_lastAttitude.pitch||i.roll!==this.m_lastAttitude.roll;return s&&(this.m_lastCameraPos.copy(n),this.m_lastAttitude=i),s!==this.m_cameraMovedLastFrame&&(s&&this.movementStarted(),this.m_cameraMovedLastFrame=s),s&&(this.m_movementDetectorDeadline=t+this.m_throttlingTimeout,this.startMovementFinishedTimer(t)),this.m_cameraMovedLastFrame}clear(e){const t=e.camera.getWorldPosition(this.m_newCameraPos);this.m_lastCameraPos.set(t.x,t.y,t.z);const i=r.MapViewUtils.extractAttitude(e,e.camera);this.m_lastAttitude=i}forceMoved(){this.m_lastCameraPos.set(Number.NaN,Number.NaN,Number.NaN)}get cameraIsMoving(){return void 0!==this.m_throttlingTimerId}dispose(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0}get cameraMovedLastFrame(){return!0===this.m_cameraMovedLastFrame}movementStarted(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()}movementFinished(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()}startMovementFinishedTimer(e){if(void 0===this.m_throttlingTimerId){const t=Math.max(0,this.m_movementDetectorDeadline-e);this.m_throttlingTimerId=setTimeout(this.onDeadlineTimer,t)}}removeMovementFinishedTimer(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)}}},4442:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraUtils=void 0;const n=i(3334),r=i(5448),s=i(4342),o=i(3103);function a(e,t,i){return(0,s.assert)(e>0,"Focal length must be larger than 0"),Math.atan((1-t)*i*.5/e)}function l(e,t,i){return(0,s.assert)(e>0,"Focal length must be larger than 0"),0===t?2*Math.atan(.5*i/e):a(e,t,i)+a(e,-t,i)}function c(e){return e.userData.fovs}function h(e,t,i,r,s){const c=r*e.aspect;let h=l(i,t.x,c);if((h<o.MIN_FOV_RAD||h>o.MAX_FOV_RAD)&&(h=(0,n.clamp)(h,o.MIN_FOV_RAD,o.MAX_FOV_RAD),s=l(u(h,c,t.x),t.y,r)),e.fov=(0,n.radToDeg)(s),0===(d=t).x&&0===d.y)delete e.userData.fovs;else{const n=r*e.aspect;e.userData.fovs={top:a(i,t.y,r),right:a(i,t.x,n),horizontal:h}}var d;e.userData.focalLength=i}function u(e,t,i){const n=t/2;if(0===i)return n/Math.tan(e/2);const r=i**2;if(Math.abs(e-Math.PI/2)<1e-6)return n*Math.sqrt(1-r);const o=Math.tan(e),a=n*(1+Math.sign(o)*Math.sqrt(1+o**2*(1-r)))/o;return(0,s.assert)(a>=0,"Focal length must be larger than 0"),a}!function(e){function t(e){var t;return null===(t=e.userData)||void 0===t?void 0:t.focalLength}function i(e){return(0,n.degToRad)(e.fov)}function s(e,t,r){t=(0,n.clamp)(t,o.MIN_FOV_RAD,o.MAX_FOV_RAD);const s=a(e);return h(e,s,u(t,r,s.y),r,t),i(e)}function a(e,t=new r.Vector2){return t.x=-e.projectionMatrix.elements[8],t.y=-e.projectionMatrix.elements[9],t}function d(e){var t,i;return null!==(i=null===(t=c(e))||void 0===t?void 0:t.horizontal)&&void 0!==i?i:2*Math.atan(Math.tan((0,n.degToRad)(e.fov)/2)*e.aspect)}function m(e){var t,i;return null!==(i=null===(t=c(e))||void 0===t?void 0:t.top)&&void 0!==i?i:(0,n.degToRad)(e.fov/2)}function p(e){var t,i;return null!==(i=null===(t=c(e))||void 0===t?void 0:t.right)&&void 0!==i?i:d(e)/2}e.getFocalLength=t,e.setFocalLength=function(e,i,n){const r=a(e),c=l(i,r.y,n);return c<o.MIN_FOV_RAD||c>o.MAX_FOV_RAD?s(e,c,n):h(e,r,i,n,c),t(e)},e.getVerticalFov=i,e.setVerticalFov=s,e.convertWorldToScreenSize=function(e,t,i){return e*i/t},e.convertScreenToWorldSize=function(e,t,i){return t*i/e},e.getPrincipalPoint=a,e.setPrincipalPoint=function(e,t){const i=e.aspect,r=.999999;e.setViewOffset(i,1,-(0,n.clamp)(t.x,-.999999,r)*i/2,1*(0,n.clamp)(t.y,-.999999,r)/2,i,1)},e.getHorizontalFov=d,e.getTopFov=m,e.getBottomFov=function(e){return(0,n.degToRad)(e.fov)-m(e)},e.getRightFov=p,e.getLeftFov=function(e){var t;return void 0!==(null===(t=c(e))||void 0===t?void 0:t.right)?d(e)-p(e):d(e)/2}}(t.CameraUtils||(t.CameraUtils={}))},9978:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDefaultClipPlanesEvaluator=t.TiltViewClipPlanesEvaluator=t.TopViewClipPlanesEvaluator=t.ElevationBasedClipPlanesEvaluator=void 0;const n=i(2479),r=i(3216),s=i(3334),o=i(9747),a=i(5381),l=i(5448),c=i(6815),h=i(2616),u=i(4342),d=i(4442),m=i(541),p=1e-6;var f;!function(e){const t=[new c.Vector3,new c.Vector3],i=new r.Raycaster,n=new a.Sphere(new c.Vector3,h.EarthConstants.EQUATORIAL_RADIUS);function o(e,t){return e-t<p?0:Math.sqrt(e*e-t*t)}e.getFarDistanceFromElevatedHorizon=function(t,i,n,r){const s=o(i,n),a=o(r,n),l=Math.asin(n/i),c=Math.abs(l-e.getNormalToFwdAngle(t));return Math.cos(c)*(s+a)},e.getProjNearPlaneTanDistance=function(e,i,n){const r=e.getWorldDirection(t[0]),s=t[1].copy(r).multiplyScalar(-n).sub(e.position),o=s.dot(r);return o/s.length()>Math.cos(i)?o:void 0},e.getProjSphereIntersectionDistance=function(e,r,s){i.setFromCamera(r,e),n.radius=s;const o=i.ray.intersectSphere(n,t[0]);return null!==o?o.sub(e.position).dot(e.getWorldDirection(t[1])):void 0},e.getNormalToFwdAngle=function(e){const i=t[0].copy(e.position).negate().normalize().dot(e.getWorldDirection(t[1]));return Math.acos((0,s.clamp)(i,-1,1))}}(f||(f={}));class g{constructor(e,t){(0,u.assert)(e>=t),this.m_minElevation=t,this.m_maxElevation=e}set maxElevation(e){this.m_maxElevation=e,this.m_minElevation=Math.min(e,this.m_minElevation)}get maxElevation(){return this.m_maxElevation}set minElevation(e){this.m_minElevation=e,this.m_maxElevation=Math.max(e,this.m_maxElevation)}get minElevation(){return this.m_minElevation}}t.ElevationBasedClipPlanesEvaluator=g;class v extends g{constructor(e=h.EarthConstants.MAX_BUILDING_HEIGHT,t=0,i=1,n=.05,r=6){super(e,t),this.nearMin=i,this.nearFarMarginRatio=n,this.farMaxRatio=r,this.m_tmpVectors=[new c.Vector3,new c.Vector3,new c.Vector3],this.m_tmpQuaternion=new o.Quaternion,(0,u.assert)(i>0),(0,u.assert)(n>=0),(0,u.assert)(r>1);const s=n*i;this.m_minimumViewRange={near:i,far:i+s,minimum:this.nearMin,maximum:Math.max(i*r,i+s)}}evaluateClipPlanes(e,t,i){(0,u.assert)(e instanceof n.PerspectiveCamera,"Unsupported camera type.");const r=e;return t.type===h.ProjectionType.Spherical?this.evaluateDistanceSphericalProj(r,t,i):t.type===h.ProjectionType.Planar?this.evaluateDistancePlanarProj(r,t,i):((0,u.assert)(!1,"Unsupported projection type"),Object.assign({},this.minimumViewRange))}get minimumViewRange(){return this.m_minimumViewRange}evaluateDistancePlanarProj(e,t,i){(0,u.assert)(t.type!==h.ProjectionType.Spherical);let n=this.nearMin,r=this.nearMin*this.farMaxRatio;const s=t.groundDistance(e.position),o=s*this.farMaxRatio;n=s-this.maxElevation,r=s-this.minElevation,n=Math.max(n,this.nearMin),r=Math.min(r,o);const a=this.nearFarMarginRatio*(n+r)/2;return n=Math.max(n-a/2,this.nearMin),r=Math.max(r+a/2,n+a),{near:n,far:r,minimum:this.nearMin,maximum:Math.max(o,r)}}evaluateDistanceSphericalProj(e,t,i){(0,u.assert)(t.type===h.ProjectionType.Spherical);const n=t.groundDistance(e.position);let r=n-this.maxElevation;const o=h.EarthConstants.EQUATORIAL_RADIUS,a=Math.max(p,e.position.length()),l=Math.asin(o/a);let c=(0,s.degToRad)(e.fov/2);e.aspect>1&&(c=m.MapViewUtils.calculateHorizontalFovByVerticalFov(2*c,e.aspect));const d=o+this.maxElevation,g=f.getFarDistanceFromElevatedHorizon(e,a,o,d);let v=c>l?g:this.getFovBasedFarPlane(e,a,o,2*c,t);const _=n-this.minElevation,y=n*this.farMaxRatio;r=Math.max(r,this.nearMin),v=Math.max(v,_);const x=this.nearFarMarginRatio*(r+v)/2;return r=Math.max(r-x/2,this.nearMin),v=Math.max(v+x/2,r+x),{near:r,far:v,minimum:this.nearMin,maximum:y}}getFovBasedFarPlane(e,t,i,n,r){const s=e.position;e.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],n/2);const o=this.m_tmpVectors[2],a=this.m_tmpVectors[1].copy(o).applyQuaternion(this.m_tmpQuaternion),l=s.dot(a);if(l<0)return r.groundDistance(e.position)*this.farMaxRatio;const c=s.dot(s)-l*l,h=i*i;return(0,u.assert)(c<=h,"Please use this evaluator only for top view camera poses."),l-Math.sqrt(h-c)}}t.TopViewClipPlanesEvaluator=v;class _ extends v{constructor(){super(...arguments),this.m_tmpV2=new l.Vector2}evaluateDistancePlanarProj(e,t,i){(0,u.assert)(t.type!==h.ProjectionType.Spherical);const n=Object.assign({},this.minimumViewRange),r=Math.PI/2-p,o=t.groundDistance(e.position),a=m.MapViewUtils.extractCameraTilt(e,t),l=d.CameraUtils.getTopFov(e),c=d.CameraUtils.getBottomFov(e),f=(0,s.clamp)(a+l,-r,r),g=(0,s.clamp)(a-c,-r,r),v=Math.max(0,(o-this.minElevation)/Math.cos(f)),_=Math.max(0,(o-this.maxElevation)/Math.cos(g));return n.near=_*Math.cos(c),n.far=v*Math.cos(l),this.applyViewRangeConstraints(n,e,t,i)}evaluateDistanceSphericalProj(e,t,i){(0,u.assert)(t.type===h.ProjectionType.Spherical);const n=Object.assign({},this.minimumViewRange);return n.near=this.computeNearDistSphericalProj(e,t),n.far=this.computeFarDistSphericalProj(e,t),this.applyViewRangeConstraints(n,e,t,i)}computeNearDistSphericalProj(e,t){(0,u.assert)(t.type===h.ProjectionType.Spherical);const i=t.groundDistance(e.position)-this.maxElevation;if(i<=0)return 0;const n=h.EarthConstants.EQUATORIAL_RADIUS+this.maxElevation,r=d.CameraUtils.getBottomFov(e),s=f.getProjNearPlaneTanDistance(e,r,n);if(void 0!==s)return s;d.CameraUtils.getPrincipalPoint(e,this.m_tmpV2);const o=this.m_tmpV2.y>0,a=f.getProjSphereIntersectionDistance(e,this.m_tmpV2.setComponent(1,-1),n),l=o?f.getProjSphereIntersectionDistance(e,this.m_tmpV2.setComponent(1,1),n):1/0,c=Math.min(null!=a?a:1/0,null!=l?l:1/0);return(0,u.assert)(c!==1/0,"No reference point for near distance found"),null!=c?c:i}computeFarDistSphericalProj(e,t){(0,u.assert)(t.type===h.ProjectionType.Spherical);const i=h.EarthConstants.EQUATORIAL_RADIUS,n=i+this.minElevation,r=i+this.maxElevation,s=e.position.length();d.CameraUtils.getPrincipalPoint(e,this.m_tmpV2);const o=this.m_tmpV2.x<=0?1:-1,a=this.m_tmpV2.y>0,l=f.getProjSphereIntersectionDistance(e,this.m_tmpV2.set(o,1),n),c=a?f.getProjSphereIntersectionDistance(e,this.m_tmpV2.set(o,-1),n):0,m=Math.max(null!=l?l:1/0,null!=c?c:1/0);return m!==1/0?m:f.getFarDistanceFromElevatedHorizon(e,s,i,r)}applyViewRangeConstraints(e,t,i,n){const{distance:r}=m.MapViewUtils.getTargetAndDistance(i,t,n),o=i.groundDistance(t.position)-this.minElevation,a=r*this.farMaxRatio;e.near=Math.max(e.near,this.nearMin),e.far=(0,s.clamp)(e.far,o,a);const l=this.nearFarMarginRatio*(e.near+e.far)/2;return e.near=Math.max(e.near-l/2,this.nearMin),e.far=Math.max(e.far+l/2,e.near+l),e.minimum=this.nearMin,e.maximum=a,e}}t.TiltViewClipPlanesEvaluator=_,t.createDefaultClipPlanesEvaluator=()=>new _},207:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCache=void 0;const n=i(5971);class r{constructor(){this.m_map=new Map}static get instance(){return this.m_instance}getColor(e){"number"==typeof e&&(e="#"+e.toString(16).padStart(6,"0"));let t=this.m_map.get(e);return void 0!==t||(t=new n.Color(e),this.m_map.set(e,t)),t}get size(){return this.m_map.size}clear(){this.m_map.clear()}}t.ColorCache=r,r.m_instance=new r},1818:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentDecoderFacade=void 0;const n=i(7685),r=i(9931);class s{static getTileDecoder(e,t,i,n){const s=this.getWorkerSet(t,i,n);return new r.WorkerBasedDecoder(s,e)}static getWorkerSet(e,t,i){void 0===e&&(e=this.defaultScriptUrl);let r=this.workerSets[e];if(void 0===r){const s=void 0!==i?1e3*i:void 0;r=new n.ConcurrentWorkerSet({scriptUrl:e,workerCount:null!=t?t:this.defaultWorkerCount,workerConnectionTimeout:s}),this.workerSets[e]=r}return r}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach((e=>{this.workerSets[e].destroy()})),this.workerSets={}}static destroyIfTerminated(){let e=!0;Object.keys(this.workerSets).forEach((t=>{this.workerSets[t].terminated||(e=!1)})),e&&s.destroy()}}t.ConcurrentDecoderFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=void 0,s.workerSets={}},7511:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentTilerFacade=void 0;const n=i(7685),r=i(3373);class s{static getTiler(e,t,i,n){const s=this.getWorkerSet(t,i,n);return new r.WorkerBasedTiler(s,e)}static getWorkerSet(e,t,i){void 0===e&&(e=this.defaultScriptUrl);let r=this.workerSets[e];if(void 0===r){const s=void 0!==i?1e3*i:void 0;r=new n.ConcurrentWorkerSet({scriptUrl:e,workerCount:null!=t?t:this.defaultWorkerCount,workerConnectionTimeout:s}),this.workerSets[e]=r}return r}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach((e=>{this.workerSets[e].destroy()})),this.workerSets={}}static destroyIfTerminated(){let e=!0;Object.keys(this.workerSets).forEach((t=>{this.workerSets[t].terminated||(e=!1)})),e&&s.destroy()}}t.ConcurrentTilerFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=1,s.workerSets={}},7685:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentWorkerSet=t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=t.isLoggingMessage=void 0;const n=i(3334),r=i(8152),s=i(4342),o=i(1973),a=s.LoggerManager.instance.create("ConcurrentWorkerSet");function l(e){return e&&"number"==typeof e.level&&e.type===s.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=l,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=1e4,t.ConcurrentWorkerSet=class{constructor(e){this.m_options=e,this.m_workerChannelLogger=s.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_availableWorkers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_workerRequestQueue=[],this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=(e,t)=>{if(r.WorkerServiceProtocol.isResponseMessage(t.data)){const i=t.data;if(null===i.messageId)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: no messageId`);const n=this.m_requests.get(i.messageId);if(void 0===n)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: invalid messageId`);if(e>=0&&e<this.m_workers.length){const t=this.m_workers[e];this.m_availableWorkers.push(t),this.checkWorkerRequestQueue()}else a.error(`[${this.m_options.scriptUrl}]: onWorkerMessage: invalid workerId`);if(void 0!==i.errorMessage){const e=new Error(i.errorMessage);void 0!==i.errorStack&&(e.stack=i.errorStack),n.resolver(e)}else n.resolver(void 0,i.response)}else if(r.WorkerServiceProtocol.isInitializedMessage(t.data)){const e=this.getReadyPromise(t.data.service);++e.count===this.m_workerPromises.length&&e.resolve()}else if(l(t.data))switch(t.data.level){case s.LogLevel.Trace:this.m_workerChannelLogger.trace(...t.data.message);break;case s.LogLevel.Debug:this.m_workerChannelLogger.debug(...t.data.message);break;case s.LogLevel.Log:this.m_workerChannelLogger.log(...t.data.message);break;case s.LogLevel.Info:this.m_workerChannelLogger.info(...t.data.message);break;case s.LogLevel.Warn:this.m_workerChannelLogger.warn(...t.data.message);break;case s.LogLevel.Error:this.m_workerChannelLogger.error(...t.data.message)}else this.eventHandler(t)},this.start()}addReference(){this.m_referenceCount+=1,1===this.m_referenceCount&&this.m_stopped&&this.start()}removeReference(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()}start(e){if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");this.m_workerCount=(0,s.getOptionValue)(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?(0,n.clamp)(navigator.hardwareConcurrency-1,1,2):void 0,2);const i=(0,s.getOptionValue)(this.m_options.workerConnectionTimeout,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT),r=this.m_workers,a=this.m_availableWorkers;for(let e=0;e<this.m_workerCount;++e){const t=o.WorkerLoader.startWorker(this.m_options.scriptUrl,i).then((t=>{const i=t=>{this.onWorkerMessage(e,t)};return t.addEventListener("message",i),r.push(t),a.push(t),{worker:t,listener:i}}));this.m_workerPromises.push(t)}this.m_stopped=!1}get workerCount(){return this.m_workerCount}async stop(){this.m_stopped=!0,await this.waitForAllResponses().then((()=>{this.terminateWorkers()}))}destroy(){this.m_stopped=!0,this.m_requests.forEach((e=>{e.resolver(new Error("worker destroyed"))})),this.m_requests.clear(),this.m_workerRequestQueue=[],this.terminateWorkers(),this.m_eventListeners.clear()}get terminated(){return 0===this.m_workers.length}async connect(e){return this.ensureStarted(),await Promise.all(this.m_workerPromises),await this.getReadyPromise(e).promise}addEventListener(e,t){this.m_eventListeners.set(e,t)}removeEventListener(e){this.m_eventListeners.delete(e)}invokeRequest(e,t,i,n){this.ensureStarted();const s=this.m_nextMessageId++;let o;const a=new Promise(((e,t)=>{o=(i,n)=>{this.m_requests.delete(s),void 0!==i?t(i):e(n)}}));this.m_requests.set(s,{promise:a,resolver:o});const l={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:s,request:t};return this.postRequestMessage(l,i,n),a}broadcastRequest(e,t,i){const n=[];for(const s of this.m_workers){const o=this.m_nextMessageId++;let a;const l=new Promise(((e,t)=>{a=(i,n)=>{this.m_requests.delete(o),void 0!==i?t(i):e(n)}}));n.push(l),this.m_requests.set(o,{promise:l,resolver:a});const c={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:o,request:t};void 0!==i?s.postMessage(c,i):s.postMessage(c)}return Promise.all(n)}broadcastMessage(e,t){this.ensureStarted(),void 0!==t?this.m_workers.forEach((i=>i.postMessage(e,t))):this.m_workers.forEach((t=>t.postMessage(e)))}get requestQueueSize(){return this.m_workerRequestQueue.length}get numWorkers(){return this.m_workers.length}get numIdleWorkers(){return this.m_availableWorkers.length}eventHandler(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)}postRequestMessage(e,t,i){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");if(void 0!==i&&i.signal.aborted){const t=this.m_requests.get(e.messageId);if(void 0===t)return void a.error(`[${this.m_options.scriptUrl}]: Bad RequestMessage: invalid messageId`);const i=new Error("Aborted");return i.name="AbortError",void t.resolver(i,void 0)}if(this.m_availableWorkers.length>0){const i=this.m_availableWorkers.pop();void 0!==t?i.postMessage(e,t):i.postMessage(e)}else void 0===i&&(i=new r.RequestController(0)),0===i.priority&&(i.priority=-this.m_nextMessageId),this.m_workerRequestQueue.unshift({message:e,buffers:t,requestController:i})}ensureStarted(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")}async waitForAllResponses(){const e=new Array;this.m_requests.forEach((t=>{e.push(t.promise)})),await Promise.all(e)}dispatchEvent(e,t){const i=this.m_eventListeners.get(e);void 0!==i&&i(t)}terminateWorkers(){this.m_workerPromises.forEach((e=>{e.then((e=>{void 0!==e&&(e.worker.removeEventListener("message",e.listener),e.worker.terminate())}))})),this.m_workers=[],this.m_availableWorkers=[],this.m_workerPromises=[],this.m_readyPromises.clear()}getReadyPromise(e){const t=this.m_readyPromises.get(e);if(void 0!==t)return t;const i={count:0,promise:void 0,resolve:()=>{},reject:e=>{i.error=e},error:void 0};return i.promise=new Promise(((e,t)=>{const n=i;void 0!==n.error?t(n.error):n.count===this.m_workerPromises.length&&e(),n.resolve=e,n.reject=t})),this.m_readyPromises.set(e,i),i}checkWorkerRequestQueue(){if(0!==this.m_workerRequestQueue.length&&0!==this.m_availableWorkers.length)for(this.m_workerRequestQueue.sort(((e,t)=>e.requestController.priority-t.requestController.priority));this.m_availableWorkers.length>0&&this.m_workerRequestQueue.length>0;){const e=this.m_workerRequestQueue.pop();this.postRequestMessage(e.message,e.buffers,e.requestController)}}}},4303:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSource=void 0;const n=i(2356),r=i(3334),s=i(8797),o=i(4342),a=o.LoggerManager.instance.create("DataSource");class l extends n.EventDispatcher{constructor(e={}){super(),this.UPDATE_EVENT={type:"update"},this.enabled=!0,this.cacheable=!1,this.useGeometryLoader=!1,this.addGroundPlane=!1,this.minDataLevel=1,this.maxDataLevel=20,this.minDisplayLevel=0,this.maxDisplayLevel=22,this.allowOverlappingTiles=!0,this.enablePicking=!0,this.dataSourceOrder=0,this.exprPool=new s.ExprPool,this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_storageLevelOffset=0,this.m_featureStateMap=new Map;let{name:t}=e;const{layerNames:i,languages:n,minZoomLevel:r,maxZoomLevel:o,minDataLevel:a,maxDataLevel:c,minDisplayLevel:h,maxDisplayLevel:u,storageLevelOffset:d,allowOverlappingTiles:m,enablePicking:p,minGeometryHeight:f,maxGeometryHeight:g,dataSourceOrder:v}=e;void 0!==t&&0!==t.length||(t="anonymous-datasource#"+ ++l.uniqueNameCounter),this.name=t,this.layerNames=i,this.m_languages=n,void 0!==a&&(this.minDataLevel=a),void 0!==c&&(this.maxDataLevel=c),void 0!==r&&(this.minZoomLevel=r),void 0!==o&&(this.maxZoomLevel=o),void 0!==h&&(this.minDisplayLevel=h),void 0!==u&&(this.maxDisplayLevel=u),void 0!==d&&(this.m_storageLevelOffset=d),void 0!==m&&(this.allowOverlappingTiles=m),void 0!==p&&(this.enablePicking=p),void 0!==f&&(this.minGeometryHeight=f),void 0!==g&&(this.maxGeometryHeight=g),v&&(this.dataSourceOrder=v)}getFeatureState(e){return this.m_featureStateMap.get(e)}clearFeatureState(){this.m_featureStateMap.clear()}setFeatureState(e,t){this.m_featureStateMap.set(e,t)}removeFeatureState(e){this.m_featureStateMap.delete(e)}get layerNames(){return this.m_layerNames}set layerNames(e){c(e,this.m_layerNames)||(this.m_layerNames=e,this.clearCache(),this.requestUpdate())}dispose(){}clearCache(){}isFullyCovering(){return this.addGroundPlane}ready(){return!0}get mapView(){if(void 0===this.m_mapView)throw new Error("This DataSource "+this.name+" was not added to MapView");return this.m_mapView}get projection(){return this.mapView.projection}async connect(){}attach(e){this.m_mapView=e}detach(e){(0,o.assert)(this.m_mapView===e),this.m_mapView=void 0}isDetached(){return void 0===this.m_mapView}async setTheme(e){}set languages(e){this.m_languages=e}get languages(){return this.m_languages}setPoliticalView(e){}updateTile(e){}shouldPreloadTiles(){return!1}get minZoomLevel(){return a.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and maxDataLevel instead."),this.minDataLevel}set minZoomLevel(e){a.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and minDisplayLevel instead."),this.minDataLevel=e}get maxZoomLevel(){return a.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel}set maxZoomLevel(e){a.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel=e}get maxGeometryHeight(){return this.m_maxGeometryHeight}set maxGeometryHeight(e){this.m_maxGeometryHeight=e}get minGeometryHeight(){return this.m_minGeometryHeight}set minGeometryHeight(e){this.m_minGeometryHeight=e}get storageLevelOffset(){return this.m_storageLevelOffset}set storageLevelOffset(e){this.m_storageLevelOffset=e}setEnableElevationOverlay(e){}getDataZoomLevel(e){return(0,r.clamp)(e+this.m_storageLevelOffset,this.minDataLevel,this.maxDataLevel)}isVisible(e){return e>=this.minDisplayLevel&&e<=this.maxDisplayLevel}canGetTile(e,t){return t.level<=e}shouldSubdivide(e,t){return t.level<=e}canProvideIconText(){return!0}requestUpdate(){this.dispatchEvent(this.UPDATE_EVENT)}}t.DataSource=l,l.uniqueNameCounter=0;const c=(e,t)=>{let i=e===t;if(!i&&e&&t){let n=e.length;if(t.length===n)for(i=!0;i&&n--;)i=t.includes(e[n])}return i}},507:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugContext=t.DebugContext=void 0;const n=i(2356),r="undefined"==typeof window;class s extends n.EventDispatcher{constructor(e){super(),this.value=e}set(e,t){this.value=e,this.dispatchEvent({type:s.SET_EVENT_TYPE,name:t,value:e})}}s.SET_EVENT_TYPE="set";class o{constructor(){this.m_optionsMap=new Map,!r&&"undefined"!=typeof window&&window&&(window.__debugContext=this)}setValue(e,t){let i=this.m_optionsMap.get(e);i?i.set(t,e):(i=new s(t),this.m_optionsMap.set(e,i))}getValue(e){const t=this.m_optionsMap.get(e);return t?t.value:void 0}hasOption(e){return void 0!==this.m_optionsMap.get(e)}addEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.addEventListener(s.SET_EVENT_TYPE,t)}hasEventListener(e,t){const i=this.m_optionsMap.get(e);if(i)return i.hasEventListener(s.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)}removeEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.removeEventListener(s.SET_EVENT_TYPE,t)}get options(){return this.m_optionsMap}clear(){this.m_optionsMap.forEach((e=>{e.set(void 0,"")}))}}t.DebugContext=o,t.debugContext=new o},8427:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateColorProperty=t.applySecondaryColorToMaterial=t.evaluateBaseColorProperty=t.buildMetricValueEvaluator=t.buildObject=t.usesObject3D=t.getBufferAttribute=t.createMaterial=void 0;const n=i(9365),r=i(2481),s=i(6307),o=i(3905),a=i(5448),l=i(4760),c=i(5269),h=i(394),u=i(8152),d=i(5535),m=i(4250),p=i(5562),f=i(1984),g=i(1667),v=i(8023),_=i(6331),y=i(4342),x=i(946),S=i(8673),b=i(7063),T=i(176),M=i(3977),w=i(5146),E=y.LoggerManager.instance.create("DecodedTileHelpers");function C(e,t,i){return e[i]=t,e.needsUpdate=!0,t}const A=new h.Texture;function P(e,t,i,n,r){return new Promise(((s,o)=>{const a=(0,b.loadTexture)(t,r.textureCache,n,r.renderer,s,o);a&&C(e,a,i)}))}const R=new a.Vector2;function L(e,t){return null==e?e:("string"==typeof e&&(e.endsWith("px")?(t="Pixel",e=Number.parseFloat(e)):e.endsWith("m")&&(e=Number.parseFloat(e))),"Pixel"===t?t=>{var i;return(null!==(i=t.env.lookup("$pixelToMeters"))&&void 0!==i?i:1)*(0,u.getPropertyValue)(e,t.env)}:e)}function D(e,t){if(e=function(e,t){return void 0!==t&&v.Expr.isExpr(e)&&(e=(0,u.getPropertyValue)(e,t)),e}(e,t),null!=e){if("number"==typeof e)return e;if("string"==typeof e){const t=(0,_.parseStringEncodedColor)(e);if(void 0!==t)return t}if(null==e?void 0:e.isRGBA)return g.ColorUtils.getHexFromRgba(e.r,e.g,e.b,e.a);E.error(`Unsupported color format: '${e}'`)}}t.createMaterial=function(e,t,i){const n=function(e,t){if(void 0!==e.name)switch(e.name){case"extruded-line":if(!(0,f.isExtrudedLineTechnique)(e))throw new Error("Invalid extruded-line technique");return"standard"===e.shading?m.MapMeshStandardMaterial:m.MapMeshBasicMaterial;case"standard":case"terrain":return m.MapMeshStandardMaterial;case"extruded-polygon":return m.MapMeshPhongMaterial;case"dashed-line":case"solid-line":return m.SolidLineMaterial;case"polygon":return t?m.MapMeshStandardMaterial:m.MapMeshBasicMaterial;case"squares":return o.PointsMaterial;case"circles":return m.CirclePointsMaterial;case"line":case"segments":return s.LineBasicMaterial;case"raster":case"text":case"labeled-icon":case"line-marker":case"label-rejection-line":return}}(e,!0===(null==i?void 0:i.shadowsEnabled)),r={};if(void 0===n)return;n.prototype instanceof m.RawShaderMaterial&&(r.rendererCapabilities=t.renderer.capabilities),n!==m.HighPrecisionLineMaterial&&(r.fog=null==i?void 0:i.fog),!0===(null==i?void 0:i.shadowsEnabled)&&"polygon"===e.name&&(r.removeDiffuseLight=!0);const a=new n(r);if(void 0!==e.id&&(a.name=e.id),(0,f.isExtrudedPolygonTechnique)(e)&&(a.flatShading=!0),(0,p.needsCanvasSize)(a)){const e=t.renderer.domElement;a.canvasSize=R.set(e.width,e.height),a.onResizeListener=()=>{const e=t.renderer.domElement;a.canvasSize=R.set(e.width,e.height)},a.onResizeTarget=t,a.onResizeTarget.addEventListener(M.MapViewEventNames.Resize,a.onResizeListener)}a.depthTest=(0,f.isExtrudedPolygonTechnique)(e)&&!1!==e.depthTest;const l=[];let c=!0;(0,f.supportsTextures)(e)&&f.TEXTURE_PROPERTY_KEYS.forEach((i=>{const n=function(e,t,i,n){let r=i[t];if(void 0===r)return Promise.reject(new Error(`textureProperty for texturePropertyName ${t} in technique ${i.name} is undefined`));if(v.Expr.isExpr(r)&&(r=(0,u.getPropertyValue)(r,n.env),!r))return Promise.resolve(C(e,A,t));if(!(0,f.isSolidLineTechnique)(i)){const s=i[t+"Properties"];return P(e,r,t,s,n)}return C(e,A,t),n.imageRepo.loadImage(r).then((i=>(null==i?void 0:i.imageItem.image)?P(e,null==i?void 0:i.imageItem.image,t,{minFilter:"linear",magFilter:"linear"},n):void 0))}(a,i,e,t).catch((e=>{c=!1}));l.push(n)}));const h=Promise.all(l).then((()=>Promise.resolve(c)));return T.MapMaterialAdapter.create(a,function(e){var t;const i=(0,d.getTechniqueAutomaticAttrs)(e);switch(e.name){case"dashed-line":case"solid-line":{const n=(0,y.pick)(e,i);return n.width=L(null!==(t=e.width)&&void 0!==t?t:0,e.metricUnit),n.offset=L(e.offset,e.metricUnit),n}case"polygon":case"circles":case"squares":case"line":case"segments":return(0,y.pick)(e,i);case"standard":case"terrain":case"extruded-polygon":{const t=(0,y.pick)(e,i);return!0!==e.vertexColors&&(t.color=e.color),t}case"extruded-line":return(0,y.pick)(e,["color","wireframe","transparent","opacity","polygonOffset","polygonOffsetFactor","polygonOffsetUnits",...i]);case"raster":return(0,y.pick)(e,["brightness","gamma"]);default:return{}}}(e)),"fog"in a&&(a.fog=r.fog),{material:a,texturesReady:h}},t.getBufferAttribute=function(e){switch(e.type){case"float":return new n.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint8":return new n.BufferAttribute(new Uint8Array(e.buffer),e.itemCount,e.normalized);case"uint16":return new n.BufferAttribute(new Uint16Array(e.buffer),e.itemCount,e.normalized);case"uint32":return new n.BufferAttribute(new Uint32Array(e.buffer),e.itemCount,e.normalized);case"int8":return new n.BufferAttribute(new Int8Array(e.buffer),e.itemCount,e.normalized);case"int16":return new n.BufferAttribute(new Int16Array(e.buffer),e.itemCount,e.normalized);case"int32":return new n.BufferAttribute(new Int32Array(e.buffer),e.itemCount,e.normalized);default:throw new Error(`unsupported buffer of type ${e.type}`)}},t.usesObject3D=function(e){const t=e.name;return void 0!==t&&"text"!==t&&"labeled-icon"!==t&&"line-marker"!==t&&"label-rejection-line"!==t},t.buildObject=function(e,t,i,n,s){switch((0,y.assert)(void 0!==e.name),e.name){case"extruded-line":case"standard":case"extruded-polygon":case"polygon":return s?new x.DisplacedMesh(t,i,(()=>({min:n.elevationRange.minElevation,max:n.elevationRange.maxElevation}))):new c.Mesh(t,i);case"terrain":return new c.Mesh(t,i);case"dashed-line":case"solid-line":return s?new x.DisplacedMesh(t,i,(()=>({min:n.elevationRange.minElevation,max:n.elevationRange.maxElevation})),S.SolidLineMesh.raycast):new S.SolidLineMesh(t,i);case"circles":return new w.Circles(t,i);case"squares":return new w.Squares(t,i);case"line":case"segments":return new l.LineSegments(t,i)}return(0,y.assert)(!1,"Invalid technique"),new r.Object3D},t.buildMetricValueEvaluator=L,t.evaluateBaseColorProperty=function(e,t){const i=function(e){const t=function(e){var t;return null===(t=(0,d.getTechniqueDescriptor)(e))||void 0===t?void 0:t.attrTransparencyColor}(e);if(void 0!==t)return e[t]}(e);if(void 0!==i)return D(i,t)},t.applySecondaryColorToMaterial=function(e,t,i){let n=D(t,i);void 0!==n&&(g.ColorUtils.hasAlphaInHex(n)&&(E.warn("Used RGBA value for technique color without transparency support!"),n=g.ColorUtils.removeAlphaFromHex(n)),e.setHex(n))},t.evaluateColorProperty=D},2476:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setDepthPrePassStencil=t.createDepthPrePassMesh=t.isDepthPrePassMesh=t.createDepthPrePassMaterial=t.isRenderDepthPrePassEnabled=t.DEPTH_PRE_PASS_STENCIL_MASK=void 0;const n=i(6271),r=i(3148),s=i(5269),o=i(4250),a=i(1667),l=i(8427);function c(e){e.depthWrite=!1,e.depthFunc=n.EqualDepth,e.colorWrite=!0,(0,o.enforceBlending)(e);const t=e.clone();return t.isDepthPrepassMaterial=!0,t.depthWrite=!0,t.depthTest=!0,t.depthFunc=n.LessDepth,t.colorWrite=!1,t.opacity=1,t.blending=n.NoBlending,t}t.DEPTH_PRE_PASS_STENCIL_MASK=1,t.isRenderDepthPrePassEnabled=function(e,t){if(!1===e.enableDepthPrePass)return!1;let i=void 0!==e.opacity&&e.opacity>0&&e.opacity<1;if(!i){const n=(0,l.evaluateBaseColorProperty)(e,t);if(void 0!==n){const e=a.ColorUtils.getAlphaFromHex(n);i=e>0&&e<1}}return i},t.createDepthPrePassMaterial=c,t.isDepthPrePassMesh=function(e){if(!0!==e.isMesh)return!1;const t=e;return t.material instanceof Array?t.material.every((e=>!0===e.isDepthPrepassMaterial)):!0===t.material.isDepthPrepassMaterial},t.createDepthPrePassMesh=function(e){const t=e.geometry;if(!(t instanceof r.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");const i=t.getAttribute("position");if(!i)throw new Error("#createDepthPassMesh position attribute not found");const n=new r.BufferGeometry;n.setAttribute("position",i);const o=t.getAttribute("uv");o&&n.setAttribute("uv",o);const a=t.getAttribute("normal");a&&n.setAttribute("normal",a);const l=t.getAttribute("extrusionAxis");l&&n.setAttribute("extrusionAxis",l),t.index&&n.setIndex(t.index);for(const e of t.groups){const{start:t,count:i,materialIndex:r}=e;n.addGroup(t,i,r)}const h=e.material instanceof Array?e.material.map(c):c(e.material),u=new s.Mesh(n,h);return u.renderOrder=e.renderOrder-1e-6,u},t.setDepthPrePassStencil=function(e,i){function r(e){const i=e;i.stencilWrite=!0,i.stencilFail=n.KeepStencilOp,i.stencilZFail=n.KeepStencilOp,i.stencilZPass=n.ReplaceStencilOp,i.stencilFunc=n.AlwaysStencilFunc,i.stencilRef=255,i.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}function s(e){const i=e;i.stencilWrite=!0,i.stencilFail=n.KeepStencilOp,i.stencilZFail=n.KeepStencilOp,i.stencilZPass=n.ZeroStencilOp,i.stencilFunc=n.EqualStencilFunc,i.stencilRef=255,i.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}e.material instanceof Array?e.material.map(r):r(e.material),i.material instanceof Array?i.material.map(s):s(i.material)}},5071:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2175:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4988:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CalculationStatus=void 0,(i=t.CalculationStatus||(t.CalculationStatus={}))[i.PendingApproximate=0]="PendingApproximate",i[i.FinalPrecise=1]="FinalPrecise"},4055:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0,t.EventDispatcher=class{constructor(){this.m_listeners=new Map}dispose(){this.removeAllEventListeners()}hasEventListener(e,t){const i=this.m_listeners.get(e);return void 0!==i&&(void 0===t||i.includes(t))}addEventListener(e,t){let i=this.m_listeners.get(e);void 0===i&&(i=[],this.m_listeners.set(e,i)),i.includes(t)||i.push(t)}removeEventListener(e,t){const i=this.m_listeners.get(e);if(void 0!==i)if(void 0===t)this.m_listeners.delete(e);else{const n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.m_listeners.delete(e))}}removeAllEventListeners(){const e=Array.from(this.m_listeners.keys());for(const t of e)this.removeEventListener(t)}get eventTypes(){return Array.from(this.m_listeners.keys())}listeners(e){return this.m_listeners.get(e)}dispatchEvent(e){const t=this.m_listeners.get(e.type);if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e)}}}},1774:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FixedClipPlanesEvaluator=void 0,t.FixedClipPlanesEvaluator=class{constructor(e=1,t=10){this.minNear=e,this.minFarOffset=t,this.minFar=e+t,this.m_nearPlane=e,this.m_farPlane=this.minFar}get nearPlane(){return this.m_nearPlane}set nearPlane(e){this.invalidatePlanes(e,this.m_farPlane)}get farPlane(){return this.m_farPlane}set farPlane(e){this.invalidatePlanes(this.m_nearPlane,e)}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e,t,i){return{near:this.m_nearPlane,far:this.m_farPlane,minimum:this.minNear,maximum:this.m_farPlane}}invalidatePlanes(e,t){const i=Math.max(this.minNear,e),n=Math.max(this.minFar,t,i+this.minFarOffset);this.m_nearPlane=i,this.m_farPlane=n}}},3103:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_FOV_RAD=t.MIN_FOV_RAD=t.MAX_FOV_DEG=t.MIN_FOV_DEG=t.DEFAULT_FOV_CALCULATION=void 0;const n=i(3334);t.DEFAULT_FOV_CALCULATION={type:"dynamic",fov:40},t.MIN_FOV_DEG=0,t.MAX_FOV_DEG=180,t.MIN_FOV_RAD=(0,n.degToRad)(t.MIN_FOV_DEG),t.MAX_FOV_RAD=(0,n.degToRad)(t.MAX_FOV_DEG)},8502:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrustumIntersection=t.TileKeyEntry=void 0;const n=i(2754),r=i(6084),s=i(3334),o=i(8333),a=i(6815),l=i(6577),c=i(2616),h=i(4342),u=i(4988),d=i(9904),m=i(541),p=[new a.Vector3,new a.Vector3],f=new l.Vector4;class g{constructor(e,t,i=0,n,r=0){this.tileKey=e,this.area=t,this.offset=i,this.elevationRange=n,this.distance=r}}t.TileKeyEntry=g,t.FrustumIntersection=class{constructor(e,t,i,n,s,a=256){this.m_camera=e,this.mapView=t,this.m_extendedFrustumCulling=i,this.m_tileWrappingEnabled=n,this.m_enableMixedLod=s,this.m_tilePixelSize=a,this.m_frustum=new r.Frustum,this.m_viewProjectionMatrix=new o.Matrix4,this.m_rootTileKeys=[],this.m_tileKeyEntries=new Map,this.m_mapTileCuller=new d.MapTileCuller(e)}get camera(){return this.m_camera}get projection(){return this.mapView.projection}updateFrustum(e){this.m_viewProjectionMatrix.multiplyMatrices(void 0!==e?e:this.m_camera.projectionMatrix,this.m_camera.matrixWorldInverse),this.m_frustum.setFromProjectionMatrix(this.m_viewProjectionMatrix),this.m_extendedFrustumCulling&&this.m_mapTileCuller.setup(),this.computeRequiredInitialRootTileKeys(this.m_camera.position)}compute(e,t,i,r){this.m_tileKeyEntries.clear(),(0,h.assert)(0!==this.mapView.viewportHeight);const s=Math.pow(this.m_tilePixelSize/this.mapView.viewportHeight,2),o=void 0!==t&&t.getTilingScheme()===e,a=this.mapView.projection.type===c.ProjectionType.Spherical||o,l=new Set(i);let u=0,d=0;r.forEach((e=>{u=Math.min(u,e.minGeometryHeight),d=Math.max(d,e.maxGeometryHeight)}));const m={calculationFinal:!0,tileBounds:a?new c.OrientedBox3:new n.Box3};for(const e of l)this.m_tileKeyEntries.set(e,new Map);for(const i of this.m_rootTileKeys){const n=i.tileKey,r=i.offset,s=this.getTileKeyEntry(n,r,e,m,u,d,o?t:void 0);if(void 0!==s)for(const e of l)this.m_tileKeyEntries.get(e).set(c.TileKeyUtils.getKeyForTileKeyAndOffset(n,r),s)}const p=[...this.m_rootTileKeys.values()],f=this.mapView.projection===c.sphereProjection||this.mapView.tilt>0;for(;p.length>0;){const n=p.pop();if(void 0===n)break;const a=n.tileKey,h=n.offset;if(!r.some(((e,t)=>e.shouldSubdivide(i[t],a))))continue;if(this.m_enableMixedLod&&f&&n.area<s)continue;const g=c.TileKeyUtils.getKeyForTileKeyAndOffset(a,h);for(const e of l)a.level>=e||this.m_tileKeyEntries.get(e).delete(g);for(const i of e.getSubTileKeys(a)){const n=this.getTileKeyEntry(i,h,e,m,u,d,o?t:void 0);if(void 0!==n){for(const e of l){if(n.tileKey.level>e)continue;const t=c.TileKeyUtils.getKeyForTileKeyAndOffset(i,h);this.m_tileKeyEntries.get(e).set(t,n)}p.push(n)}}}return{tileKeyEntries:this.m_tileKeyEntries,calculationFinal:m.calculationFinal}}getTileKeyEntry(e,t,i,n,r,s,o){var a,l;const c=function(e,t,i){const n=e.getGeoBox(t),r=360*i;return n.northEast.longitude+=r,n.southWest.longitude+=r,n}(i,e,t);if(void 0!==o){const t=o.getElevationRange(e);c.southWest.altitude=t.minElevation,c.northEast.altitude=t.maxElevation,n.calculationFinal=n.calculationFinal&&t.calculationStatus===u.CalculationStatus.FinalPrecise}c.southWest.altitude=(null!==(a=c.southWest.altitude)&&void 0!==a?a:0)+r,c.northEast.altitude=(null!==(l=c.northEast.altitude)&&void 0!==l?l:0)+s,this.mapView.projection.projectBox(c,n.tileBounds);const{area:h,distance:d}=this.computeTileAreaAndDistance(n.tileBounds);if(h>0)return new g(e,h,t,{minElevation:c.southWest.altitude,maxElevation:c.northEast.altitude},d)}computeTileAreaAndDistance(e){if(e instanceof n.Box3){if(this.m_extendedFrustumCulling&&!this.m_mapTileCuller.frustumIntersectsTileBox(e)||!this.m_frustum.intersectsBox(e))return{area:0,distance:1/0}}else if(!e.intersects(this.m_frustum))return{area:0,distance:1/0};const t=e.getCenter(p[0]),i=f.set(t.x,t.y,t.z,1).applyMatrix4(this.m_viewProjectionMatrix),r=.5*e.getSize(p[1]).length()/i.w;return{area:r*r,distance:i.z<=-i.w?-1:i.z>=i.w?1:i.z/i.w}}computeRequiredInitialRootTileKeys(e){this.m_rootTileKeys=[];const t=c.TileKey.fromRowColumnLevel(0,0,0);if(this.mapView.projection.type!==c.ProjectionType.Planar||!this.m_tileWrappingEnabled)return void this.m_rootTileKeys.push(new g(t,1/0,0));const i=this.mapView.projection.unprojectPoint(e),n=Math.round(i.longitude/360),r=this.m_camera,o=m.MapViewUtils.extractAttitude(this.mapView,r).pitch,l=r.aspect>1?r.aspect:1/r.aspect,h=(0,s.degToRad)(r.fov*l/2)+o,u=Math.tan(h)*r.position.z-Math.tan(o)*r.position.z,d=new a.Vector3(e.x-u,e.y,e.z),p=this.mapView.projection.unprojectPoint(d),f=(0,s.clamp)(Math.ceil(Math.abs((i.longitude-p.longitude)/360)*Math.SQRT2),0,7);for(let e=-f+n;e<=f+n;e++)this.m_rootTileKeys.push(new g(t,1/0,e))}}},1406:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TileLoaderState=void 0,(i=t.TileLoaderState||(t.TileLoaderState={}))[i.Initialized=0]="Initialized",i[i.Loading=1]="Loading",i[i.Loaded=2]="Loaded",i[i.Decoding=3]="Decoding",i[i.Ready=4]="Ready",i[i.Canceled=5]="Canceled",i[i.Failed=6]="Failed"},5482:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapAnchors=void 0;const n=i(6815),r=i(2616);t.MapAnchors=class{constructor(){this.m_anchors=[],this.m_priorities=[]}get children(){return this.m_anchors}add(e){this.m_anchors.push(e)}remove(e){const t=this.m_anchors.findIndex((t=>t===e));t>-1&&this.m_anchors.splice(t,1)}clear(){this.m_anchors.length=0}setPriorities(e){this.m_priorities=e}update(e,t,i,s){const o=new n.Vector3;this.m_anchors.forEach((n=>{var a;if(void 0!==n.layer){const e=null===(a=this.m_priorities)||void 0===a?void 0:a.findIndex((e=>e.layer===n.layer&&e.category===n.category));void 0!==e&&-1!==e&&(n.renderOrder=10*(e+1))}const l=void 0!==n.geoPosition?n.geoPosition:n.anchor;void 0!==l&&((0,r.isVector3Like)(l)?o.set(l.x,l.y,l.z):(0,r.isGeoCoordinatesLike)(l)&&e.projectPoint(l,o),n.position.copy(o).sub(t)),!0===n.overlay?s.add(n):i.add(n)}))}}},176:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMaterialAdapter=void 0;const n=i(6271),r=i(977),s=i(5971),o=i(3334),a=i(8152),l=i(4250),c=i(1984),h=i(1667),u=i(8023),d=i(7610),m=i(4342),p=i(8427),f=i(7063);function g(e){return"color"===e||"opacity"===e}class v{static create(e,t){const i=new v(e,t);return e.userData||(e.userData={}),e.userData.mapMaterialAdapter=i,i}static update(e,t){var i,n;const r=null===(i=e.userData)||void 0===i?void 0:i.mapMaterialAdapter;return null!==(n=null==r?void 0:r.update(t))&&void 0!==n&&n}constructor(e,t){this.m_material=e,this.m_styledProperties=t,this.m_currentPropertyValues={},this.m_lastUpdateFrameNumber=-1,this.m_dynamicProperties=[];let i=!1;for(const e in t){if(!t.hasOwnProperty(e))continue;const n=t[e];u.Expr.isExpr(n)||"function"==typeof n?this.m_dynamicProperties.push([e,n]):null!=n&&(this.m_currentPropertyValues[e]=n,g(e)?i=!0:this.setProperty(e,n))}i&&this.setBaseColorAndOpacity()}toJSON(){}update(e){if(this.m_lastUpdateFrameNumber===e.frameNumber)return!1;this.m_lastUpdateFrameNumber=e.frameNumber;const t=this.updateDynamicProperties(e),i=this.updateTextureMagFilter(e);return t||i}updateTextureMagFilter(e){let t=!1;if(this.m_material instanceof r.MeshBasicMaterial&&this.m_material.map){const i=e.env.lookup("$shouldAntialiasRasterTile")?n.LinearFilter:n.NearestFilter;this.m_material.map.magFilter!==i&&(this.m_material.map.magFilter=i,t=!0,this.m_material.map.needsUpdate=!0)}return t}updateDynamicProperties(e){let t=!1,i=!1;for(const[n,r]of this.m_dynamicProperties){const s=u.Expr.isExpr(r)?(0,a.getPropertyValue)(r,e.env):r(e);s!==this.m_currentPropertyValues[n]&&(this.m_currentPropertyValues[n]=s,g(n)?i=!0:this.setProperty(n,s,e.textureCache),t=!0)}return i&&this.setBaseColorAndOpacity(),t}setTextureProperty(e,t,i){const n=this.m_material;if(!n[e]||null===t)return;const r=n[e],s=(0,f.loadTexture)(t,i,void 0,void 0,(t=>{n[e]=t,r.dispose()}));s&&(s.wrapS=r.wrapS,s.wrapT=r.wrapT,s.magFilter=r.magFilter,s.minFilter=r.minFilter,s.flipY=r.flipY,s.repeat=r.repeat)}isColorProperty(e){const t=this.m_material[e];return t instanceof s.Color||t instanceof d.RGBA}setProperty(e,t,i){var n;this.isColorProperty(e)?this.setColorProperty(e,t):(n=e,c.TEXTURE_PROPERTY_KEYS.includes(n)?i&&this.setTextureProperty(e,t,i):this.m_material[e]=t)}setColorProperty(e,t){const i=this.m_material;let n;if((0,m.assert)(i[e]instanceof s.Color||i[e]instanceof d.RGBA),null==t?void 0:t.isRGBA)n=d.RGBA.isRGBA(t)?t:(new d.RGBA).copy(t);else{const e=(0,p.evaluateColorProperty)(t);if(void 0===e)return;n=h.ColorUtils.getRgbaFromHex(e)}return i[e]instanceof s.Color?i[e]=new s.Color(n.r,n.g,n.b):i[e]=n,n}setOpacity(e){var t;let i=null!==(t=this.m_currentPropertyValues.opacity)&&void 0!==t?t:1;i=(0,o.clamp)(i,0,1);const n=i*e.a,r=n>=1;this.m_material.color instanceof s.Color&&(i=n),this.m_material instanceof l.RawShaderMaterial?this.m_material.setOpacity(i):this.m_material.opacity=i,r?(0,l.disableBlending)(this.m_material):(0,l.enableBlending)(this.m_material),this.m_material.needsUpdate=!0}setBaseColorAndOpacity(){var e;const t=null!==(e=this.m_currentPropertyValues.color)&&void 0!==e?e:16711680,i=this.setColorProperty("color",t);i&&this.setOpacity(i)}}t.MapMaterialAdapter=v},4572:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapObjectAdapter=void 0;const n=i(1984),r=i(176);class s{static get(e){var t;return null===(t=null==e?void 0:e.userData)||void 0===t?void 0:t.mapObjectAdapter}static install(e){return e.object.userData||(e.object.userData={}),e.object.userData.mapObjectAdapter=e}static create(e,t){return s.install(new s(e,t))}static update(e,t){var i,n;return null!==(n=null===(i=s.get(e))||void 0===i?void 0:i.update(t))&&void 0!==n&&n}constructor(e,t){var i;this.m_lastUpdateFrameNumber=-1,this.m_notCompletlyTransparent=!0,this.object=e,this.technique=t.technique,this.dataSource=t.dataSource,this.m_pickability=null!==(i=t.pickability)&&void 0!==i?i:n.Pickability.onlyVisible,this.m_notCompletlyTransparent=this.getObjectMaterials().some((e=>e.opacity>0)),this.tileKey=t.tileKey}toJSON(){return{technique:this.technique}}update(e){return this.m_lastUpdateFrameNumber!==e.frameNumber&&(this.m_lastUpdateFrameNumber=e.frameNumber,this.updateMaterials(e))}isVisible(){return this.object.visible&&this.m_notCompletlyTransparent}isPickable(){return this.pickability===n.Pickability.onlyVisible&&this.isVisible()||this.m_pickability===n.Pickability.all}get pickability(){return this.m_pickability}updateMaterials(e){let t=!1;const i=this.getObjectMaterials();for(const n of i){const i=r.MapMaterialAdapter.update(n,e);t=t||i}return t&&(this.m_notCompletlyTransparent=i.some((e=>e.opacity>0))),t}getObjectMaterials(){const e=this.object;return Array.isArray(e.material)?e.material:void 0!==e.material?[e.material]:[]}}t.MapObjectAdapter=s},9904:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapTileCuller=void 0;const n=i(6815);t.MapTileCuller=class{constructor(e){this.m_camera=e,this.m_globalFrustumMin=new n.Vector3,this.m_globalFrustumMax=new n.Vector3,this.m_frustumCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3]}setup(){const e=this.getFrustumCorners(),t=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const i of e)i.applyMatrix4(t),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,i.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,i.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,i.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,i.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,i.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,i.z)}frustumIntersectsTileBox(e){const t=this.m_globalFrustumMin,i=this.m_globalFrustumMax;return!(i.x<e.min.x||i.y<e.min.y||i.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)}getFrustumCorners(){const e=this.m_frustumCorners,t=this.m_camera.projectionMatrixInverse;let i=0;function n(n,r,s){e[i++].set(n,r,s).applyMatrix4(t)}return n(-1,-1,-1),n(1,-1,-1),n(-1,1,-1),n(1,1,-1),n(-1,-1,1),n(1,-1,1),n(-1,1,1),n(1,1,1),e}}},3977:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapView=t.MapViewPowerPreference=t.MapViewEventNames=t.TileTaskGroups=void 0,i(9677).ColorManagement.enabled=!1;const n=i(2479),r=i(6271),s=i(2481),o=i(3216),a=i(2754),l=i(5971),c=i(3334),h=i(8333),u=i(3850),d=i(5381),m=i(5448),p=i(6815),f=i(4814),g=i(5700),v=i(5808),_=i(2616),y=i(1984),x=i(4342),S=i(2541),b=i(5863),T=i(8907),M=i(4442),w=i(9978),E=i(5307),C=i(1818),A=i(7511),P=i(8380),R=i(4055),L=i(1350),D=i(3103),I=i(8502),O=i(9587),F=i(3801),U=i(304),V=i(8488),N=i(9297),B=i(5996),k=i(5482),z=i(3011),G=i(19),j=i(6272),H=i(8881),W=i(5187),q=i(8658),X=i(8015),K=i(9780),Y=i(541),Z=i(5008);var $,J;x.LoggerManager.instance.setLogLevelForAll(x.LogLevel.Error),(J=t.TileTaskGroups||(t.TileTaskGroups={})).FETCH_AND_DECODE="fetch",J.CREATE="create",function(e){e.Update="update",e.Resize="resize",e.Render="render",e.AfterRender="didrender",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.CopyrightChanged="copyright-changed",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored",e.CameraPositionChanged="camera-changed",e.Dispose="dispose"}($=t.MapViewEventNames||(t.MapViewEventNames={}));const Q=x.LoggerManager.instance.create("MapView"),ee=4e6,te=["northpole","southpole"],ie={vector2:[new m.Vector2],vector3:[new p.Vector3,new p.Vector3,new p.Vector3],rayCaster:new o.Raycaster,groundPlane:new u.Plane,groundSphere:new d.Sphere(void 0,_.EarthConstants.EQUATORIAL_RADIUS),matrix4:[new h.Matrix4,new h.Matrix4],transform:[{position:new p.Vector3,xAxis:new p.Vector3,yAxis:new p.Vector3,zAxis:new p.Vector3}],color:new l.Color};var ne;!function(e){e.Default="default",e.LowPower="low-power",e.HighPerformance="high-performance"}(ne=t.MapViewPowerPreference||(t.MapViewPowerPreference={}));const re={projection:_.mercatorProjection,addBackgroundDatasource:!0,maxVisibleDataSourceTiles:100,extendedFrustumCulling:!0,tileCacheSize:200,resourceComputationType:Z.ResourceComputationType.EstimationInMb,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2,pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1,target:new _.GeoCoordinates(25,0),zoomLevel:5,tilt:0,heading:0,theme:{},maxTilesPerFrame:0};class se extends R.EventDispatcher{constructor(e){var t;super(),this.UPDATE_EVENT={type:$.Update},this.RENDER_EVENT={type:$.Render},this.DID_RENDER_EVENT={type:$.AfterRender},this.FRAME_COMPLETE_EVENT={type:$.FrameComplete},this.THEME_LOADED_EVENT={type:$.ThemeLoaded},this.ANIMATION_STARTED_EVENT={type:$.AnimationStarted},this.ANIMATION_FINISHED_EVENT={type:$.AnimationFinished},this.MOVEMENT_STARTED_EVENT={type:$.MovementStarted},this.MOVEMENT_FINISHED_EVENT={type:$.MovementFinished},this.CONTEXT_LOST_EVENT={type:$.ContextLost},this.CONTEXT_RESTORED_EVENT={type:$.ContextRestored},this.COPYRIGHT_CHANGED_EVENT={type:$.CopyrightChanged},this.DISPOSE_EVENT={type:$.Dispose},this.m_renderLabels=!0,this.m_visibleTileSetLock=!1,this.m_tileWrappingEnabled=!0,this.m_zoomLevel=1,this.m_minZoomLevel=1,this.m_maxZoomLevel=20,this.m_minCameraHeight=20,this.m_rteCamera=new n.PerspectiveCamera,this.m_yaw=0,this.m_pitch=0,this.m_roll=0,this.m_targetDistance=0,this.m_targetGeoPos=_.GeoCoordinates.fromObject(re.target),this.m_targetWorldPos=new p.Vector3,this.m_viewRanges={near:.1,far:ee,minimum:.1,maximum:ee},this.m_scene=new v.Scene,this.m_overlayScene=new v.Scene,this.m_sceneRoot=new s.Object3D,this.m_overlaySceneRoot=new s.Object3D,this.m_mapAnchors=new k.MapAnchors,this.m_animationCount=0,this.m_drawing=!1,this.m_updatePending=!1,this.m_frameNumber=0,this.m_forceCameraAspect=void 0,this.m_taskSchedulerTimeout=void 0,this.m_tileDataSources=[],this.m_connectedDataSources=new Set,this.m_connectingDataSources=0,this.m_enablePolarDataSource=!0,this.m_raycaster=new o.Raycaster,this.m_plane=new u.Plane(new p.Vector3(0,0,1)),this.m_sphere=new d.Sphere(void 0,_.EarthConstants.EQUATORIAL_RADIUS),this.m_env=new y.MapEnv({}),this.m_imageRepo=new N.ImageRepo,this.m_textureCache=new B.TextureCache,this.m_lastTileIds="",this.m_copyrightInfo=[],this.m_disposed=!1,this.onWebGLContextLost=e=>{this.dispatchEvent(this.CONTEXT_LOST_EVENT),Q.warn("WebGL context lost",e)},this.onWebGLContextRestored=e=>{this.dispatchEvent(this.CONTEXT_RESTORED_EVENT),void 0!==this.m_renderer&&(this.iconTextRenderer.restoreRenderers(this.m_renderer),this.update()),Q.warn("WebGL context restored",e)},this.m_options=Object.assign({},e),this.m_uriResolver=this.m_options.uriResolver,void 0!==this.m_options.minZoomLevel&&(this.m_minZoomLevel=this.m_options.minZoomLevel),void 0!==this.m_options.maxZoomLevel&&(this.m_maxZoomLevel=this.m_options.maxZoomLevel),void 0!==this.m_options.minCameraHeight&&(this.m_minCameraHeight=this.m_options.minCameraHeight),void 0!==this.m_options.maxBounds&&(this.m_geoMaxBounds=this.m_options.maxBounds),void 0!==this.m_options.decoderUrl&&(C.ConcurrentDecoderFacade.defaultScriptUrl=this.m_uriResolver?this.m_uriResolver.resolveUri(this.m_options.decoderUrl):this.m_options.decoderUrl),void 0!==this.m_options.decoderCount&&(C.ConcurrentDecoderFacade.defaultWorkerCount=this.m_options.decoderCount),this.m_visibleTileSetOptions=Object.assign(Object.assign({},re),{clipPlanesEvaluator:void 0!==e.clipPlanesEvaluator?e.clipPlanesEvaluator:(0,w.createDefaultClipPlanesEvaluator)()}),void 0!==e.projection&&(this.m_visibleTileSetOptions.projection=e.projection),void 0!==e.extendedFrustumCulling&&(this.m_visibleTileSetOptions.extendedFrustumCulling=e.extendedFrustumCulling),void 0!==e.maxVisibleDataSourceTiles&&(this.m_visibleTileSetOptions.maxVisibleDataSourceTiles=e.maxVisibleDataSourceTiles),void 0!==e.tileCacheSize&&(this.m_visibleTileSetOptions.tileCacheSize=e.tileCacheSize),void 0!==e.resourceComputationType&&(this.m_visibleTileSetOptions.resourceComputationType=e.resourceComputationType),void 0!==e.quadTreeSearchDistanceUp&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceUp=e.quadTreeSearchDistanceUp),void 0!==e.quadTreeSearchDistanceDown&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceDown=e.quadTreeSearchDistanceDown),void 0!==e.enablePolarDataSource&&(this.m_enablePolarDataSource=e.enablePolarDataSource),this.m_pixelRatio=e.pixelRatio,this.m_options.maxFps=null!==(t=this.m_options.maxFps)&&void 0!==t?t:0,this.m_options.enableStatistics=!0===this.m_options.enableStatistics,this.handleRequestAnimationFrame=this.renderLoop.bind(this),void 0!==this.m_options.tileWrappingEnabled&&(this.m_tileWrappingEnabled=this.m_options.tileWrappingEnabled),this.setupStats(this.m_options.enableStatistics),this.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.m_renderer=new(null!==f.WebGL1Renderer&&void 0!==f.WebGL1Renderer?f.WebGL1Renderer:g.WebGLRenderer)({canvas:this.canvas,context:this.m_options.context,antialias:this.nativeWebglAntialiasEnabled,alpha:this.m_options.alpha,preserveDrawingBuffer:!0===this.m_options.preserveDrawingBuffer,powerPreference:void 0===this.m_options.powerPreference?ne.Default:this.m_options.powerPreference}),this.m_renderer.autoClear=!1,this.m_renderer.outputColorSpace=r.LinearSRGBColorSpace,this.m_renderer.debug.checkShaderErrors=!1,this.m_renderer.info.autoReset=!1,this.m_tileObjectRenderer=new K.TileObjectRenderer(this.m_env,this.m_renderer),this.setupRenderer(this.m_tileObjectRenderer),this.m_options.fovCalculation=void 0===this.m_options.fovCalculation?D.DEFAULT_FOV_CALCULATION:this.m_options.fovCalculation,this.m_options.fovCalculation.fov=(0,c.clamp)(this.m_options.fovCalculation.fov,D.MIN_FOV_DEG,D.MAX_FOV_DEG);const{width:i,height:a}=this.getCanvasClientSize(),l=i/a;this.m_camera=new n.PerspectiveCamera(this.m_options.fovCalculation.fov,l,.1,ee),this.m_camera.up.set(0,0,1),this.setFovOnCamera(this.m_options.fovCalculation,a),this.projection.projectPoint(this.m_targetGeoPos,this.m_targetWorldPos),this.m_scene.add(this.m_camera),this.m_screenProjector=new q.ScreenProjector(this.m_camera),this.m_taskScheduler=new G.MapViewTaskScheduler(this.maxFps),this.m_tileGeometryManager=new F.TileGeometryManager(this),void 0!==e.enableMixedLod&&(this.m_enableMixedLod=e.enableMixedLod),void 0!==e.lodMinTilePixelSize&&(this.m_lodMinTilePixelSize=e.lodMinTilePixelSize),this.m_visibleTiles=this.createVisibleTileSet(),this.m_sceneEnvironment=new z.MapViewEnvironment(this,e),this.setupCamera(),this.m_pickHandler=new H.PickHandler(this,this.m_rteCamera,!0===this.m_options.enablePickTechnique),this.m_movementDetector=new T.CameraMovementDetector(this.m_options.movementThrottleTimeout,(()=>this.movementStarted()),(()=>this.movementFinished()));const h=this.m_options.customAntialiasSettings;if(this.mapRenderingManager=new E.MapRenderingManager(i,a,this.m_options.dynamicPixelRatio,h),this.m_animatedExtrusionHandler=new S.AnimatedExtrusionHandler(this),this.m_enablePolarDataSource){const t=void 0!==e.polarLayerNames?e.polarLayerNames:te;this.m_polarDataSource=new W.PolarTileDataSource({layerNames:t,geometryLevelOffset:e.polarGeometryLevelOffset}),this.updatePolarDataSource()}this.m_taskScheduler.addEventListener($.Update,(()=>{this.update()})),void 0!==e.throttlingEnabled&&(this.m_taskScheduler.throttlingEnabled=e.throttlingEnabled),this.m_themeManager=new j.MapViewThemeManager(this,(0,x.getOptionValue)(this.m_options.theme,re.theme),this.m_imageRepo,this.m_uriResolver),this.m_iconTextRenderer=this.createTextRenderer(),this.update()}get lights(){return this.m_sceneEnvironment.lights}get taskQueue(){return this.m_taskScheduler.taskQueue}get renderLabels(){return this.m_renderLabels}set renderLabels(e){this.m_renderLabels=e}get delayLabelsUntilMovementFinished(){return this.iconTextRenderer.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.iconTextRenderer.delayLabelsUntilMovementFinished=e}get iconTextRenderer(){return this.m_iconTextRenderer}get cameraMovementDetector(){return this.m_movementDetector}get animatedExtrusionHandler(){return this.m_animatedExtrusionHandler}get tileGeometryManager(){return this.m_tileGeometryManager}get enableMixedLod(){return this.m_enableMixedLod}set enableMixedLod(e){this.m_enableMixedLod!==e&&(this.m_enableMixedLod=e,this.createVisibleTileSet(),this.update())}get tileWrappingEnabled(){return this.m_tileWrappingEnabled}set tileWrappingEnabled(e){this.projection.type!==_.ProjectionType.Spherical?(e!==this.m_tileWrappingEnabled&&(this.m_tileWrappingEnabled=e,this.createVisibleTileSet()),this.update()):Q.warn("Setting this with spherical projection has no affect. Was this intended?")}dispose(e=!0){this.DISPOSE_EVENT.time=Date.now(),this.dispatchEvent(this.DISPOSE_EVENT),this.m_disposed=!0,this.m_movementFinishedUpdateTimerId&&(clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=void 0),void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);for(const e of this.m_tileDataSources)e.dispose();this.m_visibleTiles.clearTileCache(),this.m_iconTextRenderer.clearRenderStates(),this.m_textureCache.evictAll(),this.m_renderer.dispose(),e&&this.m_renderer.forceContextLoss(),this.m_imageRepo.iconTextManager.clear(),this.m_tileGeometryManager.clear(),this.m_movementDetector.dispose(),C.ConcurrentDecoderFacade.destroyIfTerminated(),A.ConcurrentTilerFacade.destroyIfTerminated(),this.m_taskScheduler.clearQueuedTasks(),super.dispose()}get disposed(){return this.m_disposed}get resourceComputationType(){return this.m_visibleTiles.resourceComputationType}set resourceComputationType(e){this.m_visibleTiles.resourceComputationType=e}getCacheSize(){return this.m_visibleTiles.getDataSourceCacheSize()}setCacheSize(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.m_iconTextRenderer.invalidateCache(),this.update()}get extendedFrustumCulling(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling}set extendedFrustumCulling(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e}get lockVisibleTileSet(){return this.m_visibleTileSetLock}set lockVisibleTileSet(e){this.m_visibleTileSetLock=e}get pointOfView(){return this.m_pointOfView}set pointOfView(e){this.m_pointOfView=e,this.update()}loadPostEffects(e){fetch(e).then((e=>e.json())).then((e=>{this.m_postEffects=e,this.setPostEffects()}))}get postEffects(){return this.m_postEffects}set postEffects(e){this.m_postEffects=e,this.setPostEffects()}async setTheme(e,t){if(this.animatedExtrusionHandler.enabled){this.animatedExtrusionHandler.enabled=!1;const e=()=>{this.animatedExtrusionHandler.enabled=!0,this.removeEventListener($.FrameComplete,e)};this.addEventListener($.FrameComplete,e)}const i=await this.m_themeManager.setTheme(e,t);return this.THEME_LOADED_EVENT.time=Date.now(),this.dispatchEvent(this.THEME_LOADED_EVENT),this.update(),i}async getTheme(){return await this.m_themeManager.getTheme()}get uriResolver(){return this.m_uriResolver}get forceCameraAspect(){return this.m_forceCameraAspect}set forceCameraAspect(e){this.m_forceCameraAspect=e}get copyrightInfo(){return this.m_copyrightInfo}set disableFading(e){this.m_iconTextRenderer.disableFading=e}get disableFading(){return this.m_iconTextRenderer.disableFading}get frameNumber(){return this.m_frameNumber}resetFrameNumber(){this.m_frameNumber=0,this.m_previousFrameTimeStamp=void 0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get canvas(){return this.m_options.canvas}get collisionDebugCanvas(){return this.m_collisionDebugCanvas}get scene(){return this.m_scene}get overlayScene(){return this.m_overlayScene}get sceneEnvironment(){return this.m_sceneEnvironment}get camera(){return this.m_camera}get renderer(){return this.m_renderer}get clearColor(){const e=this.m_renderer.getClearColor(ie.color);return void 0!==e?e.getHex():0}set clearColor(e){this.m_renderer.setClearColor(e)}get clearAlpha(){const e=this.m_renderer.getClearAlpha();return void 0!==e?e:0}set clearAlpha(e){this.m_renderer.setClearAlpha(e)}get projection(){return this.m_visibleTileSetOptions.projection}set projection(e){const t=this.tilt,i=this.heading;this.m_visibleTileSetOptions.projection=e,this.updatePolarDataSource(),this.clearTileCache(),this.iconTextRenderer.clearRenderStates(),this.createVisibleTileSet(),this.geoMaxBounds=this.geoMaxBounds,this.lookAtImpl({tilt:t,heading:i})}get clipPlanesEvaluator(){return this.m_visibleTileSetOptions.clipPlanesEvaluator}set clipPlanesEvaluator(e){this.m_visibleTileSetOptions.clipPlanesEvaluator=e}get focalLength(){var e;return null!==(e=M.CameraUtils.getFocalLength(this.m_camera))&&void 0!==e?e:0}get target(){return this.m_targetGeoPos}get worldTarget(){return this.m_targetWorldPos}get targetDistance(){return this.m_targetDistance}get viewRanges(){return this.m_viewRanges}get geoCenter(){return this.projection.unprojectPoint(this.m_camera.position).normalized()}set geoCenter(e){if(void 0!==e.altitude)this.projection.projectPoint(e,this.m_camera.position);else{const t=this.geoCenter.altitude;this.projection.projectPoint(new _.GeoCoordinates(e.latitude,e.longitude,t),this.m_camera.position)}this.update()}get mapAnchors(){return this.m_mapAnchors}get worldCenter(){return this.m_camera.position}get pickHandler(){return this.m_pickHandler}get imageRepo(){return this.m_imageRepo}get textureCache(){return this.m_textureCache}get minCameraHeight(){return this.m_minCameraHeight}get minZoomLevel(){return this.m_minZoomLevel}set minZoomLevel(e){this.m_minZoomLevel=e,this.update()}get maxZoomLevel(){return this.m_maxZoomLevel}set maxZoomLevel(e){this.m_maxZoomLevel=e,this.update()}get geoMaxBounds(){return this.m_geoMaxBounds}set geoMaxBounds(e){this.m_geoMaxBounds=e,this.m_worldMaxBounds=this.m_geoMaxBounds?this.projection.projectBox(this.m_geoMaxBounds,this.projection.type===_.ProjectionType.Planar?new a.Box3:new _.OrientedBox3):void 0}get worldMaxBounds(){return this.m_worldMaxBounds}get zoomLevel(){return this.m_zoomLevel}set zoomLevel(e){this.lookAtImpl({zoomLevel:e})}get tilt(){return(0,c.radToDeg)(this.m_pitch)}set tilt(e){this.lookAtImpl({tilt:e})}get heading(){return-(0,c.radToDeg)(this.m_yaw)}set heading(e){this.lookAtImpl({heading:e})}get env(){return this.m_env}get storageLevel(){return(0,c.clamp)(Math.floor(this.m_zoomLevel),this.m_minZoomLevel,this.m_maxZoomLevel)}get viewportHeight(){return this.canvas.height}get nativeWebglAntialiasEnabled(){return void 0===this.m_options.enableNativeWebglAntialias?this.pixelRatio<2:this.m_options.enableNativeWebglAntialias}get dataSources(){return this.m_tileDataSources}setFovCalculation(e){this.m_options.fovCalculation=e,this.updateCameras()}getDataSourceByName(e){return this.m_tileDataSources.find((t=>t.name===e))}getDataSourcesByLayerName(e){return this.m_tileDataSources.filter((t=>{var i;return null===(i=t.layerNames)||void 0===i?void 0:i.includes(e)}))}isDataSourceEnabled(e){return e.enabled&&e.ready()&&this.m_connectedDataSources.has(e.name)&&e.isVisible(this.zoomLevel)}async addDataSource(e){var t,i;if(void 0!==this.getDataSourceByName(e.name))throw new Error(`A DataSource with the name "${e.name}" already exists in this MapView.`);e.attach(this),e.setEnableElevationOverlay(void 0!==this.m_elevationProvider);const n=this.m_tileDataSources.find((e=>!0===e.addGroundPlane&&!(e instanceof b.BackgroundDataSource)));!0===e.addGroundPlane&&void 0!==n&&Q.warn(`The DataSources ${e.name} and ${n.name} both have a ground plane added, this will cause problems with the fallback logic, see HARP-14728 & HARP-15488.`),this.m_tileDataSources.push(e),this.m_connectingDataSources++,null===(t=this.m_sceneEnvironment)||void 0===t||t.updateBackgroundDataSource();try{if(await e.connect(),!this.m_tileDataSources.includes(e))return;e.addEventListener($.Update,(()=>{this.update()}));const t=await this.getTheme().catch((()=>{}));(null==t?void 0:t.styles)&&await e.setTheme(t),this.m_connectedDataSources.add(e.name),this.dispatchEvent({type:$.DataSourceConnect,dataSourceName:e.name}),this.update()}catch(t){Q.debug(`Failed to connect to datasource ${e.name}: ${null!==(i=t.message)&&void 0!==i?i:t}`),this.dispatchEvent({type:$.DataSourceConnect,dataSourceName:e.name,error:t})}finally{this.m_connectingDataSources--}}removeDataSource(e){const t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detach(this),this.m_visibleTiles.removeDataSource(e),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.m_sceneEnvironment.updateBackgroundDataSource(),this.update())}get visibleTileSet(){return this.m_visibleTiles}addOverlayText(e){this.m_iconTextRenderer.addOverlayText(e),this.update()}clearOverlayText(){this.m_iconTextRenderer.clearOverlayText()}lookAt(e,t,i,n){if((0,_.isGeoCoordinatesLike)(e)){const r={target:e,zoomLevel:void 0!==t?Y.MapViewUtils.calculateZoomLevelFromDistance(this,t):void 0,tilt:i,heading:n};this.lookAtImpl(r)}else"object"==typeof e&&this.lookAtImpl(e)}setCameraGeolocationAndZoom(e,t,i=0,n=0){this.geoCenter=e;let r=Math.min(Y.MapViewUtils.MAX_TILT_DEG,n);if(this.projection.type===_.ProjectionType.Spherical){const e=Math.asin(_.EarthConstants.EQUATORIAL_RADIUS/(Y.MapViewUtils.calculateDistanceToGroundFromZoomLevel(this,t)+_.EarthConstants.EQUATORIAL_RADIUS)),i=(0,c.radToDeg)(e);r=Math.min(r,i)}Y.MapViewUtils.zoomOnTargetPosition(this,0,0,t),Y.MapViewUtils.setRotation(this,i,r),this.update()}setDynamicProperty(e,t){if(e.startsWith("$"))throw new Error(`failed to update the value of the dynamic property '${e}'`);this.m_env.entries[e]=t,this.update()}removeDynamicProperty(e){if(e.startsWith("$"))throw new Error(`failed to remove the dynamic property '${e}'`);delete this.m_env.entries[e],this.update()}get animating(){return this.m_animationCount>0}beginAnimation(){0==this.m_animationCount++&&(this.update(),this.ANIMATION_STARTED_EVENT.time=Date.now(),this.dispatchEvent(this.ANIMATION_STARTED_EVENT))}endAnimation(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(this.ANIMATION_FINISHED_EVENT.time=Date.now(),this.dispatchEvent(this.ANIMATION_FINISHED_EVENT))}get cameraIsMoving(){return this.m_movementDetector.cameraIsMoving}get isDynamicFrame(){return!(0===this.taskQueue.numItemsLeft())||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_themeManager.isUpdating()||this.cameraIsMoving||this.animating||this.m_updatePending||this.m_animatedExtrusionHandler.isAnimating||this.m_iconTextRenderer.isUpdatePending||this.m_iconTextRenderer.loading||this.m_connectingDataSources>0}get pixelToWorld(){(0,x.assert)(this.m_camera instanceof n.PerspectiveCamera),(0,x.assert)(void 0!==this.m_options.fovCalculation);const e=M.CameraUtils.getFocalLength(this.m_camera);return(0,x.assert)(void 0!==e),M.CameraUtils.convertScreenToWorldSize(e,this.m_targetDistance,1)}get worldToPixel(){return 1/this.pixelToWorld}get pixelRatio(){return void 0!==this.m_pixelRatio?this.m_pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1}set pixelRatio(e){this.m_pixelRatio=e,this.renderer.getPixelRatio()!==this.pixelRatio&&this.renderer.setPixelRatio(this.pixelRatio)}set maxFps(e){this.m_options.maxFps=e,this.m_taskScheduler.maxFps=e}get maxFps(){return this.m_options.maxFps}set dynamicPixelRatio(e){this.mapRenderingManager.lowResPixelRatio=e}get dynamicPixelRatio(){return this.mapRenderingManager.lowResPixelRatio}getScreenPosition(e){(0,_.isVector3Like)(e)?ie.vector3[0].copy(e):this.projection.projectPoint(_.GeoCoordinates.fromObject(e),ie.vector3[0]);const t=this.m_screenProjector.project(ie.vector3[0]);if(void 0!==t){const{width:e,height:i}=this.getCanvasClientSize();t.x=t.x+e/2,t.y=i-(t.y+i/2)}return t}getWorldPositionAt(e,t,i){this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera);const n=this.projection.type===_.ProjectionType.Spherical?this.m_raycaster.ray.intersectSphere(this.m_sphere,ie.vector3[0]):this.m_raycaster.ray.intersectPlane(this.m_plane,ie.vector3[0]);if(null===n&&!0===i){const e=this.m_camera.getWorldDirection(ie.vector3[0]).dot(this.m_raycaster.ray.direction);return ie.vector3[0].copy(this.m_raycaster.ray.direction).multiplyScalar(this.m_camera.far/e).add(this.m_camera.position)}return n}getGeoCoordinatesAt(e,t,i){const n=this.getWorldPositionAt(e,t,i);if(!n)return null;const r=this.projection.unprojectPoint(n);return this.tileWrappingEnabled||this.projection.type!==_.ProjectionType.Planar||(r.longitude=(0,c.clamp)(r.longitude,-180,180)),r}getNormalizedScreenCoordinates(e,t){const{width:i,height:n}=this.getCanvasClientSize();return new m.Vector2(e/i*2-1,-t/n*2+1)}intersectMapObjects(e,t,i){return this.m_pickHandler.intersectMapObjects(e,t,i)}resize(e,t){var i;void 0!==(null===(i=this.camera.userData)||void 0===i?void 0:i.focalLength)&&(this.camera.userData.focalLength=void 0),this.m_renderer.setSize(e,t,!1),this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update(),this.updateLookAtSettings(),this.dispatchEvent({type:$.Resize,size:{width:e,height:t}})}renderSync(e){void 0===e&&(e=x.PerformanceTimer.now()),this.render(e)}update(){this.disposed?Q.warn("update(): MapView has been disposed of."):(this.dispatchEvent(this.UPDATE_EVENT),this.m_updatePending||(this.m_updatePending=!0,this.startRenderLoop()))}get updatePending(){return this.m_updatePending}requestUpdateIfNeeded(){this.update()}clearTileCache(e,t){if(void 0!==this.m_visibleTiles){if(void 0!==e){const i=this.getDataSourceByName(e);i&&(this.m_visibleTiles.clearTileCache(i,t),i.clearCache())}else this.m_visibleTiles.clearTileCache(void 0,t),this.m_tileDataSources.forEach((e=>e.clearCache()));void 0!==this.m_elevationProvider&&this.m_elevationProvider.clearCache()}}forEachVisibleTile(e){this.m_visibleTiles.forEachVisibleTile(e)}forEachCachedTile(e){this.m_visibleTiles.forEachCachedTile(e)}markTilesDirty(e,t){this.m_visibleTiles.markTilesDirty(e,t),this.update()}async setElevationSource(e,t,i){this.m_elevationSource&&this.m_elevationSource!==e&&this.removeDataSource(this.m_elevationSource),this.m_tileDataSources.includes(e)||await this.addDataSource(e),this.m_elevationSource=e,this.m_elevationRangeSource=t,this.m_elevationRangeSource.ready()||await this.m_elevationRangeSource.connect(),this.m_elevationProvider=i,this.dataSources.forEach((e=>{e.setEnableElevationOverlay(!0)})),this.m_tileGeometryManager.setTileUpdateCallback((e=>{(0,O.overlayOnElevation)(e)})),this.clearTileCache()}clearElevationSource(e){this.removeDataSource(e),this.m_elevationSource=void 0,this.m_elevationRangeSource=void 0,this.m_elevationProvider=void 0,this.dataSources.forEach((e=>{e.setEnableElevationOverlay(!1)})),this.m_tileGeometryManager.setTileUpdateCallback(void 0),this.clearTileCache()}get fog(){return this.m_sceneEnvironment.fog}setPostEffects(){this.mapRenderingManager.bloom.enabled=!1,this.mapRenderingManager.outline.enabled=!1,this.mapRenderingManager.vignette.enabled=!1,this.mapRenderingManager.sepia.enabled=!1,void 0!==this.m_postEffects&&(void 0!==this.m_postEffects.bloom&&(this.mapRenderingManager.bloom=this.m_postEffects.bloom),void 0!==this.m_postEffects.outline&&(this.mapRenderingManager.outline.enabled=this.m_postEffects.outline.enabled,this.mapRenderingManager.updateOutline(this.m_postEffects.outline)),void 0!==this.m_postEffects.vignette&&(this.mapRenderingManager.vignette=this.m_postEffects.vignette),void 0!==this.m_postEffects.sepia&&(this.mapRenderingManager.sepia=this.m_postEffects.sepia))}get elevationProvider(){return this.m_elevationProvider}get throttlingEnabled(){return!0===this.m_taskScheduler.throttlingEnabled}set throttlingEnabled(e){this.m_taskScheduler.throttlingEnabled=e}get shadowsEnabled(){return!0===this.m_options.enableShadows}set shadowsEnabled(e){void 0!==this.m_renderer.shadowMap&&e!==this.m_renderer.shadowMap.enabled&&(this.m_options.enableShadows=e,this.m_renderer.shadowMap.enabled=e,this.m_renderer.shadowMap.type=r.PCFSoftShadowMap,this.clearTileCache())}extractAttitude(){const e=this.m_camera,t=this.projection,i=ie.vector3[1],n=ie.transform[0],r=ie.matrix4[1];i.setFromMatrixPosition(e.matrixWorld),t.localTangentSpace(this.m_targetGeoPos,n),r.makeBasis(n.xAxis,n.yAxis,n.zAxis),ie.matrix4[0].copy(r).invert().multiply(e.matrixWorld),n.xAxis.setFromMatrixColumn(ie.matrix4[0],0),n.yAxis.setFromMatrixColumn(ie.matrix4[0],1),n.zAxis.setFromMatrixColumn(ie.matrix4[0],2);let s=0,o=0,a=0;const l=n.zAxis.dot(i.set(0,0,1));return l<1-1e-10?l>1e-10-1?(s=Math.atan2(n.zAxis.x,-n.zAxis.y),o=Math.acos(n.zAxis.z),a=Math.atan2(n.xAxis.x,n.yAxis.z)):(s=-Math.atan2(-n.yAxis.x,n.xAxis.x),o=180,a=0):(s=Math.atan2(-n.yAxis.x,n.xAxis.x),o=0,a=0),{yaw:s,pitch:o,roll:a}}lookAtImpl(e){var t,i;const n=this.projection,r=this.camera,s=Math.min(null!==(t=e.tilt)&&void 0!==t?t:this.tilt,Y.MapViewUtils.MAX_TILT_DEG),o=-(null!==(i=e.heading)&&void 0!==i?i:this.heading),a=void 0!==e.zoomLevel?Y.MapViewUtils.calculateDistanceFromZoomLevel(this,(0,c.clamp)(e.zoomLevel,this.m_minZoomLevel,this.m_maxZoomLevel)):e.distance,l=e.target?_.GeoCoordinates.fromObject(e.target):void 0;if(e.bounds)(0,L.fitLookAtBounds)({target:this.target,camera:this.camera,cameraSettings:this,projection:this.projection,maxZoomLevel:this.maxZoomLevel,viewportSize:this.m_renderer.getSize(ie.vector2[0]),tileWrapping:this.tileWrappingEnabled},{bounds:e.bounds,target:l,distance:a,yaw:o,tilt:s,padding:e.padding});else{const e=null!=l?l:this.target;Y.MapViewUtils.getCameraRotationAtTarget(n,e,o,s,r.quaternion);const t=null!=a?a:this.m_targetDistance;Y.MapViewUtils.getCameraPositionFromTarget(e,t,o,s,n,r.position),r.updateMatrixWorld(!0)}this.updateLookAtSettings(),this.update()}updatePolarDataSource(){const e=this.m_polarDataSource;if(!0===this.m_enablePolarDataSource&&void 0!==e){const t=this.getDataSourceByName(e.name);this.projection.type===_.ProjectionType.Spherical?void 0===t&&this.addDataSource(e):void 0!==t&&this.removeDataSource(e)}}updateCameras(e){var t;this.m_camera.updateMatrixWorld(!1),this.updateLookAtSettings();const{width:i,height:n}=this.m_renderer.getSize(ie.vector2[0]);this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:i/n,this.setFovOnCamera(this.m_options.fovCalculation,n);const r=this.projection.getScaleFactor(this.camera.position),s=r*this.m_tileDataSources.reduce(((e,t)=>Math.max(e,t.maxGeometryHeight)),0),o=r*this.m_tileDataSources.reduce(((e,t)=>Math.min(e,t.minGeometryHeight)),0);Object.assign(this.m_viewRanges,void 0===e?this.m_visibleTiles.updateClipPlanes(s,o):e),this.m_camera.near=this.m_viewRanges.near,this.m_camera.far=this.m_viewRanges.far,this.m_camera.updateProjectionMatrix(),this.m_rteCamera.copy(this.m_camera),this.m_rteCamera.position.setScalar(0),this.m_rteCamera.updateMatrixWorld(!0),null===(t=this.m_iconTextRenderer)||void 0===t||t.updateCamera(),this.m_screenProjector.update(this.camera,i,n),this.updateEnv(),this.m_sceneEnvironment.update()}updateLookAtSettings(){let{target:e,distance:t,final:i}=Y.MapViewUtils.getTargetAndDistance(this.projection,this.camera,this.elevationProvider);i||this.update(),this.geoMaxBounds&&({target:e,distance:t}=Y.MapViewUtils.constrainTargetAndDistanceToViewBounds(e,t,this)),this.m_targetWorldPos.copy(e),this.m_targetGeoPos=this.projection.unprojectPoint(this.m_targetWorldPos),this.m_targetDistance=t,this.m_zoomLevel=Y.MapViewUtils.calculateZoomLevelFromDistance(this,this.m_targetDistance);const{yaw:n,pitch:r,roll:s}=this.extractAttitude();this.m_yaw=n,this.m_pitch=r,this.m_roll=s}updateEnv(){this.m_env.entries.$zoom=this.m_zoomLevel,this.m_env.entries.$shouldAntialiasRasterTile=this.m_zoomLevel%1!=0||0!==this.m_yaw||0!==this.m_pitch||0!==this.m_roll,this.m_env.entries.$pixelToMeters=this.pixelToWorld,this.m_env.entries.$frameNumber=this.m_frameNumber}ndcToView(e,t){return t.set(e.x,e.y,e.z).applyMatrix4(this.camera.projectionMatrixInverse).applyMatrix4(this.m_rteCamera.matrixWorld),t}renderLoop(e){if(!0!==this.m_options.synchronousRendering&&!this.disposed){if(0===this.maxFps)this.render(e);else{const t=3,i=1e3/this.maxFps;e>=(void 0===this.m_previousFrameTimeStamp?0:this.m_previousFrameTimeStamp)+i-t&&this.render(e)}this.isDynamicFrame?this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame):this.m_animationFrameHandle=void 0}}startRenderLoop(){void 0!==this.m_animationFrameHandle||this.m_options.synchronousRendering||(this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame))}getEnabledTileDataSources(){const e=[];for(const t of this.m_tileDataSources)this.isDataSourceEnabled(t)&&e.push(t);return e}render(e){if(this.m_drawing)return;if(this.disposed)return void Q.warn("render(): MapView has been disposed of.");let t;this.RENDER_EVENT.time=e,this.dispatchEvent(this.RENDER_EVENT),this.m_tileObjectRenderer.prepareRender(),++this.m_frameNumber;const i=X.PerformanceStatistics.instance,n=i.enabled;if(n){if(t=i.currentFrame,void 0!==this.m_previousFrameTimeStamp){const i=e-this.m_previousFrameTimeStamp;t.setValue("render.fps",1e3/i)}i.storeAndClearFrameInfo(),t.setValue("renderCount.frameNumber",this.m_frameNumber)}let r,s,o,a,l,c;if(this.m_previousFrameTimeStamp=e,this.m_renderer.info.reset(),this.m_updatePending=!1,this.m_thisFrameTilesChanged=void 0,this.m_drawing=!0,this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),this.updateCameras(),this.m_renderer.clear(),this.m_sceneRoot.children.length=0,this.m_overlaySceneRoot.children.length=0,n&&(r=x.PerformanceTimer.now()),!this.lockVisibleTileSet){const e=this.m_visibleTiles.updateRenderList(this.storageLevel,Math.floor(this.zoomLevel),this.getEnabledTileDataSources(),this.m_frameNumber,this.m_elevationRangeSource);e.viewRangesChanged&&this.updateCameras(e.viewRanges)}n&&(s=x.PerformanceTimer.now());const h=this.m_visibleTiles.dataSourceTileList;if(h.forEach((({zoomLevel:e,renderedTiles:t})=>{t.forEach((t=>{this.m_tileObjectRenderer.render(t,e,this.zoomLevel,this.m_camera.position,this.m_sceneRoot),t.frameNumLastVisible=this.m_frameNumber}))})),this.m_mapAnchors.update(this.projection,this.camera.position,this.m_sceneRoot,this.m_overlaySceneRoot),this.m_animatedExtrusionHandler.update(this.zoomLevel),void 0!==t&&(t.addValue("renderCount.numTilesRendered",0),t.addValue("renderCount.numTilesVisible",0),t.addValue("renderCount.numTilesLoading",0),h.forEach((({zoomLevel:e,renderedTiles:i,visibleTiles:n,numTilesLoading:r})=>{t.addValue("renderCount.numTilesRendered",i.size),t.addValue("renderCount.numTilesVisible",n.length),t.addValue("renderCount.numTilesLoading",r)}))),this.m_movementDetector.checkCameraMoved(this,e)){const{latitude:e,longitude:t,altitude:i}=this.geoCenter;this.dispatchEvent({type:$.CameraPositionChanged,latitude:e,longitude:t,altitude:i,yaw:this.m_yaw,pitch:this.m_pitch,roll:this.m_roll,tilt:this.tilt,heading:this.heading,zoom:this.zoomLevel})}const u=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_rteCamera;if(this.renderLabels&&!this.m_pointOfView&&this.m_iconTextRenderer.placeText(h,e),n&&(o=x.PerformanceTimer.now()),this.mapRenderingManager.render(this.m_renderer,this.m_scene,u,!this.isDynamicFrame),n&&(a=x.PerformanceTimer.now()),this.renderLabels&&!this.m_pointOfView&&this.m_iconTextRenderer.renderText(this.m_viewRanges.maximum),this.m_overlaySceneRoot.children.length>0&&this.m_renderer.render(this.m_overlayScene,u),n&&(l=x.PerformanceTimer.now()),this.m_visibleTiles.disposePendingTiles(),this.m_drawing=!1,this.checkCopyrightUpdates(),void 0!==this.m_taskSchedulerTimeout&&clearTimeout(this.m_taskSchedulerTimeout),this.m_taskSchedulerTimeout=setTimeout((()=>{this.m_taskSchedulerTimeout=void 0,this.m_taskScheduler.processPending(e)}),0),void 0!==t){c=x.PerformanceTimer.now();const n=c-e;t.setValue("render.setupTime",r-e),t.setValue("render.cullTime",s-r),t.setValue("render.textPlacementTime",o-s),t.setValue("render.drawTime",a-o),t.setValue("render.textDrawTime",l-a),t.setValue("render.cleanupTime",c-l),t.setValue("render.frameRenderTime",n),t.setValue("render.fullFrameTime",n),t.setValue("render.geometryCreationTime",0),i.addWebGLInfo(this.m_renderer.info),i.addMemoryInfo()}this.DID_RENDER_EVENT.time=e,this.dispatchEvent(this.DID_RENDER_EVENT),this.isDynamicFrame||this.dispatchEvent(this.FRAME_COMPLETE_EVENT)}setupCamera(){(0,x.assert)(void 0!==this.m_visibleTiles),this.m_options.target=_.GeoCoordinates.fromObject((0,x.getOptionValue)(this.m_options.target,re.target)),this.m_options.target.altitude=0,this.m_options.tilt=(0,x.getOptionValue)(this.m_options.tilt,re.tilt),this.m_options.heading=(0,x.getOptionValue)(this.m_options.heading,re.heading),this.m_options.zoomLevel=(0,x.getOptionValue)(this.m_options.zoomLevel,re.zoomLevel),this.lookAtImpl(this.m_options);const{width:e,height:t}=this.getCanvasClientSize();this.resize(e,t)}createVisibleTileSet(){(0,x.assert)(void 0!==this.m_tileGeometryManager),this.m_visibleTiles&&(this.m_visibleTiles.clearTileCache(),this.m_visibleTiles.disposePendingTiles());const e=void 0===this.m_enableMixedLod?this.projection.type===_.ProjectionType.Spherical:this.m_enableMixedLod;return this.m_visibleTiles=new Z.VisibleTileSet(new I.FrustumIntersection(this.m_camera,this,this.m_visibleTileSetOptions.extendedFrustumCulling,this.m_tileWrappingEnabled,e,this.m_lodMinTilePixelSize),this.m_tileGeometryManager,this.m_visibleTileSetOptions),this.m_visibleTiles}movementStarted(){this.m_iconTextRenderer.movementStarted(),this.MOVEMENT_STARTED_EVENT.time=Date.now(),this.dispatchEvent(this.MOVEMENT_STARTED_EVENT)}movementFinished(){this.m_iconTextRenderer.movementFinished(),this.MOVEMENT_FINISHED_EVENT.time=Date.now(),this.dispatchEvent(this.MOVEMENT_FINISHED_EVENT),this.animating||(void 0!==this.m_movementFinishedUpdateTimerId&&clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=setTimeout((()=>{this.m_movementFinishedUpdateTimerId=void 0,this.update()}),0))}checkIfTilesChanged(){if(void 0!==this.m_thisFrameTilesChanged)return this.m_thisFrameTilesChanged;const e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach((({dataSource:e,renderedTiles:i})=>{i.forEach((i=>{t.push(e.name+"-"+i.tileKey.mortonCode())}))})),t.sort();const i=t.join("#");return i!==this.m_lastTileIds?(this.m_lastTileIds=i,this.m_thisFrameTilesChanged=!0):this.m_thisFrameTilesChanged=!1,this.m_thisFrameTilesChanged}checkCopyrightUpdates(){if(!this.checkIfTilesChanged())return;const e=this.getRenderedTilesCopyrightInfo();if(e!==this.m_copyrightInfo){if(e.length===this.m_copyrightInfo.length){let t=!0;for(let i=0;i<e.length;i++){const n=e[i],r=this.m_copyrightInfo[i];if(n.label!==r.label){t=!1;break}}if(t)return}this.m_copyrightInfo=e,this.dispatchEvent(this.COPYRIGHT_CHANGED_EVENT)}}getRenderedTilesCopyrightInfo(){let e=[];for(const t of this.m_visibleTiles.dataSourceTileList)for(const i of t.renderedTiles.values()){const t=i.copyrightInfo;void 0!==t&&0!==t.length&&(e=P.CopyrightInfo.mergeArrays(e,t))}return e}setupStats(e){new X.PerformanceStatistics(e,1e3)}setupRenderer(e){var t;this.m_scene.add(this.m_sceneRoot),this.m_overlayScene.add(this.m_overlaySceneRoot),this.shadowsEnabled=null!==(t=this.m_options.enableShadows)&&void 0!==t&&t,e.setupRenderer()}createTextRenderer(){return new U.IconTextRenderer(new V.MapViewState(this,this.checkIfTilesChanged.bind(this)),this.m_screenProjector,this.m_imageRepo,this.m_textureCache,this.m_renderer,this.m_options)}setFovOnCamera(e,t){const i=(0,c.degToRad)(e.fov);if("fixed"===e.type)return void M.CameraUtils.setVerticalFov(this.m_camera,i,t);let n=M.CameraUtils.getFocalLength(this.m_camera);void 0===n&&(M.CameraUtils.setVerticalFov(this.m_camera,i,t),n=M.CameraUtils.getFocalLength(this.m_camera)),M.CameraUtils.setFocalLength(this.m_camera,n,t)}getCanvasClientSize(){let e,t;const{clientWidth:i,clientHeight:n}=this.canvas;if(i>0&&n>0)e=i,t=n;else{const i=this.m_renderer.getPixelRatio();e=Math.round(this.canvas.width/i),t=Math.round(this.canvas.height/i)}return 0!==e&&0!==t||(e=t=1),{width:e,height:t}}updateIconTextRenderSettings(e){this.disableFading=e.disableFading,this.iconTextRenderer.enableDuplicateDetection=e.enableDuplicateDetection,this.iconTextRenderer.enableCloseProximityDetection=e.enableCloseProximityDetection,this.iconTextRenderer.enableViewDistanceChecks=e.enableViewDistanceChecks,this.iconTextRenderer.enableVisibilityChecks=e.enableVisibilityChecks}}t.MapView=se},4247:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewAtmosphere=t.AtmosphereLightMode=void 0;const n=i(2479),r=i(6271),s=i(8817),o=i(5814),a=i(977),l=i(8282),c=i(5971),h=i(5448),u=i(6815),d=i(5269),m=i(2616),p=i(4250),f=i(4342),g=i(9978);var v,_,y;!function(e){e[e.Ground=1]="Ground",e[e.Sky=2]="Sky",e[e.SkyAndGround=3]="SkyAndGround"}(v||(v={})),function(e){e[e.ScatteringShader=0]="ScatteringShader",e[e.SimpleColor=1]="SimpleColor",e[e.Wireframe=2]="Wireframe"}(_||(_={})),function(e){e[e.LightOverhead=0]="LightOverhead",e[e.LightDynamic=1]="LightDynamic"}(y=t.AtmosphereLightMode||(t.AtmosphereLightMode={}));const x={clipPlanes:{near:0,far:0}};class S{static isPresent(e){for(const t of e.children)if(t.name===S.SkyAtmosphereUserName||t.name===S.GroundAtmosphereUserName)return!0;return!1}constructor(e,t,i,n,r,s=v.SkyAndGround,o=_.ScatteringShader){this.m_mapAnchors=e,this.m_sceneCamera=t,this.m_projection=i,this.m_rendererCapabilities=n,this.m_updateCallback=r,this.m_atmosphereVariant=s,this.m_materialVariant=o,this.m_enabled=!0,this.m_clipPlanesEvaluator=new g.TiltViewClipPlanesEvaluator(.025*m.EarthConstants.EQUATORIAL_RADIUS,0,1,.05,1e7),this.m_lightDirection=new u.Vector3(0,1,0),this.m_atmosphereVariant&v.Sky&&this.createSkyGeometry(),this.m_atmosphereVariant&v.Ground&&this.createGroundGeometry(),this.addToMapAnchors(this.m_mapAnchors)}get skyMesh(){return this.m_skyMesh}get groundMesh(){return this.m_groundMesh}set enabled(e){if(this.disposed)return;if(this.m_enabled===e)return;this.m_enabled=e;const t=S.isPresent(this.m_mapAnchors);e&&!t?this.addToMapAnchors(this.m_mapAnchors):!e&&t&&this.removeFromMapAnchors(this.m_mapAnchors)}get enabled(){return this.m_enabled}set lightMode(e){if(this.m_materialVariant!==_.ScatteringShader)return;const t=e===y.LightDynamic;void 0!==this.m_groundMaterial&&this.m_groundMaterial.setDynamicLighting(t),void 0!==this.m_skyMaterial&&this.m_skyMaterial.setDynamicLighting(t)}dispose(){var e,t,i,n;this.enabled&&(this.enabled=!1),null===(e=this.m_skyMaterial)||void 0===e||e.dispose(),null===(t=this.m_groundMaterial)||void 0===t||t.dispose(),null===(i=this.m_skyGeometry)||void 0===i||i.dispose(),null===(n=this.m_groundGeometry)||void 0===n||n.dispose(),this.m_skyGeometry=void 0,this.m_groundGeometry=void 0,this.m_skyMaterial=void 0,this.m_groundMaterial=void 0,this.m_skyMesh=void 0,this.m_groundMesh=void 0}reset(e){}get disposed(){return void 0===this.m_skyMesh&&void 0===this.m_groundMesh}addToMapAnchors(e){(0,f.assert)(!S.isPresent(e),"Atmosphere already added"),void 0!==this.m_skyMesh&&e.add(b(this.m_skyMesh,Number.MIN_SAFE_INTEGER)),void 0!==this.m_groundMesh&&e.add(b(this.m_groundMesh,Number.MAX_SAFE_INTEGER)),this.m_updateCallback&&this.m_updateCallback()}removeFromMapAnchors(e){if(!S.isPresent(e))return;let t=!1;void 0!==this.m_skyMesh&&(e.remove(this.m_skyMesh),t=!0),void 0!==this.m_groundMesh&&(e.remove(this.m_groundMesh),t=!0),t&&this.m_updateCallback&&this.m_updateCallback()}createSkyGeometry(){this.m_projection.type===m.ProjectionType.Spherical?this.m_skyGeometry=new o.SphereGeometry(1.025*m.EarthConstants.EQUATORIAL_RADIUS,256,256):this.m_skyGeometry=new s.PlaneGeometry(200,200),this.m_skyGeometry.translate(0,0,0),this.m_materialVariant===_.ScatteringShader?this.m_skyMaterial=new p.SkyAtmosphereMaterial({rendererCapabilities:this.m_rendererCapabilities}):this.m_materialVariant===_.SimpleColor?this.m_skyMaterial=new a.MeshBasicMaterial({color:new c.Color(12908781),opacity:.4,transparent:!1,depthTest:!0,depthWrite:!1,side:r.BackSide,blending:r.NormalBlending,fog:!1}):this.m_skyMaterial=new l.MeshStandardMaterial({color:8388607,depthTest:!1,depthWrite:!1,normalScale:new h.Vector2(-1,-1),side:r.BackSide,wireframe:!0}),this.m_skyMesh=new d.Mesh(this.m_skyGeometry,this.m_skyMaterial),this.m_skyMesh.name=S.SkyAtmosphereUserName,this.setupSkyForRendering()}createGroundGeometry(){this.m_projection.type===m.ProjectionType.Spherical?this.m_groundGeometry=new o.SphereGeometry(1.0001*m.EarthConstants.EQUATORIAL_RADIUS,256,256):this.m_groundGeometry=new s.PlaneGeometry(200,200),this.m_groundGeometry.translate(0,0,0),this.m_materialVariant===_.ScatteringShader?this.m_groundMaterial=new p.GroundAtmosphereMaterial({rendererCapabilities:this.m_rendererCapabilities}):this.m_materialVariant===_.SimpleColor?this.m_groundMaterial=new a.MeshBasicMaterial({color:new c.Color(50687),opacity:.4,transparent:!0,depthTest:!1,depthWrite:!1,side:r.FrontSide,blending:r.NormalBlending,fog:!1}):this.m_groundMaterial=new l.MeshStandardMaterial({color:1149338,depthTest:!0,depthWrite:!1,side:r.FrontSide,wireframe:!0}),this.m_groundMesh=new d.Mesh(this.m_groundGeometry,this.m_groundMaterial),this.m_groundMesh.name=S.GroundAtmosphereUserName,this.setupGroundForRendering()}setupSkyForRendering(){if(void 0===this.m_skyMesh)return;let e;e=this.m_materialVariant!==_.ScatteringShader?(e,t)=>{this.overrideClipPlanes(e)}:(e,t)=>{this.overrideClipPlanes(e),(0,f.assert)(t instanceof p.SkyAtmosphereMaterial);const i=this.m_skyMaterial;i.updateUniforms(i,this.m_skyMesh,e,this.m_lightDirection)},(0,f.assert)(void 0!==this.m_skyMaterial),this.m_skyMesh.onBeforeRender=(t,i,n,r,s,o)=>{e(n,s)},this.m_skyMesh.onAfterRender=(e,t,i,n,r,s)=>{this.revertClipPlanes(i)}}setupGroundForRendering(){void 0!==this.m_groundMesh&&this.m_materialVariant===_.ScatteringShader&&((0,f.assert)(void 0!==this.m_groundMaterial),this.m_groundMesh.onBeforeRender=(e,t,i,n,r,s)=>{(0,f.assert)(r instanceof p.GroundAtmosphereMaterial);const o=this.m_groundMaterial;o.updateUniforms(o,this.m_groundMesh,i,this.m_lightDirection)})}overrideClipPlanes(e){const t=this.m_sceneCamera;x.clipPlanes.near=t.near,x.clipPlanes.far=t.far;const i=this.m_clipPlanesEvaluator.evaluateClipPlanes(this.m_sceneCamera,this.m_projection);(0,f.assert)(e instanceof n.PerspectiveCamera);const r=e;r.near=i.near,r.far=i.far+.1*m.EarthConstants.EQUATORIAL_RADIUS,r.updateProjectionMatrix()}revertClipPlanes(e){(0,f.assert)(e instanceof n.PerspectiveCamera);const t=e;t.near=x.clipPlanes.near,t.far=x.clipPlanes.far,t.updateProjectionMatrix()}}function b(e,t){const i=e;return i.renderOrder=t,i.pickable=!1,i.anchor=new u.Vector3(0,0,0),i}t.MapViewAtmosphere=S,S.SkyAtmosphereUserName="SkyAtmosphere",S.GroundAtmosphereUserName="GroundAtmosphere"},3011:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewEnvironment=t.DEFAULT_CLEAR_COLOR=void 0;const n=i(2616),r=i(8023),s=i(7610),o=i(4342),a=i(6815),l=i(4307),c=i(3334),h=i(2754),u=i(5863),d=i(3977),m=i(3061),p=i(7775),f=i(5640),g=o.LoggerManager.instance.create("MapViewEnvironment");t.DEFAULT_CLEAR_COLOR=16777215;const v={vector3:[new a.Vector3,new a.Vector3,new a.Vector3],frustumPoints:[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3]};t.MapViewEnvironment=class{constructor(e,t){this.m_mapView=e,this.m_lastZoomLevelOnUpdate=NaN,this.onMapViewContextRestored=e=>{void 0!==this.m_mapView.renderer&&this.m_mapView.getTheme().then((e=>{this.updateClearColor(e.clearColor,e.clearAlpha,e.definitions),this.m_mapView.update()}))},this.applyClearColorAndAlpha=()=>{const e=this.evaluateClearColor(),t=r.Expr.isExpr(this.m_clearAlpha)?this.m_clearAlpha.evaluate(this.m_mapView.env,r.ExprScope.Dynamic):this.m_clearAlpha;void 0!==this.m_mapView.renderer&&this.m_mapView.renderer.setClearColor(e,t)},this.m_fog=new m.MapViewFog(this.m_mapView.scene),!1!==t.addBackgroundDatasource&&(this.m_backgroundDataSource=new u.BackgroundDataSource(t.backgroundTilingScheme),this.m_mapView.addDataSource(this.m_backgroundDataSource)),this.m_mapView.addEventListener(d.MapViewEventNames.ContextRestored,this.onMapViewContextRestored),this.updateClearColor()}get lights(){var e;return null!==(e=this.m_createdLights)&&void 0!==e?e:[]}get fog(){return this.m_fog}updateBackgroundDataSource(){this.m_backgroundDataSource&&this.m_backgroundDataSource.updateStorageLevelOffset()}update(){this.m_lastZoomLevelOnUpdate!==this.m_mapView.zoomLevel&&(this.m_lastZoomLevelOnUpdate=this.m_mapView.zoomLevel,this.applyClearColorAndAlpha()),this.m_fog.update(this.m_mapView,this.m_mapView.viewRanges.maximum),this.m_skyBackground&&this.m_mapView.projection.type===n.ProjectionType.Planar&&this.m_skyBackground.updateCamera(this.m_mapView.camera),this.updateLights()}updateClearColor(e,i,n){if(void 0===e)this.m_clearColor=t.DEFAULT_CLEAR_COLOR;else{const t=r.Expr.fromJSON(e,n);this.m_clearColor=t.isDynamic()?t:t.evaluate(this.m_mapView.env,r.ExprScope.Value)}if(void 0===i)this.m_clearAlpha=i;else{const e=r.Expr.fromJSON(i,n);this.m_clearAlpha=e.isDynamic()?e:e.evaluate(this.m_mapView.env,r.ExprScope.Value)}this.applyClearColorAndAlpha()}evaluateClearColor(){let e;if(r.Expr.isExpr(this.m_clearColor)){const t=this.m_clearColor.evaluate(this.m_mapView.env,r.ExprScope.Dynamic);e=t instanceof s.RGBA?t.getHex():t}else e=this.m_clearColor;return e}updateSkyBackground(e){e?this.setSkyBackground(e):this.removeSkyBackGround()}updateLighting(e){var t;this.m_createdLights&&this.m_createdLights.forEach((e=>{this.m_mapView.scene.remove(e)})),null===(t=this.m_overlayCreatedLights)||void 0===t||t.forEach((e=>{this.m_mapView.overlayScene.remove(e),e instanceof l.DirectionalLight&&this.m_mapView.overlayScene.remove(e.target)})),void 0!==e&&(this.m_createdLights=[],this.m_overlayCreatedLights=[],e.forEach((e=>{const t=(0,f.createLight)(e);if(!t)return void g.warn(`MapView: failed to create light ${e.name} of type ${e.type}`);if(this.m_mapView.scene.add(t),t.isDirectionalLight){const e=t;this.m_mapView.scene.add(e.target)}this.m_createdLights.push(t);const i=t.clone();this.m_mapView.overlayScene.add(i),i instanceof l.DirectionalLight&&this.m_mapView.overlayScene.add(i.target.clone())})))}updateLights(){if(!this.m_mapView.shadowsEnabled||this.m_mapView.projection.type===n.ProjectionType.Spherical||void 0===this.m_createdLights||0===this.m_createdLights.length)return;const e=[{x:-1,y:-1,z:-1},{x:1,y:-1,z:-1},{x:-1,y:1,z:-1},{x:1,y:1,z:-1},{x:-1,y:-1,z:1},{x:1,y:-1,z:1},{x:-1,y:1,z:1},{x:1,y:1,z:1}].map(((e,t)=>this.m_mapView.ndcToView(e,v.frustumPoints[t])));this.m_createdLights.forEach((t=>{const i=t;if(!0===i.isDirectionalLight){const t=v.vector3[0];t.copy(i.target.position),t.sub(i.position),t.normalize();const r=v.vector3[1];this.m_mapView.projection.type===n.ProjectionType.Planar&&r.set(0,0,-1);const s=this.m_mapView.tilt,o=this.m_mapView.targetDistance*Math.cos((0,c.degToRad)(s))/r.dot(t);i.target.position.copy(this.m_mapView.worldTarget).sub(this.m_mapView.camera.position),i.position.copy(this.m_mapView.worldTarget),i.position.addScaledVector(t,-o),i.position.sub(this.m_mapView.camera.position),i.updateMatrixWorld(),i.shadow.updateMatrices(i);const a=i.shadow.camera,l=e.map((e=>this.viewToLightSpace(e.clone(),a))),u=new h.Box3;l.forEach((e=>{u.expandByPoint(e)})),a.left=u.min.x,a.right=u.max.x,a.top=u.max.y,a.bottom=u.min.y,a.near=.95*-u.max.z,a.far=-u.min.z,a.updateProjectionMatrix()}}))}removeSkyBackGround(){this.m_mapView.scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.dispose(),this.m_skyBackground=void 0)}setSkyBackground(e){var t;this.m_skyBackground?this.m_skyBackground.updateTexture(e,this.m_mapView.projection.type):this.m_skyBackground=new p.SkyBackground(e,this.m_mapView.projection.type,this.m_mapView.camera),this.m_mapView.scene.background=null===(t=this.m_skyBackground)||void 0===t?void 0:t.texture}viewToLightSpace(e,t){return e.applyMatrix4(t.matrixWorldInverse)}}},3061:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewFog=void 0;const n=i(3334),r=i(5269),s=i(7436),o=i(4250),a=i(4342);t.MapViewFog=class{constructor(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new s.Fog(0),this.m_fogIsDefined=!1}set enabled(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()}get enabled(){return this.m_enabled}reset(e){this.m_cachedFog=e,void 0!==e&&void 0!==e.color&&void 0!==e.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.color),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())}update(e,t){if(null!==this.m_scene.fog&&void 0!==this.m_cachedFog&&this.m_cachedFog&&void 0!==this.m_cachedFog.startRatio&&(void 0!==e.camera.far||void 0!==t)){const i=void 0!==t?t:e.camera.far,r=1,s=0,o=this.m_cachedFog.startRatio,l=1;(0,a.assert)(o<=l);const c=Math.abs(Math.cos(e.tilt)),h=a.MathUtils.smoothStep(r,s,c);this.m_fog.near=(0,n.lerp)(i*o,i,1-h),this.m_fog.far=(0,n.lerp)(i*l,i,h),this.m_fog.near=Math.min(this.m_fog.near,e.camera.far),this.m_fog.far=Math.min(this.m_fog.far,e.camera.far)}}add(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)}remove(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)}setFogInRawShaderMaterials(e){this.m_scene.traverse((t=>{if(t instanceof r.Mesh){const i=t.material;!("fog"in i)||i instanceof o.HighPrecisionLineMaterial||i.fog===e||(i.fog=e,i instanceof o.RawShaderMaterial&&i.invalidateFog())}}))}}},5146:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Squares=t.Circles=t.MapViewPoints=void 0;const n=i(5448),r=i(6815),s=i(4994);class o extends s.Points{constructor(){super(...arguments),this.enableRayTesting=!0}raycast(e,t){if(!this.enableRayTesting)return;const i=this.geometry,n=this.matrixWorld,s=a(e.ray.origin.clone().add(e.ray.direction).project(e.camera),e),o=(i,r)=>{const o=function(e,t,i){const n=e.clone().applyMatrix4(t),r=n.distanceTo(i.ray.origin),s=n.project(i.camera),o=s.x<1&&s.x>-1&&s.y<1&&s.y>-1;return o?{absoluteScreenPosition:a(s,i),pointIsOnScreen:o,distance:r}:{pointIsOnScreen:o}}(i,n,e);o.pointIsOnScreen&&this.testPoint(i,o.absoluteScreenPosition,s,r,o.distance,t)},l=new r.Vector3,c=i.index,h=i.attributes.position.array;if(null!==c){const e=c.array;for(let t=0,i=e.length;t<i;t++)o(l.fromArray(h,3*e[t]),t)}else for(let e=0,t=h.length/3;e<t;e++)o(l.fromArray(h,3*e),e)}}function a(e,t){return new n.Vector2(e.x+1,1-e.y).divideScalar(2).multiply(t.canvasSize).ceil()}t.MapViewPoints=o,t.Circles=class extends o{testPoint(e,t,i,n,r,s){const o=t.x-i.x,a=t.y-i.y;Math.sqrt(o*o+a*a)<=this.material.size/2&&s.push({point:e,distance:r,index:n,object:this})}},t.Squares=class extends o{testPoint(e,t,i,n,r,s){const o=t.x-i.x,a=t.y-i.y,l=this.material.size/2;Math.abs(o)<=l&&Math.abs(a)<=l&&s.push({point:e,distance:r,index:n,object:this})}}},19:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewTaskScheduler=void 0;const n=i(4342),r=i(2356),s=i(3977),o=i(8015),a={type:"update"};class l extends r.EventDispatcher{constructor(e=60){super(),this.m_maxFps=e,this.m_throttlingEnabled=!1,this.m_taskQueue=new n.TaskQueue({groups:[s.TileTaskGroups.FETCH_AND_DECODE,s.TileTaskGroups.CREATE],prioSortFn:(e,t)=>e.getPriority()-t.getPriority()}),this.maxFps=e}set maxFps(e){this.m_maxFps=e<=0?60:e}get maxFps(){return this.m_maxFps}get taskQueue(){return this.m_taskQueue}get throttlingEnabled(){return!0===this.m_throttlingEnabled}set throttlingEnabled(e){this.m_throttlingEnabled=e}requestUpdate(){this.dispatchEvent(a)}processPending(e){const t=o.PerformanceStatistics.instance,i=t.enabled?t.currentFrame:void 0;let r;t.enabled&&(r=n.PerformanceTimer.now()),this.m_taskQueue.update();let a=this.taskQueue.numItemsLeft();if(null==i||i.setValue("TaskScheduler.numPendingTasks",a),this.throttlingEnabled){let l=this.spaceInFrame(e);l=l>2?l-2:l,null==i||i.setValue("TaskScheduler.estimatedAvailableTime",l);let c=0;for(;l>0&&a>0;){function h(e){var t,i;return l-=null!==(i=null===(t=e.estimatedProcessTime)||void 0===t?void 0:t.call(e))&&void 0!==i?i:2,l>0||1===c}c++,[s.TileTaskGroups.CREATE,s.TileTaskGroups.FETCH_AND_DECODE].forEach((e=>{this.m_taskQueue.numItemsLeft(e)&&this.m_taskQueue.processNext(e,h)})),a=this.m_taskQueue.numItemsLeft()}a=this.m_taskQueue.numItemsLeft(),a>0&&(null==i||i.setValue("TaskScheduler.pendingTasksNotYetProcessed",a),this.requestUpdate())}else this.m_taskQueue.processNext(s.TileTaskGroups.CREATE,void 0,this.m_taskQueue.numItemsLeft(s.TileTaskGroups.CREATE)),this.m_taskQueue.processNext(s.TileTaskGroups.FETCH_AND_DECODE,void 0,this.m_taskQueue.numItemsLeft(s.TileTaskGroups.FETCH_AND_DECODE));t.enabled&&(null==i||i.setValue("TaskScheduler.pendingTasksTime",n.PerformanceTimer.now()-r))}clearQueuedTasks(){this.m_taskQueue.clear()}spaceInFrame(e){const t=(performance||Date).now()-e;return Math.max(1e3/this.m_maxFps-t,0)}}t.MapViewTaskScheduler=l},6272:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewThemeManager=void 0;const n=i(6586);function r(e,t){return JSON.stringify(e)===JSON.stringify(t)}t.MapViewThemeManager=class{constructor(e,t,i,n){this.m_mapView=e,this.m_theme=t,this.m_imageRepo=i,this.m_uriResolver=n,this.m_isUpdating=!1,this.m_cachedCompleteTheme={},this.m_abortController=new AbortController,this.m_completeThemePromise=this.setTheme(this.m_theme)}setTheme(e,t){var i;return this.m_abortController.abort("Abort an ongoing setTheme call due to a new setTheme call"),this.m_abortController=new AbortController,this.m_isUpdating=!0,this.m_completeThemePromise=this.loadTheme(e,t,null===(i=this.m_abortController)||void 0===i?void 0:i.signal).then((e=>{var t;return this.updateTheme(e,null===(t=this.m_abortController)||void 0===t?void 0:t.signal)})).finally((()=>{this.m_isUpdating=!1})),this.m_completeThemePromise}getTheme(){return this.m_completeThemePromise}isUpdating(){return this.m_isUpdating}loadTheme(e,t,i){return"string"!=typeof e&&(0,n.isThemeLoaded)(e)?Promise.resolve(e):(0,n.load)(e,{baseUrl:t,uriResolver:this.m_uriResolver,signal:i})}async updateTheme(e,t){var i,n;const s=this.m_mapView.sceneEnvironment;if(this.m_cachedCompleteTheme.clearAlpha===e.clearAlpha&&this.m_cachedCompleteTheme.clearColor===e.clearColor||(this.m_cachedCompleteTheme.clearColor=e.clearColor,this.m_cachedCompleteTheme.clearAlpha=e.clearAlpha,s.updateClearColor(e.clearColor,e.clearAlpha,e.definitions)),r(this.m_cachedCompleteTheme.sky,e.sky)||(this.m_cachedCompleteTheme.sky=e.sky,s.updateSkyBackground(e.sky)),r(this.m_cachedCompleteTheme.fog,e.fog)||(this.m_cachedCompleteTheme.fog=e.fog,s.fog.reset(e.fog)),r(this.m_cachedCompleteTheme.lights,e.lights)||(this.m_cachedCompleteTheme.lights=e.lights,s.updateLighting(e.lights)),!r(this.m_cachedCompleteTheme.images,e.images)||!r(this.m_cachedCompleteTheme.imageTextures,e.imageTextures))try{await this.updateImages(e.images,e.imageTextures,t),this.m_cachedCompleteTheme.images=e.images,this.m_cachedCompleteTheme.imageTextures=e.imageTextures}catch(e){throw this.m_cachedCompleteTheme.images=void 0,this.m_cachedCompleteTheme.imageTextures=void 0,e}if(!r(this.m_cachedCompleteTheme.textStyles,e.textStyles)||!r(this.m_cachedCompleteTheme.defaultTextStyle,e.defaultTextStyle)||!r(this.m_cachedCompleteTheme.fontCatalogs,e.fontCatalogs))try{await this.m_mapView.iconTextRenderer.setTheme(e,t),this.m_cachedCompleteTheme.textStyles=e.textStyles,this.m_cachedCompleteTheme.defaultTextStyle=e.defaultTextStyle,this.m_cachedCompleteTheme.fontCatalogs=e.fontCatalogs}catch(e){throw this.m_cachedCompleteTheme.textStyles=void 0,this.m_cachedCompleteTheme.defaultTextStyle=void 0,this.m_cachedCompleteTheme.fontCatalogs=void 0,e}Array.isArray(e.priorities)&&(this.m_cachedCompleteTheme.priorities=e.priorities,this.m_mapView.mapAnchors.setPriorities(null!==(i=e.priorities)&&void 0!==i?i:[])),Array.isArray(e.labelPriorities)&&(this.m_cachedCompleteTheme.labelPriorities=e.labelPriorities),this.m_cachedCompleteTheme.styles=null!==(n=e.styles)&&void 0!==n?n:[],this.m_cachedCompleteTheme.definitions=e.definitions,this.m_cachedCompleteTheme.features=e.features;for(const e of this.m_mapView.dataSources)await e.setTheme(this.m_cachedCompleteTheme);return this.m_cachedCompleteTheme}async updateImages(e,t,i){if(this.m_imageRepo.iconTextManager.clear(),this.m_imageRepo.imageCache.clear(this),this.m_mapView.textureCache.evictAll(),e){for(const{url:t,atlas:n,preload:r,scalable:s=!1}of Object.values(e)){const e=this.m_imageRepo.imageCache.registerImageByUrl(this,t,void 0,s);r&&e.loadImage(),"string"==typeof n&&await this.m_imageRepo.iconTextManager.addTextureAtlas(t,n,i)}null==t||t.forEach((t=>{var i,n;const r=null!==(n=null===(i=e[t.image])||void 0===i?void 0:i.url)&&void 0!==n?n:t.image;this.m_imageRepo.iconTextManager.addImageTexture(Object.assign(Object.assign({},t),{image:r}))}))}}}},9701:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathBlockingElement=void 0;const n=i(6815),r=i(414);t.PathBlockingElement=class{constructor(e){this.points=e,this.screenSpaceLines=new Array(e.length>=2?e.length-1:0);for(let e=0;e<this.screenSpaceLines.length;e++)this.screenSpaceLines[e]=new r.Line3(new n.Vector3,new n.Vector3)}}},8881:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickHandler=t.PickObjectType=void 0;const n=i(5448),r=i(6815),s=i(8152),o=i(2616),a=i(4572),l=i(5146),c=i(6946),h=i(7979),u=i(541);var d;!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(d=t.PickObjectType||(t.PickObjectType={}));const m=new r.Vector3,p=new o.OrientedBox3;function f(e,t,i,n,r){for(const s of e.dependencies){const o=s.mortonCode();if(n.has(o))continue;n.add(o);const a=r.visibleTileSet.getCachedTile(e.dataSource,s,e.offset,r.frameNumber);void 0!==a&&i.intersectObjects(a.objects,!0,t)}}t.PickHandler=class{constructor(e,t,i=!1){this.mapView=e,this.camera=t,this.enablePickTechnique=i,this.m_pickingRaycaster=new c.PickingRaycaster(e.renderer.getSize(new n.Vector2))}intersectMapObjects(e,t,i){const r=this.mapView.getNormalizedScreenCoordinates(e,t),s=this.setupRaycaster(e,t),o=new h.PickListener(i),{clientWidth:a,clientHeight:l}=this.mapView.canvas,c=r.x*a*.5,u=r.y*l*.5,m=new n.Vector2(c,u);this.mapView.iconTextRenderer.pickIconTexts(m,((e,t)=>{const i={type:t?d.Text:d.Icon,point:m,distance:0,renderOrder:e.renderOrder,featureId:e.featureId,userData:e.userData,dataSourceName:e.dataSourceName,dataSourceOrder:e.dataSourceOrder};i.technique=this.enablePickTechnique?e.technique:void 0,o.addResult(i)}));const p=[],g=this.getIntersectedTiles(s),v=new Set;for(const{tile:e,distance:t}of g){const i=1e-4;if(o.done&&t-o.furthestResult.distance>i)break;p.length=0,s.intersectObjects(e.objects,!0,p),f(e,p,s,v,this.mapView);for(const e of p)o.addResult(this.createResult(e))}p.length=0;for(const e of this.mapView.mapAnchors.children){s.intersectObject(e,!0,p);for(const e of p)o.addResult(this.createResult(e))}return o.finish(),o.results}raycasterFromScreenPoint(e,t){return this.m_pickingRaycaster.setFromCamera(this.mapView.getNormalizedScreenCoordinates(e,t),this.camera),this.mapView.renderer.getSize(this.m_pickingRaycaster.canvasSize),this.m_pickingRaycaster}createResult(e){var t,i,n;const r=a.MapObjectAdapter.get(e.object),o={type:d.Unspecified,point:e.point,distance:e.distance,dataSourceName:null===(t=null==r?void 0:r.dataSource)||void 0===t?void 0:t.name,dataSourceOrder:null===(i=null==r?void 0:r.dataSource)||void 0===i?void 0:i.dataSourceOrder,intersection:e,tileKey:null==r?void 0:r.tileKey};if(void 0===e.object.userData||void 0===e.object.userData.feature)return o;if(this.enablePickTechnique){const t=a.MapObjectAdapter.get(e.object);o.technique=null==t?void 0:t.technique}o.renderOrder=null===(n=e.object)||void 0===n?void 0:n.renderOrder;const l=e.object.userData.feature;if(this.addObjInfo(l,e,o),o.userData){const e=(0,s.getFeatureId)(o.userData);o.featureId=0===e?void 0:e}let c;switch(l.geometryType){case s.GeometryType.Point:case s.GeometryType.Text:c=d.Point;break;case s.GeometryType.Line:case s.GeometryType.ExtrudedLine:case s.GeometryType.SolidLine:case s.GeometryType.TextPath:c=d.Line;break;case s.GeometryType.Polygon:case s.GeometryType.ExtrudedPolygon:c=d.Area;break;case s.GeometryType.Object3D:c=d.Object3D;break;default:c=d.Unspecified}return o.type=c,o}getIntersectedTiles(e){const t=new Array;return this.mapView.visibleTileSet.dataSourceTileList.forEach((i=>{i.dataSource.enablePicking&&i.renderedTiles.forEach((i=>{p.copy(i.boundingBox),p.position.sub(this.mapView.worldCenter);const n=i.computeWorldOffsetX();p.position.x+=n;const r=p.intersectsRay(e.ray);void 0!==r&&t.push({tile:i,distance:r})}))})),t.sort(((e,t)=>e.distance-t.distance)),t}addObjInfo(e,t,i){if(void 0===e.objInfos)return;if(i.intersection.object instanceof l.MapViewPoints)return void(i.userData=e.objInfos[t.index]);if(void 0===e.starts||0===e.starts.length||"number"!=typeof t.faceIndex&&void 0===t.index)return void(1===e.objInfos.length&&(i.userData=e.objInfos[0]));if(1===e.starts.length)return void(i.userData=e.objInfos[0]);const n="number"==typeof t.faceIndex?3*t.faceIndex:t.index;let r=0;for(const t of e.starts){if(t>n)break;r++}i.userData=e.objInfos[r-1]}setupRaycaster(e,t){const i=this.mapView.camera,n=this.raycasterFromScreenPoint(e,t),r=this.mapView.getWorldPositionAt(e,t,!0),s=i.position.distanceTo(r)/this.mapView.camera.getWorldDirection(m).dot(n.ray.direction);return n.params.Line.threshold=u.MapViewUtils.calculateWorldSizeByFocalLength(this.mapView.focalLength,s,1),n}}},7979:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickListener=void 0;const n=i(4342),r=i(4572);function s(e,t){var i,n;const r=null!==(i=e.dataSourceOrder)&&void 0!==i?i:0,s=null!==(n=t.dataSourceOrder)&&void 0!==n?n:0;if(r!==s)return s-r;const o=e.distance-t.distance,a=void 0!==e.renderOrder&&void 0!==t.renderOrder;return Math.abs(o)>1e-4||!a?o:t.renderOrder-e.renderOrder}t.PickListener=class{constructor(e){this.m_parameters=e,this.m_results=[],this.m_sorted=!0,this.m_finished=!0}addResult(e){var t,i,n,o,a;let l=-1;if(!(null===(t=this.m_parameters)||void 0===t?void 0:t.allowDuplicates))for(l=this.m_results.length;l--;){const t=this.m_results[l];if(t.type===e.type){const s=null===(n=r.MapObjectAdapter.get(null===(i=e.intersection)||void 0===i?void 0:i.object))||void 0===n?void 0:n.dataSource,l=null===(a=r.MapObjectAdapter.get(null===(o=t.intersection)||void 0===o?void 0:o.object))||void 0===a?void 0:a.dataSource;if(s&&l===s){const i=e.featureId;if(t.featureId===i&&(void 0!==i||e.userData&&t.userData===e.userData))break}}}l<0?(this.m_sorted=!1,this.m_finished=!1,this.m_results.push(e)):s(e,this.m_results[l])<0&&(this.m_results[l]=e,this.m_sorted=!1,this.m_finished=!1)}get done(){return!!this.maxResults&&this.m_results.length>=this.maxResults}finish(){this.sortResults(),this.maxResults&&this.m_results.length>this.maxResults&&(this.m_results.length=this.maxResults),this.m_finished=!0}get results(){return(0,n.assert)(this.m_finished,"finish() was not called before getting the results"),this.m_results}get closestResult(){return this.sortResults(),this.m_results.length>0?this.m_results[0]:void 0}get furthestResult(){return this.sortResults(),this.m_results.length>0?this.m_results[this.m_results.length-1]:void 0}get maxResults(){var e,t;const i=null!==(t=null===(e=this.m_parameters)||void 0===e?void 0:e.maxResultCount)&&void 0!==t?t:0;return i>0?i:void 0}sortResults(){if(this.m_sorted)return;const e=[],t=[];this.m_results.sort(s).forEach((i=>(0===i.distance?e:t).push(i))),this.m_results=e.concat(t),this.m_sorted=!0}}},6946:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickingRaycaster=void 0;const n=i(3216),r=i(4572);function s(e,t,i,n){if(e.layers.test(t.layers)&&e.visible){const n=r.MapObjectAdapter.get(e);n&&!n.isPickable()||e.raycast(t,i)}if(!0===n)for(const n of e.children)s(n,t,i,!0)}class o extends n.Raycaster{constructor(e){super(),this.canvasSize=e}intersectObject(e,t,i){const n=null!=i?i:[];return s(e,this,n,t),n}intersectObjects(e,t,i){const n=null!=i?i:[];for(const i of e)s(i,this,n,t);return n}}t.PickingRaycaster=o},6313:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneViewBounds=void 0;const n=i(6084),r=i(414),s=i(8333),o=i(3850),a=i(2309),l=i(6815),c=i(2616),h=i(4342),u=i(541);t.PlaneViewBounds=class{constructor(e,t,i){this.camera=e,this.projection=t,this.m_options=i,this.m_groundPlaneNormal=new l.Vector3(0,0,1),this.m_groundPlane=new o.Plane(this.m_groundPlaneNormal.clone()),(0,h.assert)(t.type===c.ProjectionType.Planar)}generate(){const e=[];if(this.addCanvasCornerIntersection(e),4===e.length)return this.createPolygon(e);this.addHorizonIntersection(e);const t=(new n.Frustum).setFromProjectionMatrix((new s.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse)),i=this.getWorldConers(this.projection);if(this.m_options.tileWrappingEnabled||[i.ne,i.nw,i.se,i.sw].forEach((i=>{this.addPointInFrustum(i,t,e)})),this.m_options.tileWrappingEnabled){const n=(new l.Vector3).subVectors(i.sw,i.se).normalize(),r=(new l.Vector3).subVectors(i.se,i.sw).normalize();[new a.Ray(i.se,n),new a.Ray(i.se,r),new a.Ray(i.ne,n),new a.Ray(i.ne,r)].forEach((i=>{this.addFrustumIntersection(i,t,e)}))}else[new r.Line3(i.sw,i.se),new r.Line3(i.ne,i.nw),new r.Line3(i.se,i.ne),new r.Line3(i.nw,i.sw)].forEach((i=>{this.addFrustumIntersection(i,t,e)}));return this.createPolygon(e)}createPolygon(e){if(e.length>2)return new c.GeoPolygon(e,!0)}getWorldConers(e){const t=e.worldExtent(0,0);return{sw:t.min,se:new l.Vector3(t.max.x,t.min.y,0),nw:new l.Vector3(t.min.x,t.max.y,0),ne:t.max}}addNDCRayIntersection(e,t){e.forEach((e=>{const i=u.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},e[0],e[1]);i&&this.validateAndAddToGeoPolygon(i,t)}))}addHorizonIntersection(e){const t=this.getVerticalHorizonPositionInNDC();t&&this.addNDCRayIntersection([[-1,t],[1,t]],e)}addCanvasCornerIntersection(e){this.addNDCRayIntersection([[-1,-1],[1,-1],[1,1],[-1,1]],e)}validateAndAddToGeoPolygon(e,t){this.isInVisibleMap(e)&&t.push(this.projection.unprojectPoint(e))}isInVisibleMap(e){return!(e.y<0||e.y>c.EarthConstants.EQUATORIAL_CIRCUMFERENCE||!this.m_options.tileWrappingEnabled&&(e.x<0||e.x>c.EarthConstants.EQUATORIAL_CIRCUMFERENCE))}addPointInFrustum(e,t,i){if(t.containsPoint(e)){const t=this.projection.unprojectPoint(e);t.altitude=0,i.push(t)}}addFrustumIntersection(e,t,i){t.planes.forEach((t=>{let n=null;const s=new l.Vector3;if(e instanceof a.Ray&&e.intersectsPlane(t)?n=e.intersectPlane(t,s):e instanceof r.Line3&&t.intersectsLine(e)&&(n=t.intersectLine(e,s)),n&&u.MapViewUtils.closeToFrustum(n,this.camera)){const e=this.projection.unprojectPoint(n);e.altitude=0,i.push(e)}}))}getVerticalHorizonPositionInNDC(){const e=new l.Vector3(-1,-1,1).unproject(this.camera).add(new l.Vector3(1,-1,1).unproject(this.camera)).multiplyScalar(.5),t=new l.Vector3(-1,1,1).unproject(this.camera).add(new l.Vector3(1,1,1).unproject(this.camera)).multiplyScalar(.5),i=new r.Line3(e,t),n=new l.Vector3;if(this.m_groundPlane.intersectLine(i,n))return n.project(this.camera).y}}},5187:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolarTileDataSource=void 0;const n=i(3148),r=i(977),s=i(3334),o=i(6815),a=i(5269),l=i(7769),c=i(2616),h=i(1984),u=i(4303),d=i(8427),m=i(4572),p=i(6586),f=i(1447);class g extends u.DataSource{constructor({name:e="polar",layerNames:t=["northpole","southpole"],minDataLevel:i,maxDataLevel:n,minDisplayLevel:r,maxDisplayLevel:o,storageLevelOffset:a=-2,geometryLevelOffset:l=1,debugTiles:h=!1}){super({name:e,layerNames:t,minDataLevel:i,maxDataLevel:n,minDisplayLevel:r,maxDisplayLevel:o,storageLevelOffset:a}),this.m_tilingScheme=c.polarTilingScheme,this.m_maxLatitude=(0,s.radToDeg)(c.MercatorConstants.MAXIMUM_LATITUDE),this.m_geometryLevelOffset=l,this.m_debugTiles=h,this.cacheable=!1,this.enablePicking=!1}dispose(){this.m_northPoleEntry&&(this.m_northPoleEntry.material.dispose(),delete this.m_northPoleEntry),this.m_southPoleEntry&&(this.m_southPoleEntry.material.dispose(),delete this.m_southPoleEntry),this.m_styleSetEvaluator&&delete this.m_styleSetEvaluator}createTechiqueEntry(e){if(!this.m_styleSetEvaluator)return;const t=new l.MapEnv({$geometryType:"polygon",$layer:"earth",kind:e}),i=this.m_styleSetEvaluator.getMatchingTechniques(t);if(0===i.length)return;const n=i[0],r=(0,d.createMaterial)(n,this.mapView);return r?{material:r.material,technique:n}:void 0}async setTheme(e){e=await(0,p.load)(e);const t=(0,h.getStyles)(e.styles).filter((e=>{var t;return!e.layer||(null===(t=this.layerNames)||void 0===t?void 0:t.includes(e.layer))}));t.length>0&&(this.m_styleSetEvaluator=new l.StyleSetEvaluator({styleSet:t,definitions:e.definitions,priorities:e.priorities,labelPriorities:e.labelPriorities})),this.m_northPoleEntry=this.createTechiqueEntry("north_pole"),this.m_southPoleEntry=this.createTechiqueEntry("south_pole"),this.mapView.markTilesDirty(this)}canGetTile(e,t){if(e!==t.level||t.level<1)return!1;const{north:i,south:n}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||n<-this.m_maxLatitude}shouldSubdivide(e,t){if(e<=t.level)return!1;const{north:i,south:n}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||n<-this.m_maxLatitude}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new f.Tile(this,e);return this.createTileGeometry(t),t}get geometryLevelOffset(){return this.m_geometryLevelOffset}set geometryLevelOffset(e){this.m_geometryLevelOffset=e}intersectEdge(e,t,i){const n=t.latitude,r=i.latitude;let s=t.longitude,o=i.longitude;90===Math.abs(n)&&(s=o),90===Math.abs(r)&&(o=s);const a=o-s,l=(e-n)/(r-n);return new c.GeoCoordinates(e,s+a*l,0)}createTileGeometry(e){const{north:t,south:i}=e.geoBox,s=t>0&&i>=0,l=s?this.m_northPoleEntry:this.m_southPoleEntry;if(void 0===l)return void e.forceHasGeometry(!0);const h=this.m_tilingScheme.projection,u=this.projection,d=this.m_maxLatitude,p=s?d:-d,f=this.m_tilingScheme.boundingBoxGenerator.getWorldBox(e.tileKey),g=h.unprojectPoint(new o.Vector3(f.min.x,f.min.y,0)),v=h.unprojectPoint(new o.Vector3(f.max.x,f.min.y,0)),_=h.unprojectPoint(new o.Vector3(f.max.x,f.max.y,0)),y=h.unprojectPoint(new o.Vector3(f.min.x,f.max.y,0));let x,S=!1;if(1===e.tileKey.level){const e=0===f.min.x,t=e?f.max.x:f.min.x,i=(f.max.y+f.min.y)/2,n=h.unprojectPoint(new o.Vector3(t,i,0)),r=e?g:v;x=s?e?[n,_,r,v]:[n,g,r,y]:e?[n,v,r,_]:[n,y,r,g],S=!0}else{x=s?[g,v,_,y]:[g,y,_,v];const e=x.map((e=>e.latitude)),t=Math.max(...e),i=Math.min(...e);if(s?t<p:i>p)return;if(S=s?i<p:t>p,S){const n=e.indexOf(s?t:i);if(0!==n)for(let e=0;e<n;e++)x.push(x.shift())}}if(S){const t=(f.min.x+f.max.x)/2,i=(f.min.y+f.max.y)/2,n=h.unprojectPoint(new o.Vector3(t,i,0));c.TransverseMercatorUtils.alignLongitude(x,n);const r=x[0],s=x[1],a=x[2],l=x[3],u=Math.abs(s.latitude)>=d,m=Math.abs(l.latitude)>=d,g=u?this.intersectEdge(p,s,a):this.intersectEdge(p,r,s),v=m?this.intersectEdge(p,l,a):this.intersectEdge(p,r,l);x.splice(u?2:1,4,g);const _=e.tileKey.level-this.storageLevelOffset+this.m_geometryLevelOffset,y=360/(1<<Math.max(0,_)),S=Math.floor((g.longitude+180)/y),b=Math.ceil((v.longitude+180)/y);for(let e=S+1;e<b;e++)x.push(new c.GeoCoordinates(p,e*y-180,0));x.push(v),m&&x.push(l)}const b=new n.BufferGeometry,T=x.map((t=>{const i=u.projectPoint(t,new o.Vector3);return i.sub(e.center),i}));b.setFromPoints(T);const M=[];for(let e=1;e<T.length-1;e++)s?M.push(0,e,e+1):M.push(0,e+1,e);b.setIndex(M);const w=new a.Mesh(b,l.material);if(w.userData={dataSource:this.name,tileKey:e.tileKey},this.m_debugTiles){const t=Math.round(16777215*Math.abs(Math.sin(11*e.tileKey.mortonCode())));w.material=new r.MeshBasicMaterial({color:t,transparent:!0,opacity:.5}),e.objects.push(new a.Mesh(b,new r.MeshBasicMaterial({color:t,wireframe:!0})))}m.MapObjectAdapter.create(w,{dataSource:this,technique:l.technique}),e.objects.push(w)}}t.PolarTileDataSource=g},7362:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenCollisionsDebug=t.ScreenCollisions=t.isLineWithBound=t.DetailedCollisionBox=t.CollisionBox=void 0;const n=i(433),r=i(4342),s=i(507),o=i(1102),a=r.LoggerManager.instance.create("ScreenCollisions");class l extends r.Math2D.Box{constructor(e){super(),void 0!==e&&this.copy(e)}copy(e){return e instanceof r.Math2D.Box?this.set(e.x,e.y,e.w,e.h):e instanceof n.Box2?this.set(e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y):this.set(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY),this}get minX(){return this.x}set minX(e){this.x=e}get maxX(){return this.x+this.w}set maxX(e){this.w=e-this.x}get minY(){return this.y}set minY(e){this.y=e}get maxY(){return this.y+this.h}set maxY(e){this.h=e-this.y}}t.CollisionBox=l;class c extends l{constructor(e,t){super(e),this.detailBoxes=t}}function h(e){return void 0!==e.line}t.DetailedCollisionBox=c,t.isLineWithBound=h;const u=new l;class d{constructor(){this.screenBounds=new r.Math2D.Box,this.rtree=new o}reset(){this.rtree.clear()}update(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()}allocate(e){const t=e instanceof l?e:new l(e);this.rtree.insert(t)}allocateIBoxes(e){this.rtree.load(e)}search(e){return this.rtree.search(e)}isAllocated(e){const t=e instanceof l?e:u.copy(e),i=this.search(t);return this.intersectsDetails(t,i)}isVisible(e){return this.screenBounds.intersects(e)}isFullyVisible(e){return this.screenBounds.containsBox(e)}intersectsDetails(e,t){for(const i of t)if(i instanceof c){for(const t of i.detailBoxes)if(t.intersects(e))return!0}else{if(!h(i))return!0;{const t=i;if(this.intersectsLine(e,t))return!0}}return!1}intersectsLine(e,t){const i=t.line,n=i.end.x-i.start.x;let r,s,o,a;if(0!==n){const t=i.end.y-i.start.y,l=t,c=-n,h=i.start.y-t/n*i.start.x;r=Math.sign(e.minX*l+(e.minY-h)*c),s=Math.sign(e.maxX*l+(e.minY-h)*c),o=Math.sign(e.minX*l+(e.maxY-h)*c),a=Math.sign(e.maxX*l+(e.maxY-h)*c)}else r=Math.sign(e.minX-i.start.x),s=Math.sign(e.maxX-i.start.x),o=Math.sign(e.minX-i.start.x),a=Math.sign(e.maxX-i.start.x);return r!==s||r!==o||r!==a}}t.ScreenCollisions=d,t.ScreenCollisionsDebug=class extends d{constructor(e){super(),this.m_renderContext=null,this.m_renderingEnabled=!1,this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0,null!=e&&(this.m_renderContext=e.getContext("2d"))}reset(){super.reset(),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0}update(e,t){this.m_renderingEnabled&&a.log(`Allocations: ${this.m_numAllocations} Successful Tests: ${this.m_numSuccessfulTests} Failed Tests: ${this.m_numFailedTests}  Successful Visibility Tests: ${this.m_numSuccessfulVisibilityTests}  Failed Visibility Tests: ${this.m_numFailedVisibilityTests} `),super.update(e,t),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=e,this.m_renderContext.canvas.height=t),this.m_renderingEnabled=s.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")}allocate(e){super.allocate(e),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(e.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-e.y,e.w,-e.h))}allocateIBoxes(e){for(const t of e)this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#aa2222",this.m_renderContext.strokeRect(t.minX-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.minY,t.maxX-t.minX,-(t.maxY-t.minY)));super.allocateIBoxes(e)}intersectsDetails(e,t){const i=super.intersectsDetails(e,t);if(this.m_renderingEnabled&&null!==this.m_renderContext){const t=i?2:1;this.m_renderContext.strokeStyle=i?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(e.x-this.screenBounds.x-t,this.screenBounds.y+this.screenBounds.h-e.y+t,e.w+2*t,-e.h-2*t)}return i?this.m_numFailedTests++:this.m_numSuccessfulTests++,i}isVisible(e){const t=super.isVisible(e);return t?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,t}}},8658:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenProjector=void 0;const n=i(5448),r=i(6815);function s(e){return e.z>-1&&e.z<1}class o{constructor(e){this.m_camera=e,this.m_width=0,this.m_height=0}get width(){return this.m_width}get height(){return this.m_height}project(e,t=new n.Vector2){const i=this.projectVector(e,o.tempV3);return this.ndcToScreen(i,t)}projectToScreen(e,t=new n.Vector2){const i=this.projectVector(e,o.tempV3);if(s(i))return this.ndcToScreen(i,t)}projectAreaToScreen(e,t,i,r=new n.Vector2){t*=2,i*=2;const a=this.projectVector(e,o.tempV3);if(s(a)&&a.x+t>=-1&&a.x-t<=1&&a.y+i>=-1&&a.y-i<=1)return this.ndcToScreen(a,r)}project3(e,t=new r.Vector3){const i=this.projectVector(e,o.tempV3);if(i.z>-1&&i.z<1)return t.set(i.x*this.m_width/2,i.y*this.m_height/2,i.z),t}projectVector(e,t){return t.set(e.x,e.y,e.z).project(this.m_camera),t}onScreen(e){return(t=this.projectVector(e,o.tempV3)).z>-1&&t.z<1&&t.x>=-1&&t.x<=1&&t.y>=-1&&t.y<=1;var t}update(e,t,i){this.m_camera=e,this.m_width=t,this.m_height=i}ndcToScreen(e,t){return t.set(e.x*this.m_width/2,e.y*this.m_height/2)}}t.ScreenProjector=o,o.tempV2=new n.Vector2,o.tempV3=new r.Vector3},7775:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBackground=void 0;const n=i(3307),r=i(4257);t.SkyBackground=class{constructor(e,t,i){switch(this.m_sky=e,this.m_projectionType=t,this.m_sky.type){case"gradient":this.m_skyTexture=new r.SkyGradientTexture(this.m_sky,this.m_projectionType),this.updateCamera(i);break;case"cubemap":this.m_skyTexture=new n.SkyCubemapTexture(this.m_sky)}}dispose(){this.m_skyTexture.dispose()}get texture(){return this.m_skyTexture.texture}updateCamera(e){"gradient"===this.m_sky.type&&this.m_skyTexture.update(e)}updateTexture(e,t){const i=this.m_sky.type===e.type&&this.m_projectionType===t;switch(e.type){case"gradient":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new r.SkyGradientTexture(e,t);break;case"cubemap":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new n.SkyCubemapTexture(e)}this.m_projectionType=t,this.m_sky=e}}},3307:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyCubemapTexture=t.SkyCubemapFaceId=t.SKY_CUBEMAP_FACE_COUNT=void 0;const n=i(8497),r=i(862),s=i(4342).LoggerManager.instance.create("SkyCubemapTexture");var o;t.SKY_CUBEMAP_FACE_COUNT=6,function(e){e[e.positiveX=0]="positiveX",e[e.negativeX=1]="negativeX",e[e.positiveY=2]="positiveY",e[e.negativeY=3]="negativeY",e[e.positiveZ=4]="positiveZ",e[e.negativeZ=5]="negativeZ"}(o=t.SkyCubemapFaceId||(t.SkyCubemapFaceId={})),t.SkyCubemapTexture=class{constructor(e){const t=this.createCubemapFaceArray(e);this.m_skybox=void 0!==t?(new n.CubeTextureLoader).load(t):new r.CubeTexture}dispose(){this.m_skybox.dispose()}get texture(){return this.m_skybox}updateTexture(e){const t=this.createCubemapFaceArray(e);void 0!==t&&(this.m_skybox=(new n.CubeTextureLoader).load(t))}createCubemapFaceArray(e){const i=[void 0,void 0,void 0,void 0,void 0,void 0];for(let n=0;n<t.SKY_CUBEMAP_FACE_COUNT;++n){const t=e[o[n]];if(void 0===t)return void s.error(`Face "${o[n]}" was not defined.`);i[n]=t}return i}}},4257:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyGradientTexture=t.DEFAULT_MONOMIAL_POWER=t.DEFAULT_TEXTURE_SIZE=void 0;const n=i(6271),r=i(5971),s=i(414),o=i(3850),a=i(6815),l=i(862),c=i(7941),h=i(2616),u=i(4342);t.DEFAULT_TEXTURE_SIZE=512,t.DEFAULT_MONOMIAL_POWER=1;const d=[new a.Vector3(1,0,0),new a.Vector3(-1,0,0),new a.Vector3(0,-1,0),new a.Vector3(0,1,0),new a.Vector3(0,0,1),new a.Vector3(0,0,-1)],m=[new a.Vector3(0,0,-1),new a.Vector3(0,0,1),new a.Vector3(1,0,0),new a.Vector3(1,0,0),new a.Vector3(1,0,0),new a.Vector3(-1,0,0)],p=[new a.Vector3(0,1,0),new a.Vector3(0,1,0),new a.Vector3(0,0,1),new a.Vector3(0,0,-1),new a.Vector3(0,1,0),new a.Vector3(0,1,0)];t.SkyGradientTexture=class{constructor(e,i,u=t.DEFAULT_TEXTURE_SIZE){this.m_projectionType=i,this.m_height=u;const d=new r.Color(e.topColor),m=new r.Color(e.bottomColor),p=new r.Color(e.groundColor);this.m_width=this.m_projectionType===h.ProjectionType.Planar?1:this.m_height,this.m_faceCount=this.m_projectionType===h.ProjectionType.Planar?1:6,this.m_faces=[];for(let t=0;t<this.m_faceCount;++t){const i=new Uint8Array(4*this.m_width*this.m_height);this.fillTextureData(i,t,d,m,p,e.monomialPower);const r=new c.DataTexture(i,this.m_width,this.m_height,n.RGBAFormat);r.needsUpdate=!0,r.unpackAlignment=1,this.m_faces.push(r)}this.m_projectionType===h.ProjectionType.Spherical?(this.m_skybox=new l.CubeTexture(this.m_faces),this.m_skybox.needsUpdate=!0):(this.m_farClipPlaneDividedVertically=new s.Line3,this.m_groundPlane=new o.Plane(new a.Vector3(0,0,1)),this.m_bottomMidFarPoint=new a.Vector3,this.m_topMidFarPoint=new a.Vector3,this.m_horizonPosition=new a.Vector3,this.m_farClipPlaneCorners=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3])}dispose(){for(let e=0;e<this.m_faceCount;++e)this.m_faces[e].dispose();this.m_projectionType===h.ProjectionType.Spherical&&this.m_skybox.dispose()}get texture(){return this.m_projectionType===h.ProjectionType.Planar?this.m_faces[0]:this.m_skybox}update(e){this.m_projectionType===h.ProjectionType.Planar&&(this.setHorizonPosition(e),this.updateTexturePosition())}updateTexture(e){for(let t=0;t<this.m_faceCount;++t)this.fillTextureData(this.m_faces[t].image.data,t,new r.Color(e.topColor),new r.Color(e.bottomColor),new r.Color(e.groundColor),e.monomialPower),this.m_faces[t].needsUpdate=!0;this.m_projectionType===h.ProjectionType.Spherical&&(this.m_skybox.needsUpdate=!0)}fillTextureData(e,i,n,s,o,l){const c=new r.Color,f=new a.Vector3,g=new a.Vector3,v=new a.Vector3,_=new a.Vector3(0,0,1);for(let r=0;r<this.m_height;++r)for(let a=0;a<this.m_width;++a){if(this.m_projectionType===h.ProjectionType.Spherical){const e=g.copy(m[i]).multiplyScalar((a+.5)/this.m_width*2-1),h=v.copy(p[i]).multiplyScalar((r+.5)/this.m_height*2-1);f.copy(d[i]).add(e).add(h).normalize();const y=Math.max(_.dot(f),0);c.copy(o).lerp(s,Math.min(100*y,1)).lerp(n,y**(0,u.getOptionValue)(l,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}else{const e=r/this.m_height;0===r?c.copy(o).multiplyScalar(255):c.copy(s).lerp(n,e**(0,u.getOptionValue)(l,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}const y=4;e.set([c.r,c.g,c.b,255],r*this.m_width*y+a*y)}}setHorizonPosition(e){this.m_farClipPlaneCorners[0].set(-1,-1,1).unproject(e),this.m_farClipPlaneCorners[1].set(1,-1,1).unproject(e),this.m_farClipPlaneCorners[2].set(-1,1,1).unproject(e),this.m_farClipPlaneCorners[3].set(1,1,1).unproject(e),this.m_bottomMidFarPoint.copy(this.m_farClipPlaneCorners[0]).add(this.m_farClipPlaneCorners[1]).multiplyScalar(.5),this.m_topMidFarPoint.copy(this.m_farClipPlaneCorners[2]).add(this.m_farClipPlaneCorners[3]).multiplyScalar(.5),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint),this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)}updateTexturePosition(){const e=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance(),t=0===this.m_horizonPosition.length()?1:e-2/this.m_height;this.m_faces[0].offset.set(0,this.m_bottomMidFarPoint.z<=0?-t:e)}}},3228:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereHorizon=t.previousCanvasSide=t.nextCanvasSide=t.CanvasSide=void 0;const n=i(8333),r=i(6815),s=i(2616),o=i(4342),a=i(4442),l=i(541),c=2*Math.PI;var h;function u(e){return(e+1)%4}!function(e){e[e.Bottom=0]="Bottom",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Left=3]="Left"}(h=t.CanvasSide||(t.CanvasSide={})),t.nextCanvasSide=u,t.previousCanvasSide=function(e){return(e+3)%4},t.SphereHorizon=class{constructor(e,t){this.m_camera=e,this.m_cornerIntersects=t,this.m_intersections=[],this.m_isFullyVisible=!0;const i=s.EarthConstants.EQUATORIAL_RADIUS*s.EarthConstants.EQUATORIAL_RADIUS,o=(new r.Vector3).setFromMatrixColumn(e.matrixWorld,0).normalize(),a=e.position.clone().normalize(),c=(new r.Vector3).crossVectors(a,o),h=e.position.length();this.m_normalToTangentAngle=Math.asin(s.EarthConstants.EQUATORIAL_RADIUS/h);const u=Math.sqrt(h*h-i);this.m_distanceToHorizonCenter=u*Math.cos(this.m_normalToTangentAngle);const d=h-this.m_distanceToHorizonCenter;this.m_radius=Math.sqrt(i-d*d),this.m_cameraPitch=l.MapViewUtils.extractAttitude({projection:s.sphereProjection},this.m_camera).pitch;const m=(new r.Vector3).copy(a).setLength(d);this.m_matrix=(new n.Matrix4).makeBasis(o,c,a).setPosition(m),this.computeIntersections()}getPoint(e,t=0,i=1,n=new r.Vector3){const s=t*c,o=s+e*((i>=t?i*c:(i+1)*c)-s);return n.set(this.m_radius*Math.cos(o),this.m_radius*Math.sin(o),0),n.applyMatrix4(this.m_matrix),n}getDivisionPoints(e,t=0,i=1,n=10){const r=Math.max(Math.ceil(((i<t?1+i:i)-t)*n),1);for(let n=0;n<r;n++)e(this.getPoint(n/r,t,i))}get isFullyVisible(){return this.m_isFullyVisible}getSideIntersections(e){return this.m_intersections[e]}isTangentVisible(e){switch(e){case h.Top:{const e=this.m_normalToTangentAngle-this.m_cameraPitch;return a.CameraUtils.getTopFov(this.m_camera)>=Math.abs(e)}case h.Bottom:{const e=this.m_normalToTangentAngle+this.m_cameraPitch;return a.CameraUtils.getBottomFov(this.m_camera)>=Math.abs(e)}case h.Left:{const e=this.m_normalToTangentAngle;return a.CameraUtils.getLeftFov(this.m_camera)>=Math.abs(e)&&this.m_cameraPitch<=a.CameraUtils.getBottomFov(this.m_camera)}case h.Right:{const e=this.m_normalToTangentAngle;return a.CameraUtils.getRightFov(this.m_camera)>=Math.abs(e)&&this.m_cameraPitch<=a.CameraUtils.getBottomFov(this.m_camera)}}}getTangentOnSide(e){switch(e){case h.Bottom:return.75;case h.Right:return 0;case h.Top:return.25;case h.Left:return.5}}computeIntersections(){const e=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch-a.CameraUtils.getBottomFov(this.m_camera));let t,i;for(let n=h.Bottom;n<4;n++){if(this.isTangentVisible(n)){this.m_intersections.push([this.getTangentOnSide(n)]);continue}const r=new Array;switch(this.m_isFullyVisible=!1,n){case h.Bottom:r.push(...this.computeTBIntersections(e));break;case h.Right:{const n=a.CameraUtils.getRightFov(this.m_camera),s=this.computeLRIntersections(e,n);s&&([t,i]=s,r.push(void 0!==i?1+i:void 0,t));break}case h.Top:{const e=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch+a.CameraUtils.getTopFov(this.m_camera));r.push(...this.computeTBIntersections(e).reverse());break}case h.Left:{const n=a.CameraUtils.getLeftFov(this.m_camera);if(n===a.CameraUtils.getRightFov(this.m_camera))r.push(void 0!==t?.5-t:void 0,void 0!==i?.5-i:void 0);else{const t=this.computeLRIntersections(e,n);t&&r.push(.5-t[0],void 0!==t[1]?.5-t[1]:void 0)}break}}const s=[this.m_cornerIntersects[n],this.m_cornerIntersects[u(n)]];this.m_intersections.push(r.filter(((e,t)=>void 0!==e&&!s[t])))}}computeTBIntersections(e){const t=this.m_radius*this.m_radius,i=Math.sqrt(t-e*e),n=Math.atan2(e,i)/c;return[.5-n,n>0?n:1+n]}computeLRIntersections(e,t){const i=this.m_distanceToHorizonCenter/Math.cos(this.m_cameraPitch),n=this.m_distanceToHorizonCenter*Math.tan(this.m_cameraPitch),r=i*Math.tan(t),s=a.CameraUtils.getBottomFov(this.m_camera),l=r*(this.m_distanceToHorizonCenter*Math.cos(s)/Math.cos(this.m_cameraPitch-s))/i,h=o.Math2D.intersectLineAndCircle(l,e,r,n,this.m_radius);if(!h)return;const u=h.y1;return[Math.atan2(u,h.x1)/c,-u>=e&&void 0!==h.x2?Math.atan2(h.y2,h.x2)/c:void 0]}}},7284:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereViewBounds=t.computeEdgeDivisions=void 0;const n=i(5448),r=i(6815),s=i(2616),o=i(4342),a=i(3228),l=i(541);function c(e,t){const i=Math.abs(t.latitude-e.latitude),n=e.minLongitudeSpanTo(t);return Math.ceil(Math.max(i/20,n/5))}t.computeEdgeDivisions=c;const h=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}];t.SphereViewBounds=class{constructor(e,t){this.camera=e,this.projection=t,(0,o.assert)(t.type===s.ProjectionType.Spherical)}generate(){const e=this.findBoundsIntersections();return this.wrapAroundPoles(e),e.length>2?new s.GeoPolygon(e,!1,!0):void 0}addSideSegmentSubdivisions(e,t,i,r,s){e.push(r);const o=c(r,s);if(o<=1)return;const a=new n.Vector2(i.x-t.x,i.y-t.y).multiplyScalar(1/o),h=new n.Vector2(t.x,t.y);for(let t=0;t<o-1;t++){h.add(a);const t=l.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},h.x,h.y);t&&e.push(this.projection.unprojectPoint(t))}}addSideIntersections(e,t,i,n,r){const s=h[t],l=h[(0,a.nextCanvasSide)(t)];if(i&&n)return void this.addSideSegmentSubdivisions(e,s,l,i,n);if(!r)return;const c=r.getSideIntersections(t);if(0!==c.length){if(i){const t=r.getPoint(c[c.length-1]),n=this.projection.unprojectPoint(t);this.addSideSegmentSubdivisions(e,s,t.project(this.camera),i,n)}else{const i=(0,a.previousCanvasSide)(t);let n=r.getSideIntersections(i);0===n.length&&(n=r.getSideIntersections((0,a.previousCanvasSide)(i))),(0,o.assert)(n.length>0),r.getDivisionPoints((t=>{e.push(this.projection.unprojectPoint(t))}),n[n.length-1],c[0])}if(c.length>1){const t=r.getPoint(c[0]),i=r.getPoint(c[1]),n=this.projection.unprojectPoint(t),s=this.projection.unprojectPoint(i);this.addSideSegmentSubdivisions(e,t.project(this.camera),i.project(this.camera),n,s)}if(n){const t=r.getPoint(c[0]),i=this.projection.unprojectPoint(t);this.addSideSegmentSubdivisions(e,t.project(this.camera),l,i,n)}}}findBoundsIntersections(){const e=[],[t,i]=this.addCanvasCornerIntersection(),n=i<4?new a.SphereHorizon(this.camera,t.map((e=>void 0!==e))):void 0;if(0===i&&n.isFullyVisible)return n.getDivisionPoints((t=>{e.push(this.projection.unprojectPoint(t))})),e;for(let i=a.CanvasSide.Bottom;i<4;i++){const r=t[i],s=t[(0,a.nextCanvasSide)(i)];this.addSideIntersections(e,i,r,s,n)}return e}wrapAroundPoles(e){const t=new r.Vector3(0,0,s.EarthConstants.EQUATORIAL_RADIUS),i=new r.Vector3(0,0,-s.EarthConstants.EQUATORIAL_RADIUS),n=l.MapViewUtils.closeToFrustum(t,this.camera),o=l.MapViewUtils.closeToFrustum(i,this.camera);if(!n&&!o)return;const a=this.projection.unprojectPoint(this.camera.position).lng,c=n?90:-90,h=n?a+180:a-180,u=new s.GeoCoordinates(c,h),d=u.normalized(),m=d.lng;let p=e[e.length-1].lng,f=!1;const g=e.findIndex((e=>{const t=(0,s.isAntimeridianCrossing)(p,e.lng);return Math.sign(m-e.lng)===Math.sign(m-p)===t?(f=t,!0):(p=e.lng,!1)}));if(g<0)return;const v=n?90:-90,_=n?1e-5:-1e-5,y=new s.GeoCoordinates(c,a+v).normalized(),x=new s.GeoCoordinates(c,a).normalized(),S=new s.GeoCoordinates(c,a-v).normalized(),b=new s.GeoCoordinates(c,h+_).normalized(),T=e[(g+e.length-1)%e.length],M=e[g];let w=s.GeoCoordinates.lerp(T,M,.01,f);f&&n?w.longitude-=360:w=w.normalized(),e.splice(g,0,h<-180?u:d,y,x,S,b,w)}addCanvasCornerIntersection(){const e=new Array;let t=0;return h.forEach((i=>{const n=l.MapViewUtils.rayCastWorldCoordinates({camera:this.camera,projection:this.projection},i.x,i.y);n?(e.push(this.projection.unprojectPoint(n)),++t):e.push(void 0)})),[e,t]}}},8015:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceStatistics=t.FrameStatsArray=t.FrameStats=t.Statistics=t.MultiStageTimer=t.computeArrayAverage=t.computeArrayStats=t.SampledTimer=t.SimpleTimer=t.RingBuffer=void 0;const n=i(4342),r=n.LoggerManager.instance.create("Statistics");class s{constructor(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}clear(){this.head=this.tail=this.size=0}enqOne(e){let t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)}enq(...e){for(const t of e)this.enqOne(t)}deq(){if(0===this.size)throw new Error("Ringbuffer underrun");const e=this.buffer[this.tail];let t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e}get top(){if(0===this.size)throw new Error("Ringbuffer underrun");return this.buffer[this.tail]}get bottom(){if(0===this.size)throw new Error("Ringbuffer underrun");let e=this.head-1;return e<0&&(e=this.capacity-1),this.buffer[e]}iterator(){return new s.Iterator(this)}asArray(){const e=new Array;for(let t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e}}t.RingBuffer=s,function(e){e.Iterator=class{constructor(e,t=0){this.m_buffer=e,this.m_index=t}get value(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]}next(){return this.m_index++,this.m_index<this.m_buffer.size}}}(s=t.RingBuffer||(t.RingBuffer={}));class o{constructor(e,t){this.statistics=e,this.name=t,this.running=!1}get value(){return this.m_currentValue}setValue(e){this.m_currentValue=e}reset(){this.m_currentValue=void 0}start(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=n.PerformanceTimer.now()}stop(){var e;if(!this.statistics.enabled)return-1;if(this.running){const t=n.PerformanceTimer.now()-(null!==(e=this.m_currentValue)&&void 0!==e?e:0);return this.m_currentValue=t,this.setValue(t),this.running=!1,t}throw new Error("Timer '"+this.name+"' has not been started")}now(){var e;if(!this.statistics.enabled)return-1;if(this.running)return n.PerformanceTimer.now()-(null!==(e=this.m_currentValue)&&void 0!==e?e:0);throw new Error("Timer '"+this.name+"' has not been started")}}t.SimpleTimer=o;class a extends o{constructor(e,t){super(e,t),this.statistics=e,this.name=t,this.numResets=0,this.maxNumSamples=1e3,this.samples=new s(this.maxNumSamples)}reset(){super.reset(),this.getStats(),this.samples.clear(),this.numResets++}setValue(e){super.setValue(e),void 0!==e&&this.samples.enqOne(e)}getStats(){return l(this.samples.asArray())}}function l(e){if(0===e.length)return;e.sort(((e,t)=>e-t));const t=e[0],i=e[e.length-1];let n,r,s,o,a,l,c;if(1===e.length)r=s=o=a=l=c=n=e[0];else if(2===e.length)n=.5*e[0]+.5*e[1],r=s=o=a=l=c=e[1];else{const t=Math.floor(e.length/2);n=e.length%2==0?.5*e[t-1]+.5*e[t]:e[t],r=e[Math.round(.75*e.length)-1],s=e[Math.round(.9*e.length)-1],o=e[Math.round(.95*e.length)-1],a=e[Math.round(.97*e.length)-1],l=e[Math.round(.99*e.length)-1],c=e[Math.round(.999*e.length)-1]}let h=0;for(let t=0,i=e.length;t<i;t++)h+=e[t];return{min:t,max:i,avg:h/e.length,median:n,median75:r,median90:s,median95:o,median97:a,median99:l,median999:c,numSamples:e.length}}t.SampledTimer=a,t.computeArrayStats=l,t.computeArrayAverage=function(e){if(0===e.length)return;let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i];return t/e.length},t.MultiStageTimer=class{constructor(e,t,i){if(this.statistics=e,this.name=t,this.stages=i,i.length<1)throw new Error("MultiStageTimer needs stages");i.forEach((t=>{if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)}))}get value(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value}reset(){this.statistics.enabled&&this.stages.forEach((e=>{this.statistics.getTimer(e).reset()}))}start(){var e;return this.stage=this.stages[0],null!==(e=this.statistics.getTimer(this.stages[0]).value)&&void 0!==e?e:-1}stop(){return this.stage=void 0,void 0!==this.value?this.value:-1}get stage(){return this.currentStage}set stage(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())}},t.Statistics=class{constructor(e,t=!1){this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new o(this,"<null>")}createTimer(e,t=!0){const i=t?new a(this,e):new o(this,e);return this.addTimer(i)}addTimer(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e}getTimer(e){if(!this.enabled)return this.nullTimer;const t=this.timers.get(e);return void 0===t?this.nullTimer:t}hasTimer(e){return void 0!==this.timers.get(e)}reset(){this.timers.forEach((e=>{e.reset()}))}log(e,t){void 0===e&&void 0===this.name||r.log(void 0!==e?e:this.name);let i=0;this.timers.forEach((e=>{i=Math.max(i,e.name.length)}));const n=e=>void 0!==e?e.toFixed(5):"?";this.timers.forEach((e=>{let t=e.name+": "+" ".repeat(i-e.name.length);if(t+=n(e.value),e instanceof a){const i=e.getStats();void 0!==i&&(t+=`  [ min=${n(i.min)}, max=${n(i.max)}, avg=${n(i.avg)}, med=${n(i.median)}, med95=${n(i.median95)}, med99=${n(i.median99)}, N=${n(i.numSamples)} ]`)}r.log(t)})),void 0!==t&&r.log(t)}};class c{constructor(){this.entries=new Map,this.messages=void 0}getValue(e){return this.entries.get(e)}setValue(e,t){this.entries.set(e,t)}addValue(e,t){const i=this.entries.get(e);this.entries.set(e,t+(void 0===i?0:i))}addMessage(e){void 0===this.messages&&(this.messages=[]),this.messages.push(e)}reset(){this.entries.forEach(((e,t)=>{this.entries.set(t,0)})),this.messages=void 0}}t.FrameStats=c;class h{constructor(e=0){this.capacity=e,this.frameEntries=new Map,this.messages=new s(e)}get length(){return this.messages.size}reset(){this.frameEntries.forEach(((e,t)=>{e.clear()})),this.messages.clear()}addFrame(e){const t=this.length,i=this.frameEntries;e.entries.forEach(((e,n)=>{let r=i.get(n);if(void 0===r){r=new s(this.capacity);for(let e=0;e<t;e++)r.enqOne(0);this.frameEntries.set(n,r)}r.enqOne(e)})),this.messages.enq(e.messages)}log(){let e=0;this.frameEntries.forEach(((t,i)=>{e=Math.max(e,i.length)}));const t=e=>void 0!==e?e.toFixed(5):"?";this.frameEntries.forEach(((i,n)=>{let s=n+": "+" ".repeat(e-n.length);const o=l(i.asArray());void 0!==o&&(s+=`  [ min=${t(o.min)}, max=${t(o.max)}, avg=${t(o.avg)}, med=${t(o.median)}, med95=${t(o.median95)}, med99=${t(o.median99)}, N=${t(o.numSamples)} ]`),r.log(s)}))}}t.FrameStatsArray=h;class u{get isFull(){return this.m_frameEvents.length>=this.maxNumFrames}static get instance(){return void 0===u.m_instance&&(u.m_instance=new u(!1,0)),u.m_instance}get frameEvents(){return this.m_frameEvents}constructor(e=!0,t=1e3){this.enabled=e,this.maxNumFrames=t,this.currentFrame=new c,this.appResults=new Map,this.configs=new Map,u.m_instance=this,this.m_frameEvents=new h(t)}clear(){this.clearFrames(),this.configs.clear(),this.appResults.clear()}clearFrames(){this.m_frameEvents.reset(),this.currentFrame.reset()}addWebGLInfo(e){void 0!==e.render&&(this.currentFrame.setValue("gl.numCalls",null===e.render.calls?0:e.render.calls),this.currentFrame.setValue("gl.numPoints",null===e.render.points?0:e.render.points),this.currentFrame.setValue("gl.numLines",null===e.render.lines?0:e.render.lines),this.currentFrame.setValue("gl.numTriangles",null===e.render.triangles?0:e.render.triangles)),void 0!==e.memory&&(this.currentFrame.setValue("gl.numGeometries",null===e.memory.geometries?0:e.memory.geometries),this.currentFrame.setValue("gl.numTextures",null===e.memory.textures?0:e.memory.textures)),void 0!==e.programs&&this.currentFrame.setValue("gl.numPrograms",null===e.programs?0:e.programs.length)}addMemoryInfo(){if(void 0!==window&&void 0!==window.performance){const e=window.performance.memory;void 0!==e&&(this.currentFrame.setValue("memory.totalJSHeapSize",e.totalJSHeapSize),this.currentFrame.setValue("memory.usedJSHeapSize",e.usedJSHeapSize),this.currentFrame.setValue("memory.jsHeapSizeLimit",e.jsHeapSizeLimit))}}storeAndClearFrameInfo(){return!(this.m_frameEvents.length>=this.maxNumFrames||(this.m_frameEvents.addFrame(this.currentFrame),this.currentFrame.reset(),0))}log(e,t){r.log(void 0!==e?e:"PerformanceStatistics"),this.appResults.forEach(((e,t)=>{r.log(t,e)})),this.configs.forEach(((e,t)=>{r.log(t,e)})),this.m_frameEvents.log(),void 0!==t&&r.log(t)}getAsPlainObject(e=!1){const t={},i={},n={},r={configs:i,appResults:t,frames:n};if(this.appResults.forEach(((e,i)=>{t[i]=e})),this.configs.forEach(((e,t)=>{i[t]=e})),e)for(const[e,t]of this.m_frameEvents.frameEntries)n[e]=t.bottom;else for(const[e,t]of this.m_frameEvents.frameEntries)n[e]=t.asArray();return r.messages=this.m_frameEvents.messages.asArray(),r}getLastFrameStatistics(){return this.getAsPlainObject(!0)}getAsSimpleFrameStatistics(e=!1){const t=new Map,i=new Map,n=new Map,r={configs:t,appResults:i,frames:n,messages:this.m_frameEvents.messages.asArray()};if(this.appResults.forEach(((e,t)=>{i.set(t,e)})),this.configs.forEach(((e,i)=>{t.set(i,e)})),e)for(const[e,t]of this.m_frameEvents.frameEntries)n.set(e,t.bottom);else for(const[e,t]of this.m_frameEvents.frameEntries)n.set(e,t.asArray());return r}}t.PerformanceStatistics=u,u.m_instance=void 0},1797:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLoader=void 0;const n=i(6271),r=i(642);t.TextureLoader=class{constructor(){this.m_textureLoader=new r.TextureLoader}async load(e,t,i,r=!0){if(void 0===t)return await this.loadWithThreeLoader(e);const s=await fetch(e,{headers:t,signal:i,mode:r?"cors":"no-cors"}),o=await s.blob(),a=await this.loadWithThreeLoader(URL.createObjectURL(o));return a.format=n.RGBAFormat,a}loadWithThreeLoader(e){return new Promise(((t,i)=>{this.m_textureLoader.setCrossOrigin(""),this.m_textureLoader.load(e,(e=>t(e)),void 0,(()=>i(new Error("failed to load texture"))))}))}}},5640:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLight=t.toTextureFilter=t.toWrappingMode=t.toTextureDataType=t.toPixelFormat=void 0;const n=i(6271),r=i(9191),s=i(4307),o=i(3334),a=i(2616);t.toPixelFormat=function(e){switch(e){case"Alpha":return n.AlphaFormat;case"RGBA":return n.RGBAFormat;case"Luminance":return n.LuminanceFormat;case"LuminanceAlpha":return n.LuminanceAlphaFormat;case"Depth":return n.DepthFormat;case"DepthStencil":return n.DepthStencilFormat;case"Red":return n.RedFormat;default:throw new Error(`invalid pixel format: ${e}`)}},t.toTextureDataType=function(e){switch(e){case"UnsignedByte":return n.UnsignedByteType;case"Byte":return n.ByteType;case"Short":return n.ShortType;case"UnsignedShort":return n.UnsignedShortType;case"Int":return n.IntType;case"UnsignedInt":return n.UnsignedIntType;case"Float":return n.FloatType;case"HalfFloat":return n.HalfFloatType;default:throw new Error(`invalid texture data type: ${e}`)}},t.toWrappingMode=function(e){switch(e){case"clamp":return n.ClampToEdgeWrapping;case"repeat":return n.RepeatWrapping;case"mirror":return n.MirroredRepeatWrapping;default:throw new Error(`invalid wrapping mode: ${e}`)}},t.toTextureFilter=function(e){switch(e){case"nearest":return n.NearestFilter;case"nearestMipMapNearest":return n.NearestMipMapNearestFilter;case"nearestMipMapLinear":return n.NearestMipMapLinearFilter;case"linear":return n.LinearFilter;case"linearMipMapNearest":return n.LinearMipMapNearestFilter;case"linearMipMapLinear":return n.LinearMipMapLinearFilter;default:throw new Error(`invalid texture filter: ${e}`)}},t.createLight=function(e){switch(e.type){case"ambient":{const t=new r.AmbientLight(e.color,e.intensity);return t.name=e.name,t}case"directional":{const t=new s.DirectionalLight(e.color,e.intensity);return t.name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.castShadow&&(t.shadow.bias=1e-5,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024),function(e,t){if((0,a.isVector3Like)(t.direction)){const{x:i,y:n,z:r}=t.direction;e.position.set(i,n,r)}else{const[i,n]=t.direction.map((e=>(0,o.degToRad)(e))),r=Math.cos(n);e.position.set(Math.sin(i)*r,Math.cos(i)*r,Math.sin(n))}e.position.normalize()}(t,e),t}}}},6586:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isThemeLoaded=t.load=t.DEFAULT_MAX_THEME_INHERITANCE_DEPTH=void 0,i(6892);const n=i(2616),r=i(1984),s=i(4342),o=i(3307);function a(e){if(e instanceof Object)if(e instanceof Array)if("literal"===e[0])e[2]=r.ObjectLiteralExpr.nextID;else{let t=e.length;for(;t--;)a(e[t])}else for(const t in e)a(e[t])}async function l(e,i,n){var o,a;if(n=null!=n?n:{},"string"==typeof e){const t=null!==(a=null===(o=n.uriResolver)||void 0===o?void 0:o.resolveUri(e))&&void 0!==a?a:e,i=await fetch(t,{signal:n.signal});if(!i.ok)throw new Error(`ThemeLoader#load: cannot load theme: ${i.statusText}`);(e=await i.json()).url=t,e=c(e,n)}else void 0===e.url&&(e.url=(0,s.getAppBaseUrl)(),e=c(e,n));if(e.styles=(0,r.getStyles)(e.styles),null==e)throw new Error("ThemeLoader#load: loaded resource is not valid JSON");return e=await async function(e,i,n){if(n=null!=n?n:{},void 0===i.extends)return i;const o=(0,s.getOptionValue)(n.maxInheritanceDepth,t.DEFAULT_MAX_THEME_INHERITANCE_DEPTH);if(o<=0)throw new Error("maxInheritanceDepth reached when attempting to load base theme");const a=Array.isArray(i.extends)?i.extends:[i.extends];delete i.extends;let c={};for(const t of a){let i,s;(0,r.isConditionalExtendsEntry)(t)?(i=t.value,s=t.when):i=t,c=S(await l(i,e,Object.assign(Object.assign({},n),{resolveLightDefinitions:!1,maxInheritanceDepth:o-1})),c,s)}return S(i,c)}(i,e,n),(0,s.getOptionValue)(n.resolveLightDefinitions,!0)&&void 0!==e.lights&&(i.pushAttr("lights"),e.lights=function(e,t,i){const n=[];for(let r=0;r<e.length;++r){i.pushIndex(r);const s=h(e[r],t,i);void 0!==s?n.push(s):i.warn("invalid light, ignored"),i.pop()}return n}(e.lights,e.definitions,i),i.pop()),e}function c(e,t){if(void 0===e.url)return e;if(e.base){const i=`${e.base.style}/${e.base.scheme}.json`,n=null==t?void 0:t.baseUrl;e.extends=void 0!==n?(0,s.resolveReferenceUri)(n,i):i}const i={resolveUri(i){var n,r;const o=null!==(r=null===(n=null==t?void 0:t.uriResolver)||void 0===n?void 0:n.resolveUri(i))&&void 0!==r?r:i;return o!==i?o:(0,s.resolveReferenceUri)(e.url,i)}};return e.extends&&(e.extends=(Array.isArray(e.extends)?e.extends:[e.extends]).map((n=>{let s;if("string"==typeof n)s=i.resolveUri(n);else if((0,r.isConditionalExtendsEntry)(n)){s=n;let r=n.value;"string"==typeof r?r=i.resolveUri(r):void 0===r.url&&(r.url=e.url,r=c(r,t)),s.value=r}else void 0!==n.url?s=n:(n.url=e.url,s=c(n,t));return s}))),!1!==(null==t?void 0:t.resolveResourceUris)&&function(e,t){if(e.sky&&"cubemap"===e.sky.type)for(let i=0;i<o.SKY_CUBEMAP_FACE_COUNT;++i){const n=e.sky[o.SkyCubemapFaceId[i]];void 0!==n&&(e.sky[o.SkyCubemapFaceId[i]]=t.resolveUri(n))}if(e.images)for(const i of Object.keys(e.images)){const n=e.images[i];n.url=t.resolveUri(n.url),void 0!==n.atlas&&(n.atlas=t.resolveUri(n.atlas))}if(e.fontCatalogs)for(const i of e.fontCatalogs)i.url=t.resolveUri(i.url);if(void 0!==e.styles)for(const i of(0,r.getStyles)(e.styles))i.attr&&["map","normalMap","displacementMap","roughnessMap"].forEach((e=>{const n=i.attr[e];n&&"string"==typeof n&&(i.attr[e]=t.resolveUri(n))}))}(e,i),e}function h(e,t,i){const s=u(e.color,t,i);if(void 0===s)return;e.color=s;const o=u(e.intensity,t,i);if(void 0!==o){if(e.intensity=o,(0,r.isDirectionalLight)(e)&&!(0,n.isVector3Like)(e.direction)){const n=e.direction.map((e=>u(e,t,i)));if(n.some((e=>void 0===e)))return;e.direction=n}return e}}function u(e,t,i){let n=!1;const s=function e(s){if((0,r.isJsonExprReference)(s)){const e=s[1],o=t&&t[e];return void 0===o?(i.warn(`invalid reference '${e}' - not found`),void(n=!0)):(0,r.isJsonExpr)(o)?o:(0,r.getDefinitionValue)(o)}if(Array.isArray(s)){const t=[...s];for(let i=1;i<t.length;++i)t[i]=e(t[i]);return t}return s}(e);if(!n)return s}function d(e,t,i){let n;if(void 0!==i&&void 0!==e){n=Object.assign({},t);for(const t of Object.keys(e)){const s=n[t],o=e[t];let a;(0,r.isJsonExpr)(s)&&"case"===s[0]?(a=s.slice(),a.splice(1,0,i,o)):a=["case",i,o,void 0===s?null:s],n[t]=a}}else n=Object.assign(Object.assign({},t),e);return n}function m(e,t,i){e&&e.forEach((e=>{var n;const r=e.id;if(r){if((null!==(n=i.get(r))&&void 0!==n?n:-1)>=0)return;i.set(r,t.length)}t.push(e)}))}function p(e,t,i){var n;if((0,r.isJsonExpr)(e)){if(1===e.length&&"base-attribute-value"===e[0])return null!==(n=null==i?void 0:i[t])&&void 0!==n?n:null;let r=e.length;for(;r--;)e[r]=p(e[r],t,i)}return e}function f(e,t,i){if(e){i=null!=i?i:e;for(const n in e)i[n]=p(e[n],n,t)}}function g(e,t,i,n,r,s,o){var a;const l=e.extends;if(!l)return void f(e.attr,void 0);const c=e.id;c&&s.add(c);const h=null!==(a=n.get(l))&&void 0!==a?a:-1,u=i[h],d=e.technique,m=s.has(l),p=m?`circular dependency detected during the theme loading ${[...s].concat([l]).join(" → ")}`:h<0?`id "${l}" not found.`:d&&d!==u.technique?`extending style rule "${null!=c?c:""}" has a different technique from the base rule "${l}".`:"";if(p){const t=`Invalid style "extends": ${p}`;if(o.warn(t),delete e.extends,m)throw new Error(t);return void f(e.attr,void 0)}g(u,h,i,n,r,s,o);const S=Object.assign(Object.assign({},u),e),b=u.attr,T=e.attr;b&&T&&(S.attr=Object.assign(Object.assign({},b),T)),T&&f(T,b,S.attr),e.id||delete S.id,e.when||delete S.when;const M=function(e,t,i,n){let r,s=e.when;if(s===v)r=n.get(i);else{if(r=y(s,i,n),t){const e=["!",_(t)?[...t]:t];s?_(s)?s.push(e):s=["all",s,e]:s=e}else s=v;e.when=s}return r}(u,e.when,l,r);!function(e,t,i,n){const r=x(e,t);r&&y(r,i,n,!0)}(S,M,c,r),delete S.extends,i.splice(t,1,S)}t.DEFAULT_MAX_THEME_INHERITANCE_DEPTH=4,t.load=async function(e,t){var i;const n=new s.ContextLogger(null!==(i=null==t?void 0:t.logger)&&void 0!==i?i:console,`when processing Theme ${"string"==typeof e?e:e.url}:`),o=await l(e,n,Object.assign(Object.assign({},t),{resolveLightDefinitions:!0}));return function(e,t){const i=new Map,n=new Map;e.forEach(((e,t)=>{const n=e.id;n&&i.set(n,t)}));const r=new Set,s=new Set;e.forEach(((o,a)=>{try{g(o,a,e,i,n,s,t)}catch(e){s.forEach(r.add,r)}finally{s.clear()}}));let o=e.length;for(;o--;){const t=e[o].id;(e[o].when===v||t&&r.has(t))&&e.splice(o,1)}}((0,r.getStyles)(o.styles),n),a(o),o},t.isThemeLoaded=function(e){return void 0===e.extends&&!(0,r.isStylesDictionary)(e.styles)};const v=["!",!0];function _(e){return(0,r.isJsonExpr)(e)&&"all"===e[0]}function y(e,t,i,n=!1){let r;return t&&(r=i.get(t),!e||!n&&i.has(t)||(r=[...e],i.set(t,r))),r}function x(e,t){let i=e.when;if(i){if(t){const e=_(t),n=_(i);e&&n?i.splice(1,0,...t.slice(1)):e?i=[...t,i]:n?i.splice(1,0,t):i=["all",t,i]}}else t&&(i=[...t]);return i&&(e.when=i),i}function S(e,t,i){const n=(0,r.getStyles)(t.styles),s=(0,r.getStyles)(e.styles),o=[],a=new Map;return m(n,o,a),m(s,o,a),i&&s.forEach((e=>{x(e,i)})),Object.assign(Object.assign(Object.assign(Object.assign({},t),e),function(e,t){const i=Object.assign(Object.assign({},t.images),e.images);let n=[];return!t.imageTextures&&e.imageTextures?n=e.imageTextures:t.imageTextures&&!e.imageTextures?n=t.imageTextures:t.imageTextures&&e.imageTextures&&(n=e.imageTextures.slice(),t.imageTextures.forEach((e=>{n.find((({name:t})=>t===e.name))||n.push(e)}))),{images:i,imageTextures:n}}(e,t)),{definitions:d(e.definitions,t.definitions,i),styles:o})}},1447:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=t.getFeatureDataSize=void 0;const n=i(6815),r=i(394),s=i(2616),o=i(5562),a=i(4342),l=i(6473),c=i(7987),h=i(1335),u=i(7013),d=i(3922),m=i(1406),p=i(3977),f=i(8015),g=a.LoggerManager.instance.create("Tile");t.getFeatureDataSize=function(e){let t=100;return void 0!==e.starts&&(t+=8*e.starts.length),void 0!==e.objInfos&&(t+=16*e.objInfos.length),t},t.Tile=class{constructor(e,t,i=0,r){this.dataSource=e,this.tileKey=t,this.objects=[],this.dependencies=[],this.frameNumLastRequested=-1,this.frameNumVisible=-1,this.frameNumLastVisible=-1,this.numFramesVisible=0,this.visibilityCounter=-1,this.levelOffset=0,this.skipRendering=!1,this.delayRendering=!1,this.m_boundingBox=new s.OrientedBox3,this.m_disposed=!1,this.m_forceHasGeometry=void 0,this.m_iconTextGroups=new u.IconTextGroupPriorityList,this.m_pathBlockingElements=[],this.m_worldCenter=new n.Vector3,this.m_visibleArea=0,this.m_elevationRange={minElevation:0,maxElevation:0},this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.updateBoundingBox(),this.m_worldCenter.copy(this.boundingBox.position),this.m_localTangentSpace=null!=r&&r,this.m_textStyleCache=new d.TileTextStyleCache(this),this.m_offset=i,this.m_uniqueKey=s.TileKeyUtils.getKeyForTileKeyAndOffset(this.tileKey,this.offset),e.useGeometryLoader&&(this.m_tileGeometryLoader=new h.TileGeometryLoader(this,this.mapView.taskQueue),this.attachGeometryLoadedCallback())}get isVisible(){try{return this.frameNumLastRequested>=this.dataSource.mapView.frameNumber-1}catch(e){return g.debug(e),!1}}set isVisible(e){this.frameNumLastRequested=e?this.dataSource.mapView.frameNumber:-1,e||!this.m_tileGeometryLoader||this.m_tileGeometryLoader.isSettled||this.m_tileGeometryLoader.cancel()}get projection(){return this.dataSource.projection}get mapView(){return this.dataSource.mapView}get localTangentSpace(){return this.m_localTangentSpace}get memoryUsage(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo.heapSize}get center(){return this.m_worldCenter}get uniqueKey(){return this.m_uniqueKey}get offset(){return this.m_offset}set offset(e){this.m_offset!==e&&(this.m_uniqueKey=s.TileKeyUtils.getKeyForTileKeyAndOffset(this.tileKey,e)),this.m_offset=e}getResourceInfo(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo}invalidateResourceInfo(){this.m_resourceInfo=void 0}addIconText(e){this.iconTextGroups.add(e),this.iconTextsChanged=!0}addBlockingElement(e){this.m_pathBlockingElements.push(e)}get iconTextGroups(){return this.m_iconTextGroups}get iconTextsChanged(){var e;return null!==(e=this.m_iconTextsChanged)&&void 0!==e&&e}set iconTextsChanged(e){this.m_iconTextsChanged=e}hasIconTexts(){return this.m_iconTextGroups.count()>0}get blockingElements(){return this.m_pathBlockingElements}willRender(e){return!this.skipRendering&&!this.delayRendering}didRender(){}get visibleArea(){return this.m_visibleArea}set visibleArea(e){this.m_visibleArea=e,void 0!==this.tileLoader&&(this.tileLoader.priority=e)}get elevationRange(){return this.m_elevationRange}set elevationRange(e){var t;e.minElevation===this.m_elevationRange.minElevation&&e.maxElevation===this.m_elevationRange.maxElevation&&e.calculationStatus===this.m_elevationRange.calculationStatus||(this.m_elevationRange.minElevation=e.minElevation,this.m_elevationRange.maxElevation=e.maxElevation,this.m_elevationRange.calculationStatus=e.calculationStatus,this.elevateGeoBox(),void 0===this.m_maxGeometryHeight&&void 0===this.m_minGeometryHeight||((0,a.assert)(void 0===(null===(t=this.decodedTile)||void 0===t?void 0:t.boundingBox)),this.updateBoundingBox()))}get decodedTile(){return this.m_decodedTile}set decodedTile(e){var t,i;if(this.m_decodedTile=e,this.invalidateResourceInfo(),void 0===e)return;0===e.geometries.length&&this.forceHasGeometry(!0),this.m_maxGeometryHeight=e.boundingBox?void 0:null!==(t=e.maxGeometryHeight)&&void 0!==t?t:0,this.m_minGeometryHeight=e.boundingBox?void 0:null!==(i=e.minGeometryHeight)&&void 0!==i?i:0,this.elevateGeoBox(),this.updateBoundingBox(e.boundingBox);const n=f.PerformanceStatistics.instance;n.enabled&&void 0!==e.decodeTime&&(n.currentFrame.addValue("decode.decodingTime",e.decodeTime),n.currentFrame.addValue("decode.decodedTiles",1)),void 0!==e.copyrightHolderIds&&(this.copyrightInfo=e.copyrightHolderIds.map((e=>({id:e})))),this.dataSource.requestUpdate()}get disposed(){return this.m_disposed}get allGeometryLoaded(){var e,t;return null!==(t=null===(e=this.m_tileGeometryLoader)||void 0===e?void 0:e.isFinished)&&void 0!==t?t:this.hasGeometry}get hasGeometry(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry}forceHasGeometry(e){this.m_forceHasGeometry=e}resetVisibilityCounter(){this.visibilityCounter=-1}get tileLoader(){return this.m_tileLoader}set tileLoader(e){this.m_tileLoader=e}async load(e){const t=this.tileLoader;if(void 0===t)return await Promise.resolve();if(this.m_tileGeometryLoader){const e=this.m_tileGeometryLoader.isSettled;this.m_tileGeometryLoader.reset(),e&&this.attachGeometryLoadedCallback()}return!0===e&&t.cancel(),await t.loadAndDecode().then((e=>{var i;(0,a.assert)(e===m.TileLoaderState.Ready);const n=t.decodedTile;this.decodedTile=n,null===(i=null==n?void 0:n.dependencies)||void 0===i||i.forEach((e=>{this.dependencies.push(s.TileKey.fromMortonCode(e))}))})).catch((e=>{e===m.TileLoaderState.Failed?this.dispose():e!==m.TileLoaderState.Canceled&&g.error("Unknown error"+e)}))}get textStyleCache(){return this.m_textStyleCache}clear(){const e=e=>{var t;Object.getOwnPropertyNames(e).forEach((t=>{const i=e[t];i instanceof r.Texture&&i.dispose()})),(0,o.needsCanvasSize)(e)&&(null===(t=e.onResizeTarget)||void 0===t||t.removeEventListener(p.MapViewEventNames.Resize,e.onResizeListener),delete e.onResizeListener,delete e.onResizeTarget),e.dispose()},t=t=>{var i,n;null===(i=t.geometry)||void 0===i||i.dispose();for(const e of null!==(n=t.geometries)&&void 0!==n?n:[])e.dispose();t.material instanceof Array?t.material.forEach((t=>{void 0!==t&&e(t)})):t.material&&e(t.material)};this.objects.forEach((e=>{e.traverse((e=>{t(e)})),t(e)})),this.objects.length=0,this.preparedTextPaths&&(this.preparedTextPaths=[]),this.m_textStyleCache.clear(),this.clearIconTexts(),this.invalidateResourceInfo()}clearIconTexts(){this.hasIconTexts()&&(this.iconTextsChanged=!0,this.m_pathBlockingElements.splice(0),this.iconTextGroups.forEachElement((e=>{e.dispose()})),this.iconTextGroups.clear())}addDisposeCallback(e){this.m_disposeCallback=(0,a.chainCallbacks)(this.m_disposeCallback,e)}dispose(){var e;this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.cancel(),this.m_tileLoader=void 0),this.clear(),this.frameNumLastRequested=0,this.m_disposed=!0,null===(e=this.m_tileGeometryLoader)||void 0===e||e.dispose(),this.m_disposeCallback&&this.m_disposeCallback(this))}computeWorldOffsetX(){return this.projection.worldExtent(0,0).max.x*this.offset}update(e){for(const t of this.objects)t instanceof l.LodMesh&&t.setLevelOfDetail(e-this.tileKey.level)}get boundingBox(){return this.m_boundingBox}updateGeometry(e){if(!this.m_tileGeometryLoader)return!1;if(this.m_tileGeometryLoader.isSettled)return!0;if(this.dataSource.isDetached())return this.m_tileGeometryLoader.cancel(),!0;if(this.tileLoader){if(!this.tileLoader.isFinished)return!0;if(!this.decodedTile)return this.m_tileGeometryLoader.finish(),!0}return void 0!==e&&(this.m_tileGeometryLoader.priority=e),this.m_tileGeometryLoader.update(),!0}loadingFinished(){}attachGeometryLoadedCallback(){(0,a.assert)(void 0!==this.m_tileGeometryLoader),this.m_tileGeometryLoader.waitFinished().then((()=>{this.loadingFinished(),this.removeDecodedTile()})).catch((()=>{this.disposed||this.dataSource.isDetached()||this.mapView.visibleTileSet.disposeTile(this)}))}removeDecodedTile(){this.m_decodedTile=void 0,this.invalidateResourceInfo()}updateBoundingBox(e){e?(this.m_boundingBox.copy(e),this.m_worldCenter.copy(this.boundingBox.position)):this.projection.projectBox(this.geoBox,this.boundingBox)}elevateGeoBox(){var e,t;this.geoBox.southWest.altitude=this.m_elevationRange.minElevation+(null!==(e=this.m_minGeometryHeight)&&void 0!==e?e:0),this.geoBox.northEast.altitude=this.m_elevationRange.maxElevation+(null!==(t=this.m_maxGeometryHeight)&&void 0!==t?t:0)}computeResourceInfo(){let e=0,t=0;const i={heapSize:0,gpuSize:0},n=new Map;for(const e of this.objects)e.visible&&t++,c.Object3DUtils.estimateSize(e,i,n);const r=this.iconTextGroups.count();e+=312*r,void 0!==this.m_decodedTile&&void 0!==this.m_decodedTile.tileInfo&&(i.heapSize+=this.m_decodedTile.tileInfo.numBytes),this.m_resourceInfo={heapSize:i.heapSize+e,gpuSize:i.gpuSize,num3dObjects:t,numIconTexts:r,numUserIconTexts:0}}}},9780:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileObjectRenderer=void 0;const n=i(8152),r=i(1984),s=i(8023),o=i(5863),a=i(8673),l=i(4572);t.TileObjectRenderer=class{constructor(e,t){this.m_env=e,this.m_renderer=t,this.m_renderOrderStencilValues=new Map,this.m_stencilValue=1}render(e,t,i,n,r){const s=e.computeWorldOffsetX();if(e.willRender(t)){for(const t of e.objects){const o=l.MapObjectAdapter.get(t);this.processTileObject(e,i,t,o)&&(this.updateStencilRef(t),t.position.copy(e.center),void 0!==t.displacement&&t.position.add(t.displacement),t.position.x+=s,t.position.sub(n),e.localTangentSpace&&t.setRotationFromMatrix(e.boundingBox.getRotationMatrix()),t.frustumCulled=!1,r.add(t))}e.didRender()}}prepareRender(){this.m_stencilValue=1,this.m_renderOrderStencilValues.clear()}setupRenderer(){const e=(e,t)=>{const i=l.MapObjectAdapter.get(e.object),n=l.MapObjectAdapter.get(t.object);return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:(null==i?void 0:i.tileKey)&&(null==n?void 0:n.tileKey)&&i.tileKey.mortonCode()!==n.tileKey.mortonCode()?i.tileKey.mortonCode()-n.tileKey.mortonCode():e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id};this.m_renderer.setOpaqueSort(((t,i)=>{var n,s,a,c;const h=l.MapObjectAdapter.get(t.object),u=l.MapObjectAdapter.get(i.object),d=null===(n=null==h?void 0:h.dataSource)||void 0===n?void 0:n.dataSourceOrder,m=null===(s=null==u?void 0:u.dataSource)||void 0===s?void 0:s.dataSourceOrder;if(void 0!==d&&void 0!==m&&d!==m)return d-m;if(t.renderOrder===o.BackgroundDataSource.GROUND_RENDER_ORDER||i.renderOrder===o.BackgroundDataSource.GROUND_RENDER_ORDER)return e(t,i);if(h&&u){const n=null===(a=h.tileKey)||void 0===a?void 0:a.level,s=null===(c=u.tileKey)||void 0===c?void 0:c.level;if(void 0!==n&&void 0!==s){const o=void 0!==h.technique&&(0,r.isExtrudedPolygonTechnique)(h.technique)||void 0!==u.technique&&(0,r.isExtrudedPolygonTechnique)(u.technique);return n===s||o?e(t,i):n-s}}return e(t,i)}))}updateStencilRef(e){if(void 0!==e.renderOrder&&e instanceof a.SolidLineMesh){const t=e.material;Array.isArray(t)?t.forEach((t=>t.stencilRef=this.getStencilValue(e.renderOrder))):t.stencilRef=this.getStencilValue(e.renderOrder)}}allocateStencilValue(e){const t=this.m_stencilValue++;return this.m_renderOrderStencilValues.set(e,t),t}getStencilValue(e){var t;return null!==(t=this.m_renderOrderStencilValues.get(e))&&void 0!==t?t:this.allocateStencilValue(e)}processTileObject(e,t,i,n){return!(!i.visible||!this.processTileObjectFeatures(e,t,i)||n&&(n.update(e.mapView),!n.isVisible()&&n.pickability!==r.Pickability.all))}processTileObjectFeatures(e,t,i){var o,a;const c=i.userData,h=l.MapObjectAdapter.get(i);if(!h)return!1;const u=h.technique,d=(0,n.getPropertyValue)(null==u?void 0:u.minZoomLevel,this.m_env),m=(0,n.getPropertyValue)(null==u?void 0:u.maxZoomLevel,this.m_env);if("number"==typeof d&&t<d)return!1;if("number"==typeof m&&t>=m)return!1;if(void 0===(null==u?void 0:u.visible))return!0;const p=c.feature;if(!p||!s.Expr.isExpr(u.visible))return Boolean((0,n.getPropertyValue)(u.visible,this.m_env));const{starts:f,objInfos:g}=p;if(!Array.isArray(g)||!Array.isArray(f))return!0;const v=i.geometry;if(!v||!v.isBufferGeometry)return!0;const _=null!==(a=null===(o=v.getIndex())||void 0===o?void 0:o.count)&&void 0!==a?a:v.attributes.position.count;let y;return v.clearGroups(),g.forEach(((t,i)=>{var o,a;const l=(0,n.getFeatureId)(t);let c=!0;if(s.Expr.isExpr(u.visible)){const i=e.dataSource.getFeatureState(l),s=i?new r.MapEnv(i):null,o="object"==typeof t?new r.MapEnv(t,this.m_env):this.m_env,a=new r.MapEnv({$state:s},o);c=Boolean((0,n.getPropertyValue)(u.visible,a))}if(!c)return;const h=null!==(o=f[i])&&void 0!==o?o:0,d=(null!==(a=f[i+1])&&void 0!==a?a:_)-h;h===y?v.groups[v.groups.length-1].count+=d:v.addGroup(h,d),y=h+d})),v.groups.length>0}}},541:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileOffsetUtils=t.MapViewUtils=void 0;const n=i(2479),r=i(3216),s=i(2754),o=i(3334),a=i(8333),l=i(3850),c=i(9747),h=i(5381),u=i(5448),d=i(6815),m=i(2616),p=i(5610),f=i(4342),g=i(4442),v=i(7987),_=f.LoggerManager.instance.create("MapViewUtils"),y=new d.Vector3(0,0,1),x=new l.Plane(y.clone()),S=new h.Sphere(void 0,p.EarthConstants.EQUATORIAL_RADIUS),b=new r.Raycaster,T={x:new d.Vector3,y:new d.Vector3,z:new d.Vector3},M={x:new d.Vector3,y:new d.Vector3,z:new d.Vector3},w={box3:[new s.Box3],obox3:[new m.OrientedBox3],quaternions:[new c.Quaternion,new c.Quaternion],vector2:[new u.Vector2,new u.Vector2],vector3:[new d.Vector3,new d.Vector3,new d.Vector3,new d.Vector3],matrix4:[new a.Matrix4,new a.Matrix4],transforms:[{xAxis:new d.Vector3,yAxis:new d.Vector3,zAxis:new d.Vector3,position:new d.Vector3}]},E=new n.PerspectiveCamera;var C;!function(e){function t(t,i,n,r,s,a){var l,c,h;const u=g.CameraUtils.getPrincipalPoint(t.camera,w.vector2[0]),p=e.rayCastWorldCoordinates(t,u.x,u.y);if(null===p)return;let f;if("number"==typeof i)f=w.vector2[1].set(i,n);else{const e=i;f=null!==(l=e.center)&&void 0!==l?l:u,r=null!==(c=e.deltaAzimuth)&&void 0!==c?c:0,s=null!==(h=e.deltaTilt)&&void 0!==h?h:0,a=e.maxTiltAngle}const v=f.x===u.x&&f.y===u.y?p:e.rayCastWorldCoordinates(t,f.x,f.y);if(null===v)return;!function(e,t,i){const n=e.camera,r=e.projection.surfaceNormal(t,w.vector3[0]),s=w.quaternions[0].setFromAxisAngle(r,i);n.quaternion.premultiply(s),n.position.sub(t),n.position.applyQuaternion(s),n.position.add(t)}(t,v,-r);const y=new d.Vector3(1,0,0).applyQuaternion(t.camera.quaternion),x=function(e,t,i,n,r,s,a){const l=e.camera,c=e.projection,h=A(c,l,r,a);if(h+i<0)return-h;if(i<=0)return i;if(r.equals(s)||t<0)return(0,o.clamp)(i+h,0,n)-h;const u=A(c,l,s,a),d=(0,o.degToRad)(89);if(u>d)return 0;let p=0;if(c===m.sphereProjection){const e=c.surfaceNormal(s,w.vector3[0]).projectOnPlane(a).normalize(),t=c.surfaceNormal(r,w.vector3[1]);p=e.angleTo(t)}const f=(0,o.degToRad)(90),g=f+p-(2*f-(2*f-(f+p-u+(f+h)))-f-n);return(0,o.clamp)(i+u,0,Math.min(g,d))-u}(t,f.y-u.y,s,a,p,v,y);!function(t,i,n,r){const s=t.camera,o=s.position.clone(),a=s.quaternion.clone(),l=w.quaternions[0].setFromAxisAngle(r,n);s.quaternion.premultiply(l),s.position.sub(i),s.position.applyQuaternion(l),s.position.add(i),null===e.rayCastWorldCoordinates(t,0,0)&&(_.warn("Target got invalidated during rotation."),s.position.copy(o),s.quaternion.copy(a))}(t,v,x,y)}function i(e,t,i){const n=w.vector3[0].copy(e.position),r=e.getWorldDirection(w.vector3[1]);b.set(n,r),void 0!==i&&(x.constant-=i,S.radius+=i);const s=new d.Vector3,o=t.type===m.ProjectionType.Planar?b.ray.intersectPlane(x,s):b.ray.intersectSphere(S,s);return void 0!==i&&(x.constant=0,S.radius=p.EarthConstants.EQUATORIAL_RADIUS),o}function n(t,i,n){const r={target:t,distance:i},s=n.worldMaxBounds,o=n.camera,a=n.projection;if(!s)return r;const l=s.getSize(w.vector3[1]),c=n.renderer.getSize(w.vector2[0]),h=g.CameraUtils.convertScreenToWorldSize(n.focalLength,r.distance,c.height),u=h*o.aspect,p=Math.max(u/l.x,h/l.y),f=new d.Vector3(u/2,h/2,0),v={target:r.target.clone(),distance:r.distance};if(a.type===m.ProjectionType.Planar){if(p>1)v.distance/=p,o.getWorldDirection(o.position).multiplyScalar(-v.distance).add(s.getCenter(v.target));else{if(w.box3[0].copy(s).expandByVector(f.multiplyScalar(-1)).clampPoint(r.target,v.target).setZ(r.target.z),v.target.equals(r.target))return r;o.position.x+=v.target.x-r.target.x,o.position.y+=v.target.y-r.target.y}return v}if(p>1)s.getCenter(v.target),v.target.setLength(r.target.length()),v.distance/=p;else{const e=w.obox3[0];e.copy(s),e.position.setLength(r.target.length()),e.extents.sub(f);const t=e.getRotationMatrix(w.matrix4[0]),i=w.vector3[1].copy(v.target).sub(e.position).applyMatrix4(w.matrix4[1].copy(t).transpose()).setZ(0),n=w.vector3[2].copy(i).clamp(w.vector3[3].copy(e.extents).multiplyScalar(-1),e.extents);if(n.equals(i))return r;v.target.copy(n).applyMatrix4(t).add(e.position);const o=e.position.lengthSq(),a=v.target.distanceToSquared(e.position),l=Math.sqrt(o)-Math.sqrt(o-a);v.target.addScaledVector(e.zAxis,-l),v.target.setLength(r.target.length())}return e.panCameraAroundGlobe(n,w.vector3[1].copy(v.target),w.vector3[2].copy(r.target)),o.getWorldDirection(o.position).multiplyScalar(-v.distance).add(v.target),v}function r(e,t,i,n,r,s=new d.Vector3){const a=(0,o.degToRad)(n),l=Math.cos(a)*t,c=(0,o.degToRad)(i);r.projectPoint(e,s);const h=t*Math.sin(a);if(r.type===m.ProjectionType.Planar)s.x=s.x+Math.sin(c)*h,s.y=s.y-Math.cos(c)*h,s.z=s.z+l;else if(r.type===m.ProjectionType.Spherical){M.z.copy(s).normalize(),M.y.set(0,0,1).projectOnPlane(M.z).normalize(),w.quaternions[0].setFromAxisAngle(M.z,c-Math.PI),M.y.applyQuaternion(w.quaternions[0]),M.y.setLength(h);const e=t*Math.cos(a);s.add(M.y).add(M.z.setLength(e));const i=p.EarthConstants.EQUATORIAL_RADIUS+l,n=Math.sin(a)*t,r=Math.sqrt(i*i+n*n);s.setLength(r)}return s}function s(e,t,i,n){const r=w.vector3[0].set(t,i,0);e.camera.updateMatrixWorld();const s=w.vector3[1].copy(e.camera.position);w.matrix4[0].extractRotation(e.camera.matrixWorld),w.matrix4[1].multiplyMatrices(w.matrix4[0],w.matrix4[1].copy(e.camera.projectionMatrix).invert());const o=r.applyMatrix4(w.matrix4[1]);b.set(s,o.normalize()),void 0!==n&&(x.constant-=n,S.radius+=n);const a=new d.Vector3,l=e.projection.type===m.ProjectionType.Planar?b.ray.intersectPlane(x,a):b.ray.intersectSphere(S,a);return void 0!==n&&(x.constant=0,S.radius=p.EarthConstants.EQUATORIAL_RADIUS),l}function a(e,t,i){e.camera.position.x+=t,e.camera.position.y+=i}function l(e,t,i){w.quaternions[0].setFromUnitVectors(t.normalize(),i.normalize()).invert(),w.matrix4[0].makeRotationFromQuaternion(w.quaternions[0]),e.camera.applyMatrix4(w.matrix4[0]),e.camera.updateMatrixWorld()}function h(e,t,i,n,r=new c.Quaternion){const s=w.transforms[0];return e.localTangentSpace(t,s),w.matrix4[0].makeBasis(s.xAxis,s.yAxis,s.zAxis),r.setFromRotationMatrix(w.matrix4[0]),w.quaternions[0].setFromAxisAngle(w.vector3[1].set(0,0,1),(0,o.degToRad)(i)),w.quaternions[1].setFromAxisAngle(w.vector3[1].set(1,0,0),(0,o.degToRad)(n)),r.multiply(w.quaternions[0]),r.multiply(w.quaternions[1]),r}function y(t,i){if(i.type===m.ProjectionType.Planar){const e=t.getWorldDirection(w.vector3[0]).normalize(),n=i.surfaceNormal(t.position,w.vector3[1]).negate(),r=e.dot(n);return Math.acos((0,o.clamp)(r,-1,1))}{(0,f.assert)(i.type===m.ProjectionType.Spherical);const n=e.getGeoTargetFromCamera(t,i);return null!==n?e.extractTiltAngleFromLocation(i,t,n):(_.warn("MapView camera is pointing in the void, using maxTilt: ",e.MAX_TILT_RAD),e.MAX_TILT_RAD)}}function C(e,t){w.vector3[1].setFromMatrixPosition(t.matrixWorld),e.projection.localTangentSpace(w.vector3[1],{xAxis:M.x,yAxis:M.y,zAxis:M.z,position:w.vector3[0]}),w.matrix4[1].makeBasis(M.x,M.y,M.z),w.matrix4[0].copy(w.matrix4[1]).invert().multiply(t.matrixWorld),T.x.setFromMatrixColumn(w.matrix4[0],0),T.y.setFromMatrixColumn(w.matrix4[0],1),T.z.setFromMatrixColumn(w.matrix4[0],2);let i=0,n=0,r=0;const s=T.z.dot(w.vector3[1].set(0,0,1));return s<1-Number.EPSILON?s>-1+Number.EPSILON?(i=Math.atan2(T.z.x,-T.z.y),n=Math.acos(T.z.z),r=Math.atan2(T.x.z,T.y.z)):(i=-Math.atan2(-T.y.x,T.x.x),n=180,r=0):(i=Math.atan2(-T.y.x,T.x.x),n=0,r=0),{yaw:i,pitch:n,roll:r}}function A(e,t,i,n){e.localTangentSpace(i,{xAxis:M.x,yAxis:M.y,zAxis:M.z,position:w.vector3[0]});const r=w.vector3[2].copy(t.position).sub(w.vector3[0]);n&&(r.projectOnPlane(n),M.z.projectOnPlane(n).normalize());const s=r.length();if(s<1e-5)return _.error("Can not calculate tilt for the zero length vector!"),0;r.divideScalar(s);const a=r.dot(M.z);return a>=1-Number.EPSILON?0:Math.acos((0,o.clamp)(a,-1,1))}function P(e,t){const i=p.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*i/256}e.MAX_TILT_DEG=89,e.MAX_TILT_RAD=e.MAX_TILT_DEG*o.DEG2RAD,e.zoomOnTargetPosition=function(i,r,o,c,h=e.MAX_TILT_RAD){const{elevationProvider:u,camera:d,projection:p}=i,f=u?u.getHeight(p.unprojectPoint(d.position),4):void 0,g=s(i,r,o,f),v=e.getTargetAndDistance(p,d,u).target,_=P(i,c);if(i.geoMaxBounds&&n(v,_,i).distance!==_)return c>=i.zoomLevel;if(d.getWorldDirection(d.position).multiplyScalar(-_).add(v),p.type===m.ProjectionType.Spherical){const e=y(d,p)-h;e>0&&t(i,{deltaTilt:e,maxTiltAngle:h})}const x=s(i,r,o,f);return!g||!x||(p.type===m.ProjectionType.Planar?(g.sub(x),a(i,g.x,g.y)):p.type===m.ProjectionType.Spherical&&l(i,g,x),!0)},e.orbitAroundScreenPoint=t,e.getGeoTargetFromCamera=function(e,t,n){const r=i(e,t,n);return null!==r?t.unprojectPoint(r):null},e.getWorldTargetFromCamera=i,e.constrainTargetAndDistanceToViewBounds=n,e.getTargetAndDistance=function(t,n,r){const s=C({projection:t},n).pitch,o=r?r.getHeight(t.unprojectPoint(n.position),4):void 0,a=!r||void 0!==o,l=s<e.MAX_TILT_RAD?i(n,t,o):null;if(null!==l)return{target:l,distance:n.position.distanceTo(l),final:a};{const i=t.groundDistance(n.position),r=Math.max(i-(null!=o?o:0),0),l=t.type===m.ProjectionType.Planar?r/Math.cos(Math.min(s,e.MAX_TILT_RAD)):Math.sqrt(Math.pow(r+p.EarthConstants.EQUATORIAL_RADIUS,2)-Math.pow(p.EarthConstants.EQUATORIAL_RADIUS,2)),c=n.getWorldDirection(w.vector3[0]);c.multiplyScalar(l);const h=w.vector3[1];return h.copy(n.position).add(c),{target:h,distance:l,final:a}}},e.getCameraPositionFromTarget=r,e.wrapGeoPointsToScreen=function(e,t){let i=0;void 0===t&&(t=m.GeoCoordinates.fromObject(e[0]),i=1);let n=t.latitude,r=t.latitude,s=m.MathUtils.normalizeLongitudeDeg(t.longitude),o=0,a=t.longitude,l=t.longitude;const c=[];c.push(new m.GeoCoordinates(n,s));for(let t=i;t<e.length;t++){const i=m.GeoCoordinates.fromObject(e[t]);i.latitude>n?n=i.latitude:i.latitude<r&&(r=i.latitude);let h=m.MathUtils.normalizeLongitudeDeg(i.longitude);const u=m.MathUtils.angleDistanceDeg(s,h);h=s-u,u<0&&-u>o/2?(a=Math.max(a,s-u),o=a-l,s=(a+l)/2):u>0&&u>o/2&&(l=Math.min(l,h),o=a-l,s=(a+l)/2),c.push(new m.GeoCoordinates(i.latitude,h))}return c},e.wrapWorldPointsToView=function(e,t){const i=t.clone().normalize();for(const n of e)if(n.angleTo(t)>Math.PI/2){const e=n.length();n.projectOnPlane(i).setLength(e)}},e.geoBoxToGeoPoints=function(e){const t=e.center;return[new m.GeoCoordinates(e.north,e.west),new m.GeoCoordinates(e.north,e.east),new m.GeoCoordinates(t.latitude,e.west),new m.GeoCoordinates(t.latitude,e.east),new m.GeoCoordinates(e.south,e.west),new m.GeoCoordinates(e.south,e.east),new m.GeoCoordinates(e.north,t.longitude),new m.GeoCoordinates(e.south,t.longitude)]},e.getCameraCoordinatesFromTargetCoordinates=function(e,t,i,n,s){return s.projection.unprojectPoint(r(e,t,i,n,s.projection,w.vector3[1]))},e.rayCastWorldCoordinates=s,e.panCameraAboveFlatMap=a,e.panCameraAroundGlobe=l,e.rotate=function(t,i,n=0,r=Math.PI/4){if(t.camera.rotateOnWorldAxis(t.projection.type===m.ProjectionType.Spherical?w.vector3[0].copy(t.camera.position).normalize():w.vector3[0].set(0,0,1),(0,o.degToRad)(-i)),t.camera.updateMatrixWorld(),0===n)return;const s=e.extractAttitude(t,t.camera).pitch;let a=(0,o.clamp)(s+(0,o.degToRad)(n),0,r);if(t.projection.type===m.ProjectionType.Spherical){const e=Math.asin(p.EarthConstants.EQUATORIAL_RADIUS*Math.sin(Math.PI-r)/t.camera.position.length());a=Math.min(a,e)}t.camera.rotateX(a-s)},e.getCameraRotationAtTarget=h,e.setRotation=function(e,t,i){h(e.projection,e.geoCenter,t,i,e.camera.quaternion)},e.extractCameraTilt=y,e.extractAttitude=C,e.extractSphericalCoordinatesFromLocation=function(e,t,i){e.projection.localTangentSpace(i,{xAxis:M.x,yAxis:M.y,zAxis:M.z,position:w.vector3[0]});let n=0,r=0;return w.vector3[1].copy(t.position).sub(w.vector3[0]).normalize(),w.vector3[1].dot(M.z)>1-Number.EPSILON?(r=Math.PI-C(e,t).yaw,r=Math.atan2(Math.sin(r),Math.cos(r)),n=0,{tilt:n,azimuth:r}):(n=w.vector3[1].angleTo(M.z),w.vector3[1].copy(t.position).sub(w.vector3[0]).projectOnPlane(M.z).normalize(),r=w.vector3[1].angleTo(M.y),w.vector3[1].cross(M.y).dot(M.z)<0&&(r=-r),{tilt:n,azimuth:r})},e.extractTiltAngleFromLocation=A,e.getCameraFrustumPlanes=function(e){const t=e.near,i=e.far;let n=t*Math.tan((0,o.degToRad)(.5*e.fov))/e.zoom,r=2*n,s=e.aspect*r,a=-.5*s;const l=e.view;if(null!==l&&l.enabled){const e=l.fullWidth,t=l.fullHeight;a+=l.offsetX*s/e,n-=l.offsetY*r/t,s*=l.width/e,r*=l.height/t}return a+=0!==e.filmOffset?t*e.filmOffset/e.getFilmWidth():0,{left:a,right:a+s,top:n,bottom:n-r,near:t,far:i}},e.rayCastGeoCoordinates=function(e,t,i){const n=s(e,t,i);return n?e.projection.unprojectPoint(n):null},e.calculateDistanceToGroundFromZoomLevel=function(e,t){const i=C(e,e.camera).pitch,n=p.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*n/256*Math.cos(i)},e.calculateDistanceFromZoomLevel=P,e.calculateZoomLevelFromDistance=function(e,t){const i=256*t/e.focalLength;return function(e){const t=Math.ceil(e);return t-e<1e-6?t:e}((0,o.clamp)(Math.log2(p.EarthConstants.EQUATORIAL_CIRCUMFERENCE/i),e.minZoomLevel,e.maxZoomLevel))},e.calculateDepthFromClipDistance=function(e,t){const i=t,n=i.far-i.near,r=e*i.far;return(1-i.near/r)*(i.far/n)},e.cameraToWorldDistance=function(e,t){return e*t.far},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return E.fov=(0,o.radToDeg)(e),E.aspect=t,g.CameraUtils.getHorizontalFov(E)},e.calculateFocalLengthByVerticalFov=function(e,t){return g.CameraUtils.setPrincipalPoint(E,new u.Vector2),g.CameraUtils.setVerticalFov(E,e,t),g.CameraUtils.getFocalLength(E)},e.calculateFovByFocalLength=function(e,t){return g.CameraUtils.setPrincipalPoint(E,new u.Vector2),g.CameraUtils.setFocalLength(E,e,t),E.fov},e.calculateScreenSizeByFocalLength=g.CameraUtils.convertWorldToScreenSize,e.calculateWorldSizeByFocalLength=g.CameraUtils.convertScreenToWorldSize,e.estimateObject3dSize=v.Object3DUtils.estimateSize,e.mapViewIsLoading=function(e){let t=0;for(const i of e.visibleTileSet.dataSourceTileList){t+=i.numTilesLoading;for(const e of i.visibleTiles)e.allGeometryLoaded||t++}let i=t>0;return void 0!==e.iconTextRenderer&&(i=i||e.iconTextRenderer.loading),i=i||!e.visibleTileSet.allVisibleTilesLoaded,i},e.closeToFrustum=function(e,t,i=1e-13){const n=(new d.Vector3).copy(e).project(t);return Math.abs(n.x)-i<1&&Math.abs(n.y)-i<1&&Math.abs(n.z)-i<1},e.getBrowserLanguages=f.DOMUtils.getBrowserLanguages}(t.MapViewUtils||(t.MapViewUtils={})),(C=t.TileOffsetUtils||(t.TileOffsetUtils={})).getKeyForTileKeyAndOffset=m.TileKeyUtils.getKeyForTileKeyAndOffset,C.extractOffsetAndMortonKeyFromKey=m.TileKeyUtils.extractOffsetAndMortonKeyFromKey,C.getParentKeyFromKey=m.TileKeyUtils.getParentKeyFromKey},5008:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibleTileSet=t.ResourceComputationType=void 0;const n=i(2479),r=i(2616),s=i(8263),o=i(4342),a=i(5863),l=i(8502);var c,h;!function(e){e[e.EstimationInMb=0]="EstimationInMb",e[e.NumberOfTiles=1]="NumberOfTiles"}(c=t.ResourceComputationType||(t.ResourceComputationType={})),function(e){e[e.NONE=0]="NONE",e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.BOTH=3]="BOTH"}(h||(h={}));const u=1/1048576;class d{static getKey(e,t,i){return`${i.name}_${e}_${t}`}static getKeyForTile(e){return d.getKey(e.tileKey.mortonCode(),e.offset,e.dataSource)}constructor(e,t=c.EstimationInMb){this.m_disposedTiles=[],this.m_resourceComputationType=t,this.m_tileCache=new s.LRUCache(e,(e=>this.m_resourceComputationType===c.EstimationInMb?e.memoryUsage*u:1)),this.m_tileCache.evictionCallback=(e,t)=>{void 0!==t.tileLoader&&t.tileLoader.cancel(),this.m_disposedTiles.push(t)},this.m_tileCache.canEvict=(e,t)=>!t.isVisible}get resourceComputationType(){return this.m_resourceComputationType}get capacity(){return this.m_tileCache.capacity}get size(){return this.m_tileCache.size}setCapacity(e,t){this.m_resourceComputationType=t,this.m_tileCache.setCapacityAndMeasure(e,(e=>this.m_resourceComputationType===c.EstimationInMb?e.memoryUsage*u:1))}get(e,t,i){return this.m_tileCache.get(d.getKey(e,t,i))}set(e,t,i,n){this.m_tileCache.set(d.getKey(e,t,i),n)}delete(e){const t=d.getKeyForTile(e);this.deleteByKey(t)}deleteByKey(e){this.m_tileCache.delete(e)}disposeTiles(){this.m_disposedTiles.forEach((e=>{e.dispose()})),this.m_disposedTiles.length=0}shrinkToCapacity(){this.m_tileCache.shrinkToCapacity()}evictAll(){this.m_tileCache.evictAll()}evictSelected(e){this.m_tileCache.evictSelected(e)}forEach(e,t){this.m_tileCache.forEach(((i,n)=>{void 0!==t&&i.dataSource!==t||e(i,n)}))}}const m=(e,t)=>{const i=e.distance-t.distance,n=1e-6*(e.distance+t.distance);return Math.abs(i)<n?e.tileKey.mortonCode()-t.tileKey.mortonCode():i};t.VisibleTileSet=class{constructor(e,t,i){var r;this.m_frustumIntersection=e,this.m_tileGeometryManager=t,this.options=i,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_cameraOverride=new n.PerspectiveCamera,this.m_viewRange={near:.1,far:1/0,minimum:.1,maximum:1/0},this.m_coveringMap=new Map,this.m_resourceComputationType=c.EstimationInMb,this.options=i,this.options.maxTilesPerFrame=Math.floor(null!==(r=this.options.maxTilesPerFrame)&&void 0!==r?r:0),this.m_resourceComputationType=void 0===i.resourceComputationType?c.EstimationInMb:i.resourceComputationType,this.m_dataSourceCache=new d(this.options.tileCacheSize,this.m_resourceComputationType)}getDataSourceCacheSize(){return this.options.tileCacheSize}setDataSourceCacheSize(e,t=c.EstimationInMb){this.options.tileCacheSize=e,this.resourceComputationType=t}getNumberOfVisibleTiles(){return this.options.maxVisibleDataSourceTiles}setNumberOfVisibleTiles(e){this.options.maxVisibleDataSourceTiles=e}get maxTilesPerFrame(){return this.options.maxTilesPerFrame}set maxTilesPerFrame(e){if(e<0)throw new Error("Invalid value, this will result in no tiles ever showing");this.options.maxTilesPerFrame=Math.floor(e)}get resourceComputationType(){return this.m_resourceComputationType}set resourceComputationType(e){this.m_resourceComputationType=e,this.m_dataSourceCache.setCapacity(this.options.tileCacheSize,e)}updateClipPlanes(e,t){void 0!==e&&(this.options.clipPlanesEvaluator.maxElevation=e),void 0!==t&&(this.options.clipPlanesEvaluator.minElevation=t);const{camera:i,projection:n,elevationProvider:r}=this.m_frustumIntersection.mapView;return this.m_viewRange=this.options.clipPlanesEvaluator.evaluateClipPlanes(i,n,r),this.m_viewRange}updateRenderList(e,t,i,n,r){let s=!0;const a=this.getVisibleTileKeysForDataSources(t,i,r);this.dataSourceTileList=[],this.m_coveringMap.clear();for(const{dataSource:i,visibleTileKeys:r}of a.tileKeys){r.sort(m);const o=i.getDataZoomLevel(t),a=this.processVisibleTiles(r,i,n,{newTilesPerFrame:0},!0),l=this.processVisibleTiles(a.dependentTiles,i,n,{newTilesPerFrame:0},!1);this.m_tileGeometryManager.updateTiles(a.visibleTiles),this.m_tileGeometryManager.updateTiles(l.visibleTiles),this.dataSourceTileList.push({dataSource:i,storageLevel:e,zoomLevel:o,allVisibleTileLoaded:a.allDataSourceTilesLoaded&&l.allDataSourceTilesLoaded,numTilesLoading:a.numTilesLoading+l.numTilesLoading,visibleTiles:[...a.visibleTiles,...l.visibleTiles],renderedTiles:new Map}),s=s&&a.allDataSourceTilesLoaded}let l,c;this.allVisibleTilesLoaded=s&&a.allBoundingBoxesFinal,this.populateRenderedTiles(),this.forEachCachedTile((e=>{e.isVisible||e.allGeometryLoaded||this.disposeTile(e)})),this.m_dataSourceCache.shrinkToCapacity(),this.dataSourceTileList.forEach((e=>{e.renderedTiles.forEach((t=>{t.update(e.zoomLevel),l=o.MathUtils.min2(l,t.geoBox.minAltitude),c=o.MathUtils.max2(c,t.geoBox.maxAltitude)}))})),void 0===l&&(l=0),void 0===c&&(c=0);let h=!1;const u=this.m_viewRange,d=this.updateClipPlanes(c,l);var p,f;return h=0==(f=u,(p=d).far===f.far&&p.maximum===f.maximum&&p.minimum===f.minimum&&p.near===f.near),{viewRanges:d,viewRangesChanged:h}}getTile(e,t,i,n){return this.getTileImpl(e,t,i,!1,n)}getCachedTile(e,t,i,n){return(0,o.assert)(e.cacheable),this.getTileImpl(e,t,i,!0,n)}getRenderedTile(e,t,i=0){const n=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0!==n)return n.renderedTiles.get(r.TileKeyUtils.getKeyForTileKeyAndOffset(t,i))}getRenderedTileAtLocation(e,t,i=0){const n=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0===n)return;const s=e.getTilingScheme(),o=n.zoomLevel,a=s.getTileKey(t,o);if(!a)return;let l=n.renderedTiles.get(r.TileKeyUtils.getKeyForTileKeyAndOffset(a,i));if(void 0!==l)return l;const{searchLevelsUp:c,searchLevelsDown:h}=this.getSearchDirection(e,o);let u=a;for(let e=1;e<=c;++e)if(u=u.parent(),l=n.renderedTiles.get(r.TileKeyUtils.getKeyForTileKeyAndOffset(u,i)),void 0!==l)return l;const d=s.projection.projectPoint(t);for(let e=1;e<=h;++e){const t=o+e,a=r.TileKeyUtils.worldCoordinatesToTileKey(s,d,t);if(a&&(l=n.renderedTiles.get(r.TileKeyUtils.getKeyForTileKeyAndOffset(a,i)),void 0!==l))return l}}removeDataSource(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter((t=>t.dataSource!==e))}clearTileCache(e,t){void 0!==e?this.m_dataSourceCache.evictSelected(((i,n)=>i.dataSource===e&&(void 0===t||t(i)))):void 0!==t?this.m_dataSourceCache.evictSelected(t):this.m_dataSourceCache.evictAll()}markTilesDirty(e,t){if(void 0===e)this.dataSourceTileList.forEach((e=>{this.markDataSourceTilesDirty(e,t)}));else{const i=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0===i)return;this.markDataSourceTilesDirty(i,t)}}disposePendingTiles(){this.m_dataSourceCache.disposeTiles()}forEachVisibleTile(e){for(const t of this.dataSourceTileList)t.renderedTiles.forEach(e)}forEachCachedTile(e,t){this.m_dataSourceCache.forEach(((t,i)=>e(t)),t)}disposeTile(e){this.m_dataSourceCache.delete(e),e.dispose()}processVisibleTiles(e,t,i,n,r){var s;let o=!0,a=0;const c=[],h=[];for(let u=0;u<e.length&&c.length<this.options.maxVisibleDataSourceTiles;u++){const d=e[u],m=this.getTile(t,d.tileKey,d.offset,i);if(void 0!==m&&(c.push(m),o=o&&m.allGeometryLoaded,m.allGeometryLoaded?(this.skipOverlappedTiles(t,m),this.processDelayTileRendering(m,n.newTilesPerFrame,i)&&n.newTilesPerFrame++):a++,m.visibleArea=d.area,m.elevationRange=null!==(s=d.elevationRange)&&void 0!==s?s:{minElevation:0,maxElevation:0},r))for(const t of m.dependencies)void 0===e.find((e=>e.tileKey.mortonCode()===t.mortonCode()))&&void 0===h.find((e=>e.tileKey.mortonCode()===t.mortonCode()))&&h.push(new l.TileKeyEntry(t,0))}return{allDataSourceTilesLoaded:o,numTilesLoading:a,visibleTiles:c,dependentTiles:h}}processDelayTileRendering(e,t,i){let n=!1;return 0!==this.options.maxTilesPerFrame&&t>this.options.maxTilesPerFrame&&e.frameNumLastVisible!==i-1?(e.delayRendering=!0,e.mapView.update()):(e.frameNumVisible<0&&(e.frameNumVisible=i,n=!0),e.numFramesVisible++,e.delayRendering=!1),n}skipOverlappedTiles(e,t){if(this.options.projection.type!==r.ProjectionType.Spherical&&e.isFullyCovering()){const i=t.uniqueKey,n=this.m_coveringMap.get(i);void 0===n?(t.skipRendering=!1,this.m_coveringMap.set(i,t)):n.dataSource instanceof a.BackgroundDataSource?n.skipRendering=!0:e instanceof a.BackgroundDataSource&&(t.skipRendering=!0)}}getSearchDirection(e,t){const i=Math.min(this.options.quadTreeSearchDistanceUp,Math.max(0,t-e.minDataLevel)),n=Math.min(this.options.quadTreeSearchDistanceDown,Math.max(0,e.maxDataLevel-t));return{searchDirection:n>0&&i>0?h.BOTH:n>0?h.DOWN:i>0?h.UP:h.NONE,searchLevelsUp:i,searchLevelsDown:n}}populateRenderedTiles(){this.dataSourceTileList.forEach((e=>{const t=e.renderedTiles,i=[];e.visibleTiles.forEach((e=>{e.levelOffset=0,e.hasGeometry&&!e.delayRendering?t.set(e.uniqueKey,e):i.push(e.uniqueKey)}));const n=e.dataSource;if(0===i.length||!1===n.allowOverlappingTiles)return;const r=e.zoomLevel,{searchDirection:s}=this.getSearchDirection(n,r),o=new Map;for(const e of i)(s!==h.BOTH&&s!==h.UP||!this.findUp(e,r,t,o,n))&&(s!==h.BOTH&&s!==h.DOWN||this.findDown(e,r,t,n))}))}findDown(e,t,i,n){const{offset:s,mortonCode:o}=r.TileKeyUtils.extractOffsetAndMortonKeyFromKey(e),a=r.TileKey.fromMortonCode(o),l=n.getTilingScheme();for(const e of l.getSubTileKeys(a)){const o=r.TileKeyUtils.getKeyForTileKeyAndOffset(e,s),a=this.m_dataSourceCache.get(e.mortonCode(),s,n),l=Math.abs(e.level-t);void 0===a||!a.hasGeometry||a.delayRendering?l<this.options.quadTreeSearchDistanceDown&&this.findDown(o,t,i,n):(i.set(o,a),a.levelOffset=l)}}findUp(e,t,i,n,s){const o=r.TileKeyUtils.getParentKeyFromKey(e);if(void 0!==i.get(o))return!0;const a=n.get(o);if(void 0!==a)return a;const{offset:l,mortonCode:c}=r.TileKeyUtils.extractOffsetAndMortonKeyFromKey(o),h=this.m_dataSourceCache.get(c,l,s),u=h?h.tileKey:r.TileKey.fromMortonCode(c),d=Math.abs(t-u.level);if(void 0!==h&&h.hasGeometry&&!h.delayRendering)return n.set(o,!0),i.set(o,h),h.levelOffset=-d,!0;if(n.set(o,!1),d<this.options.quadTreeSearchDistanceUp&&0!==u.level){const e=this.findUp(o,t,i,n,s);if(n.set(o,e),e)return!0}return!1}getTileImpl(e,t,i,n,r){function s(e){e.frameNumLastRequested=r}if(!e.cacheable&&!n){const i=e.getTile(t,!0);return void 0!==i&&(i.load(),s(i)),i}const o=this.m_dataSourceCache;let a=o.get(t.mortonCode(),i,e);return void 0!==a&&a.offset===i?(s(a),a):n?void 0:(a=e.getTile(t,!0),void 0!==a&&(a.load(),a.offset=i,s(a),o.set(t.mortonCode(),i,e,a)),a)}markDataSourceTilesDirty(e,t){const i=this.m_dataSourceCache,n=new Set,r=e=>{const t=d.getKeyForTile(e);n.has(t)||(n.add(t),e.load(!0))};e.visibleTiles.forEach((e=>{(void 0===t||t(e))&&r(e)})),e.renderedTiles.forEach((e=>{(void 0===t||t(e))&&r(e)})),i.forEach(((e,r)=>{void 0!==t&&!t(e)||n.has(r)||(i.deleteByKey(r),e.dispose())}),e.dataSource)}getVisibleTileKeysForDataSources(e,t,i){const n=Array();let r=!0;if(0===t.length)return{tileKeys:n,allBoundingBoxesFinal:r};const s=new Map;t.forEach((e=>{const t=e.getTilingScheme(),i=s.get(t);void 0===i?s.set(t,[e]):i.push(e)})),void 0!==i?(this.m_cameraOverride.copy(this.m_frustumIntersection.camera),this.m_cameraOverride.near=Math.min(this.m_cameraOverride.near,this.m_viewRange.minimum),this.m_cameraOverride.far=Math.max(this.m_cameraOverride.far,this.m_viewRange.maximum),this.m_cameraOverride.updateProjectionMatrix(),this.m_frustumIntersection.updateFrustum(this.m_cameraOverride.projectionMatrix)):this.m_frustumIntersection.updateFrustum();for(const[t,o]of s){const s=o.map((t=>t.getDataZoomLevel(e))),a=this.m_frustumIntersection.compute(t,i,s,o);r=r&&a.calculationFinal;for(const t of o){const i=[],r=t.getDataZoomLevel(e);for(const e of a.tileKeyEntries.get(r).values())t.canGetTile(r,e.tileKey)&&i.push(e);n.push({dataSource:t,visibleTileKeys:i})}}return{tileKeys:n,allBoundingBoxesFinal:r}}}},9931:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedDecoder=void 0;const n=i(8152);let r=0;t.WorkerBasedDecoder=class{constructor(e,t){this.workerSet=e,this.decoderServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.decoderServiceType}-${r++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch((()=>{})),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.decoderServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}decodeTile(e,t,i,r){const s=t.mortonCode(),o={type:n.WorkerDecoderProtocol.Requests.DecodeTileRequest,tileKey:s,data:e,projection:(0,n.getProjectionName)(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,r)}getTileInfo(e,t,i,r){const s=t.mortonCode(),o={type:n.WorkerDecoderProtocol.Requests.TileInfoRequest,tileKey:s,data:e,projection:(0,n.getProjectionName)(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,r)}configure(e,t){const i=Object.assign(Object.assign({service:this.serviceId,type:n.WorkerDecoderProtocol.DecoderMessageName.Configuration},e),{options:t});this.workerSet.broadcastMessage(i)}get workerCount(){return this.workerSet.workerCount}}},3373:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedTiler=void 0;const n=i(8152);let r=0;t.WorkerBasedTiler=class{constructor(e,t){this.workerSet=e,this.tilerServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.tilerServiceType}-${r++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch((()=>{})),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:n.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.tilerServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}registerIndex(e,t){const i={type:n.WorkerTilerProtocol.Requests.RegisterIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}updateIndex(e,t){const i={type:n.WorkerTilerProtocol.Requests.UpdateIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}getTile(e,t){const i=t.mortonCode(),r={type:n.WorkerTilerProtocol.Requests.TileRequest,index:e,tileKey:i};return this.workerSet.invokeRequest(this.serviceId,r)}}},2453:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LowResRenderPass=void 0;const n=i(9896),r=i(6271),s=i(8817),o=i(5269),a=i(5117),l=i(5808),c=i(4250),h=i(2331);class u extends h.Pass{constructor(e){super(),this.lowResPixelRatio=e,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new l.Scene,this.m_quadUniforms=c.CopyShader.uniforms,this.m_quadMaterial=new c.CopyMaterial(this.m_quadUniforms),this.m_quad=new o.Mesh(new s.PlaneGeometry(2,2),this.m_quadMaterial),this.m_savedWidth=0,this.m_savedHeight=0,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad),this.m_pixelRatio=e}dispose(){this.m_quadMaterial.dispose(),this.m_quad.geometry.dispose(),null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}set pixelRatio(e){this.m_pixelRatio=e,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio))}get pixelRatio(){return this.m_pixelRatio}render(e,t,i,n,s){if(!this.enabled||void 0===this.pixelRatio)return;null===this.m_renderTarget&&(this.m_savedWidth=s.width,this.m_savedHeight=s.height,this.m_renderTarget=new a.WebGLRenderTarget(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio),{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat,depthBuffer:!0,stencilBuffer:!0}),this.m_renderTarget.texture.name="LowResRenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture,this.m_quadUniforms.opacity.value=1;const o=e.getRenderTarget();e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:n),e.clear(),e.render(this.m_quadScene,this.m_localCamera),e.setRenderTarget(o)}setSize(e,t){this.m_savedWidth=e,this.m_savedHeight=t,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(e*this.pixelRatio),Math.floor(t*this.pixelRatio))}}t.LowResRenderPass=u},818:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAARenderPass=t.MSAASampling=void 0;const n=i(9896),r=i(6271),s=i(8817),o=i(5269),a=i(5117),l=i(5808),c=i(5971),h=i(4250),u=i(2331);var d;!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(d=t.MSAASampling||(t.MSAASampling={}));class m extends u.Pass{constructor(){super(),this.samplingLevel=d.Level_1,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new l.Scene,this.m_quadUniforms=h.CopyShader.uniforms,this.m_quadMaterial=new h.MSAAMaterial(this.m_quadUniforms),this.m_quad=new o.Mesh(new s.PlaneGeometry(2,2),this.m_quadMaterial),this.m_tmpColor=new c.Color,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad)}dispose(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}render(e,t,i,n,s){if(!this.enabled)return;null===this.m_renderTarget&&(this.m_renderTarget=new a.WebGLRenderTarget(s.width,s.height,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;const o=m.OffsetVectors[this.samplingLevel],l=e.getClearColor(this.m_tmpColor),c=void 0!==l?l.getHex():0,h={enabled:null!==i.view&&i.view.enabled,fullWidth:s.width,fullHeight:s.height,x:0,y:0,width:s.width,height:s.height};h.enabled&&null!==i.view&&(h.fullWidth=i.view.fullWidth,h.fullHeight=i.view.fullHeight,h.x=i.view.offsetX,h.y=i.view.offsetY,h.width=i.view.width,h.height=i.view.height);const u=e.getRenderTarget();for(let r=0;r<o.length;r++){const s=o[r];i.setViewOffset(h.fullWidth,h.fullHeight,h.x+s[0]/16,h.y+s[1]/16,h.width,h.height);const a=(r+.5)/o.length-.5,u=1/o.length+a/32;this.m_quadUniforms.opacity.value=u,e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:n),0===r&&(e.setClearColor(0),e.clear()),e.render(this.m_quadScene,this.m_localCamera),0===r&&void 0!==l&&e.setClearColor(c)}e.setRenderTarget(u),null!==i.view&&(i.view.enabled=h.enabled,i.view.offsetX=h.x,i.view.offsetY=h.y)}setSize(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)}}t.MSAARenderPass=m,m.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]},9886:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapRenderingManager=void 0;const n=i(5448),r=i(5117),s=i(4250),o=i(2453),a=i(818),l=i(8794),c=i(2331),h=i(6721),u=a.MSAASampling.Level_1,d=a.MSAASampling.Level_4;t.MapRenderingManager=class{constructor(e,t,i,n={msaaEnabled:!1}){this.bloom={enabled:!1,strength:1.5,radius:.4,threshold:.85},this.outline={enabled:!1,thickness:.005,color:"#000000",ghostExtrudedPolygons:!1,needsUpdate:!1},this.vignette={enabled:!1,offset:1,darkness:1},this.sepia={enabled:!1,amount:.5},this.m_width=1,this.m_height=1,this.m_renderPass=new c.RenderPass,this.m_target1=new r.WebGLRenderTarget(1,1),this.m_target2=new r.WebGLRenderTarget(1,1),this.m_sepiaPass=new c.ShaderPass(s.SepiaShader),this.m_vignettePass=new c.ShaderPass(s.VignetteShader),this.m_readBuffer=new r.WebGLRenderTarget(e,t),this.m_msaaPass=new a.MSAARenderPass,this.m_msaaPass.enabled=void 0!==n&&!0===n.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===n.dynamicMsaaSamplingLevel?u:n.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===n.staticMsaaSamplingLevel?d:n.staticMsaaSamplingLevel,this.m_lowResPass=new o.LowResRenderPass(i),this.m_lowResPass.enabled=void 0!==i}updateOutline(e){this.outline.color=e.color,this.outline.thickness=e.thickness,this.outline.ghostExtrudedPolygons=e.ghostExtrudedPolygons,this.outline.needsUpdate=!0}render(e,t,i,r){if(!r&&void 0!==this.m_lowResPass.pixelRatio)return this.m_lowResPass.renderToScreen=!0,void this.m_lowResPass.render(e,t,i,null,this.m_readBuffer);const s=this.bloom.enabled||this.outline.enabled||this.vignette.enabled||this.sepia.enabled;let o=null;if((this.bloom.enabled||this.vignette.enabled||this.sepia.enabled)&&(e.setRenderTarget(this.m_target1),e.clearDepth()),this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=r?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!s,this.m_msaaPass.render(e,t,i,null,this.m_readBuffer)):this.bloom.enabled||this.vignette.enabled||this.sepia.enabled?(o=this.m_target1,this.m_renderPass.render(e,t,i,this.m_target1,null)):(!this.outline.enabled||this.outline.enabled&&!this.bloom.enabled)&&e.render(t,i),this.outline.enabled){void 0===this.m_outlineEffect&&(this.m_outlineEffect=new l.OutlineEffect(e)),this.outline.needsUpdate&&(this.m_outlineEffect.color=this.outline.color,this.m_outlineEffect.thickness=this.outline.thickness,this.m_outlineEffect.ghostExtrudedPolygons=this.outline.ghostExtrudedPolygons,this.outline.needsUpdate=!1);const n=this.bloom.enabled||this.vignette.enabled||this.sepia.enabled;n&&(o=this.m_target1),e.setRenderTarget(n?o:null),this.m_outlineEffect.render(t,i)}if(this.bloom.enabled){void 0===this.m_bloomPass&&(this.m_bloomPass=new h.BloomPass(new n.Vector2(this.m_width,this.m_height),this.bloom.strength,this.bloom.radius,this.bloom.threshold));const r=this.vignette.enabled||this.sepia.enabled;this.m_bloomPass.renderToScreen=!r,this.m_bloomPass.radius=this.bloom.radius,this.m_bloomPass.strength=this.bloom.strength,this.m_bloomPass.threshold=this.bloom.threshold,this.m_bloomPass.render(e,t,i,null,o)}else void 0!==this.m_bloomPass&&(this.m_bloomPass.dispose(),this.m_bloomPass=void 0);if(this.vignette.enabled){const n=o,r=this.sepia.enabled;this.m_vignettePass.uniforms.offset.value=this.vignette.offset,this.m_vignettePass.uniforms.darkness.value=this.vignette.darkness,this.m_vignettePass.renderToScreen=!r,r&&(o=o===this.m_target1?this.m_target2:this.m_target1),this.m_vignettePass.render(e,t,i,o,n)}this.sepia.enabled&&(this.m_sepiaPass.renderToScreen=!0,this.m_sepiaPass.uniforms.amount.value=this.sepia.amount,this.m_sepiaPass.render(e,t,i,null,o))}setSize(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t),void 0!==this.m_bloomPass&&this.m_bloomPass.setSize(e,t),this.m_lowResPass.setSize(e,t),this.m_target1.setSize(e,t),this.m_target2.setSize(e,t),this.m_width=e,this.m_height=t}get lowResPixelRatio(){return this.m_lowResPass.pixelRatio}set lowResPixelRatio(e){this.m_lowResPass.pixelRatio=e,this.m_lowResPass.enabled=void 0!==e}set dynamicMsaaSamplingLevel(e){this.m_dynamicMsaaSamplingLevel=e}get dynamicMsaaSamplingLevel(){return this.m_dynamicMsaaSamplingLevel}set msaaEnabled(e){this.m_msaaPass.enabled=e}get msaaEnabled(){return this.m_msaaPass.enabled}set staticMsaaSamplingLevel(e){this.m_staticMsaaSamplingLevel=e}get staticMsaaSamplingLevel(){return this.m_staticMsaaSamplingLevel}}},8794:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlineEffect=void 0;const n=i(6271),r=i(1498),s=i(5971),o=i(9984),a=i(4250),l=i(4342);t.OutlineEffect=class{constructor(e){this.m_renderer=e,this.enabled=!0,this.m_defaultThickness=.02,this.m_defaultColor=new s.Color(0,0,0),this.m_defaultAlpha=1,this.m_defaultKeepAlive=!1,this.m_ghostExtrudedPolygons=!1,this.m_cache={},this.m_removeThresholdCount=60,this.m_originalMaterials={},this.m_originalOnBeforeRenders={},this.m_shaderIDs={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},this.m_uniformsChunk={outlineThickness:{value:this.m_defaultThickness},outlineColor:{value:this.m_defaultColor},outlineAlpha:{value:this.m_defaultAlpha}},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap}set thickness(e){this.m_defaultThickness=e,this.m_uniformsChunk.outlineThickness.value=e,this.m_cache={}}set color(e){this.m_defaultColor.set(e),this.m_cache={}}set ghostExtrudedPolygons(e){this.m_ghostExtrudedPolygons=e}clear(e,t,i){this.m_renderer.clear(e,t,i)}getPixelRatio(){return this.m_renderer.getPixelRatio()}setPixelRatio(e){this.m_renderer.setPixelRatio(e)}getSize(e){return this.m_renderer.getSize(e)}setSize(e,t,i){this.m_renderer.setSize(e,t,i)}setViewport(e,t,i,n){this.m_renderer.setViewport(e,t,i,n)}setScissor(e,t,i,n){this.m_renderer.setScissor(e,t,i,n)}setScissorTest(e){this.m_renderer.setScissorTest(e)}setRenderTarget(e){this.m_renderer.setRenderTarget(e)}render(e,t){if(this.m_ghostExtrudedPolygons){if(!this.enabled)return void this.m_renderer.render(e,t);const i=this.m_renderer.autoClear;this.m_renderer.autoClear=this.autoClear,this.m_renderer.render(e,t),this.m_renderer.autoClear=i}this.renderOutline(e,t)}renderOutline(e,t){const i=this.m_renderer.autoClear,n=e.matrixWorldAutoUpdate,r=e.background,s=this.m_renderer.shadowMap.enabled;e.matrixWorldAutoUpdate=!1,e.background=null,this.m_renderer.autoClear=!1,this.m_renderer.shadowMap.enabled=!1,e.traverse(this.setOutlineMaterial.bind(this)),this.m_renderer.render(e,t),e.traverse(this.restoreOriginalMaterial.bind(this)),this.cleanupCache(),e.matrixWorldAutoUpdate=n,e.background=r,this.m_renderer.autoClear=i,this.m_renderer.shadowMap.enabled=s}createInvisibleMaterial(){return new r.ShaderMaterial({name:"invisible",visible:!1})}createMaterial(e){if(e instanceof a.EdgeMaterial||!0===e.isDepthPrepassMaterial)return this.createInvisibleMaterial();const t=this.m_shaderIDs[e.type];let i,s=void 0!==e.shaderUniforms?e.shaderUniforms:e.uniforms;if(void 0!==t){const e=o.ShaderLib[t];s=e.uniforms,i=e.vertexShader}else if(!0===e.isRawShaderMaterial){if(i=e.vertexShader,!/attribute\s+vec3\s+position\s*;/.test(i)||!/attribute\s+vec3\s+normal\s*;/.test(i))return this.createInvisibleMaterial()}else{if(!0!==e.isShaderMaterial)return this.createInvisibleMaterial();i=e.vertexShader}const l=void 0!==e.shaderUniforms&&void 0!==e.shaderUniforms.extrusionRatio,c=a.FadingFeature.isDefined(e),h=Object.assign(Object.assign({},s),this.m_uniformsChunk),u=i.replace(/void\s+main\s*\(\s*\)/,"\n#ifdef USE_EXTRUSION\n  #ifndef HAS_EXTRUSION_PARS_VERTEX\n    #include <extrusion_pars_vertex>\n  #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_vertex>\n#endif\n\nuniform float outlineThickness;\n\nvec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {\n    float thickness = outlineThickness;\n    const float ratio = 1.0;\n    vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );\n    vec4 norm = normalize( pos - pos2 );\n    return pos + norm * thickness * pos.w * ratio;\n}\nvoid main()").replace(/\}\s*$/,"\n#if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( STANDARD )\n    #ifndef USE_ENVMAP\n        vec3 objectNormal = normalize( normal );\n    #endif\n#endif\n\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n\n#ifdef DECLARE_TRANSFORMED\n    vec3 transformed = vec3( position );\n#endif\n\n#ifdef USE_EXTRUSION\n #ifndef HAS_EXTRUSION_VERTEX\n  #include <extrusion_vertex>\n #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_vertex>\n#endif\n\n#ifdef USE_EXTRUSION\n  gl_Position = calculateOutline( projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 ),\n      objectNormal, vec4( transformed, 1.0 ) );\n#else\n  gl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );\n#endif\n\n#include <fog_vertex>\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),d={};return/vec3\s+transformed\s*=/.test(i)||/#include\s+<begin_vertex>/.test(i)||(d.DECLARE_TRANSFORMED=!0),l&&(h.extrusionRatio={value:a.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN},d.USE_EXTRUSION=1),c&&(h.fadeNear={value:void 0!==s.fadeNear?s.fadeNear.value:a.FadingFeature.DEFAULT_FADE_NEAR},h.fadeFar={value:void 0!==s.fadeFar?s.fadeFar.value:a.FadingFeature.DEFAULT_FADE_FAR},d.USE_FADING=1),new r.ShaderMaterial({defines:d,uniforms:h,vertexShader:u,fragmentShader:"\n#include <common>\n#include <fog_pars_fragment>\n\n#ifdef USE_EXTRUSION\n  #include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_fragment>\n#endif\n\nuniform vec3 outlineColor;\nuniform float outlineAlpha;\n\nvoid main() {\n\n    gl_FragColor = vec4( outlineColor, outlineAlpha );\n\n    #include <fog_fragment>\n\n    #ifdef USE_EXTRUSION\n      #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n      #include <fading_fragment>\n    #endif\n}",side:n.BackSide,blending:n.CustomBlending,blendSrc:n.SrcAlphaFactor,blendDst:n.OneMinusSrcAlphaFactor,blendSrcAlpha:n.OneFactor,blendDstAlpha:n.OneMinusSrcAlphaFactor,transparent:!0,polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:30})}getOutlineMaterialFromCache(e){let t=this.m_cache[e.uuid];return void 0===t&&(t={material:this.createMaterial(e),used:!0,keepAlive:this.m_defaultKeepAlive,count:0},this.m_cache[e.uuid]=t),t.used=!0,t.material}getOutlineMaterial(e){const t=this.getOutlineMaterialFromCache(e);return this.m_originalMaterials[t.uuid]=e,this.updateOutlineMaterial(t,e),t}setOutlineMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.getOutlineMaterial(e.material[t]);else e.material=this.getOutlineMaterial(e.material);this.m_originalOnBeforeRenders[e.uuid]=e.onBeforeRender,e.onBeforeRender=(0,l.chainCallbacks)(e.onBeforeRender,this.onBeforeRender.bind(this))}}restoreOriginalMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.m_originalMaterials[e.material[t].uuid];else e.material=this.m_originalMaterials[e.material.uuid];e.onBeforeRender=this.m_originalOnBeforeRenders[e.uuid]}}onBeforeRender(e,t,i,n,r,s){const o=this.m_originalMaterials[r.uuid];void 0!==o&&this.updateUniforms(r,o)}updateUniforms(e,t){var i;const n=t.userData.outlineParameters,r=e.uniforms;r.outlineAlpha.value=t.opacity;const s=void 0!==t.shaderUniforms?t.shaderUniforms:t.uniforms;if(void 0!==n&&(void 0!==n.thickness&&(r.outlineThickness.value=n.thickness),void 0!==n.color&&r.outlineColor.value.fromArray(n.color),void 0!==n.alpha&&(r.outlineAlpha.value=n.alpha)),void 0!==s&&void 0!==s.extrusionRatio){const i=t.shaderUniforms.extrusionRatio.value;e.extrusionRatio=i,e.uniforms.extrusionRatio.value=void 0!==i?i:a.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}void 0!==(null===(i=e.defines)||void 0===i?void 0:i.USE_FADING)&&void 0!==s.fadeNear&&void 0!==s.fadeFar&&s.fadeFar.value>=0&&(r.fadeNear.value=s.fadeNear.value,r.fadeFar.value=s.fadeFar.value)}updateOutlineMaterial(e,t){if("invisible"===e.name)return;const i=t.userData.outlineParameters;e.skinning=t.skinning,e.fog=t.fog,void 0!==i?(e.visible=!1!==t.visible&&(void 0===i.visible||i.visible),void 0!==i.keepAlive&&(this.m_cache[t.uuid].keepAlive=i.keepAlive)):e.visible=t.visible,!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1)}cleanupCache(){let e;e=Object.keys(this.m_originalMaterials);for(let t=0,i=e.length;t<i;t++)this.m_originalMaterials[e[t]]=void 0;e=Object.keys(this.m_originalOnBeforeRenders);for(let t=0,i=e.length;t<i;t++)this.m_originalOnBeforeRenders[e[t]]=void 0;e=Object.keys(this.m_cache);for(const t of e)!1===this.m_cache[t].used?(this.m_cache[t].count++,!1===this.m_cache[t].keepAlive&&this.m_cache[t].count>this.m_removeThresholdCount&&delete this.m_cache[t]):(this.m_cache[t].used=!1,this.m_cache[t].count=0)}}},2331:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderPass=t.RenderPass=t.Pass=void 0;const n=i(9896),r=i(8817),s=i(1498),o=i(5269),a=i(5143);class l{constructor(){this.enabled=!1,this.renderToScreen=!1}setSize(e,t){}render(e,t,i,n,r,s){}}t.Pass=l,t.RenderPass=class extends l{constructor(){super()}render(e,t,i,n,r){e.setRenderTarget(this.renderToScreen?null:n),e.render(t,i)}},t.ShaderPass=class extends l{constructor(e,t="tDiffuse"){super(),this.textureID=t,e instanceof s.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=a.UniformsUtils.clone(e.uniforms),this.material=new s.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new c(this.material)}render(e,t,i,n,r,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,e.setRenderTarget(this.renderToScreen?null:n),this.fsQuad.render(e)}};class c{constructor(e){this.m_camera=new n.OrthographicCamera(-1,1,1,-1,0,1);const t=new r.PlaneGeometry(2,2);this.m_mesh=new o.Mesh(t,e)}get material(){return this.m_mesh.material}set material(e){this.m_mesh.material=e}render(e){e.render(this.m_mesh,this.m_camera)}}},6721:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomPass=void 0;const n=i(9896),r=i(6271),s=i(8817),o=i(977),a=i(1498),l=i(5448),c=i(6815),h=i(5269),u=i(5143),d=i(5117),m=i(5808),p=i(4250),f=i(2331),g=new l.Vector2(1,0),v=new l.Vector2(0,1);class _ extends f.Pass{constructor(e,t,i,f){super(),this.resolution=new l.Vector2(256,256),this.m_renderTargetsHorizontal=[],this.m_renderTargetsVertical=[],this.m_nMips=5,this.m_separableBlurMaterials=[],this.m_camera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_scene=new m.Scene,this.m_basic=new o.MeshBasicMaterial,this.m_quad=new h.Mesh(new s.PlaneGeometry(2,2)),this.m_bloomTintColors=[new c.Vector3(1,1,1),new c.Vector3(1,1,1),new c.Vector3(1,1,1),new c.Vector3(1,1,1),new c.Vector3(1,1,1)],this.strength=t,this.radius=i,this.threshold=f,this.resolution=e,this.m_quad.frustumCulled=!1,this.m_scene.add(this.m_quad);const g={minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat};let v=Math.round(this.resolution.x/2),_=Math.round(this.resolution.y/2);this.m_renderTargetBright=new d.WebGLRenderTarget(v,_,g),this.m_renderTargetBright.texture.name="UnrealBloomPass.bright",this.m_renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.m_nMips;e++){const t=new d.WebGLRenderTarget(v,_,g);t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.m_renderTargetsHorizontal.push(t);const i=new d.WebGLRenderTarget(v,_,g);i.texture.name="UnrealBloomPass.v"+e,i.texture.generateMipmaps=!1,this.m_renderTargetsVertical.push(i),v=Math.round(v/2),_=Math.round(_/2)}this.m_highPassUniforms=u.UniformsUtils.clone(p.LuminosityHighPassShader.uniforms),this.m_highPassUniforms.luminosityThreshold.value=f,this.m_highPassUniforms.smoothWidth.value=.01,this.m_materialHighPassFilter=new a.ShaderMaterial({uniforms:this.m_highPassUniforms,vertexShader:p.LuminosityHighPassShader.vertexShader,fragmentShader:p.LuminosityHighPassShader.fragmentShader,defines:{}});const y=[3,5,7,9,11];v=Math.round(this.resolution.x/2),_=Math.round(this.resolution.y/2);for(let e=0;e<this.m_nMips;e++)this.m_separableBlurMaterials.push(this.getSeperableBlurMaterial(y[e])),this.m_separableBlurMaterials[e].uniforms.texSize.value=new l.Vector2(v,_),v=Math.round(v/2),_=Math.round(_/2);this.m_compositeMaterial=this.getCompositeMaterial(this.m_nMips),this.m_compositeMaterial.uniforms.blurTexture1.value=this.m_renderTargetsVertical[0].texture,this.m_compositeMaterial.uniforms.blurTexture2.value=this.m_renderTargetsVertical[1].texture,this.m_compositeMaterial.uniforms.blurTexture3.value=this.m_renderTargetsVertical[2].texture,this.m_compositeMaterial.uniforms.blurTexture4.value=this.m_renderTargetsVertical[3].texture,this.m_compositeMaterial.uniforms.blurTexture5.value=this.m_renderTargetsVertical[4].texture,this.m_compositeMaterial.uniforms.bloomStrength.value=t,this.m_compositeMaterial.uniforms.bloomRadius.value=.1,this.m_compositeMaterial.needsUpdate=!0,this.m_compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,this.m_copyUniforms=u.UniformsUtils.clone(p.CopyShader.uniforms),this.m_copyUniforms.opacity.value=1,this.m_materialCopy=new a.ShaderMaterial({uniforms:this.m_copyUniforms,vertexShader:p.CopyShader.vertexShader,fragmentShader:p.CopyShader.fragmentShader,blending:r.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}dispose(){for(const e of this.m_renderTargetsHorizontal)e.dispose();for(const e of this.m_renderTargetsVertical)e.dispose();this.m_renderTargetBright.dispose()}setSize(e,t){let i=Math.round(e/2),n=Math.round(t/2);this.m_renderTargetBright.setSize(i,n);for(let e=0;e<this.m_nMips;e++)this.m_renderTargetsHorizontal[e].setSize(i,n),this.m_renderTargetsVertical[e].setSize(i,n),this.m_separableBlurMaterials[e].uniforms.texSize.value=new l.Vector2(i,n),i=Math.round(i/2),n=Math.round(n/2)}render(e,t,i,n,r){this.renderToScreen&&(this.m_quad.material=this.m_basic,this.m_basic.map=r.texture,e.setRenderTarget(null),e.clear(),e.render(this.m_scene,this.m_camera)),this.m_highPassUniforms.tDiffuse.value=r.texture,this.m_highPassUniforms.luminosityThreshold.value=this.threshold,this.m_quad.material=this.m_materialHighPassFilter,e.setRenderTarget(this.m_renderTargetBright),e.clear(),e.render(this.m_scene,this.m_camera);let s=this.m_renderTargetBright;for(let t=0;t<this.m_nMips;t++)this.m_quad.material=this.m_separableBlurMaterials[t],this.m_separableBlurMaterials[t].uniforms.colorTexture.value=s.texture,this.m_separableBlurMaterials[t].uniforms.direction.value=g,e.setRenderTarget(this.m_renderTargetsHorizontal[t]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_separableBlurMaterials[t].uniforms.colorTexture.value=this.m_renderTargetsHorizontal[t].texture,this.m_separableBlurMaterials[t].uniforms.direction.value=v,e.setRenderTarget(this.m_renderTargetsVertical[t]),e.clear(),e.render(this.m_scene,this.m_camera),s=this.m_renderTargetsVertical[t];this.m_quad.material=this.m_compositeMaterial,this.m_compositeMaterial.uniforms.bloomStrength.value=this.strength,this.m_compositeMaterial.uniforms.bloomRadius.value=this.radius,this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,e.setRenderTarget(this.m_renderTargetsHorizontal[0]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_quad.material=this.m_materialCopy,this.m_copyUniforms.tDiffuse.value=this.m_renderTargetsHorizontal[0].texture,this.renderToScreen?(e.setRenderTarget(null),e.render(this.m_scene,this.m_camera)):(e.setRenderTarget(r),e.render(this.m_scene,this.m_camera))}getSeperableBlurMaterial(e){return new a.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new l.Vector2(.5,.5)},direction:{value:new l.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }",fragmentShader:"#include <common>\n            varying vec2 vUv;\n            uniform sampler2D colorTexture;\n            uniform vec2 texSize;\n            uniform vec2 direction;\n\n            float gaussianPdf(in float x, in float sigma) {\n                return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n            }\n            void main() {\n                vec2 invSize = 1.0 / texSize;\n                float fSigma = float(SIGMA);\n                float weightSum = gaussianPdf(0.0, fSigma);\n                vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n                for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n                    float x = float(i);\n                    float w = gaussianPdf(x, fSigma);\n                    vec2 uvOffset = direction * invSize * x;\n                    vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n                    vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n                    diffuseSum += (sample1 + sample2) * w;\n                    weightSum += 2.0 * w;\n                }\n                gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n            }"})}getCompositeMaterial(e){return new a.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }",fragmentShader:"varying vec2 vUv;\n                uniform sampler2D blurTexture1;\n                uniform sampler2D blurTexture2;\n                uniform sampler2D blurTexture3;\n                uniform sampler2D blurTexture4;\n                uniform sampler2D blurTexture5;\n                uniform sampler2D dirtTexture;\n                uniform float bloomStrength;\n                uniform float bloomRadius;\n                uniform float bloomFactors[NUM_MIPS];\n                uniform vec3 bloomTintColors[NUM_MIPS];\n\n                float lerpBloomFactor(const in float factor) {\n                    float mirrorFactor = 1.2 - factor;\n                    return mix(factor, mirrorFactor, bloomRadius);\n                }\n\n                void main() {\n                    gl_FragColor = bloomStrength * (\nlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\nlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\nlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\nlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\nlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n                }"})}}t.BloomPass=_},5307:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAASampling=t.MSAARenderPass=t.Pass=t.MapRenderingManager=void 0;var n=i(9886);Object.defineProperty(t,"MapRenderingManager",{enumerable:!0,get:function(){return n.MapRenderingManager}});var r=i(2331);Object.defineProperty(t,"Pass",{enumerable:!0,get:function(){return r.Pass}});var s=i(818);Object.defineProperty(t,"MSAARenderPass",{enumerable:!0,get:function(){return s.MSAARenderPass}}),Object.defineProperty(t,"MSAASampling",{enumerable:!0,get:function(){return s.MSAASampling}})},9993:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightCoverageProvider=void 0;const n=i(4342),r=i(1102);t.CopyrightCoverageProvider=class{constructor(){this.logger=n.LoggerManager.instance.create("CopyrightCoverageProvider")}getTree(){return void 0!==this.m_cachedTreePromise||(this.m_cachedTreePromise=this.getCopyrightCoverageData().then((e=>this.initRBush(e))).catch((e=>(this.logger.error(e),new r)))),this.m_cachedTreePromise}async getCopyrights(e,t){const i=[],r=(await this.getTree()).search({minX:e.west,minY:e.south,maxX:e.east,maxY:e.north});for(const e of r){const r=(0,n.getOptionValue)(e.minLevel,0),s=(0,n.getOptionValue)(e.maxLevel,1/0);t>=r&&t<=s&&void 0===i.find((t=>t.id===e.label))&&i.push({id:e.label})}return i}initRBush(e){const t=new r;if(!e)return this.logger.warn("No copyright coverage data provided"),t;for(const i of e){const{minLevel:e,maxLevel:n,label:r,alt:s}=i;if(i.boxes)for(const o of i.boxes){const[i,a,l,c]=o;t.insert({minX:a,minY:i,maxX:c,maxY:l,minLevel:e,maxLevel:n,label:r,alt:s})}else t.insert({minX:-180,minY:-90,maxX:180,maxY:180,minLevel:e,maxLevel:n,label:r,alt:s})}return t}}},4549:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightElementHandler=void 0;const n=i(4342),r=i(3977),s=i(8380);class o{static install(e,t){return new o(e,t)}constructor(e,t){if(this.m_defaults=new Map,this.m_mapViews=[],this.update=()=>{var e;const t=this.m_mapViews.map((e=>e.copyrightInfo)).reduce(s.CopyrightInfo.mergeArrays,null!==(e=this.staticInfo)&&void 0!==e?e:[]);if(0===t.length)return void(this.m_element.style.display="none");if(this.m_element.style.display="block",0!==this.m_defaults.size)for(const e of t){const t=this.m_defaults.get(e.id);void 0!==t&&(e.year=(0,n.getOptionValue)(e.year,t.year),e.label=(0,n.getOptionValue)(e.label,t.label),e.link=(0,n.getOptionValue)(e.link,t.link))}const i=s.CopyrightInfo.mergeArrays(t);this.m_element.innerHTML=s.CopyrightInfo.formatAsHtml(i)},"string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`CopyrightElementHandler: unable to find DOM element #${e}`);this.m_element=t}else this.m_element=e;void 0!==t&&this.attach(t)}destroy(){for(const e of this.m_mapViews)e.removeEventListener(r.MapViewEventNames.CopyrightChanged,this.update)}attach(e){return this.m_mapViews.push(e),e.addEventListener(r.MapViewEventNames.CopyrightChanged,this.update),this.update(),this}detach(e){return e.removeEventListener(r.MapViewEventNames.CopyrightChanged,this.update),this.m_mapViews=this.m_mapViews.filter((t=>t!==e)),this.update(),this}setDefaults(e){if(this.m_defaults.clear(),void 0!==e)for(const t of e)this.m_defaults.set(t.id,t);return this}setStaticCopyightInfo(e){return this.staticInfo=e,this}}t.CopyrightElementHandler=o},8380:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightInfo=void 0;const n=i(4342);var r;(r=t.CopyrightInfo||(t.CopyrightInfo={})).mergeArrays=function(e,t){const i=[];for(const r of[e,t])if(void 0!==r)for(const e of r){const t=i.find((t=>t.id===e.id||void 0!==t.label&&t.label===e.label));void 0===t?i.push(Object.assign({},e)):(t.year=n.MathUtils.max2(e.year,t.year),t.label=(0,n.getOptionValue)(e.label,t.label),t.link=(0,n.getOptionValue)(e.link,t.link))}return i},r.formatAsHtml=function(e){if(0===e.length)return"";const t=e.filter((e=>""!==e.label));return 0===t.length?"":"© "+t.map((e=>{var t;const i=null!==(t=e.label)&&void 0!==t?t:e.id,n=void 0!==e.year?`${e.year} ${i}`:i,r=e.link;return r?`<a href="${r}" target="_blank" rel="noreferrer noopener">${n}</a>`:`${n}`})).join(", ")}},9348:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4757:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlCopyrightProvider=void 0;const n=i(3209),r=i(9993);class s extends r.CopyrightCoverageProvider{constructor(e,t,i,r=n.TransferManager.instance()){super(),this.m_fetchURL=e,this.m_baseScheme=t,this.m_requestHeaders=i,this.m_transferManager=r}setRequestHeaders(e){this.m_requestHeaders=e}getCopyrightCoverageData(e){return void 0!==this.m_cachedCopyrightResponse||(this.m_cachedCopyrightResponse=this.m_transferManager.downloadJson(this.m_fetchURL,{headers:this.m_requestHeaders,signal:e}).then((e=>e[this.m_baseScheme])).catch((e=>(this.logger.error(e),[])))),this.m_cachedCopyrightResponse}}t.UrlCopyrightProvider=s},1350:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fitLookAtBounds=t.getFitLookAtBoundsDistance=t.getFitBoundsParams=void 0;const n=i(2479),r=i(2754),s=i(6815),o=i(2616),a=i(4442),l=i(541),c=new s.Vector3,h=new n.PerspectiveCamera;function u(e,t,i,n,a){let c,h;if(e instanceof o.GeoBox)h=null!=a?a:e.center,c=l.MapViewUtils.geoBoxToGeoPoints(e);else if(e instanceof o.GeoPolygon)h=e.getCentroid(),c=e.coordinates;else if((0,o.isGeoBoxExtentLike)(e)){h=null!=a?a:n;const t=o.GeoBox.fromCenterAndExtents(h,e);c=l.MapViewUtils.geoBoxToGeoPoints(t)}else{if(!Array.isArray(e))throw Error("#lookAt: Invalid 'bounds' value");c=e,h=a}e instanceof o.GeoBox||e instanceof o.GeoPolygon||!i||t.type!==o.ProjectionType.Planar||(c=l.MapViewUtils.wrapGeoPointsToScreen(c,h));const u=c.map((e=>t.projectPoint(o.GeoCoordinates.fromObject(e),new s.Vector3))),d=new s.Vector3;return void 0===h?((new r.Box3).setFromPoints(u).getCenter(d),t.scalePointToSurface(d),h=t.unprojectPoint(d)):t.projectPoint(h,d),{target:h,worldTarget:d,worldPoints:u}}function d(e,t){const{projection:i,viewportSize:n,cameraSettings:r,maxZoomLevel:s}=e,{yaw:d,tilt:m,padding:p}=t,{target:f,worldTarget:g,worldPoints:v}=u(t.bounds,i,e.tileWrapping,e.target,t.target);let _,y=t.distance;if(void 0===y){h.copy(e.camera),l.MapViewUtils.getCameraRotationAtTarget(i,f,d,m,h.quaternion),_=h.quaternion;const t=l.MapViewUtils.calculateDistanceFromZoomLevel(r,s);l.MapViewUtils.getCameraPositionFromTarget(f,t,d,m,i,h.position),h.updateMatrixWorld(!0),i.type===o.ProjectionType.Spherical&&l.MapViewUtils.wrapWorldPointsToView(v,h.position),y=function(e,t,i,n,r={top:0,right:0,bottom:0,left:0}){const s={top:2*r.top/n.height,right:2*r.right/n.width,bottom:2*r.bottom/n.height,left:2*r.left/n.width},o=c.copy(t).sub(i.position).length(),l=a.CameraUtils.getPrincipalPoint(i);let h=o;const u=(e,t,i,n)=>{const r=-1===Math.sign(e)?-1:1,s=r>0?n:i;return Math.abs(e)>1?Math.abs((e-t)/(r*(.99-s)-t)):1};for(const t of e){const e=-c.copy(t).applyMatrix4(i.matrixWorldInverse).z,n=c.applyMatrix4(i.projectionMatrix),r=Math.max(u(n.x,l.x,s.left,s.right),u(n.y,l.y,s.bottom,s.top));if(r>1){const t=o-e,i=Math.abs(e)*r+t;h=Math.max(h,i)}}return h}(v,g,h,n,p)}return{target:f,distance:y,quaternion:_}}t.getFitBoundsParams=u,t.getFitLookAtBoundsDistance=d,t.fitLookAtBounds=function(e,t){const{projection:i,camera:n}=e,{yaw:r,tilt:s}=t,{target:o,distance:a,quaternion:c}=d(e,t);c?n.quaternion.copy(c):l.MapViewUtils.getCameraRotationAtTarget(i,o,r,s,n.quaternion),l.MapViewUtils.getCameraPositionFromTarget(o,a,r,s,i,n.position),n.updateMatrixWorld(!0)}},8024:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGroundPlane=void 0;const n=i(9365),r=i(3148),s=i(3334),o=i(6815),a=i(5269),l=i(6525),c=i(6189),h=i(2616),u=i(1984),d=i(5863),m=i(8427),p=i(6473),f=i(21),g=i(4772),v=new o.Vector3;function _(e,t,i){const n=e.getAttribute("position"),r=n.array,s=new Float32Array(r.length);for(let e=0;e<n.array.length;e+=1)v.fromBufferAttribute(n,e),i.projection.reprojectPoint(t,v,v).sub(i.center),v.toArray(s,3*e);n.array=s,n.needsUpdate=!0}t.addGroundPlane=function(e,t,i=d.BackgroundDataSource.DEFAULT_COLOR,v=1,y=!1){const x=function(e,t,i,u){const{dataSource:d,projection:g}=e,v=d.getTilingScheme().projection,y=g.type===h.ProjectionType.Spherical,x=!y,S=e.mapView,b=S.shadowsEnabled,T={name:"polygon",color:i,opacity:u},M=(0,m.createMaterial)(T,e.mapView,{fog:null!==S.scene.fog,shadowsEnabled:b}),w=null==M?void 0:M.material;w&&(w.depthWrite=y);const E=function(e,t,i,s){const{dataSource:a,projection:l}=e,c=a.getTilingScheme().projection,h=new o.Vector3,u=new r.BufferGeometry,d=(0,f.projectTilePlaneCorners)(e,c),m=[d.sw,d.se,d.nw,d.ne];if(t)for(const t of m)l.reprojectPoint(c,t,t).sub(e.center);const p=t?new Float32Array(12):new Float64Array(12),g=new n.BufferAttribute(p,3).copyArray([...m[0].toArray(),...m[1].toArray(),...m[2].toArray(),...m[3].toArray()]);if(u.setAttribute("position",g),s){c.surfaceNormal(d.sw,h).negate();const e=new n.BufferAttribute(new Float32Array(12),3).copyArray([...h.toArray(),...h.toArray(),...h.toArray(),...h.toArray()]);u.setAttribute("normal",e)}if(u.setIndex(new n.BufferAttribute(new Uint16Array([0,1,2,2,1,3]),1)),i){const e=new n.BufferAttribute(new Float32Array([0,0,1,0,0,1,1,1]),2);u.setAttribute("uv",e)}return u}(e,x,t,b);if(!y)return new a.Mesh(E,w);const C=[],A=new c.SphericalGeometrySubdivisionModifier((0,s.degToRad)(10),v);if(!(!1!==e.mapView.enableMixedLod))return A.modify(E),_(E,v,e),new a.Mesh(E,w);for(let t=0;t<4;++t){const i=Math.pow(2,t),n=E.clone();i>1&&new l.EdgeLengthGeometrySubdivisionModifier(i,e.geoBox,l.SubdivisionMode.All,v).modify(n),A.modify(n),_(n,v,e),C.push(n)}return new p.LodMesh(C,w)}(e,y,i,v);return x.receiveShadow=e.mapView.shadowsEnabled,x.renderOrder=t,(0,g.registerTileObject)(e,x,{pickability:u.Pickability.transient}),e.objects.push(x),x}},544:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferAttribute=void 0;const n=i(9365),r=i(3334),s=i(6815),o=i(4342),a=i(8813);class l extends n.BufferAttribute{constructor(e,t,i,n){super(e.array,e.itemSize,e.normalized),this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_textureWidth=0,this.m_textureHeight=0,this.m_cache=new a.VertexCache(l.MAX_CACHE_SIZE),this.m_lastPos=new s.Vector3,this.m_tmpNormal=new s.Vector3,this.resetTexture(n)}reset(e,t,i,n){this.array=e.array,this.itemSize=e.itemSize,this.count=this.array.length/this.itemSize,this.normalized=e.normalized,this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_cache.clear(),this.m_lastBufferIndex=void 0,this.resetTexture(n)}getX(e){return this.getDisplacedCoordinate(e).x}getY(e){return this.getDisplacedCoordinate(e).y}getZ(e){return this.getDisplacedCoordinate(e).z}resetTexture(e){this.m_texture=new Float32Array(e.image.data.buffer),this.m_textureWidth=e.image.width,this.m_textureHeight=e.image.height}getDisplacedCoordinate(e){return e===this.m_lastBufferIndex||(this.m_lastBufferIndex=e,this.m_cache.get(e,this.m_lastPos)||(this.displacePosition(e),this.m_cache.set(e,this.m_lastPos))),this.m_lastPos}displacePosition(e){this.m_lastPos.fromBufferAttribute(this.originalAttribute,e);const t=this.m_normals;this.m_tmpNormal.fromBufferAttribute(t,e);const i=this.m_uvs,n=(0,r.clamp)(i.getX(e),0,1),s=(0,r.clamp)(i.getY(e),0,1),a=(0,o.sampleBilinear)(this.m_texture,this.m_textureWidth,this.m_textureHeight,n,s);this.m_lastPos.add(this.m_tmpNormal.multiplyScalar(a))}}t.DisplacedBufferAttribute=l,l.MAX_CACHE_SIZE=6},8246:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferGeometry=t.displaceBox=void 0;const n=i(3148),r=i(2754),s=i(5381),o=i(6815),a=i(544),l=new o.Vector3,c=new o.Vector3,h=new r.Box3;function u(e,t,i){h.copy(e);const n=l.copy(i),r=c.copy(n);return e.translate(n.multiplyScalar(t.min)).union(h.translate(r.multiplyScalar(t.max))),e}t.displaceBox=u;class d extends n.BufferGeometry{constructor(e,t,i,n){super(),this.originalGeometry=e,this.displacementRange=i,this.m_originalBoundingBox=new r.Box3,this.m_displacedPositions=n||new a.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),this.resetAttributes()}reset(e,t,i){this.originalGeometry=e;const n=e.attributes.position,r=e.attributes.normal,s=e.attributes.uv;this.m_displacedPositions.reset(n,r,s,t);const o=this.displacementRange.min!==i.min||this.displacementRange.max!==i.max;this.displacementRange=i,this.resetAttributes(),this.resetBoundingVolumes(o)}computeBoundingBox(){null===this.originalGeometry.boundingBox&&this.originalGeometry.computeBoundingBox();const e=this.m_originalBoundingBox.copy(this.originalGeometry.boundingBox);null===this.boundingBox?this.boundingBox=e.clone():this.boundingBox.copy(e),u(this.boundingBox,this.displacementRange,l.fromBufferAttribute(this.attributes.normal,0))}computeBoundingSphere(){null===this.boundingBox&&this.computeBoundingBox(),null===this.boundingSphere&&(this.boundingSphere=new s.Sphere),this.boundingBox.getBoundingSphere(this.boundingSphere)}needsBoundingBoxUpdate(e){return e||null!==this.boundingBox&&(!this.originalGeometry.boundingBox||!this.m_originalBoundingBox.equals(this.originalGeometry.boundingBox))}resetBoundingVolumes(e){this.needsBoundingBoxUpdate(e)&&(this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere())}resetAttributes(){this.index=this.originalGeometry.index,this.groups=this.originalGeometry.groups,this.drawRange=this.originalGeometry.drawRange,this.attributes=Object.assign({},this.originalGeometry.attributes),this.attributes.position=this.m_displacedPositions}}t.DisplacedBufferGeometry=d},946:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedMesh=void 0;const n=i(3148),r=i(5269),s=i(7941),o=i(4250),a=i(4342),l=i(544),c=i(8246);class h extends r.Mesh{static getDisplacedPositionAttribute(e,t){return h.displacedPositions?h.displacedPositions.reset(e.attributes.position,e.attributes.normal,e.attributes.uv,t):h.displacedPositions=new l.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),h.displacedPositions}constructor(e,t,i,n){super(e,t),this.m_getDisplacementRange=i,this.m_raycastStrategy=n}raycast(e,t){const i=this.firstMaterial;if(!function(e){const t=(0,o.hasDisplacementFeature)(e);return(0,a.assert)(t,"Material does not support displacement maps."),t}(i)||!function(e){if(!e)return!1;const t=e instanceof s.DataTexture;return(0,a.assert)(t,"Material does not support displacement maps."),t}(i.displacementMap))return void super.raycast(e,t);const r=i.displacementMap,l=Object.assign({},this.m_getDisplacementRange());(0,a.assert)(this.geometry instanceof n.BufferGeometry,"Unsupported geometry type.");const u=this.geometry;this.displacedGeometry?this.displacedGeometry.reset(u,r,l):this.displacedGeometry=new c.DisplacedBufferGeometry(u,r,l,h.getDisplacedPositionAttribute(u,r)),this.geometry=this.displacedGeometry,this.m_raycastStrategy?this.m_raycastStrategy(this,e,t):super.raycast(e,t),super.geometry=this.displacedGeometry.originalGeometry}get firstMaterial(){return Array.isArray(this.material)?this.material[0]:this.material}}t.DisplacedMesh=h},6473:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LodMesh=void 0;const n=i(3334),r=i(5269);class s extends r.Mesh{constructor(e,t){super(void 0,t),this.geometries=e}set geometries(e){this.m_geometries!==e&&this.disposeGeometries(),this.m_geometries=e,this.geometries&&this.m_geometries.length>0&&(this.geometry=this.m_geometries[0])}get geometries(){return this.m_geometries}setLevelOfDetail(e){this.m_geometries&&0!==this.m_geometries.length&&(e=(0,n.clamp)(e,0,this.m_geometries.length-1),this.geometry=this.m_geometries[e])}disposeGeometries(){if(this.m_geometries)for(const e of this.m_geometries)e.dispose();this.geometry.dispose()}}t.LodMesh=s},7987:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Object3DUtils=void 0;const n=i(9365),r=i(6280),s=i(6307),o=i(2578),a=i(977),l=i(3905),c=i(4085),h=i(1498),u=i(3334),d=i(5808),m=i(394),p=i(4250),f=i(4342),g=i(1447),v=f.LoggerManager.instance.create("Object3DUtils");!function(e){function t(e){if(!e.image)return 0;const t=e.image;return 4*t.width*t.height}function i(e,i,n){if(!e)return;if(void 0!==e.uuid&&!0===n.get(e.uuid))return;n.set(e.uuid,!0);const r=t(e);i.heapSize+=r,i.gpuSize+=r}function f(e,t,n){if(void 0===e.uuid||!0!==n.get(e.uuid))if(n.set(e.uuid,!0),e instanceof c.RawShaderMaterial||e instanceof h.ShaderMaterial){const r=e;for(const e in r.uniforms)if(void 0!==r.uniforms[e]){const s=r.uniforms[e];s instanceof m.Texture&&i(s,t,n)}}else if(e instanceof a.MeshBasicMaterial||e instanceof p.MapMeshBasicMaterial){const r=e;i(r.map,t,n),i(r.aoMap,t,n),i(r.specularMap,t,n),i(r.alphaMap,t,n),i(r.envMap,t,n)}else if(e instanceof p.MapMeshStandardMaterial){const r=e;i(r.map,t,n),i(r.lightMap,t,n),i(r.aoMap,t,n),i(r.emissiveMap,t,n),i(r.bumpMap,t,n),i(r.normalMap,t,n),i(r.displacementMap,t,n),i(r.roughnessMap,t,n),i(r.metalnessMap,t,n),i(r.alphaMap,t,n),i(r.envMap,t,n)}else if(e instanceof p.MapMeshPhongMaterial){const r=e;i(r.map,t,n),i(r.lightMap,t,n),i(r.aoMap,t,n),i(r.emissiveMap,t,n),i(r.bumpMap,t,n),i(r.normalMap,t,n),i(r.displacementMap,t,n),i(r.specularMap,t,n),i(r.alphaMap,t,n),i(r.envMap,t,n)}else e instanceof s.LineBasicMaterial||e instanceof o.LineDashedMaterial||e instanceof l.PointsMaterial||v.warn("estimateMeshSize: unidentified material: ",e)}function _(e,t,i,s){if(void 0===e.uuid&&(e.uuid=(0,u.generateUUID)()),!0===s.get(e.uuid))return;s.set(e.uuid,!0);let o=0,a=4;void 0!==e.array.BYTES_PER_ELEMENT&&(a=e.array.BYTES_PER_ELEMENT),e instanceof r.InterleavedBufferAttribute||e instanceof n.BufferAttribute?o=a*e.count*e.itemSize:v.warn("estimateMeshSize: unidentified attribute: ",t),i.heapSize+=o+56,i.gpuSize+=o}function y(e,t,i){if(void 0!==e.uuid&&!0===i.get(e.uuid))return;if(i.set(e.uuid,!0),void 0===e)return;const n=e.attributes;if(void 0!==n){for(const e in n)void 0!==n[e]&&_(n[e],e,t,i);null!==e.index&&_(e.index,"index",t,i)}else v.warn("estimateGeometrySize: unidentified geometry: ",e)}e.getTextureSize=t,e.estimateSize=function e(t,i,n){const r=void 0!==i?i:{heapSize:0,gpuSize:0};if(void 0===n&&(n=new Map),function(e,t,i){if(e.isObject3D&&!(e instanceof d.Scene)&&(void 0===e.uuid||!0!==i.get(e.uuid)))if(i.set(e.uuid,!0),e.isMesh||e.isLine||e.isPoints){let n=1e3;const r=0,s=e;if(void 0!==s.material)if(Array.isArray(s.material)){const e=s.material;for(const n of e)f(n,t,i)}else f(s.material,t,i);if(void 0!==s.geometries)for(const e of s.geometries)y(e,t,i);else void 0!==s.geometry&&y(s.geometry,t,i);const o=void 0!==e.userData?e.userData.feature:void 0;void 0!==o&&(n+=(0,g.getFeatureDataSize)(o)),t.heapSize+=n,t.gpuSize+=r}else v.warn("estimateMeshSize: unidentified object",e)}(t,r,n),t.children.length>0)for(const i of t.children)e(i,r,n);return r}}(t.Object3DUtils||(t.Object3DUtils={}))},21:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.projectTilePlaneCorners=void 0;const n=i(6815),r=i(2616);t.projectTilePlaneCorners=function(e,t){const{east:i,west:s,north:o,south:a}=e.geoBox;return{sw:t.projectPoint(new r.GeoCoordinates(a,s),new n.Vector3),se:t.projectPoint(new r.GeoCoordinates(a,i),new n.Vector3),nw:t.projectPoint(new r.GeoCoordinates(o,s),new n.Vector3),ne:t.projectPoint(new r.GeoCoordinates(o,i),new n.Vector3)}}},4772:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerTileObject=void 0;const n=i(4572);t.registerTileObject=function(e,t,i){n.MapObjectAdapter.create(t,Object.assign({dataSource:e.dataSource,tileKey:e.tileKey},i)),e.resetVisibilityCounter()}},8673:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMesh=void 0;const n=i(3148),r=i(2754),s=i(414),o=i(8333),a=i(3850),l=i(2309),c=i(5381),h=i(6815),u=i(5269),d=i(2616),m=i(4250),p=i(4342),f=i(8246),g=new c.Sphere,v=new o.Matrix4,_=new l.Ray,y=new s.Line3,x=new r.Box3,S=new d.OrientedBox3,b=new a.Plane,T=new h.Vector3,M=new h.Vector3,w=new h.Vector3,E=new h.Vector3;function C(e,t,i){let n;e instanceof f.DisplacedBufferGeometry&&(n=e.displacementRange,e=e.originalGeometry);const r=e.attributes.position,s=e.index.array,o=new c.Sphere,a=x.makeEmpty(),l=T;for(let e=t;e<i;e+=6)a.expandByPoint(l.fromBufferAttribute(r,s[e])),a.expandByPoint(l.fromBufferAttribute(r,s[e+2]));if(n){const t=M;return t.fromBufferAttribute(e.attributes.normal,0),(0,f.displaceBox)(a,n,t).getBoundingSphere(o)}return a.getBoundingSphere(o)}function A(e,t,i,n,r,s,o,a){if(o.equals(e.origin)&&0===e.direction.dot(s.normal)){const r=function(e,t,i,n,r){var s;const o=S;return t.getCenter(o.position),t.delta(o.xAxis).normalize(),o.yAxis.copy(i),o.zAxis.copy(n),o.extents.set(t.distance()/2,r,r),o.contains(e.origin)?0:null!==(s=o.intersectsRay(e))&&void 0!==s?s:1/0}(e,t,i,s.normal,n),o=function(e,t,i){const n=new c.Sphere(t.start,i),r=n.containsPoint(e.origin)?0:e.intersectSphere(n,E)?E.sub(e.origin).length():1/0;n.center.copy(t.end);const s=n.containsPoint(e.origin)?0:e.intersectSphere(n,E)?E.sub(e.origin).length():1/0;return Math.min(r,s)}(e,t,n),l=Math.min(r,o);return l!==1/0&&(e.at(l,a),!0)}return!(o.distanceToSquared(t.closestPointToPoint(o,!0,E))>r||(a.copy(o),0))}function P(e,t,i,n,r,s,o,a,l,c,h){const u=T,d=b,m=M,p=y,f=w,v=E,_=e.geometry,x=_.attributes,S=x.position,C=x.biTangent,P=_.index.array;if(g.copy(l),g.applyMatrix4(e.matrixWorld),g.radius+=n,t.ray.intersectsSphere(g))for(let n=o;n<a;n+=6){const o=P[n],a=P[n+2];p.start.fromBufferAttribute(S,o),p.end.fromBufferAttribute(S,a),u.set(C.getX(o),C.getY(o),C.getZ(o)).normalize();const l=C.getW(o),g=Math.tan(l/2),_=c*Math.sqrt(1+Math.pow(Math.abs(g),2));if(v.copy(u).multiplyScalar(_),p.start.add(v),p.end.add(v),d.setFromCoplanarPoints(p.start,f.copy(p.start).add(u),p.end),0===d.normal.manhattanLength())continue;if(!i.intersectPlane(d,m))continue;const y=w;if(!A(i,p,u,r,s,d,m,y))continue;const x=y.applyMatrix4(e.matrixWorld),b=t.ray.origin.distanceTo(x);b<t.near||b>t.far||h.push({distance:b,point:x.clone(),index:n,object:e})}}const R=[0],L=.01;function D(e,t,i,r,s,o,a){var l;const c=e.userData,h=c.feature.boundingVolumes;(0,p.assert)(e.geometry instanceof n.BufferGeometry,"Unsupported geometry type.");const u=e.geometry;(0,p.assert)(function(e){return Array.isArray(e)?e.every((e=>e instanceof m.SolidLineMaterial)):e instanceof m.SolidLineMaterial}(t),"Unsupported material type");const d=t,f=d.width/2;(0,p.assert)(Math.abs(1-e.scale.x/e.scale.y)<L),(0,p.assert)(Math.abs(1-e.scale.x/e.scale.z)<L),(0,p.assert)(Math.abs(1-e.scale.y/e.scale.z)<L);const g=f/((e.scale.x+e.scale.y+e.scale.z)/3),v=g*g,_=null!==(l=c.feature.starts)&&void 0!==l?l:R;let y=s,x=_[y];const S=_.length-1;for(;x<o;){const t=y,n=y<S?_[++y]:o;t>=h.length&&h.push(C(u,x,n)),P(e,i,r,f,g,v,x,n,h[t],d.offset,a),x=n}return y}class I extends u.Mesh{static raycast(e,t,i){var r;(0,p.assert)(e.geometry instanceof n.BufferGeometry,"Unsupported geometry type");const s=e.geometry;(0,p.assert)(null!==s.index,"Geometry does not have indices");const o=e.matrixWorld;v.copy(o).invert();const a=_.copy(t.ray).applyMatrix4(v),l=e.userData,c=null!==(r=l.feature)&&void 0!==r?r:l.feature={};void 0===l.feature&&(l.feature={});const h=s.attributes.position,u=c.attributeInfo;(void 0===u||void 0===c.boundingVolumes||function(e,t){const i=e.isBufferAttribute,n=i?e:e.data;return void 0===t||t.data!==n||i&&t.version!==n.version}(h,u))&&(c.boundingVolumes=[],c.attributeInfo=function(e){const t=e.isBufferAttribute?e:e.data;return{data:t,version:t.version}}(h));const d=s.index.array;if(Array.isArray(e.material)){let n=0;for(const r of s.groups)n=D(e,e.material[r.materialIndex],t,a,n,r.start+r.count,i)}else D(e,e.material,t,a,0,d.length,i)}constructor(e,t){super(e,t)}raycast(e,t){I.raycast(this,e,t)}}t.SolidLineMesh=I},5571:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataAccessor=void 0;const n=i(8152),r=i(4342),s=i(4269),o=r.LoggerManager.instance.create("TileDataAccessor");t.TileDataAccessor=class{constructor(e,t,i){this.tile=e,this.visitor=t;const n=!0===i.wantsAll;this.m_wantsPoints=n||!(!1===i.wantsPoints),this.m_wantsLines=n||!(!1===i.wantsLines),this.m_wantsAreas=n||!(!1===i.wantsAreas),this.m_wantsObject3D=n||!(!1===i.wantsObject3D)}visitAll(){const e=this.tile.objects;for(const t of e)this.visitObject(t)}visitObject(e){const t=void 0!==e.userData?e.userData.feature:void 0;if(void 0===t||void 0!==t.objInfos&&1===t.objInfos.length&&!this.visitor.wantsFeature((0,n.getFeatureId)(t.objInfos[0])))return;const i=t.geometryType;if(void 0===i)return void o.warn("#visitObject: visiting object failed, no geometryType",e);switch((0,r.assert)(void 0!==t.objInfos,"featureData.ids missing"),(0,r.assert)(void 0!==t.starts,"featureData.starts missing"),(0,r.assert)(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.objInfos&&void 0!==t.starts&&(0,r.assert)(t.objInfos.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),i){case n.GeometryType.Point:case n.GeometryType.Text:if(!this.m_wantsPoints)return;break;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case n.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:o.warn("#visitObject: invalid geometryType")}if("Mesh"!==e.type)return void o.warn("#visitObject: visiting object failed, not of type 'Mesh'",e);const s=e;this.visitMesh(s,t)}getBufferGeometry(e){const t=e.geometry;if("BufferGeometry"!==t.type)return void o.warn("#visitObject: object does not have BufferGeometry");const i=t;if(i.getAttribute("position"))return i;o.warn("#visitLines: BufferGeometry has no position attribute")}getGeometryAccessor(e,t,i){switch(e){case n.GeometryType.Point:case n.GeometryType.Text:return;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:return new s.BufferedGeometryLineAccessor(t,e,i);case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:return;case n.GeometryType.Object3D:return new s.BufferedGeometryObject3dAccessor(t,e,i);default:o.warn("#getGeometryAccessor: invalid geometryType")}}getIndexedGeometryAccessor(e,t,i){switch(e){case n.GeometryType.Point:case n.GeometryType.Text:return;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:return new s.IndexedBufferedGeometryLineAccessor(t,e,i);case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:case n.GeometryType.Object3D:return;default:o.warn("#getIndexedGeometryAccessor: invalid geometryType")}}visitMesh(e,t){const{objInfos:i,starts:a}=t,l=t.geometryType;if(void 0===i||void 0===a||void 0===l)return;let c;for(let t=0;t<i.length;t++){const h=(0,n.getFeatureId)(i[t]);if(!this.visitor.wantsFeature(h))continue;const u=a[t];let d=-1;if(void 0===c){const t=this.getBufferGeometry(e);if(void 0===t)continue;if(c=null!==t.index?this.getIndexedGeometryAccessor(l,e,t):this.getGeometryAccessor(l,e,t),void 0===c){o.warn("#visitObject: no accessor geometryType",l);continue}}switch(d=t<a.length-1?a[t+1]:c.getCount(),c.setRange(u,d),l){case n.GeometryType.Point:case n.GeometryType.Text:this.visitor.visitPoint(h);break;case n.GeometryType.SolidLine:case n.GeometryType.ExtrudedLine:case n.GeometryType.TextPath:(0,r.assert)((0,s.isLineAccessor)(c)),this.visitor.visitLine(h,c);break;case n.GeometryType.Polygon:case n.GeometryType.ExtrudedPolygon:this.visitor.visitArea(h);break;case n.GeometryType.Object3D:(0,r.assert)((0,s.isObject3dAccessor)(c)),this.visitor.visitObject3D(h,c);break;default:o.warn("#visitObject: invalid geometryType")}}}}},4269:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedBufferedGeometryLineAccessor=t.IndexedBufferedGeometryAccessor=t.BufferedGeometryObject3dAccessor=t.BufferedGeometryLineAccessor=t.BufferedGeometryAccessor=t.BufferedGeometryAccessorBase=t.isObject3dAccessor=t.isLineAccessor=void 0;const n=i(8152),r=i(3211),s=i(4342),o=s.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};class a{constructor(e,t,i){this.object=e,this.geometryType=t,this.bufferGeometry=i,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,(0,s.assert)(!!e),"BufferGeometry"!==i.type&&o.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),(0,s.assert)("BufferGeometry"===i.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||o.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&o.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}getCount(){return this.position.count}get renderOrder(){return this.object.renderOrder}setRange(e,t,i=0,n=0){(0,s.assert)(e>=0),(0,s.assert)(t>=0),(0,s.assert)(e<=t),this.start=e,this.end=t,this.startCapSize=i,this.endCapSize=n}get color(){const e=e=>{const t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){const t=e;if("SolidLineMaterial"===t.name)return t.uniforms.diffuseColor.value;o.warn("BufferedGeometryAccessor#color: unknown shader material name",t.name)}else o.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){const t=new Array,i=this.object.material;for(const n of i)t.push(e(n));return t}return e(this.object.material)}}t.BufferedGeometryAccessorBase=a;class l extends a{constructor(e,t,i,n){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.stride=n}clear(){(0,s.assert)(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.position.array,t=this.start*this.itemSize,i=this.end*this.itemSize;for(let n=t;n<i;n++)e[n]=0;this.position.needsUpdate=!0}getVertices(){(0,s.assert)(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)}checkSetUp(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end}}t.BufferedGeometryAccessor=l,t.BufferedGeometryLineAccessor=class extends l{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){(0,s.assert)(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")}},t.BufferedGeometryObject3dAccessor=class extends l{constructor(e,t,i){super(e,t,i,1),this.object=e,this.geometryType=t,this.bufferGeometry=i}isObject3dAccessor(){return!0}getVertices(){return super.getVertices()}};class c extends a{constructor(e,t,i,n,r){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.indices=null!==this.bufferGeometry.index?this.bufferGeometry.index.array:void 0,this.indices?this.indices instanceof Uint32Array||(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),(0,s.assert)(this.indices instanceof Uint32Array)):(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),(0,s.assert)(!!this.indices))}getCount(){return this.indices.length}checkSetUp(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end}}t.IndexedBufferedGeometryAccessor=c,t.IndexedBufferedGeometryLineAccessor=class extends c{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){if((0,s.assert)(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===n.GeometryType.ExtrudedLine){const e=this.start+this.startCapSize,t=this.position.array;return(0,r.reconstructLineWidth)(t,e)}}clear(){(0,s.assert)(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.start,t=this.end;for(let i=e;i<t;i++)this.indices[i]=0;null!==this.bufferGeometry.index&&(this.bufferGeometry.index.needsUpdate=!0)}getVertices(){(0,s.assert)(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.itemSize,t=this.start,i=this.end,n=new Float32Array((i-t)*e),r=this.position.array;if(2===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];n[o+0]=r[t*e+0],n[o+1]=r[t*e+1]}if(3===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];n[o+0]=r[t*e+0],n[o+1]=r[t*e+1],n[o+2]=r[t*e+2]}else for(let s=t,o=0;s<i;s++,o++){const t=this.indices[s];for(let i=0;i<e;i++)n[o*e+i]=r[t*e+i]}return n}}},5912:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryCreator=void 0;const n=i(6271),r=i(9365),s=i(3148),o=i(9044),a=i(6280),l=i(3334),c=i(5448),h=i(6815),u=i(4760),d=i(7941),m=i(8152),p=i(2616),f=i(4250),g=i(1984),v=i(8023),_=i(4342),y=i(5863),x=i(8427),S=i(2476),b=i(5316),T=i(176),M=i(9701),w=i(8024),E=i(4772),C=_.LoggerManager.instance.create("TileGeometryCreator"),A=new h.Vector3,P=new c.Vector2;class R{constructor(){this.bufferAttributes=new Map,this.interleavedAttributes=new Map}}class L extends v.CallExpr{constructor(e){super("memo",[e]),this.m_cachedProperties=[],this.m_deps=Array.from(e.dependencies().properties),this.descriptor=this}call(e){let t=!1;return this.m_deps.forEach(((i,n)=>{const r=e.env.lookup(i);t||r===this.m_cachedProperties[n]||(t=!0),t&&(this.m_cachedProperties[n]=r)})),(t||void 0===this.m_cachedValue)&&(this.m_cachedValue=e.evaluate(this.args[0])),this.m_cachedValue}}class D{constructor(e,t,i){this.geometry=e,this.info=t,this.cache=i}getBufferAttribute(e){if(this.cache.bufferAttributes.has(e))return this.cache.bufferAttributes.get(e);const t=(0,x.getBufferAttribute)(e);return this.cache.bufferAttributes.set(e,t),t}getInterleavedBufferAttributes(e){const t=this.cache.interleavedAttributes.get(e);if(t)return t;const i=new((0,m.getArrayConstructor)(e.type))(e.buffer),n=new o.InterleavedBuffer(i,e.stride),r=e.attributes.map((e=>{const t=new a.InterleavedBufferAttribute(n,e.itemSize,e.offset,!1);return{name:e.name,attribute:t}}));return this.cache.interleavedAttributes.set(e,r),r}}function I(e,t){if(Array.isArray(e)){const i=e;t.push(...i)}else t.push(e)}class O{static get instance(){return this.m_instance||(this.m_instance=new O)}constructor(){}initDecodedTile(e){for(const t of e.geometries)for(const e of t.groups)e.createdOffsets=[]}createAllGeometries(e,t){const i=this.createObjects(e,t);if(this.addIconTexts(e,t),this.createIconTexts(e,t,(e=>(0,g.isIconTextTechnique)(e)||(0,g.isLineMarkerTechnique)(e)||(0,g.isTextTechnique)(e))),this.createLabelRejectionElements(e,t),e.dataSource.addGroundPlane&&e.projection.type===p.ProjectionType.Planar){const t=e.mapView.getDataSourceByName(y.BackgroundDataSource.NAME);(0,w.addGroundPlane)(e,-1,null==t?void 0:t.backgroundColor)}return i}createLabelRejectionElements(e,t){if(void 0!==t.pathGeometries)for(const i of t.pathGeometries)e.addBlockingElement(new M.PathBlockingElement(i.path))}processTechniques(e){var t,i;const n=e.decodedTile;if(void 0===n)return!1;const r=n.techniques.length;if(0===r)return!0;const s=null!==(t=n.nextChunkTechIdx)&&void 0!==t?t:0;let o=s,a=null!==(i=n.nextChunkPropIdx)&&void 0!==i?i:0,l=!1;0===o&&0===a&&this.initDecodedTile(n);const c=e.dataSource.exprPool;let h=performance.now();e:for(;o<r;){o!==s&&(a=0);const e=n.techniques[o],t=Object.keys(e),i=t.length;for(;a<i;){const n=t[a++],s=e[n];if("kind"!==n&&(0,g.isJsonExpr)(s))try{let t=v.Expr.fromJSON(s);!0!==t.dependencies().volatile&&(t=new L(t)),e[n]=t.intern(c)}catch(e){C.error("Failed to compile expression:",e)}const u=a===i;if(u&&(l=++o===r),performance.now()-h>=3){u&&(a=0);break e}}}return l||(n.nextChunkTechIdx=o,n.nextChunkPropIdx=a),l}prepareTextPaths(e,t,i){const n=new Array,r=e.slice();for(;r.length>0;){const e=r.pop();if(void 0===e)break;const s=t.techniques[e.technique];(0,g.isTextTechnique)(s)&&(void 0===i||i(s))&&n.push(e)}return n}createIconTexts(e,t,i){var n;const s=e.mapView,o=e.computeWorldOffsetX(),a=Math.floor(s.zoomLevel),l=new g.MapEnv({$zoom:a},s.env),c=new b.IconTextBuilder(l,e.textStyleCache,e.dataSource.dataSourceOrder);if(void 0!==t.textPathGeometries){const n=this.prepareTextPaths(t.textPathGeometries,t,i);for(const r of n){const n=t.techniques[r.technique];if(!(0,g.isTextTechnique)(n)||void 0!==i&&!i(n)||!1===n.visible)continue;const s=[];for(let e=0;e<r.path.length;e+=3)s.push(new h.Vector3(r.path[e]+o,r.path[e+1],r.path[e+2]));const a=c.withTechnique(n).build(r.text,s,e.offset,e.dataSource.name,e.dataSource.dataSourceOrder,r.objInfos,r.pathLengthSqr);e.addIconText(a)}}if(void 0!==t.textGeometries)for(const s of t.textGeometries){if(void 0===s.technique||void 0===s.stringCatalog)continue;const a=t.techniques[s.technique];if(!(0,g.isTextTechnique)(a)||void 0!==i&&!i(a)||!1===a.visible)continue;const l=new r.BufferAttribute(new Float64Array(s.positions.buffer),s.positions.itemCount),u=l.count;if(!(u<1)){c.withTechnique(a);for(let t=0;t<u;++t){const i=l.getX(t)+o,r=l.getY(t),a=l.getZ(t),u=s.stringCatalog[s.texts[t]];if(void 0===u)continue;const d=null===(n=s.objInfos)||void 0===n?void 0:n[t],m=new h.Vector3(i,r,a),p=c.build(u,m,e.offset,e.dataSource.name,e.dataSource.dataSourceOrder,d);e.addIconText(p)}}}}createObjects(e,t,i){var o,a,c,d;const y=e.mapView,b=[],M=[],w=y.animatedExtrusionHandler,E=Math.floor(y.zoomLevel),C=new g.MapEnv({$zoom:E},y.env),R=e.objects,L=y.viewRanges,D=void 0!==y.elevationProvider,O=[];for(const E of this.getAttachments(t)){const F=E.geometry,U=E.info.groups,V=U.length;for(let N=0;N<V;){const B=U[N++],k=B.start,z=B.technique,G=t.techniques[z];if(void 0===B.createdOffsets&&(B.createdOffsets=[]),B.createdOffsets.includes(e.offset)||void 0!==i&&!i(G))continue;let j=B.count;for(B.createdOffsets.push(e.offset);N<V&&U[N].technique===z&&k+j===U[N].start;++N)j+=U[N].count,U[N].createdOffsets.push(e.offset);if(!(0,x.usesObject3D)(G))continue;const H=null!==(o=null==w?void 0:w.setAnimationProperties(G,C))&&void 0!==o&&o;let W=b[z];if(void 0===W){const e=(0,x.createMaterial)(G,y,{fog:null!==y.scene.fog,shadowsEnabled:y.shadowsEnabled});if(void 0===e)continue;W=e.material,O.push(e.texturesReady),H&&(0,f.hasExtrusionFeature)(W)&&I(W,M),b[z]=W}(0,g.isTerrainTechnique)(G)&&this.setupTerrainMaterial(G,W,e.mapView.clearColor);const q=new s.BufferGeometry;null===(a=F.vertexAttributes)||void 0===a||a.forEach((e=>{const t=E.getBufferAttribute(e);q.setAttribute(e.name,t)})),null===(c=F.interleavedVertexAttributes)||void 0===c||c.forEach((e=>{E.getInterleavedBufferAttributes(e).forEach((({name:e,attribute:t})=>q.setAttribute(e,t)))}));const X=null!==(d=E.info.index)&&void 0!==d?d:F.index;if(X&&q.setIndex(E.getBufferAttribute(X)),!q.getAttribute("normal")&&(0,g.needsVertexNormals)(G)&&q.computeVertexNormals(),q.addGroup(k,j),(0,g.isSolidLineTechnique)(G)){(0,_.assert)(!(0,f.isHighPrecisionLineMaterial)(W));const t=W;if(1===t.uniforms.wireframe.value){const e=[new h.Vector3(1,0,0),new h.Vector3(0,1,0),new h.Vector3(0,0,1)],t=q.attributes.position,i=new Float32Array(3*t.count);for(let n=0,r=t.count;n<r;n++)e[n%3].toArray(i,3*n);q.setAttribute("barycentric",new r.BufferAttribute(i,3))}!0===G.clipping&&e.projection.type===p.ProjectionType.Planar&&(e.boundingBox.getSize(A),P.set(A.x,A.y),t.clipTileSize=P),q.getAttribute("color")&&(0,f.setShaderMaterialDefine)(t,"USE_COLOR",!0)}const K=v.Expr.isExpr(G.visible)&&F.featureStarts&&F.featureStarts.length>0,Y=(0,x.buildObject)(G,q,K?[W]:W,e,D);if(Y.renderOrder=(0,m.getPropertyValue)(G.renderOrder,y.env),void 0!==E.info.uuid&&(Y.uuid=E.info.uuid,Y.userData.geometryId=E.info.uuid),((0,g.isCirclesTechnique)(G)||(0,g.isSquaresTechnique)(G))&&void 0!==G.enablePicking&&(Y.enableRayTesting=G.enablePicking),(0,g.isLineTechnique)(G)||(0,g.isSegmentsTechnique)(G)){const e=this.getFadingParams(C,G);f.FadingFeature.addRenderHelper(Y,L,e.fadeNear,e.fadeFar,!1)}if((0,g.isSolidLineTechnique)(G)){const e=this.getFadingParams(C,G);f.FadingFeature.addRenderHelper(Y,L,e.fadeNear,e.fadeFar,!1)}if((0,g.isExtrudedLineTechnique)(G)&&void 0!==G.fadeFar){const e=this.getFadingParams(y.env,G);f.FadingFeature.addRenderHelper(Y,L,e.fadeNear,e.fadeFar,!0)}if((0,g.isExtrudedPolygonTechnique)(G)?(Y.castShadow=y.shadowsEnabled,Y.receiveShadow=y.shadowsEnabled):((0,g.isStandardTechnique)(G)||(0,g.isPolygonTechnique)(G))&&(Y.receiveShadow=y.shadowsEnabled),((0,g.isExtrudedPolygonTechnique)(G)||(0,g.isStandardTechnique)(G)||(0,g.isPolygonTechnique)(G))&&void 0!==G.fadeFar){const e=this.getFadingParams(C,G);f.FadingFeature.addRenderHelper(Y,L,e.fadeNear,e.fadeFar,!0)}if((0,g.isExtrudedPolygonTechnique)(G)&&(0,S.isRenderDepthPrePassEnabled)(G,C)){const t=(0,S.createDepthPrePassMesh)(Y);this.addUserData(e,F,t,{technique:G,pickability:g.Pickability.transient}),R.push(t),H&&I(t.material,M),(0,S.setDepthPrePassStencil)(t,Y)}const Z=(0,g.transientToPickability)((0,m.getPropertyValue)(G.transient,y.env));if(this.addUserData(e,F,Y,{technique:G,pickability:Z}),R.push(Y),(0,g.isExtrudedPolygonTechnique)(G)&&void 0!==E.info.edgeIndex){const t=v.Expr.isExpr(G.visible)&&F.edgeFeatureStarts&&F.edgeFeatureStarts.length>0,i=G,n=new s.BufferGeometry;n.setAttribute("position",q.getAttribute("position"));const r=q.getAttribute("color");void 0!==r&&n.setAttribute("color",r);const o=q.getAttribute("extrusionAxis");void 0!==o&&n.setAttribute("extrusionAxis",o);const a=q.getAttribute("normal");void 0!==a&&n.setAttribute("normal",a);const c=q.getAttribute("uv");void 0!==c&&n.setAttribute("uv",c),n.setIndex(E.getBufferAttribute(E.info.edgeIndex));const h=G,d=this.getPolygonFadingParams(C,h),p={color:d.color,colorMix:d.colorMix,fadeNear:d.lineFadeNear,fadeFar:d.lineFadeFar,extrusionRatio:H?0:void 0,vertexColors:!!q.getAttribute("color"),rendererCapabilities:y.renderer.capabilities},_=new f.EdgeMaterial(p),x=new u.LineSegments(n,t?[_]:_);x.renderOrder=Y.renderOrder+.1,f.FadingFeature.addRenderHelper(x,L,d.lineFadeNear,d.lineFadeFar,!1),H&&I(x.material,M),this.addUserData(e,F,x,{technique:G,pickability:g.Pickability.transient}),T.MapMaterialAdapter.create(_,{color:i.lineColor,objectColor:i.color,opacity:i.opacity,lineWidth:e=>{const t=(0,m.getPropertyValue)(i.lineWidth,e.env);return"number"==typeof t?(0,l.clamp)(t,0,1):0}}),R.push(x)}if((0,g.isExtrudedPolygonTechnique)(G)&&H&&(Y.customDepthMaterial=new f.MapMeshDepthMaterial({depthPacking:n.RGBADepthPacking}),I(Y.customDepthMaterial,M)),(0,g.isPolygonTechnique)(G)&&E.info.edgeIndex){const t=v.Expr.isExpr(G.visible)&&F.edgeFeatureStarts&&F.edgeFeatureStarts.length>0,i=new s.BufferGeometry;i.setAttribute("position",q.getAttribute("position")),i.setIndex(E.getBufferAttribute(E.info.edgeIndex));const n=G,r=this.getPolygonFadingParams(y.env,n),o={color:r.color,colorMix:r.colorMix,fadeNear:r.lineFadeNear,fadeFar:r.lineFadeFar,vertexColors:!!q.getAttribute("color"),rendererCapabilities:y.renderer.capabilities},a=new f.EdgeMaterial(o),l=new u.LineSegments(i,t?[a]:a);l.renderOrder=Y.renderOrder+.1,f.FadingFeature.addRenderHelper(l,L,r.lineFadeNear,r.lineFadeFar,!1),this.addUserData(e,F,l,{technique:G,pickability:Z}),T.MapMaterialAdapter.create(a,{color:n.lineColor,objectColor:n.color,opacity:n.opacity}),R.push(l)}}}return M.length>0&&y.animatedExtrusionHandler.add(e,M),Promise.all(O).then()}addIconTexts(e,t){void 0!==t.iconTextGeometries&&e.mapView.imageRepo.iconTextManager.addIconTexts(e,t)}*getAttachments(e){const t=new R;for(const i of e.geometries){const e={index:i.index,edgeIndex:i.edgeIndex,uuid:i.uuid,groups:i.groups};if(yield new D(i,e,t),i.attachments)for(const e of i.attachments)yield new D(i,e,t)}}setupTerrainMaterial(e,t,i){if(!e.map||!e.displacementMap){const e=t;return e.color.set(i),void(0,f.setDisplacementMapToMaterial)(null,e)}t.onBeforeCompile=e=>{e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>","#include <map_pars_fragment>\n    uniform sampler2D displacementMap;\n    uniform float displacementScale;\n    uniform float displacementBias;"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#ifdef USE_MAP\n    float minElevation = ${p.EarthConstants.MIN_ELEVATION.toFixed(1)};\n    float maxElevation = ${p.EarthConstants.MAX_ELEVATION.toFixed(1)};\n    float elevationRange = maxElevation - minElevation;\n\n    float disp = texture2D( displacementMap, vUv ).x * displacementScale + displacementBias;\n    vec4 texelColor = texture2D( map, vec2((disp - minElevation) / elevationRange, 0.0) );\n    texelColor = mapTexelToLinear( texelColor );\n    diffuseColor *= texelColor;\n#endif`),e.vertexShader=e.vertexShader.replace("#include <displacementmap_vertex>","")},t.displacementMap.needsUpdate=!0}addUserData(e,t,i,r){const s=r.technique;if((0,g.isTerrainTechnique)(s)){(0,_.assert)(0===Object.keys(i.userData).length,"Unexpected user data in terrain object"),(0,_.assert)("object"==typeof t.objInfos[0],"Wrong attribute map type for terrain geometry");const r=t.objInfos[0],s={tileKey:e.tileKey,texture:new d.DataTexture(r.buffer,r.xCountVertices,r.yCountVertices,n.LuminanceFormat,n.FloatType),displacementMap:r,geoBox:e.geoBox};i.userData=s}else{const n="LineSegments"===i.type&&((0,g.isExtrudedPolygonTechnique)(s)||(0,g.isPolygonTechnique)(s)),o={geometryType:t.type,starts:n?t.edgeFeatureStarts:t.featureStarts,objInfos:t.objInfos};void 0===i.userData&&(i.userData={}),i.userData.feature=o,(0,E.registerTileObject)(e,i,Object.assign({tileKey:e.tileKey,dataSource:e.dataSource},r))}}getFadingParams(e,t){return{fadeNear:void 0!==t.fadeNear?(0,m.getPropertyValue)(t.fadeNear,e):f.FadingFeature.DEFAULT_FADE_NEAR,fadeFar:void 0!==t.fadeFar?(0,m.getPropertyValue)(t.fadeFar,e):f.FadingFeature.DEFAULT_FADE_FAR}}getPolygonFadingParams(e,t){let i,n=f.EdgeMaterial.DEFAULT_COLOR_MIX;if(void 0!==t.lineColor&&(i=(0,m.getPropertyValue)(t.lineColor,e),(0,g.isExtrudedPolygonTechnique)(t))){const e=t;n=void 0!==e.lineColorMix?e.lineColorMix:f.EdgeMaterial.DEFAULT_COLOR_MIX}const r=void 0!==t.fadeNear?(0,m.getPropertyValue)(t.fadeNear,e):f.FadingFeature.DEFAULT_FADE_NEAR,s=void 0!==t.fadeFar?(0,m.getPropertyValue)(t.fadeFar,e):f.FadingFeature.DEFAULT_FADE_FAR,o=void 0!==t.lineFadeNear?(0,m.getPropertyValue)(t.lineFadeNear,e):r,a=void 0!==t.lineFadeFar?(0,m.getPropertyValue)(t.lineFadeFar,e):s;return void 0===i&&(i=f.EdgeMaterial.DEFAULT_COLOR),{color:i,colorMix:n,fadeNear:r,fadeFar:s,lineFadeNear:o,lineFadeFar:a}}}t.TileGeometryCreator=O},1335:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryLoader=t.TileGeometryLoaderState=void 0;const n=i(4342),r=i(3977),s=i(8015),o=i(5912);function a(e){const t=s.PerformanceStatistics.instance;if(t.enabled){const i=e.dataSource.name,n=e.tileKey.level,r=e.tileKey.column,s=e.tileKey.row,o=e.disposed?"disposed":"invisible";t.currentFrame.addMessage(`Decoded tile: ${i} # lvl=${n} col=${r} row=${s} DISCARDED - ${o}`)}}var l;!function(e){e[e.Initialized=0]="Initialized",e[e.Decoding=1]="Decoding",e[e.CreationQueued=2]="CreationQueued",e[e.CreatingGeometry=3]="CreatingGeometry",e[e.Finished=4]="Finished",e[e.Canceled=5]="Canceled",e[e.Disposed=6]="Disposed"}(l=t.TileGeometryLoaderState||(t.TileGeometryLoaderState={})),t.TileGeometryLoader=class{constructor(e,t){this.m_tile=e,this.m_taskQueue=t,this.m_priority=0,this.m_state=l.Initialized,this.m_finishedPromise=new Promise(((e,t)=>{this.m_resolveFinishedPromise=e,this.m_rejectFinishedPromise=t}))}set priority(e){this.m_priority=e}getPriority(){return this.m_priority}get tile(){return this.m_tile}get hasDecodedTile(){return void 0!==this.m_decodedTile}get isFinished(){return this.m_state===l.Finished}get isSettled(){return this.isFinished||this.isCanceled||this.isDisposed}waitFinished(){return this.m_finishedPromise}setDecodedTile(e){return this.m_decodedTile=e,this.m_decodedTile}update(){const e=this.tile;this.m_state!==l.Initialized&&this.m_state!==l.Canceled||void 0===e.decodedTile||this.m_state===l.Initialized&&this.queueDecoder()}cancel(){var e;a(this.tile),this.m_state=l.Canceled,null===(e=this.m_rejectFinishedPromise)||void 0===e||e.call(this)}dispose(){var e;a(this.tile),this.clear(),this.m_state=l.Disposed,null===(e=this.m_rejectFinishedPromise)||void 0===e||e.call(this)}reset(){this.clear(),this.isSettled&&(this.m_finishedPromise=new Promise(((e,t)=>{this.m_resolveFinishedPromise=e,this.m_rejectFinishedPromise=t}))),this.m_state=l.Initialized}finish(){var e;this.m_decodedTile=void 0,this.m_state=l.Finished,null===(e=this.m_resolveFinishedPromise)||void 0===e||e.call(this)}clear(){this.m_decodedTile=void 0}queueGeometryCreation(){this.m_state!==l.CreationQueued&&(this.m_taskQueue.add({execute:this.createGeometry.bind(this),group:r.TileTaskGroups.CREATE,getPriority:this.getPriority.bind(this),isExpired:()=>this.m_state!==l.CreationQueued,estimatedProcessTime:()=>{var e,t;return(null!==(t=null===(e=this.tile.decodedTile)||void 0===e?void 0:e.decodeTime)&&void 0!==t?t:30)/6}}),this.m_state=l.CreationQueued)}queueDecoder(){this.m_taskQueue.add({execute:()=>{o.TileGeometryCreator.instance.processTechniques(this.tile)?(this.setDecodedTile(this.tile.decodedTile),this.queueGeometryCreation()):this.queueDecoder()},group:r.TileTaskGroups.CREATE,getPriority:this.getPriority.bind(this),isExpired:()=>this.m_state!==l.Decoding,estimatedProcessTime:()=>{var e,t;return(null!==(t=null===(e=this.tile.decodedTile)||void 0===e?void 0:e.decodeTime)&&void 0!==t?t:30)/6}}),this.m_state=l.Decoding}async createGeometry(){if(this.m_state===l.CreatingGeometry)return;this.m_state=l.CreatingGeometry;const e=this.tile,t=this.m_decodedTile;if(void 0===t)return void this.finish();const i=s.PerformanceStatistics.instance;let r=0;i.enabled&&(r=n.PerformanceTimer.now());const a=o.TileGeometryCreator.instance;e.clear(),a.initDecodedTile(t),await a.createAllGeometries(e,t),i.enabled&&this.addStats(i,r),this.finish(),e.dataSource.requestUpdate()}addStats(e,t){const i=this.tile,r=this.m_decodedTile;if(void 0===r)return;const s=n.PerformanceTimer.now()-t,o=e.currentFrame;o.addValue("render.fullFrameTime",s),o.addValue("render.geometryCreationTime",s),o.addValue("geometry.geometryCreationTime",s),o.addValue("geometryCount.numGeometries",r.geometries.length),o.addValue("geometryCount.numTechniques",r.techniques.length),o.addValue("geometryCount.numIconTextGeometries",void 0!==r.iconTextGeometries?r.iconTextGeometries.length:0),o.addValue("geometryCount.numTextGeometries",void 0!==r.textGeometries?r.textGeometries.length:0),o.addValue("geometryCount.numTextPathGeometries",void 0!==r.textPathGeometries?r.textPathGeometries.length:0),o.addValue("geometryCount.numPathGeometries",void 0!==r.pathGeometries?r.pathGeometries.length:0),o.addMessage(`Decoded tile: ${i.dataSource.name} # lvl=${i.tileKey.level} col=${i.tileKey.column} row=${i.tileKey.row}`)}get isCanceled(){return this.m_state===l.Canceled}get isDisposed(){return this.m_state===l.Disposed}}},3801:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryManager=void 0,t.TileGeometryManager=class{get visibilityCounter(){return this.m_visibilityCounter}constructor(e){this.mapView=e,this.m_visibilityCounter=1}updateTiles(e){let t=0;for(const i of e){const e=t++;i.updateGeometry(e)&&this.m_tileUpdateCallback&&this.m_tileUpdateCallback(i)}}clear(){}setTileUpdateCallback(e){this.m_tileUpdateCallback=e}incrementVisibilityCounter(){return++this.m_visibilityCounter}}},8813:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexCache=void 0;const n=i(4342);var r;!function(e){e[e.VertexId=0]="VertexId",e[e.OlderIdx=1]="OlderIdx",e[e.NewerIdx=2]="NewerIdx",e[e.X=3]="X",e[e.Y=4]="Y",e[e.Z=5]="Z",e[e.Count=6]="Count"}(r||(r={}));const s=-1;t.VertexCache=class{constructor(e){this.maxVertexCount=e,this.m_cache=[],this.m_vertexCount=0,this.m_oldestIdx=0,this.m_newestIdx=0,this.m_cache.length=this.maxVertexCount*r.Count,this.clear()}clear(){this.m_cache.fill(s),this.m_vertexCount=0}get(e,t){const i=this.find(e);return void 0!==i&&(this.promoteEntry(i),this.getVertex(i,t),!0)}set(e,t){let i=s;this.m_vertexCount<this.maxVertexCount?(i=this.m_vertexCount*r.Count,this.m_vertexCount++):i=this.m_oldestIdx,1===this.m_vertexCount?this.m_oldestIdx=this.m_newestIdx=i:this.promoteEntry(i),this.setVertex(i,e,t)}find(e){const t=this.m_cache.length;for(let i=0;i<t;i+=r.Count)if(this.m_cache[i]===e)return i}promoteEntry(e){if(e===this.m_newestIdx)return;const t=this.getNewerIdx(e),i=this.getOlderIdx(e);t!==s&&((0,n.assert)(this.getOlderIdx(t)===e),this.setOlderIdx(t,i)),i!==s&&((0,n.assert)(this.getNewerIdx(i)===e),this.setNewerIdx(i,t)),e===this.m_oldestIdx&&(this.m_oldestIdx=t),this.setNewerIdx(e,s),this.setOlderIdx(e,this.m_newestIdx),(0,n.assert)(this.m_newestIdx!==s),(0,n.assert)(this.getNewerIdx(this.m_newestIdx)===s),this.setNewerIdx(this.m_newestIdx,e),this.m_newestIdx=e}getOlderIdx(e){return this.m_cache[e+r.OlderIdx]}setOlderIdx(e,t){this.m_cache[e+r.OlderIdx]=t}getNewerIdx(e){return this.m_cache[e+r.NewerIdx]}setNewerIdx(e,t){this.m_cache[e+r.NewerIdx]=t}getVertex(e,t){t.x=this.m_cache[e+r.X],t.y=this.m_cache[e+r.Y],t.z=this.m_cache[e+r.Z]}setVertex(e,t,i){this.m_cache[e]=t,this.m_cache[e+r.X]=i.x,this.m_cache[e+r.Y]=i.y,this.m_cache[e+r.Z]=i.z}}},9587:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overlayOnElevation=t.overlayIconText=void 0;const n=i(4250),r=i(1984),s=i(4342),o=i(4572);function a(e,t){if(!("material"in e))return;const i=n.setDisplacementMapToMaterial.bind(null,t),r=e.material;Array.isArray(r)?r.forEach(i):r&&i(r)}function l(e,t,i,n){const r=n.unprojectPoint(e);if(i.geoBox.contains(r))r.altitude=t.sampleHeight(r,i);else if(r.altitude=t.getHeight(r,i.tileKey.level),void 0===r.altitude)return!1;return n.projectPoint(r,e),!0}t.overlayIconText=function(e,t,i,n){(0,s.assert)(!e.elevated),i&&(e.elevated=e.path?function(e,t,i,n){for(const r of e)if(!l(r,t,i,n))return!1;return!0}(e.path,t,i,n):l(e.position,t,i,n))},t.overlayOnElevation=function(e){const t=e.mapView.elevationProvider;if(void 0===t||0===e.objects.length)return;const i=e.objects[0],n=o.MapObjectAdapter.get(i);if(!i.userData||!(null==n?void 0:n.technique)||(0,r.isTerrainTechnique)(null==n?void 0:n.technique))return;const s=t.getDisplacementMap(e.tileKey);if(void 0!==s)for(const t of e.objects)a(t,s.texture)}},2967:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconText=t.IconCompositionType=t.LoadingState=void 0;const n=i(5823),r=i(2002);var s,o;(o=t.LoadingState||(t.LoadingState={}))[o.Requested=0]="Requested",o[o.Loaded=1]="Loaded",o[o.Initialized=2]="Initialized",(s=t.IconCompositionType||(t.IconCompositionType={}))[s.OVERLAID=0]="OVERLAID",s[s.NEXT_TO_EACH_OTHER=1]="NEXT_TO_EACH_OTHER";class a{constructor(e,t,i,r,s=0,o=0,a=0,l=0,c,h,u,d,m,p,f,g){this.text=e,this.points=t,this.renderParams=i,this.layoutParams=r,this.priority=s,this.zOrder=o,this.xOffset=a,this.yOffset=l,this.featureId=c,this.style=h,this.fadeNear=u,this.fadeFar=d,this.tileOffset=m,this.offsetDirection=p,this.dataSourceName=f,this.dataSourceOrder=g,this.visible=!0,this.distanceScale=.5,this.renderOrder=0,this.elevated=!1,i instanceof n.TextRenderStyle&&(this.renderStyle=i),r instanceof n.TextLayoutStyle&&(this.layoutStyle=r),this.setType()}setType(){this.type=void 0===this.path?r.IconTextType.PointIconText:this.m_iconsInfo?r.IconTextType.LineMarker:r.IconTextType.PathLabel}get position(){return this.points instanceof Array?this.points[0]:this.points}get path(){return this.points instanceof Array?this.points:void 0}get textMayOverlap(){return!0===this.mayOverlap}set textMayOverlap(e){this.mayOverlap=e}get textReservesSpace(){return!1!==this.reserveSpace}set textReservesSpace(e){this.reserveSpace=e}get iconInfoList(){return this.m_iconsInfo}set iconInfoList(e){if(void 0!==e&&e.length>0){this.m_iconsInfo=e;const t=void 0!==this.renderOrder?this.renderOrder:0;e.forEach((e=>e.renderOrder=t))}else this.m_iconsInfo=void 0;this.setType()}get renderStyle(){return this.m_renderStyle}set renderStyle(e){this.m_renderStyle=e}get layoutStyle(){return this.m_layoutStyle}set layoutStyle(e){this.m_layoutStyle=e}hasFeatureId(){return!!this.featureId}dispose(){var e,t,i;null===(e=this.iconInfoList)||void 0===e||e.forEach((e=>{var t;return null===(t=e.buffer)||void 0===t?void 0:t.decreaseRefCount()})),null===(i=null===(t=this.textBackgroundInfo)||void 0===t?void 0:t.buffer)||void 0===i||i.decreaseRefCount()}}t.IconText=a,a.HIGHEST_PRIORITY=Number.MAX_SAFE_INTEGER,a.HIGHEST_Z_ORDER=Number.MAX_SAFE_INTEGER},5316:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextBuilder=void 0;const n=i(8152),r=i(5823),s=i(1984),o=i(4342),a=i(2967),l=i(304),c=i(3174),h=o.LoggerManager.instance.create("IconTextBuilder");class u{static composeRenderOrder(e,t){return e*u.RENDER_ORDER_UP_BOUND+t}constructor(e,t,i){if(this.m_env=e,this.m_styleCache=t,this.m_baseRenderOrder=i,this.m_distanceScale=l.DEFAULT_TEXT_DISTANCE_SCALE,this.m_renderOrder=i,Number.isInteger(i))this.renderOrderUpBound=u.RENDER_ORDER_UP_BOUND;else{const e=Math.abs(i);this.renderOrderUpBound=(e-Math.floor(e))*u.RENDER_ORDER_UP_BOUND}this.isValidRenderOrder(i)||h.warn(`Large base render order (${i}) might cause precision issues.`)}withTechnique(e){var t,i,r,a,c;this.m_technique=e,this.m_priority=null!==(t=(0,n.getPropertyValue)(e.priority,this.m_env))&&void 0!==t?t:0,this.m_fadeNear=null!==(i=(0,n.getPropertyValue)(e.fadeNear,this.m_env))&&void 0!==i?i:void 0,this.m_fadeFar=null!==(r=(0,n.getPropertyValue)(e.fadeFar,this.m_env))&&void 0!==r?r:void 0,this.m_distanceScale=null!==(a=e.distanceScale)&&void 0!==a?a:l.DEFAULT_TEXT_DISTANCE_SCALE,this.m_renderStyle=this.m_styleCache.getRenderStyle(e),this.m_layoutStyle=this.m_styleCache.getLayoutStyle(e),this.m_xOffset=(0,n.getPropertyValue)(e.xOffset,this.m_env),this.m_yOffset=(0,n.getPropertyValue)(e.yOffset,this.m_env),this.m_zOrder=(0,n.getPropertyValue)(e.zOrder,this.m_env);const d=null!==(c=(0,n.getPropertyValue)(e.renderOrder,this.m_env))&&void 0!==c?c:0;if(!this.isValidRenderOrder(d)){const e=`Unsupported large render order (${d})`;h.error(e),(0,o.assert)(!1,e)}return this.m_renderOrder=u.composeRenderOrder(this.m_baseRenderOrder,d),(0,s.isTextTechnique)(e)?this.withTextTechnique(e):this.withIconTextTechnique(e),this}withIcon(e,t){return(0,o.assert)(void 0!==this.m_iconInfoBuilder),this.m_iconInfoBuilder.withIcon(e),this.m_shieldGroupIndex=t,this}withTextBackgroundImage(e){return this.m_textBackgroundImageTextureName=e,this}build(e,t,i,s,l,c,h,u){var d,m;const p=(0,n.getFeatureId)(c);(0,o.assert)(void 0!==this.m_technique),(0,o.assert)(void 0!==this.m_renderStyle),(0,o.assert)(void 0!==this.m_layoutStyle);const f=this.m_technique,g=this.m_renderStyle,v=this.m_layoutStyle,_=new a.IconText(r.ContextualArabicConverter.instance.convert(e),t,g,v,this.m_priority,this.m_zOrder,this.m_xOffset,this.m_yOffset,p,f.style,this.m_fadeNear,this.m_fadeFar,i,u,s,l);if(_.textMinZoomLevel=this.m_textMinZoomLevel,_.textMaxZoomLevel=this.m_textMaxZoomLevel,_.iconMinZoomLevel=this.m_iconMinZoomLevel,_.iconMaxZoomLevel=this.m_iconMaxZoomLevel,_.textBrightness=this.m_textBrightness,_.distanceScale=this.m_distanceScale,_.mayOverlap=this.m_mayOverlap,_.reserveSpace=this.m_reserveSpace,_.userData=c,_.technique=this.m_technique,_.textFadeTime=void 0!==f.textFadeTime?1e3*f.textFadeTime:void 0,_.pathLengthSqr=h,_.alwaysOnTop=this.m_alwaysOnTop,_.renderOrder=this.m_renderOrder,_.textIsOptional=this.m_textIsOptional,_.iconIsOptional=this.m_iconIsOptional,_.iconCompositionType=this.m_iconCompositionType,_.shieldGroupIndex=this.m_shieldGroupIndex,this.m_textBackgroundImageTextureName){const e=f;_.textBackgroundInfo={technique:e,imageTextureName:this.m_textBackgroundImageTextureName,iconText:_,reserveSpace:e.textReserveSpace,renderOrder:null!==(d=_.renderOrder)&&void 0!==d?d:0}}return _.iconInfoList=null===(m=this.m_iconInfoBuilder)||void 0===m?void 0:m.build(_),_}withTextTechnique(e){var t,i;this.m_mayOverlap=!0===e.mayOverlap,this.m_reserveSpace=!1!==e.reserveSpace,this.m_iconInfoBuilder=void 0,this.m_textBackgroundImageTextureName=void 0,this.m_iconIsOptional=void 0,this.m_iconCompositionType=void 0,this.m_shieldGroupIndex=void 0,this.m_textMinZoomLevel=null!==(t=(0,n.getPropertyValue)(e.minZoomLevel,this.m_env))&&void 0!==t?t:void 0,this.m_textMaxZoomLevel=null!==(i=(0,n.getPropertyValue)(e.maxZoomLevel,this.m_env))&&void 0!==i?i:void 0}withIconTextTechnique(e){var t,i,r,s,l,h,u,d,m;this.m_mayOverlap=!0===e.textMayOverlap,this.m_reserveSpace=!1!==e.textReserveSpace,this.m_alwaysOnTop=!0===e.alwaysOnTop,this.m_textIsOptional=!0===e.textIsOptional,this.m_iconIsOptional=!0===e.iconIsOptional,this.m_iconCompositionType="nextToEachOther"===e["icon-composition-type"]?a.IconCompositionType.NEXT_TO_EACH_OTHER:a.IconCompositionType.OVERLAID,this.m_textMinZoomLevel=null!==(i=(0,n.getPropertyValue)(null!==(t=e.textMinZoomLevel)&&void 0!==t?t:e.minZoomLevel,this.m_env))&&void 0!==i?i:void 0,this.m_textBrightness=null!==(r=o.MathUtils.clamp((0,n.getPropertyValue)(e.textBrightness,this.m_env),0,1))&&void 0!==r?r:1,this.m_textMaxZoomLevel=null!==(l=(0,n.getPropertyValue)(null!==(s=e.textMaxZoomLevel)&&void 0!==s?s:e.maxZoomLevel,this.m_env))&&void 0!==l?l:void 0,this.m_iconMinZoomLevel=null!==(u=(0,n.getPropertyValue)(null!==(h=e.iconMinZoomLevel)&&void 0!==h?h:e.minZoomLevel,this.m_env))&&void 0!==u?u:void 0,this.m_iconMaxZoomLevel=null!==(m=(0,n.getPropertyValue)(null!==(d=e.iconMaxZoomLevel)&&void 0!==d?d:e.maxZoomLevel,this.m_env))&&void 0!==m?m:void 0,this.m_iconInfoBuilder||(this.m_iconInfoBuilder=new c.IconInfoBuilder(this.m_env)),this.m_iconInfoBuilder.withTechnique(e)}isValidRenderOrder(e){return Math.abs(e)<this.renderOrderUpBound}}t.IconTextBuilder=u,u.RENDER_ORDER_UP_BOUND=1e7},9473:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextGroup=void 0;const n=i(4342);class r extends n.PriorityListGroup{static comparePlacementPriority(e,t){return t.priority-e.priority||t.zOrder-e.zOrder||t.elements.length-e.elements.length}}t.IconTextGroup=r},7013:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextGroupPriorityList=void 0;const n=i(4342);class r extends n.GroupedPriorityList{}t.IconTextGroupPriorityList=r},950:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextGroupState=void 0;const n=i(4342),r=i(3981),s=i(2002);t.IconTextGroupState=class{constructor(e,t,i){this.group=e,this.tileKey=t,this.m_visited=!1,(0,n.assert)(e.elements.length>0);const o=e.elements.length;this.m_iconTextStates=[],this.m_visited=!0;for(let t=0;t<o;++t){const n=e.elements[t];if(n.type===s.IconTextType.LineMarker&&void 0!==n.path){const e=n.path.length;for(let t=0;t<e;t++){const e=new r.IconTextState(n,t),s=i(e);void 0!==s&&(e.update(s),this.m_iconTextStates.push(e))}}else{const e=new r.IconTextState(n),t=i(e);void 0!==t&&(e.update(t),this.m_iconTextStates.push(e))}}}get visited(){return this.m_visited}set visited(e){this.m_visited=e}get priority(){return this.group.priority}get zOrder(){return this.group.zOrder}updateFading(e,t){for(const i of this.m_iconTextStates)void 0!==i&&i.updateFading(e,t)}traverseVisibleIconTexts(e){for(const t of this.m_iconTextStates)void 0!==t&&t.visible&&e(t)}updateIconTexts(e){for(const t of this.m_iconTextStates){const i=e(t);t.update(i)}}get size(){return this.m_iconTextStates.length}get iconTextStates(){return this.m_iconTextStates}}},5738:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextManager=void 0;const n=i(9365),r=i(6815),s=i(1984),o=i(4342),a=i(5316),l=o.LoggerManager.instance.create("IconTextManager");function c(e,t=0){if(e.imageTextures){const i=e.imageTextures[t];if(i>=0)return e.stringCatalog[i]}}function h(e,t=0){if(e.textBackgroundImageTextures){const i=e.textBackgroundImageTextures[t];if(i>=0)return e.stringCatalog[i]}}function u(e,t=0){return e.objInfos?e.objInfos[t]:void 0}function d(e,t,i=0){const n=(new r.Vector3).fromBufferAttribute(e,i);return n.x+=t,n}function m(e,t=0){var i;(0,o.assert)(e.texts.length>t);const n=e.texts[t];return(0,o.assert)(e.stringCatalog.length>n),null!==(i=e.stringCatalog[n])&&void 0!==i?i:""}t.IconTextManager=class{constructor(){this.m_imageTextures=new Map,this.m_roadShieldGroups=new Map}addIconTexts(e,t){const i=(0,o.assertExists)(t.iconTextGeometries),r=e.computeWorldOffsetX(),l=e.mapView,c=Math.floor(l.zoomLevel),h=new s.MapEnv({$zoom:c},l.env),u=new a.IconTextBuilder(h,e.textStyleCache,e.dataSource.dataSourceOrder);for(const a of i){(0,o.assert)(void 0!==a.technique);const i=(0,o.assertExists)(a.technique),l=t.techniques[i];if(!(0,s.isLineMarkerTechnique)(l)&&!(0,s.isIconTextTechnique)(l))continue;if(!1===l.visible)continue;const c=new n.BufferAttribute(new Float64Array(a.positions.buffer),a.positions.itemCount);u.withTechnique(l),(0,s.isLineMarkerTechnique)(l)&&c.count>0?this.addLineMarker(u,e,a,c,r):(0,s.isIconTextTechnique)(l)&&this.addIconText(u,e,a,c,r)}}async addTextureAtlas(e,t,i){const n=await fetch(t,{signal:i});if(!n.ok)throw new Error(`addTextureAtlas: Cannot load textureAtlas: ${n.statusText}`);const r=await n.json();for(const t of Object.getOwnPropertyNames(r)){const i=r[t],n={name:t,image:e,xOffset:i.x,yOffset:i.y,width:i.width,height:i.height};this.addImageTexture(n)}}addImageTexture(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&l.warn(`addImageTexture: Name already used: ${e.name} (overriding it)`),this.m_imageTextures.set(e.name,e)):l.error("addImageTexture: Name required",e)}getImageTexture(e){return this.m_imageTextures.get(e)}clear(){this.m_imageTextures.clear(),this.m_roadShieldGroups.clear()}addLineMarker(e,t,i,n,r){const s=m(i),o=c(i),a=o+"-"+s;let l=this.m_roadShieldGroups.get(a);void 0===l&&(l=this.m_roadShieldGroups.size,this.m_roadShieldGroups.set(a,l));const h=[];for(let e=0;e<n.count;++e)h.push(d(n,r,e));const p=e.withIcon(o,l).build(s,h,t.offset,t.dataSource.name,t.dataSource.dataSourceOrder,u(i));t.addIconText(p)}addIconText(e,t,i,n,r){var s,o;for(let a=0;a<n.count;++a){const l=null!==(o=null===(s=i.offsetDirections)||void 0===s?void 0:s[a])&&void 0!==o?o:0;e.withIcon(c(i,a)),e.withTextBackgroundImage(h(i,a));const p=e.build(m(i,a),d(n,r,a),t.offset,t.dataSource.name,t.dataSource.dataSourceOrder,u(i,a),void 0,l);t.addIconText(p)}}}},304:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextRenderer=t.DEFAULT_TEXT_DISTANCE_SCALE=t.DEFAULT_FONT_CATALOG_NAME=void 0;const n=i(9896),r=i(8117),s=i(7793),o=i(8817),a=i(3441),l=i(6307),c=i(977),h=i(5971),u=i(3334),d=i(5448),m=i(6815),p=i(4760),f=i(5269),g=i(5823),v=i(4342),_=i(507),y=i(9587),x=i(7362),S=i(2967),b=i(9473),T=i(8950),M=i(791),w=i(2002),E=i(5570),C=i(9913),A=(i(7234),i(4957)),P=i(9463),R=i(3800);var L;i(859),function(e){e[e.PersistentLabels=0]="PersistentLabels",e[e.NewLabels=1]="NewLabels"}(L||(L={})),t.DEFAULT_FONT_CATALOG_NAME="default",t.DEFAULT_TEXT_DISTANCE_SCALE=.5;const D=v.LoggerManager.instance.create("IconTextRenderer",{level:v.LogLevel.Log}),I=new m.Vector3,O=new d.Vector2,F=new d.Vector2,U=[],V={},N={},B={},k=new h.Color,z=new h.Color,G={vector2:[new d.Vector2]};function j(e,t,i,n,r){N.path=n,N.pathOverflow=r,N.layer=e.renderOrder,N.letterCaseArray=e.glyphCaseArray,N.pickingData=e.userData?e:void 0,t.addText(e.glyphs,i,N)}t.IconTextRenderer=class{constructor(e,t,i,r,s,o,a,l){this.m_viewState=e,this.m_screenProjector=t,this.m_imageRepo=i,this.m_textureCache=r,this.m_renderer=s,this.m_loadPromisesCount=0,this.m_textCanvases=new Map,this.m_fontCatalogUrls=new Map,this.m_tmpVector=new d.Vector2,this.m_tmpVector3=new m.Vector3,this.m_cameraLookAt=new m.Vector3,this.m_cacheInvalidated=!1,this.m_addNewLabels=!0,this.m_forceNewLabelsPass=!1,this.m_iconTextStateCache=new M.IconTextStateCache,this.m_camera=new n.OrthographicCamera(-1,1,1,-1),this.m_textStyleCache=new R.TextStyleCache,this.m_screenCollisions=new x.ScreenCollisions,this.m_isUpdatePending=!1,this.m_options=Object.assign({},o),(0,T.initializeDefaultOptions)(this.m_options),this.m_maxFarDistanceRatio=Math.max(this.m_options.maxDistanceRatioForText,this.m_options.maxDistanceRatioForIconText),this.m_textCanvasFactory=null!=a?a:new P.TextCanvasFactory(this.m_renderer),this.m_textCanvasFactory.setGlyphCountLimits(this.m_options.minNumGlyphs,this.m_options.maxNumGlyphs),this.m_imageRenderer=null!=l?l:new E.ImageRenderer(this.m_renderer,this.m_imageRepo,this.m_textureCache),this.initializeCamera(),this.updateFontCatalogs()}set screenCollisions(e){this.m_screenCollisions=e}get screenCollisions(){return this.m_screenCollisions}set disableFading(e){this.m_options.disableFading=e}get disableFading(){return!0===this.m_options.disableFading}set enableDuplicateDetection(e){this.m_options.enableDuplicateDetection=e}get enableDuplicateDetection(){return!0===this.m_options.enableDuplicateDetection}set enableCloseProximityDetection(e){this.m_options.enableCloseProximityDetection=e}get enableCloseProximityDetection(){return!0===this.m_options.enableCloseProximityDetection}set enableViewDistanceChecks(e){this.m_options.enableViewDistanceChecks=e}get enableViewDistanceChecks(){return!0===this.m_options.enableViewDistanceChecks}set enableVisibilityChecks(e){this.m_options.enableVisibilityChecks=e}get enableVisibilityChecks(){return!0===this.m_options.enableVisibilityChecks}get styleCache(){return this.m_textStyleCache}get delayLabelsUntilMovementFinished(){return!0===this.m_options.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.m_options.delayLabelsUntilMovementFinished=e}get showReplacementGlyphs(){return!0===this.m_options.showReplacementGlyphs}set showReplacementGlyphs(e){this.m_options.showReplacementGlyphs=e,this.m_textCanvases.forEach((t=>{t.fontCatalog.showReplacementGlyphs=e}))}restoreRenderers(e){this.m_renderer=e,this.m_imageRenderer=new E.ImageRenderer(this.m_renderer,this.m_imageRepo,this.m_textureCache)}async updateFontCatalogs(e,i){e=null!=e?e:[];const n=this.m_options.fontCatalog;if(n&&-1===e.findIndex((e=>e.name===t.DEFAULT_FONT_CATALOG_NAME))&&e.push({name:t.DEFAULT_FONT_CATALOG_NAME,url:n}),e.length>0){for(const[t]of this.m_textCanvases)e.findIndex((e=>e.name===t))<0&&(this.m_fontCatalogUrls.delete(t),this.m_textCanvases.delete(t));await Promise.all(e.map((e=>this.addTextCanvas(e,i))))}else this.m_textCanvases.clear(),this.m_fontCatalogUrls.clear();this.m_textStyleCache.updateTextCanvases(this.m_textCanvases)}async setTheme(e,t){return this.invalidateCache(),this.m_textStyleCache.updateTextStyles(e.textStyles,e.defaultTextStyle),await this.updateFontCatalogs(e.fontCatalogs,t)}renderText(e){let t;this.m_camera.far=e,this.updateGlyphDebugMesh(),this.m_imageRenderer.update();for(const e of this.m_imageRenderer.layers){for(const[,i]of this.m_textCanvases)i.render(this.m_camera,null==t?void 0:t.id,e.id,void 0,!1);this.m_imageRenderer.render(this.m_camera,e),t=e}for(const[,e]of this.m_textCanvases)e.render(this.m_camera,null==t?void 0:t.id,void 0,void 0,!1)}invalidateCache(){this.m_cacheInvalidated=!0}movementStarted(){this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!1)}movementFinished(){this.invalidateCache(),this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!0)}placeText(e,t){const i=e.filter((({dataSource:e})=>e.canProvideIconText())),{tileIconTextsChanged:n,hasIconTexts:r,hasBlockingElements:s}=function(e){let t=!1,i=!1,n=!1;return e.forEach((({renderedTiles:e})=>{e.forEach((e=>{i||(i=e.hasIconTexts()),n||(n=e.blockingElements.length>0),t||(t=e.iconTextsChanged),e.iconTextsChanged=!1}))})),{tileIconTextsChanged:t,hasIconTexts:i,hasBlockingElements:n}}(i),o=this.hasOverlayText()||r;if(this.m_isUpdatePending=!1,this.reset(),!o&&!this.m_cacheInvalidated&&!this.m_viewState.renderedTilesChanged)return void this.clearRenderStates();const a=(this.m_cacheInvalidated||n||this.m_viewState.renderedTilesChanged)&&this.m_addNewLabels;a&&(this.m_iconTextStateCache.clearVisited(),this.updateIconTexts(i)),this.m_iconTextStateCache.update(t,this.m_options.disableFading,a,this.m_viewState.zoomLevel),this.m_addNewLabels&&s&&this.prepopulateScreenWithBlockingElements(e),this.placeIconTexts(t,a),this.placeOverlayIconTexts()}addOverlayText(e){0!==e.length&&(this.m_overlayIconTexts=void 0===this.m_overlayIconTexts?e.slice():this.m_overlayIconTexts.concat(e))}clearOverlayText(){this.m_overlayIconTexts=[]}hasOverlayText(){return void 0!==this.m_overlayIconTexts&&this.m_overlayIconTexts.length>0}get overlayText(){return this.m_overlayIconTexts}pickIconTexts(e,t){const i=new Map;for(const[,t]of this.m_textCanvases)t.pickText(e,(e=>{i.set(e,!0)}));this.m_imageRenderer.pickIconTexts(e,(e=>{i.set(e,!1)})),i.forEach(((e,i)=>{t(i,e)}))}get loading(){return this.m_loadPromisesCount>0}get isUpdatePending(){return this.m_isUpdatePending}async waitLoaded(){if(void 0!==this.m_loadPromise)return await this.m_loadPromise}clearRenderStates(){this.m_iconTextStateCache.clear()}getMemoryUsage(){const e={heapSize:0,gpuSize:0};for(const[,t]of this.m_textCanvases)t.getMemoryUsage(e);return this.m_imageRenderer.getMemoryUsage(e),e}reset(){this.m_cameraLookAt.copy(this.m_viewState.lookAtVector),this.m_screenCollisions.reset();for(const[,e]of this.m_textCanvases)e.clear();this.m_imageRenderer.reset()}prepopulateScreenWithBlockingElements(e){const t=[];e.forEach((e=>{const i=new m.Vector3,n=new m.Vector3;for(const r of e.renderedTiles.values())for(const e of r.blockingElements)if(!(e.points.length<2)){this.m_screenProjector.project3(e.points[0],i);for(let r=1;r<e.points.length;r++){this.m_screenProjector.project3(e.points[r],n);const s=e.screenSpaceLines[r-1];s.start.copy(i),s.end.copy(n);const o={minX:Math.min(i.x,n.x),maxX:Math.max(i.x,n.x),minY:Math.min(i.y,n.y),maxY:Math.max(i.y,n.y),line:s};t.push(o),i.copy(n)}}})),this.m_screenCollisions.allocateIBoxes(t)}placeIconTextGroup(e,t,i){var n;(0,v.assert)(e.visited);const r=[],s=this.m_viewState.projection,o=this.m_viewState.elevationProvider,a=null==o?void 0:o.getDisplacementMap(e.tileKey);for(const l of e.iconTextStates){if(!l.initialized)continue;if(this.m_options.enableViewDistanceChecks&&(void 0===l.viewDistance||l.viewDistance<0))continue;const e=l.visible;if(this.m_options.enableVisibilityChecks&&(i===L.PersistentLabels&&!e||i===L.NewLabels&&e))continue;const c=l.iconText,h=this.m_textStyleCache.getTextStyle(c.style),u=h.textCanvas;if(void 0!==o&&!c.elevated){if(!a){this.m_isUpdatePending=!0,this.m_forceNewLabelsPass=!0;continue}(0,y.overlayIconText)(c,o,a,s)}const d=c.type;if(d===w.IconTextType.PathLabel&&(0,C.isPathLabelTooSmall)(c,this.m_screenProjector,U,this.m_viewState.env)){c.dbgPathTooSmall,l.reset();continue}const m=!0;if(u){if(!this.initializeGlyphs(c,h,m))continue;const e=u.getLayer(null!==(n=c.renderOrder)&&void 0!==n?n:g.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==e&&e.storage.drawCount+c.glyphs.length>e.storage.capacity){D.warn("layer glyph storage capacity exceeded.");continue}u.textRenderStyle=c.renderStyle,u.textLayoutStyle=c.layoutStyle}switch(d){case w.IconTextType.PointIconText:this.addPointIconText(l,u,t);break;case w.IconTextType.LineMarker:this.addLineMarkerLabel(l,r,u,t);break;case w.IconTextType.PathLabel:u&&this.addPathLabel(l,U,u,t)}}return!0}addLoadPromise(e){0===this.m_loadPromisesCount&&(this.m_loadPromise=void 0),++this.m_loadPromisesCount,this.m_loadPromise=this.m_loadPromise?Promise.all([this.m_loadPromise,e]):e}initializeGlyphs(e,t,i){if(e.loadingState===S.LoadingState.Initialized)return void 0!==e.glyphs;(0,v.assert)(void 0!==t.textCanvas);const n=t.textCanvas;if(void 0===e.loadingState)if(e.loadingState=S.LoadingState.Requested,void 0===e.renderStyle&&(e.renderStyle=new g.TextRenderStyle(Object.assign(Object.assign({},t.renderParams),e.renderParams))),void 0===e.layoutStyle&&(e.layoutStyle=new g.TextLayoutStyle(Object.assign(Object.assign({},t.layoutParams),e.layoutParams))),""===e.text)e.loadingState=S.LoadingState.Loaded;else{const t=n.fontCatalog.loadCharset(e.text,e.renderStyle).then((()=>{e.loadingState=S.LoadingState.Loaded,this.m_isUpdatePending=!0,this.m_forceNewLabelsPass=this.m_forceNewLabelsPass||i})).catch((t=>{D.info(`Error loading charset for '${e.text}' with font ${n.fontCatalog.name}`,t)})).finally((()=>{--this.m_loadPromisesCount}));this.addLoadPromise(t)}return e.loadingState===S.LoadingState.Loaded&&(n.textRenderStyle=e.renderStyle,n.textLayoutStyle=e.layoutStyle,e.glyphCaseArray=[],e.textBounds=void 0,e.glyphs=n.fontCatalog.getGlyphs(e.text,n.textRenderStyle,e.glyphCaseArray),e.loadingState=S.LoadingState.Initialized),void 0!==e.glyphs}initializeCamera(){this.m_camera.position.z=1,this.m_camera.near=0}updateCamera(){const{width:e,height:t}=this.m_renderer.getSize(G.vector2[0]);this.m_camera.left=e/-2,this.m_camera.right=e/2,this.m_camera.bottom=t/-2,this.m_camera.top=t/2,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.m_screenCollisions.update(e,t)}async addTextCanvas(e,t){if(this.m_fontCatalogUrls.get(e.name)===e.url)return await Promise.resolve();this.m_fontCatalogUrls.set(e.name,e.url);const i=g.FontCatalog.load(e.url,2048,t).then((t=>{const i=e.name;if(this.m_fontCatalogUrls.get(i)===e.url){t.showReplacementGlyphs=this.showReplacementGlyphs;const e=this.m_textCanvasFactory.createTextCanvas(t,i);this.m_textCanvases.set(i,e)}})).catch((i=>{if(this.m_fontCatalogUrls.delete(e.name),null==t?void 0:t.aborted)throw i;D.info("rendering without font catalog, only icons possible",i)})).finally((()=>{--this.m_loadPromisesCount}));return this.addLoadPromise(i),i}updateGlyphDebugMesh(){const e=_.debugContext.getValue("DEBUG_GLYPHS");void 0!==e&&(e&&void 0===this.m_debugGlyphTextureCacheMesh&&this.initializeGlyphDebugMesh(),(0,v.assert)(void 0!==this.m_debugGlyphTextureCacheMesh),(0,v.assert)(void 0!==this.m_debugGlyphTextureCacheWireMesh),this.m_debugGlyphTextureCacheMesh.visible=e,this.m_debugGlyphTextureCacheWireMesh.visible=e)}initializeGlyphDebugMesh(){if(0===this.m_textCanvases.size)return;const e=this.m_textCanvases.values().next().value,t=e.fontCatalog,i=new o.PlaneGeometry(t.textureSize.width/2.5,t.textureSize.height/2.5,t.textureSize.width/t.maxWidth,t.textureSize.height/t.maxHeight),n=new c.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:t.texture});this.m_debugGlyphTextureCacheMesh=new f.Mesh(i,n),this.m_debugGlyphTextureCacheMesh.renderOrder=1e4,this.m_debugGlyphTextureCacheMesh.visible=!1,this.m_debugGlyphTextureCacheMesh.name="glyphDebug";const r=new a.WireframeGeometry(i),s=new l.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheWireMesh=new p.LineSegments(r,s),this.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,this.m_debugGlyphTextureCacheWireMesh.visible=!1,this.m_debugGlyphTextureCacheWireMesh.name="glyphDebug",e.getLayer(g.DEFAULT_TEXT_CANVAS_LAYER).storage.scene.add(this.m_debugGlyphTextureCacheMesh,this.m_debugGlyphTextureCacheWireMesh)}updateIconTexts(e){this.m_iconTextStateCache.clearTextCache(),this.m_cacheInvalidated=!1,e.forEach((e=>{this.updateIconTextsFromSource(e.visibleTiles)}))}updateIconTextsFromSource(e){const t=this.gatherGroups(e);if(0===t.length)return;const i=(0,C.getMaxViewDistance)(this.m_viewState,this.m_maxFarDistanceRatio);for(const{tile:e,group:n}of t)this.prepareIconTextGroup(n,e.tileKey,i)}prepareIconTextGroup(e,t,i){if(0===e.elements.length)return;const[,n]=this.m_iconTextStateCache.getOrSet(e,t,(e=>{let{result:t,viewDistance:n}=(0,C.checkReadyForPlacement)(e.iconText,e.iconText.type===w.IconTextType.LineMarker?e.lineMarkerIndex:void 0,this.m_viewState,i);return t!==C.PrePlacementResult.TooFar&&t!==C.PrePlacementResult.Invisible||(n=void 0),this.m_options.enableDuplicateDetection&&t===C.PrePlacementResult.Ok&&!this.m_iconTextStateCache.deduplicateIconText(this.m_viewState.zoomLevel,e)&&(t=C.PrePlacementResult.Duplicate,n=void 0),n}))}gatherGroups(e){const t=[];return e.forEach((e=>{e.iconTextGroups.forEachGroup((i=>{t.push({tile:e,group:i})}))})),t.sort(((e,t)=>b.IconTextGroup.comparePlacementPriority(e.group,t.group))),t}placeIconTexts(e,t){const i={numRenderedIconTexts:0,fadeAnimationRunning:!1,time:e};if(0===this.m_iconTextStateCache.size)return void D.debug("IconText cache empty.");const n=this.m_forceNewLabelsPass||t;this.m_forceNewLabelsPass=!1;const r=this.m_iconTextStateCache.sortedGroupStates;let s=r[0].group,o=0;for(let e=0;e<r.length;++e){const t=r[e],a=t.group;if(n&&0!==b.IconTextGroup.comparePlacementPriority(s,a)&&(this.placeNewIconTexts(o,e,i),s=a,o=e),!this.placeIconTextGroup(t,i,L.PersistentLabels))break}n&&this.placeNewIconTexts(o,r.length,i),i.fadeAnimationRunning&&(this.m_isUpdatePending=!0)}placeNewIconTexts(e,t,i){const n=this.m_iconTextStateCache.sortedGroupStates;for(let r=e;r<t&&this.placeIconTextGroup(n[r],i,L.NewLabels);++r);}placeOverlayIconTexts(){var e;if(void 0===this.m_overlayIconTexts||0===this.m_overlayIconTexts.length)return;const t=this.m_tmpVector.set(this.m_screenProjector.width,this.m_screenProjector.height),i=-t.width/2,n=t.height/2;for(const r of this.m_overlayIconTexts){const o=this.m_textStyleCache.getTextStyle(r.style),a=o.textCanvas;if(void 0===a)continue;const l=!1;if(this.initializeGlyphs(r,o,l),r.loadingState!==S.LoadingState.Initialized)continue;const c=a.getLayer(null!==(e=r.renderOrder)&&void 0!==e?e:g.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==c&&c.storage.drawCount+r.glyphs.length>c.storage.capacity)continue;let h;if(a.textRenderStyle=r.renderStyle,a.textLayoutStyle=r.layoutStyle,r.type!==w.IconTextType.PathLabel)F.x=i+r.position.x*t.width,F.y=n-r.position.y*t.height,void 0!==r.xOffset&&(F.x+=r.xOffset),void 0!==r.yOffset&&(F.y-=r.yOffset),I.x=F.x,I.y=F.y,I.z=0,j(r,a,I);else{F.x=i,F.y=n,void 0!==r.xOffset&&(F.x+=r.xOffset),void 0!==r.yOffset&&(F.y-=r.yOffset);const e=[];for(const i of r.path){const n=F.x+i.x*t.width,r=F.y-i.y*t.height;e.push(new d.Vector2(n,r))}h=new A.SimplePath;for(let t=0;t<e.length-1;++t)h.add(new s.LineCurve(e[t],e[t+1]));j(r,a,I,h,!0)}}}getDistanceScalingFactor(e,t,i){let n=i/t;return n=1+(n-1)*e.distanceScale,n=Math.max(n,this.m_options.labelDistanceScaleMin),n=Math.min(n,this.m_options.labelDistanceScaleMax),n}getDistanceFadingFactor(e,t,i){let n=1;const r=t.viewDistance;if(void 0!==r&&void 0!==e.fadeFar&&e.fadeFar>0){const t=void 0===e.fadeNear?0:e.fadeNear,s=e.fadeFar;s>t&&(n=1-(0,u.clamp)((r/i-t)/(s-t),0,1))}return n}getIconScreenPositions(e,t,i){var n,r,s;const o=[];if(!e.iconInfoList)return o;if(e.iconCompositionType===S.IconCompositionType.NEXT_TO_EACH_OTHER){let a=0;for(let t=0;t<e.iconInfoList.length;t++)a+=null!==(n=e.iconInfoList[t].computedWidth)&&void 0!==n?n:0;a*=i;const l=new d.Vector2(t.x-a/2,t.y);for(let t=0;t<e.iconInfoList.length;t++){const n=e.iconInfoList[t-1],a=e.iconInfoList[t];let c=0;n&&(c=(null!==(r=n.computedWidth)&&void 0!==r?r:0)*i/2);const h=(null!==(s=a.computedWidth)&&void 0!==s?s:0)*i/2;l.x+=c+h,o.push(l.clone())}}else for(let i=0;i<e.iconInfoList.length;i++)o.push(t);return o}addIconText(e,t,i,n,r){var s,o;const a=e.iconText,l=e.textRenderState,c=a.type===w.IconTextType.LineMarker,h=!0===a.textIsOptional,u=!0===a.iconIsOptional;I.x=i.x,I.y=i.y,I.z=0;const d=(0,C.pointToPlaneDistance)(t,this.m_viewState.worldCenter,this.m_cameraLookAt);if(void 0!==a.fadeFar&&(a.fadeFar<=0||a.fadeFar*this.m_viewState.maxVisibilityDist<d))return!1;e.setViewDistance(d);const m=this.getDistanceScalingFactor(a,d,this.m_viewState.lookAtDistance),p=this.getDistanceFadingFactor(a,e,this.m_viewState.maxVisibilityDist);let f=void 0!==a.iconInfoList&&v.MathUtils.isWithinBounds(this.m_viewState.zoomLevel,a.iconMinZoomLevel,a.iconMaxZoomLevel)&&a.iconInfoList.every((e=>!1!==e.isValid));f&&(this.m_imageRenderer.prepareIcons(a,this.m_viewState.env)?(null===(s=a.iconInfoList)||void 0===s?void 0:s.some((e=>0===e.computedWidth||0===e.computedHeight)))&&(f=!1):(f=!1,this.m_forceNewLabelsPass=!0,this.m_isUpdatePending=!0));const g=this.getIconScreenPositions(a,i,m);let _;if(f){const e=a.iconInfoList;if(a.iconCompositionType===S.IconCompositionType.NEXT_TO_EACH_OTHER)for(let t=0;t<g.length&&(_=(0,C.placeIcon)(e[t],g[t],m,this.m_viewState.env,this.m_screenCollisions),_!==C.PlacementResult.Rejected);t++);else _=(0,C.placeIcon)(e[0],g[0],m,this.m_viewState.env,this.m_screenCollisions)}const y=!u&&_===C.PlacementResult.Rejected,x=!e.visible,b=0===(null===(o=a.renderParams.fontSize)||void 0===o?void 0:o.size),T=!(!n||!l||b),M=T&&function(e,t,i){const n=e.textRenderState,r=e.iconText;if((0,v.assert)(r.type!==w.IconTextType.PathLabel),void 0===n||""===r.text)return!1;if(!v.MathUtils.isWithinBounds(t.zoomLevel,r.textMinZoomLevel,r.textMaxZoomLevel))return!1;const s=(0,C.getMaxViewDistance)(t,i.maxDistanceRatioForIconText);return!!(!0===r.ignoreDistance||void 0===e.viewDistance||e.viewDistance<s&&e.viewDistance>0)}(e,this.m_viewState,this.m_options)&&!(x&&y);let E;M&&(E=(0,C.placeText)(e,i,m,n,this.m_viewState.env,this.m_screenCollisions,I,!c));let A=!1;if(T&&y||E===C.PlacementResult.Rejected?(l.startFadeOut(r.time),A=l.isVisible()):E===C.PlacementResult.Ok?(A=!0,l.startFadeIn(r.time,this.m_options.disableFading)):l.reset(),A){r.fadeAnimationRunning=r.fadeAnimationRunning||l.isFading(),function(e,t,i,n,r){const s=e.iconText,o=e.textRenderState.opacity*n*s.renderStyle.opacity;if(0===o)return!1;V.letterCaseArray=s.glyphCaseArray,void 0===s.textBufferObject&&(s.textBufferObject=t.createTextBufferObject(s.glyphs,V));const a=s.renderStyle.backgroundOpacity>0&&t.textRenderStyle.fontSize.backgroundSize>0;B.layer=s.renderOrder,B.position=i,B.scale=r,B.opacity=o,void 0!==s.textBrightness?(k.setScalar(s.textBrightness),z.setScalar(s.textBrightness),B.color=k.multiply(s.renderStyle.color),B.backgroundColor=z.multiply(s.renderStyle.backgroundColor)):(B.color=void 0,B.backgroundColor=void 0),B.backgroundOpacity=a?B.opacity*s.renderStyle.backgroundOpacity:0,B.pickingData=s.userData?s:void 0,t.addTextBufferObject(s.textBufferObject,B)}(e,n,I,p,m);const t=a.textBackgroundInfo;t&&this.m_imageRenderer.prepareTextBackground(a)&&a.textBounds&&(O.x=I.x,O.y=I.y,this.m_imageRenderer.addTextBackground(t,O,a.textBounds,e.renderDistance,m))}let P=!1;const R=e.iconRenderState;if(void 0!==R&&(_===C.PlacementResult.Rejected||!h&&E===C.PlacementResult.Rejected?(R.startFadeOut(r.time),P=R.isVisible()):_===C.PlacementResult.Ok?(P=!0,R.startFadeIn(r.time,this.m_options.disableFading)):R.reset(),P&&(r.fadeAnimationRunning=r.fadeAnimationRunning||R.isFading(),a.iconInfoList)))for(let t=0;t<a.iconInfoList.length;t++){const i=a.iconInfoList[t];this.m_imageRenderer.addIcon(i,g[t],this.m_screenCollisions,e.renderDistance,m,!1!==i.reserveSpace&&_===C.PlacementResult.Ok,R.opacity*p,this.m_viewState.env)}return!(!P&&!A||(r.numRenderedIconTexts++,0))}addPointIconText(e,t,i){const n=(0,C.getWorldPosition)(e.iconText,this.m_viewState.projection,this.m_viewState.env,this.m_tmpVector3);return!!this.labelPotentiallyVisible(n,F)&&this.addIconText(e,n,F,t,i)}addLineMarkerLabel(e,t,i,n){var r;const s=e.iconText;if(!(null===(r=this.m_imageRenderer)||void 0===r?void 0:r.prepareIcons(s,this.m_viewState.env)))return;let o;void 0!==s.shieldGroupIndex&&(o=t[s.shieldGroupIndex],void 0===o&&(o=[],t[s.shieldGroupIndex]=o));const a=s.technique,l=void 0!==a.minDistance?a.minDistance*a.minDistance:0;if(this.m_options.enableCloseProximityDetection&&l>0&&void 0!==o){let t=0;const r=e.position;if(this.labelPotentiallyVisible(r,F)){let s=!1;for(let e=0;e<o.length&&(s=v.Math2D.distSquared(o[e],o[e+1],F.x,F.y)<l,!s);e+=2);s||this.addIconText(e,r,F,i,n)&&(o.push(F.x,F.y),t++)}0===t&&e.reset()}else{const t=e.position;this.labelPotentiallyVisible(t,F)&&this.addIconText(e,t,F,i,n)}}addPathLabel(e,t,i,n){const s=(0,C.getMaxViewDistance)(this.m_viewState,this.m_options.maxDistanceRatioForText),o=e.iconText;if(!(!0===o.ignoreDistance||void 0===e.viewDistance||e.viewDistance<s))return e.textRenderState.reset(),!1;if(void 0!==o.fadeFar&&(o.fadeFar<=0||o.fadeFar*this.m_viewState.maxVisibilityDist<e.renderDistance))return e.textRenderState.reset(),!1;let a=new r.Path;F.copy(t[0]);for(let e=0;e<t.length-1;++e)a.add(new A.SimpleLineCurve(t[e],t[e+1]));if(a.getPoint(.5).x-a.getPoint(.51).x>0){F.copy(t[t.length-1]),a=new r.Path;for(let e=t.length-1;e>0;--e)a.add(new A.SimpleLineCurve(t[e],t[e-1]))}e.setViewDistance((0,C.computeViewDistance)(o,void 0,this.m_viewState.worldCenter,this.m_cameraLookAt));const l=-e.renderDistance,c=this.getDistanceScalingFactor(o,l,this.m_viewState.lookAtDistance),h=i.textRenderStyle.fontSize.size;if(i.textRenderStyle.fontSize.size*=c,(0,C.placePathLabel)(e,a,F,i,this.m_screenCollisions)!==C.PlacementResult.Ok)return i.textRenderStyle.fontSize.size=h,e.textRenderState.reset(),!1;e.textRenderState.startFadeIn(n.time,this.m_options.disableFading);let u=o.renderStyle.opacity;if(e.textRenderState.isFading()&&(u*=e.textRenderState.opacity,n.fadeAnimationRunning=!0),0===e.textRenderState.opacity)return i.textRenderStyle.fontSize.size=h,!1;const d=i.textRenderStyle.opacity,m=i.textRenderStyle.backgroundOpacity,p=this.getDistanceFadingFactor(o,e,this.m_viewState.maxVisibilityDist);return i.textRenderStyle.opacity=u*p,i.textRenderStyle.backgroundOpacity=i.textRenderStyle.opacity*o.renderStyle.backgroundOpacity,I.z=e.renderDistance,j(o,i,I,a),n.numRenderedIconTexts++,i.textRenderStyle.fontSize.size=h,i.textRenderStyle.opacity=d,i.textRenderStyle.backgroundOpacity=m,!0}labelPotentiallyVisible(e,t){var i;const n=(0,u.clamp)(null!==(i=this.m_options.maxIconTextDistanceToBorder)&&void 0!==i?i:0,0,1);return void 0!==this.m_screenProjector.projectAreaToScreen(e,n,n,t)}}},8950:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeDefaultOptions=void 0,t.initializeDefaultOptions=function(e){void 0===e.minNumGlyphs&&(e.minNumGlyphs=1024),void 0===e.maxNumGlyphs&&(e.maxNumGlyphs=32768),void 0===e.labelDistanceScaleMin&&(e.labelDistanceScaleMin=.7),void 0===e.labelDistanceScaleMax&&(e.labelDistanceScaleMax=1.5),void 0===e.maxDistanceRatioForText&&(e.maxDistanceRatioForText=.99),void 0===e.maxDistanceRatioForIconText&&(e.maxDistanceRatioForIconText=.99),void 0===e.disableFading&&(e.disableFading=!1),void 0===e.delayLabelsUntilMovementFinished&&(e.delayLabelsUntilMovementFinished=!0),void 0===e.showReplacementGlyphs&&(e.showReplacementGlyphs=!1),void 0===e.maxIconTextDistanceToBorder&&(e.maxIconTextDistanceToBorder=.2),void 0===e.enableDuplicateDetection&&(e.enableDuplicateDetection=!0),void 0===e.enableCloseProximityDetection&&(e.enableCloseProximityDetection=!0),void 0===e.enableViewDistanceChecks&&(e.enableViewDistanceChecks=!0),void 0===e.enableVisibilityChecks&&(e.enableVisibilityChecks=!0)}},3981:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLineMarkerState=t.IconTextState=void 0;const n=i(5823),r=i(4342),s=i(2002),o=i(3569),a=i(6445);t.IconTextState=class{constructor(e,t){this.iconText=e,this.m_lineMarkerIndex=t}get initialized(){return void 0!==this.m_textRenderState||void 0!==this.m_iconRenderState}get visible(){if(void 0!==this.m_textRenderState&&this.m_textRenderState.isVisible())return!0;const e=this.iconRenderState;return!(void 0===e||!e.isVisible())}get textPlacement(){const e=this.iconText.layoutStyle,t=this.m_textLayoutState;return void 0!==t?t.textPlacement:{h:(0,n.hPlacementFromAlignment)(e.horizontalAlignment),v:(0,n.vPlacementFromAlignment)(e.verticalAlignment)}}set textPlacement(e){void 0===this.m_textLayoutState&&!0===this.isBaseTextPlacement(e)||(void 0===this.m_textLayoutState?this.m_textLayoutState=new a.LayoutState(e):this.m_textLayoutState.textPlacement=e)}isBaseTextPlacement(e){const t=this.iconText.layoutStyle;if(void 0!==t)return(0,n.hAlignFromPlacement)(e.h)===t.horizontalAlignment&&(0,n.vAlignFromPlacement)(e.v)===t.verticalAlignment}reset(){void 0!==this.m_textRenderState&&this.m_textRenderState.reset(),void 0!==this.m_textLayoutState&&(void 0!==this.iconText.layoutStyle?this.m_textLayoutState.reset(this.iconText.layoutStyle):this.m_textLayoutState=void 0),this.iconRenderState&&this.m_iconRenderState.reset(),this.m_viewDistance=void 0,this.iconText.textBufferObject=void 0,this.iconText.textBounds=void 0}replace(e){this.m_textRenderState=e.m_textRenderState,this.m_textLayoutState=e.m_textLayoutState,this.m_iconRenderState=e.m_iconRenderState,e.m_textRenderState=void 0,e.m_textLayoutState=void 0,e.m_iconRenderState=void 0,void 0===this.iconText.glyphs&&(this.iconText.glyphs=e.iconText.glyphs,this.iconText.glyphCaseArray=e.iconText.glyphCaseArray),this.iconText.textBounds=void 0,this.iconText.textBufferObject=void 0}get viewDistance(){return this.m_viewDistance}update(e){this.initialized||void 0===e||this.initializeRenderStates(),this.setViewDistance(e)}setViewDistance(e){this.m_viewDistance=e}get renderDistance(){return!0===this.iconText.alwaysOnTop?0:void 0!==this.m_viewDistance?-this.m_viewDistance:0}get textRenderState(){return this.m_textRenderState}get iconRenderState(){return this.m_iconRenderState}get lineMarkerIndex(){return this.m_lineMarkerIndex}get position(){return void 0!==this.iconText.path&&void 0!==this.m_lineMarkerIndex?this.iconText.path[this.m_lineMarkerIndex]:this.iconText.position}updateFading(e,t){void 0!==this.m_textRenderState&&this.m_textRenderState.updateFading(e,t),void 0!==this.iconRenderState&&this.iconRenderState.updateFading(e,t)}initializeRenderStates(){var e;(0,r.assert)(void 0===this.m_textRenderState),(0,r.assert)(void 0===this.m_textLayoutState),(0,r.assert)(void 0===this.m_iconRenderState);const{textFadeTime:t}=this.iconText;if(this.m_textRenderState=new o.RenderState(t),this.iconText.type===s.IconTextType.PointIconText||this.iconText.type===s.IconTextType.LineMarker){const i=null===(e=this.iconText.technique)||void 0===e?void 0:e.iconFadeTime;this.m_iconRenderState=new o.RenderState(void 0!==i?1e3*i:t)}}},t.isLineMarkerState=function(e){return void 0!==e.m_lineMarkerIndex}},791:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextStateCache=void 0;const n=i(4342),r=i(9473),s=i(950),o=i(3981),a=function(){const e=Array.from(Array(23).keys()),t=[];for(let i of e){const e=Math.min(4,13-Math.min(13,Math.floor(i)));t.push(100<<(e<<2))}return t}(),l={entries:[],index:-1};function c(e){return e.hasFeatureId()?e.featureId:e.text}t.IconTextStateCache=class{constructor(){this.m_referenceMap=new Map,this.m_textMap=new Map}getOrSet(e,t,i){let n=this.get(e);return void 0!==n?(n.updateIconTexts(i),[n,!0]):(n=new s.IconTextGroupState(e,t,i),this.set(e,n),[n,!1])}get size(){return this.m_referenceMap.size}get cacheSize(){return this.m_textMap.size}get sortedGroupStates(){return void 0===this.m_sortedGroupStates&&(this.m_sortedGroupStates=Array.from(this.m_referenceMap.values()),this.m_sortedGroupStates.sort(((e,t)=>r.IconTextGroup.comparePlacementPriority(e.group,t.group)))),(0,n.assert)(this.m_referenceMap.size===this.m_sortedGroupStates.length),this.m_sortedGroupStates}update(e,t,i,n){const r=i?this.replaceIconText.bind(this,n):void 0;for(const[n,s]of this.m_referenceMap.entries())s.visited?s.updateFading(e,t):(i&&s.traverseVisibleIconTexts(r),this.m_referenceMap.delete(n),this.m_sortedGroupStates=void 0)}clearVisited(){for(const e of this.m_referenceMap.values())e.visited=!1}clear(){this.m_referenceMap.clear(),this.m_sortedGroupStates=void 0,this.m_textMap.clear()}deduplicateIconText(e,t){const i=this.findDuplicate(t,e);if(void 0===i)return this.m_textMap.set(c(t.iconText),[t]),!0;if(-1===i.index)return i.entries.push(t),!0;const n=i.entries[i.index];return!(n.visible||!t.visible||(i.entries[i.index]=t,n.reset(),0))}clearTextCache(){this.m_textMap.clear()}replaceIconText(e,t){(0,n.assert)(t.visible);const i=this.findDuplicate(t,e);return void 0!==i&&-1!==i.index&&(i.entries[i.index].replace(t),!0)}get(e){const t=this.m_referenceMap.get(e);return void 0!==t&&(t.visited=!0),t}set(e,t){(0,n.assert)(e.elements.length>0),this.m_referenceMap.set(e,t),this.m_sortedGroupStates=void 0}findDuplicate(e,t){const i=e.iconText,n=this.m_textMap.get(c(i));if(void 0===n)return;l.entries=n;const r=function(e,t,i){const n=function(e){return a[Math.floor(e)]}(i),r=e.iconText,s=t.length,l=e.position,c=e.visible,h=(0,o.isLineMarkerState)(e);let u,d=-1;for(let e=0;e<s;++e){const i=t[e],s=i.iconText,a=r.type!==s.type||h!==(0,o.isLineMarkerState)(i),m=c&&i.visible;a||m||l.distanceToSquared(s.position)>n||void 0===u&&(d=e,u=s)}return d}(e,n,t);return l.index=r,l}}},2002:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.IconTextType=void 0,(i=t.IconTextType||(t.IconTextType={}))[i.PointIconText=0]="PointIconText",i[i.PathLabel=1]="PathLabel",i[i.LineMarker=2]="LineMarker"},8488:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewState=void 0;const n=i(6815);t.MapViewState=class{constructor(e,t){this.m_mapView=e,this.m_renderedTilesChangeCheck=t,this.m_lookAtVector=new n.Vector3}get worldCenter(){return this.m_mapView.worldCenter}get cameraIsMoving(){return this.m_mapView.cameraIsMoving}get maxVisibilityDist(){return this.m_mapView.viewRanges.maximum}get zoomLevel(){return this.m_mapView.zoomLevel}get env(){return this.m_mapView.env}get frameNumber(){return this.m_mapView.frameNumber}get lookAtVector(){return this.m_mapView.camera.getWorldDirection(this.m_lookAtVector)}get lookAtDistance(){return this.m_mapView.targetDistance}get isDynamic(){return this.m_mapView.isDynamicFrame}get renderedTilesChanged(){return this.m_renderedTilesChangeCheck()}get projection(){return this.m_mapView.projection}get elevationProvider(){return this.m_mapView.elevationProvider}}},9913:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorldPosition=t.isPathLabelTooSmall=t.placePathLabel=t.placeText=t.placeIcon=t.PlacementResult=t.checkReadyForPlacement=t.PrePlacementResult=t.getMaxViewDistance=t.pointToPlaneDistance=t.computeViewDistance=void 0;const n=i(433),r=i(3334),s=i(5448),o=i(6815),a=i(8152),l=i(2616),c=i(5823),h=i(1984),u=i(4342),d=i(7362),m=i(2967),p=i(2002),f=i(5154),g=i(5570),v=new o.Vector3(0,0,0),_=new o.Vector3(0,0,0),y=new o.Vector3(0,0,0);function x(e,t,i,n){let r;const s=e.path;if(s&&s.length>1)if(void 0!==t&&s&&s.length>t)r=S(s[t],i,n);else{const e=S(s[0],i,n),t=S(s[s.length-1],i,n);r=Math.min(e,t)}else r=S(e.position,i,n);return r}function S(e,t,i){return y.copy(e).sub(t).dot(i)}var b;t.computeViewDistance=x,t.pointToPlaneDistance=S,t.getMaxViewDistance=function(e,t){return e.maxVisibilityDist*t},function(e){e[e.Ok=0]="Ok",e[e.Invisible=1]="Invisible",e[e.TooFar=2]="TooFar",e[e.Duplicate=3]="Duplicate",e[e.Count=4]="Count"}(b=t.PrePlacementResult||(t.PrePlacementResult={}));const T=new o.Vector3;t.checkReadyForPlacement=function(e,t,i,n){let r;if(!e.visible||i.zoomLevel===e.textMaxZoomLevel)return{result:b.Invisible,viewDistance:r};const s=e.iconInfoList&&u.MathUtils.isWithinBounds(i.zoomLevel,e.iconMinZoomLevel,e.iconMaxZoomLevel);return u.MathUtils.isWithinBounds(i.zoomLevel,e.textMinZoomLevel,e.textMaxZoomLevel)||s?(r=void 0===n?x(e,t,i.worldCenter,i.lookAtVector):function(e,t,i,n,r,s){const o=x(e,t,i,n);return r!==l.ProjectionType.Spherical?o<=s?o:void 0:(v.copy(e.position).normalize(),_.copy(i).normalize(),v.dot(_)>.5877852522924731&&o<=s?o:void 0)}(e,t,i.worldCenter,i.lookAtVector,i.projection.type,n),void 0===r?{result:b.TooFar,viewDistance:r}:{result:b.Ok,viewDistance:r}):{result:b.Invisible,viewDistance:r}};const M=new n.Box2,w=new n.Box2,E=[],C={},A=[],P=new d.CollisionBox,R=new s.Vector2,L=new s.Vector2,D=new u.Math2D.Box,I=new s.Vector2,O=new s.Vector2;var F;function U(e,t,i,n,r,o,l,d,v){const _=e.iconText;(0,u.assert)(void 0!==_.glyphs),(0,u.assert)(void 0!==_.layoutStyle);const y=!_.textBounds||d,x=y?w:_.textBounds;if(y){N(r,i),C.outputCharacterBounds=void 0,C.path=void 0,C.pathOverflow=!1,C.letterCaseArray=_.glyphCaseArray,r.measureText(_.glyphs,x,C);const e=_.technique;if(e&&(0,h.isIconTextTechnique)(e)){const t=(0,a.getPropertyValue)(e["background-padding"],o);t&&(t.x&&(x.min.x-=t.x),t.y&&(x.max.y+=t.y),t.z&&(x.max.x+=t.z),t.w&&(x.min.y-=t.w))}}const S=function(e,t,i,n,r,o=new s.Vector2){switch((0,u.assert)(e.type===p.IconTextType.PointIconText||e.type===p.IconTextType.LineMarker),(0,u.assert)(void 0!==e.layoutStyle),o.x=e.xOffset,o.y=e.yOffset,i.h){case c.HorizontalPlacement.Left:o.x-=t.max.x;break;case c.HorizontalPlacement.Right:o.x-=t.min.x}switch(i.v){case c.VerticalPlacement.Top:o.y-=t.min.y;break;case c.VerticalPlacement.Center:o.y-=.5*(t.max.y+t.min.y);break;case c.VerticalPlacement.Bottom:o.y-=t.max.y}if(e.iconInfoList){let t=0,n=0;if(e.iconCompositionType===m.IconCompositionType.NEXT_TO_EACH_OTHER)for(let i=0;i<e.iconInfoList.length;i++){const r=e.iconInfoList[i];(0,f.imageIsRenderable)(r)&&((0,u.assert)(void 0!==r.computedWidth),(0,u.assert)(void 0!==r.computedHeight),t+=r.computedWidth,n=r.computedHeight)}else{const i=e.iconInfoList[0];(0,f.imageIsRenderable)(i)&&((0,u.assert)(void 0!==i.computedWidth),(0,u.assert)(void 0!==i.computedHeight),t=i.computedWidth,n=i.computedHeight)}o.x+=t*(.5+i.h),o.y+=n*(.5+i.v);const s=(0,c.hPlacementFromAlignment)(e.layoutStyle.horizontalAlignment),l=(0,c.vPlacementFromAlignment)(e.layoutStyle.verticalAlignment);if(s!==i.h||l!==i.v){const t=e.technique;let n=(0,a.getPropertyValue)(t.iconXOffset,r),h=(0,a.getPropertyValue)(t.iconYOffset,r);n="number"==typeof n?n:0,h="number"==typeof h?h:0;const u=s-i.h,d=l-i.v,m=n-e.xOffset,p=h-e.yOffset;s===c.HorizontalPlacement.Center||l===c.VerticalPlacement.Center?(o.x+=2*Math.abs(u)*m,o.y-=2*d*Math.abs(m),o.y+=2*Math.abs(d)*p,o.x-=2*u*Math.abs(p)):(o.x+=2*Math.min(Math.abs(u),.5)*m,o.y-=2*Math.sign(d)*Math.min(Math.abs(d),.5)*Math.abs(m),o.y+=2*Math.min(Math.abs(d),.5)*p,o.x-=2*Math.sign(u)*Math.min(Math.abs(u),.5)*Math.abs(p))}}return o.multiplyScalar(n),o}(_,x,i,n,o,L).add(t);return v.set(S.x,S.y,e.renderDistance),V(_,x,n,S,o,g.Margin.CHECK),l.isVisible(D)?(y&&(M.getSize(O),O.multiplyScalar(n),D.set(I.x-O.x/2,I.y-O.y/2,O.x,O.y)),!_.textMayOverlap&&l.isAllocated(D)?F.Rejected:(_.textReservesSpace&&(V(_,x,n,S,o,g.Margin.ALLOCATE),l.allocate(D)),y?(_.textBufferObject=void 0,_.textBounds=_.textBounds?_.textBounds.copy(x):x.clone()):N(r,i),e.textPlacement=i,F.Ok)):F.Invisible}function V(e,t,i,n,r,s=g.Margin.NONE){var o,l,c;const u=e.technique;let d=0;u&&((0,h.isIconTextTechnique)(u)||(0,h.isTextTechnique)(u))&&(s===g.Margin.CHECK?d=null!==(l=null!==(o=(0,a.getPropertyValue)(u["check-margin"],r))&&void 0!==o?o:(0,a.getPropertyValue)(u.margin,r))&&void 0!==l?l:0:s===g.Margin.ALLOCATE&&(d=null!==(c=(0,a.getPropertyValue)(u.margin,r))&&void 0!==c?c:0)),M.copy(t).translate(n),M.getCenter(I),M.expandByScalar(d),M.getSize(O),O.multiplyScalar(i),D.set(I.x-O.x/2,I.y-O.y/2,O.x,O.y)}function N(e,t){e.textLayoutStyle.horizontalAlignment=(0,c.hAlignFromPlacement)(t.h),e.textLayoutStyle.verticalAlignment=(0,c.vAlignFromPlacement)(t.v)}!function(e){e[e.Ok=0]="Ok",e[e.Rejected=1]="Rejected",e[e.Invisible=2]="Invisible"}(F=t.PlacementResult||(t.PlacementResult={})),t.placeIcon=function(e,t,i,n,r){return g.ImageRenderer.computeIconScreenBox(e,t,i,n,D,g.Margin.CHECK),r.isVisible(D)?!0!==e.mayOverlap&&r.isAllocated(D)?F.Rejected:F.Ok:F.Invisible},t.placeText=function(e,t,i,n,r,s,o,a=!1){(0,u.assert)(void 0!==e.iconText.layoutStyle);const l=e.iconText.layoutStyle;return(a=a&&void 0!==l.placements&&l.placements.length>1)?function(e,t,i,n,r,s,o){(0,u.assert)(void 0!==e.iconText.layoutStyle);const a=e.iconText,l=e.visible,c=e.textPlacement,h=a.layoutStyle.placements,d=h.length,m=h.findIndex((e=>e.h===c.h&&e.v===c.v));(0,u.assert)(m>=0);let p=!0;for(let a=m;a<d+m;++a){const c=a===m&&l,u=U(e,t,h[a%d],i,n,r,s,!c,T);if(u===F.Ok)return o.copy(T),F.Ok;c&&o.copy(T),p=p&&u===F.Invisible}return p?F.Invisible:F.Rejected}(e,t,i,n,r,s,o):function(e,t,i,n,r,s,o){(0,u.assert)(void 0!==e.iconText.layoutStyle);return U(e,t,e.textPlacement,i,n,r,s,!e.visible,o)}(e,t,i,n,r,s,o)},t.placePathLabel=function(e,t,i,n,r){if(C.path=t,C.outputCharacterBounds=E,C.letterCaseArray=e.iconText.glyphCaseArray,C.horizontalOffset=(0,c.getHorizontalOffset)(e.iconText),!n.measureText(e.iconText.glyphs,M,C))return F.Rejected;if(P.copy(M.translate(i)),!r.isVisible(P))return F.Invisible;let s,o=!1;e.iconText.textMayOverlap||(s=r.search(P),o=s.length>0),A.length=E.length;for(let e=0;e<E.length;++e){const t=E[e].translate(i);let n=A[e];if(void 0===n?(n=new d.CollisionBox(t),A[e]=n):n.copy(t),o&&r.intersectsDetails(n,s))return F.Rejected}if(e.iconText.textReservesSpace){const e=new d.DetailedCollisionBox(P,A.slice());A.length=0,r.allocate(e)}return F.Ok},t.isPathLabelTooSmall=function(e,t,i,n){var r;if((0,u.assert)(e.type===p.IconTextType.PathLabel),0===(null===(r=e.renderParams.fontSize)||void 0===r?void 0:r.size))return!0;i.length=0;let s=!1;for(const[r,o]of e.points.entries())k({iconText:e,tmpPosition:v,tmpCameraDir:_,env:n,currentInd:r}),v.copy(o),void 0!==(s?t.project(v.sub(_),R):t.projectToScreen(v.sub(_),R))&&(s=!0,i.push(R.clone()));if(!s)return!0;const o=5*e.text.length;return M.setFromPoints(i),M.max.sub(M.min).lengthSq()<o*o&&(e.dbgPathTooSmall=!0,!0)};const B=new l.OrientedBox3;function k({iconText:e,tmpPosition:t,tmpCameraDir:i,env:n,currentInd:r}){var s;if(!Array.isArray(e.points))return;0===r?(t.copy(e.points[1]),t.sub(e.points[0]).normalize()):(t.copy(e.points[r]),t.sub(e.points[r-1]).normalize());const o=(0,a.getPropertyValue)(null===(s=e.technique)||void 0===s?void 0:s["world-line-offset"],n);i.set(-t.y,t.x,0).multiplyScalar(o)}t.getWorldPosition=function(e,t,i,n){var s;const o=(0,a.getPropertyValue)(null===(s=e.technique)||void 0===s?void 0:s.worldOffset,i);if(null==n||n.copy(e.position),null!=o&&void 0!==e.offsetDirection){t.localTangentSpace(e.position,B);const i=B.yAxis,s=(0,r.degToRad)(e.offsetDirection);i.applyAxisAngle(B.zAxis.negate(),s),n.addScaledVector(B.yAxis,o)}return n}},7234:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlacementStats=void 0,t.PlacementStats=class{constructor(e){this.m_logger=e,this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedIcons=0,this.numRenderedTexts=0,this.numTextsInvisible=0,this.numRenderedIconTexts=0}clear(){this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedIcons=0,this.numRenderedTexts=0,this.numTextsInvisible=0,this.numRenderedIconTexts=0}log(){const e=this.uninitialized+this.numTextsInvisible+this.tooFar+this.numNotVisible+this.numCannotAdd;this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("Resorted groups",this.resortedGroups),this.m_logger.debug("Total labels",this.total),this.m_logger.debug("Rendered labels",this.numRenderedIconTexts),this.m_logger.debug("Rejected labels",e),this.m_logger.debug("Unitialized labels",this.uninitialized),this.m_logger.debug("Rendered icons",this.numRenderedIcons),this.m_logger.debug("Rendered texts",this.numRenderedTexts),this.m_logger.debug("Texts invisible",this.numTextsInvisible),this.m_logger.debug("Too far",this.tooFar),this.m_logger.debug("Not visible",this.numNotVisible),this.m_logger.debug("Path too small",this.numPathTooSmall),this.m_logger.debug("Rejected, max glyphs reached",this.numCannotAdd)}}},3569:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderState=t.DEFAULT_FADE_TIME=t.FadingState=void 0;const n=i(3334),r=i(4342);var s;!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(s=t.FadingState||(t.FadingState={})),t.DEFAULT_FADE_TIME=300,t.RenderState=class{constructor(e=t.DEFAULT_FADE_TIME){this.fadeTime=e,this.value=0,this.startTime=0,this.opacity=0,this.m_state=s.Undefined}reset(){this.m_state=s.Undefined,this.value=0,this.startTime=0,this.opacity=0}isUndefined(){return this.m_state===s.Undefined}isFading(){return this.m_state===s.FadingIn||this.m_state===s.FadingOut}isFadingIn(){return this.m_state===s.FadingIn}isFadingOut(){return this.m_state===s.FadingOut}isFadedIn(){return this.m_state===s.FadedIn}isFadedOut(){return this.m_state===s.FadedOut}isVisible(){return this.m_state!==s.FadedOut&&this.m_state!==s.Undefined&&this.opacity>0}startFadeIn(e,t){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadedIn){if(!0===t)return this.value=1,this.opacity=1,this.m_state=s.FadedIn,void(this.startTime=e);this.m_state===s.FadingOut?(this.value=1-this.value,this.startTime=e-this.value*this.fadeTime):(this.startTime=e,this.value=0,this.opacity=0),this.m_state=s.FadingIn}}startFadeOut(e){this.m_state!==s.FadingOut&&this.m_state!==s.FadedOut&&this.m_state!==s.Undefined&&(this.m_state===s.FadingIn?(this.startTime=e-this.value*this.fadeTime,this.value=1-this.value):(this.startTime=e,this.value=0,this.opacity=1),this.m_state=s.FadingOut)}updateFading(e,t){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadingOut)return;0===this.startTime&&(this.startTime=e);const i=e-this.startTime,o=this.m_state===s.FadingIn?0:1,a=this.m_state===s.FadingIn?1:0;t||i>=this.fadeTime?(this.value=1,this.opacity=a,this.m_state=this.m_state===s.FadingIn?s.FadedIn:s.FadedOut):(this.value=i/this.fadeTime,this.opacity=(0,n.clamp)(r.MathUtils.smootherStep(o,a,this.value),0,1),(0,r.assert)(this.isFading()))}}},859:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStats=void 0;const n=i(9913);t.UpdateStats=class{constructor(e){this.m_logger=e,this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results=new Array(n.PrePlacementResult.Count),this.results.fill(0)}clear(){this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results.fill(0)}log(){this.m_logger.debug("Tiles",this.tiles),this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("New groups",this.newGroups),this.m_logger.debug("Total labels",this.totalLabels),this.m_logger.debug("Placed labels",this.results[n.PrePlacementResult.Ok]),this.m_logger.debug("Invisible",this.results[n.PrePlacementResult.Invisible]),this.m_logger.debug("Too far",this.results[n.PrePlacementResult.TooFar]),this.m_logger.debug("Duplicate",this.results[n.PrePlacementResult.Duplicate])}}},4298:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoxBuffer=t.BoxBufferMesh=void 0;const n=i(6271),r=i(9365),s=i(3148),o=i(5269),a=i(4342),l=i(161);class c extends o.Mesh{constructor(e,t){super(e,t),this.type="BoxBufferMesh"}get isEmpty(){if(void 0===this.geometry)return!0;{const e=this.geometry;return null===e.index||0===e.index.count}}}t.BoxBufferMesh=c;class h{constructor(e,t=0,i=0,n=32768){this.m_material=e,this.m_renderOrder=t,this.m_maxElementCount=n,this.m_size=0,this.resizeBuffer(i),this.m_pickInfos=new Array}clone(){return new h(this.m_material,this.m_renderOrder)}dispose(){void 0!==this.m_geometry&&(this.m_geometry.dispose(),this.m_geometry=void 0),this.m_mesh=void 0}get size(){return this.m_size}reset(){void 0!==this.m_positionAttribute&&(this.m_positionAttribute.count=0,this.m_colorAttribute.count=0,this.m_uvAttribute.count=0,this.m_indexAttribute.count=0,this.m_pickInfos.length=0)}canAddElements(e=1){const t=this.m_indexAttribute;if(t.count+6*e>=t.array.length){if(t.array.length>=6*this.m_maxElementCount)return!1;const e=Math.min(this.m_maxElementCount,0===this.size?256:2*this.size);this.resize(e)}return!0}saveState(){return{positionAttributeCount:this.m_positionAttribute.count,colorAttributeCount:this.m_colorAttribute.count,uvAttributeCount:this.m_uvAttribute.count,indexAttributeCount:this.m_indexAttribute.count,pickInfoCount:this.m_pickInfos.length}}restoreState(e){this.m_positionAttribute.count=e.positionAttributeCount,this.m_colorAttribute.count=e.colorAttributeCount,this.m_uvAttribute.count=e.uvAttributeCount,this.m_indexAttribute.count=e.indexAttributeCount,this.m_pickInfos.length=e.pickInfoCount}addBox(e,t,i,n,r,s){if(!this.canAddElements())return!1;const{s0:o,t0:a,s1:l,t1:c}=t,{x:h,y:u,w:d,h:m}=e,p=i.r*n,f=i.g*n,g=i.b*n,v=n,_=this.m_positionAttribute,y=this.m_colorAttribute,x=this.m_uvAttribute,S=this.m_indexAttribute,b=_.count,T=S.count;return _.setXYZ(b,h,u,r),_.setXYZ(b+1,h+d,u,r),_.setXYZ(b+2,h,u+m,r),_.setXYZ(b+3,h+d,u+m,r),y.setXYZW(b,p,f,g,v),y.setXYZW(b+1,p,f,g,v),y.setXYZW(b+2,p,f,g,v),y.setXYZW(b+3,p,f,g,v),x.setXY(b,o,a),x.setXY(b+1,l,a),x.setXY(b+2,o,c),x.setXY(b+3,l,c),S.setX(T,b),S.setX(T+1,b+1),S.setX(T+2,b+2),S.setX(T+3,b+2),S.setX(T+4,b+1),S.setX(T+5,b+3),_.count+=4,y.count+=4,x.count+=4,S.count+=6,this.m_pickInfos.push(s),!0}updateBufferGeometry(){const e=this.m_positionAttribute,t=this.m_colorAttribute,i=this.m_uvAttribute,n=this.m_indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=4*e.count),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),i.count>0&&(i.needsUpdate=!0,i.updateRange.offset=0,i.updateRange.count=4*i.count),n.count>0&&(n.needsUpdate=!0,n.updateRange.offset=0,n.updateRange.count=n.count),void 0!==this.m_geometry&&(this.m_geometry.clearGroups(),this.m_geometry.addGroup(0,this.m_indexAttribute.count))}cleanUp(){0===this.m_indexAttribute.count&&this.size>0&&this.clearAttributes()}get isEmpty(){return this.m_mesh.isEmpty}get mesh(){return void 0===this.m_mesh&&this.resize(),this.m_mesh}pickBoxes(e,t,i){var n;const r=this.m_pickInfos.length,s=this.m_pickInfos,o=this.m_positionAttribute,l=e.x,c=e.y;for(let e=0;e<r;e++){const r=4*e,h=o.getX(r);if(l<h)continue;const u=o.getX(r+1);if(l>u)continue;const d=o.getY(r);if(c<d)continue;const m=o.getY(r+2);if(c>m)continue;const p=new a.Math2D.Box(h,d,u-h,m-d),f=s[e];if(void 0!==i&&void 0!==f&&void 0!==f.uvBoxForPicking&&this.isPixelTransparent(i,l,c,p,f.uvBoxForPicking))continue;const g=null===(n=s[e])||void 0===n?void 0:n.iconText;g&&t(g)}}resize(e,t){return void 0!==this.m_geometry&&this.m_geometry.dispose(),this.m_geometry=new s.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setIndex(this.m_indexAttribute),this.m_geometry.addGroup(0,this.m_indexAttribute.count),void 0===this.m_mesh?(this.m_mesh=new c(this.m_geometry,this.m_material),this.m_mesh.renderOrder=this.m_renderOrder):this.m_mesh.geometry=this.m_geometry,this.m_mesh}updateMemoryUsage(e){const t=3*this.m_positionAttribute.count*4+4*this.m_colorAttribute.count+4*this.m_uvAttribute.count*4+4*this.m_indexAttribute.count;e.heapSize+=t,e.gpuSize+=t}isPixelTransparent(e,t,i,n,r){const{u:s,v:o}=(0,l.screenToUvCoordinates)(t,i,n,r),{width:a,height:c}=e instanceof SVGImageElement?e.getBBox():e,h=a*s,u=c*o,d=(0,l.getPixelFromImage)(h,u,e);return void 0!==d&&0===d[3]}clearAttributes(){this.m_positionAttribute=void 0,this.m_colorAttribute=void 0,this.m_uvAttribute=void 0,this.m_indexAttribute=void 0,this.resize(0,!0)}resizeBuffer(e){const t=new Float32Array(4*e*3);if(void 0!==this.m_positionAttribute&&this.m_positionAttribute.array.length>0){const e=this.m_positionAttribute.count;t.set(this.m_positionAttribute.array),this.m_positionAttribute.array=t,this.m_positionAttribute.count=e}else this.m_positionAttribute=new r.BufferAttribute(t,3),this.m_positionAttribute.count=0,this.m_positionAttribute.setUsage(n.DynamicDrawUsage);const i=new Uint8Array(4*e*4);if(void 0!==this.m_colorAttribute){const e=this.m_colorAttribute.count;i.set(this.m_colorAttribute.array),this.m_colorAttribute.array=i,this.m_colorAttribute.count=e}else this.m_colorAttribute=new r.BufferAttribute(i,4,!0),this.m_colorAttribute.count=0,this.m_colorAttribute.setUsage(n.DynamicDrawUsage);const s=new Float32Array(4*e*4);if(void 0!==this.m_uvAttribute){const e=this.m_uvAttribute.count;s.set(this.m_uvAttribute.array),this.m_uvAttribute.array=s,this.m_uvAttribute.count=e}else this.m_uvAttribute=new r.BufferAttribute(s,4),this.m_uvAttribute.count=0,this.m_uvAttribute.setUsage(n.DynamicDrawUsage);const o=6*e*1,a=o>65535?new Uint32Array(o):new Uint16Array(o);if(void 0!==this.m_indexAttribute){const e=this.m_indexAttribute.count;a.set(this.m_indexAttribute.array),this.m_indexAttribute.array=a,this.m_indexAttribute.count=e}else this.m_indexAttribute=new r.BufferAttribute(a,1),this.m_indexAttribute.count=0,this.m_indexAttribute.setUsage(n.DynamicDrawUsage);this.m_size=e}}t.BoxBuffer=h},3174:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconInfoBuilder=void 0;const n=i(8152),r=i(4342),s=i(207);t.IconInfoBuilder=class{constructor(e){this.m_env=e}withTechnique(e){return this.m_imageTextureName=void 0!==e.imageTexture?(0,n.getPropertyValue)(e.imageTexture,this.m_env):void 0,this.m_technique=e,this}withIcon(e){return void 0!==e&&(this.m_imageTextureName=e),this}build(e){var t,i,o,a;(0,r.assert)(void 0!==this.m_technique);const l=this.m_technique,c=this.m_env,h=null===(t=this.m_imageTextureName)||void 0===t?void 0:t.split(",").filter(((e,t,i)=>e&&i.indexOf(e)===t));if(void 0===h)return;const u=null!==(i=l.iconMayOverlap)&&void 0!==i?i:l.textMayOverlap,d=null!==(o=l.iconReserveSpace)&&void 0!==o?o:l.textReserveSpace,m=(0,n.getPropertyValue)(l.iconColor,c),p=null!==m?s.ColorCache.instance.getColor(m):void 0,f=[];for(let t=0;t<h.length;t++){const i={technique:l,imageTextureName:h[t],iconText:e,mayOverlap:u,reserveSpace:d,iconBrightness:r.MathUtils.clamp(null!==(a=l.iconBrightness)&&void 0!==a?a:1,0,1),iconColor:p};f.push(i)}return f.length>0?f:void 0}}},5154:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.imageIsRenderable=void 0,t.imageIsRenderable=function(e){return void 0!==e.buffer}},5570:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageRenderer=t.Margin=t.ImageBatchRegistry=t.ImageBuffer=void 0;const n=i(5971),r=i(5448),s=i(5808),o=i(8152),a=i(4250),l=i(4342),c=i(7063),h=i(6802),u=i(4298),d=l.LoggerManager.instance.create("IconRenderer"),m=new n.Color(1,1,1),p=new n.Color;class f{constructor(e,t,i){this.buffer=e,this.layer=t,this.m_onDispose=i,this.m_refCount=0}increaseRefCount(){return++this.m_refCount,this}decreaseRefCount(){return(0,l.assert)(this.m_refCount>0),0==--this.m_refCount&&this.dispose(),this}dispose(){this.layer.scene.remove(this.buffer.mesh),this.buffer.dispose(),this.m_onDispose()}}t.ImageBuffer=f;class g{constructor(e,t,i,n){this.m_rendererCapabilities=e,this.imageItem=t,this.m_onDispose=i,(0,l.assert)(void 0!==this.imageItem.image);const r=(0,c.loadTexture)(this.imageItem.image,n,{magFilter:"linear",minFilter:g.trilinear?"linearMipMapLinear":"linear"});(0,l.assert)(void 0!==r),g.trilinear&&this.imageItem.mipMaps&&(r.mipmaps=this.imageItem.mipMaps,r.image=r.mipmaps[0]),r.flipY=!1,r.premultiplyAlpha=!0,this.m_material=new a.IconMaterial({rendererCapabilities:this.m_rendererCapabilities,map:r}),this.m_imageBuffers=new Map}getBuffer(e){let t=this.m_imageBuffers.get(e.id);if(t)return t.increaseRefCount();const i=new u.BoxBuffer(this.m_material,e.id),n=i.mesh;return n.frustumCulled=!1,e.scene.add(n),t=new f(i,e,(()=>{this.disposeBuffer(e.id)})),this.m_imageBuffers.set(e.id,t),t.increaseRefCount()}reset(){for(const e of this.m_imageBuffers.values())e.buffer.reset()}update(){for(const e of this.m_imageBuffers.values())e.buffer.updateBufferGeometry()}pickBoxes(e,t,i){for(const n of this.m_imageBuffers.values())n.buffer.pickBoxes(e,t,i)}updateMemoryUsage(e){if(void 0!==this.imageItem.image){const t=this.imageItem.image.width*this.imageItem.image.height*4;e.heapSize+=t,e.gpuSize+=t}for(const t of this.m_imageBuffers.values())t.buffer.updateMemoryUsage(e)}dispose(){this.m_imageBuffers.clear(),this.m_material.map.dispose(),this.m_material.dispose(),this.m_onDispose()}disposeBuffer(e){(0,l.assert)(this.m_imageBuffers.size>0),this.m_imageBuffers.delete(e),0===this.m_imageBuffers.size&&this.dispose()}}g.trilinear=!0;class v{constructor(e,t){this.m_rendererCapabilities=e,this.m_textureCache=t,this.m_batchMap=new Map}registerImage(e,t){var i;const{imageItem:n,imageTexture:r}=e;if(!n)return;(0,l.assert)(void 0!==e.imageTextureName);const s=null!==(i=null==r?void 0:r.image)&&void 0!==i?i:e.imageTextureName;let o=this.m_batchMap.get(s);return void 0===o&&(o=new g(this.m_rendererCapabilities,n,(()=>{this.deleteBatch(s)}),this.m_textureCache),this.m_batchMap.set(s,o)),o.getBuffer(t)}addIcon(e,t,i,n){if(!1===e.isValid||!e.buffer)return void d.warn("IconBatchRegistry: trying to add iconInfo without buffer prepared: ",e.imageTextureName);let r;(0,l.assert)(void 0!==e.uvBox),void 0!==e.iconBrightness?(r=p.setScalar(e.iconBrightness),void 0!==e.iconColor&&(r=p.multiply(e.iconColor))):r=void 0!==e.iconColor?e.iconColor:m,e.buffer.buffer.addBox(t,e.uvBox,r,n,i,e)}addTextBackground(e,t,i){if(!1===e.isValid||!e.buffer)return void d.warn("IconBatchRegistry: trying to add background image without buffer prepared: ",e.imageTextureName);(0,l.assert)(void 0!==e.uvBox);const n=m;e.buffer.buffer.addBox(t,e.uvBox,n,1,i,e)}reset(){for(const e of this.m_batchMap.values())e.reset()}update(){for(const e of this.m_batchMap.values())e.update()}pickImageTexts(e,t){for(const i of this.m_batchMap.values())i.pickBoxes(e,t,i.imageItem.image)}updateMemoryUsage(e){for(const t of this.m_batchMap.values())t.updateMemoryUsage(e)}deleteBatch(e){this.m_batchMap.delete(e)}}var _;t.ImageBatchRegistry=v,function(e){e[e.ALLOCATE=0]="ALLOCATE",e[e.CHECK=1]="CHECK",e[e.NONE=2]="NONE"}(_=t.Margin||(t.Margin={}));class y{static computeIconScreenBox(e,t,i,n,r=new l.Math2D.Box,s=_.NONE){var a,c,h;(0,l.assert)(void 0!==e.buffer);const u=e.technique;let d=0;s===_.CHECK?d=null!==(c=null!==(a=(0,o.getPropertyValue)(u["check-margin"],n))&&void 0!==a?a:(0,o.getPropertyValue)(u.margin,n))&&void 0!==c?c:0:s===_.ALLOCATE&&(d=null!==(h=(0,o.getPropertyValue)(u.margin,n))&&void 0!==h?h:0);const m=e.computedWidth*i+2*d,p=e.computedHeight*i+2*d,f=(0,o.getPropertyValue)(u.iconXOffset,n),g=(0,o.getPropertyValue)(u.iconYOffset,n),v=t.x+("number"==typeof f?f:0)*i,y=t.y+("number"==typeof g?g:0)*i;return r.x=v-m/2,r.y=y-p/2,r.w=m,r.h=p,r}constructor(e,t,i){this.m_renderer=e,this.m_imageRepo=t,this.m_textureCache=i,this.m_tempScreenBox=new l.Math2D.Box,this.m_layers=[],this.m_imageBatchRegistry=new v(this.renderer.capabilities,this.m_textureCache)}get renderer(){return this.m_renderer}prepareIcon(e,t){if(void 0!==e.buffer)return!0;const i=e.imageTextureName;if(void 0===i)return e.isValid=!1,!1;const n=this.m_imageRepo.findImage(i);if(n){const{imageItem:i,imageTexture:r}=n;if(i.loaded)return this.setupIconInfo(e,i,t,r),!0}return this.m_imageRepo.loadImage(i).then((t=>{e.isValid=!0})).catch((t=>{e.imageItem=null,e.isValid=!1})),!1}prepareIcons(e,t){let i=!1;const n=e.iconInfoList;return n&&e.visible&&(i=!0,n.forEach((e=>{i=this.prepareIcon(e,t)&&i}))),i}prepareTextBackground(e){var t;const i=e.textBackgroundInfo;if(!1===e.visible)return!1;if(void 0===(null==i?void 0:i.imageTextureName))return!0;if(void 0!==(null===(t=e.textBackgroundInfo)||void 0===t?void 0:t.buffer))return!0;if(e.textBounds){const t=null==i?void 0:i.imageTextureName,n=new r.Vector2;e.textBounds.getSize(n);const s=h.MipMapGenerator.getPaddedSize(n.x,n.y),o=this.m_imageRepo.findImage(t,s);if(o){const{imageItem:e,imageTexture:t}=o;if(e.loaded)return this.setupTextBackgroundInfo(i,e,n,s,t),!0}this.m_imageRepo.loadImage(t,s).then((e=>{i.isValid=!0})).catch((e=>{d.error(e),i.imageItem=null,i.isValid=!1}))}return!1}reset(){this.m_imageBatchRegistry.reset()}addIcon(e,t,i,n,r,s,o,a){(0,l.assert)(void 0!==e.buffer),s&&(y.computeIconScreenBox(e,t,r,a,this.m_tempScreenBox,_.ALLOCATE),i.allocate(this.m_tempScreenBox)),o>0&&(y.computeIconScreenBox(e,t,r,a,this.m_tempScreenBox,_.NONE),this.m_imageBatchRegistry.addIcon(e,this.m_tempScreenBox,n,o))}addTextBackground(e,t,i,n,r){(0,l.assert)(void 0!==e.buffer),(i=i.clone()).min.x*=r,i.min.y*=r,i.max.x*=r,i.max.y*=r,i.translate(t);const s=new l.Math2D.Box(i.min.x,i.min.y,i.max.x-i.min.x,i.max.y-i.min.y);this.m_imageBatchRegistry.addTextBackground(e,s,n)}update(){this.m_imageBatchRegistry.update()}get layers(){return this.m_layers}render(e,t){this.m_renderer.render(t.scene,e)}pickIconTexts(e,t){this.m_imageBatchRegistry.pickImageTexts(e,t)}getMemoryUsage(e){this.m_imageBatchRegistry.updateMemoryUsage(e)}addLayer(e){let t=this.m_layers.find((t=>t.id===e));return void 0===t&&(t={id:e,scene:new s.Scene},this.m_layers.push(t),this.m_layers.sort(((e,t)=>e.id-t.id))),t}setupTextBackgroundInfo(e,t,i,n,r){var s,o;if((0,l.assert)(void 0===e.uvBox),!t.image)return d.error("setupTextBackgroundInfo: No imageItem/imageData found"),void(e.isValid=!1);const a=t.image.width,c=t.image.height,h=g.trilinear&&t.mipMaps,u=a/(h?n.width:a),m=c/(h?n.height:c);e.computedWidth=null!==(s=null==i?void 0:i.x)&&void 0!==s?s:a,e.computedHeight=null!==(o=null==i?void 0:i.y)&&void 0!==o?o:c,e.uvBox={s0:0,t0:m,s1:u,t1:0},e.imageItem=t,e.imageTexture=r,e.buffer=this.m_imageBatchRegistry.registerImage(e,this.addLayer(e.renderOrder)),e.isValid=!0}setupIconInfo(e,t,i,n){var r,s;if((0,l.assert)(void 0===e.uvBox),!t.image)return d.error("setupImageInfo: No imageItem/imageData found"),void(e.isValid=!1);const a=e.technique,c=t.image.width,u=t.image.height,m=h.MipMapGenerator.getPaddedSize(c,u),p=g.trilinear&&t.mipMaps,f=p?m.width:c,v=p?m.height:u,_=void 0!==(null==n?void 0:n.width)?n.width:c,y=void 0!==(null==n?void 0:n.height)?n.height:u,x=void 0!==(null==n?void 0:n.width)?n.width:c,S=void 0!==(null==n?void 0:n.height)?n.height:u,b=void 0!==(null==n?void 0:n.xOffset)?n.xOffset:0,T=void 0!==(null==n?void 0:n.yOffset)?n.yOffset:0,M=b/f,w=(b+x)/f,E=T/v,C=(T+S)/v;let A=null!==(r=a.iconScale)&&void 0!==r?r:.5,P=null!==(s=a.iconScale)&&void 0!==s?s:.5;const R=(0,o.getPropertyValue)(a.screenWidth,i);null!=R&&(P=A=R/_);const L=(0,o.getPropertyValue)(a.screenHeight,i);null!=L&&(P=L/y,void 0!==R&&(A=P)),e.computedWidth=_*A,e.computedHeight=y*P,e.uvBox={s0:M,t0:C,s1:w,t1:E},e.uvBoxForPicking={s0:b/c,t0:(T+S)/u,s1:(b+x)/c,t1:T/u},e.imageItem=t,e.imageTexture=n,e.buffer=this.m_imageBatchRegistry.registerImage(e,this.addLayer(e.renderOrder)),e.isValid=!0}}t.ImageRenderer=y},161:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.screenToUvCoordinates=t.getPixelFromImage=void 0;const n=i(4342);let r,s;t.getPixelFromImage=function(e,t,i){return i instanceof ImageData?function(e,t,i){const{width:r,height:s,data:o}=e,a=o.length/(s*r);if(!n.MathUtils.isWithinBounds(t,0,r)||!n.MathUtils.isWithinBounds(i,0,s))return;const l=(i*r+t)*a;return o.slice(l,l+a)}(i,e,t):function(e,t,i){const{width:o,height:a}=e instanceof SVGImageElement?e.getBBox():e;if(n.MathUtils.isWithinBounds(t,0,o)&&n.MathUtils.isWithinBounds(i,0,a)&&(r||(r=document.createElement("canvas"),s=r.getContext("2d",{willReadFrequently:!0})),s))return r.width=o,r.height=a,s.drawImage(e,0,0),s.getImageData(t,i,1,1).data}(i,e,t)},t.screenToUvCoordinates=function(e,t,i,r){const s=i.x,o=i.x+i.w,a=i.y,l=i.y+i.h;return{u:n.MathUtils.map(e,s,o,r.s0,r.s1),v:n.MathUtils.map(t,a,l,r.t0,r.t1)}}},6445:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutState=void 0;const n=i(5823);t.LayoutState=class{constructor(e){this.m_hAlign=n.DefaultTextStyle.DEFAULT_HORIZONTAL_ALIGNMENT,this.m_vAlign=n.DefaultTextStyle.DEFAULT_VERTICAL_ALIGNMENT,this.textPlacement=e}set textPlacement(e){this.m_hAlign=(0,n.hAlignFromPlacement)(e.h),this.m_vAlign=(0,n.vAlignFromPlacement)(e.v)}get textPlacement(){return{h:(0,n.hPlacementFromAlignment)(this.m_hAlign),v:(0,n.vPlacementFromAlignment)(this.m_vAlign)}}reset(e){this.m_hAlign=e.horizontalAlignment,this.m_vAlign=e.verticalAlignment}get horizontalAlignment(){return this.m_hAlign}get verticalAlignment(){return this.m_vAlign}}},4957:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimplePath=t.PathParam=t.SimpleLineCurve=void 0;const n=i(8117),r=i(7793);class s extends r.LineCurve{constructor(e,t){super(e,t)}getLengths(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths}}t.SimpleLineCurve=s;class o{constructor(e,t,i){this.path=e,this.index=t,this.t=i}get curve(){return this.path.curves[this.index]}get point(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point}}t.PathParam=o;class a extends n.Path{constructor(){super()}getLengths(){if(this.m_cache)return this.m_cache;let e=0;const t=new Array;return t.push(0),this.curves.forEach((i=>{const n=i;e+=n.v1.distanceTo(n.v2),t.push(e)})),this.m_cache=t,t}getParamAt(e){const t=e*this.getLength(),i=this.getCurveLengths();for(let e=0;e<i.length;++e){if(i[e]<t)continue;const n=i[e]-t,r=this.curves[e].getLength();return new o(this,e,0===r?0:1-n/r)}return null}}t.SimplePath=a},9463:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvasFactory=void 0;const n=i(5823),r=i(4342);t.TextCanvasFactory=class{constructor(e){this.m_renderer=e,this.m_minGlyphCount=0,this.m_maxGlyphCount=0}setGlyphCountLimits(e,t){this.m_minGlyphCount=e,this.m_maxGlyphCount=t}createTextCanvas(e,t){return(0,r.assert)(this.m_maxGlyphCount>0),new n.TextCanvas({renderer:this.m_renderer,fontCatalog:e,minGlyphCount:this.m_minGlyphCount,maxGlyphCount:this.m_maxGlyphCount,name:t})}}},3800:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextStyleCache=void 0;const n=i(8152),r=i(5823),s=i(1984),o=i(1667),a=i(4342),l=i(207),c=i(8427),h=i(304),u=a.LoggerManager.instance.create("TextStyleCache"),d=new r.TextRenderStyle({fontSize:{unit:r.FontUnit.Pixel,size:32,backgroundSize:8},color:l.ColorCache.instance.getColor("#6d7477"),opacity:1,backgroundColor:l.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}),m=new r.TextLayoutStyle({verticalAlignment:r.VerticalAlignment.Center,horizontalAlignment:r.HorizontalAlignment.Center,placements:[]}),p="default";function f(e,t,i){const n=i?function(e){const t=[];return(e?e.toUpperCase().replace(" ","").split(","):[]).forEach((e=>{const i=function(e){if(e.length<1||e.length>2)return;const t={h:r.HorizontalPlacement.Center,v:r.VerticalPlacement.Center};let i=e.charAt(0),n=!0;switch(i){case s.PlacementToken.Top:case s.PlacementToken.North:t.v=r.VerticalPlacement.Top;break;case s.PlacementToken.Bottom:case s.PlacementToken.South:t.v=r.VerticalPlacement.Bottom;break;default:if(n=!1,2===e.length)return}if(n&&1===e.length)return t;switch(i=1===e.length?e.charAt(0):e.charAt(1),i){case s.PlacementToken.Right:case s.PlacementToken.East:t.h=r.HorizontalPlacement.Right;break;case s.PlacementToken.Left:case s.PlacementToken.West:t.h=r.HorizontalPlacement.Left;break;default:return}return t}(e);void 0!==i&&t.push(i)})),t}(i):void 0;return(0,r.resolvePlacementAndAlignment)(function(e){return"Left"===e||"Center"===e||"Right"===e?r.HorizontalAlignment[e]:m.horizontalAlignment}(e),function(e){return"Above"===e||"Center"===e||"Below"===e?r.VerticalAlignment[e]:m.verticalAlignment}(t),n)}t.TextStyleCache=class{constructor(){this.m_textStyles=new Map,this.m_defaultStyle={name:p,fontCatalog:void 0,renderParams:d.params,layoutParams:m.params},this.updateDefaultTextStyle()}updateTextStyles(e,t){this.m_textStyles.clear(),null==e||e.forEach((e=>{this.m_textStyles.set(e.name,this.createTextStyle(e,e.name))})),this.updateDefaultTextStyle(t,e)}updateTextCanvases(e){this.initializeTextCanvas(this.m_defaultStyle,e);for(const[,t]of this.m_textStyles)this.initializeTextCanvas(t,e)}getTextStyle(e){let t;return void 0===e?t=this.m_defaultStyle:(t=this.m_textStyles.get(e),void 0===t&&(t=this.m_defaultStyle)),t}createRenderStyle(e,t){const i=e.mapView,h=i.zoomLevel,u=Math.floor(h),d=new s.MapEnv({$zoom:u},i.env),m=this.m_defaultStyle.renderParams,p=(0,a.getOptionValue)(m.opacity,1);let f,g=(0,n.getPropertyValue)((0,a.getOptionValue)(t.opacity,p),d);if(void 0!==t.color){let e=(0,c.evaluateColorProperty)(t.color,d);void 0!==e&&(o.ColorUtils.hasAlphaInHex(e)&&(g*=o.ColorUtils.getAlphaFromHex(e),e=o.ColorUtils.removeAlphaFromHex(e)),f=l.ColorCache.instance.getColor(e))}const v=(0,a.getOptionValue)(m.fontSize.backgroundSize,0),_=(0,n.getPropertyValue)((0,a.getOptionValue)(t.backgroundSize,v),d),y=void 0!==t.backgroundColor&&void 0!==t.backgroundSize&&_>0,x=(0,a.getOptionValue)(m.backgroundOpacity,0);let S,b=(0,n.getPropertyValue)((0,a.getOptionValue)(t.backgroundOpacity,y?1:x),d);if(void 0!==t.backgroundColor){let e=(0,c.evaluateColorProperty)(t.backgroundColor,d);void 0!==e&&(o.ColorUtils.hasAlphaInHex(e)&&(b*=o.ColorUtils.getAlphaFromHex(e),e=o.ColorUtils.removeAlphaFromHex(e)),S=l.ColorCache.instance.getColor(e))}const T={fontName:(0,a.getOptionValue)(t.fontName,m.fontName),fontSize:{unit:r.FontUnit.Pixel,size:(0,n.getPropertyValue)((0,a.getOptionValue)(t.size,m.fontSize.size),d),backgroundSize:_},fontStyle:"Regular"===t.fontStyle||"Bold"===t.fontStyle||"Italic"===t.fontStyle||"BoldItalic"===t.fontStyle?r.FontStyle[t.fontStyle]:m.fontStyle,fontVariant:"Regular"===t.fontVariant||"AllCaps"===t.fontVariant||"SmallCaps"===t.fontVariant?r.FontVariant[t.fontVariant]:m.fontVariant,rotation:(0,a.getOptionValue)(t.rotation,m.rotation),color:(0,a.getOptionValue)(f,(0,a.getOptionValue)(m.color,r.DefaultTextStyle.DEFAULT_COLOR)),backgroundColor:(0,a.getOptionValue)(S,(0,a.getOptionValue)(m.backgroundColor,r.DefaultTextStyle.DEFAULT_BACKGROUND_COLOR)),opacity:g,backgroundOpacity:b},M=this.getTextStyle(t.style).renderParams;return new r.TextRenderStyle(Object.assign(Object.assign({},M),T))}createLayoutStyle(e,t){var i,o,a,l,c,h;const u=e.mapView,d=Math.floor(e.mapView.zoomLevel),m=new s.MapEnv({$zoom:d},u.env),p=this.m_defaultStyle.layoutParams,g=(0,n.getPropertyValue)(t.hAlignment,m),v=(0,n.getPropertyValue)(t.vAlignment,m),_=(0,s.isIconTextTechnique)(t)?(0,n.getPropertyValue)(t["text-placement"],m):null,{horizontalAlignment:y,verticalAlignment:x,placements:S}=f(g,v,_),b=(0,n.getPropertyValue)(t.wrappingMode,m),T="None"===b||"Character"===b||"Word"===b?r.WrappingMode[b]:p.wrappingMode,M={tracking:null!==(i=(0,n.getPropertyValue)(t.tracking,m))&&void 0!==i?i:p.tracking,leading:null!==(o=(0,n.getPropertyValue)(t.leading,m))&&void 0!==o?o:p.leading,maxLines:null!==(a=(0,n.getPropertyValue)(t.maxLines,m))&&void 0!==a?a:p.maxLines,lineWidth:null!==(l=(0,n.getPropertyValue)(t.lineWidth,m))&&void 0!==l?l:p.lineWidth,canvasRotation:null!==(c=(0,n.getPropertyValue)(t.canvasRotation,m))&&void 0!==c?c:p.canvasRotation,lineRotation:null!==(h=(0,n.getPropertyValue)(t.lineRotation,m))&&void 0!==h?h:p.lineRotation,wrappingMode:T,horizontalAlignment:y,verticalAlignment:x,placements:S},w=this.getTextStyle(t.style);return new r.TextLayoutStyle(Object.assign(Object.assign({},w),M))}updateDefaultTextStyle(e,t){var i,n;this.m_defaultStyle.fontCatalog=void 0;const r=null!==(n=null!==(i=null==t?void 0:t.find((e=>e.name===p)))&&void 0!==i?i:e)&&void 0!==n?n:null==t?void 0:t[0];r&&(this.m_defaultStyle=this.createTextStyle(r,p)),this.m_defaultStyle.textCanvas=void 0}initializeTextCanvas(e,t){var i,n,r;e.textCanvas||(e.textCanvas=null!==(i=e.fontCatalog&&t.has(e.fontCatalog)?t.get(e.fontCatalog):t.get(h.DEFAULT_FONT_CATALOG_NAME))&&void 0!==i?i:t.values().next().value,void 0!==e.fontCatalog&&e.fontCatalog!==(null===(n=e.textCanvas)||void 0===n?void 0:n.name)&&u.warn(`Font catalog '${e.fontCatalog}' set in text style '${e.name}' not found.`+(e.textCanvas?` Using default font catalog ${null===(r=e.textCanvas)||void 0===r?void 0:r.name}`:"")))}createTextStyle(e,t){var i;const{horizontalAlignment:n,verticalAlignment:s,placements:o}=f(e.hAlignment,e.vAlignment,e.placements);return{name:t,fontCatalog:(0,a.getOptionValue)(e.fontCatalogName,this.m_defaultStyle.fontCatalog),renderParams:{fontName:e.fontName,fontSize:{unit:r.FontUnit.Pixel,size:32,backgroundSize:null!==(i=e.backgroundSize)&&void 0!==i?i:8},fontStyle:"Regular"===e.fontStyle||"Bold"===e.fontStyle||"Italic"===e.fontStyle||"BoldItalic"===e.fontStyle?r.FontStyle[e.fontStyle]:void 0,fontVariant:"Regular"===e.fontVariant||"AllCaps"===e.fontVariant||"SmallCaps"===e.fontVariant?r.FontVariant[e.fontVariant]:void 0,rotation:e.rotation,color:void 0!==e.color?l.ColorCache.instance.getColor(e.color):void 0,backgroundColor:void 0!==e.backgroundColor?l.ColorCache.instance.getColor(e.backgroundColor):void 0,opacity:e.opacity,backgroundOpacity:e.backgroundOpacity},layoutParams:{tracking:e.tracking,leading:e.leading,maxLines:e.maxLines,lineWidth:e.lineWidth,canvasRotation:e.canvasRotation,lineRotation:e.lineRotation,wrappingMode:"None"===e.wrappingMode||"Character"===e.wrappingMode||"Word"===e.wrappingMode?r.WrappingMode[e.wrappingMode]:r.WrappingMode.Word,verticalAlignment:s,horizontalAlignment:n,placements:o}}}}},3922:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTextStyleCache=void 0,t.TileTextStyleCache=class{constructor(e){this.textRenderStyles=[],this.textLayoutStyles=[],this.tile=e}clear(){this.textRenderStyles.length=0,this.textLayoutStyles.length=0}getRenderStyle(e){let t=this.textRenderStyles[e._index];return void 0===t&&(t=this.textRenderStyles[e._index]=this.tile.mapView.iconTextRenderer.styleCache.createRenderStyle(this.tile,e)),t}getLayoutStyle(e){let t=this.textLayoutStyles[e._index];return void 0===t&&(t=this.textLayoutStyles[e._index]=this.tile.mapView.iconTextRenderer.styleCache.createLayoutStyle(this.tile,e)),t}}},5159:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCache=void 0;const n=i(9237),r=i(9360);class s{constructor(){this.m_images=new Map}static get instance(){return void 0===s.m_instance&&(s.m_instance=new s),s.m_instance}static dispose(){s.m_instance=void 0}registerImage(e,t){let i=this.findImageCacheItem(t.url);return i?(void 0===e||i.owners.includes(e)||i.owners.push(e),i.imageLikeItem):(i={imageLikeItem:t,owners:[e]},this.m_images.set(t.url,i),i.imageLikeItem)}registerImageByUrl(e,t,i,s=!1){const o=s?new r.SVGMarkupItem(t):new n.ImageItem(t,i);return this.registerImage(e,o)}removeImage(e,t){const i=this.m_images.get(t);return void 0!==i&&(this.unlinkCacheItem(i,e),!0)}findImage(e){const t=this.m_images.get(e);if(void 0!==t)return t.imageLikeItem}clear(e){this.m_images.forEach((t=>{this.unlinkCacheItem(t,e)}))}get size(){return this.m_images.size}findImageCacheItem(e){return this.m_images.get(e)}cancelLoading(e){e.loading&&(e.cancelled=!0)}unlinkCacheItem(e,t){const i=e.owners.indexOf(t);i>=0&&e.owners.splice(i,1),0===e.owners.length&&(this.m_images.delete(e.imageLikeItem.url),this.cancelLoading(e.imageLikeItem))}}t.ImageCache=s},9237:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageItem=void 0;const n=i(2676),r=i(4342),s=i(6802),o=r.LoggerManager.instance.create("loadImage"),a=new s.MipMapGenerator;t.ImageItem=class{constructor(e,t){this.url=e,this.image=t}get loaded(){return void 0!==this.image&&void 0!==this.mipMaps}get loading(){return void 0!==this.loadingPromise}loadImage(){if(this.loaded)return Promise.resolve(this);if(this.loading)return this.loadingPromise;if(this.image){const e=this.image;return e instanceof HTMLImageElement&&!e.complete?(this.loadingPromise=new Promise(((t,i)=>{e.addEventListener("load",this.finalizeImage.bind(this,e,t)),e.addEventListener("error",i)})),this.loadingPromise):(this.finalizeImage(this.image),Promise.resolve(this))}return this.loadingPromise=new Promise(((e,t)=>{o.debug(`Loading image: ${this.url}`),!0===this.cancelled?(o.debug(`Cancelled loading image: ${this.url}`),e(this)):(new n.ImageLoader).load(this.url,(t=>{if(!0===this.cancelled)return o.debug(`Cancelled loading image: ${this.url}`),void e(this);this.finalizeImage(t,e)}),void 0,(e=>{o.error(`... loading image failed: ${this.url} : ${e}`),this.loadingPromise=void 0,t(`... loading image failed: ${this.url} : ${e}`)}))})),this.loadingPromise}finalizeImage(e,t){this.image=e,this.mipMaps=a.generateTextureAtlasMipMap(this),this.loadingPromise=void 0,t&&t(this)}}},9297:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageRepo=void 0;const n=i(5738),r=i(5159),s=i(9237),o=i(9360);t.ImageRepo=class{constructor(){this.m_iconTextManager=new n.IconTextManager}get iconTextManager(){return this.m_iconTextManager}get imageCache(){return r.ImageCache.instance}findImage(e,t){const i=this.m_iconTextManager.getImageTexture(e),n=i?i.image:e;let r;return t&&(r=this.imageCache.findImage(o.SVGMarkupItem.getImageItemUrl(n,t))),r||(r=this.imageCache.findImage(n)),r instanceof s.ImageItem?{imageItem:r,imageTexture:i}:void 0}async loadImage(e,t){const i=this.m_iconTextManager.getImageTexture(e),n=i?i.image:e;let r;if(t){const e=o.SVGMarkupItem.getImageItemUrl(n,t),i=this.imageCache.findImage(e);if(i)r=i;else{const i=this.imageCache.findImage(n);if(i instanceof s.ImageItem)r=i;else if(i instanceof o.SVGMarkupItem){await i.loadImage();const n=this.imageCache.findImage(e);n?r=n:(r=i.createImageItem(t),r&&this.imageCache.registerImage(this,r))}}}else{const e=this.imageCache.findImage(n);e instanceof s.ImageItem&&(r=e)}if(r)return await r.loadImage(),{imageItem:r,imageTexture:i};throw new Error(`${e} image not found`)}clear(){this.imageCache.clear(this)}}},7063:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadTexture=void 0;const n=i(6271),r=i(2676),s=i(1984),o=i(4342),a=i(5640),l=i(2119),c=o.LoggerManager.instance.create("LoadTexture");function h(e,t,i,n){const s=new l.TextureHandle;return(new r.ImageLoader).load(e,(e=>{s.image=e,t(s)}),void 0,i),n&&s.addEventListener("dispose",(()=>{URL.revokeObjectURL(e)})),s}function u(e){return"nodeName"in e&&"IMG"===e.nodeName}t.loadTexture=function(e,t,i,r,o,d){const m=t.get(e);if(m)return m.addReference(),null==o||o(m),m;const p=function(e,t,i){if("string"==typeof e)return h(e,t,i,!1);if((0,s.isTextureBuffer)(e))return"image/raw"===e.type?function(e,t,i){const r=e.dataTextureProperties;if(r){const i=r.type?(0,a.toTextureDataType)(r.type):void 0,s=function(e,t){if(void 0===t)return new Uint8Array(e);switch(t){case n.UnsignedByteType:return new Uint8Array(e);case n.ByteType:return new Int8Array(e);case n.ShortType:return new Int16Array(e);case n.UnsignedShortType:return new Uint16Array(e);case n.IntType:return new Int32Array(e);case n.UnsignedIntType:return new Uint32Array(e);case n.FloatType:return new Float32Array(e);case n.HalfFloatType:return new Uint16Array(e)}throw new Error("Unsupported texture data type")}(e.buffer,i),o=r.format?(0,a.toPixelFormat)(r.format):void 0,c=l.TextureHandle.fromBufferSource(s,r.width,r.height,o,i);return t(c),c}i("no data texture properties provided.")}(e,t,i):h(URL.createObjectURL(new Blob([e.buffer],{type:e.type})),t,i,!0);if(u(e)||"nodeName"in(r=e)&&"CANVAS"===r.nodeName){const i=l.TextureHandle.fromHtmlImage(e);if(u(e)&&!e.complete){const n=()=>{t(i),e.removeEventListener("load",n)};e.addEventListener("load",n)}else t(i);return i}if(function(e){return"data"in e&&"width"in e&&"height"in e}(e)){const i=new l.TextureHandle(e);return t(i),i}var r;i("Wrong input type")}(e,(e=>{r?(e.onUpdate=()=>{e.onUpdate=null,null==o||o(e)},r.initTexture(e)):null==o||o(e)}),(e=>{c.error("Failed to load texture: ",e),null==d||d(e)}));return p&&(function(e,t){e.needsUpdate=!0,t&&(void 0!==t.wrapS&&(e.wrapS=(0,a.toWrappingMode)(t.wrapS)),void 0!==t.wrapT&&(e.wrapT=(0,a.toWrappingMode)(t.wrapT)),void 0!==t.magFilter&&(e.magFilter=(0,a.toTextureFilter)(t.magFilter)),void 0!==t.minFilter&&(e.minFilter=(0,a.toTextureFilter)(t.minFilter)),void 0!==t.flipY&&(e.flipY=t.flipY),void 0!==t.repeatU&&(e.repeat.x=t.repeatU),void 0!==t.repeatV&&(e.repeat.y=t.repeatV))}(p,i),t.set(e,p)),p}},6802:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MipMapGenerator=void 0;const n=i(3334),r=i(5448),s="undefined"==typeof window;function o(){const e=document.createElement("canvas"),t=e.getContext("2d",{willReadFrequently:!0});if(!t)throw new Error("Error getting canvas context.");return[e,t]}class a{static getPaddedSize(e,t){return new r.Vector2((0,n.ceilPowerOfTwo)(e),(0,n.ceilPowerOfTwo)(t))}constructor(){s||([this.m_paddingCanvas,this.m_paddingContext]=o(),[this.m_resizeCanvas,this.m_resizeContext]=o())}generateTextureAtlasMipMap(e){if(s)throw new Error("MipMapGenerator only works in browser.");if(void 0===e.image)throw new Error("Can not generate mip maps. Image data not loaded!");const t=e.image,i=[];let{width:n,height:r}=a.getPaddedSize(t.width,t.height);for(this.copyImageWithPadding(t,n,r),i.push(this.m_paddingContext.getImageData(0,0,n,r)),n*=.5,r*=.5;n>=1||r>=1;){const e=i[i.length-1];i.push(this.resizeImage(e,Math.max(n,1),Math.max(r,1))),n*=.5,r*=.5}return i}copyImageWithPadding(e,t,i){return this.m_paddingCanvas.width=t,this.m_paddingCanvas.height=i,this.m_paddingContext.clearRect(0,0,t,i),e instanceof ImageData?this.m_paddingContext.putImageData(e,0,0):this.m_paddingContext.drawImage(e,0,0),e.width!==t&&this.m_paddingContext.drawImage(this.m_paddingCanvas,e.width-1,0,1,e.height,e.width,0,t-e.width,e.height),e.height!==i&&this.m_paddingContext.drawImage(this.m_paddingCanvas,0,e.height-1,t,1,0,e.height,t,i-e.height),this.m_paddingCanvas}resizeImage(e,t,i){const n=this.copyImageWithPadding(e,e.width,e.height);return this.m_resizeCanvas.width=t,this.m_resizeCanvas.height=i,this.m_resizeContext.clearRect(0,0,t,i),this.m_resizeContext.drawImage(n,0,0,t,i),this.m_resizeContext.getImageData(0,0,t,i)}}t.MipMapGenerator=a},9360:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SVGMarkupItem=void 0;const n=i(9237);class r{constructor(e){this.url=e,this.m_parser=new DOMParser,this.loaded=!1}get loading(){return void 0!==this.loadingPromise&&!1===this.loaded}get svg(){return this.m_svg}loadImage(){return this.loadingPromise||(this.loadingPromise=fetch(this.url).then((e=>e.text())).then((e=>(this.m_svg=e,this.loaded=!0,this)))),this.loadingPromise}createImageItem(e){if(void 0===this.svg)return;const t=this.m_parser.parseFromString(this.svg,"image/svg+xml").children[0];t.setAttribute("width",`${e.width}`),t.setAttribute("height",`${e.height}`),t.setAttribute("preserveAspectRatio","none");const i=(new XMLSerializer).serializeToString(t),s=new Image;return s.src="data:image/svg+xml;base64,"+btoa(i),new n.ImageItem(r.getImageItemUrl(this.url,e),s)}static getImageItemUrl(e,t){return`${e}-${t.width}-${t.height}`}}t.SVGMarkupItem=r},5996:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureCache=void 0;const n=i(8263),r=i(7987);class s extends n.LRUCache{constructor(){super(2e6,r.Object3DUtils.getTextureSize),this.canEvict=(e,t)=>t.referenceCount<=1,this.evictionCallback=(e,t)=>{t.removeReference()}}set(e,t){super.set(e,t),t.addReference()}}t.TextureCache=s},2119:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureHandle=void 0;const n=i(6271),r=i(394);class s extends r.Texture{static fromBufferSource(e,t,i,r,o){const a=new s(null,void 0,void 0,void 0,n.NearestFilter,n.NearestFilter,r,o);return a.isDataTexture=!0,a.image={data:e,width:t,height:i},a.generateMipmaps=!1,a.flipY=!1,a.unpackAlignment=1,a.needsUpdate=!0,a}static fromHtmlImage(e){const t=new s(e);return t.isCanvasTexture=!0,t}constructor(e,t,i,n,r,s,o,a,l,c){super(e,t,i,n,r,s,o,a,l,c),this.m_refCount=1}addReference(){this.m_refCount++}removeReference(){this.m_refCount>0&&(this.m_refCount--,0===this.m_refCount&&super.dispose())}get referenceCount(){return this.m_refCount}dispose(){this.removeReference()}}t.TextureHandle=s},3638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerBootstrapResponse=t.isWorkerBootstrapRequest=void 0,t.isWorkerBootstrapRequest=function(e){return e&&"worker-bootstrap-request"===e.type&&Array.isArray(e.dependencies)},t.isWorkerBootstrapResponse=function(e){return e&&"worker-bootstrap-response"===e.type&&Array.isArray(e.resolvedDependencies)}},1973:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerLoader=void 0;const n=i(4342),r=i(3638),s=n.LoggerManager.instance.create("WorkerLoader");class o{static startWorker(e,t=1e4){return e.startsWith("blob:")?this.startWorkerImmediately(e,t):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(e,t):this.startWorkerImmediately(e,t).catch((i=>{if("undefined"!=typeof window){const r=window.location.href,a=new URL(e,r).href;if((0,n.getUrlOrigin)(a)===(0,n.getUrlOrigin)(r))throw i;return s.log("#startWorker: cross-origin worker construction failed, trying load with blob"),this.directlyFallbackToBlobBasedLoading=!0,o.startWorkerBlob(e,t)}throw i}))}static startWorkerImmediately(e,t){try{const i=new Worker(e);return this.waitWorkerInitialized(i,t)}catch(e){return Promise.reject(e)}}static startWorkerBlob(e,t){return this.fetchScriptSourceToBlobUrl(e).then((e=>this.startWorkerImmediately(e,t)))}static fetchScriptSourceToBlobUrl(e){let t=this.sourceLoaderCache.get(e);return void 0!==t||(t=fetch(e).then((e=>e.text())).catch((e=>{throw new Error(`WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: ${e}`)})).then((t=>{this.sourceLoaderCache.delete(e);const i=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(i)})),this.sourceLoaderCache.set(e,t)),t}static waitWorkerInitialized(e,t){return new Promise(((i,n)=>{const s=t=>{const s=t.data;if((0,r.isWorkerBootstrapRequest)(s)){const t=s.dependencies,i=[];for(const e of t){const t=this.dependencyUrlMapping[e];if(!t)return a(),void n(new Error(`#waitWorkerInitialized: Unable to resolve '${e}' as needed by worker script.`));i.push(t)}const r={type:"worker-bootstrap-response",resolvedDependencies:i};e.postMessage(r)}else a(),i(e),setTimeout((()=>{e.dispatchEvent(t)}),0)},o=e=>{a();let t="Error during worker initialization";e.message&&(t+=`: ${e.message}`),"string"==typeof e.filename&&"number"==typeof e.lineno&&(t+=` in ${e.filename}:${e.lineno}`),n(new Error(t))},a=()=>{clearTimeout(l),e.removeEventListener("message",s),e.removeEventListener("error",o)};e.addEventListener("error",o),e.addEventListener("message",s);const l=setTimeout((()=>{a(),n(new Error("Timeout exceeded when waiting for first message from worker."))}),t)}))}}t.WorkerLoader=o,o.directlyFallbackToBlobBasedLoading=!1,o.sourceLoaderCache=new Map,o.dependencyUrlMapping={}},4250:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(8583),t),r(i(8014),t),r(i(5033),t),r(i(8177),t),r(i(8878),t),r(i(5997),t),r(i(674),t),r(i(4744),t),r(i(4258),t),r(i(398),t),r(i(4919),t),r(i(5551),t),r(i(4821),t),r(i(4877),t),r(i(8484),t),r(i(460),t),r(i(4121),t),r(i(1549),t),r(i(2462),t),r(i(182),t),r(i(872),t),r(i(9489),t),r(i(4067),t),r(i(71),t),r(i(3224),t),r(i(2141),t),r(i(3298),t),r(i(9528),t),r(i(8578),t)},460:function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.CirclePointsMaterial=void 0;const r=i(4125),s=i(5971),o=i(6729),a=i(5143),l=i(2141),c=i(8578);class h extends l.RawShaderMaterial{constructor(e){const t=new s.Color;let i,l,u,d;if(e){const{size:s,color:c,opacity:m}=e,p=n(e,["size","color","opacity"]);i=s,l=c,u=m,p.name="CirclePointsMaterial",p.vertexShader="\nuniform float size;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nattribute vec3 position;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n",p.fragmentShader="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuseColor;\nuniform float opacity;\n\nvoid main() {\n    float alpha = opacity;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuseColor, alpha);\n}",p.uniforms=a.UniformsUtils.merge([{size:new r.Uniform(h.DEFAULT_CIRCLE_SIZE),diffuseColor:new r.Uniform(t),opacity:new r.Uniform(1)},o.UniformsLib.fog]),p.depthTest=!1,p.extensions=Object.assign(Object.assign({},p.extensions),{derivatives:!0}),d=p}super(d),(0,c.enforceBlending)(this),this.type="CirclePointsMaterial",this.setOpacity(1),void 0!==i&&(this.size=i),void 0!==l&&(this.color=l),void 0!==u&&this.setOpacity(u)}get size(){return this.uniforms.size.value}set size(e){this.uniforms.size.value=e}get color(){return this.uniforms.diffuseColor.value}set color(e){this.uniforms.diffuseColor.value.copy(e)}}t.CirclePointsMaterial=h,h.DEFAULT_CIRCLE_SIZE=1},4121:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyMaterial=t.CopyShader=void 0;const n=i(6271),r=i(1498);t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"};class s extends r.ShaderMaterial{constructor(e){super({name:"CopyMaterial",uniforms:e,vertexShader:t.CopyShader.vertexShader,fragmentShader:t.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!1,blending:n.NoBlending,depthTest:!1,depthWrite:!1})}}t.CopyMaterial=s},1549:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeMaterial=void 0;const n=i(4125),r=i(5971),s=i(394),o=i(8014),a=i(5033),l=i(8177),c=i(2141),h=i(8578);class u extends c.RawShaderMaterial{constructor(e){var t;let i;if(e){const o={},c=void 0!==e.extrusionRatio&&e.extrusionRatio>=a.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN&&e.extrusionRatio<a.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX;e.displacementMap&&(0,h.setShaderDefine)(o,"USE_DISPLACEMENTMAP",!0),c&&(0,h.setShaderDefine)(o,"USE_EXTRUSION",!0),!0===e.vertexColors&&(0,h.setShaderDefine)(o,"USE_COLOR",!0),i={name:"EdgeMaterial",vertexShader:"\n#define EDGE_DEPTH_OFFSET 0.0001\n\n#ifdef USE_COLOR\nattribute vec4 color;\n#else\nuniform vec3 color;\n#endif\n\n// SHADER_NAME may be defined by THREE.JS own shaders in which case these attributes & uniforms are\n// already defined\n#ifndef SHADER_NAME\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n#endif\n\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\n#ifdef USE_DISPLACEMENTMAP\nattribute vec3 normal;\nattribute vec2 uv;\nuniform sampler2D displacementMap;\n#endif\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_vertex>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n\n    vec3 transformed = vec3( position );\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_vertex>\n    #endif\n\n    #ifdef USE_DISPLACEMENTMAP\n    transformed += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n    gl_Position = projectionMatrix * mvPosition;\n    // After projection gl_Position contains clip space coordinates of each vertex\n    // before perspective division (1 / w), thus only vertexes with -w < z < w should\n    // be displayed and offset. We offset only those edges which z coordinate in NDC\n    // space is between: -inf < z < 1\n    float depthOffset = step(-1.0, -gl_Position.z / gl_Position.w) * EDGE_DEPTH_OFFSET;\n    gl_Position.z -= depthOffset;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",uniforms:{color:new n.Uniform(new r.Color(u.DEFAULT_COLOR)),edgeColor:new n.Uniform(new r.Color(u.DEFAULT_COLOR)),edgeColorMix:new n.Uniform(u.DEFAULT_COLOR_MIX),fadeNear:new n.Uniform(l.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new n.Uniform(l.FadingFeature.DEFAULT_FADE_FAR),extrusionRatio:new n.Uniform(a.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),displacementMap:new n.Uniform(null!==(t=e.displacementMap)&&void 0!==t?t:new s.Texture)},depthWrite:!1,defines:o,rendererCapabilities:e.rendererCapabilities}}super(i),(0,h.enforceBlending)(this),l.FadingFeature.patchGlobalShaderChunks(),o.ExtrusionFeature.patchGlobalShaderChunks(),void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.colorMix&&(this.colorMix=e.colorMix),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.extrusionRatio&&(this.extrusionRatio=e.extrusionRatio))}get objectColor(){return this.uniforms.color.value}set objectColor(e){this.uniforms.color.value.copy(e)}get color(){return this.uniforms.edgeColor.value}set color(e){this.uniforms.edgeColor.value.copy(e)}get lineWidth(){return this.linewidth}set lineWidth(e){this.linewidth=e,this.linewidth<=0?this.visible=!1:this.visible=!0}get colorMix(){return this.uniforms.edgeColorMix.value}set colorMix(e){this.uniforms.edgeColorMix.value!==e&&(this.uniforms.edgeColorMix.value=e)}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value!==e&&(this.uniforms.fadeFar.value=e,(0,h.setShaderMaterialDefine)(this,"USE_FADING",e>0))}get extrusionRatio(){return this.uniforms.extrusionRatio.value}set extrusionRatio(e){if(this.uniforms.extrusionRatio.value===e)return;this.uniforms.extrusionRatio.value=e;const t=e>=a.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN;(0,h.setShaderMaterialDefine)(this,"USE_EXTRUSION",t)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),(0,h.setShaderMaterialDefine)(this,"USE_DISPLACEMENTMAP",t)}}t.EdgeMaterial=u,u.DEFAULT_COLOR=0,u.DEFAULT_COLOR_MIX=0},2462:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroundAtmosphereMaterial=t.GroundAtmosphereShader=void 0;const n=i(6271),r=i(4125),s=i(5971),o=i(8333),a=i(6815),l=i(2141),c=i(1870),h=i(8578);t.GroundAtmosphereShader={uniforms:{u_eyePositionWorld:new r.Uniform(new a.Vector3),u_lightDirectionWorld:new r.Uniform(new a.Vector3(0,1,0)),u_modelViewProjection:new r.Uniform(new o.Matrix4),u_atmosphereEnv:new r.Uniform(new a.Vector3(6384515.136999999,6537590.425,0)),u_hsvCorrection:new r.Uniform(new a.Vector3(0,0,0)),topColor:new r.Uniform(new s.Color(30719)),bottomColor:new r.Uniform(new s.Color(16777215)),offset:new r.Uniform(33),exponent:new r.Uniform(.6),fogColor:new r.Uniform(new s.Color(30719)),fogNear:new r.Uniform(new s.Color(30719)),fogFar:new r.Uniform(new s.Color(16777215))},vertexShader:`\n\n    #define IMPROVE_INTERSECT_PRECISION 1\n    #define IMPROVE_DOT_PRECISION 1\n\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    // Base mandatory uniforms\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Km = 0.0015;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 25.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        1.0 / pow(0.650, 4.0), // Red\n        1.0 / pow(0.570, 4.0), // Green\n        1.0 / pow(0.475, 4.0)); // Blue\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${c.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for ground.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE.\n    //\n    AtmosphereColor computeGroundAtmosphere(vec3 v3Pos, vec3 vLightDir)\n    {\n        // Retrieve environment variables\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be moved to const or define(s) at further optimizations:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = fScale / RayleighScaleDepth;\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n#if !defined(IMPROVE_DOT_PRECISION)\n        vec3 v3Dir = normalize(v3Pos);\n#endif\n\n#ifdef CAMERA_IN_SPACE\n\n        // Calculate first point of camera ray and sphere intersection.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection, setting it to\n        // the length of ray passed through atmosphere\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n        float fDepth = exp((fInnerRadius - fOuterRadius) / RayleighScaleDepth);\n\n#else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        // Virtually fNear is just at eye position, so ray passing through atmosphere does not shorten\n        // fFar -= 0.0;\n        float fDepth = exp((fInnerRadius - fCameraHeight) / RayleighScaleDepth);\n#endif\n\n#if defined(IMPROVE_DOT_PRECISION)\n        float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n#else\n        float fCameraAngle = dot(-v3Ray, v3Dir);\n#endif\n        float fCameraScale = scale(fCameraAngle);\n\n#ifdef DYNAMIC_LIGHT\n        // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n        #if defined(IMPROVE_DOT_PRECISION)\n            // The light angle for given light source may be calculated as:\n            // angle = dot(vLightDir, v3Dir) / length(v3Dir);\n            // where v3Dir holds normalized vertex position, but for precision issues we v3Pos (un-normalized)\n            float fLightAngle = dot(vLightDir, v3Pos) / length(v3Pos);\n        #else\n            float fLightAngle = dot(vLightDir, v3Dir);\n        #endif\n#else\n        float fLightAngle = 1.0;\n#endif\n        float fLightScale = scale(fLightAngle);\n\n        float fCameraOffset = fDepth * fCameraScale;\n        float fTemp = (fLightScale + fCameraScale);\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i = 0; i < nSamples; i++)\n        {\n            float fHeight = length(v3SamplePoint);\n            float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n            float fScatter = fDepth * fTemp - fCameraOffset;\n            // Compute color factors\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (fDepth * fScaledLength);\n            // Move to the next point\n            v3SamplePoint += v3SampleRay;\n        }\n\n        AtmosphereColor color;\n        color.mie = v3BaseColor * (InvWavelength * KrESun + KmESun);\n        // Calculate the attenuation factor for the ground\n        color.rayleigh = v3Attenuate;\n\n        return color;\n    }\n\n    void main(void)\n    {\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeGroundAtmosphere(position.xyz, vLightDir);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n        v_vertToOrigin = normalize(position.xyz);\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n\n    // Exposure correction gives more subtle gradients on the ground.\n    #define CORRECT_EXPOSURE 1\n    #define FADE_DEPTH 1\n    #define NIGHT_LOCAL 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${c.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        // GPU gems mix of ground solution, with custom alpha settings\n        vec3 cRgb = v_mieColor + 0.25 * v_rayleighColor;\n\n        // Not needed for HDR frame buffer\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Interesting results with exposure factor: 2.0, 3.5, 4.0\n        cRgb = correctExposure(cRgb, 3.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Base atmosphere opacity\n        float fAtmosphereAlpha = 1.0;\n\n        // Factor based on the distance of camera atmosphere and ground, results are:\n        // 0.0 = camera on the ground surface,\n        // 1.0 = at the outer edge of the atmosphere.\n        float fDepthFactor = clamp((fCameraHeight - fInnerRadius) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n    #ifdef FADE_DEPTH\n        // Fade alpha based on the distance of camera between atmosphere layers\n        #ifdef FADE_DEPTH_LINEAR\n            fAtmosphereAlpha *= fDepthFactor;\n        #else\n            fAtmosphereAlpha *= pow(fDepthFactor, 1.5);\n        #endif\n    #endif\n\n#if defined(FADE_NIGHT) || defined(DARKEN_NIGHT)\n    #ifdef DYNAMIC_LIGHT\n        // Adjust factor based on time of day, results are:\n        // 0.0 = night,\n        // 1.0 = day.\n        #ifdef NIGHT_GLOBAL\n            // Global night fade based on camera and light orientation\n            float fNightFactor = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\n            fNightFactor = pow(fNightFactor, 0.5);\n        #else // NIGHT_LOCAL\n            float fNightFactor =\n                clamp(dot(v_vertToOrigin, vLightDir) / length(v_vertToOrigin), 0.0, 1.0);\n            fNightFactor = pow(fNightFactor, 0.8);\n        #endif\n    #else\n        float fNightFactor = 1.0;\n    #endif\n#endif\n\n    #ifdef FADE_NIGHT\n        // Adjust alpha for night side of the globe\n        fAtmosphereAlpha *= fNightFactor;\n    #endif\n\n    #ifdef DARKEN_NIGHT\n        // Change the brightness depending on night / day side.\n        // NOTE: Darkening should be rather applied in HSV space, without loss on saturation,\n        // but it is much more GPU consuming.\n        const float minBrightness = 0.5;\n        float fDarkenFactor = clamp(fNightFactor, minBrightness, 1.0);\n        cRgb *= fDarkenFactor;\n    #endif\n\n    #ifdef EXPOSURE_DEPTH\n        // Control exposure depending from ground distance\n        float exposureBoost = 3.0 - fDepthFactor;\n        cRgb = correctExposure(cRgb, exposureBoost);\n    #endif\n\n        // Experimental fading out of focus point - similar to fresnel effect in top view.\n        // This fade is handy to better expose cartographic/map features in screen center.\n        float fFocusFactor = 1.0 - clamp(dot(normalize(v_vertToCamera), v_vertToOrigin), 0.0, 1.0) + 0.1;\n        fFocusFactor = pow(fFocusFactor, 2.5);\n        fAtmosphereAlpha *= fFocusFactor;\n\n        // Integrate all features\n        gl_FragColor = vec4(cRgb, fAtmosphereAlpha);\n    }\n    `};class u extends l.RawShaderMaterial{constructor(e){let i;e&&(i={name:"GroundAtmosphereMaterial",vertexShader:t.GroundAtmosphereShader.vertexShader,fragmentShader:t.GroundAtmosphereShader.fragmentShader,uniforms:t.GroundAtmosphereShader.uniforms,transparent:!0,depthTest:!1,depthWrite:!1,side:n.FrontSide,blending:n.NormalBlending,rendererCapabilities:e.rendererCapabilities}),super(i)}setDynamicLighting(e){(0,h.setShaderMaterialDefine)(this,"DYNAMIC_LIGHT",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,n){const r=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=r.eyePos,i=r.modelViewProjection,s=r.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=n.clone();const o=s>this.outerRadius,a=(0,h.setShaderDefine)(e.defines,"CAMERA_IN_SPACE",o),l=(0,h.setShaderDefine)(e.defines,"CAMERA_IN_ATMOSPHERE",!o);e.needsUpdate=e.needsUpdate||a||l}}getCameraInfo(e,t,i=!1){if(i){const i=(new o.Matrix4).identity(),n=(new o.Matrix4).copy(e.matrixWorld).invert().transpose(),r=t.projectionMatrix,s=new o.Matrix4;s.multiplyMatrices(n,i),s.multiplyMatrices(r,s);const l=new a.Vector3;e.getWorldPosition(l);const c=new a.Vector3;return t.getWorldPosition(c),{modelViewProjection:s,eyePos:l,eyeHeight:c.distanceTo(l)}}{const i=e.matrixWorld,n=t.matrixWorldInverse,r=t.projectionMatrix,s=new o.Matrix4;s.multiplyMatrices(n,i),s.multiplyMatrices(r,s);const l=new a.Vector3;t.getWorldPosition(l);const c=new a.Vector3;e.getWorldPosition(c);const h=c.distanceTo(l);return l.sub(c),{modelViewProjection:s,eyePos:l,eyeHeight:h}}}}t.GroundAtmosphereMaterial=u},182:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionLineMaterial=t.HighPrecisionLineMaterial=void 0;const n=i(4125),r=i(5971),s=i(8333),o=i(6815),a=i(576),l=i(2141),c=i(7133);class h extends l.RawShaderMaterial{constructor(e){Object.assign(a.ShaderChunk,c.default);const t=e?{name:"HighPrecisionLineMaterial",vertexShader:"\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuseColor;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuseColor * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuseColor, opacity );\n    #endif\n}",uniforms:{diffuseColor:new n.Uniform(new r.Color(h.DEFAULT_COLOR)),opacity:new n.Uniform(h.DEFAULT_OPACITY),u_mvp:new n.Uniform(new s.Matrix4),u_eyepos:new n.Uniform(new o.Vector3),u_eyepos_lowpart:new n.Uniform(new o.Vector3)},rendererCapabilities:e.rendererCapabilities}:void 0;t&&Object.assign(t,e),super(t),this.type="HighPrecisionLineMaterial",this.isHighPrecisionLineMaterial=!0,e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity)),this.updateTransparencyFeature()}get color(){return this.uniforms.diffuseColor.value}set color(e){this.uniforms.diffuseColor.value.copy(e)}updateTransparencyFeature(){this.transparent=this.opacity<1}}t.HighPrecisionLineMaterial=h,h.DEFAULT_COLOR=80,h.DEFAULT_OPACITY=1,t.isHighPrecisionLineMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionLineMaterial}},872:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionPointMaterial=t.HighPrecisionPointMaterial=void 0;const n=i(4125),r=i(3905),s=i(5971),o=i(8955),a=i(8333),l=i(6815),c=i(576),h=i(394),u=i(7133);class d extends r.PointsMaterial{constructor(e){Object.assign(c.ShaderChunk,u.default),super(e),this.type="HighPrecisionPointMaterial",this.vertexShader="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}",this.fragmentShader=c.ShaderChunk.points_frag,this.fog=!1,this.uniforms={diffuseColor:new n.Uniform(new s.Color(d.DEFAULT_COLOR)),opacity:new n.Uniform(d.DEFAULT_OPACITY),size:new n.Uniform(d.DEFAULT_SIZE),scale:new n.Uniform(d.DEFAULT_SCALE),map:new n.Uniform(new h.Texture),uvTransform:new n.Uniform(new o.Matrix3),u_mvp:new n.Uniform(new a.Matrix4),u_eyepos:new n.Uniform(new l.Vector3),u_eyepos_lowpart:new n.Uniform(new l.Vector3)},this.isHighPrecisionPointMaterial=!0,void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity),void 0!==e.size&&(this.size=e.size),void 0!==e.scale&&(this.scale=e.scale),void 0!==e.uvTransform&&(this.uvTransform=e.uvTransform),void 0!==e.map&&(this.map=e.map))}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}get uvTransform(){return this.uniforms.uvTransform.value}set uvTransform(e){this.uniforms.uvTransform.value=e}}t.HighPrecisionPointMaterial=d,d.DEFAULT_COLOR=80,d.DEFAULT_OPACITY=1,d.DEFAULT_SIZE=1,d.DEFAULT_SCALE=1,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},9489:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconMaterial=void 0;const n=i(4125),r=i(2141);class s extends r.RawShaderMaterial{constructor(e){super(e?{name:"IconMaterial",vertexShader:"\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}",uniforms:{map:new n.Uniform(e.map)},depthTest:!1,depthWrite:!1,transparent:!0,vertexColors:!0,premultipliedAlpha:!0,rendererCapabilities:e.rendererCapabilities}:void 0)}get map(){return this.uniforms.map.value}}t.IconMaterial=s},3224:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAAMaterial=void 0;const n=i(6271),r=i(1498),s=i(4121);class o extends r.ShaderMaterial{constructor(e){super({uniforms:e,vertexShader:s.CopyShader.vertexShader,fragmentShader:s.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1})}}t.MSAAMaterial=o},4821:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshBasicMaterial=void 0;const n=i(977),r=i(4342),s=i(4744),o=i(8014),a=i(5033),l=i(8177),c=i(4258),h=i(8878),u=i(5997),d=i(674);class m extends n.MeshBasicMaterial{constructor(e){super(e),l.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),o.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.addDisplacementProperties(),this.applyDisplacementParameters(e),s.ColorCorrectionFeature.patchGlobalShaderChunks(),this.addColorCorrectionProperties(),this.applyColorCorrectionParameters(e)}clone(){return(new m).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.copyDisplacementParameters(e),this.copyColorCorrectionParameters(e),this}get fadeNear(){return l.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return l.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}set brightness(e){}get brightness(){return s.ColorCorrectionFeature.DEFAULT_BRIGHTNESS}set gamma(e){}get gamma(){return s.ColorCorrectionFeature.DEFAULT_GAMMA}get extrusionRatio(){return a.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get displacementMap(){return null}set displacementMap(e){}setDisplacementMap(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}addDisplacementProperties(){}copyColorCorrectionParameters(e){}applyDisplacementParameters(e){}copyDisplacementParameters(e){}addColorCorrectionProperties(){}applyColorCorrectionParameters(e){}}t.MapMeshBasicMaterial=m,(0,r.applyMixinsWithoutProperties)(m,[d.FadingFeatureMixin]),(0,r.applyMixinsWithoutProperties)(m,[u.ExtrusionFeatureMixin]),(0,r.applyMixinsWithoutProperties)(m,[h.DisplacementFeatureMixin]),(0,r.applyMixinsWithoutProperties)(m,[c.ColorCorrectionFeatureMixin])},8484:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshDepthMaterial=void 0;const n=i(4127),r=i(4342),s=i(8014),o=i(5033),a=i(5997);class l extends n.MeshDepthMaterial{constructor(e){super(e),s.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!1}))}get extrusionRatio(){return o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshDepthMaterial=l,(0,r.applyMixinsWithoutProperties)(l,[a.ExtrusionFeatureMixin])},4877:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshPhongMaterial=void 0;const n=i(4125),r=i(2149),s=i(4342),o=i(8014),a=i(5033),l=i(8177),c=i(71),h=i(5997),u=i(674),d=i(5089);class m extends r.MeshPhongMaterial{constructor(e){var t;super(e),l.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),o.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.m_colorIntensity=null!==(t=null==e?void 0:e.colorIntensity)&&void 0!==t?t:1,this.onBeforeCompile=(0,s.chainCallbacks)(this.onBeforeCompile,(e=>{(0,c.linkMixinWithShader)(this,e),e.fragmentShader=e.fragmentShader.replace("#include <lights_phong_pars_fragment>",`#include <lights_phong_pars_fragment>\n                ${d.blinnPhongNoSpecular}\n                `)})),(0,c.linkMixinWithMaterial)(this,this),(0,s.assert)(void 0!==this.shaderDefines),(0,s.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.colorIntensity=new n.Uniform(this.colorIntensity)}clone(){return(new m).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.colorIntensity=e.colorIntensity,this}get colorIntensity(){return this.m_colorIntensity}set colorIntensity(e){this.m_colorIntensity=e,this.shaderUniforms.colorIntensity.value=e}get fadeNear(){return l.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return l.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return a.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshPhongMaterial=m,(0,s.applyMixinsWithoutProperties)(m,[u.FadingFeatureMixin]),(0,s.applyMixinsWithoutProperties)(m,[h.ExtrusionFeatureMixin])},4067:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshStandardMaterial=void 0;const n=i(8282),r=i(576),s=i(4342),o=i(8014),a=i(5033),l=i(8177),c=i(5997),h=i(674),u=i(759);class d extends n.MeshStandardMaterial{constructor(e){super(e),l.FadingFeature.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),o.ExtrusionFeature.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),!0===(null==e?void 0:e.removeDiffuseLight)&&(this.onBeforeCompile=(0,s.chainCallbacks)(this.onBeforeCompile,(e=>{e.fragmentShader=r.ShaderChunk.meshphysical_frag.replace("#include <lights_physical_pars_fragment>",u.simpleLightingShadowChunk)})))}clone(){return(new d).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this}get fadeNear(){return l.FadingFeature.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return l.FadingFeature.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return a.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get removeDiffuseLight(){return!1}set removeDiffuseLight(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshStandardMaterial=d,(0,s.applyMixinsWithoutProperties)(d,[h.FadingFeatureMixin]),(0,s.applyMixinsWithoutProperties)(d,[c.ExtrusionFeatureMixin])},71:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.linkMixinWithShader=t.linkMixinWithMaterial=t.cameraToWorldDistance=void 0,t.cameraToWorldDistance=function(e,t){return e*t.maximum},t.linkMixinWithMaterial=function(e,t){void 0===t.defines&&(t.defines={}),e.shaderDefines=t.defines,void 0===e.shaderUniforms&&(e.shaderUniforms={})},t.linkMixinWithShader=function(e,t){Object.assign(t.uniforms,e.shaderUniforms),e.shaderUniforms=t.uniforms}},2141:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RawShaderMaterial=void 0;const n=i(6271),r=i(4085),s=i(4342),o=i(8578);class a extends r.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),i=e?Object.assign(Object.assign({},e),{glslVersion:t?n.GLSL3:n.GLSL1,vertexShader:t&&e.vertexShader?(0,s.convertVertexShaderToWebGL2)(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?(0,s.convertFragmentShaderToWebGL2)(e.fragmentShader):e.fragmentShader}):void 0;i&&delete i.rendererCapabilities,super(i),this.invalidateFog(),this.setOpacity(null==i?void 0:i.opacity)}invalidateFog(){void 0!==this.defines&&this.fog!==(0,o.getShaderMaterialDefine)(this,"USE_FOG")&&(0,o.setShaderMaterialDefine)(this,"USE_FOG",this.fog)}setOpacity(e){var t;void 0!==e&&(this.opacity=e,(null===(t=this.uniforms)||void 0===t?void 0:t.opacity)&&(this.uniforms.opacity.value=e))}}t.RawShaderMaterial=a},3298:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyAtmosphereMaterial=t.SkyAtmosphereShader=void 0;const n=i(6271),r=i(4125),s=i(5971),o=i(8333),a=i(6815),l=i(2141),c=i(1870),h=i(8578);t.SkyAtmosphereShader={uniforms:{u_eyePositionWorld:new r.Uniform(new a.Vector3),u_lightDirectionWorld:new r.Uniform(new a.Vector3(0,1,0)),u_modelViewProjection:new r.Uniform(new o.Matrix4),u_atmosphereEnv:new r.Uniform(new a.Vector3(6378137,6537590.425,0)),u_hsvCorrection:new r.Uniform(new a.Vector3(0,0,0)),topColor:new r.Uniform(new s.Color(30719)),bottomColor:new r.Uniform(new s.Color(16777215)),offset:new r.Uniform(33),exponent:new r.Uniform(.6),fogColor:new r.Uniform(new s.Color(30719)),fogNear:new r.Uniform(new s.Color(30719)),fogFar:new r.Uniform(new s.Color(16777215))},vertexShader:`\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km = 0.0015;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 15.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n        9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n        19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${c.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for sky.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE\n    //\n    AtmosphereColor computeSkyAtmosphere(vec3 v3Pos, vec3 vLightDir)\n    {\n        // Unpack attributes\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be const or define(s) at further optimization:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = (fScale / RayleighScaleDepth);\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n    #ifdef CAMERA_IN_SPACE\n\n        // Calculate the closest intersection of the ray with the outer\n        // atmosphere, this is the first point of the ray passing through the atmosphere dome.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n\n        float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n        float fStartDepth = exp(-1.0 / RayleighScaleDepth );\n        float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    #else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        float height = length(v3Start);\n        float depth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n        float fStartAngle = dot(v3Ray, v3Start) / height;\n        float fStartOffset = depth * scale(fStartAngle);\n\n    #endif\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i=0; i < nSamples; i++)\n        {\n            float height = length(v3SamplePoint);\n            float depth = exp(fScaleOverScaleDepth * (fInnerRadius - height));\n            float fLightAngle = dot(vLightDir, v3SamplePoint) / height;\n            float fCameraAngle = dot(v3Ray, v3SamplePoint) / height;\n            float fScatter = (fStartOffset + depth * (scale(fLightAngle) - scale(fCameraAngle)));\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (depth * fScaledLength);\n            v3SamplePoint += v3SampleRay;\n        }\n\n        // Scale the Mie and Rayleigh colors and set up output of the function\n        AtmosphereColor color;\n        color.mie = v3BaseColor * KmESun;\n        color.rayleigh = v3BaseColor * (InvWavelength * KrESun);\n        return color;\n    }\n\n    void main(void)\n    {\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeSkyAtmosphere(position.xyz, vLightDir);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n    // Because of harsh light distribution the exposure correction is always enabled for the sky.\n    #define CORRECT_EXPOSURE 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${c.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n            // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n            float fNightAlpha = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n            float fNightAlpha = 1.0;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        // NOTE:\n        // For better precision normalization may be added on fragment (for mobile devices)\n        // while in vertex shader may be left un-normalized\n        // dot(vLightDir, normalize(v_vertToCamera)) / length(v_vertToCamera);\n        float fCosAngle = dot(vLightDir, v_vertToCamera) / length(v_vertToCamera);\n        float fRayleighPhase = 0.75 * (1.0 + fCosAngle * fCosAngle);\n        float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCosAngle * fCosAngle) / pow(1.0 + g2 - 2.0 * g * fCosAngle, 1.5);\n\n        vec3 cRgb = fRayleighPhase * v_rayleighColor + fMiePhase * v_mieColor;\n\n        // Sky produces very harsh lighting effect so exposure correction is always enabled.\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Exposure factor may be exposed to uniform variable.\n        cRgb = correctExposure(cRgb, 2.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n        float fAtmosphereAlpha = clamp((fOuterRadius - fCameraHeight) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n        fAtmosphereAlpha *= pow(fNightAlpha, 0.5);\n\n        gl_FragColor = vec4(cRgb, mix(cRgb.b, 1.0, fAtmosphereAlpha));\n    }\n    `};class u extends l.RawShaderMaterial{constructor(e){let i;e&&(i={name:"SkyAtmosphereMaterial",vertexShader:t.SkyAtmosphereShader.vertexShader,fragmentShader:t.SkyAtmosphereShader.fragmentShader,uniforms:t.SkyAtmosphereShader.uniforms,transparent:!0,depthTest:!0,depthWrite:!1,side:n.BackSide,blending:n.NormalBlending,rendererCapabilities:e.rendererCapabilities}),super(i)}setDynamicLighting(e){(0,h.setShaderMaterialDefine)(this,"DYNAMIC_LIGHT",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,n){const r=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=r.eyePos,i=r.modelViewProjection,s=r.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=n.clone();const o=s>this.outerRadius,a=(0,h.setShaderDefine)(e.defines,"CAMERA_IN_SPACE",o),l=(0,h.setShaderDefine)(e.defines,"CAMERA_IN_ATMOSPHERE",!o);e.needsUpdate=e.needsUpdate||a||l}}getCameraInfo(e,t,i=!1){if(i){const i=(new o.Matrix4).identity(),n=(new o.Matrix4).copy(e.matrixWorld).invert().transpose(),r=t.projectionMatrix,s=new o.Matrix4;s.multiplyMatrices(n,i),s.multiplyMatrices(r,s);const l=new a.Vector3;e.getWorldPosition(l);const c=new a.Vector3;return t.getWorldPosition(c),{modelViewProjection:s,eyePos:l,eyeHeight:c.distanceTo(l)}}{const i=e.matrixWorld,n=t.matrixWorldInverse,r=t.projectionMatrix,s=new o.Matrix4;s.multiplyMatrices(n,i),s.multiplyMatrices(r,s);const l=new a.Vector3;t.getWorldPosition(l);const c=new a.Vector3;e.getWorldPosition(c);const h=c.distanceTo(l);return l.sub(c),{modelViewProjection:s,eyePos:l,eyeHeight:h}}}}t.SkyAtmosphereMaterial=u},9528:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMaterial=t.LineDashesModes=t.LineCapsModes=void 0;const n=i(6271),r=i(4125),s=i(5448),o=i(6577),a=i(6729),l=i(5143),c=i(394),h=i(1667),u=i(7610),d=i(8177),m=i(2141),p=i(8578);var f;!function(e){e[e.CAPS_NONE=0]="CAPS_NONE",e[e.CAPS_SQUARE=1]="CAPS_SQUARE",e[e.CAPS_ROUND=2]="CAPS_ROUND",e[e.CAPS_TRIANGLE_IN=3]="CAPS_TRIANGLE_IN",e[e.CAPS_TRIANGLE_OUT=4]="CAPS_TRIANGLE_OUT"}(f=t.LineCapsModes||(t.LineCapsModes={}));const g={butt:f.CAPS_NONE,square:f.CAPS_SQUARE,round:f.CAPS_ROUND},v=Object.keys(g).reduce(((e,t)=>{const i=t;return e[g[i]]=i,e}),{});var _;!function(e){e[e.DASHES_SQUARE=0]="DASHES_SQUARE",e[e.DASHES_ROUND=1]="DASHES_ROUND",e[e.DASHES_DIAMOND=2]="DASHES_DIAMOND"}(_=t.LineDashesModes||(t.LineDashesModes={}));const y={Square:_.DASHES_SQUARE,Round:_.DASHES_ROUND,Diamond:_.DASHES_DIAMOND},x=Object.keys(y).reduce(((e,t)=>{const i=t;return e[y[i]]=i,e}),{}),S=`\nprecision highp float;\nprecision highp int;\n\nuniform vec4 diffuseColor;\nuniform float opacity;\nuniform float extrusionWidth;\nuniform vec2 tileSize;\nuniform vec2 drawRange;\n\n#ifdef USE_DASH_IMAGE\n    uniform sampler2D dashImage;\n#endif\n\n#ifdef USE_DASHED_LINE\n    uniform vec4 dashPattern;\n    uniform vec4 dashColor;\n\n    #define DASHES_SQUARE ${_.DASHES_SQUARE}\n    #define DASHES_ROUND ${_.DASHES_ROUND}\n    #define DASHES_DIAMOND ${_.DASHES_DIAMOND}\n#endif\n\n#ifdef USE_TILE_CLIP\n    varying vec3 vPosition;\n#endif\n\nvarying vec3 vRange;\nvarying vec4 vCoords;\nvarying vec2 vAAGradient;\nvarying vec3 vExtrusionNormal;\n\n\nvarying vec3 vBarycentric;\nvarying float vWireframe;\nfloat edgeFactor() {\n    float lineWidth = 1.0;\n    vec3 d = fwidth(vBarycentric);\n    vec3 f = step(d * lineWidth, vBarycentric);\n    return min(min(f.x, f.y), f.z);\n}\n\n#ifdef USE_COLOR\n    varying vec3 vColor;\n#endif\n\n#define CAPS_NONE ${f.CAPS_NONE}\n#define CAPS_SQUARE ${f.CAPS_SQUARE}\n#define CAPS_ROUND ${f.CAPS_ROUND}\n#define CAPS_TRIANGLE_IN ${f.CAPS_TRIANGLE_IN}\n#define CAPS_TRIANGLE_OUT ${f.CAPS_TRIANGLE_OUT}\n\nfloat roundEdgesAndAddCaps(in vec4 coords, in vec3 range) {\n    // Compute the line's width to length ratio.\n    float widthRatio = range.y / range.x;\n\n    // Compute the inner segment distance (same for all cap mode).\n    float dist = abs(coords.y);\n    float segmentBeginMask = clamp(ceil(coords.z - coords.x), 0.0, 1.0);\n    float segmentEndMask = clamp(ceil(coords.x - coords.w), 0.0, 1.0);\n    dist = max(dist, segmentBeginMask * length(vec2((coords.x - coords.z) / widthRatio, coords.y)));\n    dist = max(dist, segmentEndMask * length(vec2((coords.x - coords.w) / widthRatio, coords.y)));\n\n    #if CAPS_MODE != CAPS_ROUND\n    // Compute the caps mask.\n    float capRangeMask = clamp(1.0 - ceil(range.z - drawRange.y), 0.0, 1.0);\n    float beginCapMask = clamp(ceil(drawRange.x - coords.x), 0.0, 1.0);\n    float endCapMask = clamp(ceil(coords.x - drawRange.y), 0.0, 1.0);\n    float capMask = capRangeMask * max(beginCapMask, endCapMask);\n\n    // Compute the outer segment distance (specific for each cap mode).\n    float capDist = max(coords.x - drawRange.y, drawRange.x - coords.x) / widthRatio;\n    #if CAPS_MODE == CAPS_NONE\n    dist = mix(dist, max(abs(coords.y), (capDist + 0.1) / 0.1), capMask);\n    #elif CAPS_MODE == CAPS_SQUARE\n    dist = mix(dist, max(abs(coords.y), capDist), capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_OUT\n    dist = mix(dist, abs(coords.y) + capDist, capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_IN\n    dist = mix(dist, max(abs(coords.y), (capDist - abs(coords.y)) + capDist), capMask);\n    #endif\n    #endif // CAPS_MODE != CAPS_ROUND\n\n    return dist;\n}\n\n#ifdef USE_TILE_CLIP\n    void tileClip(vec2 tilePos, vec2 tileSize) {\n        if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n            discard;\n        if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n            discard;\n    }\n#endif\n\n#ifdef USE_FADING\n    #include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\n#ifdef USE_DASHED_LINE\nvec4 computeDashedLineColor(float distToCenter) {\n    vec4 outputColor;\n\n    // Calculate distances for both dash patterns\n    float d1 = dashPattern.x / vRange.x;\n    float g1 = dashPattern.y / vRange.x;\n    #ifdef USE_SECOND_DASH\n        float d2 = dashPattern.z / vRange.x;\n        float g2 = dashPattern.w / vRange.x;\n\n        // Total length of one full pattern (dash1 + gap1 + dash2 + gap2)\n        float totalPatternLength = d1 + g1 + d2 + g2;\n    #else\n        // If only one dash size is used, total length is just dash1 and gap1\n        float totalPatternLength = d1 + g1;\n    #endif\n\n        // Compute the distance to the dash origin\n        float dashOrigDist = mod(vCoords.x, totalPatternLength);\n        // The resulting function is discontinuous at the start of a dash (dashOrigDist = 0), which causes a spike in the result\n        // of fwidth and artifacts in the interpolation. Transform it so that it reaches its maximum at the middle of a gap and\n        // goes down to 1.0 at the gap end.\n        // Determine the dash state based on the dashOrigDist\n        float dashEdgeDist = 0.0;\n        float gapCenter;\n        if (dashOrigDist <= (d1 + g1)) {\n            // In the first dash\n            gapCenter = 1.0 + 0.5 * g1 / d1; // Center of the gap\n            dashOrigDist = (gapCenter - abs(dashOrigDist - gapCenter)) / d1;\n            // Compute distance to dash edge (0.5: dashCenter, 0.0: dashEdge).\n            dashEdgeDist = 0.5 - abs(dashOrigDist - 0.5);\n    #ifdef USE_SECOND_DASH\n        } else if (dashOrigDist <= (totalPatternLength)) {\n            // In the second dash\n            gapCenter = 1.0 + 0.5 * g2 / d2;\n            dashOrigDist = (gapCenter - abs(dashOrigDist - (d1 + g1) - gapCenter)) / d2;\n            dashEdgeDist = 0.5 - abs((dashOrigDist ) - 0.5);\n    #endif\n        }\n\n    #if DASHES_MODE == DASHES_ROUND\n        dashEdgeDist = 0.5 - distance(vec2(distToCenter * 0.5, dashEdgeDist), vec2(0.0, 0.5));\n    #elif DASHES_MODE == DASHES_DIAMOND\n        dashEdgeDist -= distToCenter * 0.5;\n    #endif\n\n    // Blend dash and gap colors using hermitian interpolation (smoothstep) on the interval\n    // [-dashWidth, dashWidth], with 'dashWidth' being the sum of the slope of dashEdgeDist on x and y (fwidth).\n    // That means 'dashWidth' is the dashEdgeDist function delta across 1 pixel, and hence the interpolation interval\n    // is 2 pixels wide and centered on 0 (dash start).\n    float dashWidth = fwidth(dashEdgeDist);\n    float dashBlendFactor = smoothstep(-dashWidth, dashWidth, dashEdgeDist);\n\n    #ifdef USE_DASH_IMAGE\n        // Dash texture is mapped to the full dash size. Use dashOrigDist as u coordinate (parallel to line segment).\n        // For v coordinate (perpendicular to line), transform vCoords.y (0.0 at line center, +/-1 at edges)\n        // to make them 0 at one edge, 1 at the other and 0.5 at the line center:\n        vec2 texCoords = vec2(dashOrigDist, 0.5 + vCoords.y / 2.0);\n        float textureAlpha = texture2D(dashImage, texCoords).a;\n\n        // Pre-calculate the resulting color of the dash:\n        if (diffuseColor.a == 1.0) {\n            // diffuseColor is fully opaque, use simple mix function with dashColor's alpha as interpolation factor:\n            outputColor = mix(diffuseColor, vec4(dashColor.rgb, 1.0), dashColor.a);\n        } else {\n            // diffuseColor is not fully opaque, perform a custom alpha blending:\n\n            // Inverse transparency of dashColor:\n            float invDashAlpha = 1.0 - dashColor.a;\n\n            // Blend RGB channels based on alpha values:\n            outputColor.rgb = diffuseColor.rgb * diffuseColor.a * invDashAlpha + dashColor.rgb * dashColor.a;\n\n            // Compute final alpha by blending both alphas:\n            outputColor.a = diffuseColor.a * invDashAlpha + dashColor.a;\n\n            // If alpha is non-zero, normalize the RGB to account for premultiplied alpha:\n            if (outputColor.a != 0.0) {\n                outputColor.rgb /= outputColor.a;\n            }\n        }\n\n        // Final mix with textureAlpha and dashBlendFactor as interpolation factor:\n        // For a transparent dash color, the dash becomes invisible, and the base (diffuse) color is drawn instead.\n        outputColor = mix(diffuseColor, outputColor, textureAlpha * dashBlendFactor);\n    #else\n        // When a dash texture is not used, dash color's alpha is blended as the other channels with the base color. The base color\n        // won't be visible through transparent dashes. Instead, the resulting color depends on the material's blending configuration.\n        // (typically, materials drawn underneath will be visible).\n\n        // First alpha is interpolated.\n        outputColor.a = mix(diffuseColor.a, dashColor.a, dashBlendFactor);\n\n        // Then color channels are premultiplied with the alpha channels, interpolated and finally divided by the interpolated alpha.\n        // This keeps colors with low opacity from bleeding into the other color as the opacity increases.\n        outputColor.rgb = mix(diffuseColor.rgb * diffuseColor.a, dashColor.rgb * dashColor.a, dashBlendFactor) / outputColor.a;\n    #endif\n\n    return outputColor;\n}\n#endif\n\nvoid main() {\n    float alpha = opacity * diffuseColor.a;\n    vec4 outputDiffuse = diffuseColor;\n    vec3 baricentricColor = vec3(edgeFactor());\n    vec3 color = min(baricentricColor, gl_FragColor.rgb);\n\n    #ifdef USE_TILE_CLIP\n        tileClip(vPosition.xy, tileSize);\n    #endif\n\n    // Calculate distance to center (0.0: lineCenter, 1.0: lineEdge).\n    float distToCenter = roundEdgesAndAddCaps(vCoords, vRange);\n\n    float s = 0.0;\n    if (vAAGradient.x < vAAGradient.y) {\n        s = smoothstep(vAAGradient.x, vAAGradient.y, distToCenter);\n    }\n\n    // Drop the fully transparent pixel. It prevents writing to the stencil buffer.\n    // Without this discard we will see line cap overlaps on semi-transparent roads.\n    if (s == 1.0 && all(equal(color, baricentricColor)) == false) {\n        discard;\n    }\n\n    // Alpha channel in diffuseColor is applied later once it's interpolated with dash color's alpha.\n    alpha = opacity * (1.0 - s);\n\n    #ifdef USE_DASHED_LINE\n        outputDiffuse = computeDashedLineColor(distToCenter);\n    #endif\n\n    #ifdef USE_COLOR\n        outputDiffuse.rgb *= vColor;\n    #endif\n\n    // Removing 'alpha' seems fixing MAPSJS-2929\n    gl_FragColor = vec4( outputDiffuse.rgb, outputDiffuse.a * alpha );\n\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n        #include <fading_fragment>\n    #endif\n\n\n\n    if (vWireframe == 1.0) {\n        // Uncomment to see the wireframe only without fill color\n        // gl_FragColor.a = 0.;\n        if (all(equal(color, baricentricColor))) {\n            gl_FragColor = vec4(1.0, 0., 0., 1.0);\n        }\n    }\n}`;class b extends m.RawShaderMaterial{constructor(e){var t,i,m,g,v;d.FadingFeature.patchGlobalShaderChunks();const y={CAPS_MODE:f.CAPS_ROUND,DASHES_MODE:_.DASHES_SQUARE};let x,T,M=!0,w=1;e&&(M=!0===e.fog,M&&(0,p.setShaderDefine)(y,"USE_FOG",!0),w=void 0!==e.opacity?e.opacity:w,x=e.displacementMap,void 0!==x&&(0,p.setShaderDefine)(y,"USE_DISPLACEMENTMAP",!0),e["dash-image"]&&(0,p.setShaderDefine)(y,"USE_DASH_IMAGE",!0),T={name:"SolidLineMaterial",vertexShader:'\n#define SEGMENT_OFFSET 0.1\n// The minimum pixel distance prevents huge overscale values. This avoids very blurry lines in\n// extreme perspectives when multiplied with other variables and interpolated across a long line\n// segment that intersects the near plane. Clamping to this minimum distance also allows to always\n// apply the overscale and thus avoid sudden line width "jumps". See HARP-13527 for details.\n#define MIN_DISTANCE 0.1\n\n// over-extrusion width on each side (twice in total).\n#define OVER_EXTRUSION_WIDTH_PIXELS 1.0\n\nconst float PI = 3.14159265358979323846;\nconst float EPSILON = 0.00001;\n\nattribute vec3 extrusionCoord;\nattribute vec3 position;\nattribute vec4 biTangent;\nattribute vec3 tangent;\nattribute vec2 uv;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float extrusionWidth;\nuniform float offset;\nuniform vec2 drawRange;\nuniform vec2 canvasSize;\nuniform float wireframe;\n\n#ifdef USE_DISPLACEMENTMAP\n    uniform sampler2D displacementMap;\n#endif\n\n#ifdef USE_TILE_CLIP\n    varying vec3 vPosition;\n#endif\n\nvarying vec3 vRange;\nvarying vec4 vCoords;\nvarying vec2 vAAGradient;\n\nattribute vec3 barycentric;\nvarying vec3 vBarycentric;\nvarying float vWireframe;\n\n#ifdef USE_COLOR\n    attribute vec3 color;\n    varying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n    #include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n\nvec3 computeExtrusionDirWorld(in float extrusionWidth, in vec2 extrusionSign, in vec4 bitangent, in vec3 tangent) {\n    // Angle between this segment and the previous one.\n    float angle = bitangent.w;\n    vec3 bitangentComponent;\n\n    /**\n     * WEBSDK-226:\n     * The following logic is to deal with vertices (line join) connecting\n     * 2 legs that are coplanar and opposite in direction.\n     * In such cases the resulting biTangent is 0 so the extrusion is 0 on joins,\n     * causing the vertices to collpase into one.\n     *\n     * For start and end vertices => T0=T1 and angle = 0;\n     * For vertices on joins =>\n     *   T0 = leg preceding the vertex\n     *   T1 = leg following the vertex\n     *   angle = π when T0,T1 are coplanar with opposite direction.\n     *\n     * Examples:\n     *\n     *   T0 = [0,  1, 0]           T0 = [0, -1, 0]\n     *   T1 = [0, -1, 0]           T1 = [0,  1, 0]\n     *   angle = π                 angle = π\n     *    T0      T1                T0      T1\n     *     ▲       |                 |       ▲\n     *     |       ▼                 ▼       |\n     *\n     *\n     *   T0 = [1,  0, 0]           T0 = [-1,  0, 0]\n     *   T1 = [-1, 0, 0]           T1 = [1, 0, 0]\n     *   angle = π                 angle = π\n     *\n     *   T0  ----►                 T0  ◄----\n     *   T1  ◄----                 T1  ----►\n     *\n     */\n    if (abs(angle - PI) < EPSILON) {\n        // Set the angle to 0 as otherwise the cos(pi/2)=0 for the calculation of\n        // the bitangentComponent\n        angle = 0.0;\n\n        if (tangent.y == 0.) {\n          /**\n           * T0/T1  ----►\n           * T1/T0  ◄----\n           */\n          bitangent.y = 1.0;\n        } else {\n          /**\n           * T0/T1   T1/T0        T0/T1   T1/T0\n           *   ▲       |    or     / ◥     ◥ /\n           *   |       ▼          ◣ /     / ◣\n           */\n          bitangent.x = 1.0;\n        }\n    }\n\n    bitangentComponent = extrusionSign.y * extrusionWidth * bitangent.xyz / cos(angle / 2.0);\n\n    // Extrusion component on the tangent direction to cover line caps.\n    vec3 tangentComponent = extrusionSign.x * extrusionWidth * tangent;\n\n    // Add tangent component only if angle with previous segment is 0, which happens with vertices at line ends (where caps are needed)\n    // or in straight segments (where caps won\'t be visible).\n    return bitangentComponent + (1.0 - abs(sign(angle))) * tangentComponent;\n}\n\nvec2 computeExtrudedPosLocal(in float linePosition, in float extrusionWidth, in vec2 extrusionSign, in float tanHalfAngle) {\n    // For straight segments and line ends (angle and tanHalfAngle are 0), extrude position forwards (extrusionSign.x positive, for\n    // end caps) or backwards (extrusionSign.x negative, for start caps) by the extrusion width.\n    // For segments at an angle, position must be extruded further by a factor of extrusionSign.y*tanHalfAngle.\n    return vec2(linePosition + extrusionSign.x * extrusionWidth * (1.0 + abs(sign(tanHalfAngle)) * (extrusionSign.y * tanHalfAngle - 1.0)),\n                extrusionSign.y * extrusionWidth);\n}\n\nvec3 transformToScreen(vec3 worldPosition) {\n    vec4 clip = projectionMatrix * modelViewMatrix * vec4(worldPosition,1.0);\n    vec3 ndc = clip.xyz / clip.w;\n    vec3 screen = ndc * 0.5 + 0.5;\n    screen.xy *= canvasSize;\n    return screen;\n}\n\nvoid main() {\n    // Wireframe\n    vBarycentric = barycentric;\n    vWireframe = wireframe;\n\n    // Calculate the segment.\n    vec2 segment = abs(extrusionCoord.xy) - SEGMENT_OFFSET;\n    float segmentPos = sign(extrusionCoord.x) / 2.0 + 0.5;\n\n    // Calculate the vertex position inside the line (segment).\n    float linePos = mix(segment.x, segment.y, segmentPos);\n    vec2 extrusionSign = sign(extrusionCoord.xy);\n    // Precompute to avoid computing multiple times\n    float angle = biTangent.w;\n    float tanHalfAngle = tan(angle / 2.0);\n\n    // Handle the case where the angle is PI, in such case tan(PI/2) is undefined.\n    if (abs(angle - PI) < EPSILON) {\n        tanHalfAngle = 1.;\n    }\n\n    float extrusionFactor = extrusionSign.y * tanHalfAngle;\n\n    // Calculate the extrusion to be applied to the vertex position\n    vec3 extrusionDirWorld = computeExtrusionDirWorld(extrusionWidth, extrusionSign, biTangent, tangent);\n\n    vec3 extrudedPosWorld = position + extrusionDirWorld;\n    vec3 centerPosScreen = transformToScreen(position);\n    vec3 extrudedPosScreen = transformToScreen(extrudedPosWorld);\n    float distanceScreen = max(MIN_DISTANCE, distance(extrudedPosScreen.xy, centerPosScreen.xy));\n\n    float overscale = (distanceScreen + OVER_EXTRUSION_WIDTH_PIXELS) / distanceScreen;\n    extrusionDirWorld *= overscale;\n    extrudedPosWorld = position + extrusionDirWorld;\n\n\n    float totalExtrusionWidth = extrusionWidth*overscale;\n    float aaGradientHalfWidth = totalExtrusionWidth - extrusionWidth;\n    vAAGradient.x = max(0.0, (extrusionWidth - aaGradientHalfWidth)/ totalExtrusionWidth);\n    vAAGradient.y = 1.0;\n    vec2 extrudedPosLocal = computeExtrudedPosLocal(linePos, totalExtrusionWidth, extrusionSign, tanHalfAngle);\n\n    // Store the normalized extrusion coordinates in vCoords (with their ranges in vRange).\n    vRange = vec3(extrusionCoord.z, totalExtrusionWidth, extrusionFactor);\n    vCoords = vec4(extrudedPosLocal / vRange.xy, segment / vRange.x);\n\n    // Adjust the segment to fit the drawRange.\n    float capDist = totalExtrusionWidth / extrusionCoord.z;\n    if ((vCoords.w + capDist) < drawRange.x || (vCoords.z - capDist) > drawRange.y) {\n        vCoords.zw += 1.0;\n    }\n    if (vCoords.z < drawRange.x) {\n        vCoords.zw += vec2(drawRange.x - vCoords.z, 0.0);\n    }\n    if (vCoords.w > drawRange.y) {\n        vCoords.zw -= vec2(0.0, vCoords.w - drawRange.y);\n    }\n\n    // Transform position.\n    #ifdef USE_DISPLACEMENTMAP\n        extrudedPosWorld += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    // Shift the line based on the offset, where the bitangent is the cross product of the average\n    // of the two direction vectors (the previous and next segment directions) and the normal of\n    // the line (facing into the sky). The w component is the angle between the two segments.\n    // Note, we need to take the angle into consideration, so we use trigonometry to calculate how\n    // much we need to extend the offset. Note, orthough this looks complicated we are doing this\n    // in the vertex shader, so it should not cause a performance issue.\n    extrudedPosWorld += biTangent.xyz * offset * sqrt(1.0 + pow(abs(tanHalfAngle), 2.0));\n\n    vec4 mvPosition = modelViewMatrix * vec4(extrudedPosWorld, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Pass extruded position to fragment shader.\n    #ifdef USE_TILE_CLIP\n        vPosition = extrudedPosWorld;\n    #endif\n\n    #ifdef USE_COLOR\n        // Pass vertex color to fragment shader.\n        vColor = color;\n    #endif\n\n    #ifdef USE_FADING\n        #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}',fragmentShader:S,uniforms:l.UniformsUtils.merge([{diffuseColor:new r.Uniform(b.DEFAULT_COLOR.clone()),dashColor:new r.Uniform(b.DEFAULT_DASH_COLOR.clone()),extrusionWidth:new r.Uniform(b.DEFAULT_WIDTH),offset:new r.Uniform(b.DEFAULT_OFFSET),opacity:new r.Uniform(b.DEFAULT_OPACITY),tileSize:new r.Uniform(new s.Vector2),fadeNear:new r.Uniform(d.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new r.Uniform(d.FadingFeature.DEFAULT_FADE_FAR),displacementMap:new r.Uniform(void 0!==x?x:new c.Texture),drawRange:new r.Uniform(new s.Vector2(b.DEFAULT_DRAW_RANGE_START,b.DEFAULT_DRAW_RANGE_END)),dashPattern:new r.Uniform(null!==(t=e["dash-pattern"])&&void 0!==t?t:new o.Vector4),dashImage:new r.Uniform(null!==(i=e["dash-image"])&&void 0!==i?i:new c.Texture),canvasSize:new r.Uniform(new s.Vector2),wireframe:new r.Uniform(b.ENABLE_WIREFRAME?1:0)},a.UniformsLib.fog]),defines:y,opacity:w,rendererCapabilities:e.rendererCapabilities}),super(T),this.m_color=(new u.RGBA).fromVector(b.DEFAULT_COLOR),this.m_dashColor=(new u.RGBA).fromVector(b.DEFAULT_DASH_COLOR),this.fog=M,this.setOpacity(w),this.stencilFunc=n.NotEqualStencilFunc,this.stencilZPass=n.ReplaceStencilOp,this.stencilRef=1,this.stencilWrite=!1,(0,p.enforceBlending)(this),this.extensions.derivatives=!0,e&&(void 0!==e.color&&(this.color="number"==typeof e.color?h.ColorUtils.getRgbaFromHex(e.color):null!==(m=u.RGBA.parse(e.color))&&void 0!==m?m:this.m_color),void 0!==e.width&&(this.width=e.width),void 0!==e.opacity&&this.setOpacity(e.opacity),void 0!==e.depthTest&&(this.depthTest=e.depthTest),void 0!==e.depthWrite&&(this.depthWrite=e.depthWrite),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.cap&&(this.cap=e.cap),void 0!==e.drawRangeStart&&(this.drawRangeStart=e.drawRangeStart),void 0!==e.drawRangeEnd&&(this.drawRangeEnd=e.drawRangeEnd),void 0!==e.dashes&&(this.dashes=e.dashes),void 0!==e.dashColor&&(this.dashColor="number"==typeof e.dashColor?h.ColorUtils.getRgbaFromHex(e.dashColor):null!==(g=u.RGBA.parse(e.dashColor))&&void 0!==g?g:this.m_dashColor),void 0!==e["dash-pattern"]&&(this["dash-pattern"]=e["dash-pattern"]),void 0!==e.fog&&(this.fog=e.fog,this.invalidateFog()),this.offset=null!==(v=e.offset)&&void 0!==v?v:0)}set offset(e){this.uniforms.offset.value=e}get offset(){return this.uniforms.offset.value}setOpacity(e){super.setOpacity(e),void 0!==e&&this.updateStencil()}get color(){return this.m_color}set color(e){this.m_color.copy(e).toVector(this.uniforms.diffuseColor.value),this.updateStencil()}get dashColor(){return this.m_dashColor}set dashColor(e){this.m_dashColor.copy(e).toVector(this.uniforms.dashColor.value)}get width(){return 2*this.uniforms.extrusionWidth.value}set width(e){this.uniforms.extrusionWidth.value=e/2}get"dash-image"(){return this.uniforms.dashImage.value}set"dash-image"(e){this.uniforms.dashImage.value=e,(0,p.setShaderMaterialDefine)(this,"USE_DASH_IMAGE",!0)}get"dash-pattern"(){return this.uniforms.dashPattern.value}set"dash-pattern"(e){this.uniforms.dashPattern.value=e,e&&((0,p.setShaderMaterialDefine)(this,"USE_DASHED_LINE",e.x>0),(0,p.setShaderMaterialDefine)(this,"USE_SECOND_DASH",e.z>0))}get cap(){let e="round";const t=(0,p.getShaderMaterialDefine)(this,"CAPS_MODE");return"number"==typeof t&&v.hasOwnProperty(t)&&(e=v[t]),e}set cap(e){g.hasOwnProperty(e)&&(0,p.setShaderMaterialDefine)(this,"CAPS_MODE",g[e])}get dashes(){let e="Square";const t=(0,p.getShaderMaterialDefine)(this,"DASHES_MODE");return"number"==typeof t&&x.hasOwnProperty(t)&&(e=x[t]),e}set dashes(e){y.hasOwnProperty(e)&&(0,p.setShaderMaterialDefine)(this,"DASHES_MODE",y[e])}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value=e,(0,p.setShaderMaterialDefine)(this,"USE_FADING",e>0)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),(0,p.setShaderMaterialDefine)(this,"USE_DISPLACEMENTMAP",t)}get drawRangeStart(){return this.uniforms.drawRange.value.x}set drawRangeStart(e){this.uniforms.drawRange.value.x=e}get drawRangeEnd(){return this.uniforms.drawRange.value.y}set drawRangeEnd(e){this.uniforms.drawRange.value.y=e}set clipTileSize(e){this.uniforms.tileSize.value.copy(e);const t=e.x>0&&e.y>0;(0,p.setShaderMaterialDefine)(this,"USE_TILE_CLIP",t)}get clipTileSize(){return this.uniforms.tileSize.value}set canvasSize(e){this.uniforms.canvasSize.value.copy(e)}get canvasSize(){return this.uniforms.canvasSize.value}copy(e){return super.copy(e),this.invalidateFog(),this.setOpacity(e.opacity),this}updateStencil(){var e,t;this.stencilWrite=this.opacity*(null!==(t=null===(e=this.color)||void 0===e?void 0:e.a)&&void 0!==t?t:1)<.98}}t.SolidLineMaterial=b,b.DEFAULT_COLOR=new o.Vector4(1,0,0,1),b.DEFAULT_DASH_COLOR=new o.Vector4(1,0,0,0),b.DEFAULT_WIDTH=1,b.DEFAULT_OPACITY=1,b.DEFAULT_DRAW_RANGE_START=0,b.DEFAULT_DRAW_RANGE_END=1,b.DEFAULT_DASH_SIZE=1,b.DEFAULT_GAP_SIZE=1,b.DEFAULT_OFFSET=0,b.ENABLE_WIREFRAME=!1},8578:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShaderDefine=t.setShaderDefine=t.getShaderMaterialDefine=t.setShaderMaterialDefine=t.disableBlending=t.enableBlending=t.enforceBlending=t.insertShaderInclude=t.DEFINE_BOOL_FALSE=t.DEFINE_BOOL_TRUE=void 0;const n=i(6271),r=i(4342);function s(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=n.CustomBlending,!0===e.premultipliedAlpha?(e.blendSrc=n.OneFactor,e.blendDst=n.OneMinusSrcAlphaFactor,e.blendSrcAlpha=n.OneFactor,e.blendDstAlpha=n.OneMinusSrcAlphaFactor):(e.blendSrc=n.SrcAlphaFactor,e.blendDst=n.OneMinusSrcAlphaFactor,e.blendSrcAlpha=n.OneFactor,e.blendDstAlpha=n.OneMinusSrcAlphaFactor))}function o(e,t,i=!1){return void 0===e.defines?i:l(e.defines,t)}function a(e,i,n){let r=!1;return"number"==typeof n?(r=e[i]!==n,e[i]=n):!0===n?(r=e[i]!==t.DEFINE_BOOL_TRUE,e[i]=t.DEFINE_BOOL_TRUE):!1===n&&void 0!==e[i]&&(delete e[i],r=!0),r}function l(e,i){const n=e[i];return n!==t.DEFINE_BOOL_FALSE&&(n===t.DEFINE_BOOL_TRUE||n)}t.DEFINE_BOOL_TRUE="",t.DEFINE_BOOL_FALSE=void 0,t.insertShaderInclude=function(e,t,i,n){const r=!0===n?"\t":"";return e.replace(`#include <${t}>`,`#include <${t}>\n${r}#include <${i}>`)},t.enforceBlending=function(e){e.transparent||(s(e),e.forcedBlending=!0)},t.enableBlending=s,t.disableBlending=function(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=n.NormalBlending)},t.setShaderMaterialDefine=function(e,t,i){(0,r.assert)(void 0!==e.defines,"Do not use this function in ShaderMaterial derived c-tor.");const n=i!==o(e,t);return!!n&&(a(e.defines,t,i),e.needsUpdate=n,!0)},t.getShaderMaterialDefine=o,t.setShaderDefine=a,t.getShaderDefine=l},5562:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.needsCanvasSize=void 0,t.needsCanvasSize=function(e){return"canvasSize"in e}},4744:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasColorCorrectionFeature=t.ColorCorrectionFeature=void 0;const n=i(3334),r=i(576),s=i(4342),o=i(71),a=i(4030),l=i(8578);!function(e){function t(e){return void 0!==e.gamma||void 0!==e.brightness}e.DEFAULT_GAMMA=1,e.DEFAULT_BRIGHTNESS=1,e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===r.ShaderChunk.color_correction_parts_fragment&&Object.assign(r.ShaderChunk,a.default)},e.updateColorCorrectionFeature=function(i){(0,s.assert)(void 0!==i.shaderDefines),(0,s.assert)(void 0!==i.shaderUniforms);const r=t(i),o=(0,l.setShaderDefine)(i.shaderDefines,"USE_COLOR_CORRECTION",r);i.needsUpdate=o,(0,s.assert)(void 0!==i.shaderUniforms.u_gamma),(0,s.assert)(void 0!==i.shaderUniforms.u_brightness),r?(i.shaderUniforms.u_gamma.value=i.gamma>0?i.gamma:0,i.shaderUniforms.u_brightness.value=(0,n.clamp)(i.brightness,0,1)):o&&(i.shaderUniforms.u_gamma.value=e.DEFAULT_GAMMA,i.shaderUniforms.u_brightness.value=e.DEFAULT_BRIGHTNESS)},e.onBeforeCompile=function(e,i){t(e)&&((0,s.assert)(void 0!==e.shaderUniforms),(0,o.linkMixinWithShader)(e,i),i.fragmentShader=(0,l.insertShaderInclude)(i.fragmentShader,"common","color_correction_parts_fragment"),i.fragmentShader=(0,l.insertShaderInclude)(i.fragmentShader,"color_fragment","color_correction_fragment",!0))}}(t.ColorCorrectionFeature||(t.ColorCorrectionFeature={})),t.hasColorCorrectionFeature=function(e){return"brightness"in e&&"gamma"in e}},8583:(e,t)=>{"use strict";function i(e){return"displacementMap"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.setDisplacementMapToMaterial=t.hasDisplacementFeature=void 0,t.hasDisplacementFeature=i,t.setDisplacementMapToMaterial=function(e,t){i(t)&&t.displacementMap!==e&&(t.displacementMap=e,t.needsUpdate=!0,null!==t.displacementMap&&(t.displacementMap.needsUpdate=!0))}},8014:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeature=t.hasExtrusionFeature=void 0;const n=i(576),r=i(4342),s=i(71),o=i(4305),a=i(8578),l=i(5033);t.hasExtrusionFeature=function(e){return"extrusionRatio"in e},function(e){function t(e){return void 0!==e.extrusionRatio&&e.extrusionRatio>=l.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===n.ShaderChunk.extrusion_pars_vertex&&Object.assign(n.ShaderChunk,o.default)},e.updateExtrusionFeature=function(e){(0,r.assert)(void 0!==e.shaderDefines),(0,r.assert)(void 0!==e.shaderUniforms);const i=t(e),n=(0,a.setShaderDefine)(e.shaderDefines,"EXTRUSION_MATERIAL",i);e.needsUpdate=n,i?e.shaderUniforms.extrusionRatio.value=e.extrusionRatio:n&&(e.shaderUniforms.extrusionRatio.value=l.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX)},e.onBeforeCompile=function(e,i){t(e)&&((0,r.assert)(void 0!==e.shaderUniforms),(0,s.linkMixinWithShader)(e,i),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"common","extrusion_pars_vertex"),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"begin_vertex","extrusion_vertex",!0),i.fragmentShader=(0,a.insertShaderInclude)(i.fragmentShader,"fog_pars_fragment","extrusion_pars_fragment"),i.fragmentShader=i.fragmentShader.replace("#include <normal_fragment_begin>","#include <extrusion_normal_fragment_begin>"),i.fragmentShader=(0,a.insertShaderInclude)(i.fragmentShader,"fog_fragment","extrusion_fragment",!0))}}(t.ExtrusionFeature||(t.ExtrusionFeature={}))},5033:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeatureDefs=void 0,(i=t.ExtrusionFeatureDefs||(t.ExtrusionFeatureDefs={})).DEFAULT_RATIO_MIN=0,i.DEFAULT_RATIO_MAX=1,i.MIN_BUILDING_HEIGHT=.1},8177:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FadingFeature=void 0;const n=i(576),r=i(4342),s=i(71),o=i(3739),a=i(8578);!function(e){function t(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar&&e.fadeFar>0}e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.isEnabled=t,e.isDefined=function(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar},e.patchGlobalShaderChunks=function(){void 0===n.ShaderChunk.fading_pars_vertex&&Object.assign(n.ShaderChunk,o.default)},e.updateFadingFeature=function(i){(0,r.assert)(void 0!==i.shaderDefines),(0,r.assert)(void 0!==i.shaderUniforms);const n=t(i),s=(0,a.setShaderDefine)(i.shaderDefines,"FADING_MATERIAL",n);i.needsUpdate=s,(0,r.assert)(void 0!==i.shaderUniforms.fadeNear&&void 0!==i.shaderUniforms.fadeFar),n?(i.shaderUniforms.fadeNear.value=i.fadeNear,i.shaderUniforms.fadeFar.value=i.fadeFar,s&&(0,a.enableBlending)(i)):s&&(i.shaderUniforms.fadeNear.value=e.DEFAULT_FADE_NEAR,i.shaderUniforms.fadeFar.value=e.DEFAULT_FADE_FAR,(0,a.disableBlending)(i))},e.onBeforeCompile=function(e,i){t(e)&&((0,r.assert)(void 0!==e.shaderUniforms),(0,s.linkMixinWithShader)(e,i),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"fog_pars_vertex","fading_pars_vertex"),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"fog_vertex","fading_vertex",!0),i.fragmentShader=(0,a.insertShaderInclude)(i.fragmentShader,"fog_pars_fragment","fading_pars_fragment"),i.fragmentShader=(0,a.insertShaderInclude)(i.fragmentShader,"fog_fragment","fading_fragment",!0))},e.addRenderHelper=function(t,i,n,o,a,l){t.onBeforeRender=(0,r.chainCallbacks)(t.onBeforeRender,((t,r,a,c,h,u)=>{const d=h;d.fadeNear=void 0===n||n===e.DEFAULT_FADE_NEAR?e.DEFAULT_FADE_NEAR:(0,s.cameraToWorldDistance)(n,i),d.fadeFar=void 0===o||o===e.DEFAULT_FADE_FAR?e.DEFAULT_FADE_FAR:(0,s.cameraToWorldDistance)(o,i),void 0!==l&&l(t,h)}))}}(t.FadingFeature||(t.FadingFeature={}))},4258:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCorrectionFeatureMixin=void 0;const n=i(4342),r=i(9276),s=i(71),o=i(4125),a=i(4744);t.ColorCorrectionFeatureMixin=class{constructor(){this.m_brightness=a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS,this.m_gamma=a.ColorCorrectionFeature.DEFAULT_GAMMA}getBrightness(){return this.m_brightness}setBrightness(e){e!==this.m_brightness&&(this.m_brightness=e,a.ColorCorrectionFeature.updateColorCorrectionFeature(this))}getGamma(){return this.m_gamma}setGamma(e){e!==this.m_gamma&&(this.m_gamma=e,a.ColorCorrectionFeature.updateColorCorrectionFeature(this))}addColorCorrectionProperties(){Object.defineProperty(this,"brightness",{get:()=>this.getBrightness(),set:e=>{this.setBrightness(e)}}),Object.defineProperty(this,"gamma",{get:()=>this.getGamma(),set:e=>{this.setGamma(e)}})}applyColorCorrectionParameters(e){(0,s.linkMixinWithMaterial)(this,this),(0,n.assert)(void 0!==this.shaderDefines),(0,n.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.u_gamma=new o.Uniform(a.ColorCorrectionFeature.DEFAULT_GAMMA),this.shaderUniforms.u_brightness=new o.Uniform(a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS),void 0!==e&&(void 0!==e.brightness&&this.setBrightness(e.brightness),void 0!==e.gamma&&this.setGamma(e.gamma)),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{a.ColorCorrectionFeature.onBeforeCompile(this,e)})),this.needsUpdate=a.ColorCorrectionFeature.isEnabled(this)}copyColorCorrectionParameters(e){return this.setBrightness(void 0===e.brightness?a.ColorCorrectionFeature.DEFAULT_BRIGHTNESS:e.brightness),this.setGamma(void 0===e.gamma?a.ColorCorrectionFeature.DEFAULT_GAMMA:e.gamma),this}}},8878:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacementFeatureMixin=void 0;const n=i(4125),r=i(394),s=i(4342),o=i(71),a=i(8578),l=new r.Texture;var c;!function(e){function t(e){return null!==e.displacementMap}e.isEnabled=t,e.updateDisplacementFeature=function(e){(0,s.assert)(void 0!==e.shaderDefines),(0,s.assert)(void 0!==e.shaderUniforms);const i=t(e),n=(0,a.setShaderDefine)(e.shaderDefines,"USE_DISPLACEMENTMAP",i);if(e.needsUpdate=n,i){const t=e.displacementMap;t.needsUpdate=!0,e.shaderUniforms.displacementMap.value=t}else n&&(e.shaderUniforms.displacementMap.value=l)},e.onBeforeCompile=function(e,i){t(e)&&((0,s.assert)(void 0!==e.shaderUniforms),(0,o.linkMixinWithShader)(e,i),i.vertexShader=i.vertexShader.replace("#include <skinbase_vertex>","#include <skinbase_vertex>\n#ifndef USE_ENVMAP\n    vec3 objectNormal = vec3( normal );\n#endif"),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"uv2_pars_vertex","displacementmap_pars_vertex"),i.vertexShader=(0,a.insertShaderInclude)(i.vertexShader,"skinning_vertex","displacementmap_vertex",!0))}}(c||(c={})),t.DisplacementFeatureMixin=class{constructor(){this.m_displacementMap=null}get displacementMap(){return this.m_displacementMap}set displacementMap(e){this.setDisplacementMap(e)}getDisplacementMap(){return this.m_displacementMap}setDisplacementMap(e){e!==this.m_displacementMap&&(this.m_displacementMap=e,c.updateDisplacementFeature(this))}addDisplacementProperties(){Object.defineProperty(this,"displacementMap",{get:()=>this.getDisplacementMap(),set:e=>{this.setDisplacementMap(e)}})}applyDisplacementParameters(e){(0,o.linkMixinWithMaterial)(this,this),(0,s.assert)(void 0!==this.shaderDefines),(0,s.assert)(void 0!==this.shaderUniforms);const t=this.shaderUniforms;t.displacementMap=new n.Uniform(l),t.displacementScale=new n.Uniform(1),t.displacementBias=new n.Uniform(0),void 0!==e&&void 0!==e.displacementMap&&this.setDisplacementMap(e.displacementMap),this.onBeforeCompile=(0,s.chainCallbacks)(this.onBeforeCompile,(e=>{c.onBeforeCompile(this,e)})),this.needsUpdate=c.isEnabled(this)}copyDisplacementParameters(e){return this.setDisplacementMap(e.displacementMap),this}}},5997:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeatureMixin=void 0;const n=i(4125),r=i(4342),s=i(8014),o=i(5033),a=i(71);t.ExtrusionFeatureMixin=class{constructor(){this.m_extrusion=o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}getExtrusionRatio(){return this.m_extrusion}setExtrusionRatio(e){e!==this.m_extrusion&&(this.m_extrusion=e,s.ExtrusionFeature.updateExtrusionFeature(this))}addExtrusionProperties(){Object.defineProperty(this,"extrusionRatio",{get:()=>this.getExtrusionRatio(),set:e=>{this.setExtrusionRatio(e)}})}applyExtrusionParameters(e){(0,a.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms),e&&!0===e.zFightingWorkaround&&(this.shaderDefines.ZFIGHTING_WORKAROUND=""),this.shaderUniforms.extrusionRatio=new n.Uniform(o.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),void 0!==e&&void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{s.ExtrusionFeature.onBeforeCompile(this,e)})),this.needsUpdate=s.ExtrusionFeature.isEnabled(this)}copyExtrusionParameters(e){return void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this}}},674:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FadingFeatureMixin=void 0;const n=i(4125),r=i(4342),s=i(8177),o=i(71);t.FadingFeatureMixin=class{constructor(){this.m_fadeNear=s.FadingFeature.DEFAULT_FADE_NEAR,this.m_fadeFar=s.FadingFeature.DEFAULT_FADE_FAR}getFadeNear(){return this.m_fadeNear}setFadeNear(e){e!==this.m_fadeNear&&(this.m_fadeNear=e,s.FadingFeature.updateFadingFeature(this))}getFadeFar(){return this.m_fadeFar}setFadeFar(e){e!==this.m_fadeFar&&(this.m_fadeFar=e,s.FadingFeature.updateFadingFeature(this))}addFadingProperties(){Object.defineProperty(this,"fadeNear",{get:()=>this.getFadeNear(),set:e=>{this.setFadeNear(e)}}),Object.defineProperty(this,"fadeFar",{get:()=>this.getFadeFar(),set:e=>{this.setFadeFar(e)}})}applyFadingParameters(e){(0,o.linkMixinWithMaterial)(this,this),(0,r.assert)(void 0!==this.shaderDefines),(0,r.assert)(void 0!==this.shaderUniforms),this.shaderUniforms.fadeNear=new n.Uniform(s.FadingFeature.DEFAULT_FADE_NEAR),this.shaderUniforms.fadeFar=new n.Uniform(s.FadingFeature.DEFAULT_FADE_FAR),void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=(0,r.chainCallbacks)(this.onBeforeCompile,(e=>{s.FadingFeature.onBeforeCompile(this,e)})),this.needsUpdate=s.FadingFeature.isEnabled(this)}copyFadingParameters(e){return this.setFadeNear(void 0===e.fadeNear?s.FadingFeature.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?s.FadingFeature.DEFAULT_FADE_FAR:e.fadeFar),this}}},1870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={atmosphere_vertex_utils:"\n\n    const float RayleighScaleDepth = 0.25;\n\n    struct AtmosphereColor\n    {\n        vec3 mie;\n        vec3 rayleigh;\n    };\n\n    float scale(float cosAngle)\n    {\n        float x = 1.0 - cosAngle;\n        return RayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n    }\n\n    float getNearSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x0 (first point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        // To improve precision instead of simple projection: b = 2.0 * dot(vPos, v3Ray),\n        // we change the equation that gives better results especially around the poles.\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Intersection points distances are defined as follows:\n        // x0 = (-b - sqrt(det)) / 2*a ^ x1 = (-b + sqrt(det)) / 2*a\n        // we search for x0:\n        return 0.5 * (-fB - sqrt(fDet));\n    }\n\n    float getFarSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x1 (second point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Compute second intersection distance:\n        // x1 = (-b + sqrt(det)) / 2*a\n        return 0.5 * (-fB + sqrt(fDet));\n    }\n    ",atmosphere_fragment_utils:"\n\n    // Branch free RGB to HSV conversion.\n    // Based on article:\n    // http://lolengine.net/blog/2013/01/13/fast-rgb-to-hsv\n    // and optimized OpenGL SL algorithm\n    // http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl\n    vec3 rgb2Hsv(vec3 c)\n    {\n        const vec4 RGB_HSV_CONV = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        // Ternary operator may be used explicitly if compiler can use fast conditional move.\n        // vec4 p = c.g < c.b ? vec4(c.bg, RGB_HSV_CONV.wz) : vec4(c.gb, RGB_HSV_CONV.xy);\n        vec4 p = mix(vec4(c.bg, RGB_HSV_CONV.wz), vec4(c.gb, RGB_HSV_CONV.xy), step(c.b, c.g));\n        // vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    // Branch free HSV to RGB conversion\n    vec3 hsv2Rgb(vec3 c)\n    {\n        const vec4 HSV_RGB_CONV = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + HSV_RGB_CONV.xyz) * 6.0 - HSV_RGB_CONV.www);\n        return c.z * mix(HSV_RGB_CONV.xxx, clamp(p - HSV_RGB_CONV.xxx, 0.0, 1.0), c.y);\n    }\n\n    vec3 correctExposure(vec3 rgb, float exposure)\n    {\n        const vec3 fullColor = vec3(1.0);\n        return fullColor - exp(-exposure * rgb);\n    }\n\n    vec3 correctColor(vec3 rgb, vec3 hsvShift)\n    {\n        const float e = 0.0000001;\n        // Convert rgb color to hsv\n        vec3 hsv = rgb2Hsv(rgb);\n        // Shift hue value with angle wrapping\n        hsv.x = mod(hsv.x + hsvShift.x, 1.0);\n        // Shift and clamp saturation\n        hsv.y = clamp(hsv.y + hsvShift.y, 0.0, 1.0);\n        // Change value if it is significant (greater then epsilon)\n        hsv.z = hsv.z > e ? clamp(hsv.z + hsvShift.z, 0.0, 1.0) : 0.0;\n        // Convert shifted hsv back to rgb\n        return hsv2Rgb(hsv);\n    }\n    "}},5089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blinnPhongNoSpecular=void 0,t.blinnPhongNoSpecular="\nuniform float colorIntensity;\nvoid RE_Direct_BlinnPhong_NoSpecular( const in IncidentLight directLight,\n    const in GeometricContext geometry,\n    const in BlinnPhongMaterial material,\n    inout ReflectedLight reflectedLight ) {\n\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n    vec3 irradiance = dotNL * directLight.color;\n\n    reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor * colorIntensity);\n}\n#undef RE_Direct\n#define RE_Direct RE_Direct_BlinnPhong_NoSpecular\n"},4030:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={color_correction_parts_fragment:"\n        #ifdef USE_COLOR_CORRECTION\n            uniform float u_gamma;\n            uniform float u_brightness;\n        #endif\n    ",color_correction_fragment:"\n        #ifdef USE_COLOR_CORRECTION\n            diffuseColor = vec4( pow( diffuseColor.rgb, vec3( u_gamma ) ) * u_brightness, diffuseColor.a);\n        #endif\n    "}},4305:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5033),r=n.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT*n.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT;t.default={extrusion_pars_vertex:"\n// Add define so we can check for it in the outline effect (see Outline.ts).\n#define HAS_EXTRUSION_PARS_VERTEX\n// Extrusion axis (xyz: vector, w: factor).\nattribute vec4 extrusionAxis;\nuniform float extrusionRatio;\n#ifdef FLAT_SHADED\nvarying vec4 vExtrusionAxis;\n#endif\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#endif\n",extrusion_vertex:`\n#define HAS_EXTRUSION_VERTEX\n#ifdef ZFIGHTING_WORKAROUND\n// Cancel extrusionRatio (meaning, force to 1) if extrusionAxisLen < MIN_BUILDING_HEIGHT.\nconst float MIN_BUILDING_HEIGHT_SQUARED = ${r};\nfloat extrusionAxisLenSquared = dot(extrusionAxis.xyz, extrusionAxis.xyz);\nvExtrusionRatio = (extrusionAxisLenSquared < MIN_BUILDING_HEIGHT_SQUARED) ? 1.0 : extrusionRatio;\n#else\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ntransformed = transformed + extrusionAxis.xyz * (vExtrusionRatio - 1.0);\n#ifdef FLAT_SHADED\nvExtrusionAxis = vec4(normalMatrix * extrusionAxis.xyz, extrusionAxis.w);\n#endif\n`,extrusion_normal_fragment_begin:"\n#ifdef FLAT_SHADED\n    // Flattened this divergent path to prevent undefined behaviour in the following derivatives\n    // functions. For more info:\n    // http://www.aclockworkberry.com/shader-derivative-functions/#Derivatives_and_branches\n\n    // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n    vec3 fdx = vec3(dFdx(vViewPosition.x), dFdx(vViewPosition.y), dFdx(vViewPosition.z));\n    vec3 fdy = vec3(dFdy(vViewPosition.x), dFdy(vViewPosition.y), dFdy(vViewPosition.z));\n    vec3 normal = cross( fdx, fdy );\n    if (vExtrusionAxis.w > 0.999999) {\n        normal = vExtrusionAxis.xyz;\n    }\n    normal = normalize(normal);\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t#endif\n\t#endif\n#endif\n// non perturbed normal for clearcoat among others\nvec3 geometryNormal = normal;\n",extrusion_pars_fragment:"\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#else\nuniform float extrusionRatio;\n#endif\nvarying vec4 vExtrusionAxis;\n",extrusion_fragment:"\n#ifndef ZFIGHTING_WORKAROUND\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ngl_FragColor.a *= smoothstep( 0.0, 0.25, vExtrusionRatio );\n"}},3739:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fading_pars_vertex:"\nvarying float fadingDepth;\n",fading_vertex:"\nfadingDepth = -mvPosition.z;\n",fading_pars_fragment:"\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n",fading_fragment:'\n\n// lerp with "hard" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n'}},7133:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={high_precision_vert_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},759:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simpleLightingShadowChunk=void 0,t.simpleLightingShadowChunk="\n    struct PhysicalMaterial {\n        vec3\tdiffuseColor;\n        float\troughness;\n        float\tspecularF90;\n        vec3\tspecularColor;\n    };\n\n    #define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n    void RE_Direct_Physical( const in IncidentLight directLight,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n        // directLight.color is the light color * shadow, internally three.js uses a step function, so\n        // this value is either the light color or black. in order to lighten up the shadows, we\n        // take add 50% of the color to grey (to give us either pure white or grey) and multiply this to\n        // the material's diffuse color.\n        #if defined(USE_SHADOWMAP)\n            reflectedLight.directDiffuse = (0.5 * directLight.color +\n                vec3(0.5,0.5,0.5)) * material.diffuseColor;\n        #else\n            reflectedLight.directDiffuse = material.diffuseColor;\n        #endif\n    }\n\n    void RE_IndirectDiffuse_Physical( const in vec3 irradiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n            // Disable influence of indirect light (it is handled in the RE_Direct_Physical function)\n    }\n\n    void RE_IndirectSpecular_Physical( const in vec3 radiance,\n        const in vec3 irradiance,\n        const in vec3 clearcoatRadiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight) {\n            // Disable specular reflection of light.\n    }\n\n    #define RE_Direct               RE_Direct_Physical\n    #define RE_IndirectDiffuse      RE_IndirectDiffuse_Physical\n    #define RE_IndirectSpecular     RE_IndirectSpecular_Physical\n"},398:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LuminosityHighPassShader=void 0;const n=i(5971);t.LuminosityHighPassShader={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new n.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform vec3 defaultColor;\n    uniform float defaultOpacity;\n    uniform float luminosityThreshold;\n    uniform float smoothWidth;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        vec3 luma = vec3( 0.299, 0.587, 0.114 );\n        float v = dot( texel.xyz, luma );\n        vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n        float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n        gl_FragColor = mix( outputColor, texel, alpha );\n    }"}},4919:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SepiaShader=void 0,t.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float amount;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 color = texture2D( tDiffuse, vUv );\n            vec3 c = color.rgb;\n            color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n            color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n            color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n            gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n        }"}},5551:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VignetteShader=void 0,t.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float offset;\n        uniform float darkness;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 texel = texture2D( tDiffuse, vUv );\n            vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n            gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n        }"}},5823:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(6201),t),r(i(9785),t),r(i(1662),t),r(i(9843),t),r(i(3401),t),r(i(889),t),r(i(3461),t),r(i(1741),t),r(i(8533),t)},3401:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHorizontalOffset=t.TextCanvas=t.DEFAULT_TEXT_CANVAS_LAYER=void 0;const n=i(433),r=i(6815),s=i(6577),o=i(5808),a=i(9843),l=i(16),c=i(1662),h=i(5402),u=i(2516),d=i(3461),m=new r.Vector3,p={array:[new n.Box2],offset:0};let f=new Float32Array;t.DEFAULT_TEXT_CANVAS_LAYER=0;class g{constructor(e){this.m_renderer=e.renderer,this.m_fontCatalog=e.fontCatalog,this.minGlyphCount=e.minGlyphCount,this.maxGlyphCount=e.maxGlyphCount,this.name=e.name,void 0===e.material?(this.m_ownsMaterial=!0,this.m_material=(0,d.createSdfTextMaterial)({fontCatalog:e.fontCatalog,rendererCapabilities:this.m_renderer.capabilities})):(this.m_ownsMaterial=!1,this.m_material=e.material),void 0===e.backgroundMaterial?(this.m_ownsBgMaterial=!0,this.m_bgMaterial=(0,d.createSdfTextMaterial)({fontCatalog:e.fontCatalog,isBackground:!0,rendererCapabilities:this.m_renderer.capabilities})):(this.m_ownsBgMaterial=!1,this.m_bgMaterial=e.backgroundMaterial),this.m_defaultLayer={id:t.DEFAULT_TEXT_CANVAS_LAYER,storage:new l.TextGeometry(new o.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers=[this.m_defaultLayer],this.m_currentTextRenderStyle=(new c.TextRenderStyle).copy(g.defaultTextRenderStyle),this.m_currentTextLayoutStyle=(new c.TextLayoutStyle).copy(g.defaultTextLayoutStyle),this.m_lineTypesetter=new h.LineTypesetter,this.m_pathTypesetter=new u.PathTypesetter}get fontCatalog(){return this.m_fontCatalog}set fontCatalog(e){this.m_fontCatalog=e;const t=this.m_material;t.uniforms.sdfTexture.value=this.m_fontCatalog.texture,t.uniforms.sdfParams.value=new s.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),t.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0;const i=this.m_bgMaterial;i.uniforms.sdfTexture.value=this.m_fontCatalog.texture,i.uniforms.sdfParams.value=new s.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),i.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0}get material(){return this.m_material}set material(e){this.m_ownsMaterial&&(this.m_material.dispose(),this.m_ownsMaterial=!1),this.m_material=e;for(const e of this.m_layers)e.storage.mesh.material=this.m_material}get backgroundMaterial(){return this.m_bgMaterial}set backgroundMaterial(e){this.m_ownsBgMaterial&&(this.m_bgMaterial.dispose(),this.m_ownsBgMaterial=!1),this.m_bgMaterial=e;for(const e of this.m_layers)e.storage.backgroundMesh.material=this.m_bgMaterial}get textRenderStyle(){return this.m_currentTextRenderStyle}set textRenderStyle(e){this.m_currentTextRenderStyle.copy(e)}get textLayoutStyle(){return this.m_currentTextLayoutStyle}set textLayoutStyle(e){this.m_currentTextLayoutStyle.copy(e)}clear(){for(const e of this.m_layers)e.storage.clear();this.m_currentTextRenderStyle.copy(g.defaultTextRenderStyle),this.m_currentTextLayoutStyle.copy(g.defaultTextLayoutStyle)}render(e,t,i,n,r){this.m_fontCatalog.update(this.m_renderer);let s=null;void 0!==n&&(s=this.m_renderer.getRenderTarget(),this.m_renderer.setRenderTarget(n)),!0===r&&this.m_renderer.clear(!0);for(let n=0;n<this.m_layers.length;n++){const r=this.m_layers[n];if(r.id>=(null!=t?t:0)){if(!(void 0===i||r.id<i))break;r.storage.update(),this.m_renderer.render(r.storage.scene,e)}}void 0!==n&&this.m_renderer.setRenderTarget(s)}addLayer(e){let t=this.getLayer(e);return void 0===t&&(t={id:e,storage:new l.TextGeometry(new o.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers.push(t),this.m_layers.sort(((e,t)=>e.id-t.id))),t}getLayer(e){return this.m_layers.find((t=>t.id===e))}getAllLayers(){return this.m_layers}measureText(e,t,i){var n;let r,s,o,a;if(m.set(0,0,0),void 0!==i){if(r=i.path,s=i.pathOverflow,a=i.outputCharacterBounds,void 0!==i.path){const e=i.path.getPoint(0);if(null===e)return!1;m.set(e.x,e.y,0)}i.letterCaseArray&&(o=i.letterCaseArray)}return this.placeText({horizontalOffset:null!==(n=null==i?void 0:i.horizontalOffset)&&void 0!==n?n:0,input:e,layer:this.m_defaultLayer,textPath:r,textPathOverflow:s,bounds:t,individualBounds:a,letterCaseArray:o})}addText(e,t,i){let n,r,s;m.copy(t);let o=this.m_defaultLayer;if(void 0!==i){if(n=i.path,r=i.pathOverflow,void 0!==i.layer){let e=this.getLayer(i.layer);void 0===e&&(e=this.addLayer(i.layer)),o=e}void 0!==i.path&&m.set(0,0,m.z),i.letterCaseArray&&(s=i.letterCaseArray)}const a=o.storage.drawCount,l=this.placeText({input:e,textPath:n,textPathOverflow:r,layer:o,letterCaseArray:s,horizontalOffset:v(null==i?void 0:i.pickingData)});return l&&void 0!==i?(!0===i.updatePosition&&t.copy(m),void 0!==i.pickingData&&o.storage.addPickingData(a,o.storage.drawCount,i.pickingData)):l||(o.storage.m_drawCount=a),l}createTextBufferObject(e,t){let i,r;m.set(0,0,0);const s=this.m_currentTextRenderStyle.fontVariant===c.FontVariant.SmallCaps;if("string"!=typeof e)i=e,void 0!==t&&t.letterCaseArray&&(r=t.letterCaseArray);else if(r=[],i=this.m_fontCatalog.getGlyphs(e,this.m_currentTextRenderStyle,s?r:void 0),void 0===i)return;let o,l,h,u,d,p;return void 0!==t&&(o=t.path,l=t.pathOverflow,!0===t.outputBounds&&(h=new n.Box2),!0===t.outputCharacterBounds&&(u=[]),!0===t.storeStyles&&(d=this.m_currentTextRenderStyle.clone(),p=this.m_currentTextLayoutStyle.clone())),this.placeText({input:e,layer:this.m_defaultLayer,computeTextBuffer:!0,textPath:o,textPathOverflow:l,bounds:h,individualBounds:u,letterCaseArray:r}),new a.TextBufferObject(i,new Float32Array(f),h,u,d,p)}addTextBufferObject(e,t){var i;let n,r,s,o,a,l,c,h=this.m_defaultLayer;if(void 0!==t){if(void 0!==t.layer){let e=this.getLayer(t.layer);void 0===e&&(e=this.addLayer(t.layer)),h=e}n=null===(i=t.position)||void 0===i?void 0:i.clone(),r=t.scale,s=t.rotation,o=t.color,a=t.opacity,l=t.backgroundColor,c=t.backgroundOpacity}const u=h.storage.drawCount,d=h.storage.addTextBufferObject(e,n,r,s,o,a,l,c);return d&&void 0!==t?void 0!==t.pickingData&&h.storage.addPickingData(u,h.storage.drawCount,t.pickingData):d||(h.storage.m_drawCount=u),d}pickText(e,t){for(const i of this.m_layers)i.storage.pick(e,t)}getMemoryUsage(e){this.m_fontCatalog.updateMemoryUsage(e);for(const t of this.m_layers)t.storage.updateMemoryUsage(e)}placeText(e){if(0===e.input.length||0===this.m_currentTextLayoutStyle.maxLines)return void 0!==e.bounds&&(e.bounds.min.set(0,0),e.bounds.max.set(0,0)),void 0!==e.individualBounds&&(e.individualBounds.length=0),!0;let t,i;const n=this.m_currentTextRenderStyle.fontVariant===c.FontVariant.SmallCaps;if("string"!=typeof e.input)t=e.input,e.letterCaseArray&&(i=e.letterCaseArray);else if(i=[],t=this.m_fontCatalog.getGlyphs(e.input,this.m_currentTextRenderStyle,n?i:void 0),void 0===t)return!1;let r;void 0!==e.individualBounds&&(p.array=e.individualBounds,p.offset=0,r=p),void 0!==e.bounds&&(e.bounds.min.set(1/0,1/0),e.bounds.max.set(-1/0,-1/0)),!0===e.computeTextBuffer&&(f=new Float32Array(t.length*l.QUAD_VERTEX_MEMORY_FOOTPRINT));const s=void 0!==e.textPath,o={glyphs:t,fontCatalog:this.m_fontCatalog,textRenderStyle:this.m_currentTextRenderStyle,textLayoutStyle:this.m_currentTextLayoutStyle,position:m,geometry:e.layer.storage,smallCapsArray:n?i:void 0,globalBounds:e.bounds,individualBounds:r,vertexBuffer:!0===e.computeTextBuffer?f:void 0};let a=!0;return s?(Object.assign(o,{path:e.textPath,pathOverflow:!0===e.textPathOverflow,horizontalOffset:e.horizontalOffset}),a=this.m_pathTypesetter.arrangeGlyphs(o)):a=this.m_lineTypesetter.arrangeGlyphs(o),void 0!==r&&(r.array.length=r.offset),a}}function v(e){if(void 0===(null==e?void 0:e.userData))return 0;const{logical_offset:t,num_lines:i}=e.userData;if(void 0===t||void 0===i)return 0;if(1===i)return 0;const n=t/(i-1)*.5;return e.layoutStyle.horizontalAlignment/2+n||0}t.TextCanvas=g,g.defaultTextRenderStyle=new c.TextRenderStyle,g.defaultTextLayoutStyle=new c.TextLayoutStyle,t.getHorizontalOffset=v},6201:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FontCatalog=void 0;const n=i(6271),r=i(642),s=i(8533),o=i(9785),a=i(2090),l=i(1662),c="_BoldAssets/",h="_ItalicAssets/";class u{static async load(e,t,i){const r=new URL(e,window.location.href),s=await u.loadJSON(r.href,i),a=new URL(`${s.name}_Assets/Extra/`,r),l=await u.loadJSON(a.href+"Specials.json",i),c=await u.loadTexture(a.href+"Specials.png",i);c.wrapS=n.ClampToEdgeWrapping,c.wrapT=n.ClampToEdgeWrapping,c.minFilter=n.NearestFilter,c.needsUpdate=!0;const h=s.fonts.find((e=>"Extra"===e.name)),d=new o.GlyphData(65533,"Specials",l.chars[0].width,l.chars[0].height,l.chars[0].xadvance,l.chars[0].xoffset,l.chars[0].yoffset,0,0,1,1,c,h,!0);return new u(r.href,s.name,s.type,s.size,s.maxWidth,s.maxHeight,s.distanceRange,s.fonts,s.supportedBlocks,t,d)}static async loadTexture(e,t){let i;return await new Promise(((n,s)=>{i=()=>{s(t.reason)},null==t||t.addEventListener("abort",i),(new r.TextureLoader).load(e,n)})).finally((()=>{null==t||t.removeEventListener("abort",i)}))}static async loadJSON(e,t){const i=await fetch(e,{signal:t});if(!i.ok)throw new Error(`${e} Status Text:  ${i.statusText}`);const n=await i.text();return JSON.parse(n)}constructor(e,t,i,n,r,s,o,l,c,h,u){this.url=e,this.name=t,this.type=i,this.size=n,this.maxWidth=r,this.maxHeight=s,this.distanceRange=o,this.fonts=l,this.unicodeBlocks=c,this.maxCodePointCount=h,this.m_replacementGlyph=u,this.showReplacementGlyphs=!1,this.m_baseUrl=e.substring(0,e.lastIndexOf("/")),this.m_glyphTextureCache=new a.GlyphTextureCache(h,this.maxWidth+1,this.maxHeight+1),this.m_loadingJson=new Map,this.m_loadingPages=new Map,this.m_loadingGlyphs=new Map,this.m_loadedJson=new Map,this.m_loadedPages=new Map,this.m_loadedGlyphs=new Map}dispose(){this.fonts.length=0,this.unicodeBlocks.length=0,this.m_glyphTextureCache.dispose(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}clear(){this.m_glyphTextureCache.clear(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}update(e){this.m_glyphTextureCache.update(e)}get texture(){return this.m_glyphTextureCache.texture}get textureSize(){return this.m_glyphTextureCache.textureSize}get isLoading(){return this.m_loadingJson.size>0||this.m_loadingPages.size>0||this.m_loadingGlyphs.size>0}async loadBlock(e,t,i,n){const r=this.getAssetsPath(i,t),s=`${r}/${e.name.replace(/ /g,"_")}.json`;let o=this.m_loadedJson.get(s);if(void 0===o){let e=this.m_loadingJson.get(s);if(void 0===e)try{e=u.loadJSON(s),this.m_loadingJson.set(s,e),o=await e,this.m_loadingJson.delete(s),this.m_loadedJson.set(s,o)}catch(e){console.error(e),this.m_loadingJson.delete(s)}else o=await e}const a=[];if(!0===n)for(const e of o.pages)a.push(this.loadPage(`${r}/${e}`));return await Promise.all(a),o}removeBlock(e,t,i){const n=this.getAssetsPath(i,t),r=`${n}/${e.name.replace(/ /g,"_")}.json`,s=this.m_loadedJson.get(r);if(void 0!==s){for(const e of s.pages){const t=`${n}/${e}`;this.m_loadingPages.delete(t),this.m_loadedPages.delete(t)}this.m_loadingJson.delete(r),this.m_loadedJson.delete(r)}}async loadCharset(e,t){const i=t.fontName,n=t.fontStyle,r=(t.fontVariant===l.FontVariant.AllCaps||t.fontVariant===l.FontVariant.SmallCaps?e.toUpperCase():e).replace(/[\s\S](?=([\s\S]+))/g,((e,t)=>t.indexOf(e)+1?"":e)),s=[];for(const e of r){const t=e.codePointAt(0),r=this.getFont(t,i),o=`${r.name}_${n}`,a=`${o}_${t}`;let l=this.m_loadedGlyphs.get(o);void 0===l&&(l=new Map,this.m_loadedGlyphs.set(o,l));const c=l.get(t);if(void 0===c){let i=this.m_loadingGlyphs.get(a);if(void 0===i){if(!r.charset.includes(String.fromCodePoint(t))){const i=this.createReplacementGlyph(t,e,r);l.set(t,i),this.m_glyphTextureCache.add(a,i);continue}let s;for(const e of this.unicodeBlocks)if(t>=e.min&&t<=e.max){s=e;break}i=this.loadAssets(t,n,s,r),this.m_loadingGlyphs.set(a,i),i.then((e=>{this.m_loadingGlyphs.delete(a),l.set(t,e),this.m_glyphTextureCache.add(a,e)}))}s.push(i)}else this.m_glyphTextureCache.has(a)||(s.push(Promise.resolve(c)),this.m_glyphTextureCache.add(a,c))}return Promise.all(s)}getGlyph(e,t,i){const n=this.m_loadedGlyphs.get(`${t.name}_${i}`);if(void 0!==n)return n.get(e)}getGlyphs(e,t,i){const n=[],r=t.fontName,s=t.fontStyle,o=t.fontVariant,a=o===l.FontVariant.AllCaps||o===l.FontVariant.SmallCaps;for(const t of e){const e=a?t.toUpperCase():t;for(const o of e){const e=o.codePointAt(0),a=this.getFont(e,r),l=this.getGlyph(e,a,s);if(void 0===l||l.isReplacement&&!this.showReplacementGlyphs)return;n.push(l),void 0!==i&&i.push(o!==t)}}return n}getFont(e,t){var i,n;let r=this.fonts[0].name;for(const s of this.unicodeBlocks)if(e>=s.min&&e<=s.max){const e=null!==(i=null==t?void 0:t.split("; "))&&void 0!==i?i:[];r=null!==(n=e.find((e=>{var t;return e&&(null===(t=s.fonts)||void 0===t?void 0:t.includes(e))})))&&void 0!==n?n:s.fonts[0];break}return this.fonts.find((e=>e.name===r))}updateMemoryUsage(e){let t=0;for(const e of this.unicodeBlocks)t+=2*(e.max-e.min);let i=this.m_glyphTextureCache.textureSize.x*this.m_glyphTextureCache.textureSize.y*4;for(const e in this.m_loadedPages.entries)if(void 0!==this.m_loadedPages.get(e)){const t=this.m_loadedPages.get(e);void 0!==t&&(i+=t.image.width*t.image.height*4)}e.heapSize+=t+i,e.gpuSize+=i}createReplacementGlyph(e,t,i){const n=this.m_replacementGlyph.clone();return n.codePoint=e,n.character=t,n.font=i,n.isReplacement=s.UnicodeUtils.isPrintable(e),n}async loadAssets(e,t,i,n){const r=await this.loadBlock(i,n,t);if(void 0===r)return this.m_replacementGlyph;const s=r.chars.find((t=>t.id===e)),a=`${this.getAssetsPath(t,n)}/${r.pages[s.page]}`,l=await this.loadPage(a);return new o.GlyphData(s.id,i.name,s.width,s.height,s.xadvance,s.xoffset,s.yoffset,s.x/l.image.width,1-(s.y+s.height)/l.image.height,(s.x+s.width)/l.image.width,1-s.y/l.image.height,l,n)}async loadPage(e){let t=this.m_loadedPages.get(e);if(void 0===t){let i=this.m_loadingPages.get(e);void 0===i?(i=u.loadTexture(e),this.m_loadingPages.set(e,i),t=await i,t.wrapS=n.ClampToEdgeWrapping,t.wrapT=n.ClampToEdgeWrapping,t.minFilter=n.NearestFilter,t.needsUpdate=!0,this.m_loadingPages.delete(e)&&this.m_loadedPages.set(e,t),this.m_loadingPages.delete(e)):t=await i}return t}getAssetsPath(e,t){let i="_Assets/";switch(e){case l.FontStyle.Bold:void 0!==t.bold&&(i=c);break;case l.FontStyle.Italic:void 0!==t.italic&&(i=h);break;case l.FontStyle.BoldItalic:void 0!==t.boldItalic?i="_BoldItalicAssets/":void 0!==t.italic?i=h:void 0!==t.bold&&(i=c)}return`${this.m_baseUrl}/${this.name}${i}${t.name}`}}t.FontCatalog=u},9785:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphData=void 0;const n=i(6815),r=i(5448),s=i(8533);class o{constructor(e,t,i,o,a,l,c,h,u,d,m,p,f,g=!1){this.codePoint=e,this.block=t,this.width=i,this.height=o,this.advanceX=a,this.offsetX=l,this.offsetY=c,this.texture=p,this.font=f,this.isReplacement=g,this.positions=[],this.sourceTextureCoordinates=[],this.dynamicTextureCoordinates=[],this.copyIndex=0,this.isInCache=!1,this.character=String.fromCodePoint(e),this.direction=s.UnicodeUtils.getDirection(e,t);const v=this.offsetX,_=v+this.width,y=f.metrics.lineHeight-this.offsetY,x=y-this.height;this.positions.push(new n.Vector3(v,x,1),new n.Vector3(_,x,1),new n.Vector3(v,y,1),new n.Vector3(_,y,1)),this.sourceTextureCoordinates.push(new r.Vector2(h,u),new r.Vector2(d,u),new r.Vector2(h,m),new r.Vector2(d,m)),this.dynamicTextureCoordinates.push(new r.Vector2(0,0),new r.Vector2(1,0),new r.Vector2(0,1),new r.Vector2(1,1))}clone(){return new o(this.codePoint,this.block,this.width,this.height,this.advanceX,this.offsetX,this.offsetY,this.sourceTextureCoordinates[0].x,this.sourceTextureCoordinates[0].y,this.sourceTextureCoordinates[3].x,this.sourceTextureCoordinates[3].y,this.texture,this.font,this.isReplacement)}}t.GlyphData=o},2090:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphTextureCache=void 0;const n=i(5381),r=i(9896),s=i(6271),o=i(9365),a=i(3148),l=i(9044),c=i(6280),h=i(8955),u=i(5448),d=i(5269),m=i(5117),p=i(5808),f=i(394),g=i(8263),v=i(9785),_=i(4420),y=4096;t.GlyphTextureCache=class{constructor(e,t,i){this.capacity=e,this.entryWidth=t,this.entryHeight=i;const f=Math.floor(Math.sqrt(e));this.m_cacheHeight=f*f<e?f+1:f,this.m_cacheWidth=f*this.m_cacheHeight<e?f+1:f,this.m_textureSize=new u.Vector2(this.m_cacheWidth*t,this.m_cacheHeight*i),(this.m_textureSize.y>y||this.m_textureSize.x>y)&&console.warn("GlyphTextureCache texture size ("+this.m_textureSize.x+", "+this.m_textureSize.y+") exceeds WebGL's widely supported MAX_TEXTURE_SIZE ("+y+").\nThis could result in rendering errors on some devices.\nPlease consider reducing its capacity or input assets size."),this.m_entryCache=new g.LRUCache(e),this.initCacheEntries(),this.m_scene=new p.Scene,this.m_camera=new r.OrthographicCamera(0,this.m_textureSize.x,this.m_textureSize.y,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new m.WebGLRenderTarget(this.m_textureSize.x,this.m_textureSize.y,{wrapS:s.ClampToEdgeWrapping,wrapT:s.ClampToEdgeWrapping,depthBuffer:!1,stencilBuffer:!1}),this.m_copyTextureSet=new Set,this.m_copyTransform=new h.Matrix3,this.m_copyPositions=[],this.m_copyPositions.push(new u.Vector2,new u.Vector2,new u.Vector2,new u.Vector2),this.m_copyVertexBuffer=new l.InterleavedBuffer(new Float32Array(20*e),5),this.m_copyVertexBuffer.setUsage(s.DynamicDrawUsage),this.m_copyPositionAttribute=new c.InterleavedBufferAttribute(this.m_copyVertexBuffer,3,0),this.m_copyUVAttribute=new c.InterleavedBufferAttribute(this.m_copyVertexBuffer,2,3),this.m_copyGeometry=new a.BufferGeometry,this.m_copyGeometry.setAttribute("position",this.m_copyPositionAttribute),this.m_copyGeometry.setAttribute("uv",this.m_copyUVAttribute);const v=new o.BufferAttribute(new Uint32Array(6*e),1);v.setUsage(s.DynamicDrawUsage),this.m_copyGeometry.setIndex(v),this.m_copyMesh=new d.Mesh(this.m_copyGeometry),this.m_copyMesh.frustumCulled=!1,this.m_copyGeometryDrawCount=0,this.m_clearPositionAttribute=new o.BufferAttribute(new Float32Array(8*e),2),this.m_clearPositionAttribute.setUsage(s.DynamicDrawUsage),this.m_clearGeometry=new a.BufferGeometry,this.m_clearGeometry.setAttribute("position",this.m_clearPositionAttribute);const _=new o.BufferAttribute(new Uint32Array(6*e),1);_.setUsage(s.DynamicDrawUsage),this.m_clearGeometry.setIndex(_),this.m_clearGeometry.boundingSphere=new n.Sphere,this.m_clearMesh=new d.Mesh(this.m_clearGeometry),this.m_clearMesh.frustumCulled=!1,this.m_clearGeometryDrawCount=0,this.m_scene.add(this.m_clearMesh,this.m_copyMesh)}dispose(){var e,t;this.m_entryCache.clear(),this.m_scene.remove(this.m_clearMesh,this.m_copyMesh),this.m_rt.dispose(),null===(e=this.m_clearMaterial)||void 0===e||e.dispose(),null===(t=this.m_copyMaterial)||void 0===t||t.dispose(),this.m_copyTextureSet.clear(),this.m_clearGeometry.dispose(),this.m_copyGeometry.dispose()}get texture(){return this.m_rt.texture}get textureSize(){return this.m_textureSize}add(e,t){if(void 0!==this.m_entryCache.get(e))return;const i=this.m_entryCache.oldest;if(null===i)throw new Error("GlyphTextureCache is uninitialized!");this.clearCacheEntry(i.value),this.copyGlyphToCache(e,t,i.value.location)}has(e){return this.m_entryCache.has(e)}get(e){return this.m_entryCache.get(e)}clear(){this.m_copyGeometryDrawCount=0,this.m_clearGeometryDrawCount=0,this.m_entryCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()}update(e){let t=null;const i=this.m_clearGeometryDrawCount>0,n=this.m_copyGeometryDrawCount>0;if((i||n)&&(t=e.getRenderTarget(),e.setRenderTarget(this.m_rt)),i){if(this.m_clearMaterial||(this.m_clearMaterial=new _.GlyphClearMaterial({rendererCapabilities:e.capabilities}),this.m_clearMesh.material=this.m_clearMaterial),null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearPositionAttribute.needsUpdate=!0,this.m_clearPositionAttribute.updateRange.offset=0,this.m_clearPositionAttribute.updateRange.count=8*this.m_clearGeometryDrawCount,this.m_clearGeometry.index.needsUpdate=!0,this.m_clearGeometry.index.updateRange.offset=0,this.m_clearGeometry.index.updateRange.count=6*this.m_clearGeometryDrawCount,this.m_clearGeometry.setDrawRange(0,6*this.m_clearGeometryDrawCount),this.m_clearMesh.visible=!0,this.m_copyMesh.visible=!1,e.render(this.m_scene,this.m_camera),this.m_clearGeometryDrawCount=0,this.m_clearMesh.visible=!1}if(n){if(this.m_copyMaterial||(this.m_copyMaterial=new _.GlyphCopyMaterial({rendererCapabilities:e.capabilities}),this.m_copyMesh.material=this.m_copyMaterial),null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyVertexBuffer.needsUpdate=!0,this.m_copyVertexBuffer.updateRange.offset=0,this.m_copyVertexBuffer.updateRange.count=20*this.m_copyGeometryDrawCount,this.m_copyGeometry.index.needsUpdate=!0,this.m_copyGeometry.index.updateRange.offset=0,this.m_copyGeometry.index.updateRange.count=6*this.m_copyGeometryDrawCount,this.m_copyGeometry.setDrawRange(0,6*this.m_copyGeometryDrawCount),this.m_copyMesh.visible=!0;const t=Array.from(this.m_copyTextureSet),i=Math.ceil(this.m_copyTextureSet.size/8);for(let n=0;n<i;n++){const i=8*n;this.m_copyMaterial.uniforms.pageOffset.value=i;for(let e=0;e<8;e++){const n=i+e;n<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+e].value=t[n])}e.render(this.m_scene,this.m_camera)}this.m_copyTextureSet.clear(),this.m_copyGeometryDrawCount=0}(i||n)&&e.setRenderTarget(t)}initCacheEntries(){const e=new v.GlyphData(0,"",0,0,0,0,0,0,0,0,0,f.Texture.DEFAULT_IMAGE,{name:"",metrics:{size:0,distanceRange:0,base:0,lineHeight:0,lineGap:0,capHeight:0,xHeight:0},charset:""});for(let t=0;t<this.m_cacheHeight;t++)for(let i=0;i<this.m_cacheWidth;i++){const n={glyphData:e,location:new u.Vector2(i,t)};this.m_entryCache.set(`Dummy_${t*this.m_cacheHeight+i}`,n)}}copyGlyphToCache(e,t,i){this.m_copyTextureSet.add(t.texture);let n=0;for(const e of this.m_copyTextureSet.values()){if(e===t.texture)break;n++}t.copyIndex=n,this.m_copyTransform.set(1,0,i.x*this.entryWidth-t.offsetX,0,1,i.y*this.entryHeight-t.positions[0].y,0,0,0);for(let e=0;e<4;++e)this.m_copyPositions[e].set(t.positions[e].x,t.positions[e].y),this.m_copyPositions[e].applyMatrix3(this.m_copyTransform);if(this.m_copyGeometryDrawCount>=this.capacity)return;const r=4*this.m_copyGeometryDrawCount,s=6*this.m_copyGeometryDrawCount;for(let e=0;e<4;++e)this.m_copyPositionAttribute.setXYZ(r+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y,t.copyIndex),this.m_copyUVAttribute.setXY(r+e,t.sourceTextureCoordinates[e].x,t.sourceTextureCoordinates[e].y);if(null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyGeometry.index.setX(s,r),this.m_copyGeometry.index.setX(s+1,r+1),this.m_copyGeometry.index.setX(s+2,r+2),this.m_copyGeometry.index.setX(s+3,r+2),this.m_copyGeometry.index.setX(s+4,r+1),this.m_copyGeometry.index.setX(s+5,r+3),++this.m_copyGeometryDrawCount;const o=this.m_copyPositions[0].x/this.m_textureSize.x,a=this.m_copyPositions[0].y/this.m_textureSize.y,l=this.m_copyPositions[3].x/this.m_textureSize.x,c=this.m_copyPositions[3].y/this.m_textureSize.y;t.dynamicTextureCoordinates[0].set(o,a),t.dynamicTextureCoordinates[1].set(l,a),t.dynamicTextureCoordinates[2].set(o,c),t.dynamicTextureCoordinates[3].set(l,c),t.isInCache=!0,this.m_entryCache.set(e,{glyphData:t,location:i})}clearCacheEntry(e){if(e.glyphData.isInCache=!1,this.m_copyPositions[0].set(e.location.x*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[1].set((e.location.x+1)*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[2].set(e.location.x*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_copyPositions[3].set((e.location.x+1)*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_clearGeometryDrawCount>=this.capacity)return;const t=4*this.m_clearGeometryDrawCount,i=6*this.m_clearGeometryDrawCount;for(let e=0;e<4;++e)this.m_clearPositionAttribute.setXY(t+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y);if(null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearGeometry.index.setX(i,t),this.m_clearGeometry.index.setX(i+1,t+1),this.m_clearGeometry.index.setX(i+2,t+2),this.m_clearGeometry.index.setX(i+3,t+2),this.m_clearGeometry.index.setX(i+4,t+1),this.m_clearGeometry.index.setX(i+5,t+3),++this.m_clearGeometryDrawCount}}},9843:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBufferObject=void 0,t.TextBufferObject=class{constructor(e,t,i,n,r,s){this.glyphs=e,this.buffer=t,this.bounds=i,this.characterBounds=n,this.textRenderStyle=r,this.textLayoutStyle=s}}},16:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextGeometry=t.QUAD_INDEX_MEMORY_FOOTPRINT=t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD=t.VERTICES_PER_QUAD=t.INDEX_BUFFER_STRIDE=t.VERTEX_BUFFER_STRIDE=t.MAX_CAPACITY=void 0;const n=i(6271),r=i(9365),s=i(3148),o=i(9044),a=i(6280),l=i(5269);t.MAX_CAPACITY=65536,t.VERTEX_BUFFER_STRIDE=16,t.INDEX_BUFFER_STRIDE=1,t.VERTICES_PER_QUAD=4,t.INDICES_PER_QUAD=6,t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.VERTICES_PER_QUAD*t.VERTEX_BUFFER_STRIDE,t.QUAD_INDEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD*t.INDEX_BUFFER_STRIDE,t.TextGeometry=class{get drawCount(){return this.m_drawCount}get mesh(){return this.m_mesh}get backgroundMesh(){return this.m_bgMesh}constructor(e,i,c,h,u){this.scene=e,this.m_pickingDataArray=[],this.capacity=Math.min(u,t.MAX_CAPACITY),this.m_currentCapacity=Math.min(h,u),this.m_drawCount=0,this.m_updateOffset=0,this.m_vertexBuffer=new o.InterleavedBuffer(new Float32Array(this.m_currentCapacity*t.QUAD_VERTEX_MEMORY_FOOTPRINT),t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(n.DynamicDrawUsage),this.m_positionAttribute=new a.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new a.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new a.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new a.InterleavedBufferAttribute(this.m_vertexBuffer,4,12),this.m_indexBuffer=new r.BufferAttribute(new Uint32Array(this.m_currentCapacity*t.QUAD_INDEX_MEMORY_FOOTPRINT),t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(n.DynamicDrawUsage),this.m_geometry=new s.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_mesh=new l.Mesh(this.m_geometry,i),this.m_bgMesh=new l.Mesh(this.m_geometry,c),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}dispose(){this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_geometry.dispose()}clear(){this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingDataArray.length=0}update(){this.drawCount>this.m_updateOffset&&(this.m_vertexBuffer.needsUpdate=!0,this.m_vertexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_vertexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_indexBuffer.needsUpdate=!0,this.m_indexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_INDEX_MEMORY_FOOTPRINT,this.m_indexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_INDEX_MEMORY_FOOTPRINT),this.m_updateOffset=this.m_drawCount,this.m_geometry.setDrawRange(0,this.m_drawCount*t.INDICES_PER_QUAD)}add(e,i,n,r,s,o){if(this.m_drawCount>=this.capacity)return!1;if(this.m_drawCount>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const a=this.m_drawCount*t.VERTICES_PER_QUAD,l=this.m_drawCount*t.INDICES_PER_QUAD;for(let l=0;l<t.VERTICES_PER_QUAD;++l){this.m_positionAttribute.setXYZW(a+l,i[l].x,i[l].y,i[l].z,(s?-1:1)*o.rotation);const t=s?(l+1)%2+2*Math.floor(l/2):l;this.m_uvAttribute.setXYZW(a+l,e.dynamicTextureCoordinates[t].x,e.dynamicTextureCoordinates[t].y,n,r),this.m_colorAttribute.setXYZW(a+l,o.color.r,o.color.g,o.color.b,o.opacity),this.m_bgColorAttribute.setXYZW(a+l,o.backgroundColor.r,o.backgroundColor.g,o.backgroundColor.b,o.backgroundOpacity)}return this.m_indexBuffer.setX(l,a),this.m_indexBuffer.setX(l+1,a+1),this.m_indexBuffer.setX(l+2,a+2),this.m_indexBuffer.setX(l+3,a+2),this.m_indexBuffer.setX(l+4,a+1),this.m_indexBuffer.setX(l+5,a+3),++this.m_drawCount,!0}addToBuffer(e,i,n,r,s,o,a,l){for(let c=0;c<t.VERTICES_PER_QUAD;++c){const h=i+t.VERTEX_BUFFER_STRIDE*c;e[h]=r[c].x,e[h+1]=r[c].y,e[h+2]=r[c].z,e[h+3]=(a?-1:1)*l.rotation;const u=a?(c+1)%2+2*Math.floor(c/2):c;e[h+4]=n.dynamicTextureCoordinates[u].x,e[h+5]=n.dynamicTextureCoordinates[u].y,e[h+6]=s,e[h+7]=o,e[h+8]=l.color.r,e[h+9]=l.color.g,e[h+10]=l.color.b,e[h+11]=l.opacity,e[h+12]=l.backgroundColor.r,e[h+13]=l.backgroundColor.g,e[h+14]=l.backgroundColor.b,e[h+15]=l.backgroundOpacity}}addTextBufferObject(e,i,n,r,s,o,a,l){if(this.m_drawCount+e.glyphs.length>=this.capacity)return!1;if(this.m_drawCount+e.glyphs.length>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const c=null!=n?n:1,h=null!=r?r:0,u=Math.cos(h),d=Math.sin(h),m=void 0!==i?i.x:0,p=void 0!==i?i.y:0,f=e.buffer,g=f[3]<0?-1:1,v=void 0!==s?s.r:f[8],_=void 0!==s?s.g:f[9],y=void 0!==s?s.b:f[10],x=void 0!==o?o:f[11],S=void 0!==a?a.r:f[12],b=void 0!==a?a.g:f[13],T=void 0!==a?a.b:f[14],M=void 0!==l?l:f[15],w=this.m_drawCount*t.VERTICES_PER_QUAD;for(let i=0;i<e.glyphs.length;++i){const n=i*t.QUAD_VERTEX_MEMORY_FOOTPRINT,r=e.glyphs[i];if(!r.isInCache)return!1;const s=f[n+4]>f[n+t.VERTEX_BUFFER_STRIDE+4],o=f[n+6],a=f[n+7];for(let e=0;e<t.VERTICES_PER_QUAD;++e){const l=f[n+e*t.VERTEX_BUFFER_STRIDE],E=f[n+e*t.VERTEX_BUFFER_STRIDE+1];this.m_positionAttribute.setXYZW(w+i*t.VERTICES_PER_QUAD+e,l*c*u+E*c*-d+m,l*c*d+E*c*u+p,f[n+e*t.VERTEX_BUFFER_STRIDE+2]+0,f[n+e*t.VERTEX_BUFFER_STRIDE+3]+g*h);const C=s?(e+1)%2+2*Math.floor(e/2):e;this.m_uvAttribute.setXYZW(w+i*t.VERTICES_PER_QUAD+e,r.dynamicTextureCoordinates[C].x,r.dynamicTextureCoordinates[C].y,o,(a-o)/c+o),this.m_colorAttribute.setXYZW(w+i*t.VERTICES_PER_QUAD+e,v,_,y,x),this.m_bgColorAttribute.setXYZW(w+i*t.VERTICES_PER_QUAD+e,S,b,T,M)}this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD,(this.m_drawCount+i)*t.VERTICES_PER_QUAD),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+1,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+2,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+3,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+4,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+5,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+3)}return this.m_drawCount+=e.glyphs.length,!0}addPickingData(e,t,i){return!(this.m_pickingDataArray.length>=this.m_currentCapacity||(this.m_pickingDataArray.push({start:Math.min(e,this.capacity),end:Math.min(t,this.capacity),data:i}),0))}pick(e,i){for(const n of this.m_pickingDataArray){if(void 0===n)return;for(let r=n.start;r<n.end;++r){const s=r*t.VERTICES_PER_QUAD,o=Math.min(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x<o)continue;const a=Math.max(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x>a)continue;const l=Math.min(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(e.y<l)continue;const c=Math.max(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(!(e.y>c)){i(n.data);break}}}}updateMemoryUsage(e){const t=4*this.m_vertexBuffer.count+4*this.m_indexBuffer.count;e.heapSize+=t,e.gpuSize+=t}resizeBuffers(e){this.m_currentCapacity=e;const i=new Float32Array(e*t.QUAD_VERTEX_MEMORY_FOOTPRINT);i.set(this.m_vertexBuffer.array),this.m_vertexBuffer=new o.InterleavedBuffer(i,t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(n.DynamicDrawUsage),this.m_positionAttribute=new a.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new a.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new a.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new a.InterleavedBufferAttribute(this.m_vertexBuffer,4,12);const c=new Uint32Array(e*t.QUAD_INDEX_MEMORY_FOOTPRINT);c.set(this.m_indexBuffer.array),this.m_indexBuffer=new r.BufferAttribute(c,t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(n.DynamicDrawUsage),this.m_geometry.dispose(),this.m_geometry=new s.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray.length=this.m_currentCapacity,this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_mesh=new l.Mesh(this.m_geometry,this.m_mesh.material),this.m_bgMesh=new l.Mesh(this.m_geometry,this.m_bgMesh.material),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}}},4420:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdfTextMaterial=t.GlyphCopyMaterial=t.GlyphClearMaterial=void 0;const n=i(6271),r=i(4125),s=i(4085),o=i(6577),a=i(576),l=i(394),c=i(4342);Object.assign(a.ShaderChunk,{sdf_attributes:"\n        attribute vec4 position;\n        attribute vec4 uv;\n        attribute vec4 color;\n        attribute vec4 bgColor;\n        ",sdf_varying:"\n        varying vec4 vColor;\n        varying float vWeight;\n        varying vec2 vUv;\n        varying float vRotation;\n        ",sdf_varying_computation:"\n        #if BG_TEXT\n        vColor = bgColor;\n        vWeight = uv.w;\n        #else\n        vColor = color;\n        vWeight = uv.z;\n        #endif\n        vUv = vec2(uv.xy);\n        vRotation = position.w;\n        ",sdf_frag_uniforms:"\n        uniform sampler2D sdfTexture;\n        uniform vec4 sdfParams;\n        ",sdf_sampling_functions:"\n        float median(float r, float g, float b) {\n            return max(min(r, g), min(max(r, g), b));\n        }\n\n        float getDistance(vec2 uvOffset) {\n            vec3 texSample = texture2D(sdfTexture, vUv.xy + uvOffset).rgb;\n            #if MSDF\n            return median(texSample.r, texSample.g, texSample.b);\n            #else\n            return texSample.r;\n            #endif\n        }\n\n        float getOpacity(vec2 uvOffset, float weight) {\n            vec2 uv = vUv + uvOffset;\n            vec2 rotatedUVs = abs(vec2(\n                cos(vRotation) * uv.x - sin(vRotation) * uv.y,\n                sin(vRotation) * uv.x + cos(vRotation) * uv.y));\n\n            float dx = dFdx(rotatedUVs.x) * sdfParams.x;\n            float dy = dFdy(rotatedUVs.y) * sdfParams.y;\n            float toPixels = sdfParams.w * inversesqrt( dx * dx + dy * dy );\n\n            float dist = getDistance(uvOffset) + min(weight, 0.5 - 1.0 / sdfParams.w) - 0.5;\n            return clamp(dist * toPixels + 0.5, 0.0, 1.0);\n        }\n        "});class h extends s.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),i=e?Object.assign(Object.assign({},e),{glslVersion:t?n.GLSL3:n.GLSL1,vertexShader:t&&e.vertexShader?(0,c.convertVertexShaderToWebGL2)(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?(0,c.convertFragmentShaderToWebGL2)(e.fragmentShader):e.fragmentShader}):void 0;i&&delete i.rendererCapabilities,super(i)}}t.GlyphClearMaterial=class extends h{constructor(e){super(e?{name:"GlyphClearMaterial",vertexShader:"\n    attribute vec2 position;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }",uniforms:{},depthTest:!1,depthWrite:!1,rendererCapabilities:e.rendererCapabilities}:void 0)}},t.GlyphCopyMaterial=class extends h{constructor(e){super(e?{name:"GlyphCopyMaterial",vertexShader:"\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vUv;\n\n    void main() {\n        vUv = vec3(uv.xy, position.z);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    uniform float pageOffset;\n    uniform sampler2D page0;\n    uniform sampler2D page1;\n    uniform sampler2D page2;\n    uniform sampler2D page3;\n    uniform sampler2D page4;\n    uniform sampler2D page5;\n    uniform sampler2D page6;\n    uniform sampler2D page7;\n\n    varying vec3 vUv;\n\n    void main() {\n        vec4 texSample = vec4(0.0);\n        if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n        else if (vUv.z < pageOffset + 1.0) texSample = texture2D(page0, vUv.xy);\n        else if (vUv.z < pageOffset + 2.0) texSample = texture2D(page1, vUv.xy);\n        else if (vUv.z < pageOffset + 3.0) texSample = texture2D(page2, vUv.xy);\n        else if (vUv.z < pageOffset + 4.0) texSample = texture2D(page3, vUv.xy);\n        else if (vUv.z < pageOffset + 5.0) texSample = texture2D(page4, vUv.xy);\n        else if (vUv.z < pageOffset + 6.0) texSample = texture2D(page5, vUv.xy);\n        else if (vUv.z < pageOffset + 7.0) texSample = texture2D(page6, vUv.xy);\n        else texSample = texture2D(page7, vUv.xy);\n\n        gl_FragColor = texSample;\n    }",uniforms:{pageOffset:new r.Uniform(0),page0:new r.Uniform(l.Texture.DEFAULT_IMAGE),page1:new r.Uniform(l.Texture.DEFAULT_IMAGE),page2:new r.Uniform(l.Texture.DEFAULT_IMAGE),page3:new r.Uniform(l.Texture.DEFAULT_IMAGE),page4:new r.Uniform(l.Texture.DEFAULT_IMAGE),page5:new r.Uniform(l.Texture.DEFAULT_IMAGE),page6:new r.Uniform(l.Texture.DEFAULT_IMAGE),page7:new r.Uniform(l.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1,rendererCapabilities:e.rendererCapabilities}:void 0)}},t.SdfTextMaterial=class extends h{constructor(e){super(e?{name:"SdfTextMaterial",vertexShader:void 0!==e.vertexSource?e.vertexSource:"\n    #include <sdf_attributes>\n    #include <sdf_varying>\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        #include <sdf_varying_computation>\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",fragmentShader:void 0!==e.fragmentSource?e.fragmentSource:"\n    precision highp float;\n    precision highp int;\n\n    #include <sdf_varying>\n    #include <sdf_frag_uniforms>\n    #include <sdf_sampling_functions>\n\n    void main() {\n        vec4 color = vColor;\n        color.a *= getOpacity(vec2(0.0), vWeight);\n        if (color.a < 0.05) {\n            discard;\n        }\n        gl_FragColor = color;\n    }",uniforms:{sdfTexture:new r.Uniform(e.texture),sdfParams:new r.Uniform(new o.Vector4(e.textureSize.x,e.textureSize.y,e.size,e.distanceRange))},defines:{MSDF:e.isMsdf?1:0,BG_TEXT:e.isBackground?1:0},depthTest:!0,depthWrite:!1,side:n.FrontSide,transparent:!0,rendererCapabilities:e.rendererCapabilities}:void 0),this.extensions.derivatives=!0}}},1662:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolvePlacementAndAlignment=t.TextLayoutStyle=t.TextRenderStyle=t.DefaultTextStyle=t.vPlacementFromAlignment=t.hPlacementFromAlignment=t.vAlignFromPlacement=t.hAlignFromPlacement=t.WrappingMode=t.HorizontalPlacement=t.VerticalPlacement=t.HorizontalAlignment=t.VerticalAlignment=t.FontVariant=t.FontStyle=t.FontUnit=void 0;const n=i(5971);var r,s,o,a,l,c,h,u,d;!function(e){e[e.Em=0]="Em",e[e.Pixel=1]="Pixel",e[e.Point=2]="Point",e[e.Percent=3]="Percent"}(r=t.FontUnit||(t.FontUnit={})),function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic"}(s=t.FontStyle||(t.FontStyle={})),function(e){e[e.Regular=0]="Regular",e[e.AllCaps=1]="AllCaps",e[e.SmallCaps=2]="SmallCaps"}(o=t.FontVariant||(t.FontVariant={})),function(e){e[e.Above=0]="Above",e[e.Center=-.5]="Center",e[e.Below=-1]="Below"}(a=t.VerticalAlignment||(t.VerticalAlignment={})),function(e){e[e.Left=0]="Left",e[e.Center=-.5]="Center",e[e.Right=-1]="Right"}(l=t.HorizontalAlignment||(t.HorizontalAlignment={})),(d=t.VerticalPlacement||(t.VerticalPlacement={}))[d.Top=0]="Top",d[d.Center=-.5]="Center",d[d.Bottom=-1]="Bottom",(u=t.HorizontalPlacement||(t.HorizontalPlacement={}))[u.Left=-1]="Left",u[u.Center=-.5]="Center",u[u.Right=0]="Right",function(e){e[e.None=0]="None",e[e.Character=1]="Character",e[e.Word=2]="Word"}(c=t.WrappingMode||(t.WrappingMode={})),t.hAlignFromPlacement=function(e){return e},t.vAlignFromPlacement=function(e){return e},t.hPlacementFromAlignment=function(e){return e},t.vPlacementFromAlignment=function(e){return e},function(e){e.DEFAULT_FONT_NAME="",e.DEFAULT_FONT_SIZE={unit:Object.freeze(r.Pixel),size:Object.freeze(16),backgroundSize:Object.freeze(0)},e.DEFAULT_FONT_STYLE=s.Regular,e.DEFAULT_FONT_VARIANT=o.Regular,e.DEFAULT_ROTATION=0,e.DEFAULT_COLOR=new n.Color(0),e.DEFAULT_OPACITY=1,e.DEFAULT_BACKGROUND_COLOR=new n.Color(0),e.DEFAULT_BACKGROUND_OPACITY=0,e.DEFAULT_TRACKING=0,e.DEFAULT_LEADING=0,e.DEFAULT_MAX_LINES=1/0,e.DEFAULT_LINE_WIDTH=1/0,e.DEFAULT_CANVAS_ROTATION=0,e.DEFAULT_LINE_ROTATION=0,e.DEFAULT_WRAPPING_MODE=c.Word,e.DEFAULT_VERTICAL_ALIGNMENT=a.Above,e.DEFAULT_HORIZONTAL_ALIGNMENT=l.Left,e.DEFAULT_PLACEMENTS=[]}(h=t.DefaultTextStyle||(t.DefaultTextStyle={}));class m{constructor(e={}){this.m_params={fontName:void 0!==e.fontName?e.fontName:h.DEFAULT_FONT_NAME,fontSize:void 0!==e.fontSize?Object.assign({},e.fontSize):{unit:h.DEFAULT_FONT_SIZE.unit,size:h.DEFAULT_FONT_SIZE.size,backgroundSize:h.DEFAULT_FONT_SIZE.backgroundSize},fontStyle:void 0!==e.fontStyle?e.fontStyle:h.DEFAULT_FONT_STYLE,fontVariant:void 0!==e.fontVariant?e.fontVariant:h.DEFAULT_FONT_VARIANT,rotation:void 0!==e.rotation?e.rotation:h.DEFAULT_ROTATION,color:void 0!==e.color?e.color.clone():h.DEFAULT_COLOR.clone(),opacity:void 0!==e.opacity?e.opacity:h.DEFAULT_OPACITY,backgroundColor:void 0!==e.backgroundColor?e.backgroundColor.clone():h.DEFAULT_BACKGROUND_COLOR.clone(),backgroundOpacity:void 0!==e.backgroundOpacity?e.backgroundOpacity:h.DEFAULT_BACKGROUND_OPACITY,backgroundImage:e.backgroundImage}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get fontName(){return this.m_params.fontName}set fontName(e){this.m_params.fontName=e}get fontSize(){return this.m_params.fontSize}set fontSize(e){this.m_params.fontSize=Object.assign({},e)}get fontStyle(){return this.m_params.fontStyle}set fontStyle(e){this.m_params.fontStyle=e}get fontVariant(){return this.m_params.fontVariant}set fontVariant(e){this.m_params.fontVariant=e}get rotation(){return this.m_params.rotation}set rotation(e){this.m_params.rotation=e}get color(){return this.m_params.color}set color(e){this.m_params.color.copy(e)}get backgroundColor(){return this.m_params.backgroundColor}set backgroundColor(e){this.m_params.backgroundColor.copy(e)}get opacity(){return this.m_params.opacity}set opacity(e){this.m_params.opacity=e}get backgroundOpacity(){return this.m_params.backgroundOpacity}set backgroundOpacity(e){this.m_params.backgroundOpacity=e}get backgroundImage(){return this.m_params.backgroundImage}set backgroundImage(e){this.m_params.backgroundImage=e}clone(e={}){return new m(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.m_params.fontName=e.fontName,this.m_params.fontSize=Object.assign({},e.fontSize),this.m_params.fontStyle=e.fontStyle,this.m_params.fontVariant=e.fontVariant,this.m_params.rotation=e.rotation,this.m_params.color.copy(e.color),this.m_params.backgroundColor.copy(e.backgroundColor),this.m_params.opacity=e.opacity,this.m_params.backgroundOpacity=e.backgroundOpacity,this.m_params.backgroundImage=e.backgroundImage,this}}t.TextRenderStyle=m;class p{constructor(e={}){const{horizontalAlignment:t,verticalAlignment:i,placements:n}=f(e.horizontalAlignment,e.verticalAlignment,e.placements);this.m_params={tracking:void 0!==e.tracking?e.tracking:h.DEFAULT_TRACKING,leading:void 0!==e.leading?e.leading:h.DEFAULT_LEADING,maxLines:void 0!==e.maxLines?e.maxLines:h.DEFAULT_MAX_LINES,lineWidth:void 0!==e.lineWidth?e.lineWidth:h.DEFAULT_LINE_WIDTH,canvasRotation:void 0!==e.canvasRotation?e.canvasRotation:h.DEFAULT_CANVAS_ROTATION,lineRotation:void 0!==e.lineRotation?e.lineRotation:h.DEFAULT_LINE_ROTATION,wrappingMode:void 0!==e.wrappingMode?e.wrappingMode:h.DEFAULT_WRAPPING_MODE,verticalAlignment:i,horizontalAlignment:t,placements:n}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get tracking(){return this.m_params.tracking}set tracking(e){this.m_params.tracking=e}get leading(){return this.m_params.leading}set leading(e){this.m_params.leading=e}get maxLines(){return this.m_params.maxLines}set maxLines(e){this.m_params.maxLines=e}get lineWidth(){return this.m_params.lineWidth}set lineWidth(e){this.m_params.lineWidth=e}get canvasRotation(){return this.m_params.canvasRotation}set canvasRotation(e){this.m_params.canvasRotation=e}get lineRotation(){return this.m_params.lineRotation}set lineRotation(e){this.m_params.lineRotation=e}get wrappingMode(){return this.m_params.wrappingMode}set wrappingMode(e){this.m_params.wrappingMode=e}get verticalAlignment(){return this.m_params.verticalAlignment}set verticalAlignment(e){this.m_params.verticalAlignment=e}get horizontalAlignment(){return this.m_params.horizontalAlignment}set horizontalAlignment(e){this.m_params.horizontalAlignment=e}get placements(){return this.m_params.placements}set placements(e){const{horizontalAlignment:t,verticalAlignment:i,placements:n}=f(this.horizontalAlignment,this.verticalAlignment,e);this.m_params.horizontalAlignment=t,this.m_params.verticalAlignment=i,this.m_params.placements=n}clone(e={}){return new p(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.params=Object.assign({},e.params),this}}function f(e,t,i){var n;const r=null!==(n=null==i?void 0:i.map((e=>Object.assign({},e))))&&void 0!==n?n:h.DEFAULT_PLACEMENTS.map((e=>Object.assign({},e)));return{horizontalAlignment:r.length>0?r[0].h:null!=e?e:h.DEFAULT_HORIZONTAL_ALIGNMENT,verticalAlignment:r.length>0?r[0].v:null!=t?t:h.DEFAULT_VERTICAL_ALIGNMENT,placements:r}}t.TextLayoutStyle=p,t.resolvePlacementAndAlignment=f},5402:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineTypesetter=void 0;const n=i(8955),r=i(6815),s=i(16),o=i(1662),a=i(1741),l=i(8533);t.LineTypesetter=class{constructor(){this.m_tempTransform=new n.Matrix3,this.m_tempCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this.m_tempLineDirection=l.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=l.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=a.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=a.TypesettingUtils.fontSizeAlignmentFactor*a.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(a.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_currentParams.position.y+=this.m_currentParams.textLayoutStyle.verticalAlignment*this.m_currentParams.glyphs[0].font.metrics.capHeight*this.m_tempScale;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer,i=this.m_currentParams.position.x,n=this.m_currentParams.glyphs[0].font.metrics.lineHeight+this.m_currentParams.textLayoutStyle.leading;let r=0,s=0,c=0,h=0,u=0,d=0,m=0,p=0,f=!1;for(let e=0;e<this.m_currentParams.glyphs.length&&!(p>this.m_currentParams.textLayoutStyle.maxLines-1);++e){const g=this.m_currentParams.glyphs[e];if(!g.isInCache&&!t)return!1;const v=l.UnicodeUtils.isNewLine(g.codePoint),_=l.UnicodeUtils.isWhiteSpace(g.codePoint);if(f||g.direction!==-this.m_tempLineDirection||(f=!0),l.UnicodeUtils.isPrintable(g.codePoint)&&(u+=(g.advanceX*this.m_tempScale+this.m_currentParams.textLayoutStyle.tracking)*(this.m_tempSmallCaps?a.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1)),e===r&&(h=u,d=u,m=u),v||this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Character&&u>this.m_currentParams.textLayoutStyle.lineWidth||this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Word&&u>this.m_currentParams.textLayoutStyle.lineWidth&&m!==h){if(this.m_currentParams.textLayoutStyle.wrappingMode!==o.WrappingMode.None){let t=s,i=d;this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Word&&m!==h&&(t=c,i=m),u=i,e=Math.min(v?r===e?t:e:t,this.m_currentParams.glyphs.length-1)}const t=this.m_tempLineDirection===l.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.x=this.m_currentParams.position.x+u*t,!this.placeLine(r,e,this.m_tempLineDirection,f))return!1;for(this.m_currentParams.position.y-=n*this.m_tempScale,this.m_currentParams.position.x=i;e!==r&&e+1<this.m_currentParams.glyphs.length&&l.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint);)++e;if(r=e+1,r===this.m_currentParams.glyphs.length)break;v&&(this.m_tempLineDirection=a.TypesettingUtils.getDirection(this.m_currentParams.glyphs,r),this.m_tempRunDirection=this.m_tempLineDirection),h=0,u=0,s=r,d=0,c=r,m=0,f=!1,p++}else this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.None||_||(s=e,d=u,this.m_currentParams.textLayoutStyle.wrappingMode===o.WrappingMode.Word&&e+1<this.m_currentParams.glyphs.length&&(l.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint)||l.UnicodeUtils.isNewLine(this.m_currentParams.glyphs[e+1].codePoint))&&(c=e,m=u))}if(p<=this.m_currentParams.textLayoutStyle.maxLines-1&&r<=this.m_currentParams.glyphs.length-1){const e=this.m_tempLineDirection===l.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.setX(this.m_currentParams.position.x+u*e),!this.placeLine(r,this.m_currentParams.glyphs.length-1,this.m_tempLineDirection,f))return!1}if(e.globalBounds&&e.globalBounds.max.x-e.globalBounds.min.x>0&&e.globalBounds.max.y-e.globalBounds.min.y>0){const t=e.globalBounds,i=(.5*this.m_currentParams.fontCatalog.distanceRange-this.m_tempPixelBgSize)*this.m_tempScale;t.min.set(t.min.x+i,t.min.y+i),t.max.set(t.max.x-i,t.max.y-i)}return!0}placeLine(e,t,i,n){if(!n)return this.placeRun(e,t,i);const r=this.m_currentParams.glyphs,s=this.m_currentParams.smallCapsArray,o=this.m_currentParams.textRenderStyle,c=this.m_currentParams.textLayoutStyle,h=this.m_currentParams.position,u=i===l.UnicodeUtils.Direction.RTL,d=h.x;let m=0,p=e;for(let n=e;n<=t;++n){const e=r[n];if(e.direction===-this.m_tempRunDirection){if(u&&(h.x=d+m),!this.placeRun(p,n-1,this.m_tempRunDirection))return!1;u||(h.x=d+m),p=n,this.m_tempRunDirection*=-1}else if(e.direction===l.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-i){let e=n;for(;e+1<r.length&&1!==Math.abs(r[e].direction);)++e;if(r[e].direction!==this.m_tempRunDirection){if(u&&(h.x=d+m),!this.placeRun(p,n-1,this.m_tempRunDirection))return!1;u||(h.x=d+m),p=n,this.m_tempRunDirection*=-1}}m+=(e.advanceX*this.m_tempScale+c.tracking)*(this.m_tempSmallCaps?a.TypesettingUtils.getSmallCapsScale(r,s,n,o.fontVariant):1)*i}if(p<=t){if(u&&(h.x=d+m),!this.placeRun(p,t,this.m_tempRunDirection))return!1;u||(h.x=d+m)}return!0}placeRun(e,t,i){const n=this.m_currentParams.glyphs,r=this.m_currentParams.smallCapsArray,c=this.m_currentParams.fontCatalog,h=this.m_currentParams.textRenderStyle,u=this.m_currentParams.textLayoutStyle,d=this.m_currentParams.position,m=this.m_currentParams.geometry,p=this.m_currentParams.globalBounds,f=this.m_currentParams.individualBounds,g=this.m_currentParams.vertexBuffer,v=i===l.UnicodeUtils.Direction.LTR?e:t,_=i===l.UnicodeUtils.Direction.LTR?t:e;for(let y=v;i===l.UnicodeUtils.Direction.RTL?y>=_:y<=_;y+=i){const v=n[y];if(!l.UnicodeUtils.isPrintable(v.codePoint))continue;if(e!==t&&0!==y&&i===l.UnicodeUtils.Direction.RTL&&v.direction===l.UnicodeUtils.Direction.Weak){let t=y,i=n[t-1];for(;t!==e&&(i.direction===l.UnicodeUtils.Direction.Weak||i.direction===l.UnicodeUtils.Direction.Neutral&&!l.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=n[t-1];this.placeRun(Math.max(t,e),y,l.UnicodeUtils.Direction.LTR),y=t;continue}const _=v.font,x=_.metrics,S=h.fontStyle,b=S===o.FontStyle.Bold&&void 0===_.bold||S===o.FontStyle.BoldItalic&&void 0===_.bold&&void 0===_.boldItalic,T=S===o.FontStyle.Italic&&void 0===_.italic||S===o.FontStyle.BoldItalic&&void 0===_.italic&&void 0===_.boldItalic,M=!!this.m_tempSmallCaps&&r[y]&&h.fontVariant===o.FontVariant.SmallCaps,w=M?x.xHeight/x.capHeight:1,E=this.m_tempScale*w,C=((b?.02:0)+(M?.01:0))*(c.size/c.distanceRange),A=a.TypesettingUtils.alignBackgroundWidth(this.m_tempPixelSize,.5*this.m_tempPixelBgSize/(c.distanceRange*Math.max(E,1))),P=l.UnicodeUtils.isRtlMirrored(v.codePoint)&&i===l.UnicodeUtils.Direction.RTL,R=x.lineHeight-x.base-.5*x.distanceRange;a.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,d,E,u.canvasRotation,h.rotation);for(let e=0;e<4;++e){const t=v.positions[e],i=T&&e>1?a.TypesettingUtils.OBLIQUE_OFFSET*x.size:0;this.m_tempCorners[e].set(t.x+i,t.y-R,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform)}if(void 0===p&&void 0===g){if(!m.add(v,this.m_tempCorners,C,C+A,P,h))return!1}else void 0!==p&&a.TypesettingUtils.updateBounds(this.m_tempCorners,p,f),void 0!==g&&m.addToBuffer(g,y*s.QUAD_VERTEX_MEMORY_FOOTPRINT,v,this.m_tempCorners,C,C+A,P,h);d.set(d.x+(v.advanceX*E+u.tracking)*Math.cos(u.lineRotation),d.y+(v.advanceX*E+u.tracking)*Math.sin(u.lineRotation),d.z)}return!0}}},2516:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathTypesetter=void 0;const n=i(8955),r=i(5448),s=i(6815),o=i(16),a=i(1662),l=i(1741),c=i(8533);t.PathTypesetter=class{constructor(){this.m_tempTransform=new n.Matrix3,this.m_tempCorners=[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3],this.m_tempLineDirection=c.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=c.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1,this.m_tempPathPosition=new s.Vector3,this.m_tempPathLength=0,this.m_tempPathOffset=0}arrangeGlyphs(e){var t;this.m_currentParams=e,this.m_tempLineDirection=l.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=l.TypesettingUtils.fontSizeAlignmentFactor*l.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(l.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_tempPathLength=this.m_currentParams.path.getLength(),this.m_tempPathOffset=0;const i=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer;let n=!1,r=0;for(let e=0;e<this.m_currentParams.glyphs.length;++e){const t=this.m_currentParams.glyphs[e];if(!t.isInCache&&!i)return!1;c.UnicodeUtils.isPrintable(t.codePoint)&&(n||t.direction!==-this.m_tempLineDirection||(n=!0),r+=(t.advanceX*this.m_tempScale+this.m_currentParams.textLayoutStyle.tracking)*(this.m_tempSmallCaps?l.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1))}return this.m_tempPathOffset=Math.min(Math.max(-this.m_currentParams.textLayoutStyle.horizontalAlignment+this.m_currentParams.textLayoutStyle.horizontalAlignment*r/this.m_tempPathLength+(null!==(t=this.m_currentParams.horizontalOffset)&&void 0!==t?t:0),0),1),this.placeLine(this.m_tempLineDirection,n)}placeLine(e,t){if(!t)return this.placeRun(0,this.m_currentParams.glyphs.length-1,e);const i=this.m_currentParams.glyphs;let n=0;for(let t=n;t<i.length;++t){const r=i[t];if(r.direction===-this.m_tempRunDirection){if(!this.placeRun(n,t-1,this.m_tempRunDirection))return!1;n=t,this.m_tempRunDirection*=-1}else if(r.direction===c.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-e){let e=t;for(;e+1<i.length&&1!==Math.abs(i[e].direction);)++e;if(i[e].direction!==this.m_tempRunDirection){if(!this.placeRun(n,t-1,this.m_tempRunDirection))return!1;n=t,this.m_tempRunDirection*=-1}}}return!(n<i.length&&!this.placeRun(n,i.length-1,this.m_tempRunDirection))}placeRun(e,t,i){const n=this.m_currentParams.glyphs,s=this.m_currentParams.smallCapsArray,h=this.m_currentParams.fontCatalog,u=this.m_currentParams.textRenderStyle,d=this.m_currentParams.textLayoutStyle,m=this.m_currentParams.position,p=this.m_currentParams.geometry,f=this.m_currentParams.globalBounds,g=this.m_currentParams.individualBounds,v=this.m_currentParams.vertexBuffer,_=this.m_currentParams.path,y=u.rotation,x=d.verticalAlignment*n[0].font.metrics.capHeight*this.m_tempScale,S=i===c.UnicodeUtils.Direction.LTR?e:t,b=i===c.UnicodeUtils.Direction.LTR?t:e;for(let T=S;i===c.UnicodeUtils.Direction.RTL?T>=b:T<=b;T+=i){const S=n[T];if(!c.UnicodeUtils.isPrintable(S.codePoint))continue;if(e!==t&&0!==T&&i===c.UnicodeUtils.Direction.RTL&&S.direction===c.UnicodeUtils.Direction.Weak){let t=T,i=n[t-1];for(;t!==e&&(i.direction===c.UnicodeUtils.Direction.Weak||i.direction===c.UnicodeUtils.Direction.Neutral&&!c.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=n[t-1];this.placeRun(Math.max(t,e),T,c.UnicodeUtils.Direction.LTR),T=t;continue}const b=S.font,M=b.metrics,w=u.fontStyle,E=w===a.FontStyle.Bold&&void 0===b.bold||w===a.FontStyle.BoldItalic&&void 0===b.bold&&void 0===b.boldItalic,C=w===a.FontStyle.Italic&&void 0===b.italic||w===a.FontStyle.BoldItalic&&void 0===b.italic&&void 0===b.boldItalic,A=!!this.m_tempSmallCaps&&s[T]&&u.fontVariant===a.FontVariant.SmallCaps,P=A?M.xHeight/M.capHeight:1,R=this.m_tempScale*P,L=((E?.02:0)+(A?.01:0))*(h.size/h.distanceRange),D=l.TypesettingUtils.alignBackgroundWidth(this.m_tempPixelSize,.5*this.m_tempPixelBgSize/(h.distanceRange*Math.max(R,1))),I=c.UnicodeUtils.isRtlMirrored(S.codePoint)&&i===c.UnicodeUtils.Direction.RTL,O=M.lineHeight-M.base-.5*M.distanceRange,F=_.getPoint(this.m_tempPathOffset);if(null===F)return this.m_currentParams.pathOverflow;const U=_.getTangent(this.m_tempPathOffset),V=new r.Vector2(-U.y,U.x).multiplyScalar(x),N=Math.atan2(U.y,U.x);this.m_tempPathPosition.set(V.x+F.x,V.y+F.y,m.z),u.rotation=y+N,l.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,this.m_tempPathPosition,R,0,u.rotation);for(let e=0;e<4;++e){const t=S.positions[e],i=C&&e>1?l.TypesettingUtils.OBLIQUE_OFFSET*M.size:0;this.m_tempCorners[e].set(t.x+i,t.y-O,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform),this.m_tempCorners[e].x-=m.x,this.m_tempCorners[e].y-=m.y}if(void 0===f&&void 0===v){if(!p.add(S,this.m_tempCorners,L,L+D,I,u))return!1}else void 0!==f&&l.TypesettingUtils.updateBounds(this.m_tempCorners,f,g),void 0!==v&&p.addToBuffer(v,T*o.QUAD_VERTEX_MEMORY_FOOTPRINT,S,this.m_tempCorners,L,L+D,I,u);u.rotation=y,this.m_tempPathOffset+=(S.advanceX*R+d.tracking)/this.m_tempPathLength}return!0}}},889:(e,t)=>{"use strict";var i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ContextualArabicConverter=void 0,function(e){e[e.Initial=0]="Initial",e[e.Medial=1]="Medial",e[e.Final=2]="Final"}(i||(i={})),function(e){e[e.Isolated=0]="Isolated",e[e.Connected=1]="Connected"}(n||(n={}));class r{static get instance(){return void 0===this.m_instance&&(this.m_instance=new r),this.m_instance}constructor(){this.m_singleCharactersMap=new Map,this.m_combinedCharactersMap=new Map,this.m_singleCharactersMap.set(1569,[void 0,void 0,void 0]),this.m_singleCharactersMap.set(1570,[void 0,void 0,65154]),this.m_singleCharactersMap.set(1571,[void 0,void 0,65156]),this.m_singleCharactersMap.set(1572,[void 0,void 0,65158]),this.m_singleCharactersMap.set(1573,[void 0,void 0,65160]),this.m_singleCharactersMap.set(1574,[65163,65164,65162]),this.m_singleCharactersMap.set(1575,[void 0,void 0,65166]),this.m_singleCharactersMap.set(1576,[65169,65170,65168]),this.m_singleCharactersMap.set(1577,[void 0,void 0,65172]),this.m_singleCharactersMap.set(1578,[65175,65176,65174]),this.m_singleCharactersMap.set(1579,[65179,65180,65178]),this.m_singleCharactersMap.set(1580,[65183,65184,65182]),this.m_singleCharactersMap.set(1581,[65187,65188,65186]),this.m_singleCharactersMap.set(1582,[65191,65192,65190]),this.m_singleCharactersMap.set(1583,[void 0,void 0,65194]),this.m_singleCharactersMap.set(1584,[void 0,void 0,65196]),this.m_singleCharactersMap.set(1585,[void 0,void 0,65198]),this.m_singleCharactersMap.set(1586,[void 0,void 0,65200]),this.m_singleCharactersMap.set(1587,[65203,65204,65202]),this.m_singleCharactersMap.set(1588,[65207,65208,65206]),this.m_singleCharactersMap.set(1589,[65211,65212,65210]),this.m_singleCharactersMap.set(1590,[65215,65216,65214]),this.m_singleCharactersMap.set(1591,[65219,65220,65218]),this.m_singleCharactersMap.set(1592,[65223,65224,65222]),this.m_singleCharactersMap.set(1593,[65227,65228,65226]),this.m_singleCharactersMap.set(1594,[65231,65232,65230]),this.m_singleCharactersMap.set(1600,[1600,1600,1600]),this.m_singleCharactersMap.set(1601,[65235,65236,65234]),this.m_singleCharactersMap.set(1602,[65239,65240,65238]),this.m_singleCharactersMap.set(1603,[65243,65244,65242]),this.m_singleCharactersMap.set(1604,[65247,65248,65246]),this.m_singleCharactersMap.set(1605,[65251,65252,65250]),this.m_singleCharactersMap.set(1606,[65255,65256,65254]),this.m_singleCharactersMap.set(1607,[65259,65260,65258]),this.m_singleCharactersMap.set(1608,[void 0,void 0,65262]),this.m_singleCharactersMap.set(1609,[void 0,void 0,65264]),this.m_singleCharactersMap.set(1610,[65267,65268,65266]),this.m_singleCharactersMap.set(1662,[64344,64345,64343]),this.m_singleCharactersMap.set(1740,[64510,64511,64509]),this.m_singleCharactersMap.set(1670,[64380,64381,64379]),this.m_singleCharactersMap.set(1705,[64400,64401,64399]),this.m_singleCharactersMap.set(1711,[64404,64405,64403]),this.m_singleCharactersMap.set(1688,[void 0,void 0,64395]),this.m_combinedCharactersMap.set(1604,new Map),this.m_combinedCharactersMap.get(1604).set(1570,[65269,65270]),this.m_combinedCharactersMap.get(1604).set(1571,[65271,65272]),this.m_combinedCharactersMap.get(1604).set(1573,[65273,65274]),this.m_combinedCharactersMap.get(1604).set(1575,[65275,65276]),this.m_neutralCharacters=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}convert(e){let t="";for(let r=0;r<e.length;++r){const s=e.charCodeAt(r);if(this.isArabicCharacter(s)){let o=r-1;for(;o>=0&&this.isNeutral(e.charCodeAt(o));--o);let a=o>=0?e.charCodeAt(o):void 0;if(void 0!==a){const e=this.getCharacterMap(a);(void 0===e||void 0===e[i.Initial]&&void 0===e[i.Medial])&&(a=void 0)}let l=r+1;for(;l<e.length&&this.isNeutral(e.charCodeAt(l));++l);let c=l<e.length?e.charCodeAt(l):void 0;if(void 0!==c){const e=this.getCharacterMap(c);(void 0===e||void 0===e[i.Medial]&&void 0===e[i.Final])&&(c=void 0)}if(1604===s&&void 0!==c&&(1570===c||1571===c||1573===c||1575===c)){const e=this.getCombinedCharacterMap(s,c);t+=void 0!==a?String.fromCharCode(e[n.Connected]):String.fromCharCode(e[n.Isolated]),++r;continue}const h=this.getCharacterMap(s);void 0!==a&&void 0!==c&&void 0!==h[i.Medial]?t+=String.fromCharCode(h[i.Medial]):void 0!==a&&void 0!==h[i.Final]?t+=String.fromCharCode(h[i.Final]):void 0!==c&&void 0!==h[i.Initial]?t+=String.fromCharCode(h[i.Initial]):t+=String.fromCharCode(s)}else t+=String.fromCharCode(s)}return t}isArabicCharacter(e){return this.m_singleCharactersMap.has(e)}getCharacterMap(e){return this.m_singleCharactersMap.get(e)}getCombinedCharacterMap(e,t){const i=this.m_combinedCharactersMap.get(e);if(void 0!==i)return i.get(t)}isNeutral(e){for(const t of this.m_neutralCharacters)if(t===e)return!0;return!1}}t.ContextualArabicConverter=r},3461:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSdfTextMaterial=void 0;const n=i(4420);t.createSdfTextMaterial=function(e){return new n.SdfTextMaterial({texture:e.fontCatalog.texture,textureSize:e.fontCatalog.textureSize,size:e.fontCatalog.size,distanceRange:e.fontCatalog.distanceRange,isMsdf:"msdf"===e.fontCatalog.type,isBackground:!0===e.isBackground,vertexSource:e.vertexSource,fragmentSource:e.fragmentSource,rendererCapabilities:e.rendererCapabilities})}},1741:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypesettingUtils=void 0;const n=i(433),r=i(5448),s=i(1662),o=i(8533);var a;(a=t.TypesettingUtils||(t.TypesettingUtils={})).EM_TO_PX=16,a.PT_TO_PX=1.25,a.OBLIQUE_ANGLE=.174533,a.OBLIQUE_OFFSET=Math.tan(a.OBLIQUE_ANGLE),a.getPixelSize=function(e,t,i){let n=e;switch(t){case s.FontUnit.Em:n*=a.EM_TO_PX;break;case s.FontUnit.Point:n*=a.PT_TO_PX;break;case s.FontUnit.Percent:n*=.01*i}return n},a.getSmallCapsScale=function(e,t,i,n){return t[i]&&n===s.FontVariant.SmallCaps?e[i].font.metrics.xHeight/e[i].font.metrics.capHeight:1},a.getDirection=function(e,t){let i=o.UnicodeUtils.Direction.LTR,n=t;for(;e[n].direction!==o.UnicodeUtils.Direction.LTR&&e[n].direction!==o.UnicodeUtils.Direction.RTL&&n<e.length-1;)++n;return 1===Math.abs(e[n].direction)&&(i=e[n].direction),i},a.computeGlyphTransform=function(e,t,i,n,r){const s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r);e.set(i*a,i*-l,s*t.x-o*t.y,i*l,i*a,o*t.x+s*t.y,0,0,1)},a.updateBounds=function(e,t,i){const s=Math.min(e[0].x,e[1].x,e[2].x,e[3].x),o=Math.max(e[0].x,e[1].x,e[2].x,e[3].x),a=Math.min(e[0].y,e[1].y,e[2].y,e[3].y),l=Math.max(e[0].y,e[1].y,e[2].y,e[3].y);void 0!==i&&(void 0!==i.array[i.offset]?(i.array[i.offset].min.set(s,a),i.array[i.offset].max.set(o,l)):i.array.push(new n.Box2(new r.Vector2(s,a),new r.Vector2(o,l))),++i.offset),t.min.set(Math.min(t.min.x,s),Math.min(t.min.y,a)),t.max.set(Math.max(t.max.x,o),Math.max(t.max.y,l))},a.fontSizeAlignmentFactor=.964,a.alignBackgroundWidth=function(e,t){return 11.5*t/Math.sqrt(e)}},8533:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeUtils=void 0,function(e){let t;e.whiteSpaceRanges=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]],e.isWhiteSpace=function(t){for(const i of e.whiteSpaceRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.newLineRanges=[[10,13],[133,133],[8232,8233]],e.isNewLine=function(t){for(const i of e.newLineRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.nonPrintableRanges=[[0,31],[127,159]],e.isPrintable=function(t){for(const i of e.nonPrintableRanges)if(t>=i[0]&&t<=i[1])return!1;return!0},function(e){e[e.Neutral=0]="Neutral",e[e.Weak=.5]="Weak",e[e.LTR=1]="LTR",e[e.RTL=-1]="RTL"}(t=e.Direction||(e.Direction={})),e.rtlBlocks=["Hebrew","Alphabetic Presentation Forms","Arabic","Arabic Supplement","Arabic Extended-A","Arabic Presentation Forms-A","Arabic Presentation Forms-B","Arabic Mathematical Alphabetic Symbols","Indic Siyaq Numbers","Rumi Numeral Symbols","Syriac","Syriac Supplement","Samaritan","Mandaic","Thaana","Mende Kikakui","NKo","Adlam","Hanifi Rohingya"],e.neutralBidirectionalRanges=[[32,47],[58,64],[91,96],[123,126]],e.weakBidirectionalRanges=[[48,57],[1632,1641],[1776,1785]],e.getDirection=function(i,n){for(const n of e.weakBidirectionalRanges)if(i>=n[0]&&i<=n[1])return t.Weak;for(const n of e.neutralBidirectionalRanges)if(i>=n[0]&&i<=n[1])return t.Neutral;return void 0!==e.rtlBlocks.find((e=>e===n))?t.RTL:t.LTR},e.rtlMirroredCodePoints=[40,41,60,62,91,93,123,125],e.isRtlMirrored=function(t){return void 0!==e.rtlMirroredCodePoints.find((e=>e===t))}}(t.UnicodeUtils||(t.UnicodeUtils={}))},1984:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7259),t),r(i(8284),t),r(i(1017),t),r(i(1370),t),r(i(1216),t),r(i(5771),t),r(i(8131),t),r(i(6304),t),r(i(8023),t)},1667:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorUtils=void 0;const n=i(5971),r=i(3334),s=i(8263),o=i(797),a=i(7610),l=255,c=new n.Color,h={h:0,s:0,l:0};!function(e){function t(e,t){return(0,r.clamp)(e+(t<0?e:1-e)*t,0,1)}function i(e,t,i){let n;if(a.RGBA.isRGBA(t))n=e.equals(t)===i;else if("string"==typeof t){const r=u.get(t);if(r)n=e.equals(r)===i;else{const r=a.RGBA.parse(t);void 0!==r&&(u.set(t,r),n=e.equals(r)===i)}}return n}e.getHexFromRgba=function(e,t,i,n){return(0,o.assert)(n>=0&&n<=1),l-Math.floor(n*l)<<24^e*l<<16^t*l<<8^i*l},e.getHexFromRgb=function(e,t,i){return(0,o.assert)(e>=0&&e<=1),(0,o.assert)(t>=0&&t<=1),(0,o.assert)(i>=0&&i<=1),e*l<<16^t*l<<8^i*l},e.getHexFromHsl=function(e,t,i){return(0,o.assert)(e>=0&&e<=1),(0,o.assert)(t>=0&&t<=1),(0,o.assert)(i>=0&&i<=1),c.setHSL(e,t,i).getHex()},e.darken=function(e,t){return c.setRGB(e.r,e.g,e.b),c.getHSL(h),h.l=(0,r.clamp)(h.l-t,0,1),c.setHSL(h.h,h.s,h.l),e.r=c.r,e.g=c.g,e.b=c.b,e},e.scaleColor=function(e,i){return c.setRGB(e.r,e.g,e.b),c.getHSL(h),h.s=t(h.s,i.s),h.l=t(h.l,i.l),c.setHSL(h.h,h.s,h.l),e.r=c.r,e.g=c.g,e.b=c.b,e.a=t(e.a,i.a),e},e.getRgbaFromHex=function(e,t=new a.RGBA){return(0,o.assert)(!0,"Wrong hex format"),t.r=(e>>16&l)/l,t.g=(e>>8&l)/l,t.b=(e&l)/l,t.a=(l-(e>>24&l))/l,t},e.hasAlphaInHex=function(e){return(0,o.assert)(!0,"Wrong hex format"),!!(e>>24)},e.getAlphaFromHex=function(e){return(0,o.assert)(!0,"Wrong hex format"),(l-(e>>24)&l)/l},e.removeAlphaFromHex=function(e){return(0,o.assert)(!0,"Wrong hex format"),16777215&e},e.comparePotentiallyRGBA=function(e,t,n){let r;return a.RGBA.isRGBA(e)?r=i(e,t,n):a.RGBA.isRGBA(t)&&(r=i(t,e,n)),r}}(t.ColorUtils||(t.ColorUtils={}));const u=new s.LRUCache(500)},7259:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapEnv=t.Env=void 0;class i{static isEnv(e){return e instanceof i}lookup(e){}unmap(){return{}}}t.Env=i,t.MapEnv=class extends i{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},8284:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateJsonExpr=void 0;const n=i(7259),r=i(8023);t.evaluateJsonExpr=function(e,t,i){return r.Expr.fromJSON(e,i).evaluate(new n.MapEnv(t),r.ExprScope.Value)}},8023:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.InterpolateExpr=t.StepExpr=t.CaseExpr=t.MatchExpr=t.LookupExpr=t.CallExpr=t.HasAttributeExpr=t.ObjectLiteralExpr=t.StringLiteralExpr=t.NumberLiteralExpr=t.BooleanLiteralExpr=t.NullLiteralExpr=t.LiteralExpr=t.VarExpr=t.Expr=t.ExprScope=t.ExprDependencies=void 0;const s=i(5448),o=i(6815),a=i(6577),l=i(2302),c=i(908),h=i(8628),u=i(1017),d=i(1324),m=i(7610),p=i(5771);r(i(7259),t);const f=new l.ExprEvaluator,g=new c.ExprInstantiator;class v{constructor(){this.properties=new Set}}t.ExprDependencies=v;class _{static of(e){const t=new v;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitCallExpr(e,t){switch(e.args.forEach((e=>e.accept(this,t))),e.op){case"dynamic-properties":t.volatile=!0;break;case"feature-state":t.featureState=!0,t.properties.add("$state"),t.properties.add("$id");break;case"id":t.properties.add("$id");break;case"zoom":case"world-ppi-scale":case"world-discrete-ppi-scale":t.properties.add("$zoom");break;case"pixel-world-scale":t.properties.add("$pixelToMeters");break;case"geometry-type":t.properties.add("$geometryType")}}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach((([e,i])=>i.accept(this,t))),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach((([e,i])=>{e.accept(this,t),i.accept(this,t)})),e.fallback.accept(this,t)}visitStepExpr(e,t){e.input.accept(this,t),e.defaultValue.accept(this,t),e.stops.forEach((([e,i])=>i.accept(this,t)))}visitInterpolateExpr(e,t){e.input.accept(this,t),e.stops.forEach((([e,i])=>i.accept(this,t)))}}var y;_.instance=new _,function(e){e[e.Value=0]="Value",e[e.Condition=1]="Condition",e[e.Dynamic=2]="Dynamic"}(y=t.ExprScope||(t.ExprScope={}));class x{static isExpr(e){return e instanceof x}static fromJSON(e,t,i,n){return U(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:null!=i?i:new Map,referencedDefinitions:null!=n?n:new Set}:void 0)}evaluate(e,t=y.Value,i){return this.accept(f,new l.ExprEvaluatorContext(f,e,t,i))}instantiate(e){return this.accept(g,e)}dependencies(){return this.m_dependencies||(this.m_dependencies=_.of(this)),this.m_dependencies}intern(e){return e.add(this)}toJSON(){return(new F).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}getPoolKey(e=!1){return"E"}}t.Expr=x;class S extends x{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}getPoolKey(){return this.name}}t.VarExpr=S;class b extends x{static fromValue(e,t){switch(typeof e){case"boolean":return new M(e);case"number":return new w(e);case"string":return new E(e);case"object":return null===e?T.instance:new C(e,t);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=b;class T extends b{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}getPoolKey(){return"N"}}t.NullLiteralExpr=T,T.instance=new T;class M extends b{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}getPoolKey(){return"B"}}t.BooleanLiteralExpr=M,M.trueInstance=new M(!0),M.falseInstance=new M(!1);class w extends b{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}getPoolKey(){return this.value}}t.NumberLiteralExpr=w;class E extends b{constructor(e){super(),this.value=e}get promotedValue(){var e,t,i;return void 0===this.m_promotedValue&&(this.m_promotedValue=null!==(t=null!==(e=m.RGBA.parse(this.value))&&void 0!==e?e:d.Pixels.parse(this.value))&&void 0!==t?t:null),null!==(i=this.m_promotedValue)&&void 0!==i?i:void 0}accept(e,t){return e.visitStringLiteralExpr(this,t)}getPoolKey(){return this.value.length}}t.StringLiteralExpr=E;class C extends b{constructor(e,t){super(),this.value=e,this.id=t}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}static get nextID(){return this.m_nextID++}}t.ObjectLiteralExpr=C,C.m_nextID=0;class A extends x{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}getPoolKey(){return this.name}}t.HasAttributeExpr=A;class P extends x{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){var e,t;const i=null!==(e=this.descriptor)&&void 0!==e?e:l.ExprEvaluator.getOperator(this.op);return!!(null===(t=null==i?void 0:i.isDynamicOperator)||void 0===t?void 0:t.call(i,this))||this.args.some((e=>e.isDynamic()))}getPoolKey(e=!1){return e?this.args[0].getPoolKey():this.op}}t.CallExpr=P;class R extends P{static parseArray(e,t){const i=e[1];if(void 0===i)throw new Error("missing lookup table in 'lookup' expression");const n=U(i,t);if(!(Array.isArray(i)&&n instanceof C))throw new Error("Invalid lookup table expression for operator 'lookup'. It must be a literal or a ref to one.");const r=n.value;if(!(Array.isArray(r)||r instanceof Map))throw new Error(`Invalid lookup table type (${typeof r}) for operator 'lookup'`);const s=e.slice(2).map((e=>U(e,t)));return s.unshift(n),new R(s)}constructor(e){super("lookup",e),this.args=e}accept(e,t){return e.visitLookupExpr(this,t)}}t.LookupExpr=R;class L extends x{static isValidMatchLabel(e){switch(typeof e){case"number":case"string":return!0;case"object":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every((e=>typeof e===t));default:return!1}}constructor(e,t,i){super(),this.value=e,this.branches=t,this.fallback=i}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some((([e,t])=>t.isDynamic()))||this.fallback.isDynamic()}getPoolKey(){return this.fallback.getPoolKey()}}t.MatchExpr=L;class D extends x{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some((([e,t])=>e.isDynamic()||t.isDynamic()))||this.fallback.isDynamic()}getPoolKey(e=!1){return e?this.fallback.getPoolKey():this.branches.length}}t.CaseExpr=D;class I extends x{constructor(e,t,i){super(),this.input=e,this.defaultValue=t,this.stops=i}accept(e,t){return e.visitStepExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.defaultValue.isDynamic()||this.stops.some((([e,t])=>t.isDynamic()))}getPoolKey(e=!1){return e?this.defaultValue.getPoolKey():this.stops.length}}t.StepExpr=I;class O extends x{constructor(e,t,i){super(),this.mode=e,this.input=t,this.stops=i}accept(e,t){return e.visitInterpolateExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.stops.some((([e,t])=>t.isDynamic()))}getPoolKey(e=!1){return e?this.stops[0][0]:this.stops.length}}t.InterpolateExpr=O;class F{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){if(e.value instanceof s.Vector2)return["make-vector",e.value.x,e.value.y];if(e.value instanceof o.Vector3)return["make-vector",e.value.x,e.value.y,e.value.z];if(e.value instanceof a.Vector4)return["make-vector",e.value.x,e.value.y,e.value.z,e.value.w];const i=["literal",e.value];return void 0!==e.id&&(i[2]=e.id),i}visitVarExpr(e,t){return["get",e.name]}visitHasAttributeExpr(e,t){return["has",e.name]}visitCallExpr(e,t){return[e.op,...e.args.map((e=>this.serialize(e)))]}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitMatchExpr(e,t){const i=[];for(const[t,n]of e.branches)i.push(t,this.serialize(n));return["match",this.serialize(e.value),...i,this.serialize(e.fallback)]}visitCaseExpr(e,t){const i=[];for(const[t,n]of e.branches)i.push(this.serialize(t),this.serialize(n));return["case",...i,this.serialize(e.fallback)]}visitStepExpr(e,t){const i=["step"];return i.push(this.serialize(e.input)),i.push(this.serialize(e.defaultValue)),e.stops.forEach((([e,t])=>{i.push(e),i.push(this.serialize(t))})),i}visitInterpolateExpr(e,t){const i=["interpolate",e.mode];return i.push(this.serialize(e.input)),e.stops.forEach((([e,t])=>{i.push(e),i.push(this.serialize(t))})),i}}function U(e,t){if(Array.isArray(e))return V(e,t);if(null===e)return T.instance;switch(typeof e){case"number":return new w(e);case"string":return new E(e);case"boolean":return new M(e);default:if(m.RGBA.isRGBA(e))return new C(e);throw new Error(`failed to create expression from: ${JSON.stringify(e)}`)}}function V(e,t){const i=e[0];if("string"!=typeof i)throw new Error("expected a builtin function name");switch(i){case"!has":case"!in":return new P("!",[V([i.slice(1),...e.slice(1)])]);case"ref":return function(e,t){if("string"!=typeof e[1])throw new Error("expected the name of an attribute");if(void 0===t)throw new Error("ref used with no definitions");const i=e[1];if(t.lockedNames.has(i))throw new Error(`circular reference to '${i}'`);if(!(i in t.definitions))throw new Error(`definition '${i}' not found`);t.referencedDefinitions.add(i);const n=t.cache.get(i);if(void 0!==n)return n;let r,s=t.definitions[i];const o=(0,p.getDefinitionValue)(s);if((0,h.isInterpolatedPropertyDefinition)(o))return x.fromJSON((0,h.interpolatedPropertyDefinitionToJsonExpr)(s));if(!(0,u.isJsonExpr)(o))return x.fromJSON(o);if(s=o,!(0,u.isJsonExpr)(s))throw new Error(`unsupported definition ${i}`);t.lockedNames.add(i);try{r=U(s,t)}finally{t.lockedNames.delete(i)}return t.cache.set(i,r),r.isCached=!0,r}(e,t);case"get":return function(e,t){if(void 0!==e[2])return N("get",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new S(i)}(e,t);case"has":return function(e,t){if(void 0!==e[2])return N("has",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new A(i)}(e,t);case"literal":return function(e){const t=e[1];if(null===t||"object"!=typeof t)throw new Error("expected an object or array literal");const i=e[2];return new C(t,i)}(e);case"match":return function(e,t){if(e.length<4)throw new Error("not enough arguments");if(!(e.length%2))throw new Error("fallback is missing in 'match' expression");const i=U(e[1],t),n=[];for(let i=2;i<e.length-1;i+=2){const r=e[i];if(!L.isValidMatchLabel(r))throw new Error(`'${JSON.stringify(r)}' is not a valid label for 'match'`);const s=U(e[i+1],t);n.push([r,s])}const r=U(e[e.length-1],t);return new L(i,n,r)}(e,t);case"case":return function(e,t){if(e.length<3)throw new Error("not enough arguments");if(e.length%2)throw new Error("fallback is missing in 'case' expression");const i=[];for(let n=1;n<e.length-1;n+=2){const r=U(e[n],t),s=U(e[n+1],t);i.push([r,s])}const n=U(e[e.length-1],t);return new D(i,n)}(e,t);case"interpolate":return function(e,t){const i=e[1];if(!function(e){if(!Array.isArray(e))return!1;switch(e[0]){case"discrete":case"linear":case"cubic":case"exponential":return!0;default:return!1}}(i))throw new Error("expected an interpolation type");if("exponential"===i[0]&&"number"!=typeof i[1])throw new Error("expected the base of the exponential interpolation");const n=void 0!==e[2]?U(e[2],t):void 0;if(!x.isExpr(n))throw new Error("expected the input of the interpolation");if(3===e.length||!(e.length%2))throw new Error("invalid number of samples");const r=[];for(let i=3;i<e.length-1;i+=2){const n=e[i],s=U(e[i+1],t);r.push([n,s])}return new O(i,n,r)}(e,t);case"step":return function(e,t){if(e.length<2)throw new Error("expected the input of the 'step' operator");if(e.length<3||!(e.length%2))throw new Error("not enough arguments");const i=U(e[1],t),n=U(e[2],t),r=[];for(let i=3;i<e.length;i+=2){const n=e[i],s=U(e[i+1],t);r.push([n,s])}return new I(i,n,r)}(e,t);case"lookup":return R.parseArray(e,t);default:return N(i,e,t)}}function N(e,t,i){return new P(e,t.slice(1).map((e=>U(e,i))))}},2302:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprEvaluator=t.ExprEvaluatorContext=void 0;const n=i(5971),r=i(3334),s=i(5448),o=i(6815),a=i(6577),l=i(8023),c=i(6073),h=i(7290),u=i(4672),d=i(8998),m=i(1954),p=i(2181),f=i(202),g=i(4054),v=i(9764),_=i(7029),y=i(3501),x=i(5113),S=i(545),b=i(1324),T=i(7610),M=new Map;function w(e,t){var i,n,r;if(t instanceof l.StringLiteralExpr)return null!==(i=t.promotedValue)&&void 0!==i?i:t.value;const s=e.evaluate(t);return"string"==typeof s&&null!==(r=null!==(n=T.RGBA.parse(s))&&void 0!==n?n:b.Pixels.parse(s))&&void 0!==r?r:s}t.ExprEvaluatorContext=class{constructor(e,t,i,n){this.evaluator=e,this.env=t,this.scope=i,this.cache=n}evaluate(e){var t,i;if(void 0===e)throw new Error("Failed to evaluate expression");const n=null===(t=this.cache)||void 0===t?void 0:t.get(e);if(void 0!==n)return n;const r=e.accept(this.evaluator,this);return null===(i=this.cache)||void 0===i||i.set(e,r),r}wrapValue(e,t){return l.Expr.isExpr(e)?e:l.LiteralExpr.fromValue(e,t)}};class E{static defineOperator(e,t){M.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach((t=>{this.defineOperator(t,e[t])}))}static getOperator(e){return M.get(e)}visitVarExpr(e,t){const i=t.env.lookup(e.name);return void 0!==i?i:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitMatchExpr(e,t){const i=t.evaluate(e.value);for(const[n,r]of e.branches){if(Array.isArray(n)&&n.includes(i))return t.evaluate(r);if(n===i)return t.evaluate(r)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){if(t.scope===l.ExprScope.Value){const i=e.branches.findIndex((([e,t])=>e.isDynamic()));if(-1!==i){let n;for(let r=0;r<e.branches.length;++r){const[s,o]=e.branches[r],a=t.evaluate(s),c=t.evaluate(o);if(r<i&&Boolean(a))return c;if((l.Expr.isExpr(a)||Boolean(a))&&(void 0===n&&(n=[]),null==n||n.push([t.wrapValue(a),t.wrapValue(c)]),!l.Expr.isExpr(a)&&Boolean(a)))return new l.CaseExpr(n,l.LiteralExpr.fromValue(null))}const r=t.evaluate(e.fallback);return void 0===n?r:new l.CaseExpr(n,t.wrapValue(r))}}for(const[i,n]of e.branches)if(t.evaluate(i))return t.evaluate(n);return t.evaluate(e.fallback)}visitCallExpr(e,t){var i;const n=null!==(i=e.descriptor)&&void 0!==i?i:M.get(e.op);if(n){let i;if(e.descriptor=n,t.scope===l.ExprScope.Value&&e.isDynamic()){if(e.descriptor.partialEvaluate)return e.descriptor.partialEvaluate(t,e);const n=e.args.map((e=>t.wrapValue(t.evaluate(e),e.id)));if(n.every(((t,i)=>t===e.args[i])))return e;i=new l.CallExpr(e.op,n)}else i=n.call(t,e);return i}throw new Error(`undefined operator '${e.op}'`)}visitLookupExpr(e,t){return this.visitCallExpr(e,t)}visitStepExpr(e,t){if(t.scope===l.ExprScope.Value){const i=t.evaluate(e.input),n=t.evaluate(e.defaultValue);return new l.StepExpr(t.wrapValue(i),t.wrapValue(n),e.stops.map((([e,i])=>{const n=t.evaluate(i);return[e,t.wrapValue(n)]})))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error(`input '${i}' must be a number`);if(i<e.stops[0][0])return t.evaluate(e.defaultValue);let n=e.stops.findIndex((e=>e[0]>i));return-1===n&&(n=e.stops.length),t.evaluate(e.stops[n-1][1])}}visitInterpolateExpr(e,t){if(t.scope===l.ExprScope.Value){const i=t.evaluate(e.input);return new l.InterpolateExpr(e.mode,t.wrapValue(i),e.stops.map((([e,i])=>{const n=t.evaluate(i);return[e,t.wrapValue(n)]})))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error("input must be a number");if("cubic"===e.mode[0])return function(e,t,i){if(i<t.stops[0][0])return w(e,t.stops[0][1]);if(i>=t.stops[t.stops.length-1][0])return w(e,t.stops[t.stops.length-1][1]);const l=t.stops.findIndex((e=>e[0]>i)),c=Math.max(0,l-1),h=0===c?l:c-1,u=l<t.stops.length-1?l+1:l-1,d=t.stops[h][0],m=t.stops[c][0],p=t.stops[l][0],f=.5*(p-m),g=f/(m-d),v=f/(t.stops[u][0]-p),_=(i-m)/(p-m),y=_*_,x=y*_,S=-g*x+2*g*y-g*_,M=(1+g)*x+(-1.5-2*g)*y+(-.5+g)*_+1,E=(-1-v)*x+(1.5+v)*y+.5*_,C=v*x-v*y,A=w(e,t.stops[h][1]),P=w(e,t.stops[c][1]),R=w(e,t.stops[l][1]),L=w(e,t.stops[u][1]);if("number"==typeof A&&"number"==typeof P&&"number"==typeof R&&"number"==typeof L)return S*A+M*P+E*R+C*L;if(A instanceof T.RGBA&&P instanceof T.RGBA&&R instanceof T.RGBA&&L instanceof T.RGBA)return new T.RGBA((0,r.clamp)(S*A.r+M*P.r+E*R.r+C*L.r,0,1),(0,r.clamp)(S*A.g+M*P.g+E*R.g+C*L.g,0,1),(0,r.clamp)(S*A.b+M*P.b+E*R.b+C*L.b,0,1),(0,r.clamp)(S*A.a+M*P.a+E*R.a+C*L.a,0,1));if(A instanceof b.Pixels&&P instanceof b.Pixels&&R instanceof b.Pixels&&L instanceof b.Pixels)return new b.Pixels(S*A.value+M*P.value+E*R.value+C*L.value);if(A instanceof n.Color&&P instanceof n.Color&&R instanceof n.Color&&L instanceof n.Color)return new n.Color(S*A.r+M*P.r+E*R.r+C*L.r,S*A.g+M*P.g+E*R.g+C*L.g,S*A.b+M*P.b+E*R.b+C*L.b);if(A instanceof s.Vector2&&P instanceof s.Vector2&&R instanceof s.Vector2&&L instanceof s.Vector2)return new s.Vector2(S*A.x+M*P.x+E*R.x+C*L.x,S*A.y+M*P.y+E*R.y+C*L.y);if(A instanceof o.Vector3&&P instanceof o.Vector3&&R instanceof o.Vector3&&L instanceof o.Vector3)return new o.Vector3(S*A.x+M*P.x+E*R.x+C*L.x,S*A.y+M*P.y+E*R.y+C*L.y,S*A.z+M*P.z+E*R.z+C*L.z);if(A instanceof a.Vector4&&P instanceof a.Vector4&&R instanceof a.Vector4&&L instanceof a.Vector4)return new a.Vector4(S*A.x+M*P.x+E*R.x+C*L.x,S*A.y+M*P.y+E*R.y+C*L.y,S*A.z+M*P.z+E*R.z+C*L.z,S*A.w+M*P.w+E*R.w+C*L.w);if(Array.isArray(A)&&Array.isArray(P)&&Array.isArray(R)&&Array.isArray(L)){const e=A.length,t=[];for(let i=0;i<e;++i)t[i]=S*A[i]+M*P[i]+E*R[i]+C*L[i];return t}throw new Error("failed to interpolate values")}(t,e,i);const l=e.stops.findIndex((e=>e[0]>i));if(-1===l)return t.evaluate(e.stops[e.stops.length-1][1]);if(0===l)return t.evaluate(e.stops[0][1]);const[c,h]=e.stops[l],[u,d]=e.stops[l-1],m=w(t,d);let p=0;switch(e.mode[0]){case"discrete":return m;case"linear":p=(i-u)/(c-u);break;case"exponential":{const t=e.mode[1];p=1===t?(i-u)/(c-u):(Math.pow(t,i-u)-1)/(Math.pow(t,c-u)-1);break}default:throw new Error(`interpolation mode ${JSON.stringify(e.mode)} is not supported`)}const f=w(t,h);if("number"==typeof m&&"number"==typeof f)return(0,r.lerp)(m,f,p);if(m instanceof T.RGBA&&f instanceof T.RGBA)return m.clone().lerp(f,p);if(m instanceof b.Pixels&&f instanceof b.Pixels)return new b.Pixels((0,r.lerp)(m.value,f.value,p));if(m instanceof n.Color&&f instanceof n.Color)return m.clone().lerp(f,p);if(m instanceof s.Vector2&&f instanceof s.Vector2)return m.clone().lerp(f,p);if(m instanceof o.Vector3&&f instanceof o.Vector3)return m.clone().lerp(f,p);if(m instanceof a.Vector4&&f instanceof a.Vector4)return m.clone().lerp(f,p);if(Array.isArray(m)&&Array.isArray(f)&&m.length===f.length)return m.map(((e,t)=>(0,r.lerp)(e,f[t],p)));throw new Error(`todo: mix(${JSON.stringify(m)}, ${JSON.stringify(f)}, ${p})`)}}}t.ExprEvaluator=E,E.defineOperators(h.CastOperators),E.defineOperators(d.ComparisonOperators),E.defineOperators(g.MathOperators),E.defineOperators(y.StringOperators),E.defineOperators(u.ColorOperators),E.defineOperators(x.TypeOperators),E.defineOperators(v.MiscOperators),E.defineOperators(p.FlowOperators),E.defineOperators(c.ArrayOperators),E.defineOperators(_.ObjectOperators),E.defineOperators(m.FeatureOperators),E.defineOperators(f.MapOperators),E.defineOperators(S.VectorOperators)},908:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprInstantiator=void 0;const n=i(7259),r=i(8023),s=new n.Env;t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=t.env.lookup(e.name);return r.LiteralExpr.fromValue(void 0!==i?i:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=void 0!==t.env.lookup(e.name);return r.LiteralExpr.fromValue(i)}visitCallExprImpl(e,t,i){const n=e.args.map((e=>e.accept(this,t)));return n.some(((t,i)=>t!==e.args[i]))?i(e.op,n):e}visitCallExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new r.CallExpr(e,t)))}visitLookupExpr(e,t){return this.visitCallExprImpl(e,t,((e,t)=>new r.LookupExpr(t)))}visitMatchExpr(e,t){const i=e.value.accept(this,t);if(i instanceof r.LiteralExpr){const n=i.value;for(const[i,r]of e.branches){if(Array.isArray(i)&&i.includes(n))return r.accept(this,t);if(i===n)return r.accept(this,t)}return e.fallback.accept(this,t)}let n=e.value!==i;const s=e.branches.map((([e,i])=>{const r=i.accept(this,t);return r!==i&&(n=!0),[e,r]})),o=e.fallback.accept(this,t);return o!==e.fallback&&(n=!0),n?new r.MatchExpr(i,s,o):e}visitCaseExpr(e,t){const i=[];let n=!1;for(const[o,a]of e.branches){const e=o.accept(this,t),l=e.dependencies();if(o.isDynamic()||0!==l.properties.size)e!==o&&(n=!0),i.push([e,a]);else if(Boolean(e.evaluate(s,r.ExprScope.Condition)))return a.accept(this,t)}if(0===i.length)return e.fallback.accept(this,t);i.length!==e.branches.length&&(n=!0),i.forEach((e=>{const i=e[1].accept(this,t);i!==e[1]&&(n=!0),e[1]=i}));const o=e.fallback.accept(this,t);return o!==e.fallback&&(n=!0),n?new r.CaseExpr(i,o):e}visitStepExpr(e,t){const i=e.input.accept(this,t),n=e.defaultValue.accept(this,t),s=e.stops.map((([e,i])=>[e,i.accept(this,t)]));return new r.StepExpr(i,n,s)}visitInterpolateExpr(e,t){const i=e.input.accept(this,t),n=e.stops.map((([e,i])=>[e,i.accept(this,t)]));return new r.InterpolateExpr(e.mode,i,n)}}},8797:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprPool=t.INTERNED=void 0;const n=i(797),r=i(8023);var s;!function(e){e[e.CALL=0]="CALL",e[e.LOOKUP=1]="LOOKUP"}(s||(s={})),t.INTERNED=Symbol("i");const o=(e,t=!1)=>{var i,n,r,s;let a;return a=e instanceof Object?Array.isArray(e)?o(null!==(i=e[1])&&void 0!==i?i:e[0],t):null!==(s=null!==(r=null===(n=null==e?void 0:e.getPoolKey)||void 0===n?void 0:n.call(e,t))&&void 0!==r?r:null==e?void 0:e.constructor.name.substring(0,3))&&void 0!==s?s:"?":"number"==typeof e?e:String(e).substring(0,3),a};t.ExprPool=class{constructor(){this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiteralsByID=new Map,this.m_objectLiterals=[],this.m_arrayLiterals=[],this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_matchExprs=[],this.m_caseExprs=new Map,this.m_interpolateExprs=new Map,this.m_stepExprs=[],this.m_callExprs=new Map,this.m_arrays=new Map,this.m_objects=new Map}add(e){return e.accept(this,void 0)}clear(){this.m_numberLiterals.clear(),this.m_stringLiterals.clear(),this.m_objectLiteralsByID.clear(),this.m_objectLiterals.length=0,this.m_arrayLiterals.length=0,this.m_varExprs.clear(),this.m_hasAttributeExprs.clear(),this.m_matchExprs.length=0,this.m_caseExprs.clear(),this.m_interpolateExprs.clear(),this.m_stepExprs.length=0,this.m_callExprs.clear(),this.m_arrays.clear(),this.m_objects.clear()}stats(){const e=new Map;e.set("m_numberLiterals",this.m_numberLiterals.size),e.set("m_stringLiterals",this.m_stringLiterals.size),e.set("m_objectLiteralsByID",this.m_objectLiteralsByID.size),e.set("m_objectLiterals",this.m_objectLiterals.length),e.set("m_arrayLiterals",this.m_arrayLiterals.length),e.set("m_varExprs",this.m_varExprs.size),e.set("m_hasAttributeExprs",this.m_varExprs.size),e.set("m_matchExprs",this.m_matchExprs.length),e.set("m_caseExprs",Array.from(this.m_caseExprs).reduce(((e,t)=>Array.from(t[1]).reduce(((e,t)=>e+t[1].length),e)),0)),e.set("m_interpolateExprs",Array.from(this.m_interpolateExprs).reduce(((e,t)=>e+t[1].length),0)),e.set("m_stepExprs",this.m_stepExprs.length),e.set("m_callExprs",Array.from(this.m_callExprs).reduce(((e,t)=>Array.from(t[1]).reduce(((e,t)=>e+t[1].length),e)),0)),e.set("m_arrays",Array.from(this.m_arrays).reduce(((e,t)=>Array.from(t[1]).reduce(((e,t)=>Array.from(t[1]).reduce(((e,t)=>e+t[1].length),e)),e)),0)),e.set("m_objects",Array.from(this.m_objects).reduce(((e,t)=>Array.from(t[1]).reduce(((e,t)=>Array.from(t[1]).reduce(((e,t)=>e+t[1].length),e)),e)),0)),e.set("TOTAL interned",Array.from(e).reduce(((e,t)=>e+t[1]),0)),console.dir(e)}internValue(e,i){if(null==e?void 0:e[t.INTERNED])return e;let n;return n=Array.isArray(e)?this.internArray(e,i):e instanceof r.Expr?e.accept(this,i):null!==e&&e instanceof Object?this.internObject(e):e,n}internArray(e,i){if(e[t.INTERNED])return e;const n=this.m_arrays;let r=e.length,s=n.get(r);s||n.set(r,s=new Map);let a=o(e[0]),l=s.get(a);l||s.set(a,l=new Map);const c=a;a=r<2?o(e[0],!0):o(e[1]),a===c&&(a=o(e[0],!0));let h=l.get(a);h||l.set(a,h=[]);let u=0;for(const t of e)e[u++]=this.internValue(t);for(const t of h){for(u=r;u--&&t[u]===e[u];);if(u<0)return t}return h.push(e),e[t.INTERNED]=!0,e}internObject(e,i){var n,r;if(e[t.INTERNED])return e;const s=this.m_objects,o=Object.keys(e);let a=o.length,l=s.get(a);l||s.set(a,l=new Map),a=o[0];let c=l.get(a);c||l.set(a,c=new Map);let h=e[a];if(h instanceof Object)for(const e in h){h=h[e];break}a=h instanceof Object?null!==(r=null===(n=null==h?void 0:h.getPoolKey)||void 0===n?void 0:n.call(h))&&void 0!==r?r:h.constructor.name:h;let u=c.get(a);u||c.set(a,u=[]);for(const t of o)e[t]=this.internValue(e[t]);for(const t of u){let i=0;for(const n of o){if(t[n]!==e[n])break;i++}if(i===a)return t}return u.push(e),e[t.INTERNED]=!0,e}visitNullLiteralExpr(e,t){return r.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){return e.value?r.BooleanLiteralExpr.trueInstance:r.BooleanLiteralExpr.falseInstance}visitNumberLiteralExpr(e,t){var i;const n=this.m_numberLiterals,r=e.value;return null!==(i=n.get(r))&&void 0!==i?i:(n.set(r,e),e)}visitStringLiteralExpr(e,t){var i;const n=this.m_stringLiterals,r=e.value;return null!==(i=n.get(r))&&void 0!==i?i:(n.set(r,e),e)}visitObjectLiteralExpr(e,t){let i;const s=e.id;if(void 0!==s){if(i=this.m_objectLiteralsByID.get(s),!i){const t=this.internValue(e.value);i=new r.ObjectLiteralExpr(t,s),this.m_objectLiteralsByID.set(s,i)}}else{(0,n.assert)(!1,"ObjectLiteralExpr without id");const t=e.isArrayLiteral?this.m_arrayLiterals:this.m_objectLiterals;if(t.includes(e))i=e;else{const n=this.internValue(e.value);for(const e of t)if(e.value===n){i=e;break}i||(i=new r.ObjectLiteralExpr(n),t.push(i))}}return i}visitVarExpr(e,t){var i;const n=this.m_varExprs,r=e.name;return null!==(i=n.get(r))&&void 0!==i?i:(n.set(r,e),e)}visitHasAttributeExpr(e,t){var i;const n=this.m_hasAttributeExprs,r=e.name;return null!==(i=n.get(r))&&void 0!==i?i:(n.set(r,e),e)}visitMatchExpr(e,t){const i=this.m_matchExprs;if(i.includes(e))return e;const n=e.value.accept(this,t),s=this.internArray(e.branches,t),o=e.fallback.accept(this,t);for(const e of i)if(e.value===n&&e.branches===s&&e.fallback===o)return e;const a=new r.MatchExpr(n,s,o);return i.push(a),a}visitCaseExpr(e,t){const i=this.m_caseExprs;let n=e.branches.length,s=i.get(n);s||i.set(n,s=new Map),n=e.branches[0][0].getPoolKey();let o=s.get(n);if(o){if(o.includes(e))return e}else s.set(n,o=[]);const a=this.internArray(e.branches),l=e.fallback.accept(this,t);for(const e of o)if(e.branches===a&&e.fallback===l)return e;const c=new r.CaseExpr(a,l);return o.push(c),c}visitCallExprImpl(e,t,i){if(e.isCached)return e;const n=this.m_callExprs;let a=e.op,l=n.get(a);l||n.set(a,l=new Map),a=o(e.args[0]);let c=l.get(a);c||l.set(a,c=[]);const h=this.internArray(e.args);for(const e of c)if(e.args===h)return e;const u=i===s.CALL?new r.CallExpr(e.op,h):new r.LookupExpr(h);return e.descriptor&&(u.descriptor=e.descriptor),c.push(u),u}visitCallExpr(e,t){return this.visitCallExprImpl(e,t,s.CALL)}visitLookupExpr(e,t){return this.visitCallExprImpl(e,t,s.LOOKUP)}visitStepExpr(e,t){const i=this.m_stepExprs;if(i.includes(e))return e;const n=e.input.accept(this,t),s=e.defaultValue.accept(this,t),o=this.internArray(e.stops);for(const e of i)if(e.input===n&&e.defaultValue===s&&e.stops===o)return e;const a=new r.StepExpr(n,s,o);return i.push(a),a}visitInterpolateExpr(e,t){const i=this.m_interpolateExprs,n=e.stops.length*(e.stops[0][0]+3);let s=i.get(n);if(s){if(s.includes(e))return e}else i.set(n,s=[]);const o=this.internArray(e.mode),a=e.input.accept(this,t),l=this.internArray(e.stops);for(const e of s)if(e.mode===o&&e.input===a&&e.stops===l)return e;const c=new r.InterpolateExpr(o,a,l);return s.push(c),c}}},8628:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.interpolatedPropertyDefinitionToJsonExpr=t.isInterpolatedPropertyDefinition=t.InterpolationMode=void 0,(i=t.InterpolationMode||(t.InterpolationMode={}))[i.Discrete=0]="Discrete",i[i.Linear=1]="Linear",i[i.Cubic=2]="Cubic",i[i.Exponential=3]="Exponential",t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||"Discrete"===e.interpolation){const t=["step",["zoom"],e.values[0]];for(let i=1;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}const t=["interpolate"];switch(e.interpolation){case"Linear":t.push(["linear"]);break;case"Cubic":t.push(["cubic"]);break;case"Exponential":t.push(["exponential",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push(["zoom"]);for(let i=0;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}},1017:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isJsonExpr=void 0,t.isJsonExpr=function(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]}},1324:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pixels=void 0;const i=/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/;class n{static parse(e){const t=i.exec(e);if(null!==t)return new n(Number(t[1]))}constructor(e){this.value=e}toJSON(){return`${this.value}px`}}t.Pixels=n},7610:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGBA=void 0;const n=i(3334),r=i(6577),s=i(1667),o=i(6331);class a{static parse(e){const t=(0,o.parseStringEncodedColor)(e);if(void 0!==t)return s.ColorUtils.getRgbaFromHex(t)}static isRGBA(e){return e instanceof a}constructor(e=1,t=1,i=1,n=1,r=!0){this.r=e,this.g=t,this.b=i,this.a=n,this.isRGBA=r}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}clone(){return new a(this.r,this.g,this.b,this.a)}fromVector(e){return this.r=e.x,this.g=e.y,this.b=e.z,this.a=e.w,this}toVector(e){return e||(e=new r.Vector4),e.set(this.r,this.g,this.b,this.a),e}fromHex(e){return s.ColorUtils.getRgbaFromHex(e,this),this}getHex(){return s.ColorUtils.getHexFromRgba(this.r,this.g,this.b,this.a)}lerp(e,t){return this.r=(0,n.lerp)(this.r,e.r,t),this.g=(0,n.lerp)(this.g,e.g,t),this.b=(0,n.lerp)(this.b,e.b,t),this.a=(0,n.lerp)(this.a,e.a,t),this}toJSON(){return`rgba(${255*this.r|0}, ${255*this.g|0}, ${255*this.b|0}, ${this.a})`}}t.RGBA=a},6331:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringEncodedColor=t.parseStringEncodedNumeral=t.StringEncodedNumeralFormatMaxSize=t.StringEncodedNumeralFormats=t.StringEncodedColorFormats=t.StringEncodedMetricFormats=t.StringEncodedNumeralType=void 0;const n=i(6925),r=i(797),s=i(1667);var o;!function(e){e[e.Meters=0]="Meters",e[e.Pixels=1]="Pixels",e[e.Hex=2]="Hex"}(o=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const a={type:o.Meters,size:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))m$/,decoder:(e,t)=>{const i=a.regExp.exec(e);return!!i&&void 0!==(t[0]=Number(i[1]))}},l={type:o.Pixels,size:1,mask:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/,decoder:(e,t)=>{const i=l.regExp.exec(e);return null!==i&&(t[0]=Number(i[1]),!0)}},c={type:o.Hex,size:4,regExp:/^\#((?:[0-9A-Fa-f][0-9A-Fa-f]){4}|[0-9A-Fa-f]{4})$/,decoder:(e,t)=>{const i=c.regExp.exec(e);if(null===i)return!1;const n=i[1],s=n.length;return(0,r.assert)(4===s||8===s,"Matched incorrect hex color format"),4===s?(t[0]=parseInt(n.charAt(0)+n.charAt(0),16)/255,t[1]=parseInt(n.charAt(1)+n.charAt(1),16)/255,t[2]=parseInt(n.charAt(2)+n.charAt(2),16)/255,t[3]=4===s?parseInt(n.charAt(3)+n.charAt(3),16)/255:1):8===s&&(t[0]=parseInt(n.charAt(0)+n.charAt(1),16)/255,t[1]=parseInt(n.charAt(2)+n.charAt(3),16)/255,t[2]=parseInt(n.charAt(4)+n.charAt(5),16)/255,t[3]=8===s?parseInt(n.charAt(6)+n.charAt(7),16)/255:1),!0}};t.StringEncodedMetricFormats=[a,l];const h=t.StringEncodedMetricFormats.reduce(((e,t)=>Math.max(e,t.size)),0);t.StringEncodedColorFormats=[c];const u=t.StringEncodedColorFormats.reduce(((e,t)=>Math.max(e,t.size)),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(u,h);const d=new Array(t.StringEncodedNumeralFormatMaxSize);function m(e,t,i=1){const r=t.find((t=>!!t.decoder(e,d)));if(void 0===r){const t=(0,n.parseCSSColor)(e);return Array.isArray(t)&&!t.some((e=>isNaN(e)))?s.ColorUtils.getHexFromRgba(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}switch(null==r?void 0:r.type){case o.Pixels:return d[0]*i;case o.Hex:return s.ColorUtils.getHexFromRgba(d[0],d[1],d[2],d[3]);default:return d[0]}}t.parseStringEncodedNumeral=function(e,i=1){return m(e,t.StringEncodedNumeralFormats,i)},t.parseStringEncodedColor=function(e){return m(e,t.StringEncodedColorFormats)}},1370:(e,t)=>{"use strict";var i,n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.isTextureBuffer=t.PlacementToken=t.transientToPickability=t.Pickability=t.TextureCoordinateType=void 0,(r=t.TextureCoordinateType||(t.TextureCoordinateType={})).TileSpace="tile-space",r.EquirectangularSpace="equirectangular-space",r.FeatureSpace="feature-space",function(e){e.onlyVisible="only-visible",e.transient="transient",e.all="all"}(i=t.Pickability||(t.Pickability={})),t.transientToPickability=function(e){let t=i.onlyVisible;return null!=e&&(t="string"==typeof e?e:!0===e?i.transient:i.onlyVisible),t},(n=t.PlacementToken||(t.PlacementToken={})).TopLeft="TL",n.Top="T",n.TopRight="TR",n.Right="R",n.BottomRight="BR",n.Bottom="B",n.BottomLeft="BL",n.Left="L",n.Center="C",n.NorthWest="NW",n.North="N",n.NorthEast="NE",n.East="E",n.SouthEast="SE",n.South="S",n.SouthWest="SW",n.West="W",t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},1216:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTechniqueRenderOrderOrPriority=t.addBuffersToTransferList=t.textureCoordinateType=t.supportsTextures=t.needsVertexNormals=t.isLabelRejectionLineTechnique=t.isTextTechnique=t.isTerrainTechnique=t.isStandardTechnique=t.isExtrudedPolygonTechnique=t.isPolygonTechnique=t.isStandardExtrudedLineTechnique=t.isBasicExtrudedLineTechnique=t.isExtrudedLineTechnique=t.isSegmentsTechnique=t.isSpecialDashesLineTechnique=t.isRasterTechnique=t.isSolidLineTechnique=t.isLineTechnique=t.isLineMarkerTechnique=t.isIconTextTechnique=t.isSquaresTechnique=t.isCirclesTechnique=t.TRANSPARENCY_PROPERTY_KEYS=t.TEXTURE_PROPERTY_KEYS=void 0;const n=i(1370);function r(e){return"labeled-icon"===e.name}function s(e){return"line-marker"===e.name}function o(e){return"solid-line"===e.name||"dashed-line"===e.name}function a(e){return"extruded-line"===e.name}function l(e){return a(e)&&"standard"===e.shading}function c(e){return"polygon"===e.name}function h(e){return"extruded-polygon"===e.name}function u(e){return"standard"===e.name}function d(e){return"terrain"===e.name}function m(e){return"text"===e.name}function p(e){return c(e)||u(e)||h(e)||d(e)||o(e)}t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap","dash-image"],t.TRANSPARENCY_PROPERTY_KEYS=["opacity","transparent"],t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isIconTextTechnique=r,t.isLineMarkerTechnique=s,t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=o,t.isRasterTechnique=function(e){return"raster"===e.name},t.isSpecialDashesLineTechnique=function(e){return("solid-line"===e.name||"dashed-line"===e.name)&&void 0!==e.dashes&&"Square"!==e.dashes},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=a,t.isBasicExtrudedLineTechnique=function(e){return a(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=l,t.isPolygonTechnique=c,t.isExtrudedPolygonTechnique=h,t.isStandardTechnique=u,t.isTerrainTechnique=d,t.isTextTechnique=m,t.isLabelRejectionLineTechnique=function(e){return"label-rejection-line"===e.name},t.needsVertexNormals=function(e){return h(e)||c(e)||u(e)||d(e)||l(e)},t.supportsTextures=p,t.textureCoordinateType=function(e){return p(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,i){if(u(e)||h(e)||d(e))for(const r of t.TEXTURE_PROPERTY_KEYS){const t=e[r];(0,n.isTextureBuffer)(t)&&t.buffer instanceof ArrayBuffer&&i.push(t.buffer)}},t.setTechniqueRenderOrderOrPriority=function(e,t,i){if(m(e)||r(e)||s(e)){if(i&&"string"==typeof e._category){const t=i.indexOf(e._category);-1!==t&&(e.priority=i.length-t)}}else if(t&&void 0!==e._layer){const i=i=>{const n=null==t?void 0:t.findIndex((t=>t.layer===e._layer&&t.category===i));return void 0!==n&&-1!==n?10*(n+1):void 0};if("string"==typeof e._category){const t=i(e._category);void 0!==t&&(e.renderOrder=t)}}}},5771:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isConditionalExtendsEntry=t.isDirectionalLight=t.isAmbientLight=t.getStyles=t.isStylesDictionary=t.isJsonExprReference=t.getDefinitionValue=t.isVerboseDefinition=void 0;const n=i(1017);function r(e){return void 0!==(null==e?void 0:e.value)}function s(e){return void 0!==e&&!Array.isArray(e)}t.isVerboseDefinition=r,t.getDefinitionValue=function(e){return r(e)?e.value:e},t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&"ref"===e[0]&&"string"==typeof e[1]},t.isStylesDictionary=s,t.getStyles=function(e){return void 0===e?[]:s(e)?function(e){const t=[];for(const i in e)e[i].forEach((e=>{void 0===e.layer&&(e.layer=i),t.push(e)}));return t}(e):e},t.isAmbientLight=function(e){return"ambient"===e.type},t.isDirectionalLight=function(e){return"directional"===e.type},t.isConditionalExtendsEntry=function(e){return void 0!==e&&(0,n.isJsonExpr)(e.when)&&/^(object|string)$/.test(typeof e.value)}},8131:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeVisitor=void 0;const n=i(1017),r=i(5771);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!(0,n.isJsonExpr)(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e of(0,r.getStyles)(this.theme.styles))if(t(e))return!0;return!1}}},797:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=void 0,t.assert=function(e,t){}},6304:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPropertyValue=void 0;const n=i(8023),r=i(1324),s=i(7610),o=i(6331);t.getPropertyValue=function(e,t,i){var a,l,c;if(n.Expr.isExpr(e)){let o=e.evaluate(t,n.ExprScope.Dynamic,i);return"string"==typeof o&&(o=null!==(l=null!==(a=s.RGBA.parse(o))&&void 0!==a?a:r.Pixels.parse(o))&&void 0!==l?l:o),o instanceof s.RGBA?o.getHex():o instanceof r.Pixels?o.value*(null!==(c=Number(t.lookup("$pixelToMeters")))&&void 0!==c?c:1):o}if(null==e)return null;if("string"!=typeof e)return e;{const i=t.lookup("$pixelToMeters")||1,n=(0,o.parseStringEncodedNumeral)(e,i);return void 0!==n?n:e}}},6073:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayOperators=void 0;const n=i(8023),r=["boolean","number","string"];function s(e,t){if(!(e instanceof n.StringLiteralExpr&&r.includes(e.value)))throw new Error(`expected "boolean", "number" or "string" instead of '${JSON.stringify(e)}'`);const i=e.value;t.forEach(((e,t)=>{if(typeof e!==i)throw new Error(`expected array element at index ${t} to have type '${i}'`)}))}function o(e,t){const i=e.evaluate(t);if(!Array.isArray(i))throw new Error(`'${i}' is not an array`);return i}const a={array:{call:(e,t)=>{switch(t.args.length){case 0:throw new Error("not enough arguments");case 1:return o(e,t.args[0]);case 2:{const i=o(e,t.args[1]);return s(t.args[0],i),i}case 3:{const i=o(e,t.args[2]);return function(e,t){if(!(e instanceof n.NumberLiteralExpr))throw new Error("missing expected number of elements");const i=e.value;if(t.length!==i)throw new Error(`the array must have ${i} element(s)`)}(t.args[1],i),s(t.args[0],i),i}default:throw new Error("too many arguments")}}},"make-array":{call:(e,t)=>{if(0===t.args.length)throw new Error("not enough arguments");return[...t.args.map((t=>e.evaluate(t)))]}},at:{call:(e,t)=>{const i=t.args,n=e.evaluate(i[0]);if("number"!=typeof n)throw new Error("expected the index of the element to retrieve");const r=e.evaluate(i[1]);if(!Array.isArray(r))throw new Error("expected an array");return n>=0&&n<r.length?r[n]:null}},slice:{call:(e,t)=>{if(t.args.length<2)throw new Error("not enough arguments");const i=e.evaluate(t.args[0]);if("string"!=typeof i&&!Array.isArray(i))throw new Error("input must be a string or an array");const n=e.evaluate(t.args[1]);if("number"!=typeof n)throw new Error("expected an index");let r;if(t.args.length>2&&(r=e.evaluate(t.args[2]),"number"!=typeof r))throw new Error("expected an index");return i.slice(n,r)}}};t.ArrayOperators=a},7290:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CastOperators=void 0;const i={"to-boolean":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},"to-string":{call:(e,t)=>String(e.evaluate(t.args[0]))},"to-number":{call:(e,t)=>{for(const i of t.args){const t=Number(e.evaluate(i));if(!isNaN(t))return t}throw new Error("cannot convert the value to a number")}}};t.CastOperators=i},4672:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorOperators=void 0;const n=i(3334),r=i(1667),s=i(7610),o=i(6331),a={alpha:{call:(e,t)=>{let i=e.evaluate(t.args[0]);return"string"==typeof i&&(i=(0,o.parseStringEncodedColor)(i)),"number"==typeof i?r.ColorUtils.getAlphaFromHex(i):1}},rgba:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&"number"==typeof a&&i>=0&&s>=0&&o>=0&&a>=0&&a<=1)return function(e,t,i,s){return r.ColorUtils.getHexFromRgba((0,n.clamp)(e,0,255)/255,(0,n.clamp)(t,0,255)/255,(0,n.clamp)(i,0,255)/255,(0,n.clamp)(s,0,1))}(i,s,o,a);throw new Error(`unknown color 'rgba(${i},${s},${o},${a})'`)}},rgb:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return r.ColorUtils.getHexFromRgb((0,n.clamp)(e,0,255)/255,(0,n.clamp)(t,0,255)/255,(0,n.clamp)(i,0,255)/255)}(i,s,o);throw new Error(`unknown color 'rgb(${i},${s},${o})'`)}},hsl:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return r.ColorUtils.getHexFromHsl((0,n.euclideanModulo)(e,360)/360,(0,n.clamp)(t,0,100)/100,(0,n.clamp)(i,0,100)/100)}(i,s,o);throw new Error(`unknown color 'hsl(${i},${s}%,${o}%)'`)}},"to-color":{call:(e,t)=>h(e.evaluate(t.args[0]))},darken:{call:(e,t)=>{const i=h(e.evaluate(t.args[0])),n=e.evaluate(t.args[1]);if(Number(n)!==n)throw new Error(`invalid darken amount '${n}'`);return r.ColorUtils.darken(i.clone(),n)}},"scale-color":{call:(e,t)=>{const i=t.args,n=i.length,s=h(e.evaluate(i[0]));l.h=l.s=l.l=l.a=0;for(let t=1;t<n;){const n=e.evaluate(i[t++]);if(!c.test(n))throw new Error(`invalid component "${n}"`);const r=e.evaluate(i[t++]);if(r!==Number(r))throw new Error(`invalid factor "${r}"`);l[n]=r}return r.ColorUtils.scaleColor(s.clone(),l)}}},l={h:0,s:0,l:0,a:0},c=/^[sla]$/;function h(e){const t=e;return s.RGBA.isRGBA(e)?e:(null==t?void 0:t.isRGBA)?new s.RGBA(t.r,t.g,t.b,t.a):r.ColorUtils.getRgbaFromHex(function(e){if("string"==typeof e){const t=(0,o.parseStringEncodedColor)(e);if(void 0!==t)return t}throw new Error(`unknown color '${e}'`)}(e))}t.ColorOperators=a},8998:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComparisonOperators=void 0;const n=i(1667),r=i(8023);function s(e,t,i=!1){const n=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]),s=typeof n;if(("number"!==s&&"string"!==s||s!==typeof r)&&i)throw new Error(`invalid operands '${n}' and '${r}' for operator '${t.op}'`);switch(t.op){case"<":return n<r;case">":return n>r;case"<=":return n<=r;case">=":return n>=r;default:throw new Error(`invalid comparison operator '${t.op}'`)}}function o(e,t,i=!1){if("number"!=typeof e||isNaN(e)){if(i)throw new Error(`invalid operand '${e}' for operator '${t}'`);return NaN}return e}const a={"!":{call:(e,t)=>!e.evaluate(t.args[0])},"==":{call:(e,t)=>{var i;const r=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]);return null!==(i=n.ColorUtils.comparePotentiallyRGBA(r,s,!0))&&void 0!==i?i:r===s}},"!=":{call:(e,t)=>{var i;const r=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]);return null!==(i=n.ColorUtils.comparePotentiallyRGBA(r,s,!1))&&void 0!==i?i:r!==s}},"<":{call:(e,t)=>s(e,t)},">":{call:(e,t)=>s(e,t)},"<=":{call:(e,t)=>s(e,t)},">=":{call:(e,t)=>s(e,t)},"inside-range":{call:(e,t)=>{const i=t.args;let n,s,a,l,c;i[1]instanceof r.ObjectLiteralExpr&&i[1].isArrayLiteral?(n=i[1].value,a=2,s=0,l=0,c=!0):(n=i,a=3,s=1,l=1,c=!1);let h=n.length,u=!1;if(h>=a&&h%2===l){const r=o(e.evaluate(i[0]),t.op);for(isNaN(r)&&(u=null);!1===u&&h>s;){const i=o(c?n[--h]:e.evaluate(n[--h]),t.op),s=o(c?n[--h]:e.evaluate(n[--h]),t.op);u=isNaN(s)||isNaN(i)?null:r>=s&&r<i}}else u=null;return u}}};t.ComparisonOperators=a},1954:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureOperators=void 0;const n=i(7259),r=i(8023),s={"geometry-type":{call:(e,t)=>{switch(e.env.lookup("$geometryType")){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon";default:return null}}},"feature-state":{isDynamicOperator:()=>!0,call:(e,t)=>{var i,s;if(e.scope!==r.ExprScope.Dynamic)throw new Error("feature-state cannot be used in this context");const o=e.evaluate(t.args[0]);if("string"!=typeof o)throw new Error("expected the name of the property of the feature state");const a=e.env.lookup("$state");return n.Env.isEnv(a)?null!==(i=a.lookup(o))&&void 0!==i?i:null:a instanceof Map&&null!==(s=a.get(o))&&void 0!==s?s:null}},id:{call:(e,t)=>{var i;return null!==(i=e.env.lookup("$id"))&&void 0!==i?i:null}}};t.FeatureOperators=s},2181:(e,t)=>{"use strict";function i(e,t,i){switch(t){case"boolean":case"number":case"string":for(const n of i){const i=e.evaluate(n);if(typeof i===t)return i}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.FlowOperators=void 0;const n={all:{call:(e,t)=>{for(const i of t.args)if(!e.evaluate(i))return!1;return!0}},any:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!0;return!1}},none:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!1;return!0}},boolean:{call:(e,t)=>i(e,"boolean",t.args)},number:{call:(e,t)=>i(e,"number",t.args)},string:{call:(e,t)=>i(e,"string",t.args)}};t.FlowOperators=n},202:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapOperators=void 0;const n=i(8023),r={"ppi-scale":{call:(e,t)=>e.evaluate(t.args[0])*(t.args[1]?e.evaluate(t.args[1]):1)},"world-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),n=t.args[1]?e.evaluate(t.args[1]):1,r=e.env.lookup("$zoom");return i*(Math.pow(2,17)/Math.pow(2,r))*n}},"world-discrete-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.env.lookup("$zoom");return i*(40075016.68557849/(256*Math.pow(2,Math.floor(n))))}},"pixel-world-scale":{isDynamicOperator:()=>!0,call:(e,t)=>e.evaluate(t.args[0])*(e.env.lookup("$pixelToMeters")||1)},ppi:{call:e=>{const t=e.env.lookup("$ppi");return"number"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:(e,t)=>{var i;return e.scope===n.ExprScope.Value?t:null!==(i=e.env.lookup("$zoom"))&&void 0!==i?i:null}}};t.MapOperators=r},4054:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathOperators=void 0;const n=i(3334),r=i(5448),s=i(6815),o=i(6577),a={"^":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '^'`);return Math.pow(i,n)}},"-":{call:(e,t)=>{if(1===t.args.length){const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`ìnvalid operand '${typeof i} for operator '-'`);return-i}const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '-'`);return i-n}},"/":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '/'`);return i/n}},"%":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof n)throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '%'`);return i%n}},"+":{call:(e,t)=>t.args.reduce(((t,i)=>Number(t)+Number(e.evaluate(i))),0)},"*":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]),a="number"==typeof i,l="number"==typeof n;let c;if(a&&l)c=i*n;else if(l&&(i instanceof r.Vector2||i instanceof s.Vector3||i instanceof o.Vector4))c=i.clone().multiplyScalar(n);else{if(!a||!(n instanceof r.Vector2||n instanceof s.Vector3||n instanceof o.Vector4))throw new Error(`invalid operands '${typeof i}' and '${typeof n}' for operator '*'`);c=n.clone().multiplyScalar(i)}return c}},abs:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'abs'`);return Math.abs(i)}},acos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'acos'`);return Math.acos(i)}},asin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'asin'`);return Math.asin(i)}},atan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'atan'`);return Math.atan(i)}},ceil:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ceil'`);return Math.ceil(i)}},cos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'cos'`);return Math.cos(i)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'floor'`);return Math.floor(i)}},ln:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln'`);return Math.log(i)}},ln2:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln2'`);return Math.log2(i)}},log10:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'log10'`);return Math.log10(i)}},max:{call:(e,t)=>Math.max(...t.args.map((t=>Number(e.evaluate(t)))))},min:{call:(e,t)=>Math.min(...t.args.map((t=>Number(e.evaluate(t)))))},clamp:{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"!=typeof i||"number"!=typeof r||"number"!=typeof s)throw new Error(`invalid operands '${i}', ${r}, ${s} for operator 'clamp'`);return(0,n.clamp)(i,r,s)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'round'`);return Math.round(i)}},sin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sin'`);return Math.sin(i)}},sqrt:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sqrt'`);return Math.sqrt(i)}},tan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'tan'`);return Math.tan(i)}}};t.MathOperators=a},9764:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MiscOperators=void 0;const n=i(797),r=i(8023);function s(e){return e.join("&")}function o(e,t){return e+"="+JSON.stringify(t)}function a(e,t=0){if(t>=e.length)return[];const i=a(e,t+1),n=i.length;for(let r=0;r<n;r+=1)i.push([...i[r],e[t]]);return i.push([e[t]]),i}function l(e,t){const i=e.args.slice(1),n=[];for(let e=0;e<i.length;e+=2){const r=t.evaluate(i[e+1]);if(null===r)continue;const s=t.evaluate(i[e]);n.push(o(s,r))}return n.sort().reverse(),function(e){e.sort(((e,t)=>t.length-e.length));const t=e.map((e=>s(e)));return t.push(""),t}(a(n))}const c={length:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if(Array.isArray(i)||"string"==typeof i)return i.length;throw new Error(`invalid operand '${i}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const i of t.args){const t=e.evaluate(i);if(null!==t)return t}return null}},lookup:{call:(e,t)=>{(0,n.assert)(t.args.length>0,"missing lookup table");const i=l(t,e);let a=e.evaluate(t.args[0]);if((0,n.assert)(Array.isArray(a)||a instanceof Map,"wrong lookup table type"),Array.isArray(a)){a=function(e){const t=new Map;for(const i of e){if("object"!=typeof i)throw new Error(`Invalid lookup table entry type (${typeof i})`);if(!i.keys)throw new Error("Lookup table entry has no 'keys' property.");if(!i.attributes)throw new Error("Lookup table entry has no 'attributes' property.");const e=s(Object.getOwnPropertyNames(i.keys).sort().map((e=>o(e,i.keys[e]))));t.set(e,i.attributes)}return t}(a);const e=new r.ObjectLiteralExpr(a,t.args[0].id);t.args[0]=e}return function(e,t){for(const i of e){const e=t.get(i);if(e)return e}return null}(i,a)}},trace:{call:(e,t)=>{const i=[];for(const n of t.args)i.push(e.evaluate(n));return console.error("trace: ",...i),i[0]}}};t.MiscOperators=c},7029:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectOperators=void 0;const n=i(7259),r=i(8023),s=Object.prototype.hasOwnProperty;var o;function a(e,t,i){var r;const a=e.evaluate(t[0]);if("string"!=typeof a)throw new Error("expected the name of an attribute");const l=e.evaluate(t[1]);if(l&&"object"==typeof l){if(n.Env.isEnv(l)){const e=null!==(r=l.lookup(a))&&void 0!==r?r:null;return i===o.get?e:null!==e}if(s.call(l,a))return i!==o.get||l[a]}return i===o.get&&null}!function(e){e[e.get=0]="get",e[e.has=1]="has"}(o||(o={}));const l={in:{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return("string"==typeof i&&"string"==typeof n||!!Array.isArray(n))&&n.includes(i)}},get:{call:(e,t)=>a(e,t.args,o.get)},has:{call:(e,t)=>a(e,t.args,o.has)},"dynamic-properties":{isDynamicOperator:()=>!0,call:(e,t)=>e.scope===r.ExprScope.Dynamic?e.env:t}};t.ObjectOperators=l},3501:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringOperators=void 0;const i={concat:{call:(e,t)=>"".concat(...t.args.map((t=>String(e.evaluate(t)))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},"regex-replace":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]),r=e.evaluate(t.args[2]);return"string"==typeof i&&"string"==typeof n&&"string"==typeof r?i.replace(new RegExp(n,"g"),r):i}},"~=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.includes(n)}},"^=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.startsWith(n)}},"$=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof n&&i.endsWith(n)}},split:{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("string"==typeof i&&"string"==typeof n)return i.split(n);throw new Error(`expected '${i}' and '${n}' to be a string`)}}};t.StringOperators=i},5113:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeOperators=void 0,t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},545:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorOperators=void 0;const n=i(5448),r=i(6815),s=i(6577),o=i(8023);function a(e,t,i){let o;switch(i){case"vector2":o=n.Vector2;break;case"vector3":o=r.Vector3;break;case"vector4":o=s.Vector4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof o)return t}throw new Error(`expected a "${i}"`)}function l(e,t,i){let o,a;switch(i){case"vector2":o=n.Vector2,a=2;break;case"vector3":o=r.Vector3,a=3;break;case"vector4":o=s.Vector4,a=4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof o)return t;if(Array.isArray(t)&&t.length===a&&t.every((e=>"number"==typeof e)))return(new o).fromArray(t)}throw new Error(`expected a "${i}"`)}const c={"make-vector":{call:(e,t)=>{if(void 0!==t._value)return t._value;if(t.args.length<2)throw new Error("not enough arguments");if(t.args.length>4)throw new Error("too many arguments");const i=t.args.map((t=>e.evaluate(t)));let a;switch(i.forEach(((e,t)=>{if("number"!=typeof e)throw new Error(`expected vector component at index ${t} to have type "number"`)})),i.length){case 2:a=(new n.Vector2).fromArray(i);break;case 3:a=(new r.Vector3).fromArray(i);break;case 4:a=(new s.Vector4).fromArray(i);break;default:throw new Error("too many arguments")}return t.args.every((e=>e instanceof o.NumberLiteralExpr))&&(t._value=a),a}},vector2:{call:(e,t)=>a(e,t,"vector2")},vector3:{call:(e,t)=>a(e,t,"vector3")},vector4:{call:(e,t)=>a(e,t,"vector4")},"to-vector2":{call:(e,t)=>l(e,t,"vector2")},"to-vector3":{call:(e,t)=>l(e,t,"vector3")},"to-vector4":{call:(e,t)=>l(e,t,"vector4")}};t.VectorOperators=c},3209:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(9047),t)},6766:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredPromise=void 0,t.DeferredPromise=class{constructor(e){this.executor=e,this.promise=new Promise(((e,t)=>{this.resolveFunc=e,this.rejectFunc=t}))}exec(){this.executor().then((e=>this.resolveFunc(e))).catch((e=>this.rejectFunc(e)))}}},9047:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransferManager=void 0;const n=i(6766);class r{static instance(){return r.defaultInstance}static async fetchRepeatedly(e,t,i,n,s){try{if(!(t<i))throw new Error("Max number of retries reached");{const r=await e(n,s);if(200===r.status||204===r.status)return r;if(r.status>=400&&r.status<500){t=i;const e=await r.text();throw new Error(e)}}}catch(e){if(e.hasOwnProperty("isCancelled")||"AbortError"===e.name||t>=i)throw e}return await r.waitFor(r.retryTimeout*t).then((()=>r.fetchRepeatedly(e,t+1,i,n,s)))}static waitFor(e){return new Promise((t=>setTimeout(t,e)))}constructor(e=fetch,t=5){this.fetchFunction=e,this.maxRetries=t,this.activeDownloadCount=0,this.downloadQueue=new Array,this.activeDownloads=new Map}downloadJson(e,t){return this.downloadAs((e=>e.json()),e,t)}downloadArrayBuffer(e,t){return this.download(e,t).then((e=>e.arrayBuffer()))}download(e,t){if(this.activeDownloadCount>=r.maxParallelDownloads){const i=new n.DeferredPromise((()=>this.doDownload(e,t)));return this.downloadQueue.push(i),i.promise}return this.doDownload(e,t)}async doDownload(e,t){try{++this.activeDownloadCount;const i=await r.fetchRepeatedly(this.fetchFunction,0,this.maxRetries,e,t);return this.onDownloadDone(),i}catch(e){throw this.onDownloadDone(),e}}onDownloadDone(){--this.activeDownloadCount,this.execDeferredDownload()}execDeferredDownload(){const e=this.downloadQueue.pop();void 0!==e&&e.exec()}downloadAs(e,t,i){const n=t,r=this.activeDownloads.get(n);if(void 0!==r)return Promise.resolve(r);const s=this.download(t,i).then((t=>{if(this.activeDownloads.delete(n),t.ok)return e(t);throw new Error(JSON.stringify(t))})).catch((e=>{throw this.activeDownloads.delete(n),e}));return this.activeDownloads.set(n,s),s}}t.TransferManager=r,r.retryTimeout=500,r.maxParallelDownloads=16,r.defaultInstance=new r},6463:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(4992),t),r(i(5337),t),r(i(197),t),r(i(9172),t),r(i(5200),t),r(i(8154),t),r(i(9246),t),r(i(5681),t),r(i(7314),t),r(i(4954),t),r(i(173),t),r(i(34),t),r(i(7250),t),r(i(5177),t),r(i(4713),t),r(i(9276),t),r(i(5704),t),r(i(7427),t),r(i(9206),t)},4342:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(6463),t),r(i(5323),t)},7427:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5681:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContextLogger=void 0,t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod("warn"),this.info=this.createLogMethod("info"),this.error=this.createLogMethod("error")}pushAttr(e){this.context.push(`${this.context.length>0?".":""}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...i)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join("")}: ${t}`,...i)}}}},4992:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMUtils=void 0,function(e){function t(e){return e.substring(0,2)}e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const e=[];for(const i of navigator.languages)e.push(t(i));return e}if(void 0!==navigator.language)return[t(navigator.language)]}}(t.DOMUtils||(t.DOMUtils={}))},9276:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=void 0,t.chainCallbacks=function(e,t){return function(...i){return e&&e.apply(this,i),t.apply(this,i)}}},9206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertFragmentShaderToWebGL2=t.convertVertexShaderToWebGL2=void 0,t.convertVertexShaderToWebGL2=function(e){return["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+e},t.convertFragmentShaderToWebGL2=function(e){return["#define varying in","out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+e}},5337:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupedPriorityList=t.PriorityListGroup=void 0;class i{constructor(e,t,i=new Array){this.priority=e,this.zOrder=t,this.elements=i}}t.PriorityListGroup=i,t.GroupedPriorityList=class{constructor(){this.groups=new Map}getGroupKey(e){return`${e.priority}_${e.zOrder}`}add(e){this.getGroup(e).elements.push(e)}clear(){this.groups.clear()}forEachElement(e){this.forEachGroup((t=>{t.elements.forEach(e)}))}forEachGroup(e){for(const[,t]of this.groups)e(t)}count(){let e=0;for(const[,t]of this.groups)e+=t.elements.length;return e}findGroup(e){return this.groups.get(e)}getGroup(e){const t=this.getGroupKey(e);let n=this.findGroup(t);return void 0===n&&(n=new i(e.priority,e.zOrder),this.groups.set(t,n)),n}}},4015:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleChannel=void 0,t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},3140:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6781:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerOptions=t.LogLevel=void 0,(i=t.LogLevel||(t.LogLevel={}))[i.Trace=0]="Trace",i[i.Debug=1]="Debug",i[i.Log=2]="Log",i[i.Info=3]="Info",i[i.Warn=4]="Warn",i[i.Error=5]="Error",i[i.None=6]="None",t.LoggerOptions=class{}},8648:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=i(6781);t.Logger=class{constructor(e,t,i){this.name=e,this.m_channel=t,this.enabled=!0,this.level=n.LogLevel.Trace,void 0!==i&&this.update(i)}error(e,...t){this.enabled&&this.level<=n.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=n.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=n.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=n.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=n.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=n.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},6562:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManager=void 0;const n=i(2531);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new n.LoggerManagerImpl)}}},2531:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManagerImpl=void 0;const n=i(4015),r=i(8648),s=i(7698);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new n.ConsoleChannel:new s.WorkerChannel}getLoggerNames(){return this.m_loggers.map((e=>e.name))}getLogger(e){return this.m_loggers.find((t=>t.name===e))}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const i=new r.Logger(e,this.channel,t);return this.m_loggers.push(i),i}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const i of this.m_loggers)i.name===e&&i.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},3069:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiChannel=void 0,t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const i of this.channels)i.error(e,...t)}debug(e,...t){for(const i of this.channels)i.debug(e,...t)}info(e,...t){for(const i of this.channels)i.info(e,...t)}log(e,...t){for(const i of this.channels)i.log(e,...t)}trace(e,...t){for(const i of this.channels)i.trace(e,...t)}warn(e,...t){for(const i of this.channels)i.warn(e,...t)}}},7698:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerChannel=t.WORKERCHANNEL_MSG_TYPE=void 0;const n=i(6781);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message",t.WorkerChannel=class{error(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Error};self.postMessage(r)}debug(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Debug};self.postMessage(r)}info(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Info};self.postMessage(r)}log(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Log};self.postMessage(r)}trace(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Trace};self.postMessage(r)}warn(e,...i){const r={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Warn};self.postMessage(r)}}},197:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(4015),t),r(i(3140),t),r(i(6781),t),r(i(8648),t),r(i(6562),t),r(i(3069),t),r(i(7698),t)},9172:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Math2D=void 0,function(e){function t(e,t,i,n){return(e-i)*(e-i)+(t-n)*(t-n)}e.Box=class{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.w=i,this.h=n}set(e,t,i,n){this.x=e,this.y=t,this.w=i,this.h=n}copy(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}containsBox(e){const t=e.x+e.w,i=e.y+e.h;return this.contains(e.x,e.y)&&this.contains(t,e.y)&&this.contains(e.x,i)&&this.contains(t,i)}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const i=e.length-4;for(let n=0;n<i;n+=3){const i=e[n+3]-e[n],r=e[n+4]-e[n+1];t+=i*i+r*r}return t},e.distToSegmentSquared=function(e,i,n,r,s,o){const a=t(n,r,s,o);if(0===a)return t(e,i,n,r);let l=((e-n)*(s-n)+(i-r)*(o-r))/a;return l=Math.max(0,Math.min(1,l)),t(e,i,n+l*(s-n),r+l*(o-r))},e.intersectLineAndCircle=function(e,t,i,n,r,s=0,o=0){const a=i-e,l=n-t,c=a*a+l*l,h=e*n-i*t-l*s+a*o,u=r*r*c-h*h;if(u<-1e-10)return;const d=h*l,m=-h*a;if(u<1e-10)return{x1:s+d/c,y1:o+m/c};const p=Math.sqrt(u),f=(l<0?-1:1)*a*p,g=Math.abs(l)*p;return{x1:s+(d+f)/c,y1:o+(m+g)/c,x2:s+(d-f)/c,y2:o+(m-g)/c}},e.intersectLines=function(e,t,i,n,r,s,o,a,l={x:0,y:0}){const c=(e-i)*(s-a)-(t-n)*(r-o);if(0===c)return;const h=((e*n-t*i)*(r-o)-(e-i)*(r*a-s*o))/c,u=((e*n-t*i)*(s-a)-(t-n)*(r*a-s*o))/c;return l.x=h,l.y=u,l}}(t.Math2D||(t.Math2D={}))},5200:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0,function(e){function t(e,t,i){return e<t?t:e>i?i:e}e.clamp=t,e.smoothStep=function(e,i,n){return(n=t((n-e)/(i-e),0,1))*n*(3-2*n)},e.smootherStep=function(e,i,n){return(n=t((n-e)/(i-e),0,1))*n*n*(n*(6*n-15)+10)},e.map=function(e,t,i,n,r){return(e-t)*(r-n)/(i-t)+n},e.min2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.min(i,t)),i},e.max2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.max(i,t)),i},e.isWithinBounds=function(e,t,i){return!(void 0!==t&&e<t||void 0!==i&&e>i)},e.easeInOutCubic=function(e,t,i){return e+(t-e)*(i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1)}}(t.MathUtils||(t.MathUtils={}))},8154:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixinsWithoutProperties=t.applyMixins=void 0,t.applyMixins=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{e.prototype[i]=t.prototype[i]}))}))},t.applyMixinsWithoutProperties=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{const n=Object.getOwnPropertyDescriptor(t.prototype,i);void 0!==n&&void 0===n.get&&"constructor"!==i&&(e.prototype[i]=t.prototype[i])}))}))}},173:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pick=t.cloneDeep=void 0,t.cloneDeep=function(e){const t=new Map,i=function e(i){if(null===i)return null;if("object"==typeof i){const n=t.get(i);if(void 0!==n)return n;if(Array.isArray(i)){const n=[];t.set(i,n),n.length=i.length;for(let t=0;t<n.length;++t)n[t]=e(i[t]);return n}if(i instanceof Date){const e=new Date(i.getTime());return t.set(i,e),e}if(i instanceof RegExp){const e=new RegExp(i.source,i.flags);return t.set(i,e),e}if(i.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const n={};t.set(i,n);for(const t in i)i.hasOwnProperty(t)&&(n[t]=e(i[t]));return n}}return i}(e);return t.clear(),i},t.pick=function(e,t){const i={};for(const n of t)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}},34:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=void 0,t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t}},4954:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceTimer=void 0;class i{static now(){return i.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=i,i.instance=new i,i.nowFunc=i.getNowFunc()},5704:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sampleBilinear=void 0,t.sampleBilinear=function(e,t,i,n,r){const s=t-1,o=i-1,a=n*s,l=Math.floor(a),c=r*o,h=Math.floor(c),u=h*t+l,d=l<s?u+1:u,m=h<o?u+t:u,p=l<s?m+1:m,f=e[u],g=e[d],v=e[m],_=e[p],y=Number.isInteger(a)?0:a-l,x=1-y,S=Number.isInteger(c)?0:c-h,b=1-S;return f*x*b+g*y*b+v*x*S+_*y*S}},7250:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TaskQueue=void 0,t.TaskQueue=class{constructor(e){var t;this.m_options=e,this.m_taskLists=new Map,null===(t=this.m_options.groups)||void 0===t||t.forEach((e=>{this.m_taskLists.set(e,[])})),this.m_options.prioSortFn&&(this.sort=this.m_options.prioSortFn)}update(e){if(void 0===e)this.m_taskLists.forEach((e=>{this.updateTaskList(e)}));else{const t=this.getTaskList(e);t&&this.updateTaskList(t)}}add(e){var t;if(this.m_taskLists.has(e.group)){const i=this.m_taskLists.get(e.group);if(!(null==i?void 0:i.includes(e)))return null===(t=this.m_taskLists.get(e.group))||void 0===t||t.push(e),!0}return!1}remove(e){var t,i;if(this.m_taskLists.has(e.group)){const n=null===(t=this.m_taskLists.get(e.group))||void 0===t?void 0:t.indexOf(e);if(-1!==n)return null===(i=this.m_taskLists.get(e.group))||void 0===i||i.splice(n,1),!0}return!1}numItemsLeft(e){var t,i;let n=0;return void 0===e?this.m_taskLists.forEach((e=>{n+=e.length})):n+=null!==(i=null===(t=this.getTaskList(e))||void 0===t?void 0:t.length)&&void 0!==i?i:0,n}processNext(e,t,i=1){if(!this.getTaskList(e)||this.numItemsLeft(e)<=0)return!1;for(let n=0;n<i&&this.numItemsLeft(e)>0;n++){const i=this.pull(e,!0);void 0!==i&&(!t||(null==t?void 0:t(i))?i.execute():this.add(i))}return!0}clear(){this.m_taskLists.clear()}pull(e,t=!1){var i,n;let r;return this.getTaskList(e)&&(r=null===(i=this.getTaskList(e))||void 0===i?void 0:i.pop(),t&&r&&(null===(n=r.isExpired)||void 0===n?void 0:n.call(r)))?this.pull(e,t):r}sort(e,t){return t.getPriority()-e.getPriority()}getTaskList(e){return this.m_taskLists.get(e)}updateTaskList(e){var t;for(let i=0;i<e.length;i++){const n=e[i];(null===(t=null==n?void 0:n.isExpired)||void 0===t?void 0:t.call(n))&&(e.splice(i,1),i--)}e.sort(this.sort)}}},5177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5323:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAppBaseUrl=void 0;const n=i(4713);t.getAppBaseUrl=function(){return"undefined"==typeof window?`file://${process.cwd()}/`:(0,n.baseUrl)(window.location.href)}},4713:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUrlHostAndProtocol=t.getUrlOrigin=t.baseUrl=t.resolveReferenceUri=void 0,t.resolveReferenceUri=function(e,t){return i.test(t)?t:t.startsWith("/")?r(e)+t:(t.startsWith("./")&&(t=t.substr(2)),n(e)+t)};const i=new RegExp("^(((?:[a-z]+:)?//)|(file:/)|(data:))","i");function n(e){if(void 0===e)return"./";let t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf("?"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),-1===t?"./":e.substring(0,t+1)}function r(e){if(void 0===e)return"";const t=s(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function s(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),i=e.match(t);if(!i)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:i[1],host:i[2]}}t.baseUrl=n,t.getUrlOrigin=r,t.getUrlHostAndProtocol=s},9246:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertExists=t.assert=void 0,t.assert=function(e,t){},t.assertExists=function(e,t){return e}},2972:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7458),t),r(i(3436),t),r(i(9959),t),r(i(6822),t),r(i(3123),t),r(i(5591),t)},9287:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeLineAnchorPoints=t.MAX_SEARCH_DEPTH=void 0;const n=i(6815),r=new n.Vector3,s=new n.Vector3;t.MAX_SEARCH_DEPTH=3,t.computeLineAnchorPoints=function(e,i){if(e.count<2)return(new Float64Array).buffer;const n=function(e){const t=[];let i=0;for(let n=0;n<e.count-1;++n)i+=r.fromBufferAttribute(e,n).distanceTo(s.fromBufferAttribute(e,n+1)),t.push(i);return t}(e);if(n[n.length-1]<=Number.EPSILON)return(new Float64Array).buffer;const o=function(e,i,n){const o=[],a=e[e.length-1],l=Math.min(t.MAX_SEARCH_DEPTH+1,Math.floor(Math.log2(a/i))),c=l>0?Math.pow(2,l):0,h=c+1,u=a/c;let d=0;for(let t=0;t<h;t++){const i=1===h?a/2:t*u;let l=e.length-1;for(;l!==d;){const t=Math.floor((l+d)/2);i>=e[t]?d=t+1:l=t}const c=e[d],m=1-(c-i)/(c-(0===d?0:e[d-1])),p=r.fromBufferAttribute(n,d).lerp(s.fromBufferAttribute(n,d+1),m);o.push(...p.toArray())}return o}(n,i,e);return new Float64Array(o).buffer}},9252:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DecodeInfo=void 0;const n=i(2754),r=i(6815),s=i(2616);t.DecodeInfo=class{constructor(e,t,i=0){this.targetProjection=e,this.tileKey=t,this.storageLevelOffset=i,this.projectedBoundingBox=new s.OrientedBox3,this.tileBounds=new n.Box3,this.tileSize=new r.Vector3,this.center=new r.Vector3,this.geoBox=this.tilingScheme.getGeoBox(t),this.targetProjection.projectBox(this.geoBox,this.projectedBoundingBox),this.projectedBoundingBox.getCenter(this.center),this.tilingScheme.getWorldBox(t,this.tileBounds),this.tileBounds.getSize(this.tileSize),this.tileSizeOnScreen=256*Math.pow(2,-this.storageLevelOffset),this.columnCount=s.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionX(this.tileKey.level),this.rowCount=s.webMercatorTilingScheme.subdivisionScheme.getLevelDimensionY(this.tileKey.level)}get tilingScheme(){return s.webMercatorTilingScheme}get sourceProjection(){return this.tilingScheme.projection}}},5591:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataProvider=void 0;const n=i(8152),r=i(2344),s=i(8449),o=i(4342),a=i(9959),l=o.LoggerManager.instance.create("GeoJsonDataProvider"),c="invalidated";let h=!1;class u extends s.DataProvider{constructor(e,t,i){var n;super(),this.name=e,this.input=t,this.m_registered=!1,this.m_tiler=null!==(n=null==i?void 0:i.tiler)&&void 0!==n?n:r.ConcurrentTilerFacade.getTiler(a.GEOJSON_TILER_SERVICE_TYPE,null==i?void 0:i.workerTilerUrl,null==i?void 0:i.workerConnectionTimeout)}async connect(){try{await this.m_tiler.connect()}catch(e){throw n.WorkerServiceProtocol.isUnknownServiceError(e)&&!h&&(l.info("Unable to start GeoJson tiler service in worker. Use  'OmvTilerService.start();' in decoder script."),h=!0),e}await this.m_tiler.registerIndex(this.name,this.input),this.m_registered=!0}updateInput(e){this.input=e,this.m_tiler.updateIndex(this.name,this.input),this.dispatchEvent({type:c})}ready(){return this.m_registered}async getTile(e){return await this.m_tiler.getTile(this.name,e)}onDidInvalidate(e){return this.addEventListener(c,e),()=>this.removeEventListener(c,e)}dispose(){this.m_tiler.dispose()}}t.GeoJsonDataProvider=u},7458:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComposedDataFilter=void 0,t.ComposedDataFilter=class{constructor(e){this.filters=e}wantsLayer(e,t){return this.filters.reduce(((i,n)=>i&&n.wantsLayer(e,t)),!0)}wantsPointFeature(e,t,i){return this.filters.reduce(((n,r)=>n&&r.wantsPointFeature(e,t,i)),!0)}wantsLineFeature(e,t,i){return this.filters.reduce(((n,r)=>n&&r.wantsLineFeature(e,t,i)),!0)}wantsPolygonFeature(e,t,i){return this.filters.reduce(((n,r)=>n&&r.wantsPolygonFeature(e,t,i)),!0)}}},6822:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDebugLabelsTile=void 0;const n=i(6271),r=i(9365),s=i(3148),o=i(6307),a=i(977),l=i(5971),c=i(6815),h=i(4760),u=i(5269),d=i(8152),m=i(2344),p=i(507),f=i(5912),g=i(2002),v=i(5823),_=i(1984),y=new o.LineBasicMaterial({color:0,linewidth:1,depthTest:!1,depthFunc:n.NeverDepth}),x=new a.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:n.NeverDepth});new a.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:n.NeverDepth}).wireframe=!0,new a.MeshBasicMaterial({color:8421631,depthTest:!1,depthFunc:n.NeverDepth}).wireframe=!0;const S=new a.MeshBasicMaterial({color:0,depthTest:!1,depthFunc:n.NeverDepth}),b=new a.MeshBasicMaterial({color:255,depthTest:!1,depthFunc:n.NeverDepth,opacity:.75,transparent:!0}),T=new a.MeshBasicMaterial({color:10514432,depthTest:!1,depthFunc:n.NeverDepth,opacity:.75,transparent:!0}),M=new v.TextRenderStyle,w=new v.TextLayoutStyle;M.fontSize={unit:v.FontUnit.Point,size:9,backgroundSize:0},M.opacity=.75,M.backgroundOpacity=.75,M.color=new l.Color(.8,.2,.2);const E=Number.MAX_SAFE_INTEGER;class C{constructor(){this.geometry=new s.BufferGeometry,this.indices=new Array,this.positions=new Array}}function A(e,t,i,n,r){r.positions.push(e,t-n,i),r.positions.push(e+n,t,i),r.positions.push(e,t+n,i),r.positions.push(e-n,t,i);const s=r.positions.length/3;r.indices.push(s-4),r.indices.push(s-3),r.indices.push(s-2),r.indices.push(s-4),r.indices.push(s-2),r.indices.push(s-1)}function P(e,t,i=0,n){if(t.indices.length>0){t.geometry.addGroup(0,t.indices.length,0),t.geometry.setAttribute("position",new r.BufferAttribute(new Float32Array(t.positions),3)),t.geometry.setIndex(new r.BufferAttribute(new Uint32Array(t.indices),1));const s=n(t.geometry);s.renderOrder=E-i,e.push(s)}}class R extends m.Tile{constructor(e,t){super(e,t)}loadingFinished(){var e,t,i,n;const r=p.debugContext.getValue("DEBUG_TEXT_PATHS"),s=p.debugContext.getValue("DEBUG_TEXT_PATHS_FULL"),o=p.debugContext.getValue("DEBUG_TEXT_POIS_FULL"),a=p.debugContext.getValue("DEBUG_TEXT_LINE_MARKER");if(!(r||s||a)||void 0===this.decodedTile)return;const E=f.TileGeometryCreator.instance,R=this.decodedTile,L=new Map,D=p.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.TEXT"),I=p.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.INDEX"),O=this.mapView.env;void 0!==R.textPathGeometries&&(this.preparedTextPaths=E.prepareTextPaths(R.textPathGeometries,R));const F=this.center.x,U=this.center.y,V=this.center.z,N=this.mapView.pixelToWorld,B=this.computeWorldOffsetX();let k=0;if(this.iconTextGroups.count()>0){const e=new C,t=new C,i=[];this.iconTextGroups.forEachElement((n=>{if(n.type!==g.IconTextType.LineMarker&&n.type!==g.IconTextType.PointIconText)return;const r=n.type===g.IconTextType.LineMarker?t:e,s=5*N,l=(e,t,l)=>{if(A(e,t,l,s,r),o||a){const r=.5*s,o=`${n.text} [${k}]`,a=new m.IconText(v.ContextualArabicConverter.instance.convert(o),new c.Vector3(e+B+F+r,t+U+r,l+V),M,w,m.IconText.HIGHEST_PRIORITY,m.IconText.HIGHEST_Z_ORDER,0,0);a.textMinZoomLevel=0,a.mayOverlap=!0,a.reserveSpace=!1,a.alwaysOnTop=!0,a.ignoreDistance=!0,a.priority=m.IconText.HIGHEST_PRIORITY,a._isDebug=!0,i.push(a)}k++};if(void 0!==n.path&&Array.isArray(n.path))for(let e=0;e<n.path.length;e++){const t=n.path[e];l(t.x-F,t.y-U,10+t.z+5*e-V)}else o&&l(n.position.x-F,n.position.y-U,5-V)}));for(const e of i)this.addIconText(e);P(this.objects,e,0,(e=>new u.Mesh(e,b))),P(this.objects,t,0,(e=>new u.Mesh(e,T)))}if(void 0!==this.preparedTextPaths){const o=new C,a=new C,p=new C;let f=0;for(const h of this.preparedTextPaths){const u=R.techniques[h.technique];if(!(0,_.isTextTechnique)(u)||void 0!==h._isDebug)continue;void 0!==u.color&&L.set(h.technique,new l.Color((0,d.getPropertyValue)(u.color,O))),f=o.positions.length/3;const g=h.text,y=this.preparedTextPaths.indexOf(h);if((!D||g&&g.includes(D))&&(void 0===I||I===y)){for(let l=0;l<h.path.length;l+=3){const f=l/3,_=h.path[l]-F,y=h.path[l+1]-U,x=10+h.path[l+2]+l/3-V;r&&o.positions.push(_,y,x);const S=0===l&&r;if((s||S)&&(A(_,y,x,N*(S?6:4),S?a:p),s)){const r=null!==(e=u.xOffset)&&void 0!==e?e:0,s=null!==(t=u.yOffset)&&void 0!==t?t:0,o=u.minZoomLevel,a=f%5==0?g+":"+f:Number(f).toString(),l=new m.IconText(v.ContextualArabicConverter.instance.convert(a),new c.Vector3(_+B+F,y+U,x+V),M,w,(0,d.getPropertyValue)(null!==(i=u.priority)&&void 0!==i?i:0,O),(0,d.getPropertyValue)(null!==(n=u.zOrder)&&void 0!==n?n:0,O),r,s);l.textMinZoomLevel=(0,d.getPropertyValue)(o,O),l.mayOverlap=!0,l.reserveSpace=!1,l.alwaysOnTop=!0,l.ignoreDistance=!0,l.priority=m.IconText.HIGHEST_PRIORITY,l.zOrder=m.IconText.HIGHEST_Z_ORDER,this.addIconText(l)}}const l=h.path.length/3;for(let e=0;e<l;++e)e>0&&o.indices.push(f+e),e+1<l&&o.indices.push(f+e)}}P(this.objects,o,-2,(e=>new h.LineSegments(e,y))),P(this.objects,a,0,(e=>new u.Mesh(e,x))),P(this.objects,p,-1,(e=>new u.Mesh(e,S)))}}}t.OmvDebugLabelsTile=R},9959:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.GEOJSON_TILER_SERVICE_TYPE=t.VECTOR_TILE_DECODER_SERVICE_TYPE=t.OmvGeometryType=void 0,(i=t.OmvGeometryType||(t.OmvGeometryType={}))[i.UNKNOWN=0]="UNKNOWN",i[i.POINT=1]="POINT",i[i.LINESTRING=2]="LINESTRING",i[i.POLYGON=3]="POLYGON",t.VECTOR_TILE_DECODER_SERVICE_TYPE="vector-tile-decoder",t.GEOJSON_TILER_SERVICE_TYPE="geojson-tiler"},7305:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvPoliticalViewFeatureModifier=void 0,t.OmvPoliticalViewFeatureModifier=class{constructor(e){this.m_countryCode=e}doProcessPointFeature(e,t,i){return this.processFeature(e,t)}doProcessLineFeature(e,t,i){return this.processFeature(e,t)}doProcessPolygonFeature(e,t,i){return!0}rewriteEnvironment(e,t){this.isPoliticalViewLayer(e)&&this.updateEnvironment(t,this.m_countryCode,"kind")}updateEnvironment(e,t,i){const n=this.getAlternativePov(e,t,i);void 0!==n&&(e.entries[i]=n)}getAlternativePov(e,t,i){const n=t,r=e.lookup(`${i}:${n}`);return"string"==typeof r&&r.length>0?r:void 0}isPoliticalViewLayer(e){return"boundaries"===e||"places"===e}processFeature(e,t){let i=!1;if(this.isPoliticalViewLayer(e)){const n=Object.keys(t.unmap()).filter((e=>e.includes("kind:"))).length>0,r=!!t.lookup(`kind:${this.m_countryCode}`),s=!!t.lookup("kind"),o=Boolean(this.m_countryCode);i=!o&&!s&&n||o&&(!s&&n&&!r||s&&r),!i&&o&&r&&this.rewriteEnvironment(e,t)}return!i}}},3123:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvRestClient=t.AuthenticationTypeAccessToken=t.AuthenticationTypeTomTomV1=t.AuthenticationTypeBearer=t.AuthenticationMethod=t.APIFormat=void 0;const n=i(8449),r=i(3209),s=i(4342).LoggerManager.instance.create("OmvRestClient");var o,a;!function(e){e[e.HereV1=0]="HereV1",e[e.MapboxV4=1]="MapboxV4",e[e.XYZMVT=2]="XYZMVT",e[e.XYZJson=3]="XYZJson",e[e.XYZOMV=4]="XYZOMV",e[e.TomtomV1=5]="TomtomV1",e[e.XYZSpace=6]="XYZSpace"}(o=t.APIFormat||(t.APIFormat={})),function(e){e[e.QueryString=0]="QueryString",e[e.AuthorizationHeader=1]="AuthorizationHeader"}(a=t.AuthenticationMethod||(t.AuthenticationMethod={})),t.AuthenticationTypeBearer={method:a.AuthorizationHeader,name:"Bearer"},t.AuthenticationTypeTomTomV1={method:a.QueryString,name:"key"},t.AuthenticationTypeAccessToken={method:a.QueryString,name:"access_token"};class l extends n.DataProvider{constructor(e){super(),this.params=e,this.downloadManager=void 0===e.downloadManager?r.TransferManager.instance():e.downloadManager,this.urlParams=void 0===e.urlParams?{}:e.urlParams}async connect(){}ready(){return!0}async getTile(e,t){const i={signal:t};let n=this.dataUrl(e);const r=await this.getActualAuthenticationCode();return n=this.applyAuthCode(n,i,r),n=this.addQueryParams(n,this.urlParams),this.params.apiFormat===o.XYZJson?await this.downloadManager.downloadJson(n,i):await this.downloadManager.downloadArrayBuffer(n,i)}dispose(){}async getActualAuthenticationCode(){return"string"==typeof this.params.authenticationCode?this.params.authenticationCode:void 0!==this.params.authenticationCode?await this.params.authenticationCode():void 0!==this.params.getBearerToken?await this.params.getBearerToken():void 0}getDefaultAuthMethod(){if(void 0!==this.params.getBearerToken)return t.AuthenticationTypeBearer;switch(this.params.apiFormat){case o.HereV1:return t.AuthenticationTypeBearer;case o.MapboxV4:case o.XYZOMV:case o.XYZMVT:case o.XYZSpace:case o.XYZJson:return t.AuthenticationTypeAccessToken;case o.TomtomV1:return t.AuthenticationTypeTomTomV1;default:return void s.warn(`#getDefaultAuthMethod: Not supported API format: ${this.params.apiFormat}`)}}applyAuthCode(e,t,i){var n,r,s;if(void 0===i)return e;const o=null!==(n=this.params.authenticationMethod)&&void 0!==n?n:this.getDefaultAuthMethod();if(void 0===o)return e;if(o.method===a.AuthorizationHeader){void 0===t.headers&&(t.headers=new Headers);const e=null!==(r=o.name)&&void 0!==r?r:"Bearer";t.headers.append("Authorization",`${e} ${i}`)}else if(o.method===a.QueryString){const t={};t[null!==(s=o.name)&&void 0!==s?s:"access_token"]=i,e=this.addQueryParams(e,t)}return e}dataUrl(e){if(void 0!==this.params.url)return this.params.url.replace("{x}",String(e.column)).replace("{y}",String(e.row)).replace("{z}",String(e.level));let t=[`/${e.level}`,e.column,e.row].join(this.params.apiFormat===o.XYZSpace||this.params.apiFormat===o.XYZJson?"_":"/");switch(this.params.apiFormat){case o.HereV1:case o.XYZOMV:t+="/omv";break;case o.MapboxV4:case o.XYZMVT:t+=".mvt";break;case o.XYZJson:break;case o.XYZSpace:t+=".mvt";break;case o.TomtomV1:t+=".pbf";break;default:s.warn(`Not supported API format: ${this.params.apiFormat}`)}return this.params.baseUrl+t}addQueryParams(e,t){let i="",n=e.includes("?")?"&":"?";for(const e in t)t.hasOwnProperty(e)&&(i+=`${n}${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`,"?"===n&&(n="&"));return e+i}}t.OmvRestClient=l},6441:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorTile2TargetTile=t.webMercatorTile2TargetWorld=t.world2tile=t.tile2world=t.createWorldTileTransformationCookie=t.tile2lat=t.lat2tile=t.isArrayBufferLike=void 0;const n=i(6815),r=i(2616);function s(e,t){return Math.round((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function o(e,t){const{north:i,west:n}=t.geoBox,r=Math.log2(e),o=Math.pow(2,t.tileKey.level+r);return{extents:e,scale:o,top:s(i,t.tileKey.level+r),left:Math.round((n+180)/360*o)}}function a(e,t,i,n=!1,s){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=o(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,h=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return s.x=(l+i.x)/c*h,s.y=(a+(n?-i.y:i.y))/c*h,s.z=(0,r.isVector3Like)(i)?i.z:0,s}function l(e,t,i,s,o,l=!1){a(e,t,i,l,s),t.targetProjection.reprojectPoint(r.webMercatorProjection,s,s),i instanceof n.Vector3&&o&&(s.z*=t.targetProjection.getScaleFactor(s))}t.isArrayBufferLike=function(e){return"undefined"!=typeof SharedArrayBuffer?e instanceof ArrayBuffer||e instanceof SharedArrayBuffer:e instanceof ArrayBuffer},t.lat2tile=s,t.tile2lat=function(e,t){const i=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))},t.createWorldTileTransformationCookie=o,t.tile2world=a,t.world2tile=function(e,t,i,n=!1,s){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=o(e,t));const{top:a,left:l,scale:c}=t.worldTileProjectionCookie,h=r.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return s.x=Math.round(i.x/h*c-l),s.y=Math.round((n?-1:1)*(i.y/h*c-a)),(0,r.isVector3Like)(s)&&(s.z=i.z),s},t.webMercatorTile2TargetWorld=l,t.webMercatorTile2TargetTile=function(e,t,i,n,r,s=!1){l(e,t,i,n,r,s),n.sub(t.center)}},627:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ring=void 0;const n=i(9776);t.Ring=class{constructor(e,t,i=4096,r=!1){if(this.points=e,this.textureCoords=t,this.extents=i,this.hasClipInfo=r,void 0!==t&&t.length!==e.length)throw new Error("the array of texture coordinates must have the same number of elements of the array of points");this.vertexStride=2,void 0!==t&&(this.vertexStride=this.vertexStride+2),this.area=n.ShapeUtils.area(this.points),this.winding=this.area<0}toArray(e=[],t=0){var i;return this.points.forEach(((i,n)=>i.toArray(e,t+this.vertexStride*n))),null===(i=this.textureCoords)||void 0===i||i.forEach(((i,n)=>i.toArray(e,t+this.vertexStride*n+2))),e}isProperEdge(e){const t=this.extents,i=(e+1)%this.points.length,n=this.points[e],r=this.points[i];if(this.hasClipInfo){if(n.x!==r.x&&n.y!==r.y)return!0;if(n.x%this.extents!=0&&n.y%this.extents!=0)return!0;if(r.x%this.extents!=0&&r.y%this.extents!=0)return!0;const e=!0===n.isClipped,t=!0===r.isClipped;return!e&&!t}return!(n.x<=0&&r.x<=0||n.x>=t&&r.x>=t||n.y<=0&&r.y<=0||n.y>=t&&r.y>=t)}}},1140:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataEmitter=void 0;const n=i(6782),r=i(9365),s=i(3148),o=i(9776),a=i(2754),l=i(5971),c=i(414),h=i(3334),u=i(5448),d=i(6815),m=i(8152),p=i(3561),f=i(2982),g=i(6525),v=i(6189),_=i(2616),y=i(4388),x=i(3711),S=i(5033),b=i(1984),T=i(4342),M=i(9287),w=i(6441),E=i(627),C=T.LoggerManager.instance.create("OmvDecodedTileEmitter"),A=new d.Vector3,P=new d.Vector3,R=new d.Vector3,L=new d.Vector3,D=new u.Vector2,I=new u.Vector2,O=new d.Vector3,F=new d.Vector3,U=new d.Vector3,V=new u.Vector2,N=new u.Vector2,B=new u.Vector2,k=new d.Vector3,z=new d.Vector3,G=new d.Vector3,j=new d.Vector3,H=new d.Vector3,W=new c.Line3,q=Math.PI/8;function X(e,t,i="index"){const n=t>65535?"uint32":"uint16";return{itemCount:1,name:i,buffer:("uint32"===n?new Uint32Array(e):new Uint16Array(e)).buffer,type:n}}class K{constructor(e){this.type=e,this.positions=[],this.normals=[],this.textureCoordinates=[],this.colors=[],this.extrusionAxis=[],this.indices=[],this.edgeIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.textBackgroundImageTextures=[],this.featureStarts=[],this.edgeFeatureStarts=[],this.objInfos=[],this.offsetDirections=[]}addText(e){let t=this.stringCatalog.indexOf(e);return t<0&&(t=this.stringCatalog.length,this.stringCatalog.push(e)),t}}var Y;!function(e){e[e.Simple=0]="Simple",e[e.Complex=1]="Complex"}(Y||(Y={}));const Z=new l.Color;t.VectorTileDataEmitter=class{constructor(e,t,i={}){var n,r,s;this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_options=i,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_pathGeometries=[],this.m_iconTextGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_sources=[],this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_options.gatherFeatureAttributes=null!==(n=i.gatherFeatureAttributes)&&void 0!==n&&n,this.m_options.skipShortLabels=null===(r=i.skipShortLabels)||void 0===r||r,this.m_options.enableElevationOverlay=null!==(s=i.enableElevationOverlay)&&void 0!==s&&s}get projection(){return this.m_decodeInfo.targetProjection}get center(){return this.m_decodeInfo.center}processPointFeature(e,t,i,n,r){var s;const o=n.env;this.processFeatureCommon(o);const{tileKey:a,columnCount:l,rowCount:c}=this.m_decodeInfo,h=a.column+1<l?t-1:t,u=a.row+1<c?t-1:t,d=i.filter((e=>e.x>=0&&e.x<=h&&e.y>=0&&e.y<=u));if(0!==d.length)for(const e of r){if(void 0===e)continue;const i=e._index,r=this.findOrCreateMeshBuffers(i,m.GeometryType.Point);if(void 0===r)continue;const{positions:a,texts:l,imageTextures:c,textBackgroundImageTextures:h,objInfos:u,offsetDirections:f}=r,g=(0,b.isTextTechnique)(e)||(0,b.isIconTextTechnique)(e);let v,y;const x=(0,b.isIconTextTechnique)(e);if(x){const t=e;v=(0,p.evaluateTechniqueAttr)(n,t.imageTexture),void 0!==t["background-image"]&&(y=(0,p.evaluateTechniqueAttr)(n,t["background-image"]))}const S=(0,m.scaleHeight)(n,e,this.m_decodeInfo.tileKey.level),T=(0,m.getFeatureId)(o.entries);for(const i of d){if(g){const t=e,i=(0,m.getFeatureText)(n,t,this.m_options.languages);void 0!==i?l.push(r.addText(i)):l.push(-1)}g?(0,w.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,i,O,S):(0,w.webMercatorTile2TargetTile)(t,this.m_decodeInfo,i,O,S);const d=this.projection.type===_.ProjectionType.Planar?O.z:i.z;d>this.m_maxGeometryHeight?this.m_maxGeometryHeight=d:d<this.m_minGeometryHeight&&(this.m_minGeometryHeight=d),a.push(O.x,O.y,O.z),u.push(this.m_options.gatherFeatureAttributes?o.entries:T),f.push(null!==(s=o.lookup("offset_direction"))&&void 0!==s?s:0),x&&(void 0===v?c.push(-1):c.push(r.addText(v)),void 0===y?h.push(-1):h.push(r.addText(y)))}}}processLineFeature(e,t,i,n,s){var o;const a=n.env;this.processFeatureCommon(a);const l=[],c=[],h=[],u=[],f=this.m_decodeInfo.projectedBoundingBox;let g;const v=2*f.extents.x,_=2*f.extents.y,y=Math.max(v,_);let S,E;const A=void 0!==i[0].untiledPositions,P=!1;let R=!1,L=!1;for(const e of s)if(void 0!==e){if(S){const t=this.getTextureCoordinateType(e);(0,T.assert)(void 0===t||E===t)}else S=this.getComputeTexCoordsFunc(e),E=this.getTextureCoordinateType(e);R=R||(0,b.isSpecialDashesLineTechnique)(e),L=L||!R}for(const e of i){const i=[];let n=0;if(A&&(this.m_decodeInfo.targetProjection.projectPoint(e.untiledPositions[0],F),e.untiledPositions.forEach((e=>{this.m_decodeInfo.targetProjection.projectPoint(e,O),n+=O.distanceTo(F),F.copy(O),this.m_decodeInfo.targetProjection.projectPoint(e.normalized(),O),i.push(O.x,O.y,O.z,n)}))),R){g=[];let r=0;const s=e.positions.length;if(s>1){let o=0;for(let a=0;a<s-1;a++){const s=[],l=[],d=[],m=[],p=e.positions[a],f=e.positions[a+1];if((0,w.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,p,O,P),l.push(O.x,O.y,O.z),(0,w.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,f,U,P),l.push(U.x,U.y,U.z),S&&(S(p,t).toArray(d,d.length),S(f,t).toArray(d,d.length)),A){let e=this.findRelativePositionInLine(O,i)/n;m.push(e),e=this.findRelativePositionInLine(U,i)/n,m.push(e)}else{m.push(o);const e=O.distanceTo(U);r+=e,o+=e,m.push(o)}O.sub(this.m_decodeInfo.center),s.push(O.x,O.y,O.z),U.sub(this.m_decodeInfo.center),s.push(U.x,U.y,U.z),g.push(s),c.push(l),h.push(d),u.push(m)}}if(!A&&r>0)for(const e of u)e.forEach(((t,i)=>{e[i]=t/r}))}if(L){const r=[],s=[],o=[],a=[];e.positions.forEach((e=>{if((0,w.webMercatorTile2TargetWorld)(t,this.m_decodeInfo,e,O,P),s.push(O.x,O.y,O.z),S&&S(e,t).toArray(o,o.length),A){const e=this.findRelativePositionInLine(O,i)/n;a.push(e)}O.sub(this.m_decodeInfo.center),r.push(O.x,O.y,O.z)})),l.push(r),c.push(s),h.push(o),u.push(a)}}const D=this.m_decodeInfo.tileKey.level>=11;for(const e of s){if(void 0===e)continue;const t=e._index,i=e.name;if((0,b.isLineTechnique)(e)||(0,b.isSolidLineTechnique)(e)){const i=(0,b.isLineTechnique)(e)?this.m_simpleLines:this.m_solidLines,r=(0,b.isLineTechnique)(e)?Y.Simple:Y.Complex;R&&((0,T.assert)(void 0!==g,"OmvDecodedTileEmitter#processLineFeature: Internal error - No localLineSegments"),this.applyLineTechnique(i,e,t,r,a.entries,g,n,this.getTextureCoordinateType(e)?h:void 0,u)),l.length>0&&this.applyLineTechnique(i,e,t,r,a.entries,l,n,this.getTextureCoordinateType(e)?h:void 0,A?u:void 0)}else if((0,b.isTextTechnique)(e)||(0,b.isIconTextTechnique)(e)||(0,b.isLineMarkerTechnique)(e)){const i=e,s=(0,m.getFeatureText)(n,i,this.m_options.languages);if(void 0===s&&!(0,b.isIconTextTechnique)(e)&&!(0,b.isLineMarkerTechnique)(e))continue;if((0,b.isTextTechnique)(e)){let e=[];if(this.m_options.skipShortLabels){const t=y/this.m_decodeInfo.tileSizeOnScreen,i=5*String(s).length*t*.5,n=i*i;e=this.splitJaggyLines(c,n,q)}else e=c;if(0===e.length)continue;for(const i of e){const e=T.Math2D.computeSquaredLineLength(i);this.m_textPathGeometries.push({technique:t,path:i,pathLengthSqr:e,text:String(s),objInfos:this.m_options.gatherFeatureAttributes?a.entries:(0,m.getFeatureId)(a.entries)})}}else{const i=e,l=(0,p.evaluateTechniqueAttr)(n,i.imageTexture),h=Math.max(Number.EPSILON,null!==(o=(0,p.evaluateTechniqueAttr)(n,i["anchor-point-density"]))&&void 0!==o?o:20),u=this.m_decodeInfo.projectedBoundingBox.extents,d=2*Math.min(u.x,u.y)/h,f=new r.BufferAttribute(new Float64Array,3);for(const e of c)f.array=e,f.count=e.length/f.itemSize,this.m_iconTextGeometries.push({technique:t,positions:{name:"position",type:"float",buffer:(0,M.computeLineAnchorPoints)(f,d),itemCount:f.itemSize},texts:[0],stringCatalog:[s,l],imageTextures:[1],objInfos:this.m_options.gatherFeatureAttributes?[a.entries]:[(0,m.getFeatureId)(a.entries)]})}}else if((0,b.isLabelRejectionLineTechnique)(e))for(const e of c){const t=[];for(let i=0;i<e.length;i+=3)t.push((new d.Vector3).fromArray(e,i));this.m_pathGeometries.push({path:t})}else if((0,b.isExtrudedLineTechnique)(e)){const i=this.findOrCreateMeshBuffers(t,m.GeometryType.ExtrudedLine);if(void 0===i)continue;const{positions:r,indices:s,groups:o,featureStarts:c,objInfos:h}=i,u=s.length,d=(0,p.evaluateTechniqueAttr)(n,e.width);if(void 0===d)continue;const f=(0,p.evaluateTechniqueAttr)(n,e.cap,"Circle"),g=D&&"Circle"===f;l.forEach((e=>{(0,x.triangulateLine)(e,d,r,s,g),c.push(u),h.push(this.m_options.gatherFeatureAttributes?a.entries:(0,m.getFeatureId)(a.entries))}));const v=s.length-u;o.push({start:u,count:v,technique:t})}else C.warn(`OmvDecodedTileEmitter#processLineFeature: Invalid line technique\n                     ${i} for layer: ${a.entries.$layer} `)}}processPolygonFeature(e,t,i,n,r){const s=n.env;this.processFeatureCommon(s);const l=!1;r.forEach((e=>{if(void 0===e)return;const r=e._index;if(void 0===r)throw new Error("OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index");let c;const h=s.lookup("bbox");if(Array.isArray(h)){const[e,t,i,n]=h,r=new _.GeoBox(new _.GeoCoordinates(t,e),new _.GeoCoordinates(n,i));c=new a.Box3,_.webMercatorProjection.projectBox(r,c)}const u=[],d=(0,b.isExtrudedPolygonTechnique)(e),m=(0,b.isPolygonTechnique)(e),p=(0,b.isStandardTechnique)(e),g=d||m||p,v=this.getComputeTexCoordsFunc(e,c),y=g&&!d;for(const e of i){const i=[];for(let n=0;n<e.rings.length;n++){const r=0===n;let s=e.rings[n];y&&s.some((e=>e.x<0||e.x>t||e.y<0||e.y>t))&&(s=(0,f.clipPolygon)(s,t));const a=o.ShapeUtils.area(s);if(r&&0===a)break;if(0!==a){let e;void 0!==v&&(e=s.map((e=>v(e,t)))),i.push(new E.Ring(s,e,t,y))}}i.length>0&&u.push(i)}const x=(0,b.isSolidLineTechnique)(e)||(0,b.isLineTechnique)(e);if(g)this.applyPolygonTechnique(u,e,r,n,t);else if(x){const i="line"===e.name?this.m_simpleLines:this.m_solidLines,o="line"===e.name?Y.Simple:Y.Complex,a=(0,b.isSpecialDashesLineTechnique)(e);u.forEach((c=>{const h=[],u=a?[]:void 0;c.forEach((e=>{const i=e.points.length;let n=[],r=0,s=0,o=a?[]:void 0;for(let c=0;c<i;++c){a&&n.length>0&&(n=[],o=[]);const d=(c+1)%i,m=e.points[c],p=e.points[d],f=e.isProperEdge(c);if(f||0===n.length){if(f&&0===n.length&&((0,w.webMercatorTile2TargetTile)(t,this.m_decodeInfo,D.copy(m),O,l),n.push(O.x,O.y,O.z),a)){(0,w.webMercatorTile2TargetTile)(t,this.m_decodeInfo,D.copy(p),U,l),n.push(U.x,U.y,U.z),o.push(s);const e=O.distanceTo(U);r+=e,s+=e,o.push(s)}}else h.push(n),n=[];f&&!a&&((0,w.webMercatorTile2TargetTile)(t,this.m_decodeInfo,D.copy(p),O,l),n.push(O.x,O.y,O.z)),a&&n.length>0&&r>0&&(o.forEach(((e,t)=>{o[t]=e/r})),h.push(n),u.push(o))}!a&&n.length>0&&h.push(n)})),0!==h.length&&this.applyLineTechnique(i,e,r,o,s.entries,h,n,void 0,u)}))}}))}getDecodedTile(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines);const e={techniques:this.m_styleSetEvaluator.decodedTechniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(e.textGeometries=this.m_textGeometries),this.m_iconTextGeometries.length>0&&(e.iconTextGeometries=this.m_iconTextGeometries),this.m_textPathGeometries.length>0&&(e.textPathGeometries=this.m_textPathGeometries),this.m_pathGeometries.length>0&&(e.pathGeometries=this.m_pathGeometries),0!==this.m_sources.length&&(e.copyrightHolderIds=this.m_sources),e.maxGeometryHeight=this.m_maxGeometryHeight,e.minGeometryHeight=this.m_minGeometryHeight,e}splitJaggyLines(e,t,i){const n=[],r=(e,t,i)=>{let n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(let a=t;a<i;a+=3){const t=e[a],i=e[a+1];t<n&&(n=t),t>r&&(r=t),i<s&&(s=i),i>o&&(o=i)}return(r-n)*(r-n)+(o-s)*(o-s)},s=e.slice();for(;s.length>0;){const e=s.pop();if(void 0===e||e.length<6)continue;let o=-1;for(let t=0;t<e.length-3;t+=3){V.set(e[t],e[t+1]),N.set(e[t+3],e[t+4]);const n=N.sub(V).normalize();if(t>0){const e=Math.atan2(B.x*n.y-n.x*B.y,n.dot(B));if(Math.abs(e)>i){o=t;break}}B.set(n.x,n.y)}if(o>0){const i=r(e,0,o+3),a=r(e,o,e.length);i>t&&n.push(e.slice(0,o+3)),a>t&&s.push(e.slice(o))}else r(e,0,e.length)>t&&n.push(e)}return n}getTextureCoordinateType(e){return((0,b.isPolygonTechnique)(e)||(0,b.isSolidLineTechnique)(e)||(0,b.isExtrudedPolygonTechnique)(e))&&this.m_options.enableElevationOverlay?b.TextureCoordinateType.TileSpace:(0,b.textureCoordinateType)(e)}getComputeTexCoordsFunc(e,t){switch(this.getTextureCoordinateType(e)){case b.TextureCoordinateType.TileSpace:return(e,t)=>{const i=e.clone().divideScalar(t);return i.y=1-i.y,i};case b.TextureCoordinateType.EquirectangularSpace:return(e,t)=>{const i=(0,w.tile2world)(t,this.m_decodeInfo,e,!1,F),n=_.normalizedEquirectangularProjection.reprojectPoint(_.webMercatorProjection,i);return new u.Vector2(n.x,n.y)};case b.TextureCoordinateType.FeatureSpace:if(!t)return;return(e,i)=>{const n=(0,w.tile2world)(i,this.m_decodeInfo,e,!1,F),r=new u.Vector2(n.x,n.y);return t&&(r.x-=t.min.x,r.y-=t.min.y,r.x/=t.max.x-t.min.x,r.y/=t.max.y-t.min.y),r.y=1-r.y,r};default:return}}applyLineTechnique(e,t,i,n=Y.Complex,r,s,o,a,l){let c;const h=e.find((e=>e.technique===i)),u=void 0!==a;if(void 0===h){c=new y.LineGroup(u,void 0,n===Y.Simple);const t={type:n===Y.Complex?m.GeometryType.SolidLine:m.GeometryType.Line,technique:i,lines:c};this.m_options.gatherFeatureAttributes&&(t.objInfos=[r],t.featureStarts=[0]),e.push(t)}else c=h.lines,this.m_options.gatherFeatureAttributes&&h.objInfos&&h.featureStarts&&(h.objInfos.push(r),h.featureStarts.push(c.indices.length));let d=0;s.forEach((e=>{c.add(this.m_decodeInfo.center,e,this.projection,l?l[d]:void 0,a?a[d]:void 0),d++}))}applyPolygonTechnique(e,t,i,o,a){var l,c;if(0===e.length)return;const u=(0,b.isExtrudedPolygonTechnique)(t),d=u?m.GeometryType.ExtrudedPolygon:m.GeometryType.Polygon,f=this.findOrCreateMeshBuffers(i,d);if(void 0===f)return;const y=t,x=t,M=!0===y.boundaryWalls,E=(0,b.isPolygonTechnique)(t),U=this.getTextureCoordinateType(t);let V=(0,p.evaluateTechniqueAttr)(o,y.height),N=(0,p.evaluateTechniqueAttr)(o,y.floorHeight);if(void 0===V){const e=o.env.lookup("height"),t=(0,p.evaluateTechniqueAttr)(o,y.defaultHeight);V=void 0!==e?e:void 0!==t?t:0}if(void 0===N){const e=o.env.lookup("min_height");N=void 0===e||E?0:e}V=Math.max(N+S.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT,V);const B=this.m_decodeInfo.tileKey.level,k=u&&(0,m.scaleHeight)(o,y,B);this.m_decodeInfo.tileBounds.getCenter(A);const{positions:z,normals:G,textureCoordinates:j,colors:H,extrusionAxis:W,indices:q,edgeIndices:K,groups:Y}=f,$=this.m_decodeInfo.targetProjection.type===_.ProjectionType.Spherical,J=u?null!==(l=y.lineWidth)&&void 0!==l?l:0:E&&null!==(c=x.lineWidth)&&void 0!==c?c:0,Q="number"!=typeof J||J>0;let ee;if((0,b.isExtrudedPolygonTechnique)(t)&&(0,T.getOptionValue)(t.vertexColors,!1)){let e=(0,p.evaluateTechniqueAttr)(o,t.color);if(void 0===e){const t=o.env.lookup("color");this.isColorStringValid(t)&&(e=String(t))}void 0===e&&(e=(0,p.evaluateTechniqueAttr)(o,t.defaultColor,0)),void 0===e&&(e=0),Z.set(e),ee=Z}for(const t of e){const e=q.length,l=K.length,c=[],d=z.length/3,m=t[0],p=m.vertexStride,x=p+2;for(let e=0;e<m.points.length;++e){const t=m.points[e];c.push(t.x,-t.y),void 0!==m.textureCoords&&c.push(m.textureCoords[e].x,m.textureCoords[e].y);const i=(e+1)%m.points.length,n=m.isProperEdge(e);c.push(n?i:-1,M||n?i:-1)}const S=[];let b=1;for(;b<t.length;){const e=c.length/x;S.push(e);const i=t[b++];for(let t=0;t<i.points.length;++t){const n=(t+1)%i.points.length,r=i.points[t];c.push(r.x,-r.y),void 0!==i.textureCoords&&c.push(i.textureCoords[t].x,i.textureCoords[t].y);const s=i.isProperEdge(t);c.push(s?e+n:-1,M||s?e+n:-1)}}try{const e=n.Earcut.triangulate(c,S,x),t=c.length/x;if($){const t=new s.BufferGeometry,i=[],n=[],o=[],l=[];for(let e=0;e<c.length;e+=x){const t=(0,w.tile2world)(a,this.m_decodeInfo,D.set(c[e],c[e+1]),!0,F);i.push(t.x,t.y,0),void 0!==U&&n.push(c[e+2],c[e+3]),o.push(c[e+p]),l.push(c[e+p+1])}const u=new r.BufferAttribute(new Float32Array(i),3);let d;t.setAttribute("position",u),void 0!==U&&(d=new r.BufferAttribute(new Float32Array(n),2),t.setAttribute("uv",d));const m=new r.BufferAttribute(new Float32Array(o),1);t.setAttribute("edge",m);const f=new r.BufferAttribute(new Float32Array(l),1);t.setAttribute("wall",m);const y=X(e,u.count-1),S="uint32"===y.type?new r.Uint32BufferAttribute(y.buffer,1):new r.Uint16BufferAttribute(y.buffer,1);t.setIndex(S);const b=this.m_decodeInfo.tileKey.level;if(b>=3&&b<9){const e=Math.pow(2,9-b),{geoBox:i}=this.m_decodeInfo;new g.EdgeLengthGeometrySubdivisionModifier(e,i,g.SubdivisionMode.NoDiagonals,_.webMercatorProjection).modify(t)}new v.SphericalGeometrySubdivisionModifier((0,h.degToRad)(10),_.webMercatorProjection).modify(t),c.length=0,e.length=0;for(let e=0;e<u.array.length;e+=3){const t=(0,w.world2tile)(a,this.m_decodeInfo,O.set(u.array[e],u.array[e+1],0),!0,I);c.push(t.x,t.y),void 0!==U&&(c.push(d.array[e/3*2]),c.push(d.array[e/3*2+1])),c.push(m.array[e/3]),c.push(f.array[e/3])}const T=t.getIndex();null!==T&&e.push(...T.array)}P.set(0,0,1);for(let e=0;e<c.length;e+=x){(0,w.webMercatorTile2TargetWorld)(a,this.m_decodeInfo,D.set(c[e],c[e+1]),O,!1,!0);const t=k?this.m_decodeInfo.targetProjection.getScaleFactor(O):1;this.m_maxGeometryHeight=Math.max(this.m_maxGeometryHeight,t*V),this.m_minGeometryHeight=Math.min(this.m_minGeometryHeight,t*V),$&&P.set(O.x,O.y,O.z).normalize(),O.sub(this.center),R.copy(P).multiplyScalar(N*t),z.push(O.x+R.x,O.y+R.y,O.z+R.z),void 0!==U&&j.push(c[e+2],c[e+3]),this.m_options.enableElevationOverlay&&G.push(...P.toArray()),u&&(L.copy(P).multiplyScalar(V*t),z.push(O.x+L.x,O.y+L.y,O.z+L.z),W.push(0,0,0,0,L.x-R.x,L.y-R.y,L.z-R.z,1),void 0!==U&&j.push(c[e+2],c[e+3]),this.m_options.enableElevationOverlay&&G.push(...P.toArray()),void 0!==ee&&H.push(ee.r,ee.g,ee.b,ee.r,ee.g,ee.b))}for(let t=0;t<e.length;t+=3)if(u){const i=d+2*e[t+0]+1,n=d+2*e[t+1]+1,r=d+2*e[t+2]+1;q.push(i,n,r)}else{const i=d+e[t+0],n=d+e[t+1],r=d+e[t+2];q.push(i,n,r)}Q&&this.addEdges(d,t,x,p,z,c,K,u,y.footprint,y.maxSlope),u&&this.addWalls(d,t,x,p,c,q)}catch(e){C.error("cannot triangulate geometry",e)}this.m_options.gatherFeatureAttributes&&(f.objInfos.push(o.env.entries),f.featureStarts.push(e),f.edgeFeatureStarts.push(l));const T=q.length-e;T>0&&Y.push({start:e,count:T,technique:i})}}createGeometries(){this.m_meshBuffers.forEach(((e,t)=>{if(0===e.positions.length)return;if(!this.m_styleSetEvaluator.techniques||this.m_styleSetEvaluator.techniques.length<=t)throw new Error("Invalid technique index");const i=this.m_styleSetEvaluator.techniques[t];if(void 0===i)return;if(e.texts.length>0){const n={positions:{name:"position",type:"float",buffer:new Float64Array(e.positions).buffer,itemCount:3},texts:e.texts,technique:t,stringCatalog:e.stringCatalog,objInfos:e.objInfos};if((0,b.isTextTechnique)(i))this.m_textGeometries.push(n);else{(0,T.assert)((0,b.isIconTextTechnique)(i));const t=n;t.imageTextures=e.imageTextures,t.textBackgroundImageTextures=e.textBackgroundImageTextures,t.offsetDirections=e.offsetDirections,this.m_iconTextGeometries.push(t)}return}const n=new Float32Array(e.positions);0===e.groups.length&&e.groups.push({start:0,count:n.length/3,technique:t});const r=[{name:"position",buffer:n.buffer,itemCount:3,type:"float"}],s={type:e.type,vertexAttributes:r,groups:e.groups};if(e.normals.length>0){const t=new Float32Array(e.normals);(0,T.assert)(t.length===n.length,"length of normals buffer is different than the length of the position buffer"),r.push({name:"normal",buffer:t.buffer,itemCount:3,type:"float"})}if(e.colors.length>0){const t=new Float32Array(e.colors);(0,T.assert)(t.length===n.length,"length of colors buffer is different than the length of the position buffer"),r.push({name:"color",buffer:t.buffer,itemCount:3,type:"float"})}const o=e.positions.length/3;if(e.textureCoordinates.length>0){const t=e.textureCoordinates.length/2;(0,T.assert)(t===o,"length of textureCoordinates buffer is different than the length of theposition buffer");const i=new Float32Array(e.textureCoordinates);r.push({name:"uv",buffer:i.buffer,itemCount:2,type:"float"})}if(e.extrusionAxis.length>0){const t=new Float32Array(e.extrusionAxis);(0,T.assert)(t.length/4==n.length/3,"length of extrusionAxis buffer is different than the length of the position buffer"),r.push({name:"extrusionAxis",buffer:t.buffer,itemCount:4,type:"float"})}e.indices.length>0&&(s.index=X(e.indices,o-1)),e.edgeIndices.length>0&&(s.edgeIndex=X(e.edgeIndices,o-1,"edgeIndex")),s.featureStarts=e.featureStarts,s.edgeFeatureStarts=e.edgeFeatureStarts,s.objInfos=e.objInfos,this.m_geometries.push(s)}))}processLines(e){e.forEach((e=>{const{vertices:t,indices:i}=e.lines,n=e.technique,r=new Float32Array(t).buffer,s=X(i,t.length/e.lines.stride-1),o={type:"float",stride:e.lines.stride,buffer:r,attributes:e.lines.vertexAttributes},a={type:m.GeometryType.SolidLine,index:s,interleavedVertexAttributes:[o],groups:[{start:0,count:i.length,technique:n}],vertexAttributes:[],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(a)}))}processSimpleLines(e){e.forEach((e=>{const{vertices:t,indices:i}=e.lines,n=e.technique,r={buffer:new Float32Array(t).buffer,itemCount:3,type:"float",name:"position"},s={type:m.GeometryType.Line,index:X(i,t.length/r.itemCount-1),vertexAttributes:[r],groups:[{start:0,count:i.length,technique:n}],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(s)}))}findOrCreateMeshBuffers(e,t){let i=this.m_meshBuffers.get(e);return void 0!==i?i.type!==t?void C.error(`MeshBuffer has been created with wrong type "${m.GeometryType[t]}"\n                instead of "${m.GeometryType[i.type]}"`):i:(i=new K(t),this.m_meshBuffers.set(e,i),i)}processFeatureCommon(e){const t=e.lookup("source");"string"==typeof t&&""!==t&&(this.m_sources.includes(t)||this.m_sources.push(t))}isColorStringValid(e){return"string"==typeof e&&e.length>0}addEdges(e,t,i,n,r,s,o,a,l,c){const h=new d.Vector3,u=new d.Vector3;let m,p,f=0,g=0;for(;f<t;){for(;f!==m;){void 0===m&&(m=f),f<t&&(g=Math.max(g,f));const d=s[f*i+n];if(d<0)break;if(a)if(!0===l&&o.push(e+2*f,e+2*d),o.push(e+2*f+1,e+2*d+1),void 0!==c){if(void 0!==p){const t=3*(e+2*p),i=3*(e+2*f),n=3*(e+2*d);h.set(r[i]-r[t],r[i+1]-r[t+1],r[i+2]-r[t+2]).normalize(),u.set(r[n]-r[i],r[n+1]-r[i+1],r[n+2]-r[i+2]).normalize(),h.dot(u)<=c&&o.push(e+2*f,e+2*f+1)}}else o.push(e+2*f,e+2*f+1);else o.push(e+f,e+d);p=f,f=d}f=g+1,m=void 0,p=void 0}}addWalls(e,t,i,n,r,s){let o,a=0,l=0;for(;a<t;){for(;a!==o;){void 0===o&&(o=a),a<t&&(l=Math.max(l,a));const c=r[a*i+n+1];if(c<0)break;s.push(e+2*a,e+2*a+1,e+2*c+1,e+2*c+1,e+2*c,e+2*a),a=c}a=l+1,o=void 0}}findRelativePositionInLine(e,t){let i=1/0,n=0;for(let r=0;r<t.length;r+=4){W.set(k.set(t[r],t[r+1],t[r+2]),z.set(t[r+4],t[r+5],t[r+6])),W.closestPointToPoint(e,!0,G);const s=G.distanceTo(e);s<i&&(j.copy(G),H.copy(k),i=s,n=t[r+3])}return n+j.distanceTo(H)}}},3436:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataSource=void 0;const n=i(8152),r=i(2616),s=i(2344),o=i(8449),a=i(4342),l=i(9959),c=i(3123),h=a.LoggerManager.instance.create("VectorTileDataSource");function u(e){var t;if(e.dataProvider)return e.dataProvider;if(null!==(t=e.baseUrl)&&void 0!==t?t:e.url)return new c.OmvRestClient(e);throw new Error("OmvDataSource: missing url, baseUrl or dataProvider params")}let d=!1;const m="https://vector.hereapi.com/v2/vectortiles/base/mc",p={baseUrl:m,apiFormat:c.APIFormat.XYZOMV,layerNames:["tilezen"],authenticationMethod:{method:c.AuthenticationMethod.QueryString,name:"apikey"},copyrightInfo:[{id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"}]},f=new Map([[m,p]]);class g extends o.TileDataSource{constructor(e){var t,i,n,h,d,p,g;super(null!==(t=e.tileFactory)&&void 0!==t?t:new o.TileFactory(s.Tile),Object.assign({layerNames:null!==(i=e.layerNames)&&void 0!==i?i:["omv"],concurrentDecoderServiceName:null!==(n=e.concurrentDecoderServiceName)&&void 0!==n?n:l.VECTOR_TILE_DECODER_SERVICE_TYPE,minDataLevel:null!==(h=e.minDataLevel)&&void 0!==h?h:1,maxDataLevel:null!==(d=e.maxDataLevel)&&void 0!==d?d:17,storageLevelOffset:null!==(p=e.storageLevelOffset)&&void 0!==p?p:-1},function(e){var t;if(void 0===e.dataProvider&&void 0===e.url){const i=null!==(t=e.baseUrl)&&void 0!==t?t:m,n=Object.assign(Object.assign({},f.get(i)),e);return Object.assign(Object.assign({},n),{tilingScheme:r.webMercatorTilingScheme,dataProvider:new c.OmvRestClient(n)})}return Object.assign(Object.assign({},e),{tilingScheme:r.webMercatorTilingScheme,dataProvider:u(e)})}(e))),this.m_params=e,this.cacheable=!0,this.addGroundPlane=void 0===e.addGroundPlane||!0===e.addGroundPlane;let v=e.roundUpCoordinatesIfNeeded;void 0===v&&(null==e?void 0:e.baseUrl)===m&&(v=!0),this.m_decoderOptions={showMissingTechniques:!0===this.m_params.showMissingTechniques,gatherFeatureAttributes:!0===this.m_params.gatherFeatureAttributes,politicalView:this.m_params.politicalView,skipShortLabels:this.m_params.skipShortLabels,storageLevelOffset:null!==(g=e.storageLevelOffset)&&void 0!==g?g:-1,enableElevationOverlay:!0===this.m_params.enableElevationOverlay,roundUpCoordinatesIfNeeded:v},this.maxGeometryHeight=(0,a.getOptionValue)(e.maxGeometryHeight,r.EarthConstants.MAX_BUILDING_HEIGHT),this.minGeometryHeight=(0,a.getOptionValue)(e.minGeometryHeight,0)}async connect(){try{await super.connect()}catch(e){throw e.message&&n.WorkerServiceProtocol.isUnknownServiceError(e)&&!d&&(h.info("Unable to create decoder service in worker. Use  'OmvTileDecoderService.start();' in decoder script."),d=!0),"string"==typeof e?new Error(e):e}this.configureDecoder(void 0,this.m_decoderOptions)}shouldPreloadTiles(){return!0}setPoliticalView(e){e=null==e?void 0:e.toLowerCase(),this.m_decoderOptions.politicalView!==e&&(this.m_decoderOptions.politicalView=e,this.configureDecoder(void 0,{politicalView:void 0!==e?e:""}))}get storageLevelOffset(){return super.storageLevelOffset}set storageLevelOffset(e){super.storageLevelOffset=e,this.m_decoderOptions.storageLevelOffset=this.storageLevelOffset,this.configureDecoder(void 0,{storageLevelOffset:this.storageLevelOffset})}setEnableElevationOverlay(e){this.m_decoderOptions.enableElevationOverlay!==e&&(this.m_decoderOptions.enableElevationOverlay=e,this.configureDecoder(void 0,{enableElevationOverlay:e}))}configureDecoder(e,t){this.clearCache(),this.decoder.configure(e,t),this.isDetached()||this.mapView.markTilesDirty(this)}}t.VectorTileDataSource=g},1503:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDecoderService=t.VectorTileDecoder=t.VectorTileDataProcessor=void 0;const n=i(7769),r=i(2626),s=i(4342),o=i(5156),a=i(2926),l=i(4585),c=i(9252),h=i(9959),u=i(1140),d=s.LoggerManager.instance.create("VectorTileDecoder",{enabled:!1});class m{constructor(e,t,i,n,r={}){var s,o;this.m_tileKey=e,this.m_projection=t,this.m_styleSetEvaluator=i,this.m_dataAdapter=n,this.m_options=r,r.storageLevelOffset=null!==(s=r.storageLevelOffset)&&void 0!==s?s:0,r.showMissingTechniques=null!==(o=r.showMissingTechniques)&&void 0!==o&&o}getDecodedTile(e){this.m_styleSetEvaluator.resetTechniques();const t=new c.DecodeInfo(this.m_projection,this.m_tileKey,this.m_options.storageLevelOffset);return this.m_decodedTileEmitter=new u.VectorTileDataEmitter(t,this.m_styleSetEvaluator,this.m_options),this.m_dataAdapter.process(e,t,this),this.m_decodedTileEmitter.getDecodedTile()}processPointFeature(e,t,i,n,r){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"point",n,r,this.m_decodedTileEmitter.processPointFeature)}processLineFeature(e,t,i,n,r){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"line",n,r,this.m_decodedTileEmitter.processLineFeature)}processPolygonFeature(e,t,i,n,r){(0,s.assert)(void 0!==this.m_decodedTileEmitter),this.processFeature(e,t,i,"polygon",n,r,this.m_decodedTileEmitter.processPolygonFeature)}processFeature(e,t,i,n,r,s,o){const a=this.createMapEnv(r,s,e,n),l=this.m_styleSetEvaluator.getMatchingTechniques(a,e,n);if(0===l.length)return void(this.m_options.showMissingTechniques&&d.log("VectorTileDataProcessor#processFeature: no techniques for object:",JSON.stringify(a.unmap())));const c={env:a,cachedExprResults:new Map};this.m_decodedTileEmitter&&o.apply(this.m_decodedTileEmitter,[e,t,i,c,l])}createMapEnv(e,t,i,r){const s=this.m_tileKey.level;return new n.MapEnv(Object.assign(Object.assign({$layer:i,$id:null!=t?t:null,$level:s,$zoom:Math.max(0,s-this.m_options.storageLevelOffset),$geometryType:r},this.getLocalizedNames(e)),e))}getLocalizedNames(e){var t,i;const[n,r]=null!==(i=null===(t=this.m_options.languages)||void 0===t?void 0:t.map((t=>e[`name:${t}`])))&&void 0!==i?i:[];return{"$localized-name":null!=n?n:e.name,"$secondary-localized-name":r}}}t.VectorTileDataProcessor=m;class p extends r.ThemedTileDecoder{constructor(e){super(),this.m_dataAdapter=e,this.m_options={map:{},changed:!1},this.m_defaultDataAdapters=[],this.m_defaultDataAdapters.push(new l.OmvDataAdapter,new a.GeoJsonVtDataAdapter,new o.GeoJsonDataAdapter)}connect(){return Promise.resolve()}decodeThemedTile(e,t,i,n){const r=s.PerformanceTimer.now();if(!this.m_dataAdapter&&(this.m_dataAdapter=this.findDefaultDataAdapter(e),!this.m_dataAdapter))return Promise.reject(new Error("Unsupported data format."));const o=this.m_dataAdapter;if((0,s.assert)(o.canProcess(e)),this.m_options.changed){if(o instanceof l.OmvDataAdapter){const e=this.m_options.map;o.configure(e)}this.m_options.changed=!1}const a=new m(t,n,i,o,this.m_options.map).getDecodedTile(e);return a.decodeTime=s.PerformanceTimer.now()-r,Promise.resolve(a)}configure(e,t){super.configure(e,t),this.m_options.map=Object.assign(Object.assign(Object.assign({},this.m_options.map),e),t),this.m_options.changed=!0}findDefaultDataAdapter(e){for(const t of this.m_defaultDataAdapters)if(t.canProcess(e))return t}}t.VectorTileDecoder=p,t.VectorTileDecoderService=class{static start(){r.WorkerServiceManager.getInstance().register({serviceType:h.VECTOR_TILE_DECODER_SERVICE_TYPE,factory:e=>r.TileDecoderService.start(e,new p)})}}},2926:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonVtDataAdapter=void 0;const n=i(9776),r=i(5448),s=i(6815),o=i(2616),a=i(6441),l=4096;var c;!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(c||(c={}));const h=new s.Vector3;t.GeoJsonVtDataAdapter=class{canProcess(e){if((0,a.isArrayBufferLike)(e))return!1;const t=e;return void 0!==t.features&&void 0!==t.source&&void 0!==t.x&&void 0!==t.y&&void 0!==t.z}process(e,t,i){for(const u of e.features)switch(u.type){case c.Point:for(const t of u.geometry){const n=t[0],r=t[1],o=new s.Vector3(n,r,0);i.processPointFeature(e.layer,l,[o],u.tags,u.id)}break;case c.LineString:{const n=u.geometry;let s;const c=[];n.forEach((e=>{const t=null==s?void 0:s.positions[s.positions.length-1],[i,n]=e[0];if((null==t?void 0:t.x)===i&&(null==t?void 0:t.y)===n)for(let t=1;t<e.length;++t){const[i,n]=e[t];null==s||s.positions.push(new r.Vector2(i,n))}else{const t=e.map((([e,t])=>new r.Vector2(e,t)));c.push({positions:t}),s=c[c.length-1]}})),c.forEach((e=>{e.untiledPositions=e.positions.map((e=>((0,a.tile2world)(l,t,e,!1,h),o.webMercatorProjection.unprojectPoint(h))))})),i.processLineFeature(e.layer,l,c,u.tags,u.id);break}case c.Polygon:{const t=[];let s;for(const e of u.geometry){const i=[];for(const[t,n]of e){const e=new r.Vector2(t,n);i.push(e)}n.ShapeUtils.area(i)>0&&(s={rings:[]},t.push(s)),null==s||s.rings.push(i)}i.processPolygonFeature(e.layer,l,t,u.tags,u.id);break}case c.Unknown:}}}},5156:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataAdapter=void 0;const n=i(9776),r=i(5448),s=i(6815),o=i(6112),a=i(2616),l=i(6441),c=4096,h=new s.Vector3;function u(e,t,i){return a.webMercatorProjection.projectPoint(a.GeoCoordinates.fromGeoPoint(e),h),(0,l.world2tile)(c,t,h,!1,i)}function d(e,t){return{untiledPositions:e.map((e=>a.GeoCoordinates.fromGeoPoint(e))),positions:e.map((e=>u(e,t,new r.Vector2)))}}function m(e,t){return"LineString"===e.type?[d(e.coordinates,t)]:e.coordinates.map((e=>d(e,t)))}function p(e,t){return{rings:e.map(((e,i)=>{const r=0===i,{positions:s}=d(e,t),o=n.ShapeUtils.area(s)>0;return(r&&!o||!r&&o)&&s.reverse(),s}))}}function f(e,t){return"Polygon"===e.type?[p(e.coordinates,t)]:e.coordinates.map((e=>p(e,t)))}function g(e,t){return"Point"===e.type?[u(e.coordinates,t,new s.Vector3)]:e.coordinates.map((e=>u(e,t,new s.Vector3)))}t.GeoJsonDataAdapter=class{canProcess(e){return e&&"FeatureCollection"===e.type&&Array.isArray(e.features)}process(e,t,i,n="geojson"){if(Array.isArray(e.features)&&0!==e.features.length)for(const r of e.features)switch(r.geometry.type){case"LineString":case"MultiLineString":{let e=m(r.geometry,t);const s=[],a=100;e.forEach((e=>{(0,o.clipLineString)(e.positions,-a,-a,c+a,c+a).forEach((e=>{s.push({positions:e})}))})),e=s,e.length>0&&i.processLineFeature(n,c,s,r.properties,r.id);break}case"Polygon":case"MultiPolygon":{const e=f(r.geometry,t);i.processPolygonFeature(n,c,e,r.properties,r.id);break}case"Point":case"MultiPoint":{const e=g(r.geometry,t);i.processPointFeature(n,c,e,r.properties,r.id);break}}}}},9607:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryCommands=t.FeatureAttributes=t.visitOmvLayer=t.visitOmv=t.isClosePathCommand=t.isLineToCommand=t.isMoveToCommand=t.CommandKind=void 0;const n=i(5448),r=i(3577);var s;function o(e,t){if((!t.visitLayer||t.visitLayer(e))&&e.features)for(const i of e.features)switch(i.type){case r.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case r.com.mapbox.pb.Tile.GeomType.POINT:t.visitPointFeature&&t.visitPointFeature(i);break;case r.com.mapbox.pb.Tile.GeomType.LINESTRING:t.visitLineFeature&&t.visitLineFeature(i);break;case r.com.mapbox.pb.Tile.GeomType.POLYGON:t.visitPolygonFeature&&t.visitPolygonFeature(i)}t.endVisitLayer&&t.endVisitLayer(e)}!function(e){e[e.MoveTo=1]="MoveTo",e[e.LineTo=2]="LineTo",e[e.ClosePath=7]="ClosePath"}(s=t.CommandKind||(t.CommandKind={})),t.isMoveToCommand=function(e){return e.kind===s.MoveTo},t.isLineToCommand=function(e){return e.kind===s.LineTo},t.isClosePathCommand=function(e){return e.kind===s.ClosePath},t.visitOmv=function(e,t){if(e.layers)for(const i of e.layers)t.visitLayer&&!t.visitLayer(i)||o(i,t),t.endVisitLayer&&t.endVisitLayer(i)},t.visitOmvLayer=o,t.FeatureAttributes=class{accept(e,t,i){const{keys:n,values:r}=e,s=t.tags;if(s&&n&&r)for(let e=0;e<s.length;e+=2){const t=n[s[e]],o=r[s[e+1]];if(!i.visitAttribute(t,o))break}}},t.GeometryCommands=class{accept(e,t){if(!e)return;const i=e.length;let r=0,o=0;const a=[],l=[],c=[];for(let h=0;h<i;){const i=7&e[h],u=e[h]>>3;if(++h,i===s.MoveTo||i===s.LineTo)for(let s=0;s<u;++s){const s=e[h++],u=e[h++];r+=s>>1^-(1&s),o+=u>>1^-(1&u),"Polygon"===t.type&&(a.push(r),l.push(o));const d=new n.Vector2(r,o);c.push({kind:i,position:d})}else{for(const e of c)t.visitCommand(e);t.visitCommand({kind:i}),a.length=0,l.length=0,c.length=0}}if(c.length>0)for(const e of c)t.visitCommand(e)}}},4585:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDataAdapter=t.asGeometryType=void 0;const n=i(5133),r=i(9776),s=i(6815),o=i(7769),a=i(4342),l=i(9959),c=i(7305),h=i(6441),u=i(9607),d=i(3577),m=["stringValue","floatValue","doubleValue","intValue","uintValue","sintValue","boolValue"],p=a.LoggerManager.instance.create("OmvDataAdapter",{enabled:!1}),f=n.fromNumber(Number.MAX_SAFE_INTEGER,!0),g=n.fromNumber(Number.MIN_SAFE_INTEGER,!1);function v(e,t,i){if(void 0!==t.id&&null!==t.id)return t.id;if(e.hasOwnProperty("id")){const t=e.id;if("number"==typeof t)return t;if(t)return void 0!==i&&t.greaterThan(Number.MAX_SAFE_INTEGER)&&i.error("Invalid ID: Larger than largest available Number in feature: ",e),t.toNumber()}}function _(e){if(void 0===e)return l.OmvGeometryType.UNKNOWN;switch(e.type){case d.com.mapbox.pb.Tile.GeomType.UNKNOWN:return l.OmvGeometryType.UNKNOWN;case d.com.mapbox.pb.Tile.GeomType.POINT:return l.OmvGeometryType.POINT;case d.com.mapbox.pb.Tile.GeomType.LINESTRING:return l.OmvGeometryType.LINESTRING;case d.com.mapbox.pb.Tile.GeomType.POLYGON:return l.OmvGeometryType.POLYGON;default:return l.OmvGeometryType.UNKNOWN}}function y(e,t){e.forEach((e=>{e.x===t-1&&(e.x=t)}))}t.asGeometryType=_,t.OmvDataAdapter=class{constructor(){this.m_geometryCommands=new u.GeometryCommands,this.m_roundUpCoordinatesIfNeeded=!1}configure(e){var t;const i=e.politicalView;this.m_dataFilter=void 0,this.m_featureModifiers=[new c.OmvPoliticalViewFeatureModifier(null!=i?i:"")],this.m_roundUpCoordinatesIfNeeded=null!==(t=e.roundUpCoordinatesIfNeeded)&&void 0!==t&&t}canProcess(e){return(0,h.isArrayBufferLike)(e)}process(e,t,i){const{tileKey:n}=t,r=new Uint8Array(e),s=d.com.mapbox.pb.Tile.decode(r);this.m_tileKey=n,this.m_processor=i,(0,u.visitOmv)(s,this)}visitLayer(e){this.m_layer=e;const t=this.m_tileKey.level,i=e.name;return!(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLayer(i,t))}visitPointFeature(e){var t;if(void 0===e.geometry)return;const i=this.filterAndModifyFeature(e,"doProcessPointFeature","wantsPointFeature");if(!i)return;const n=this.m_layer.name,r=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,o=[];this.m_geometryCommands.accept(e.geometry,{type:"Point",visitCommand:e=>{(0,u.isMoveToCommand)(e)&&o.push(new s.Vector3(e.position.x,e.position.y,0))}}),0!==o.length&&this.m_processor.processPointFeature(n,r,o,i,v(e,i,p))}visitLineFeature(e){var t;if(void 0===e.geometry)return;const i=this.filterAndModifyFeature(e,"doProcessLineFeature","wantsLineFeature");if(!i)return;const n=this.m_layer.name,r=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,s=[];let o;this.m_geometryCommands.accept(e.geometry,{type:"Line",visitCommand:e=>{(0,u.isMoveToCommand)(e)?(o=[e.position],s.push({positions:o})):(0,u.isLineToCommand)(e)&&o.push(e.position)}}),0!==s.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach((e=>y(e.positions,t)))}(s,r),this.m_processor.processLineFeature(n,r,s,i,v(e,i,p)))}visitPolygonFeature(e){var t;if(void 0===e.geometry)return;const i=this.filterAndModifyFeature(e,"doProcessPolygonFeature","wantsPolygonFeature");if(!i)return;const n=this.m_layer.name,s=null!==(t=this.m_layer.extent)&&void 0!==t?t:4096,o=[];let a,l,c;this.m_geometryCommands.accept(e.geometry,{type:"Polygon",visitCommand:e=>{if((0,u.isMoveToCommand)(e))l=[e.position];else if((0,u.isLineToCommand)(e))l.push(e.position);else if((0,u.isClosePathCommand)(e)&&void 0!==l&&l.length>0){const e=Math.sign(r.ShapeUtils.area(l));void 0===c&&(c=e),e===c&&(a={rings:[]},o.push(a)),l.push(l[0].clone()),null==a||a.rings.push(l)}}}),0!==o.length&&(this.mustRoundUpCoordinates&&function(e,t){e.forEach((e=>e.rings.forEach((e=>y(e,t)))))}(o,s),function(e){const t=e[0];if(void 0!==t&&0!==t.rings.length&&!(r.ShapeUtils.area(t.rings[0])>0))for(const t of e)for(const e of t.rings)e.reverse()}(o),this.m_processor.processPolygonFeature(n,s,o,i,v(e,i,p)))}filterAndModifyFeature(e,t,i){const r=this.m_tileKey.level,s=this.m_layer.name,a=_(e);if(this.m_dataFilter&&!1===this.m_dataFilter[i](s,a,r))return;const l=function(e,t){const i=new u.FeatureAttributes,r={};return i.accept(e,t,{visitAttribute:(e,t)=>(r[e]=function(e){const t=Object.prototype.hasOwnProperty;for(const i of m)if(t.call(e,i)){const t=e[i];if(void 0===t)throw new Error("unpexted undefined value");return n.isLong(t)?t.comp(f)>0||t.comp(g)<0?t.toString():t.toNumber():t}throw new Error("not happening")}(t),!0)}),r}(this.m_layer,e),c=new o.MapEnv(l);return this.m_featureModifiers&&this.m_featureModifiers.find((e=>!e[t](s,c,this.m_tileKey.level)))?void 0:l}get mustRoundUpCoordinates(){return this.m_roundUpCoordinatesIfNeeded&&this.m_tileKey.level<5&&this.m_tileKey.column===this.m_tileKey.columnCount()-1}}},9330:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileDataSource=void 0;const n=i(5185),r=i(2616),s=i(2344),o=i(1984),a=i(4342),l=i(1527);class c extends s.DataSource{constructor(e){var t,i,n,r,s,o;super(e),this.m_options=e,this.m_opacity=1,this.m_renderOrder=0,this.m_transparent=!1,this.dataProvider=this.m_options.dataProvider,this.cacheable=!0,this.m_opacity=null!==(i=null===(t=this.m_options.renderingOptions)||void 0===t?void 0:t.opacity)&&void 0!==i?i:1,this.m_transparent=!0===(null===(n=this.m_options.renderingOptions)||void 0===n?void 0:n.transparent)||this.m_opacity<1,this.m_renderOrder=null!==(s=null===(r=this.m_options.renderingOptions)||void 0===r?void 0:r.renderOrder)&&void 0!==s?s:0,this.m_resolution=(0,a.getOptionValue)(e.resolution,c.resolutionValue.resolution512),this.layerNames=null!==(o=e.layerNames)&&void 0!==o?o:["raster"]}canProvideIconText(){return!1}set opacity(e){var t;this.m_opacity=e,this.m_opacity<1?this.m_transparent=!0:!0!==(null===(t=this.m_options.renderingOptions)||void 0===t?void 0:t.transparent)&&(this.m_transparent=!1)}get opacity(){return this.m_opacity}get resolution(){return this.m_resolution}get renderOrder(){return this.m_renderOrder}get transparent(){return this.m_transparent}get technique(){return this.m_technique}shouldPreloadTiles(){return!0}getTilingScheme(){return r.webMercatorTilingScheme}getTile(e){const t=new s.Tile(this,e);return t.tileLoader=new l.WebTileLoader(this,t,this.dataProvider),t}isFullyCovering(){return!this.m_transparent}async setTheme(e,t){e=await s.ThemeLoader.load(e,{baseUrl:t});const i=(0,o.getStyles)(e.styles).filter((e=>{var t;return!e.layer||(null===(t=this.layerNames)||void 0===t?void 0:t.includes(e.layer))}));if(i.length>0){this.m_styleSetEvaluator=new n.StyleSetEvaluator({styleSet:i,definitions:e.definitions,priorities:e.priorities,labelPriorities:e.labelPriorities});const t=this.m_styleSetEvaluator.getMatchingTechniques(this.mapView.env);if(0===t.length)return;const r=t[t.length-1];(0,o.isRasterTechnique)(r)&&(this.m_technique=r)}}}t.WebTileDataSource=c,function(e){let t,i;!function(e){e[e.ppi72=72]="ppi72",e[e.ppi250=250]="ppi250",e[e.ppi320=320]="ppi320",e[e.ppi500=500]="ppi500"}(t=e.ppiValue||(e.ppiValue={})),function(e){e[e.resolution256=256]="resolution256",e[e.resolution512=512]="resolution512"}(i=e.resolutionValue||(e.resolutionValue={}))}(c=t.WebTileDataSource||(t.WebTileDataSource={}))},1527:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileLoader=void 0;const n=i(6271),r=i(8152),s=i(2344),o=i(8024),a=i(176),l=i(4250);class c extends s.BaseTileLoader{constructor(e,t,i){super(e,t.tileKey),this.dataSource=e,this.tile=t,this.dataProvider=i}loadImpl(e,t,i){this.dataProvider.getTexture(this.tile,e).then((e=>{if(void 0===e||void 0===e[0])return this.tile.forceHasGeometry(!0),void t(s.TileLoaderState.Ready);const[i,c]=e;void 0!==c&&(this.tile.copyrightInfo=c),i.minFilter=n.LinearFilter,i.magFilter=n.LinearFilter,i.generateMipmaps=!1,this.tile.clear();const h=(0,o.addGroundPlane)(this.tile,this.dataSource.renderOrder,16777215,this.dataSource.opacity,!0).material;(0,l.hasColorCorrectionFeature)(h)&&a.MapMaterialAdapter.create(h,{brightness:()=>{var e,t;const i=null!==(t=(0,r.getPropertyValue)(null===(e=this.dataSource.technique)||void 0===e?void 0:e.brightness,this.dataSource.mapView.env))&&void 0!==t?t:l.ColorCorrectionFeature.DEFAULT_BRIGHTNESS;return parseFloat(i).toFixed(3)},gamma:()=>{var e,t;const i=null!==(t=(0,r.getPropertyValue)(null===(e=this.dataSource.technique)||void 0===e?void 0:e.gamma,this.dataSource.mapView.env))&&void 0!==t?t:l.ColorCorrectionFeature.DEFAULT_GAMMA;return parseFloat(i).toFixed(3)}}),i.encoding=n.LinearEncoding,h.map=i,this.dataSource.transparent&&(0,l.enableBlending)(h),h.depthTest=!1,this.tile.invalidateResourceInfo(),this.dataSource.requestUpdate(),t(s.TileLoaderState.Ready)}),i).catch(i)}}t.WebTileLoader=c},9636:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Style=void 0;const n=i(6586);class r extends H.map.render.Style{constructor(e){super(e),this.m_abortController=new AbortController,"string"!=typeof e?this.setConfig(Object.assign({},e)):this.m_url=new URL(e,location.href).href,this.m_baseUrl="string"==typeof this.m_url?this.m_url:location.href,this.setState(H.map.render.Style.State.INIT)}getUrl(){return this.m_url}getBaseUrl(){return this.m_baseUrl}load(){this.loadAsync(!1,!1)}cancelLoad(){this.getState()===H.map.render.Style.State.LOADING&&(this.m_abortController.abort("Style load cancelled"),this.setState(H.map.render.Style.State.INIT))}setFeaturesEnabledByDefault(){const e=this.getConfig();if(void 0!==(null==e?void 0:e.features)){const t=[];for(const i in e.features)e.features[i].enabledByDefault&&t.push({feature:i,mode:e.features[i].modes[0].name});this.m_enabledFeatures=t}else this.m_enabledFeatures=void 0}async loadAsync(e,t){if(!t||this.getState()!==H.map.render.Style.State.READY){if(this.getState()===H.map.render.Style.State.LOADING)return await this.m_loadPromise.then((()=>{})).catch((()=>{}));if(void 0!==this.m_url){const t=H.getStylePath()+"/harp/";this.setState(H.map.render.Style.State.LOADING),this.m_abortController=new AbortController;const i=this.m_abortController.signal;try{this.m_loadPromise=n.load(this.m_url,{baseUrl:t,signal:i});const r=await this.m_loadPromise;this.setConfig(r),this.setState(H.map.render.Style.State.READY),this.setFeaturesEnabledByDefault(),e||this.dispatchChangeEvent()}catch(e){(null==i?void 0:i.aborted)||(this.setState(H.map.render.Style.State.ERROR),this.dispatchError(e))}}else this.setState(H.map.render.Style.State.READY),this.setFeaturesEnabledByDefault(),e||this.dispatchChangeEvent()}}setEnabledFeatures(e){const t=Object.assign({},this.m_enabledFeatures);if(void 0!==e){if(new Set(e.map((e=>e.feature))).size!==e.length)throw new H.lang.InvalidArgumentError(this.setEnabledFeatures,0,"The list of features to enable should not contain duplicates.");this.m_enabledFeatures=e}else this.getState()===H.map.render.Style.State.READY&&this.setFeaturesEnabledByDefault();this.dispatchChangeEvent({enabledFeatures:this.m_enabledFeatures},{enabledFeatures:t})}getEnabledFeatures(){return this.m_enabledFeatures}disposeInternal(){super.disposeInternal(),this.cancelLoad()}dispatchChangeEvent(e,t){this.dispatchEvent(new H.util.ChangeEvent("change",e,t))}}t.Style=r},159:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLoader=void 0,t.ImageLoader=class{constructor(e){this.mapView=e,this.m_textureReferenceCounts=new Map,this.m_tilesWithRefs=new Set}setImageReferences(e,t=[]){this.m_textureReferenceCounts.forEach(((i,n)=>{t.includes(n)||i.delete(e)&&0===i.size&&(this.mapView.imageRepo.imageCache.removeImage(this,n),this.m_textureReferenceCounts.delete(n))})),t.forEach((t=>{const i=this.m_textureReferenceCounts.get(t);void 0!==i?i.add(e):this.m_textureReferenceCounts.set(t,new Set([e]))})),t.length?this.m_tilesWithRefs.add(e):this.m_tilesWithRefs.delete(e)}releaseImageReferences(e){this.m_tilesWithRefs.has(e)&&this.setImageReferences(e)}dispose(){this.m_textureReferenceCounts.forEach(((e,t)=>{this.mapView.imageRepo.imageCache.removeImage(this,t)})),this.m_textureReferenceCounts.clear()}load(e,t){void 0===this.mapView.imageRepo.imageCache.findImage(e)&&this.mapView.imageRepo.imageCache.registerImageByUrl(this,e,t)}}},7564:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayeredGeoJsonDataAdapter=void 0;const n=i(5156);t.LayeredGeoJsonDataAdapter=class{constructor(){this.m_geoJsonDataAdapter=new n.GeoJsonDataAdapter}canProcess(e){return!0}process(e,t,i){"FeatureCollection"===e.data.type&&(e.data={geojson:e.data});const n=e.data;for(const e in n){const r=n[e];this.m_geoJsonDataAdapter.canProcess(r)&&this.m_geoJsonDataAdapter.process(r,t,i,e)}}}},1881:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalObjectDataAdapter=t.DEFAULT_BORDER=t.DEFAULT_EXTENTS=t.MAX_LINE_WIDTH=void 0;const n=i(2616),r=i(4342),s=i(7316),o=i(5448),a=i(6815),l=i(9776),c=i(6441),h=i(5432),u=i(6112),d=r.LoggerManager.instance.create("harp::LocalObjectDataAdapter");t.MAX_LINE_WIDTH=100,t.DEFAULT_EXTENTS=4096,t.DEFAULT_BORDER=t.DEFAULT_EXTENTS*t.MAX_LINE_WIDTH/512,t.LocalObjectDataAdapter=class{canProcess(e){return"object"==typeof e&&"markers"in e&&"spatials"in e&&"overlays"in e}process(e,t,i){this.processMarkers(e.markers,t,i),this.processSpatials(e.spatials,t,i),this.processOverlays(e.overlays,t,i)}processMarkers(e,i,n){e.forEach(((e,r)=>{var o;const a=(0,s.getMarkerProperties)(e);if(null!==a){a.zOrder=null!==(o=e.getZIndex())&&void 0!==o?o:r;const s=e.getGeometry();let l,c=a.id;s instanceof H.geo.Point?l=[g(s,i)]:(c=void 0,l=s.getGeometries().map((e=>g(e,i)))),n.processPointFeature("markers",t.DEFAULT_EXTENTS,l,a,c)}}))}processSpatials(e,i,o){const a="spatials";e.forEach(((e,l)=>{var c;const h={id:e.getId(),minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,zOrder:l,volatile:e.getVolatility()},u=null!==(c=e.getStyle().lineWidth)&&void 0!==c?c:0;Object.assign(h,(0,s.getSpatialProperties)(e));const d=e.getId();if(e instanceof H.map.Polygon){const s=e.getElevation(),l=e.getExtrusion();if(h.min_height=s,h.height=s+l,h.height>0){h.lineWidth=r.MathUtils.clamp(u,0,1);const t=i.targetProjection;if(t.type===n.ProjectionType.Planar&&(h.constantHeight=h.height>2e3,!0===h.constantHeight)){const{lat:i,lng:n}=e.getBoundingBox().getCenter(),r=t.projectPoint({latitude:i,longitude:n}),s=t.getScaleFactor(r);h.min_height*=s,h.height*=s}}const c=function(e,t){if(e instanceof H.geo.MultiPolygon){const i=[],n=e.getGeometries();for(const e of n){const n=x(e,t);i.push(...n)}return i}return x(e,t)}(e.getGeometry(),i);o.processPolygonFeature(a,t.DEFAULT_EXTENTS,c,h,d)}else{const n=function(e,t){if(e instanceof H.geo.MultiLineString){const i=[];for(const n of e.getGeometries())i.push(...y(n,t));return i}return y(e,t)}(e.getGeometry(),i);n.length>0&&o.processLineFeature(a,t.DEFAULT_EXTENTS,n,h,d)}}))}processOverlays(e,i,n){e.forEach(((e,r)=>{const s=e.getGeometry().getBoundingBox(),o={id:e.getId(),minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,zOrder:r,opacity:e.getOpacity(),min_height:0,height:0,volatile:e.getVolatility(),bbox:[s.getLeft(),s.getBottom(),s.getRight(),s.getTop()]},a=e.getBitmap();if(null===a)return;if(a instanceof HTMLImageElement)o.map=a.src;else{const e=a.getContext("2d");if(null===e)return void d.error("Cannot get context from canvas");o.map={buffer:e.getImageData(0,0,a.width,a.height).data.buffer,type:"image/raw",dataTextureProperties:{width:a.width,height:a.height}}}const l=x(H.geo.Polygon.fromRect(e.getGeometry()),i);n.processPolygonFeature("overlays",t.DEFAULT_EXTENTS,l,o,e.getId())}))}};const m=new a.Vector3,p=new n.GeoCoordinates(0,0);function f(e,i,r=new a.Vector3){return(0,c.world2tile)(t.DEFAULT_EXTENTS,i,n.webMercatorProjection.projectPoint(e,m),!1,r)}function g(e,t,i=new a.Vector3){return p.latitude=e.lat,p.longitude=e.lng,p.altitude=e.alt,f(p,t,i)}function v(e,t){const i=e.getLatLngAltArray(),n=[];for(let e=0;e<i.length;e+=3)p.latitude=i[e],p.longitude=i[e+1],p.altitude=i[e+2],n.push(f(p,t,new o.Vector2));return n}function _(e,t,i=!1){return e.map((e=>(p.longitude=e[0],p.latitude=e[1],p.altitude=e[2],f(p,t,new o.Vector2))))}function y(e,i){let n;if((0,h.isCrossingAntimeridian)(e)){const t=[];(0,h.wrapGeoLineString)(e,t),n=t.map((e=>_(e,i)))}else n=[v(e,i)];const r=[];for(const e of n){const i=(0,u.clipLineString)(e,-t.DEFAULT_BORDER,-t.DEFAULT_BORDER,t.DEFAULT_EXTENTS+t.DEFAULT_BORDER,t.DEFAULT_EXTENTS+t.DEFAULT_BORDER);for(const e of i)r.push({positions:H.math.simplifyDP(e,5)})}return r}function x(e,t){if((0,h.isCrossingAntimeridian)(e)){const i=[];return(0,h.wrapGeoPolygon)(e,i),i.map((e=>({rings:e.map((e=>_(e,t)))})))}{const i=e.getExterior(),n=e.getInteriors(),r=[],s=v(i,t);let o=l.ShapeUtils.area(s)>0;o||s.reverse(),r.push(s);for(const e of n){const i=v(e,t);o=l.ShapeUtils.area(i)>0,o&&i.reverse(),r.push(i)}return[{rings:r}]}}},9049:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalObjectDataProvider=void 0;const n=i(2754),r=i(6815),s=i(2730),o=i(1881),a=i(3261),l=new n.Box3,c=1/o.DEFAULT_EXTENTS;function h(e,t){return H.map.Object.compareZInfo(e.getZInfo(),t.getZInfo(),!1)}class u extends a.ObjectDataProvider{constructor(e){super(e),this.provider=e}async getTile(e,t){const i=this.m_tilingScheme.getGeoBox(e),n=(0,s.getClampedGeoRect)(i,e),r=(0,s.getClampedGeoRect)(d(this.m_tilingScheme,this.m_tilingScheme.getWorldBox(e,l),.1),e),o=(0,s.getClampedGeoRect)(d(this.m_tilingScheme,this.m_tilingScheme.getWorldBox(e,l),c),e);return{markers:this.provider.providesMarkers()?this.fetchMarkers(e,o):[],spatials:this.provider.providesSpatials()?this.fetchSpatials(e,r):[],overlays:this.provider.providesOverlays()?this.fetchOverlays(n):[]}}fetchMarkers(e,t){const i=[],n=[],r=this.getMarkerImageLoader(),s=this.provider.requestMarkers(t,void 0,!0,!1);for(const e of s){const t=e.getIcon();if(t.getState()===H.map.Icon.State.READY){const s=`H-icon-${t.uid}`;n.push(s),r.load(s,t.getBitmap()),i.push(e)}}return r.setImageReferences(e,n),i.sort(h),i}fetchSpatials(e,t){const i=this.provider.requestSpatials(t,void 0,!0,!1),n=[],r=this.getSpatialImageLoader();for(const e of i){const t=e.getStyle().lineDashImage;if(void 0!==t){const i=`H-lineDashImage-${e.getId()}`;n.push(i),r.load(i,t)}}return r.setImageReferences(e,n),i.sort(h)}fetchOverlays(e){return this.provider.requestOverlays(e,void 0,!0,!1).sort(h)}}function d(e,t,i){const n=new r.Vector3,s=t.getSize(n).multiplyScalar(i);return s.z=0,t.expandByVector(s),e.projection.unprojectBox(t)}t.LocalObjectDataProvider=u},2497:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalObjectDataSource=void 0;const n=i(2754),r=i(6815),s=i(9049),o=i(1930),a=i(9310),l=i(1881),c=i(1503),h=i(2730),u=i(8124),d=i(4262),m=new n.Box3;class p extends a.ObjectDataSource{constructor(e,t){super(Object.assign(Object.assign({},e),{dataProvider:new s.LocalObjectDataProvider(t),tileFactory:new o.TileFactory(a.ObjectTile),addGroundPlane:!1,gatherFeatureAttributes:!0,decoder:new c.VectorTileDecoder(new l.LocalObjectDataAdapter)}),t),this.provider=t,this.m_invalidateAllTiles=!1,this.m_synced_at=H.map.provider.Invalidations.MARK_INITIAL,this.m_affectedBoundingBox=new n.Box3,this.m_affectedBoundingBoxNextWorld=new n.Box3,this.m_objects=new Map}getMapObjectById(e){return this.m_objects.get(e)}attach(e){super.attach(e),this.provider instanceof H.map.provider.LocalObjectProvider&&this.provider.getRootGroup().getObjects(!0).forEach((e=>{this.m_objects.set(e.getId(),e)}))}detach(e){this.m_objects.forEach(((e,t)=>{e.getVolatility()&&(e instanceof H.map.Overlay?this.mapView.removeDynamicProperty(f(e)):e instanceof H.map.GeoShape&&this.removeStyleDynamicProps(e.getId()))})),super.detach(e)}setStyleDynamicProps(e,t){g.forEach((i=>this.mapView.setDynamicProperty(v(i,t),e[i])))}removeStyleDynamicProps(e){g.forEach((t=>this.mapView.removeDynamicProperty(v(t,e))))}dispose(){this.m_objects.clear(),super.dispose()}invalidateTiles(){const e=this.m_affectedBoundingBox.isEmpty();this.m_invalidateAllTiles||e?this.mapView.markTilesDirty(this):e||this.mapView.markTilesDirty(this,(e=>this.isTileAffected(e))),this.m_affectedBoundingBox.makeEmpty(),this.m_affectedBoundingBoxNextWorld.makeEmpty(),this.m_invalidateAllTiles=!1}isTileAffected(e){return this.getTilingScheme().getWorldBox(e.tileKey,m),m.expandByScalar(this.mapView.pixelToWorld*l.MAX_LINE_WIDTH),m.intersectsBox(this.m_affectedBoundingBox)||!this.m_affectedBoundingBoxNextWorld.isEmpty()&&m.intersectsBox(this.m_affectedBoundingBoxNextWorld)}onProviderUpdate(e){if(this.isDetached())return;if(e.target===this.provider)return this.m_invalidateAllTiles=!0,void this.invalidateTiles();const t=e.target,i=this.m_synced_at,s=e.currentTarget.getInvalidations(t.type);if(this.m_synced_at=s.getMark(),t instanceof H.map.Marker&&t.getIcon().getState()===H.map.Icon.State.READY||t instanceof H.map.GeoShape||t instanceof H.map.Overlay){if(s.isRemove(i)?(this.m_objects.delete(t.getId()),t.getVolatility()&&(t instanceof H.map.Overlay?this.mapView.removeDynamicProperty(f(t)):t instanceof H.map.GeoShape&&this.removeStyleDynamicProps(t.getId()))):this.m_objects.set(t.getId(),t),s.isSpatial(i))return this.m_invalidateAllTiles=!0,void this.invalidateTiles();if(t instanceof H.map.GeoShape&&!t.getVolatility()&&s.isVolatility(i)&&(0,d.default)((()=>this.removeStyleDynamicProps(t.getId())),this.invalidationDebounceTime,this.invalidationMaxTime),t.getVolatility()&&(s.isAdd(i)||s.isVisual(i)||s.isVolatility(i)))if(t instanceof H.map.Overlay){const e=f(t),i=t.getBitmap(),n=this.mapView.env.lookup(e);if(null!==i&&n!==i&&(this.mapView.setDynamicProperty(e,i),void 0!==n))return}else if(t instanceof H.map.GeoShape){const e=t.getStyle(),n=t.getId();if(this.setStyleDynamicProps(e,n),s.isVisual(i))return}if(!this.m_invalidateAllTiles){const e=t instanceof H.map.Marker||t instanceof H.map.Overlay?t.getGeometry().getBoundingBox():t.getBoundingBox(),i=(0,h.hGeoRectToHarpGeoBox)(e);this.getTilingScheme().projection.projectBox(i,m),this.m_affectedBoundingBox=this.m_affectedBoundingBox.union(m);const s=this.projection.unitScale;(this.m_affectedBoundingBox.max.x>s||this.m_affectedBoundingBox.min.x<0)&&(this.m_affectedBoundingBoxNextWorld=new n.Box3(this.m_affectedBoundingBox.min.clone().add(new r.Vector3(-s,0,0)),this.m_affectedBoundingBox.max.clone().add(new r.Vector3(-s,0,0))))}this.invalidateTilesWithDelay()}}}function f(e){return`${u.ObjectStyleBuilder.DYNAMIC_OVERLAY_PROP_PREFIX}${e.getId()}`}t.LocalObjectDataSource=p;const g=["fillColor","strokeColor","lineWidth"];function v(e,t){return`${e}:${t}`}},3261:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectDataProvider=void 0;const n=i(8635);class r extends n.DataProvider{constructor(e){super(),this.provider=e}setTilingScheme(e){this.m_tilingScheme=e}setProjectionSource(e){this.m_projectionSource=e}getProjectionSource(){return this.m_projectionSource}setMarkerImageLoader(e){this.m_markerImageLoader=e}getMarkerImageLoader(){return this.m_markerImageLoader}setSpatialImageLoader(e){this.m_spatiaImageLoader=e}getSpatialImageLoader(){return this.m_spatiaImageLoader}async connect(){}dispose(){var e,t;null===(e=this.m_markerImageLoader)||void 0===e||e.dispose(),null===(t=this.m_spatiaImageLoader)||void 0===t||t.dispose()}ready(){return void 0!==this.m_markerImageLoader&&void 0!==this.m_spatiaImageLoader}}t.ObjectDataProvider=r},9310:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTile=t.ObjectDataSource=void 0;const n=i(159),r=i(1447),s=i(1930),o=i(3436),a=i(4262);class l extends o.VectorTileDataSource{constructor(e,t){super(Object.assign(Object.assign({},e),{tileFactory:new s.TileFactory(c),addGroundPlane:!1,layerNames:[`H-${t.uid}`],gatherFeatureAttributes:!0})),this.provider=t,this.m_tileInvalidationPending=!1,this.invalidationDebounceTime=100,this.invalidationMaxTime=200,this.isDisposed=!1,t.addEventListener("update",this.onProviderUpdate,!1,this),this.debounceTileInvalidation=(0,a.default)((()=>{this.m_tileInvalidationPending=!1,this.isDisposed||this.invalidateTiles()}),this.invalidationDebounceTime,this.invalidationMaxTime)}attach(e){super.attach(e);const t=this.dataProvider();t.setMarkerImageLoader(new n.ImageLoader(e)),t.setSpatialImageLoader(new n.ImageLoader(e)),t.setTilingScheme(this.getTilingScheme()),t.setProjectionSource(this)}dispose(){this.provider.removeEventListener("update",this.onProviderUpdate,!1,this),super.dispose(),this.isDisposed=!0}get tileInvalidationPending(){return this.m_tileInvalidationPending}invalidateTilesWithDelay(){this.m_tileInvalidationPending=!0,this.debounceTileInvalidation()}}t.ObjectDataSource=l;class c extends r.Tile{dispose(){super.dispose(),this.dataSource.dataProvider().getMarkerImageLoader().releaseImageReferences(this.tileKey)}get allGeometryLoaded(){return super.allGeometryLoaded&&!this.dataSource.tileInvalidationPending}}t.ObjectTile=c},8124:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectStyleBuilder=void 0;const n=i(1984);class r{constructor(e){this.layerName=e,this.m_withVolatile=!1,this.m_withMarker=!1,this.m_withLine=!1,this.m_shouldClipLines=!1,this.m_withOverlay=!1,this.m_withPolygon=!1,this.m_withPolygonOutline=!0,this.m_withExtrudedPolygon=!1,this.m_withPolygonAlwaysPickable=!1}withVolatile(){return this.m_withVolatile=!0,this}withMarker(){return this.m_withMarker=!0,this}withLine(e=!1){return this.m_withLine=!0,this.m_shouldClipLines=e,this}withOverlay(){return this.m_withOverlay=!0,this}withPolygon(e=!1,t=!1,i=!1){return this.m_withPolygon=!0,this.m_withPolygonOutline=e,this.m_withExtrudedPolygon=t,this.m_withPolygonAlwaysPickable=i,this}build(){const e=[],t={layer:this.layerName,attr:{minZoomLevel:["case",!0,["get","minZoom"],["zoom"]],maxZoomLevel:["get","maxZoom"]}};if(this.m_withMarker){const i=s(t,{when:["==",["geometry-type"],"Point"],technique:"labeled-icon",attr:{priority:1e3,imageTexture:["get","imageTexture"],iconFadeTime:0,iconReserveSpace:!1,iconMayOverlap:!0,textIsOptional:!0,textReserveSpace:!1,screenWidth:["get","screenWidth"],screenHeight:["get","screenHeight"],iconXOffset:["get","iconXOffset"],iconYOffset:["get","iconYOffset"],renderOrder:["get","zOrder"]}});e.push(i)}if(this.m_withLine){const i=s(t,{when:["all",["==",["geometry-type"],"LineString"],["!has","dashPattern"],["!",["get","volatile"]]],technique:"solid-line",attr:{renderOrder:["get","zOrder"],cap:["get","lineCap"],color:["get","strokeColor"],width:["get","lineWidth"],clipping:this.m_shouldClipLines}}),n=s(i,{when:["all",["==",["geometry-type"],"LineString"],["has","dashes"]],technique:"solid-line",attr:{color:"#0000",dashColor:["get","strokeColor"],clipping:this.m_shouldClipLines,dashes:["get","dashes"],"dash-pattern":["get","dashPattern"],"dash-image":["get","dashImage"]}});if(e.push(i,n),this.m_withVolatile){const t=s(i,{when:["all",["==",["geometry-type"],"LineString"],["!has","dashPattern"],["get","volatile"]],attr:{color:["get",["concat","strokeColor:",["get","id"]],["dynamic-properties"]],width:["concat",["get",["concat","lineWidth:",["get","id"]],["dynamic-properties"]],"px"]}});e.push(t)}}const i=["==",["get","height"],0];if(this.m_withOverlay){const o=s(t,{when:["all",["==",["geometry-type"],"Polygon"],i,["has","map"],["!",["get","volatile"]]],technique:"polygon",attr:{renderOrder:["+",["get","zOrder"]],map:["get","map"],mapProperties:{flipY:!0,minFilter:"linear"},textureCoordinateType:n.TextureCoordinateType.FeatureSpace,color:16777215,opacity:["get","opacity"],transparent:!0}});if(e.push(o),this.m_withVolatile){const t=s(o,{when:["all",["==",["geometry-type"],"Polygon"],i,["has","map"],["get","volatile"]],attr:{map:["get",["concat",r.DYNAMIC_OVERLAY_PROP_PREFIX,["get","id"]],["dynamic-properties"]]}});e.push(t)}}if(this.m_withPolygon){const r=s(t,{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!",["get","volatile"]]],technique:"polygon",attr:{renderOrder:["+",["get","zOrder"]],color:["get","fillColor"],lineWidth:0}});if(this.m_withPolygonAlwaysPickable&&(r.transient=n.Pickability.all),e.push(r),this.m_withPolygonOutline){const r=s(t,{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!has","dashes"],["!",["get","volatile"]]],technique:"solid-line",attr:{renderOrder:["+",["get","zOrder"],.5],color:["get","strokeColor"],width:["get","lineWidth"]}}),o=s(r,{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["has","dashes"]],technique:"solid-line",attr:{clipping:!0,color:"#0000",dashColor:["get","strokeColor"],dashes:["get","dashes"],"dash-pattern":["get","dashPattern"]}});if(this.m_withPolygonAlwaysPickable&&(r.transient=n.Pickability.all,o.transient=n.Pickability.all),e.push(r,o),this.m_withVolatile){const t=s(r,{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["!has","dashes"],["get","volatile"]],attr:{color:["get",["concat","strokeColor:",["get","id"]],["dynamic-properties"]],visible:["get",["concat","strokeColor:",["get","id"]],["dynamic-properties"]],width:["concat",["get",["concat","lineWidth:",["get","id"]],["dynamic-properties"]],"px"]}});e.push(t)}}if(this.m_withExtrudedPolygon){const i=s(t,{when:["all",["==",["geometry-type"],"Polygon"],[">",["get","height"],0]],technique:"extruded-polygon",attr:{renderOrder:["get","zOrder"],color:["get","fillColor"],lineColor:["get","strokeColor"],lineWidth:["get","lineWidth"],constantHeight:["get","constantHeight"]}});this.m_withPolygonAlwaysPickable&&(i.transient=n.Pickability.all),e.push(i)}if(this.m_withVolatile){const t=s(r,{when:["all",["==",["geometry-type"],"Polygon"],i,["!has","map"],["get","volatile"]],attr:{color:["get",["concat","fillColor:",["get","id"]],["dynamic-properties"]],visible:["get",["concat","fillColor:",["get","id"]],["dynamic-properties"]]}});e.push(t)}}return{styles:e}}}function s(e,t){const i=Object.assign(Object.assign({},e),t);return i.attr=Object.assign(Object.assign({},e.attr),t.attr),i}t.ObjectStyleBuilder=r,r.DYNAMIC_OVERLAY_PROP_PREFIX="overlay-image"},6724:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTileDataProvider=void 0;const n=i(3261),r=i(7316);class s extends n.ObjectDataProvider{constructor(e){super(e),this.provider=e,void 0!==H.service&&e instanceof H.service.extension.TileProvider&&e.setTileCanvasRendering(!1)}async getTile(e,t){if(void 0!==t&&t.addEventListener("abort",(()=>{this.provider.cancelTile(e.column,e.row,e.level)})),this.provider.providesMarkers()){const t=this.getMarkerImageLoader();return await new Promise(((i,n)=>{this.provider.requestTileAsPromise(e.column,e.row,e.level).then((n=>{const s=[],o=n.data,a=[];o.forEach((i=>{const n=(0,r.getMarkerProperties)(i);if(null!==n){const r=i.getIcon();if(r.getState()===H.map.Icon.State.READY){const e=n.imageTexture;s.push(e),t.load(e,r.getBitmap())}n.tileKey=e,a.push({type:"Feature",properties:n,geometry:i.getGeometry().toGeoJSON()})}})),t.setImageReferences(e,s),i({type:"FeatureCollection",features:a})}),n)}))}return this.provider.requestTileAsPromise(e.column,e.row,e.level)}}t.ObjectTileDataProvider=s},2464:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectTileDataSource=void 0;const n=i(9310),r=i(6724),s=i(1930),o=i(1447),a=i(1503),l=i(7564),c=i(7665);class h extends n.ObjectDataSource{constructor(e,t){super(u(Object.assign(Object.assign({},e),{addGroundPlane:!1,gatherFeatureAttributes:!0,dataProvider:new r.ObjectTileDataProvider(t)}),t),t),this.provider=t}ready(){return super.ready()&&this.provider.getStyleInternal().getState()===H.map.render.Style.State.READY}invalidateTiles(){this.mapView.markTilesDirty(this,(({tileKey:e})=>{const t=this.provider.requestTile(e.column,e.row,e.level,!0);return void 0!==t&&!t.valid}))}onProviderUpdate(e){var t;if(this.isDetached())return;if(e.target===this.provider)return void this.mapView.markTilesDirty(this);const i=e.target;(i instanceof H.map.Marker&&(null===(t=i.getIcon())||void 0===t?void 0:t.getState())===H.map.Icon.State.READY||i instanceof H.map.Spatial)&&this.invalidateTilesWithDelay()}}t.ObjectTileDataSource=h;const u=(e,t)=>{if(t.providesMarkers())e.tileFactory=new s.TileFactory(n.ObjectTile),e.decoder=new a.VectorTileDecoder;else if(t.providesSpatials())e.tileFactory=new s.TileFactory(o.Tile),e.decoder=new a.VectorTileDecoder(new c.SpatialObjectDataAdapter);else{if(!t.providesGeoJSON())throw Error('At least one of these provider\'s methods should return "true":\n      providesMarkers(), providesSpatials(), providesGeoJSON()');e.tileFactory=new s.TileFactory(n.ObjectTile),e.decoder=new a.VectorTileDecoder(new l.LayeredGeoJsonDataAdapter)}return e}},2420:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isProviderAdapter=void 0,t.isProviderAdapter=function(e){return null!=e&&e.provider instanceof H.map.provider.Provider}},7665:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpatialObjectDataAdapter=void 0;const n=i(5448),r=i(7316);t.SpatialObjectDataAdapter=class{canProcess(e){return!0}process(e,t,i){var n;const l="extensionSpatial",c=e.getObjects(),h=null!==(n=e.getTileSize())&&void 0!==n?n:s;c.forEach((t=>{const n=t.getGeometriesForTile(e);if(void 0!==n&&n.length>0){const e=t.getId();let s;const c=(0,r.getSpatialProperties)(t),u=t.isClosed();if(u?(s=function(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i],r=n.paths,s=r.length,o=n.interiorsIndex,l=n.outlinesIndex;let c,h=Math.min(o,l,s);const u=[];for(let e=0;e<h;e++)c=[r[e].map(a)],u.push({rings:c});if(1===h){h=Math.min(l,s);for(let e=o;e<h;e++)c.push(r[e].map(a))}t.push(u)}return t}(n),c.height=0):s=o(n,!1),s.length>0)if(u){const t=Object.assign(Object.assign({},c),{lineWidth:0});s.forEach((n=>{i.processPolygonFeature(l,h,n,t,e)}))}else i.processLineFeature(l,h,s,c,e);s=o(n,!0),s.length>0&&i.processLineFeature(l,h,s,c,e)}}))}};const s=256;function o(e,t){const i=[];for(let n=0;n<e.length;n++){const r=e[n],s=t?r.outlinesIndex:0,o=t?r.paths.length:Math.min(r.interiorsIndex,r.outlinesIndex,r.paths.length);for(let e=s;e<o;e++)i.push({positions:r.paths[e].map(a)})}return i}function a(e){return new n.Vector2(e.x,e.y)}},3709:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataProvider=void 0;const n=i(8635);class r extends n.DataProvider{constructor(e){super(),this.provider=e}async getTile(e,t){return void 0!==t&&t.addEventListener("abort",(()=>{this.provider.cancelTile(e.column,e.row,e.level)})),await new Promise(((t,i)=>{this.provider.requestTileAsPromise(e.column,e.row,e.level).then((({data:e})=>{e instanceof ArrayBuffer&&t(e.slice(0,e.byteLength))}),i)}))}ready(){return!0}async connect(){return await Promise.resolve()}dispose(){}}t.VectorTileDataProvider=r},9470:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileDataProvider=void 0;const n=i(394),r=[];t.WebTileDataProvider=class{constructor(e){this.provider=e}async getTexture(e,t){return void 0!==t&&t.addEventListener("abort",(()=>{this.provider.cancelTile(e.tileKey.column,e.tileKey.row,e.tileKey.level)})),await new Promise(((t,i)=>{this.provider.requestTileAsPromise(e.tileKey.column,e.tileKey.row,e.tileKey.level).then((({data:e})=>{null===e&&t(void 0);const i=new n.Texture(e);i.needsUpdate=!0,t([i,r])}),i)}))}}},5432:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCrossingAntimeridian=t.wrapGeoLineString=t.wrapGeoPolygon=void 0;const n=i(8965),r=i(3997),s=i(4860);function o(e){const t=[],i=e.getLatLngAltArray();let n=0,r=0;for(let e=0,o=i.length;e<o;e+=3){const o=i[e];let a=i[e+1];const l=i[e+2];if(e>=3){a+=n;const e=Math.abs(a-r)>180?a>r?-360:360:0;r=a+=e,n+=e}else r=a;t.push(new s.GeoCoordinates(o,a,l))}return t}function a(e){const{left:t,middle:i,right:n}=e;return{left:null==t?void 0:t.map(l),middle:null==i?void 0:i.map(l),right:null==n?void 0:n.map(l)}}function l(e){return e.toGeoPoint()}t.wrapGeoPolygon=function(e,t){const i=o(e.getExterior()),r=a((0,n.wrapPolygon)(i)),s=e.getInteriors().map((e=>a((0,n.wrapPolygon)(o(e)))));for(const e in r){if(void 0===r[e])continue;const i=[];s.forEach((t=>{void 0!==t[e]&&i.push(t[e])})),t.push([r[e],...i])}},t.wrapGeoLineString=function(e,t){const{left:i,middle:n,right:s}=(0,r.wrapLineString)(o(e));for(const e of[i,n,s])void 0!==e&&e.forEach((e=>{t.push(e.map((e=>e.toGeoPoint())))}))},t.isCrossingAntimeridian=function(e){return e instanceof H.geo.LineString?e.getDBCs()>0:e.getExterior().getDBCs()>0}},7316:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkerProperties=t.getSpatialProperties=void 0,t.getSpatialProperties=e=>{var t,r,s,o;const a=e.getStyle(),l=a.lineWidth,c={lineWidth:`${a.lineWidth}px`,lineJoin:"Round",strokeColor:n(a.strokeColor)};return e.isClosed()?c.fillColor=n(a.fillColor):c.lineCap=i[a.lineCap],a.lineDash.length>1&&(c.dashPattern=["make-vector",["pixel-world-scale",(null!==(t=a.lineDash[0])&&void 0!==t?t:0)*l],["pixel-world-scale",(null!==(r=a.lineDash[1])&&void 0!==r?r:0)*l],["pixel-world-scale",(null!==(s=a.lineDash[2])&&void 0!==s?s:0)*l],["pixel-world-scale",(null!==(o=a.lineDash[3])&&void 0!==o?o:0)*l]],c.dashes="Square",void 0!==a.lineDashImage&&(c.dashImage=`H-lineDashImage-${e.getId()}`)),c},t.getMarkerProperties=e=>{const t=e.getIcon();let i=null;if(t.getState()===H.map.Icon.State.READY){const{w:n,h:r}=t.getSize(),s=`H-icon-${t.uid}`,o=t.getAnchor();let a=0,l=0;void 0!==o&&(a=o.x,l=o.y),i={id:e.getId(),imageTexture:s,minZoom:e.getMin(!0),maxZoom:e.getMax(!0)+1,screenWidth:n,screenHeight:r,iconXOffset:n/2-a,iconYOffset:-(r/2-l)}}return i};const i={butt:"butt",square:"square",round:"round"},n=e=>{const t="none"===e;return t&&console.warn('Unsupported color value "none" converted to "rgba(0,0,0,0)"'),t?"rgba(0,0,0,0)":e}},8218:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lights=void 0,t.lights=[{name:"ambientLight",color:"#ffffff",intensity:.8,type:"ambient"},{direction:{x:-.3535533524,y:.3535534098,z:.8660254115},name:"light1",color:"#ffffff",intensity:.4,type:"directional"},{direction:{x:-.2548870499,y:-.9512512293,z:.1736481802},name:"light2",color:"#ffffff",intensity:.3,type:"directional"},{direction:{x:.6830126975,y:.1830126865,z:.7071067893},name:"light3",color:"#ffffff",intensity:.25,type:"directional"}]},6667:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultTheme=t.DARK_THEME=t.DEFAULT_THEME=void 0;const n=i(8218),r=i(173),s={color:"#FFFFFF",startRatio:.7};t.DEFAULT_THEME={clearColor:"#FFFFFF",fog:s,sky:{type:"gradient",topColor:"#347BC0",bottomColor:"#EDF2F9",groundColor:"#FFFFFF"},lights:n.lights},t.DARK_THEME={clearColor:"#010608",fog:s,sky:{type:"gradient",topColor:"#010608",bottomColor:"#EDF2F9",groundColor:"#010608"},lights:n.lights},t.getDefaultTheme=(e=!1)=>(0,r.cloneDeep)(e?t.DARK_THEME:t.DEFAULT_THEME)},483:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Layers=void 0;const n=i(2972),r=i(9330),s=i(2497),o=i(9310),a=i(8124),l=i(2464),c=i(3709),h=i(9470),u=i(9636),d=i(5694),m=i(6667),p=i(8449),f=H.getStylePath()+"/harp/";function g(e){let t;return void 0!==H.service&&(e instanceof H.service.trafficVectorTile.Provider?t=["traffic_flow","incident_icons","traffic_incidents"]:e instanceof H.service.omv.Provider&&(t=["tilezen_points","tilezen_lines","tilezen_polygons","tilezen_polygons_outlines","tilezen_volumes","tilezen_building_footprints","tilezen_building_footprints_outlines","tilezen_building_addresses","tilezen_road_shield_labels","tilezen_hillshade","tilezen_contour"])),t}function v(e){return`H-${e.uid}`}t.Layers=class{constructor(e,t,i,n){this.mapView=e,this.dataModel=t,this.lookAtManipulator=i,this.surfaceFactory=n,this.m_dataSources=new Map,this.m_renderers=[],this.m_isSetLayerOngoing=!1,this.m_disposed=!1,this.m_abortController=new AbortController,this.m_themeManager=new _(t,this.m_dataSources),t.addEventListener("add",this.onAdd,!1,this),t.addEventListener("remove",this.onRemove,!1,this),t.addEventListener("set",this.onSet,!1,this),t.addEventListener("configchange",this.onConfigChange,!1,this),t.addEventListener("update",this.onUpdate,!1,this),this.resetDataSourceOrder=this.resetDataSourceOrder.bind(this);const r=[];t.asArray().forEach(((e,t)=>{r.push(this.add(e,t))})),Promise.all(r).then(this.resetDataSourceOrder)}forEachRenderer(e){this.m_renderers.forEach(((t,i)=>e(t,i)))}dispose(){this.m_disposed=!0,this.dataModel.getLength()>0&&this.updateMinMaxListeners(this.dataModel.get(0),!1),this.dataModel.asArray().forEach(((e,t)=>{this.remove(e,t)})),this.m_renderers.forEach((e=>e.dispose())),this.m_dataSources.clear(),this.dataModel.removeEventListener("add",this.onAdd,!1,this),this.dataModel.removeEventListener("remove",this.onRemove,!1,this),this.dataModel.removeEventListener("set",this.onSet,!1,this),this.dataModel.removeEventListener("configchange",this.setTheme,!1,this),this.dataModel.removeEventListener("update",this.onUpdate,!1,this)}resetDataSourceOrder(){this.dataModel.asArray().forEach(((e,t)=>{const i=e.getProvider(),n=this.m_dataSources.get(i);void 0!==n&&(n.dataSourceOrder=t,i.providesOMV()&&(n.addGroundPlane=0===t))})),this.mapView.update()}sortSurfaces(){this.m_renderers.forEach((e=>{const t=e.getLayer();e.getSurface().setZIndex(this.dataModel.indexOf(t))}))}createDataSource(e,t){var i;const o=e.getProvider(),d={name:t,minDisplayLevel:e.min,maxDisplayLevel:e.max,minDataLevel:o.min,maxDataLevel:o.max};let m;if(o instanceof H.map.provider.RemoteTileProvider){const e=o.getStyleInternal();if(!(e instanceof u.Style))throw new H.lang.IllegalOperationError(this.add,`Wrong style format for layer ${t}.`);if(this.m_disposed&&console.warn(new H.lang.IllegalOperationError(this.add,`Cannot add layer ${t}. The rendering engine has been disposed.`)),o.providesOMV()){let e;void 0!==H.service&&o instanceof H.service.omv.Provider&&(e=o.getPoliticalView(),o.addEventListener("politicalviewchange",this.onPoliticalViewChange,void 0,this)),m=new n.VectorTileDataSource(Object.assign(Object.assign({},d),{layerNames:null!==(i=g(o))&&void 0!==i?i:[v(o)],dataProvider:new c.VectorTileDataProvider(o),storageLevelOffset:-1,gatherFeatureAttributes:!0,politicalView:void 0!==e?e.toLowerCase():void 0,languages:void 0!==H.service&&o instanceof H.service.omv.Provider?o.getLanguages():void 0}))}else if(o.providesRasters())m=new r.WebTileDataSource(Object.assign(Object.assign({},d),{layerNames:[v(o)],dataProvider:new h.WebTileDataProvider(o),resolution:r.WebTileDataSource.resolutionValue[r.WebTileDataSource.resolutionValue[o.tileSize]],storageLevelOffset:this.mapView.pixelRatio<2&&o.tileSize>256?-1:0,renderingOptions:{opacity:o.getOpacityInternal(),transparent:!0}}));else if(o.providesSpatials()||o.providesMarkers()||o.providesGeoJSON()){m=new l.ObjectTileDataSource(d,o);let t=e.getConfig();if(void 0===t.styles){const e=new a.ObjectStyleBuilder(m.layerNames[0]);o.providesMarkers()?e.withMarker():o.providesSpatials()&&(e.withLine(!0),e.withPolygon()),t=e.build();const i=new u.Style(t);i.setState(H.map.render.Style.State.READY),o.setStyleInternal(i,!0)}}}else if(o instanceof H.map.provider.ObjectProvider){o.setEngineType(H.Map.EngineType.HARP),m=new s.LocalObjectDataSource(d,o);const e=new a.ObjectStyleBuilder(m.layerNames[0]).withMarker().withLine(!1).withPolygon(!0,!0).withOverlay().withVolatile().build(),t=new u.Style(e);t.setState(H.map.render.Style.State.READY),o.setStyleInternal(t,!0)}return m}async add(e,t){const i=e.getProvider();0===t&&(this.updateMinMaxListeners(e,!0),this.adjustZoomConstraints());const n=`H-${null==i?void 0:i.uid}`;let r=!1;if(function(e){return void 0!==e.requestDomMarkers}(e)){const t=new H.map.render.dom.MarkerRenderer(e);t.setSurface(this.surfaceFactory.createDOMSurface()),this.m_renderers.push(t);const i=this.dataModel.asArray();this.m_renderers.sort(((e,t)=>i.indexOf(e.getLayer())-i.indexOf(t.getLayer()))),r=!0,this.sortSurfaces()}const s=this.createDataSource(e,n);void 0!==s?(this.m_dataSources.set(i,s),this.mapView.addDataSource(s),await this.setTheme()):r||console.warn(new H.lang.IllegalOperationError(this.add,`Layer ${n} is not supported.`))}remove(e,t){for(let t=0;t<this.m_renderers.length;t++)if(this.m_renderers[t].getLayer()===e){this.m_renderers[t].dispose(),this.m_renderers.splice(t,1);break}const i=e.getProvider(),n=this.m_dataSources.get(i);if(void 0!==n){this.mapView.removeDataSource(n),n.dispose(),this.m_dataSources.delete(i);const e=i.getStyleInternal();e instanceof u.Style&&e.cancelLoad(),this.setTheme()}0===t&&this.updateMinMaxListeners(e,!1),0===this.dataModel.getLength()&&this.adjustZoomConstraints(),void 0!==H.service&&i instanceof H.service.omv.Provider&&i.removeEventListener("politicalviewchange",this.onPoliticalViewChange,void 0,this)}get isSetLayerOngoing(){return this.m_isSetLayerOngoing}async onSet(e){if(e.removed instanceof H.map.layer.Layer){this.m_isSetLayerOngoing=!0;try{this.remove(e.removed,e.idx)}catch(e){throw this.m_isSetLayerOngoing=!1,e}}e.added instanceof H.map.layer.Layer&&await this.add(e.added,e.idx),this.m_isSetLayerOngoing=!1,this.resetDataSourceOrder()}onUpdate(e){const t=e.target.getProvider();if(this.m_dataSources.has(t)){const e=this.m_dataSources.get(t);e instanceof o.ObjectDataSource||(this.mapView.markTilesDirty(e),e instanceof r.WebTileDataSource&&t.providesRasters()&&(e.opacity=t.getOpacityInternal())),this.mapView.update()}}onAdd(e){this.add(e.added,e.idx).then(this.resetDataSourceOrder)}onRemove(e){this.remove(e.removed,e.idx),this.resetDataSourceOrder()}onPoliticalViewChange(e){void 0!==H.service&&e.target instanceof H.service.omv.Provider&&this.m_dataSources.get(e.target).setPoliticalView(e.newValue.toLowerCase())}adjustZoomConstraints(){const e=this.dataModel.asArray(),{min:t,max:i}=d.default.lookAt.zoom;e.length>0?this.lookAtManipulator.setZoomConstraints(Math.max(t,e[0].min),Math.min(i,e[0].max)):this.lookAtManipulator.setZoomConstraints(t,i);const n=this.mapView.zoomLevel,r=this.lookAtManipulator.clampZoom(n);r!==n&&(this.mapView.zoomLevel=r)}updateMinMaxListeners(e,t){t?(e.addEventListener("minchange",this.adjustZoomConstraints,!1,this),e.addEventListener("maxchange",this.adjustZoomConstraints,!1,this)):(e.removeEventListener("minchange",this.adjustZoomConstraints,!1,this),e.removeEventListener("maxchange",this.adjustZoomConstraints,!1,this))}onConfigChange(e){var t;if(e.target instanceof H.map.layer.Layer){const i=this.m_dataSources.get(e.target.getProvider());(null===(t=e.newValue)||void 0===t?void 0:t.hasOwnProperty("enabledFeatures"))?i instanceof p.TileDataSource&&(i.enabledFeatures=e.newValue.enabledFeatures):(null==i||i.exprPool.clear(),this.setTheme())}}async setTheme(){this.m_abortController.abort("Abort theme loading due to a data model change."),this.m_abortController=new AbortController;const e=this.m_abortController.signal;try{const t=await this.m_themeManager.merge();e.throwIfAborted(),await this.mapView.setTheme(t,f)}catch(e){}}};class _{constructor(e,t){this.dataModel=e,this.dataSources=t,this.dark=void 0,this.m_uniqueStyles=new Map}async loadLayerTheme(e){var t;const i=e.getProvider(),n=null==i?void 0:i.getStyleInternal(),r=n.getState();if(!(n instanceof u.Style)||r===H.map.render.Style.State.ERROR)return;const s=this.dataSources.get(i);s instanceof p.TileDataSource&&(s.enabledFeatures=n.getEnabledFeatures());const o=null!==(t=n.getUrl())&&void 0!==t?t:JSON.stringify(n.getConfig()),a=this.m_uniqueStyles.get(o);if(void 0===a){this.m_uniqueStyles.set(o,n);const e=void 0===g(i);return await n.loadAsync(!1,!0).then((()=>{if(n.getState()!==H.map.render.Style.State.ERROR)return e?function(e,t){var i;const n=null!==(i=e.getConfig())&&void 0!==i?i:void 0;return void 0!==n&&e.getState()===H.map.render.Style.State.READY&&(Array.isArray(n.styles)&&n.styles.forEach((e=>{e.layer=t})),e.setConfig(n)),n}(n,v(i)):n.getConfig()}))}r===H.map.render.Style.State.INIT&&a.loadAsync(!0,!0).then((()=>{n.setConfig(a.getConfig()),n.setState(a.getState())}))}async merge(){this.m_uniqueStyles.clear();const e=this.dataModel.asArray();if(0===e.length)return this.dark=void 0,{};this.dark=e[0].dark;const t=e.map((async e=>await this.loadLayerTheme(e))),i=(await Promise.all(t)).filter((e=>void 0!==e));return{extends:[(0,m.getDefaultTheme)(this.dark),...i]}}}},9561:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LookAtManipulator=t.adjustHeading=void 0;const n=i(7220),r=i(2616),s=i(2344),o=i(5694),a=i(6815),l=i(3334),c=i(2730),h=i(1555);function u(e){return(180+e)%360}t.adjustHeading=u;class d{constructor(e,t){this.m_mapView=e,this.m_viewPort=t,this.camera=this.m_mapView.camera.clone()}update(){const{width:e,height:t,padding:i}=this.m_viewPort,n=this.m_mapView.camera,r=Math.max(1,e-i.left-i.right),o=Math.max(1,t-i.top-i.bottom);this.camera.copy(n),this.camera.aspect=r/o,s.CameraUtils.setPrincipalPoint(this.camera,{x:0,y:0});const l=(0,h.calculateNormalizedDeviceCoordinates)(i.left,i.top,e,t),c=new a.Vector3(l.x,l.y,-1).applyMatrix4(n.projectionMatrixInverse),u=2*Math.atan2(c.y,n.near);s.CameraUtils.setVerticalFov(this.camera,u,o),this.camera.updateProjectionMatrix()}get projection(){return this.m_mapView.projection}get tileWrappingEnabled(){return this.m_mapView.tileWrappingEnabled}}t.LookAtManipulator=class{constructor(e,t){this.mapView=e,this.m_viewPort=t,this.m_localTangentSpace={position:new a.Vector3,xAxis:new a.Vector3,yAxis:new a.Vector3,zAxis:new a.Vector3},this.m_boundsGenerator=new n.BoundsGenerator(this.mapView),this.m_paddedBoundsGenerator=this.m_boundsGenerator,this.setZoomConstraints(o.default.lookAt.zoom.min,o.default.lookAt.zoom.max),t.addEventListener("update",this.onViewPortUpdate,void 0,this),this.onViewPortUpdate()}getLookAtData(e=!1,t=!1){return(e||void 0===this.m_viewBounds)&&this.updateViewBounds(),{position:this.mapView.target.toLatLng(),zoom:this.mapView.zoomLevel,heading:u(this.mapView.heading),tilt:this.mapView.tilt,bounds:t?this.m_paddedViewBounds:this.m_viewBounds,incline:0}}setZoomConstraints(e,t){this.m_layerMinZoom=e,this.m_layerMaxZoom=t,this.mapView.minZoomLevel=e,this.mapView.maxZoomLevel=t,this.invalidateViewBounds()}clampValues(e){const{heading:t,tilt:i}=o.default.lookAt;if(void 0!==e.zoom&&(e.zoom=this.clampZoom(e.zoom)),void 0!==e.tilt&&(e.tilt=(0,l.clamp)(e.tilt,i.min,i.max)),void 0!==e.heading){const i=(e.heading%360+360)%360;e.heading=(0,l.clamp)(i,t.min,t.max)}}clampZoom(e){const{zoom:t}=o.default.lookAt;return(0,l.clamp)(e,Math.max(t.min,this.m_layerMinZoom),Math.min(t.max,this.m_layerMaxZoom))}lookAt(e){this.mapView.lookAt(Object.assign(Object.assign({},e),{padding:this.m_viewPort.padding})),this.invalidateViewBounds()}applyLookAtDelta(e,t,i,n,r){const a=this.mapView;if(n||r){const e=(0,l.degToRad)(o.default.lookAt.tilt.max);s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaTilt:(0,l.degToRad)(n),maxTiltAngle:e}),s.MapViewUtils.orbitAroundScreenPoint(this.mapView,{deltaAzimuth:(0,l.degToRad)(r),maxTiltAngle:e,center:t})}0!==i&&this.zoomAt(a.zoomLevel+i,t),this.moveLookAtByOffset(e.x,e.y),this.invalidateViewBounds()}moveLookAtByOffset(e,t){if(0===e&&0===t)return;const i=this.mapView.camera,n=this.mapView.projection,o=(0,l.degToRad)(this.mapView.heading),a=this.mapView.pixelToWorld,c=Math.cos(-o),h=Math.sin(-o),u=(e*c+t*h)*a,d=(t*c-e*h)*a;if(n.type===r.ProjectionType.Planar)i.position.x+=u,i.position.y-=d,this.clampCameraPosition();else{const e=s.MapViewUtils.getWorldTargetFromCamera(i,n);if(null===e)return;n.localTangentSpace(e,this.m_localTangentSpace);const t=this.m_localTangentSpace.xAxis,r=this.m_localTangentSpace.yAxis,o=e.clone();t.multiplyScalar(u),o.sub(t),r.multiplyScalar(d),o.add(r),s.MapViewUtils.panCameraAroundGlobe(this.mapView,e,o)}this.invalidateViewBounds()}setAngles(e,t){const i=o.default.lookAt.tilt;e=(0,l.clamp)(e,i.min,i.max);const{target:n,distance:r}=s.MapViewUtils.getTargetAndDistance(this.mapView.projection,this.mapView.camera,this.mapView.elevationProvider),a=this.mapView.projection.unprojectPoint(n);s.MapViewUtils.getCameraRotationAtTarget(this.mapView.projection,a,-t,e,this.mapView.camera.quaternion),s.MapViewUtils.getCameraPositionFromTarget(this.mapView.target,r,-t,e,this.mapView.projection,this.mapView.camera.position),this.invalidateViewBounds()}zoomAt(e,t){const i=this.clampZoom(e);this.mapView.zoomLevel!==i&&(s.MapViewUtils.zoomOnTargetPosition(this.mapView,t.x,t.y,i),this.invalidateViewBounds())}clampCameraPosition(){if(this.mapView.projection.type===r.ProjectionType.Spherical)return;const{target:e}=s.MapViewUtils.getTargetAndDistance(this.mapView.projection,this.mapView.camera,this.mapView.elevationProvider),t=this.mapView.projection.unprojectPoint(e),i=this.mapView.projection.projectPoint(t),n=i.x-e.x,o=i.y-e.y;this.mapView.camera.position.x+=n,this.mapView.camera.position.y+=o,this.invalidateViewBounds()}invalidateViewBounds(){this.m_viewBounds=void 0,this.m_paddedViewBounds=void 0}updateViewBounds(){var e;null===(e=this.m_paddedView)||void 0===e||e.update(),this.m_viewBounds=(0,c.harpToHGeoPolygon)(this.m_boundsGenerator.generate()),this.m_paddedViewBounds=this.m_paddedBoundsGenerator===this.m_boundsGenerator?this.m_viewBounds:(0,c.harpToHGeoPolygon)(this.m_paddedBoundsGenerator.generate())}onViewPortUpdate(){const e=this.m_viewPort.padding;if(e.top||e.left||e.bottom||e.right){const e=this.m_viewPort.center,t=this.mapView.getNormalizedScreenCoordinates(e.x,e.y);s.CameraUtils.setPrincipalPoint(this.mapView.camera,t),this.m_paddedBoundsGenerator===this.m_boundsGenerator&&(this.m_paddedView=new d(this.mapView,this.m_viewPort),this.m_paddedBoundsGenerator=new n.BoundsGenerator(this.m_paddedView))}else this.m_paddedBoundsGenerator!==this.m_boundsGenerator&&(s.CameraUtils.setPrincipalPoint(this.mapView.camera,{x:0,y:0}),this.m_paddedBoundsGenerator=this.m_boundsGenerator,this.m_paddedView=void 0);this.invalidateViewBounds()}}},8935:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderEngine=t.RenderEngineState=void 0;const n=i(6271),r=i(3334),s=i(8806),o=i(9026),a=i(2616),l=i(3977),c=i(2730),h=i(9070),u=i(2505),d=i(483),m=i(6562),p=i(9561),f=i(541),g=i(4954),v=i(248),_=i(1135),y=i(5694),x=i(6667),S=i(5925),b=i(2344),T=i(507),M=i(7362),w=m.LoggerManager.instance.create("harp::RenderEngine");var E;!function(e){e[e.IDLE=0]="IDLE",e[e.BUSY=1]="BUSY"}(E=t.RenderEngineState||(t.RenderEngineState={}));class C extends H.util.EventTarget{constructor(e,t,i,n){super(),this.m_syncedSize=null,this.m_lookAtAnimation=void 0,this.m_animation=void 0,this.m_animationDuration=.3,this.m_lastCallTime=0,this.m_state=E.IDLE,this.m_rendered=!1,this.m_suspendTimeout=5e3,this.m_renderCallbacks=void 0,this.m_kinetics=void 0,this.m_control=new s.ControlUtils,this.type=H.Map.EngineType.HARP,this.m_viewModel=t,this.m_viewPort=e,this.m_dataModel=i,t.startControl=this.startControl.bind(this),t.control=this.control.bind(this),t.endControl=this.endControl.bind(this),e.startInteraction=this.startInteraction.bind(this),e.interaction=this.interaction.bind(this),e.endInteraction=this.endInteraction.bind(this),this.m_surface=new _.default(e.element,e.width,e.height,n.pixelRatio),this.m_collisionsDebugSurface=new _.default(e.element,e.width,e.height,n.pixelRatio),this.m_screenCollisionsDebug=new M.ScreenCollisionsDebug(this.m_collisionsDebugSurface.getElement()),this.m_screenCollisions=new M.ScreenCollisions,this.m_layersContainer=e.element.ownerDocument.createElement("div"),this.m_layersContainer.style.position="absolute",this.m_layersContainer.style.width=this.m_layersContainer.style.height="100%",this.m_layersContainer.style.zIndex="1",e.element.appendChild(this.m_layersContainer);const r=new Blob([H.__harp_worker_decoders__],{type:"application/javascript"}),o=URL.createObjectURL(r);this.mapView=new l.MapView({decoderUrl:o,synchronousRendering:!0,canvas:this.m_surface.getElement(),pixelRatio:n.pixelRatio,enableMixedLod:!0,lodMinTilePixelSize:512,enableNativeWebglAntialias:!0,projection:n.projectionType===a.ProjectionType.Spherical?a.sphereProjection:a.mercatorProjection,theme:(0,x.getDefaultTheme)(!1),enablePickTechnique:!0,maxVisibleDataSourceTiles:200}),this.setCollisionsDebugger(!1),this.m_handleRequestAnimationFrame=this.renderLoop.bind(this),t.addEventListener("update",this.onViewUpdate,void 0,this),e.addEventListener("update",this.onResize,void 0,this),this.m_lookAtManipulator=new p.LookAtManipulator(this.mapView,this.m_viewPort),this.mapView.addEventListener(l.MapViewEventNames.FrameComplete,(()=>{this.m_layers.isSetLayerOngoing||(this.m_rendered=!0)})),this.mapView.addEventListener(l.MapViewEventNames.Update,(()=>{this.m_rendered=!1,this.relaunch()})),this.mapView.addEventListener(l.MapViewEventNames.ContextLost,(()=>{this.setState(E.IDLE),cancelAnimationFrame(this.m_animationFrameHandle)})),this.m_layers=new d.Layers(this.mapView,i,this.m_lookAtManipulator,{createDOMSurface:()=>new H.map.render.dom.Surface(this.m_layersContainer,e.width,e.height,n.pixelRatio)}),this.m_control.addEventListener(s.AnimationUpdateEvent,(e=>{var t;null===(t=this.m_animation)||void 0===t||t.stop(!0),e.changeRate.hasValue()&&(this.m_animation=new h.Animation(this.mapView,1/0,this.applyControl.bind(this)),this.m_animation.start())})),this.m_interaction=new H.map.render.InteractionUtils,this.setSize(!1),this.relaunch();const c=new S.MapViewPickHandlerAdapter(this.mapView.pickHandler,this.geoToScreen.bind(this));this.m_pickingHandler=new v.PickingHandlerComposite((()=>{const e=[];return this.m_layers.forEachRenderer((t=>{t instanceof H.map.render.dom.MarkerRenderer&&e.push({getObjectsAt:(e,i,r)=>t.getObjectsAt(e*n.pixelRatio,i*n.pixelRatio,r)})})),e.push(c),e})),w.log("Ready")}setOnRenderCallbacks(e,t){this.m_renderCallbacks={start:e,end:t}}setCollisionsDebugger(e){e?(this.m_collisionsDebugSurface.getElement().style.display="block",this.mapView.iconTextRenderer.screenCollisions=this.m_screenCollisionsDebug,T.debugContext.setValue("DEBUG_SCREEN_COLLISIONS",!0)):(this.m_collisionsDebugSurface.getElement().style.display="none",this.mapView.iconTextRenderer.screenCollisions=this.m_screenCollisions,T.debugContext.setValue("DEBUG_SCREEN_COLLISIONS",!1)),this.mapView.update()}adjustZoomConstraints(){this.m_layers.adjustZoomConstraints()}onViewUpdate(e){const t=this.lookAtParamsFromLookAtData(e.newValue,e.modifiers);this.stopAnimations();const i=function(e){if(e&&this.m_lookAtManipulator.getLookAtData().zoom%1){const e=0|this.m_lookAtManipulator.getLookAtData().zoom;this.m_lookAtManipulator.lookAt({distance:f.MapViewUtils.calculateDistanceFromZoomLevel(this.mapView,e)})}}.bind(this,e.integerZoom);if(e.animate){let n=1;"number"==typeof e.animate&&(n=1/e.animate),this.setLookAtWithAnimation(t,n,e.integerZoom,i),this.relaunch()}else this.m_lookAtManipulator.lookAt(t),i()}setLookAtWithAnimation(e,t,i,r){const s=u.CameraAnimationBuilder.createFlyToOptions(this.mapView,Object.assign(Object.assign({},e),{padding:this.m_viewPort.padding}),((e,i)=>{const n={heading:e.heading,tilt:e.tilt,zoom:f.MapViewUtils.calculateZoomLevelFromDistance(this.mapView,e.distance)},r={heading:i.heading,tilt:i.tilt,zoom:f.MapViewUtils.calculateZoomLevelFromDistance(this.mapView,i.distance)};return this.getFlyToDuration(n,r)*t}),i).controlPoints;this.m_lookAtAnimation=new o.CameraKeyTrackAnimation(this.mapView,{controlPoints:s,interpolation:n.InterpolateLinear}),this.m_lookAtAnimation.start(0,r)}onResize(){this.setSize(!0),this.relaunch()}setSize(e){let{width:t,height:i}=this.m_viewPort;if(t>0&&i>0){e&&(this.m_syncedSize={w:t,h:i}),this.mapView.pixelRatio<2&&(t+=t%2,i+=i%2),this.m_surface.setSize(t,i),this.m_collisionsDebugSurface.setSize(t,i),this.mapView.resize(t,i);const n=this.lookAtParamsFromLookAtData(this.m_viewModel.getLookAtData());this.m_lookAtManipulator.lookAt(n),this.m_layers.forEachRenderer((e=>{e.getSurface().setSize(t,i)}))}}lookAtParamsFromLookAtData(e,t=-1>>>0){const i={};return this.m_lookAtManipulator.clampValues(e),t&H.map.ChangeEvent.Type.POSITION&&(i.target=e.position),t&H.map.ChangeEvent.Type.ZOOM&&(i.zoomLevel=e.zoom),t&H.map.ChangeEvent.Type.HEADING&&(i.heading=(0,p.adjustHeading)(e.heading)),t&H.map.ChangeEvent.Type.TILT&&(i.tilt=e.tilt),t&H.map.ChangeEvent.Type.BOUNDS&&(t&H.map.ChangeEvent.Type.ZOOM&&t&H.map.ChangeEvent.Type.POSITION||(i.bounds=e.bounds instanceof H.geo.Polygon?(0,c.hToHarpGeoPolygon)(e.bounds):(0,c.getHarpBoundingBox)(e.bounds))),i}synchronizeViewPort(){null!==this.m_syncedSize&&(this.m_viewPort.synchronize(this.m_syncedSize),this.m_syncedSize=null)}synchronizeLookAt(){var e;this.m_viewModel.synchronize(this.m_lookAtManipulator.getLookAtData(null===(e=this.m_lookAtAnimation)||void 0===e?void 0:e.isRunning(),!0))}adjustLongitudeToVisibleWorld(e){const t=this.mapView.target.longitude;if(Math.abs(t-e)<a.MAX_LONGITUDE)return e;const i=Math.sign(t),n=Math.trunc(t/(2*a.MAX_LONGITUDE)+i/2);return e+2*a.MAX_LONGITUDE*n}inViewport(e){return e.x>=0&&e.y>=0&&e.x<=this.m_viewPort.width&&e.y<=this.m_viewPort.height}setProjection(e){this.mapView.projection.type!==e&&(this.mapView.projection=e===a.ProjectionType.Spherical?a.sphereProjection:a.mercatorProjection)}getProjection(){return this.mapView.projection.type}get animationDuration(){return this.m_animationDuration}set animationDuration(e){e===+e&&e>0&&(this.m_animationDuration=e)}resetAnimationDefaults(){this.m_animationDuration=.3}dispose(){cancelAnimationFrame(this.m_animationFrameHandle),this.mapView.dispose(),this.stopAnimations(),this.m_viewModel.removeEventListener("update",this.onViewUpdate,void 0,this),this.m_viewPort.removeEventListener("update",this.onResize,void 0,this),this.m_viewModel.startControl=H.map.ViewModel.prototype.startControl,this.m_viewModel.control=H.map.ViewModel.prototype.control,this.m_viewModel.endControl=H.map.ViewModel.prototype.endControl,this.m_viewPort.startInteraction=H.map.ViewPort.prototype.startInteraction,this.m_viewPort.interaction=H.map.ViewPort.prototype.interaction,this.m_viewPort.endInteraction=H.map.ViewPort.prototype.endInteraction,this.m_layers.dispose(),this.m_viewPort.element.removeChild(this.m_layersContainer)}updateTimeStamp(){this.m_lastCallTime=g.PerformanceTimer.now()}relaunch(){const{width:e,height:t}=this.m_viewPort;e>0&&t>0&&(this.updateTimeStamp(),this.m_state===E.IDLE&&this.startRenderLoop())}get continueRenderLoop(){return this.mapView.isDynamicFrame||g.PerformanceTimer.now()-this.m_lastCallTime<this.m_suspendTimeout&&!this.m_rendered}startRenderLoop(){this.continueRenderLoop?(this.setState(E.BUSY),this.m_animationFrameHandle=requestAnimationFrame(this.m_handleRequestAnimationFrame)):(this.setState(E.IDLE),this.m_animationFrameHandle=void 0,this.m_rendered&&(this.m_rendered=!1,setTimeout((()=>{this.mapView.isDynamicFrame?this.relaunch():this.dispatchRenderEvent()}))))}renderLoop(e){void 0!==this.m_renderCallbacks&&this.m_renderCallbacks.start(),this.mapView.renderSync(e),this.m_suspendTimeout=5e3,this.renderLayers()||(this.m_rendered=!1),this.synchronizeLookAt(),this.synchronizeViewPort(),void 0!==this.m_renderCallbacks&&this.m_renderCallbacks.end(),this.startRenderLoop()}renderLayers(){var e,t;let i=null===(t=this.m_lookAtManipulator.getLookAtData(null===(e=this.m_lookAtAnimation)||void 0===e?void 0:e.isRunning()).bounds)||void 0===t?void 0:t.getBoundingBox();if(void 0===i)return!1;this.mapView.projection.type===a.ProjectionType.Planar&&i.getHeight()>=2*a.MercatorConstants.MAXIMUM_LATITUDE&&(i=new H.geo.Rect(90,i.getLeft(),-90,i.getRight()));const n=this.mapView.zoomLevel;this.m_dataModel.asArray().forEach((e=>{var t;null===(t=e.getProvider())||void 0===t||t.preprocessData(i,n)}));const r=this.m_viewPort.center,s=new H.math.Point(0,0);let o=!0;return this.m_layers.forEachRenderer((e=>{const t=e.render(i,r,void 0,n,!1,s,(e=>this.geoToScreen(e)));t===H.map.render.RenderState.ACTIVE&&(this.m_suspendTimeout=1/0),t===H.map.render.RenderState.PENDING&&(o=!1)})),o}getState(){return this.m_state}setState(e){const t=this.m_state;e^t&&(this.m_state=e,setTimeout((()=>this.dispatchEvent(new H.util.ChangeEvent("statechange",t,e)))))}stopAnimations(){var e,t;null===(e=this.m_lookAtAnimation)||void 0===e||e.stop(),this.m_control.isRunning()&&this.endControl(!0),this.m_interaction.isRunning()&&this.endInteraction(!0),null===(t=this.m_animation)||void 0===t||t.stop(!0)}applyControl(e,t,i,n){const r=this.m_control.getChangeRate(),s=r.moveZ*i,o=r.rotateX*i,a=r.rotateY*i,l={x:r.moveX*i,y:r.moveY*i};this.m_lookAtManipulator.applyLookAtDelta(l,this.getControlTargetNDC(),s,o,a)}dispatchRenderEvent(e){this.dispatchEvent(new H.util.Event("render",null!=e?e:this))}getFlyToDuration(e,t){const i=Math.max(8*this.getCapabilityRatio(e,t,"zoom"),this.getCapabilityRatio(e,t,"heading"),this.getCapabilityRatio(e,t,"tilt")/2);return(0,r.clamp)(3e3*i,300,4e3)/1e3}getCapabilityRatio(e,t,i){const n=this.getCapabilities().lookAt[i],r=n.max-n.min,s="zoom"===i?t[i]-e[i]:((e,t)=>{const i=t-e;return i>-180&&i<=180?i:i>180?i-360:i+360})(e[i],t[i]);return Math.abs(s)/r||0}screenToGeo(e,t){const{latitude:i,longitude:n,altitude:r}=this.mapView.getGeoCoordinatesAt(e,t,!0);return new H.geo.Point(i,n,r)}geoToScreen(e){let t;if(this.getProjection()===a.ProjectionType.Planar){const{lat:i,lng:n,alt:r}=e,s=this.adjustLongitudeToVisibleWorld(n),o=this.mapView.getScreenPosition([s,i,r]);t=o,this.inViewport(o)||(t=this.mapView.getScreenPosition([s+360,i,r]),this.inViewport(t)||(t=this.mapView.getScreenPosition([s-360,i,r])),this.inViewport(t)||(t=o))}else t=this.mapView.getScreenPosition(e);return void 0!==t?{x:Math.round(t.x),y:Math.round(t.y)}:null}screenToLookAtData(e,t){const i=this.m_viewModel.getLookAtData();return i.position=this.screenToGeo(e,t),i}getObjectsAt(e,t,i,n,r=!1){this.m_pickingHandler.getObjectsAt(e,t,i,r).then(n)}async capture(e,t,i,n){return await new Promise(((r,s)=>{const o=()=>{this.mapView.removeEventListener(l.MapViewEventNames.FrameComplete,o);const s=this.m_viewPort.element.ownerDocument.createElement("img");s.onload=()=>{const o=this.m_viewPort.element.ownerDocument.createElement("canvas"),a=this.mapView.pixelRatio,l=o.width=(i-e)*a,c=o.height=(n-t)*a;o.getContext("2d").drawImage(s,e,t,l,c,0,0,l,c),r(o)},s.src=this.mapView.canvas.toDataURL()};this.mapView.addEventListener(l.MapViewEventNames.FrameComplete,o),this.mapView.update()}))}setPointer(e,t){}zoomAt(e,t,i){const n=this.mapView.getNormalizedScreenCoordinates(t,i);this.m_lookAtManipulator.zoomAt(e,n),this.relaunch()}startControl(e,t,i){this.stopAnimations(),this.m_kinetics=e,this.m_control.start(t,i)}control(e,t,i,n,r,s){for(let e,t=0;t<arguments.length;t++)if(e=arguments[t],Number.isNaN(e))throw new Error(`Invalid argument ${e}`);this.m_control.isRunning()&&this.m_control.set(e,t,i,n,r,s)}endControl(e,t){var i,n;if(!this.m_control.isRunning())return;const r=t instanceof Function,s=this.getControlTargetNDC();if(null===(i=this.m_animation)||void 0===i||i.stop(),void 0===this.m_kinetics||e||r){if(r){const e=this.m_lookAtManipulator.getLookAtData();t(e);const i=this.mapView.zoomLevel,n=this.m_lookAtManipulator.clampZoom(e.zoom)-i;n&&(this.m_animation=new h.Animation(this.mapView,Math.abs(n/this.m_control.getChangeRate().moveZ)*Math.PI,(e=>{const t=(r=e,--r*r*r+1);var r;this.m_lookAtManipulator.zoomAt(i+n*t,s)})).start())}}else{const e=null!==(n=this.m_kinetics.power)&&void 0!==n?n:1,t=this.m_control.getChangeRate(),i=this.m_kinetics.duration>0?this.m_kinetics.duration:1,{zoom:r,tilt:o,heading:a}=this.m_lookAtManipulator.getLookAtData();let l=0,c=0;this.m_animation=new h.Animation(this.mapView,i,(n=>{const h=this.m_kinetics.ease(n)*i*e,u=t.moveX*h,d=t.moveY*h,m=t.moveZ*h,f=t.rotateX*h,g=t.rotateY*h;this.m_lookAtManipulator.setAngles(o+f,(0,p.adjustHeading)(a+g)),this.m_lookAtManipulator.zoomAt(r+m,s),this.m_lookAtManipulator.moveLookAtByOffset(u-l,d-c),l=u,c=d})).start()}this.m_control.reset()}startInteraction(e,t){const i=!!(void 0!==t||e&(H.map.render.RenderEngine.InteractionModifiers.HEADING|H.map.render.RenderEngine.InteractionModifiers.TILT));this.stopAnimations(),this.m_kinetics=t,this.m_interaction.start(e,i)}interaction(e,t,i,n,r){if(!this.m_interaction.isRunning())return;const s=this.m_interaction,o=s.store(e,t,i,n,r);if(!this.m_interaction.isGestureDetected())return;let a=!1;const l=this.m_interaction.getMoveVector(),c=o&&s.getBifocalCenter(),h=H.map.render.RenderEngine.InteractionModifiers;let u={x:0,y:0},d=b.CameraUtils.getPrincipalPoint(this.mapView.camera),m=0,p=0,f=0;s.isModifierEnabled(h.TILT)&&(p=l.y/this.m_viewPort.height*2*-180,a=!0),s.isModifierEnabled(h.HEADING)&&(o?(f=this.m_interaction.getBifocalRotation(),d=this.mapView.getNormalizedScreenCoordinates(c.x,c.y),a=!0):l.x&&(f=l.x/this.m_viewPort.width*360,a=!0));const g=this.m_interaction.getBifocalScaling();o&&1!==g&&s.isModifierEnabled(h.ZOOM)&&(m=Math.log(Math.pow(2,this.mapView.zoomLevel)*g)/Math.LN2-this.mapView.zoomLevel,d=this.mapView.getNormalizedScreenCoordinates(c.x,c.y),a=!0),s.isModifierEnabled(h.COORD)&&l.x*l.x+l.y*l.y>0&&(u={x:-l.x,y:-l.y},a=!0),a&&(this.m_lookAtManipulator.applyLookAtDelta(u,d,m,p,f),this.relaunch())}endInteraction(e){var t;if(this.m_interaction.isRunning()&&!e&&void 0!==this.m_kinetics){const e=(null!==(t=this.m_kinetics.power)&&void 0!==t?t:1)*this.m_interaction.getSpeed();if(e>0){const t=this.m_kinetics.duration>0?this.m_kinetics.duration:1,i=this.m_interaction.getDirection(),n=this.m_kinetics.ease;this.m_animation=new h.Animation(this.mapView,t,(t=>{const r=e-e*n(t);this.m_lookAtManipulator.moveLookAtByOffset(-i.x*r,-i.y*r)})).start()}}this.m_kinetics=void 0,this.m_interaction.clear()}getCapabilities(){return y.default}getControlTargetNDC(){var e,t;return void 0!==(null===(e=this.m_control)||void 0===e?void 0:e.atX)&&void 0!==(null===(t=this.m_control)||void 0===t?void 0:t.atY)?this.mapView.getNormalizedScreenCoordinates(this.m_control.atX,this.m_control.atY):b.CameraUtils.getPrincipalPoint(this.mapView.camera)}}t.RenderEngine=C},1135:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,i,n){this.m_canvas=this.createElement(e.ownerDocument),e.appendChild(this.m_canvas),this.m_pixelRatio=n,this.setSize(t,i)}createElement(e){const t=e.createElement("canvas");return t.style.position="absolute",t.style.top=t.style.left="0",t}setSize(e,t){const i=this.m_pixelRatio;this.m_canvas.width=Math.max(e*i,1),this.m_canvas.height=Math.max(t*i,1),this.m_canvas.style.width=`${e}px`,this.m_canvas.style.height=`${t}px`}getElement(){return this.m_canvas}}},5694:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:70},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:H.map.render.RenderEngine.InteractionModifiers.ZOOM,COORD:H.map.render.RenderEngine.InteractionModifiers.COORD},capture:!0};t.default=i},6597:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i,n){const r=i.getIcon(),s=r.getHitArea();if(null===s)return!0;const o=r.getAnchor();e+=o.x,t+=o.y;const a=i.getGeometry();let l=!1;if(a instanceof H.geo.MultiPoint){const i=a.getGeometries();let r=i.length;for(;r--&&!l;){const o=n(i[r]);l=s.hitTest(e-o.x,t-o.y,0)!==H.math.CoverType.NONE}}else{const i=n(a);l=s.hitTest(e-i.x,t-i.y,0)!==H.math.CoverType.NONE}return l}},5925:function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewPickHandlerAdapter=t.getPickData=void 0;const r=i(2497),s=i(6597),o=i(2420),a=i(4342),l=i(8263),c=i(8449);var h=H.map.provider.PickingMode;function u(e,t){var i;const r=e.userData,{$id:s,$layer:o,$zoom:a,$level:l,$geometryType:c,"$localized-name":h,"$secondary-localized-name":u}=r,d=n(r,["$id","$layer","$zoom","$level","$geometryType","$localized-name","$secondary-localized-name"]),m={};m.properties=d;const p=d.kind;m.id=e.featureId>0?e.featureId:d.id,m.layers=[`${t}_${o}:${p}`],m.source_layer=o,m.source_name=t,m.geometry_type=c,m.technique=e.technique;const f=null!==(i=e.tileKey)&&void 0!==i?i:e.userData.tileKey;if(null!=f){const{row:e,column:t,level:i}=f;m.tile={coords:{x:t,y:e,z:i,key:`${t}/${e}/${i}`}}}return m}function d(e,t,i){const n=new H.map.Feature(u(e,t));return n.setParentEventTarget(i),n}t.getPickData=u,t.MapViewPickHandlerAdapter=class{constructor(e,t){this.pickHandler=e,this.geoToScreen=t,this.m_featureCache=new l.LRUCache(100)}async getObjectsAt(e,t,i,n){const l={maxResultCount:i?1:void 0,allowDuplicates:n},m=this.pickHandler.intersectMapObjects(e,t,l),p=[];for(const l of m){if(void 0===l.userData)continue;const m=this.pickHandler.mapView.getDataSourceByName(l.dataSourceName);if(!(m instanceof c.TileDataSource)){(0,a.assert)(!1,"Pick supported only for TileDataSource instances");continue}const f=m.dataProvider();if(!(0,o.isProviderAdapter)(f))continue;const g=f.provider;switch(g.getPickingMode()){case h.SOURCE:{if(!(m instanceof r.LocalObjectDataSource)){(0,a.assert)(!1,"Cannot use 'SOURCE' pick mode for source without 'getMapObjectById'");continue}const i=m.getMapObjectById(l.userData.id);!p.includes(i)&&(i instanceof H.map.GeoShape||i instanceof H.map.Overlay||i instanceof H.map.Marker&&(0,s.default)(e,t,i,this.geoToScreen))&&p.push(i);break}case h.FEATURE:{let e;if(void 0!==l.tileKey){const{column:t,row:i,level:n}=l.tileKey;e={x:t,y:i,z:n}}g.getFeatureProxy(l.userData,e,(function(e){void 0!==e&&(e.setRootParentEventTarget(g),p.push(e))}))||p.push(n?d(l,m.name,g):this.getFeature(l,m.name,g));break}case h.PROVIDER:if(!(g instanceof H.map.provider.RemoteTileProvider)){(0,a.assert)(!1,"'PROVIDER' picking mode support only for RemoteTileProvider");continue}await g.requestObjectAsPromise(u(l,m.name),!1).then((i=>{i instanceof H.map.Marker&&!(0,s.default)(e,t,i,this.geoToScreen)||p.push(i)}))}if(i&&p.length>0)break}return p}getFeature(e,t,i){let n=this.m_featureCache.get(e.userData),r=null==n?void 0:n.find((t=>t.getData().technique===e.technique));return void 0===r&&(r=d(e,t,i),void 0===n&&(n=[]),n.push(r),this.m_featureCache.set(e.userData,n)),r}}},248:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickingHandlerComposite=void 0,t.PickingHandlerComposite=class{constructor(e){this.getPickingHandlers=e}async getObjectsAt(e,t,i,n){let r=[];const s=this.getPickingHandlers();for(const o of s){const s=await o.getObjectsAt(e,t,i,n);if(i&&s.length>0)return[s[0]];r=r.concat(s)}return r}}},2730:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getClampedGeoRect=t.harpToHGeoPolygon=t.harpGeoBoxToHGeoRect=t.hGeoRectToHarpGeoBox=t.getHarpBoundingBox=t.hToHarpGeoPolygon=void 0;const n=i(6482),r=i(4860),s=i(3068),o=i(3334);function a(e){return new s.GeoBox(new r.GeoCoordinates(e.getBottom(),e.getLeft()),new r.GeoCoordinates(e.getTop(),e.getRight()))}function l(e){const t=[];e.push(e[0]);const i=e.length;for(let n=0;n<i-1;n++){const i=e[n],s=e[n+1];if(t.push(i),Math.abs(s.longitude-i.longitude)>=180){const e=(i.latitude+s.latitude)/2,n=(i.longitude+s.longitude)/2,o=(i.altitude+s.altitude)/2;t.push(new r.GeoCoordinates(e,n,o||void 0))}}return t.length!==e.length-1?l(t):t}t.hToHarpGeoPolygon=function(e){const t=[];if(e.getExterior().eachLatLngAlt(((e,i,n)=>{t.push(new r.GeoCoordinates(e,i,n))})),t.length>2)return new n.GeoPolygon(t,!0)},t.getHarpBoundingBox=function(e){return a(e.getBoundingBox())},t.hGeoRectToHarpGeoBox=a,t.harpGeoBoxToHGeoRect=function(e){return H.geo.Rect.fromPoints({lat:e.north,lng:e.west},{lat:e.south,lng:e.east})},t.harpToHGeoPolygon=function(e){if(void 0===e)return;const t=[];return l(e.coordinates).map((e=>{t.push(e.latitude,e.longitude,e.altitude)})),new H.geo.Polygon(new H.geo.LineString(t))},t.getClampedGeoRect=function(e,t){const i=function(e){const t=Math.pow(2,e.level)-1;return{row:e.row===t,column:e.column===t}}(t);return new H.geo.Rect(0===t.row?90:(0,o.clamp)(e.north,-90,90),(0,o.clamp)(e.west,-180,180),i.row?-90:(0,o.clamp)(e.south,-90,90),i.column?180:(0,o.clamp)(e.east,-180,180))}},9070:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Animation=void 0;const n=i(3977),r=i(4954);t.Animation=class{constructor(e,t,i){this.mapView=e,this.duration=t,this.updateCallback=i,this.running=!1,this.m_lastFrameTime=0,this.m_startTime=0,this.m_animateCb=e=>{this.animate(e.time<this.m_startTime?r.PerformanceTimer.now():e.time)}}start(e,t){if(!this.running)return this.running=!0,this.onFinished=t,this.mapView.addEventListener(n.MapViewEventNames.Render,this.m_animateCb),this.mapView.beginAnimation(),this.m_startTime=null!=e?e:r.PerformanceTimer.now(),this.m_lastFrameTime=this.m_startTime,this}stop(e=!1){this.running&&(this.running=!1,this.mapView.endAnimation(),this.mapView.removeEventListener(n.MapViewEventNames.Render,this.m_animateCb),void 0===this.onFinished||e||this.onFinished())}animate(e){const t=e-this.m_startTime,i=e-this.m_lastFrameTime;let n=t/this.duration;(0===this.duration||n>1)&&(n=1),this.m_lastFrameTime=e,this.update(n,t,i,e),n>=1&&this.stop()}update(e,t,i,n){void 0!==this.updateCallback&&this.updateCallback(e,t,i,n)}}},8806:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeRate=t.ControlUtils=t.AnimationUpdateEvent=void 0,t.AnimationUpdateEvent="animation-update";class i extends H.util.EventTarget{constructor(){super(),this.atX=void 0,this.atY=void 0,this.m_isRunning=!1,this.reset()}start(e,t){this.m_isRunning&&this.reset(),e===+e&&t===+t&&(this.atX=e,this.atY=t),this.m_isRunning=!0}reset(){this.m_isRunning=!1,this.atX=this.atY=void 0,this.m_changeRate=new r(0,0,0,0,0,0)}set(e,t,i,s,o,a){if(e/=1e3,t/=1e3,i/=1e3,s/=1e3,o/=1e3,a/=1e3,this.isRunning()){const l=new r(e,t,i,s,o,a);this.m_changeRate.equals(l)||(this.m_changeRate=l,this.dispatchEvent(new n(this.getChangeRate())))}}isRunning(){return this.m_isRunning}getChangeRate(){return this.m_changeRate}}t.ControlUtils=i;class n extends H.util.Event{constructor(e){super(t.AnimationUpdateEvent),this.changeRate=e,this.changeRate=e}}class r{constructor(e,t,i,n,r,s){this.moveX=e,this.moveY=t,this.moveZ=i,this.rotateX=n,this.rotateY=r,this.rotateZ=s,this.moveX=e,this.moveY=t,this.moveZ=i,this.rotateX=n,this.rotateY=r,this.rotateZ=s}equals(e){return this.moveX===e.moveX&&this.moveY===e.moveY&&this.moveZ===e.moveZ&&this.rotateX===e.rotateX&&this.rotateY===e.rotateY&&this.rotateZ===e.rotateZ}hasValue(){return 0!==this.moveX||0!==this.moveY||0!==this.moveZ||0!==this.rotateX||0!==this.rotateY||0!==this.rotateZ}}t.ChangeRate=r},4262:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i=0){let n,r;return function(){const s=this,o=arguments;function a(){r=0,e.apply(s,o)}clearTimeout(n),r>0&&i&&Date.now()-r>=i?a():(void 0===r&&(r=Date.now()),n=setTimeout((()=>a()),t))}}},3827:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AnimationClip:()=>m});var n=i(8887),r=i(9302),s=i(6271);class o extends r.t{}o.prototype.ValueTypeName="bool",o.prototype.ValueBufferType=Array,o.prototype.DefaultInterpolation=s.InterpolateDiscrete,o.prototype.InterpolantFactoryMethodLinear=void 0,o.prototype.InterpolantFactoryMethodSmooth=void 0;class a extends r.t{}a.prototype.ValueTypeName="color";var l=i(1993),c=i(2997);class h extends r.t{}h.prototype.ValueTypeName="string",h.prototype.ValueBufferType=Array,h.prototype.DefaultInterpolation=s.InterpolateDiscrete,h.prototype.InterpolantFactoryMethodLinear=void 0,h.prototype.InterpolantFactoryMethodSmooth=void 0;var u=i(5760),d=i(3334);class m{constructor(e,t=-1,i,n=s.NormalAnimationBlendMode){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=d.generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,r=i.length;e!==r;++e)t.push(p(i[e]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(r.t.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let e=0;e<s;e++){let a=[],c=[];a.push((e+s-1)%s,e,(e+1)%s),c.push(0,1,0);const h=n.lK(a);a=n.qx(a,1,h),c=n.qx(c,1,h),r||0!==a[0]||(a.push(s),c.push(c[0])),o.push(new l.NumberKeyframeTrack(".morphTargetInfluences["+t[e].name+"]",a,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.name.match(r);if(s&&s.length>1){const e=s[1];let t=n[e];t||(n[e]=t=[]),t.push(i)}}const s=[];for(const e in n)s.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,r,s){if(0!==i.length){const o=[],a=[];n.hN(i,o,a,r),0!==o.length&&s.push(new e(t,o,a))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let h=e.length||-1;const d=e.hierarchy||[];for(let e=0;e<d.length;e++){const n=d[e].keys;if(n&&0!==n.length)if(n[0].morphTargets){const e={};let t;for(t=0;t<n.length;t++)if(n[t].morphTargets)for(let i=0;i<n[t].morphTargets.length;i++)e[n[t].morphTargets[i]]=-1;for(const i in e){const e=[],s=[];for(let r=0;r!==n[t].morphTargets.length;++r){const r=n[t];e.push(r.time),s.push(r.morphTarget===i?1:0)}r.push(new l.NumberKeyframeTrack(".morphTargetInfluence["+i+"]",e,s))}h=e.length*o}else{const s=".bones["+t[e].name+"]";i(u.VectorKeyframeTrack,s+".position",n,"pos",r),i(c.QuaternionKeyframeTrack,s+".quaternion",n,"rot",r),i(u.VectorKeyframeTrack,s+".scale",n,"scl",r)}}return 0===r.length?null:new this(s,h,r,a)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function p(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return l.NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return u.VectorKeyframeTrack;case"color":return a;case"quaternion":return c.QuaternionKeyframeTrack;case"bool":case"boolean":return o;case"string":return h}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];n.hN(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}},4839:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AnimationMixer:()=>_});var n=i(6271);class r{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:n.ZeroCurvatureEnding,endingEnd:n.ZeroCurvatureEnding};for(let e=0;e!==o;++e){const t=s[e].createInterpolant(null);a[e]=t,t.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=n.LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,n=e._clip.duration,r=n/i,s=i/n;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled)return void this._updateWeight(e);const s=this._startTime;if(null!==s){const n=(e-s)*i;n<0||0===i?t=0:(this._startTime=null,t=i*n)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case n.AdditiveAnimationBlendMode:for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(o),t[i].accumulateAdditive(a);break;case n.NormalAnimationBlendMode:default:for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(o),t[i].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const o=i===n.LoopPingPong;if(0===e)return-1===s||!o||1&~s?r:t-r;if(i===n.LoopOnce){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const i=Math.floor(r/t);r-=t*i,s+=Math.abs(i);const n=this.repetitions-s;if(n<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===n){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=r;if(o&&!(1&~s))return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=n.ZeroSlopeEnding,r.endingEnd=n.ZeroSlopeEnding):(r.endingStart=e?this.zeroSlopeAtStart?n.ZeroSlopeEnding:n.ZeroCurvatureEnding:n.WrapAroundEnding,r.endingEnd=t?this.zeroSlopeAtEnd?n.ZeroSlopeEnding:n.ZeroCurvatureEnding:n.WrapAroundEnding)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=t,o[1]=r+e,a[1]=i,this}}var s=i(2356),o=i(9698);const a="\\[\\]\\.:\\/",l=new RegExp("["+a+"]","g"),c="[^"+a+"]",h="[^"+a.replace("\\.","")+"]",u=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",c)+/(WCOD+)?/.source.replace("WCOD",h)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",c)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",c)+"$"),d=["material","materials","bones","map"];class m{constructor(e,t,i){this.path=t,this.parsedPath=i||m.parseTrackName(t),this.node=m.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new m.Composite(e,t,i):new m(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(l,"")}static parseTrackName(e){const t=u.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==d.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const r=e[n];if(r.name===t||r.uuid===t)return r;const s=i(r.children);if(s)return s}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=m.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const s=e[n];if(void 0===s){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}m.Composite=class{constructor(e,t,i){const n=i||m.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},m.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},m.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},m.prototype.GetterByBindingType=[m.prototype._getValue_direct,m.prototype._getValue_array,m.prototype._getValue_arrayElement,m.prototype._getValue_toArray],m.prototype.SetterByBindingTypeAndVersioning=[[m.prototype._setValue_direct,m.prototype._setValue_direct_setNeedsUpdate,m.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[m.prototype._setValue_array,m.prototype._setValue_array_setNeedsUpdate,m.prototype._setValue_array_setMatrixWorldNeedsUpdate],[m.prototype._setValue_arrayElement,m.prototype._setValue_arrayElement_setNeedsUpdate,m.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[m.prototype._setValue_fromArray,m.prototype._setValue_fromArray_setNeedsUpdate,m.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var p=i(9747);class f{constructor(e,t,i){let n,r,s;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==n;++e)i[r+e]=i[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(i[e]!==i[e+t]){o.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let e=i,r=n;e!==r;++e)t[e]=t[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)e[t+n]=e[i+n]}_slerp(e,t,i,n){p.Quaternion.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){const s=this._workIndex*r;p.Quaternion.multiplyQuaternionsFlat(e,s,e,t,e,i),p.Quaternion.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,i,n,r){const s=1-n;for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]*s+e[i+o]*n}}_lerpAdditive(e,t,i,n,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[i+s]*n}}}var g=i(3827);const v=new Float32Array(1);class _ extends s.EventDispatcher{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,o=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==r;++e){const r=n[e],l=r.name;let h=c[l];if(void 0!==h)++h.referenceCount,s[e]=h;else{if(h=s[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const n=t&&t._propertyBindings[e].binding.parsedPath;h=new f(m.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),s[e]=h}o[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[t];void 0===s&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new o.l(new Float32Array(2),new Float32Array(2),1,v),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const s=t||this._root,o=s.uuid;let a="string"==typeof e?g.AnimationClip.findByName(s,e):e;const l=null!==a?a.uuid:e,c=this._actionsByClip[l];let h=null;if(void 0===i&&(i=null!==a?a.blendMode:n.NormalAnimationBlendMode),void 0!==c){const e=c.actionByRoot[o];if(void 0!==e&&e.blendMode===i)return e;h=c.knownActions[0],null===a&&(a=h._clip)}if(null===a)return null;const u=new r(this,a,t,i);return this._bindAction(u,h),this._addInactiveAction(u,l,o),u}existingAction(e,t){const i=t||this._root,n=i.uuid,r="string"==typeof e?g.AnimationClip.findByName(i,e):e,s=r?r.uuid:e,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let o=0;o!==i;++o)t[o]._update(n,e,r,s);const o=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)o[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const r=n._cacheIndex,s=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const n=i[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const e in n){const t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}},8887:(e,t,i)=>{"use strict";function n(e,t,i){return s(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)}function r(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function s(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function o(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i}function a(e,t,i){const n=e.length,r=new e.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*t;for(let i=0;i!==t;++i)r[o++]=e[n+i]}return r}function l(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(t.push(s.time),i.push.apply(i,o)),s=e[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(t.push(s.time),o.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(t.push(s.time),i.push(o)),s=e[r++]}while(void 0!==s)}i.d(t,{fU:()=>s,hN:()=>l,j5:()=>r,lK:()=>o,qx:()=>a,zS:()=>n}),i(9747),i(6271)},9302:(e,t,i)=>{"use strict";i.d(t,{t:()=>c});var n=i(6271),r=i(4116);class s extends r._{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:n.ZeroCurvatureEnding,endingEnd:n.ZeroCurvatureEnding}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case n.ZeroSlopeEnding:s=e,a=2*t-i;break;case n.WrapAroundEnding:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(void 0===l)switch(this.getSettings_().endingEnd){case n.ZeroSlopeEnding:o=e,l=2*i-t;break;case n.WrapAroundEnding:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const c=.5*(i-t),h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=s*h,this._offsetNext=o*h}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,m=(i-t)/(n-t),p=m*m,f=p*m,g=-u*f+2*u*p-u*m,v=(1+u)*f+(-1.5-2*u)*p+(-.5+u)*m+1,_=(-1-d)*f+(1.5+d)*p+.5*m,y=d*f-d*p;for(let e=0;e!==o;++e)r[e]=g*s[c+e]+v*s[l+e]+_*s[a+e]+y*s[h+e];return r}}var o=i(9698);class a extends r._{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}var l=i(8887);class c{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=l.j5(t,this.TimeBufferType),this.values=l.j5(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:l.j5(e.times,Array),values:l.j5(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new a(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new o.l(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new s(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case n.InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case n.InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case n.InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return n.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return n.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return n.InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=l.zS(i,r,s),this.values=l.zS(this.values,r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,s),e=!1;break}s=n}if(void 0!==n&&l.fU(n))for(let t=0,i=n.length;t!==i;++t){const i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){const e=l.zS(this.times),t=l.zS(this.values),i=this.getValueSize(),r=this.getInterpolation()===n.InterpolateSmooth,s=e.length-1;let o=1;for(let n=1;n<s;++n){let s=!1;const a=e[n];if(a!==e[n+1]&&(1!==n||a!==e[0]))if(r)s=!0;else{const e=n*i,r=e-i,o=e+i;for(let n=0;n!==i;++n){const i=t[e+n];if(i!==t[r+n]||i!==t[o+n]){s=!0;break}}}if(s){if(n!==o){e[o]=e[n];const r=n*i,s=o*i;for(let e=0;e!==i;++e)t[s+e]=t[r+e]}++o}}if(s>0){e[o]=e[s];for(let e=s*i,n=o*i,r=0;r!==i;++r)t[n+r]=t[e+r];++o}return o!==e.length?(this.times=l.zS(e,0,o),this.values=l.zS(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=l.zS(this.times,0),t=l.zS(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}c.prototype.TimeBufferType=Float32Array,c.prototype.ValueBufferType=Float32Array,c.prototype.DefaultInterpolation=n.InterpolateLinear},1993:(e,t,i)=>{"use strict";i.r(t),i.d(t,{NumberKeyframeTrack:()=>r});var n=i(9302);class r extends n.t{}r.prototype.ValueTypeName="number"},2997:(e,t,i)=>{"use strict";i.r(t),i.d(t,{QuaternionKeyframeTrack:()=>l});var n=i(6271),r=i(9302),s=i(4116),o=i(9747);class a extends s._{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=(i-t)/(n-t);let c=e*a;for(let e=c+a;c!==e;c+=4)o.Quaternion.slerpFlat(r,0,s,c-a,s,c,l);return r}}class l extends r.t{InterpolantFactoryMethodLinear(e){return new a(this.times,this.values,this.getValueSize(),e)}}l.prototype.ValueTypeName="quaternion",l.prototype.DefaultInterpolation=n.InterpolateLinear,l.prototype.InterpolantFactoryMethodSmooth=void 0},5760:(e,t,i)=>{"use strict";i.r(t),i.d(t,{VectorKeyframeTrack:()=>r});var n=i(9302);class r extends n.t{}r.prototype.ValueTypeName="vector"},5086:(e,t,i)=>{"use strict";i.d(t,{V:()=>s});var n=i(8333),r=i(2481);class s extends r.Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new n.Matrix4,this.projectionMatrix=new n.Matrix4,this.projectionMatrixInverse=new n.Matrix4}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}},9896:(e,t,i)=>{"use strict";i.r(t),i.d(t,{OrthographicCamera:()=>r});var n=i(5086);class r extends n.V{constructor(e=-1,t=1,i=1,n=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,s=i+e,o=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}},2479:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PerspectiveCamera:()=>s});var n=i(5086),r=i(3334);class s extends n.V{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*r.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*r.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*r.RAD2DEG*Math.atan(Math.tan(.5*r.DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*r.DEG2RAD*this.fov)/this.zoom,i=2*t,n=this.aspect*i,s=-.5*n;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,r=o.fullHeight;s+=o.offsetX*n/e,t-=o.offsetY*i/r,n*=o.width/e,i*=o.height/r}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}},6271:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ACESFilmicToneMapping:()=>te,AddEquation:()=>M,AddOperation:()=>Z,AdditiveAnimationBlendMode:()=>Rt,AdditiveBlending:()=>x,AlphaFormat:()=>Ie,AlwaysDepth:()=>z,AlwaysStencilFunc:()=>si,BackSide:()=>f,BasicDepthPacking:()=>Ut,BasicShadowMap:()=>h,ByteType:()=>Te,CineonToneMapping:()=>ee,ClampToEdgeWrapping:()=>he,CubeReflectionMapping:()=>re,CubeRefractionMapping:()=>se,CubeUVReflectionMapping:()=>le,CullFaceBack:()=>a,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>o,CustomBlending:()=>T,CustomToneMapping:()=>ie,DecrementStencilOp:()=>Kt,DecrementWrapStencilOp:()=>Zt,DepthFormat:()=>Ve,DepthStencilFormat:()=>Ne,DisplayP3ColorSpace:()=>jt,DoubleSide:()=>g,DstAlphaFactor:()=>F,DstColorFactor:()=>V,DynamicCopyUsage:()=>mi,DynamicDrawUsage:()=>ai,DynamicReadUsage:()=>hi,EqualDepth:()=>H,EqualStencilFunc:()=>ei,EquirectangularReflectionMapping:()=>oe,EquirectangularRefractionMapping:()=>ae,FloatType:()=>Ae,FrontSide:()=>p,GLSL1:()=>fi,GLSL3:()=>gi,GreaterDepth:()=>q,GreaterEqualDepth:()=>W,GreaterEqualStencilFunc:()=>ri,GreaterStencilFunc:()=>ii,HalfFloatType:()=>Pe,IncrementStencilOp:()=>Xt,IncrementWrapStencilOp:()=>Yt,IntType:()=>Ee,InterpolateDiscrete:()=>Tt,InterpolateLinear:()=>Mt,InterpolateSmooth:()=>wt,InvertStencilOp:()=>$t,KeepStencilOp:()=>Wt,LessDepth:()=>G,LessEqualDepth:()=>j,LessEqualStencilFunc:()=>ti,LessStencilFunc:()=>Qt,LinearEncoding:()=>Ot,LinearFilter:()=>ve,LinearMipMapLinearFilter:()=>Se,LinearMipMapNearestFilter:()=>ye,LinearMipmapLinearFilter:()=>xe,LinearMipmapNearestFilter:()=>_e,LinearSRGBColorSpace:()=>Gt,LinearToneMapping:()=>J,LoopOnce:()=>xt,LoopPingPong:()=>bt,LoopRepeat:()=>St,LuminanceAlphaFormat:()=>Ue,LuminanceFormat:()=>Fe,MOUSE:()=>r,MaxEquation:()=>A,MinEquation:()=>C,MirroredRepeatWrapping:()=>ue,MixOperation:()=>Y,MultiplyBlending:()=>b,MultiplyOperation:()=>K,NearestFilter:()=>de,NearestMipMapLinearFilter:()=>ge,NearestMipMapNearestFilter:()=>pe,NearestMipmapLinearFilter:()=>fe,NearestMipmapNearestFilter:()=>me,NeverDepth:()=>k,NeverStencilFunc:()=>Jt,NoBlending:()=>_,NoColorSpace:()=>kt,NoToneMapping:()=>$,NormalAnimationBlendMode:()=>Pt,NormalBlending:()=>y,NotEqualDepth:()=>X,NotEqualStencilFunc:()=>ni,ObjectSpaceNormalMap:()=>Bt,OneFactor:()=>R,OneMinusDstAlphaFactor:()=>U,OneMinusDstColorFactor:()=>N,OneMinusSrcAlphaFactor:()=>O,OneMinusSrcColorFactor:()=>D,PCFShadowMap:()=>u,PCFSoftShadowMap:()=>d,RED_GREEN_RGTC2_Format:()=>_t,RED_RGTC1_Format:()=>gt,REVISION:()=>n,RGBADepthPacking:()=>Vt,RGBAFormat:()=>Oe,RGBAIntegerFormat:()=>je,RGBA_ASTC_10x10_Format:()=>dt,RGBA_ASTC_10x5_Format:()=>ct,RGBA_ASTC_10x6_Format:()=>ht,RGBA_ASTC_10x8_Format:()=>ut,RGBA_ASTC_12x10_Format:()=>mt,RGBA_ASTC_12x12_Format:()=>pt,RGBA_ASTC_4x4_Format:()=>tt,RGBA_ASTC_5x4_Format:()=>it,RGBA_ASTC_5x5_Format:()=>nt,RGBA_ASTC_6x5_Format:()=>rt,RGBA_ASTC_6x6_Format:()=>st,RGBA_ASTC_8x5_Format:()=>ot,RGBA_ASTC_8x6_Format:()=>at,RGBA_ASTC_8x8_Format:()=>lt,RGBA_BPTC_Format:()=>ft,RGBA_ETC2_EAC_Format:()=>et,RGBA_PVRTC_2BPPV1_Format:()=>$e,RGBA_PVRTC_4BPPV1_Format:()=>Ze,RGBA_S3TC_DXT1_Format:()=>We,RGBA_S3TC_DXT3_Format:()=>qe,RGBA_S3TC_DXT5_Format:()=>Xe,RGB_ETC1_Format:()=>Je,RGB_ETC2_Format:()=>Qe,RGB_PVRTC_2BPPV1_Format:()=>Ye,RGB_PVRTC_4BPPV1_Format:()=>Ke,RGB_S3TC_DXT1_Format:()=>He,RGFormat:()=>ze,RGIntegerFormat:()=>Ge,RedFormat:()=>Be,RedIntegerFormat:()=>ke,ReinhardToneMapping:()=>Q,RepeatWrapping:()=>ce,ReplaceStencilOp:()=>qt,ReverseSubtractEquation:()=>E,SIGNED_RED_GREEN_RGTC2_Format:()=>yt,SIGNED_RED_RGTC1_Format:()=>vt,SRGBColorSpace:()=>zt,ShortType:()=>Me,SrcAlphaFactor:()=>I,SrcAlphaSaturateFactor:()=>B,SrcColorFactor:()=>L,StaticCopyUsage:()=>di,StaticDrawUsage:()=>oi,StaticReadUsage:()=>ci,StreamCopyUsage:()=>pi,StreamDrawUsage:()=>li,StreamReadUsage:()=>ui,SubtractEquation:()=>w,SubtractiveBlending:()=>S,TOUCH:()=>s,TangentSpaceNormalMap:()=>Nt,TriangleFanDrawMode:()=>It,TriangleStripDrawMode:()=>Dt,TrianglesDrawMode:()=>Lt,TwoPassDoubleSide:()=>v,UVMapping:()=>ne,UnsignedByteType:()=>be,UnsignedInt248Type:()=>De,UnsignedIntType:()=>Ce,UnsignedShort4444Type:()=>Re,UnsignedShort5551Type:()=>Le,UnsignedShortType:()=>we,VSMShadowMap:()=>m,WrapAroundEnding:()=>At,ZeroCurvatureEnding:()=>Et,ZeroFactor:()=>P,ZeroSlopeEnding:()=>Ct,ZeroStencilOp:()=>Ht,_SRGBAFormat:()=>vi,sRGBEncoding:()=>Ft});const n="152",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,h=0,u=1,d=2,m=3,p=0,f=1,g=2,v=2,_=0,y=1,x=2,S=3,b=4,T=5,M=100,w=101,E=102,C=103,A=104,P=200,R=201,L=202,D=203,I=204,O=205,F=206,U=207,V=208,N=209,B=210,k=0,z=1,G=2,j=3,H=4,W=5,q=6,X=7,K=0,Y=1,Z=2,$=0,J=1,Q=2,ee=3,te=4,ie=5,ne=300,re=301,se=302,oe=303,ae=304,le=306,ce=1e3,he=1001,ue=1002,de=1003,me=1004,pe=1004,fe=1005,ge=1005,ve=1006,_e=1007,ye=1007,xe=1008,Se=1008,be=1009,Te=1010,Me=1011,we=1012,Ee=1013,Ce=1014,Ae=1015,Pe=1016,Re=1017,Le=1018,De=1020,Ie=1021,Oe=1023,Fe=1024,Ue=1025,Ve=1026,Ne=1027,Be=1028,ke=1029,ze=1030,Ge=1031,je=1033,He=33776,We=33777,qe=33778,Xe=33779,Ke=35840,Ye=35841,Ze=35842,$e=35843,Je=36196,Qe=37492,et=37496,tt=37808,it=37809,nt=37810,rt=37811,st=37812,ot=37813,at=37814,lt=37815,ct=37816,ht=37817,ut=37818,dt=37819,mt=37820,pt=37821,ft=36492,gt=36283,vt=36284,_t=36285,yt=36286,xt=2200,St=2201,bt=2202,Tt=2300,Mt=2301,wt=2302,Et=2400,Ct=2401,At=2402,Pt=2500,Rt=2501,Lt=0,Dt=1,It=2,Ot=3e3,Ft=3001,Ut=3200,Vt=3201,Nt=0,Bt=1,kt="",zt="srgb",Gt="srgb-linear",jt="display-p3",Ht=0,Wt=7680,qt=7681,Xt=7682,Kt=7683,Yt=34055,Zt=34056,$t=5386,Jt=512,Qt=513,ei=514,ti=515,ii=516,ni=517,ri=518,si=519,oi=35044,ai=35048,li=35040,ci=35045,hi=35049,ui=35041,di=35046,mi=35050,pi=35042,fi="100",gi="300 es",vi=1035},9365:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BufferAttribute:()=>m,Float16BufferAttribute:()=>S,Float32BufferAttribute:()=>b,Float64BufferAttribute:()=>T,Int16BufferAttribute:()=>v,Int32BufferAttribute:()=>y,Int8BufferAttribute:()=>p,Uint16BufferAttribute:()=>_,Uint32BufferAttribute:()=>x,Uint8BufferAttribute:()=>f,Uint8ClampedBufferAttribute:()=>g});var n=i(6815),r=i(5448),s=i(3334),o=i(6271);const a=l();function l(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(n[e]=0,n[256|e]=32768,r[e]=24,r[256|e]=24):t<-14?(n[e]=1024>>-t-14,n[256|e]=1024>>-t-14|32768,r[e]=-t-1,r[256|e]=-t-1):t<=15?(n[e]=t+15<<10,n[256|e]=t+15<<10|32768,r[e]=13,r[256|e]=13):t<128?(n[e]=31744,n[256|e]=64512,r[e]=24,r[256|e]=24):(n[e]=31744,n[256|e]=64512,r[e]=13,r[256|e]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,i=0;for(;!(8388608&t);)t<<=1,i-=8388608;t&=-8388609,i+=947912704,s[e]=t|i}for(let e=1024;e<2048;++e)s[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)o[e]=e<<23;o[31]=1199570944,o[32]=2147483648;for(let e=33;e<63;++e)o[e]=2147483648+(e-32<<23);o[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(a[e]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function c(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=(0,s.clamp)(e,-65504,65504),a.floatView[0]=e;const t=a.uint32View[0],i=t>>23&511;return a.baseTable[i]+((8388607&t)>>a.shiftTable[i])}function h(e){const t=e>>10;return a.uint32View[0]=a.mantissaTable[a.offsetTable[t]+(1023&e)]+a.exponentTable[t],a.floatView[0]}const u=new n.Vector3,d=new r.Vector2;class m{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=o.StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)d.fromBufferAttribute(this,t),d.applyMatrix3(e),this.setXY(t,d.x,d.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)u.fromBufferAttribute(this,t),u.applyMatrix3(e),this.setXYZ(t,u.x,u.y,u.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)u.fromBufferAttribute(this,t),u.applyMatrix4(e),this.setXYZ(t,u.x,u.y,u.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)u.fromBufferAttribute(this,t),u.applyNormalMatrix(e),this.setXYZ(t,u.x,u.y,u.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)u.fromBufferAttribute(this,t),u.transformDirection(e),this.setXYZ(t,u.x,u.y,u.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setX(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setY(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setZ(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setW(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array),r=(0,s.normalize)(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==o.StaticDrawUsage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class p extends m{constructor(e,t,i){super(new Int8Array(e),t,i)}}class f extends m{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class g extends m{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class v extends m{constructor(e,t,i){super(new Int16Array(e),t,i)}}class _ extends m{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class y extends m{constructor(e,t,i){super(new Int32Array(e),t,i)}}class x extends m{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class S extends m{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=h(this.array[e*this.itemSize]);return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setX(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.array[e*this.itemSize]=c(t),this}getY(e){let t=h(this.array[e*this.itemSize+1]);return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setY(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.array[e*this.itemSize+1]=c(t),this}getZ(e){let t=h(this.array[e*this.itemSize+2]);return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setZ(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.array[e*this.itemSize+2]=c(t),this}getW(e){let t=h(this.array[e*this.itemSize+3]);return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setW(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.array[e*this.itemSize+3]=c(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array)),this.array[e+0]=c(t),this.array[e+1]=c(i),this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array)),this.array[e+0]=c(t),this.array[e+1]=c(i),this.array[e+2]=c(n),this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array),r=(0,s.normalize)(r,this.array)),this.array[e+0]=c(t),this.array[e+1]=c(i),this.array[e+2]=c(n),this.array[e+3]=c(r),this}}class b extends m{constructor(e,t,i){super(new Float32Array(e),t,i)}}class T extends m{constructor(e,t,i){super(new Float64Array(e),t,i)}}},3148:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BufferGeometry:()=>S});var n=i(6815),r=i(5448),s=i(2754),o=i(2356),a=i(9365),l=i(5381),c=i(2481),h=i(8333),u=i(8955),d=i(3334),m=i(1968);let p=0;const f=new h.Matrix4,g=new c.Object3D,v=new n.Vector3,_=new s.Box3,y=new s.Box3,x=new n.Vector3;class S extends o.EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:p++}),this.uuid=d.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new((0,m.H7)(e)?a.Uint32BufferAttribute:a.Uint16BufferAttribute)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new u.Matrix3).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return f.makeRotationFromQuaternion(e),this.applyMatrix4(f),this}rotateX(e){return f.makeRotationX(e),this.applyMatrix4(f),this}rotateY(e){return f.makeRotationY(e),this.applyMatrix4(f),this}rotateZ(e){return f.makeRotationZ(e),this.applyMatrix4(f),this}translate(e,t,i){return f.makeTranslation(e,t,i),this.applyMatrix4(f),this}scale(e,t,i){return f.makeScale(e,t,i),this.applyMatrix4(f),this}lookAt(e){return g.lookAt(e),g.updateMatrix(),this.applyMatrix4(g.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(v).negate(),this.translate(v.x,v.y,v.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new a.Float32BufferAttribute(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new s.Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new n.Vector3(-1/0,-1/0,-1/0),new n.Vector3(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];_.setFromBufferAttribute(i),this.morphTargetsRelative?(x.addVectors(this.boundingBox.min,_.min),this.boundingBox.expandByPoint(x),x.addVectors(this.boundingBox.max,_.max),this.boundingBox.expandByPoint(x)):(this.boundingBox.expandByPoint(_.min),this.boundingBox.expandByPoint(_.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new l.Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new n.Vector3,1/0);if(e){const i=this.boundingSphere.center;if(_.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];y.setFromBufferAttribute(i),this.morphTargetsRelative?(x.addVectors(_.min,y.min),_.expandByPoint(x),x.addVectors(_.max,y.max),_.expandByPoint(x)):(_.expandByPoint(y.min),_.expandByPoint(y.max))}_.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)x.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(x));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],o=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)x.fromBufferAttribute(s,t),o&&(v.fromBufferAttribute(e,t),x.add(v)),n=Math.max(n,i.distanceToSquared(x))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,s=t.position.array,o=t.normal.array,l=t.uv.array,c=s.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new a.BufferAttribute(new Float32Array(4*c),4));const h=this.getAttribute("tangent").array,u=[],d=[];for(let e=0;e<c;e++)u[e]=new n.Vector3,d[e]=new n.Vector3;const m=new n.Vector3,p=new n.Vector3,f=new n.Vector3,g=new r.Vector2,v=new r.Vector2,_=new r.Vector2,y=new n.Vector3,x=new n.Vector3;function S(e,t,i){m.fromArray(s,3*e),p.fromArray(s,3*t),f.fromArray(s,3*i),g.fromArray(l,2*e),v.fromArray(l,2*t),_.fromArray(l,2*i),p.sub(m),f.sub(m),v.sub(g),_.sub(g);const n=1/(v.x*_.y-_.x*v.y);isFinite(n)&&(y.copy(p).multiplyScalar(_.y).addScaledVector(f,-v.y).multiplyScalar(n),x.copy(f).multiplyScalar(v.x).addScaledVector(p,-_.x).multiplyScalar(n),u[e].add(y),u[t].add(y),u[i].add(y),d[e].add(x),d[t].add(x),d[i].add(x))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let e=0,t=b.length;e<t;++e){const t=b[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)S(i[e+0],i[e+1],i[e+2])}const T=new n.Vector3,M=new n.Vector3,w=new n.Vector3,E=new n.Vector3;function C(e){w.fromArray(o,3*e),E.copy(w);const t=u[e];T.copy(t),T.sub(w.multiplyScalar(w.dot(t))).normalize(),M.crossVectors(E,t);const i=M.dot(d[e])<0?-1:1;h[4*e]=T.x,h[4*e+1]=T.y,h[4*e+2]=T.z,h[4*e+3]=i}for(let e=0,t=b.length;e<t;++e){const t=b[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)C(i[e+0]),C(i[e+1]),C(i[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new a.BufferAttribute(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const r=new n.Vector3,s=new n.Vector3,o=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h=new n.Vector3,u=new n.Vector3,d=new n.Vector3;if(e)for(let n=0,a=e.count;n<a;n+=3){const a=e.getX(n+0),m=e.getX(n+1),p=e.getX(n+2);r.fromBufferAttribute(t,a),s.fromBufferAttribute(t,m),o.fromBufferAttribute(t,p),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),l.fromBufferAttribute(i,a),c.fromBufferAttribute(i,m),h.fromBufferAttribute(i,p),l.add(u),c.add(u),h.add(u),i.setXYZ(a,l.x,l.y,l.z),i.setXYZ(m,c.x,c.y,c.z),i.setXYZ(p,h.x,h.y,h.z)}else for(let e=0,n=t.count;e<n;e+=3)r.fromBufferAttribute(t,e+0),s.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(e+0,u.x,u.y,u.z),i.setXYZ(e+1,u.x,u.y,u.z),i.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)x.fromBufferAttribute(e,t),x.normalize(),e.setXYZ(t,x.x,x.y,x.z)}toNonIndexed(){function e(e,t){const i=e.array,n=e.itemSize,r=e.normalized,s=new i.constructor(t.length*n);let o=0,l=0;for(let r=0,a=t.length;r<a;r++){o=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*n;for(let e=0;e<n;e++)s[l++]=i[o++]}return new a.BufferAttribute(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new S,i=this.index.array,n=this.attributes;for(const r in n){const s=e(n[r],i);t.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],o=r[n];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],i);s.push(n)}t.morphAttributes[n]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,i=s.length;e<i;e++){const i=s[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const n=i[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let r=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],s=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];s.push(n.toJSON(e.data))}s.length>0&&(n[t]=s,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const e in n){const i=n[e];this.setAttribute(e,i.clone(t))}const r=e.morphAttributes;for(const e in r){const i=[],n=r[e];for(let e=0,r=n.length;e<r;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}},2356:(e,t,i)=>{"use strict";i.r(t),i.d(t,{EventDispatcher:()=>n});class n{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}},9044:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InterleavedBuffer:()=>s});var n=i(3334),r=i(6271);class s{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=r.StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=n.generateUUID()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=n.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=n.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}},6280:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InterleavedBufferAttribute:()=>a});var n=i(6815),r=i(9365),s=i(3334);const o=new n.Vector3;class a{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)o.fromBufferAttribute(this,t),o.applyMatrix4(e),this.setXYZ(t,o.x,o.y,o.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)o.fromBufferAttribute(this,t),o.applyNormalMatrix(e),this.setXYZ(t,o.x,o.y,o.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)o.fromBufferAttribute(this,t),o.transformDirection(e),this.setXYZ(t,o.x,o.y,o.z);return this}setX(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=(0,s.normalize)(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=(0,s.denormalize)(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=(0,s.normalize)(t,this.array),i=(0,s.normalize)(i,this.array),n=(0,s.normalize)(n,this.array),r=(0,s.normalize)(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new r.BufferAttribute(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new a(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}},1389:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});class n{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}},2481:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Object3D:()=>E});var n=i(9747),r=i(6815),s=i(8333),o=i(2356),a=i(3334);const l=new s.Matrix4,c=new n.Quaternion;class h{constructor(e=0,t=0,i=0,n=h.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],s=n[4],o=n[8],l=n[1],c=n[5],h=n[9],u=n[2],d=n[6],m=n[10];switch(t){case"XYZ":this._y=Math.asin((0,a.clamp)(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,m),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-(0,a.clamp)(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin((0,a.clamp)(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,m),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-(0,a.clamp)(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,m),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin((0,a.clamp)(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,m));break;case"XZY":this._z=Math.asin(-(0,a.clamp)(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-h,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return l.makeRotationFromQuaternion(e),this.setFromRotationMatrix(l,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return c.setFromEuler(this),this.setFromQuaternion(c,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}h.DEFAULT_ORDER="XYZ";var u=i(1389),d=i(8955);let m=0;const p=new r.Vector3,f=new n.Quaternion,g=new s.Matrix4,v=new r.Vector3,_=new r.Vector3,y=new r.Vector3,x=new n.Quaternion,S=new r.Vector3(1,0,0),b=new r.Vector3(0,1,0),T=new r.Vector3(0,0,1),M={type:"added"},w={type:"removed"};class E extends o.EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:m++}),this.uuid=a.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=E.DEFAULT_UP.clone();const e=new r.Vector3,t=new h,i=new n.Quaternion,o=new r.Vector3(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new s.Matrix4},normalMatrix:{value:new d.Matrix3}}),this.matrix=new s.Matrix4,this.matrixWorld=new s.Matrix4,this.matrixAutoUpdate=E.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=E.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new u.S,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return f.setFromAxisAngle(e,t),this.quaternion.multiply(f),this}rotateOnWorldAxis(e,t){return f.setFromAxisAngle(e,t),this.quaternion.premultiply(f),this}rotateX(e){return this.rotateOnAxis(S,e)}rotateY(e){return this.rotateOnAxis(b,e)}rotateZ(e){return this.rotateOnAxis(T,e)}translateOnAxis(e,t){return p.copy(e).applyQuaternion(this.quaternion),this.position.add(p.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(S,e)}translateY(e){return this.translateOnAxis(b,e)}translateZ(e){return this.translateOnAxis(T,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(g.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?v.copy(e):v.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?g.lookAt(_,v,this.up):g.lookAt(v,_,this.up),this.quaternion.setFromRotationMatrix(g),n&&(g.extractRotation(n.matrixWorld),f.setFromRotationMatrix(g),this.quaternion.premultiply(f.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(M)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(w)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(w)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),g.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),g.multiply(e.parent.matrixWorld)),e.applyMatrix4(g),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectsByProperty(e,t);r.length>0&&(i=i.concat(r))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_,e,y),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_,x,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++){const n=t[i];!0!==n.matrixWorldAutoUpdate&&!0!==e||n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++){const i=e[t];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){const t=s(e.geometries),n=s(e.materials),r=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),c=s(e.animations),h=s(e.nodes);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function s(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}E.DEFAULT_UP=new r.Vector3(0,1,0),E.DEFAULT_MATRIX_AUTO_UPDATE=!0,E.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0},3216:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Raycaster:()=>s});var n=i(2309),r=i(1389);class s{constructor(e,t,i=0,s=1/0){this.ray=new n.Ray(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new r.S,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return a(e,this,i,t),i.sort(o),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)a(e[n],this,i,t);return i.sort(o),i}}function o(e,t){return e.distance-t.distance}function a(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){const n=e.children;for(let e=0,r=n.length;e<r;e++)a(n[e],t,i,!0)}}},4125:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Uniform:()=>n});class n{constructor(e){this.value=e}clone(){return new n(void 0===this.value.clone?this.value:this.value.clone())}}},6782:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Earcut:()=>n});const n={triangulate:function(e,t,i=2){const n=t&&t.length,s=n?t[0]*i:e.length;let a=r(e,0,s,i,!0);const l=[];if(!a||a.next===a.prev)return l;let c,h,m,p,g,v,_;if(n&&(a=function(e,t,i,n){const s=[];let o,a,l,c,h;for(o=0,a=t.length;o<a;o++)l=t[o]*n,c=o<a-1?t[o+1]*n:e.length,h=r(e,l,c,n,!1),h===h.next&&(h.steiner=!0),s.push(f(h));for(s.sort(u),o=0;o<s.length;o++)i=d(s[o],i);return i}(e,t,a,i)),e.length>80*i){c=m=e[0],h=p=e[1];for(let t=i;t<s;t+=i)g=e[t],v=e[t+1],g<c&&(c=g),v<h&&(h=v),g>m&&(m=g),v>p&&(p=v);_=Math.max(m-c,p-h),_=0!==_?32767/_:0}return o(a,l,i,c,h,_,0),l}};function r(e,t,i,n,r){let s,o;if(r===function(e,t,i,n){let r=0;for(let s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}(e,t,i,n)>0)for(s=t;s<i;s+=n)o=w(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=w(s,e[s],e[s+1],o);return o&&y(o,o.next)&&(E(o),o=o.next),o}function s(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!y(n,n.next)&&0!==_(n.prev,n,n.next))n=n.next;else{if(E(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function o(e,t,i,n,r,u,d){if(!e)return;!d&&u&&function(e,t,i,n){let r=e;do{0===r.z&&(r.z=p(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(e,n,r,u);let m,f,g=e;for(;e.prev!==e.next;)if(m=e.prev,f=e.next,u?l(e,n,r,u):a(e))t.push(m.i/i|0),t.push(e.i/i|0),t.push(f.i/i|0),E(e),e=f.next,g=f.next;else if((e=f)===g){d?1===d?o(e=c(s(e),t,i),t,i,n,r,u,2):2===d&&h(e,t,i,n,r,u):o(s(e),t,i,n,r,u,1);break}}function a(e){const t=e.prev,i=e,n=e.next;if(_(t,i,n)>=0)return!1;const r=t.x,s=i.x,o=n.x,a=t.y,l=i.y,c=n.y,h=r<s?r<o?r:o:s<o?s:o,u=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,m=a>l?a>c?a:c:l>c?l:c;let p=n.next;for(;p!==t;){if(p.x>=h&&p.x<=d&&p.y>=u&&p.y<=m&&g(r,a,s,l,o,c,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function l(e,t,i,n){const r=e.prev,s=e,o=e.next;if(_(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,h=r.y,u=s.y,d=o.y,m=a<l?a<c?a:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,v=a>l?a>c?a:c:l>c?l:c,y=h>u?h>d?h:d:u>d?u:d,x=p(m,f,t,i,n),S=p(v,y,t,i,n);let b=e.prevZ,T=e.nextZ;for(;b&&b.z>=x&&T&&T.z<=S;){if(b.x>=m&&b.x<=v&&b.y>=f&&b.y<=y&&b!==r&&b!==o&&g(a,h,l,u,c,d,b.x,b.y)&&_(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,T.x>=m&&T.x<=v&&T.y>=f&&T.y<=y&&T!==r&&T!==o&&g(a,h,l,u,c,d,T.x,T.y)&&_(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;b&&b.z>=x;){if(b.x>=m&&b.x<=v&&b.y>=f&&b.y<=y&&b!==r&&b!==o&&g(a,h,l,u,c,d,b.x,b.y)&&_(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;T&&T.z<=S;){if(T.x>=m&&T.x<=v&&T.y>=f&&T.y<=y&&T!==r&&T!==o&&g(a,h,l,u,c,d,T.x,T.y)&&_(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function c(e,t,i){let n=e;do{const r=n.prev,s=n.next.next;!y(r,s)&&x(r,n,n.next,s)&&T(r,s)&&T(s,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(s.i/i|0),E(n),E(n.next),n=e=s),n=n.next}while(n!==e);return s(n)}function h(e,t,i,n,r,a){let l=e;do{let e=l.next.next;for(;e!==l.prev;){if(l.i!==e.i&&v(l,e)){let c=M(l,e);return l=s(l,l.next),c=s(c,c.next),o(l,t,i,n,r,a,0),void o(c,t,i,n,r,a,0)}e=e.next}l=l.next}while(l!==e)}function u(e,t){return e.x-t.x}function d(e,t){const i=function(e,t){let i,n=t,r=-1/0;const s=e.x,o=e.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=s&&e>r&&(r=e,i=n.x<n.next.x?n:n.next,e===s))return i}n=n.next}while(n!==t);if(!i)return null;const a=i,l=i.x,c=i.y;let h,u=1/0;n=i;do{s>=n.x&&n.x>=l&&s!==n.x&&g(o<c?s:r,o,l,c,o<c?r:s,o,n.x,n.y)&&(h=Math.abs(o-n.y)/(s-n.x),T(n,e)&&(h<u||h===u&&(n.x>i.x||n.x===i.x&&m(i,n)))&&(i=n,u=h)),n=n.next}while(n!==a);return i}(e,t);if(!i)return t;const n=M(i,e);return s(n,n.next),s(i,i.next)}function m(e,t){return _(e.prev,e,t.prev)<0&&_(t.next,e,e.next)<0}function p(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function g(e,t,i,n,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(n-a)>=(i-o)*(t-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&x(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(T(e,t)&&T(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(_(e.prev,e,t.prev)||_(e,t.prev,t))||y(e,t)&&_(e.prev,e,e.next)>0&&_(t.prev,t,t.next)>0)}function _(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,i,n){const r=b(_(e,t,i)),s=b(_(e,t,n)),o=b(_(i,n,e)),a=b(_(i,n,t));return r!==s&&o!==a||!(0!==r||!S(e,i,t))||!(0!==s||!S(e,n,t))||!(0!==o||!S(i,e,n))||!(0!==a||!S(i,t,n))}function S(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function b(e){return e>0?1:e<0?-1:0}function T(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function M(e,t){const i=new C(e.i,e.x,e.y),n=new C(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function w(e,t,i,n){const r=new C(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}},7300:(e,t,i)=>{"use strict";i.d(t,{P:()=>o});var n=i(1968),r=i(9677);let s;class o{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===s&&(s=(0,n.c)("canvas")),s.width=e.width,s.height=e.height;const i=s.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=s}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=(0,n.c)("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),o=s.data;for(let e=0;e<o.length;e++)o[e]=255*(0,r.SRGBToLinear)(o[e]/255);return i.putImageData(s,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*(0,r.SRGBToLinear)(t[e]/255)):t[e]=(0,r.SRGBToLinear)(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}},9776:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ShapeUtils:()=>r});var n=i(6782);class r{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return r.area(e)<0}static triangulateShape(e,t){const i=[],r=[],a=[];s(e),o(i,e);let l=e.length;t.forEach(s);for(let e=0;e<t.length;e++)r.push(l),l+=t[e].length,o(i,t[e]);const c=n.Earcut.triangulate(i,r);for(let e=0;e<c.length;e+=3)a.push(c.slice(e,e+3));return a}}function s(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function o(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}},2848:(e,t,i)=>{"use strict";i.d(t,{H:()=>a});var n=i(3334),r=i(5448),s=i(6815),o=i(8333);class a{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let s;s=t||e*i[r-1];let o,a=0,l=r-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-s,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(e,t){const i=1e-4;let n=e-i,o=e+i;n<0&&(n=0),o>1&&(o=1);const a=this.getPoint(n),l=this.getPoint(o),c=t||(a.isVector2?new r.Vector2:new s.Vector3);return c.copy(l).sub(a).normalize(),c}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new s.Vector3,r=[],a=[],l=[],c=new s.Vector3,h=new o.Matrix4;for(let t=0;t<=e;t++){const i=t/e;r[t]=this.getTangentAt(i,new s.Vector3)}a[0]=new s.Vector3,l[0]=new s.Vector3;let u=Number.MAX_VALUE;const d=Math.abs(r[0].x),m=Math.abs(r[0].y),p=Math.abs(r[0].z);d<=u&&(u=d,i.set(1,0,0)),m<=u&&(u=m,i.set(0,1,0)),p<=u&&i.set(0,0,1),c.crossVectors(r[0],i).normalize(),a[0].crossVectors(r[0],c),l[0].crossVectors(r[0],a[0]);for(let t=1;t<=e;t++){if(a[t]=a[t-1].clone(),l[t]=l[t-1].clone(),c.crossVectors(r[t-1],r[t]),c.length()>Number.EPSILON){c.normalize();const e=Math.acos(n.clamp(r[t-1].dot(r[t]),-1,1));a[t].applyMatrix4(h.makeRotationAxis(c,e))}l[t].crossVectors(r[t],a[t])}if(!0===t){let t=Math.acos(n.clamp(a[0].dot(a[e]),-1,1));t/=e,r[0].dot(c.crossVectors(a[0],a[e]))>0&&(t=-t);for(let i=1;i<=e;i++)a[i].applyMatrix4(h.makeRotationAxis(r[i],t*i)),l[i].crossVectors(r[i],a[i])}return{tangents:r,normals:a,binormals:l}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}},8117:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Path:()=>E});var n={};i.r(n),i.d(n,{ArcCurve:()=>l,CatmullRomCurve3:()=>f,CubicBezierCurve:()=>y,CubicBezierCurve3:()=>x,EllipseCurve:()=>a,LineCurve:()=>o.LineCurve,LineCurve3:()=>S,QuadraticBezierCurve:()=>b,QuadraticBezierCurve3:()=>T,SplineCurve:()=>M});var r=i(5448),s=i(2848),o=i(7793);class a extends s.H{constructor(e=0,t=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const i=t||new r.Vector2,n=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(s=o?0:n),!0!==this.aClockwise||o||(s===n?s=-n:s-=n);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=l-this.aX,n=c-this.aY;l=i*e-n*t+this.aX,c=i*t+n*e+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class l extends a{constructor(e,t,i,n,r,s){super(e,t,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}var c=i(6815);function h(){let e=0,t=0,i=0,n=0;function r(r,s,o,a){e=r,t=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(e,t,i,n,s){r(t,i,s*(i-e),s*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,s,o,a){let l=(t-e)/s-(i-e)/(s+o)+(i-t)/o,c=(i-t)/o-(n-t)/(o+a)+(n-i)/a;l*=o,c*=o,r(t,i,l,c)},calc:function(r){const s=r*r;return e+t*r+i*s+n*(s*r)}}}const u=new c.Vector3,d=new h,m=new h,p=new h;class f extends s.H{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new c.Vector3){const i=t,n=this.points,r=n.length,s=(r-(this.closed?0:1))*e;let o,a,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?o=n[(l-1)%r]:(u.subVectors(n[0],n[1]).add(n[0]),o=u);const f=n[l%r],g=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:(u.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=u),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(f),e),i=Math.pow(f.distanceToSquared(g),e),n=Math.pow(g.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),d.initNonuniformCatmullRom(o.x,f.x,g.x,a.x,t,i,n),m.initNonuniformCatmullRom(o.y,f.y,g.y,a.y,t,i,n),p.initNonuniformCatmullRom(o.z,f.z,g.z,a.z,t,i,n)}else"catmullrom"===this.curveType&&(d.initCatmullRom(o.x,f.x,g.x,a.x,this.tension),m.initCatmullRom(o.y,f.y,g.y,a.y,this.tension),p.initCatmullRom(o.z,f.z,g.z,a.z,this.tension));return i.set(d.calc(h),m.calc(h),p.calc(h)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new c.Vector3).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function g(e,t,i,n,r){const s=.5*(n-t),o=.5*(r-i),a=e*e;return(2*i-2*n+s+o)*(e*a)+(-3*i+3*n-2*s-o)*a+s*e+i}function v(e,t,i,n){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function _(e,t,i,n,r){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}class y extends s.H{constructor(e=new r.Vector2,t=new r.Vector2,i=new r.Vector2,n=new r.Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new r.Vector2){const i=t,n=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(_(e,n.x,s.x,o.x,a.x),_(e,n.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class x extends s.H{constructor(e=new c.Vector3,t=new c.Vector3,i=new c.Vector3,n=new c.Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new c.Vector3){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(_(e,n.x,r.x,s.x,o.x),_(e,n.y,r.y,s.y,o.y),_(e,n.z,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class S extends s.H{constructor(e=new c.Vector3,t=new c.Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new c.Vector3){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new c.Vector3){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class b extends s.H{constructor(e=new r.Vector2,t=new r.Vector2,i=new r.Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new r.Vector2){const i=t,n=this.v0,s=this.v1,o=this.v2;return i.set(v(e,n.x,s.x,o.x),v(e,n.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class T extends s.H{constructor(e=new c.Vector3,t=new c.Vector3,i=new c.Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new c.Vector3){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(v(e,n.x,r.x,s.x),v(e,n.y,r.y,s.y),v(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class M extends s.H{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new r.Vector2){const i=t,n=this.points,s=(n.length-1)*e,o=Math.floor(s),a=s-o,l=n[0===o?o:o-1],c=n[o],h=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return i.set(g(a,l.x,c.x,h.x,u.x),g(a,l.y,c.y,h.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new r.Vector2).fromArray(i))}return this}}class w extends s.H{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new o.LineCurve(t,e))}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const e=n[r]-i,s=this.curves[r],o=s.getLength(),a=0===o?0:1-e/o;return s.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const n=a[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new n[i.type]).fromJSON(i))}return this}}class E extends w{constructor(e){super(),this.type="Path",this.currentPoint=new r.Vector2,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new o.LineCurve(this.currentPoint.clone(),new r.Vector2(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const s=new b(this.currentPoint.clone(),new r.Vector2(e,t),new r.Vector2(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,s,o){const a=new y(this.currentPoint.clone(),new r.Vector2(e,t),new r.Vector2(i,n),new r.Vector2(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new M(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,i,n,r,s),this}absarc(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this}ellipse(e,t,i,n,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,s,o,a),this}absellipse(e,t,i,n,r,s,o,l){const c=new a(e,t,i,n,r,s,o,l);if(this.curves.length>0){const e=c.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}},7793:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LineCurve:()=>s});var n=i(5448),r=i(2848);class s extends r.H{constructor(e=new n.Vector2,t=new n.Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new n.Vector2){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new n.Vector2){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}},8817:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PlaneGeometry:()=>s});var n=i(3148),r=i(9365);class s extends n.BufferGeometry{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(n),c=a+1,h=l+1,u=e/a,d=t/l,m=[],p=[],f=[],g=[];for(let e=0;e<h;e++){const t=e*d-o;for(let i=0;i<c;i++){const n=i*u-s;p.push(n,-t,0),f.push(0,0,1),g.push(i/a),g.push(1-e/l)}}for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=t+c*e,n=t+c*(e+1),r=t+1+c*(e+1),s=t+1+c*e;m.push(i,n,s),m.push(n,r,s)}this.setIndex(m),this.setAttribute("position",new r.Float32BufferAttribute(p,3)),this.setAttribute("normal",new r.Float32BufferAttribute(f,3)),this.setAttribute("uv",new r.Float32BufferAttribute(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new s(e.width,e.height,e.widthSegments,e.heightSegments)}}},5814:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SphereGeometry:()=>o});var n=i(3148),r=i(9365),s=i(6815);class o extends n.BufferGeometry{constructor(e=1,t=32,i=16,n=0,o=2*Math.PI,a=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:o,thetaStart:a,thetaLength:l},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const c=Math.min(a+l,Math.PI);let h=0;const u=[],d=new s.Vector3,m=new s.Vector3,p=[],f=[],g=[],v=[];for(let r=0;r<=i;r++){const s=[],p=r/i;let _=0;0===r&&0===a?_=.5/t:r===i&&c===Math.PI&&(_=-.5/t);for(let i=0;i<=t;i++){const r=i/t;d.x=-e*Math.cos(n+r*o)*Math.sin(a+p*l),d.y=e*Math.cos(a+p*l),d.z=e*Math.sin(n+r*o)*Math.sin(a+p*l),f.push(d.x,d.y,d.z),m.copy(d).normalize(),g.push(m.x,m.y,m.z),v.push(r+_,1-p),s.push(h++)}u.push(s)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){const t=u[e][n+1],r=u[e][n],s=u[e+1][n],o=u[e+1][n+1];(0!==e||a>0)&&p.push(t,r,o),(e!==i-1||c<Math.PI)&&p.push(r,s,o)}this.setIndex(p),this.setAttribute("position",new r.Float32BufferAttribute(f,3)),this.setAttribute("normal",new r.Float32BufferAttribute(g,3)),this.setAttribute("uv",new r.Float32BufferAttribute(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new o(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}},3441:(e,t,i)=>{"use strict";i.r(t),i.d(t,{WireframeGeometry:()=>o});var n=i(3148),r=i(9365),s=i(6815);class o extends n.BufferGeometry{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],i=new Set,n=new s.Vector3,o=new s.Vector3;if(null!==e.index){const r=e.attributes.position,s=e.index;let l=e.groups;0===l.length&&(l=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,c=l.length;e<c;++e){const c=l[e],h=c.start;for(let e=h,l=h+c.count;e<l;e+=3)for(let l=0;l<3;l++){const c=s.getX(e+l),h=s.getX(e+(l+1)%3);n.fromBufferAttribute(r,c),o.fromBufferAttribute(r,h),!0===a(n,o,i)&&(t.push(n.x,n.y,n.z),t.push(o.x,o.y,o.z))}}}else{const r=e.attributes.position;for(let e=0,s=r.count/3;e<s;e++)for(let s=0;s<3;s++){const l=3*e+s,c=3*e+(s+1)%3;n.fromBufferAttribute(r,l),o.fromBufferAttribute(r,c),!0===a(n,o,i)&&(t.push(n.x,n.y,n.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new r.Float32BufferAttribute(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function a(e,t,i){const n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}},9191:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AmbientLight:()=>r});var n=i(2063);class r extends n._{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}},4307:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DirectionalLight:()=>g});var n=i(2063),r=i(8333),s=i(5448),o=i(6815),a=i(6577),l=i(6084);const c=new r.Matrix4,h=new o.Vector3,u=new o.Vector3;class d{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new s.Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new r.Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new l.Frustum,this._frameExtents=new s.Vector2(1,1),this._viewportCount=1,this._viewports=[new a.Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;h.setFromMatrixPosition(e.matrixWorld),t.position.copy(h),u.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(u),t.updateMatrixWorld(),c.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(c),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(c)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}var m=i(9896);class p extends d{constructor(){super(new m.OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}var f=i(2481);class g extends n._{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(f.Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new f.Object3D,this.shadow=new p}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}},2063:(e,t,i)=>{"use strict";i.d(t,{_:()=>s});var n=i(2481),r=i(5971);class s extends n.Object3D{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new r.Color(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}},8497:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CubeTextureLoader:()=>o});var n=i(2676),r=i(862),s=i(5421);class o extends s.a{constructor(e){super(e)}load(e,t,i,s){const o=new r.CubeTexture,a=new n.ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let l=0;function c(i){a.load(e[i],(function(e){o.images[i]=e,l++,6===l&&(o.needsUpdate=!0,t&&t(o))}),void 0,s)}for(let t=0;t<e.length;++t)c(t);return o}}},2676:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ImageLoader:()=>o});const n={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};var r=i(5421),s=i(1968);class o extends r.a{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=n.get(e);if(void 0!==a)return o.manager.itemStart(e),setTimeout((function(){t&&t(a),o.manager.itemEnd(e)}),0),a;const l=(0,s.c)("img");function c(){u(),n.add(e,this),t&&t(this),o.manager.itemEnd(e)}function h(t){u(),r&&r(t),o.manager.itemError(e),o.manager.itemEnd(e)}function u(){l.removeEventListener("load",c,!1),l.removeEventListener("error",h,!1)}return l.addEventListener("load",c,!1),l.addEventListener("error",h,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),o.manager.itemStart(e),l.src=e,l}}},5421:(e,t,i)=>{"use strict";i.d(t,{a:()=>s});class n{constructor(e,t,i){const n=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===s&&void 0!==n.onStart&&n.onStart(e,o,a),s=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}}const r=new n;class s{constructor(e){this.manager=void 0!==e?e:r,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(n,r){i.load(e,n,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}},642:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TextureLoader:()=>o});var n=i(2676),r=i(394),s=i(5421);class o extends s.a{constructor(e){super(e)}load(e,t,i,s){const o=new r.Texture,a=new n.ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){o.image=e,o.needsUpdate=!0,void 0!==t&&t(o)}),i,s),o}}},6307:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LineBasicMaterial:()=>s});var n=i(7951),r=i(5971);class s extends n.F{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new r.Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}},2578:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LineDashedMaterial:()=>r});var n=i(6307);class r extends n.LineBasicMaterial{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}},7951:(e,t,i)=>{"use strict";i.d(t,{F:()=>a});var n=i(2356),r=i(6271),s=i(3334);let o=0;class a extends n.EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:o++}),this.uuid=s.generateUUID(),this.name="",this.type="Material",this.blending=r.NormalBlending,this.side=r.FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=r.SrcAlphaFactor,this.blendDst=r.OneMinusSrcAlphaFactor,this.blendEquation=r.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=r.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=r.AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=r.KeepStencilOp,this.stencilZFail=r.KeepStencilOp,this.stencilZPass=r.KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==r.NormalBlending&&(i.blending=this.blending),this.side!==r.FrontSide&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}},977:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeshBasicMaterial:()=>o});var n=i(7951),r=i(6271),s=i(5971);class o extends n.F{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new s.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=r.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}},4127:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeshDepthMaterial:()=>s});var n=i(7951),r=i(6271);class s extends n.F{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=r.BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}},2149:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeshPhongMaterial:()=>a});var n=i(6271),r=i(7951),s=i(5448),o=i(5971);class a extends r.F{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new o.Color(16777215),this.specular=new o.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new o.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=n.TangentSpaceNormalMap,this.normalScale=new s.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}},8282:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeshStandardMaterial:()=>a});var n=i(6271),r=i(7951),s=i(5448),o=i(5971);class a extends r.F{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new o.Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new o.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=n.TangentSpaceNormalMap,this.normalScale=new s.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}},3905:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PointsMaterial:()=>s});var n=i(7951),r=i(5971);class s extends n.F{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new r.Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}},4085:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RawShaderMaterial:()=>r});var n=i(1498);class r extends n.ShaderMaterial{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}},1498:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ShaderMaterial:()=>s});var n=i(7951),r=i(5143);class s extends n.F{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=(0,r.cloneUniforms)(e.uniforms),this.uniformsGroups=(0,r.cloneUniformsGroups)(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}},433:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Box2:()=>s});var n=i(5448);const r=new n.Vector2;class s{constructor(e=new n.Vector2(1/0,1/0),t=new n.Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=r.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,r).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}},2754:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Box3:()=>r});var n=i(6815);class r{constructor(e=new n.Vector3(1/0,1/0,1/0),t=new n.Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(o.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(o.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=o.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),a.copy(e.boundingBox),a.applyMatrix4(e.matrixWorld),this.union(a);else{const i=e.geometry;if(void 0!==i)if(t&&void 0!==i.attributes&&void 0!==i.attributes.position){const t=i.attributes.position;for(let i=0,n=t.count;i<n;i++)o.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),this.expandByPoint(o)}else null===i.boundingBox&&i.computeBoundingBox(),a.copy(i.boundingBox),a.applyMatrix4(e.matrixWorld),this.union(a)}const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,o),o.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(p),f.subVectors(this.max,p),l.subVectors(e.a,p),c.subVectors(e.b,p),h.subVectors(e.c,p),u.subVectors(c,l),d.subVectors(h,c),m.subVectors(l,h);let t=[0,-u.z,u.y,0,-d.z,d.y,0,-m.z,m.y,u.z,0,-u.x,d.z,0,-d.x,m.z,0,-m.x,-u.y,u.x,0,-d.y,d.x,0,-m.y,m.x,0];return!!_(t,l,c,h,f)&&(t=[1,0,0,0,1,0,0,0,1],!!_(t,l,c,h,f)&&(g.crossVectors(u,d),t=[g.x,g.y,g.z],_(t,l,c,h,f)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,o).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(o).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(s[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),s[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),s[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),s[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),s[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),s[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),s[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),s[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(s)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const s=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],o=new n.Vector3,a=new r,l=new n.Vector3,c=new n.Vector3,h=new n.Vector3,u=new n.Vector3,d=new n.Vector3,m=new n.Vector3,p=new n.Vector3,f=new n.Vector3,g=new n.Vector3,v=new n.Vector3;function _(e,t,i,n,r){for(let s=0,o=e.length-3;s<=o;s+=3){v.fromArray(e,s);const o=r.x*Math.abs(v.x)+r.y*Math.abs(v.y)+r.z*Math.abs(v.z),a=t.dot(v),l=i.dot(v),c=n.dot(v);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}},5971:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Color:()=>h});var n=i(3334),r=i(9677),s=i(6271);const o={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},a={h:0,s:0,l:0},l={h:0,s:0,l:0};function c(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}class h{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=s.SRGBColorSpace){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,r.ColorManagement.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=r.ColorManagement.workingColorSpace){return this.r=e,this.g=t,this.b=i,r.ColorManagement.toWorkingColorSpace(this,n),this}setHSL(e,t,i,s=r.ColorManagement.workingColorSpace){if(e=(0,n.euclideanModulo)(e,1),t=(0,n.clamp)(t,0,1),i=(0,n.clamp)(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=c(r,n,e+1/3),this.g=c(r,n,e),this.b=c(r,n,e-1/3)}return r.ColorManagement.toWorkingColorSpace(this,s),this}setStyle(e,t=s.SRGBColorSpace){function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=n[1],o=n[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=n[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(i,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=s.SRGBColorSpace){const i=o[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=(0,r.SRGBToLinear)(e.r),this.g=(0,r.SRGBToLinear)(e.g),this.b=(0,r.SRGBToLinear)(e.b),this}copyLinearToSRGB(e){return this.r=(0,r.LinearToSRGB)(e.r),this.g=(0,r.LinearToSRGB)(e.g),this.b=(0,r.LinearToSRGB)(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=s.SRGBColorSpace){return r.ColorManagement.fromWorkingColorSpace(u.copy(this),e),65536*Math.round((0,n.clamp)(255*u.r,0,255))+256*Math.round((0,n.clamp)(255*u.g,0,255))+Math.round((0,n.clamp)(255*u.b,0,255))}getHexString(e=s.SRGBColorSpace){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=r.ColorManagement.workingColorSpace){r.ColorManagement.fromWorkingColorSpace(u.copy(this),t);const i=u.r,n=u.g,s=u.b,o=Math.max(i,n,s),a=Math.min(i,n,s);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const e=o-a;switch(c=h<=.5?e/(o+a):e/(2-o-a),o){case i:l=(n-s)/e+(n<s?6:0);break;case n:l=(s-i)/e+2;break;case s:l=(i-n)/e+4}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=r.ColorManagement.workingColorSpace){return r.ColorManagement.fromWorkingColorSpace(u.copy(this),t),e.r=u.r,e.g=u.g,e.b=u.b,e}getStyle(e=s.SRGBColorSpace){r.ColorManagement.fromWorkingColorSpace(u.copy(this),e);const t=u.r,i=u.g,n=u.b;return e!==s.SRGBColorSpace?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(e,t,i){return this.getHSL(a),a.h+=e,a.s+=t,a.l+=i,this.setHSL(a.h,a.s,a.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(a),e.getHSL(l);const i=(0,n.lerp)(a.h,l.h,t),r=(0,n.lerp)(a.s,l.s,t),s=(0,n.lerp)(a.l,l.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const u=new h;h.NAMES=o},9677:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ColorManagement:()=>u,LinearToSRGB:()=>o,SRGBToLinear:()=>s});var n=i(6271),r=i(8955);function s(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function o(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const a=(new r.Matrix3).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),l=(new r.Matrix3).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),c={[n.LinearSRGBColorSpace]:e=>e,[n.SRGBColorSpace]:e=>e.convertSRGBToLinear(),[n.DisplayP3ColorSpace]:function(e){return e.convertSRGBToLinear().applyMatrix3(l)}},h={[n.LinearSRGBColorSpace]:e=>e,[n.SRGBColorSpace]:e=>e.convertLinearToSRGB(),[n.DisplayP3ColorSpace]:function(e){return e.applyMatrix3(a).convertLinearToSRGB()}},u={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return n.LinearSRGBColorSpace},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(!1===this.enabled||t===i||!t||!i)return e;const n=c[t],r=h[i];if(void 0===n||void 0===r)throw new Error(`Unsupported color space conversion, "${t}" to "${i}".`);return r(n(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}}},6084:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Frustum:()=>l});var n=i(6815),r=i(5381),s=i(3850);const o=new r.Sphere,a=new n.Vector3;class l{constructor(e=new s.Plane,t=new s.Plane,i=new s.Plane,n=new s.Plane,r=new s.Plane,o=new s.Plane){this.planes=[e,t,i,n,r,o]}set(e,t,i,n,r,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],m=i[10],p=i[11],f=i[12],g=i[13],v=i[14],_=i[15];return t[0].setComponents(o-n,h-a,p-u,_-f).normalize(),t[1].setComponents(o+n,h+a,p+u,_+f).normalize(),t[2].setComponents(o+r,h+l,p+d,_+g).normalize(),t[3].setComponents(o-r,h-l,p-d,_-g).normalize(),t[4].setComponents(o-s,h-c,p-m,_-v).normalize(),t[5].setComponents(o+s,h+c,p+m,_+v).normalize(),this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),o.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),o.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(o)}intersectsSprite(e){return o.center.set(0,0,0),o.radius=.7071067811865476,o.applyMatrix4(e.matrixWorld),this.intersectsSphere(o)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(a.x=n.normal.x>0?e.max.x:e.min.x,a.y=n.normal.y>0?e.max.y:e.min.y,a.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(a)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}},4116:(e,t,i)=>{"use strict";i.d(t,{_:()=>n});class n{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(e>=r)break e;{const o=t[1];e<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0}}for(;i<s;){const n=i+s>>>1;e<t[n]?s=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let e=0;e!==n;++e)t[e]=i[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}},414:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Line3:()=>a});var n=i(6815),r=i(3334);const s=new n.Vector3,o=new n.Vector3;class a{constructor(e=new n.Vector3,t=new n.Vector3){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){s.subVectors(e,this.start),o.subVectors(this.end,this.start);const i=o.dot(o);let n=o.dot(s)/i;return t&&(n=r.clamp(n,0,1)),n}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}},3334:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEG2RAD:()=>s,MathUtils:()=>P,RAD2DEG:()=>o,ceilPowerOfTwo:()=>M,clamp:()=>l,damp:()=>m,degToRad:()=>S,denormalize:()=>C,euclideanModulo:()=>c,floorPowerOfTwo:()=>w,generateUUID:()=>a,inverseLerp:()=>u,isPowerOfTwo:()=>T,lerp:()=>d,mapLinear:()=>h,normalize:()=>A,pingpong:()=>p,radToDeg:()=>b,randFloat:()=>_,randFloatSpread:()=>y,randInt:()=>v,seededRandom:()=>x,setQuaternionFromProperEuler:()=>E,smootherstep:()=>g,smoothstep:()=>f});const n=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let r=1234567;const s=Math.PI/180,o=180/Math.PI;function a(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(n[255&e]+n[e>>8&255]+n[e>>16&255]+n[e>>24&255]+"-"+n[255&t]+n[t>>8&255]+"-"+n[t>>16&15|64]+n[t>>24&255]+"-"+n[63&i|128]+n[i>>8&255]+"-"+n[i>>16&255]+n[i>>24&255]+n[255&r]+n[r>>8&255]+n[r>>16&255]+n[r>>24&255]).toLowerCase()}function l(e,t,i){return Math.max(t,Math.min(i,e))}function c(e,t){return(e%t+t)%t}function h(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)}function u(e,t,i){return e!==t?(i-e)/(t-e):0}function d(e,t,i){return(1-i)*e+i*t}function m(e,t,i,n){return d(e,t,1-Math.exp(-i*n))}function p(e,t=1){return t-Math.abs(c(e,2*t)-t)}function f(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)}function g(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)}function v(e,t){return e+Math.floor(Math.random()*(t-e+1))}function _(e,t){return e+Math.random()*(t-e)}function y(e){return e*(.5-Math.random())}function x(e){void 0!==e&&(r=e);let t=r+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}function S(e){return e*s}function b(e){return e*o}function T(e){return!(e&e-1)&&0!==e}function M(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function w(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function E(e,t,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((t+n)/2),h=o((t+n)/2),u=s((t-n)/2),d=o((t-n)/2),m=s((n-t)/2),p=o((n-t)/2);switch(r){case"XYX":e.set(a*h,l*u,l*d,a*c);break;case"YZY":e.set(l*d,a*h,l*u,a*c);break;case"ZXZ":e.set(l*u,l*d,a*h,a*c);break;case"XZX":e.set(a*h,l*p,l*m,a*c);break;case"YXY":e.set(l*m,a*h,l*p,a*c);break;case"ZYZ":e.set(l*p,l*m,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function C(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function A(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const P={DEG2RAD:s,RAD2DEG:o,generateUUID:a,clamp:l,euclideanModulo:c,mapLinear:h,inverseLerp:u,lerp:d,damp:m,pingpong:p,smoothstep:f,smootherstep:g,randInt:v,randFloat:_,randFloatSpread:y,seededRandom:x,degToRad:S,radToDeg:b,isPowerOfTwo:T,ceilPowerOfTwo:M,floorPowerOfTwo:w,setQuaternionFromProperEuler:E,normalize:A,denormalize:C}},8955:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Matrix3:()=>n});class n{constructor(){n.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,n,r,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=r,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],m=i[8],p=n[0],f=n[3],g=n[6],v=n[1],_=n[4],y=n[7],x=n[2],S=n[5],b=n[8];return r[0]=s*p+o*v+a*x,r[3]=s*f+o*_+a*S,r[6]=s*g+o*y+a*b,r[1]=l*p+c*v+h*x,r[4]=l*f+c*_+h*S,r[7]=l*g+c*y+h*b,r[2]=u*p+d*v+m*x,r[5]=u*f+d*_+m*S,r[8]=u*g+d*y+m*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-i*r*c+i*o*a+n*r*l-n*s*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,m=t*h+i*u+n*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=h*p,e[1]=(n*l-c*i)*p,e[2]=(o*i-n*s)*p,e[3]=u*p,e[4]=(c*t-n*a)*p,e[5]=(n*r-o*t)*p,e[6]=d*p,e[7]=(i*a-l*t)*p,e[8]=(s*t-i*r)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+e,-n*l,n*a,-n*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(r.makeScale(e,t)),this}rotate(e){return this.premultiply(r.makeRotation(-e)),this}translate(e,t){return this.premultiply(r.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const r=new n},8333:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Matrix4:()=>r});var n=i(6815);class r{constructor(){r.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,n,r,s,o,a,l,c,h,u,d,m,p,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=m,g[11]=p,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new r).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/s.setFromMatrixColumn(e,0).length(),r=1/s.setFromMatrixColumn(e,1).length(),o=1/s.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){const e=s*c,i=s*h,n=o*c,r=o*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-o*a,t[2]=r-e*l,t[6]=n+i*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*c,i=a*h,n=l*c,r=l*h;t[0]=e+r*o,t[4]=n*o-i,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-o,t[2]=i*o-n,t[6]=r+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*c,i=a*h,n=l*c,r=l*h;t[0]=e-r*o,t[4]=-s*h,t[8]=n+i*o,t[1]=i+n*o,t[5]=s*c,t[9]=r-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*c,i=s*h,n=o*c,r=o*h;t[0]=a*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=a*h,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*c,t[4]=r-e*h,t[8]=n*h+i,t[1]=h,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-r*h}else if("XZY"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=o*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(a,e,l)}lookAt(e,t,i){const n=this.elements;return u.subVectors(e,t),0===u.lengthSq()&&(u.z=1),u.normalize(),c.crossVectors(i,u),0===c.lengthSq()&&(1===Math.abs(i.z)?u.x+=1e-4:u.z+=1e-4,u.normalize(),c.crossVectors(i,u)),c.normalize(),h.crossVectors(u,c),n[0]=c.x,n[4]=h.x,n[8]=u.x,n[1]=c.y,n[5]=h.y,n[9]=u.y,n[2]=c.z,n[6]=h.z,n[10]=u.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],m=i[2],p=i[6],f=i[10],g=i[14],v=i[3],_=i[7],y=i[11],x=i[15],S=n[0],b=n[4],T=n[8],M=n[12],w=n[1],E=n[5],C=n[9],A=n[13],P=n[2],R=n[6],L=n[10],D=n[14],I=n[3],O=n[7],F=n[11],U=n[15];return r[0]=s*S+o*w+a*P+l*I,r[4]=s*b+o*E+a*R+l*O,r[8]=s*T+o*C+a*L+l*F,r[12]=s*M+o*A+a*D+l*U,r[1]=c*S+h*w+u*P+d*I,r[5]=c*b+h*E+u*R+d*O,r[9]=c*T+h*C+u*L+d*F,r[13]=c*M+h*A+u*D+d*U,r[2]=m*S+p*w+f*P+g*I,r[6]=m*b+p*E+f*R+g*O,r[10]=m*T+p*C+f*L+g*F,r[14]=m*M+p*A+f*D+g*U,r[3]=v*S+_*w+y*P+x*I,r[7]=v*b+_*E+y*R+x*O,r[11]=v*T+_*C+y*L+x*F,r[15]=v*M+_*A+y*D+x*U,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*a*h-n*l*h-r*o*u+i*l*u+n*o*d-i*a*d)+e[7]*(+t*a*d-t*l*u+r*s*u-n*s*d+n*l*c-r*a*c)+e[11]*(+t*l*h-t*o*d-r*s*h+i*s*d+r*o*c-i*l*c)+e[15]*(-n*o*c-t*a*h+t*o*u+n*s*h-i*s*u+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],m=e[12],p=e[13],f=e[14],g=e[15],v=h*f*l-p*u*l+p*a*d-o*f*d-h*a*g+o*u*g,_=m*u*l-c*f*l-m*a*d+s*f*d+c*a*g-s*u*g,y=c*p*l-m*h*l+m*o*d-s*p*d-c*o*g+s*h*g,x=m*h*a-c*p*a-m*o*u+s*p*u+c*o*f-s*h*f,S=t*v+i*_+n*y+r*x;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/S;return e[0]=v*b,e[1]=(p*u*r-h*f*r-p*n*d+i*f*d+h*n*g-i*u*g)*b,e[2]=(o*f*r-p*a*r+p*n*l-i*f*l-o*n*g+i*a*g)*b,e[3]=(h*a*r-o*u*r-h*n*l+i*u*l+o*n*d-i*a*d)*b,e[4]=_*b,e[5]=(c*f*r-m*u*r+m*n*d-t*f*d-c*n*g+t*u*g)*b,e[6]=(m*a*r-s*f*r-m*n*l+t*f*l+s*n*g-t*a*g)*b,e[7]=(s*u*r-c*a*r+c*n*l-t*u*l-s*n*d+t*a*d)*b,e[8]=y*b,e[9]=(m*h*r-c*p*r-m*i*d+t*p*d+c*i*g-t*h*g)*b,e[10]=(s*p*r-m*o*r+m*i*l-t*p*l-s*i*g+t*o*g)*b,e[11]=(c*o*r-s*h*r-c*i*l+t*h*l+s*i*d-t*o*d)*b,e[12]=x*b,e[13]=(c*p*n-m*h*n+m*i*u-t*p*u-c*i*f+t*h*f)*b,e[14]=(m*o*n-s*p*n-m*i*a+t*p*a+s*i*f-t*o*f)*b,e[15]=(s*h*n-c*o*n+c*i*a-t*h*a-s*i*u+t*o*u)*b,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,o=e.y,a=e.z,l=r*s,c=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*s,0,l*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,m=r*h,p=s*c,f=s*h,g=o*h,v=a*l,_=a*c,y=a*h,x=i.x,S=i.y,b=i.z;return n[0]=(1-(p+g))*x,n[1]=(d+y)*x,n[2]=(m-_)*x,n[3]=0,n[4]=(d-y)*S,n[5]=(1-(u+g))*S,n[6]=(f+v)*S,n[7]=0,n[8]=(m+_)*b,n[9]=(f-v)*b,n[10]=(1-(u+p))*b,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=s.set(n[0],n[1],n[2]).length();const a=s.set(n[4],n[5],n[6]).length(),l=s.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],o.copy(this);const c=1/r,h=1/a,u=1/l;return o.elements[0]*=c,o.elements[1]*=c,o.elements[2]*=c,o.elements[4]*=h,o.elements[5]*=h,o.elements[6]*=h,o.elements[8]*=u,o.elements[9]*=u,o.elements[10]*=u,t.setFromRotationMatrix(o),i.x=r,i.y=a,i.z=l,this}makePerspective(e,t,i,n,r,s){const o=this.elements,a=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,r,s){const o=this.elements,a=1/(t-e),l=1/(i-n),c=1/(s-r),h=(t+e)*a,u=(i+n)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const s=new n.Vector3,o=new r,a=new n.Vector3(0,0,0),l=new n.Vector3(1,1,1),c=new n.Vector3,h=new n.Vector3,u=new n.Vector3},3850:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Plane:()=>l});var n=i(8955),r=i(6815);const s=new r.Vector3,o=new r.Vector3,a=new n.Matrix3;class l{constructor(e=new r.Vector3(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=s.subVectors(i,t).cross(o.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(s),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||a.getNormalMatrix(e),n=this.coplanarPoint(s).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}},9747:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Quaternion:()=>r});var n=i(3334);class r{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,s,o){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],m=r[s+2],p=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===o)return e[t+0]=u,e[t+1]=d,e[t+2]=m,void(e[t+3]=p);if(h!==p||a!==u||l!==d||c!==m){let e=1-o;const t=a*u+l*d+c*m+h*p,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,t*i);e=Math.sin(e*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*e+u*r,l=l*e+d*r,c=c*e+m*r,h=h*e+p*r,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=e,l*=e,c*=e,h*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],m=r[s+3];return e[t]=o*m+c*h+a*d-l*u,e[t+1]=a*m+c*u+l*h-o*d,e[t+2]=l*m+c*d+o*u-a*h,e[t+3]=c*m-o*h-a*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,n=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),h=o(r/2),u=a(i/2),d=a(n/2),m=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h-u*d*m;break;case"YXZ":this._x=u*c*h+l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h+u*d*m;break;case"ZXY":this._x=u*c*h-l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h-u*d*m;break;case"ZYX":this._x=u*c*h-l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h+u*d*m;break;case"YZX":this._x=u*c*h+l*d*m,this._y=l*d*h+u*c*m,this._z=l*c*m-u*d*h,this._w=l*c*h-u*d*m;break;case"XZY":this._x=u*c*h-l*d*m,this._y=l*d*h-u*c*m,this._z=l*c*m+u*d*h,this._w=l*c*h+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],h=t[10],u=i+o+h;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(s-n)*e}else if(i>o&&i>h){const e=2*Math.sqrt(1+i-o-h);this._w=(c-a)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(r+l)/e}else if(o>h){const e=2*Math.sqrt(1+o-i-h);this._w=(r-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+h-i-o);this._w=(s-n)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(n.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+s*o+n*l-r*a,this._y=n*c+s*a+r*o-i*l,this._z=r*c+s*l+i*a-n*o,this._w=s*c-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*e._w+i*e._x+n*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}},2309:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Ray:()=>u});var n=i(6815);const r=new n.Vector3,s=new n.Vector3,o=new n.Vector3,a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h=new n.Vector3;class u{constructor(e=new n.Vector3,t=new n.Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,r)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=r.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(r.copy(this.origin).addScaledVector(this.direction,t),r.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){s.copy(e).add(t).multiplyScalar(.5),o.copy(t).sub(e).normalize(),a.copy(this.origin).sub(s);const r=.5*e.distanceTo(t),l=-this.direction.dot(o),c=a.dot(this.direction),h=-a.dot(o),u=a.lengthSq(),d=Math.abs(1-l*l);let m,p,f,g;if(d>0)if(m=l*h-c,p=l*c-h,g=r*d,m>=0)if(p>=-g)if(p<=g){const e=1/d;m*=e,p*=e,f=m*(m+l*p+2*c)+p*(l*m+p+2*h)+u}else p=r,m=Math.max(0,-(l*p+c)),f=-m*m+p*(p+2*h)+u;else p=-r,m=Math.max(0,-(l*p+c)),f=-m*m+p*(p+2*h)+u;else p<=-g?(m=Math.max(0,-(-l*r+c)),p=m>0?-r:Math.min(Math.max(-r,-h),r),f=-m*m+p*(p+2*h)+u):p<=g?(m=0,p=Math.min(Math.max(-r,-h),r),f=p*(p+2*h)+u):(m=Math.max(0,-(l*r+c)),p=m>0?r:Math.min(Math.max(-r,-h),r),f=-m*m+p*(p+2*h)+u);else p=l>0?-r:r,m=Math.max(0,-(l*p+c)),f=-m*m+p*(p+2*h)+u;return i&&i.copy(this.origin).addScaledVector(this.direction,m),n&&n.copy(s).addScaledVector(o,p),f}intersectSphere(e,t){r.subVectors(e.center,this.origin);const i=r.dot(this.direction),n=r.dot(r)-i*i,s=e.radius*e.radius;if(n>s)return null;const o=Math.sqrt(s-n),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,s=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,s=(e.min.y-u.y)*c),i>s||r>n?null:((r>i||isNaN(i))&&(i=r),(s<n||isNaN(n))&&(n=s),h>=0?(o=(e.min.z-u.z)*h,a=(e.max.z-u.z)*h):(o=(e.max.z-u.z)*h,a=(e.min.z-u.z)*h),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,r)}intersectTriangle(e,t,i,n,r){l.subVectors(t,e),c.subVectors(i,e),h.crossVectors(l,c);let s,o=this.direction.dot(h);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}a.subVectors(this.origin,e);const u=s*this.direction.dot(c.crossVectors(a,c));if(u<0)return null;const d=s*this.direction.dot(l.cross(a));if(d<0)return null;if(u+d>o)return null;const m=-s*a.dot(h);return m<0?null:this.at(m/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}},5381:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Sphere:()=>l});var n=i(2754),r=i(6815);const s=new n.Box3,o=new r.Vector3,a=new r.Vector3;class l{constructor(e=new r.Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):s.setFromPoints(e).getCenter(i);let n=0;for(let t=0,r=e.length;t<r;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;o.subVectors(e,this.center);const t=o.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.addScaledVector(o,i/e),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(a.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(o.copy(e.center).add(a)),this.expandByPoint(o.copy(e.center).sub(a))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}},5448:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Vector2:()=>r});var n=i(3334);class r{constructor(e=0,t=0){r.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(n.clamp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}},6815:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Vector3:()=>s});var n=i(3334),r=i(9747);class s{constructor(e=0,t=0,i=0){s.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(a.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(a.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*n-o*i,c=a*i+o*t-r*n,h=a*n+r*i-s*t,u=-r*t-s*i-o*n;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return o.copy(this).projectOnVector(e),this.sub(o)}reflect(e){return this.sub(o.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(n.clamp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const o=new s,a=new r.Quaternion},6577:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Vector4:()=>n});class n{constructor(e=0,t=0,i=0,r=1){n.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const s=.01,o=.1,a=e.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],m=a[9],p=a[2],f=a[6],g=a[10];if(Math.abs(c-u)<s&&Math.abs(h-p)<s&&Math.abs(m-f)<s){if(Math.abs(c+u)<o&&Math.abs(h+p)<o&&Math.abs(m+f)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,v=(g+1)/2,_=(c+u)/4,y=(h+p)/4,x=(m+f)/4;return e>a&&e>v?e<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=_/i,r=y/i):a>v?a<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=_/n,r=x/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=y/r,n=x/r),this.set(i,n,r,t),this}let v=Math.sqrt((f-m)*(f-m)+(h-p)*(h-p)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(f-m)/v,this.y=(h-p)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}},9698:(e,t,i)=>{"use strict";i.d(t,{l:()=>r});var n=i(4116);class r extends n._{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(i-t)/(n-t),h=1-c;for(let e=0;e!==o;++e)r[e]=s[l+e]*h+s[a+e]*c;return r}}},4246:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Line:()=>g});var n=i(5381),r=i(2309),s=i(8333),o=i(2481),a=i(6815),l=i(6307),c=i(3148),h=i(9365);const u=new a.Vector3,d=new a.Vector3,m=new s.Matrix4,p=new r.Ray,f=new n.Sphere;class g extends o.Object3D{constructor(e=new c.BufferGeometry,t=new l.LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)u.fromBufferAttribute(t,e-1),d.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=u.distanceTo(d);e.setAttribute("lineDistance",new h.Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),f.copy(i.boundingSphere),f.applyMatrix4(n),f.radius+=r,!1===e.ray.intersectsSphere(f))return;m.copy(n).invert(),p.copy(e.ray).applyMatrix4(m);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new a.Vector3,h=new a.Vector3,u=new a.Vector3,d=new a.Vector3,g=this.isLineSegments?2:1,v=i.index,_=i.attributes.position;if(null!==v)for(let i=Math.max(0,s.start),n=Math.min(v.count,s.start+s.count)-1;i<n;i+=g){const n=v.getX(i),r=v.getX(i+1);if(c.fromBufferAttribute(_,n),h.fromBufferAttribute(_,r),p.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(d);s<e.near||s>e.far||t.push({distance:s,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(let i=Math.max(0,s.start),n=Math.min(_.count,s.start+s.count)-1;i<n;i+=g){if(c.fromBufferAttribute(_,i),h.fromBufferAttribute(_,i+1),p.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(d);n<e.near||n>e.far||t.push({distance:n,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}},4760:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LineSegments:()=>l});var n=i(4246),r=i(6815),s=i(9365);const o=new r.Vector3,a=new r.Vector3;class l extends n.Line{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)o.fromBufferAttribute(t,e),a.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+o.distanceTo(a);e.setAttribute("lineDistance",new s.Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}},5269:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Mesh:()=>z});var n=i(6815),r=i(5448),s=i(5381),o=i(2309),a=i(8333),l=i(2481);const c=new n.Vector3,h=new n.Vector3,u=new n.Vector3,d=new n.Vector3,m=new n.Vector3,p=new n.Vector3,f=new n.Vector3,g=new n.Vector3,v=new n.Vector3,_=new n.Vector3;let y=!1;class x{constructor(e=new n.Vector3,t=new n.Vector3,i=new n.Vector3){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),c.subVectors(e,t),n.cross(c);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){c.subVectors(n,t),h.subVectors(i,t),u.subVectors(e,t);const s=c.dot(c),o=c.dot(h),a=c.dot(u),l=h.dot(h),d=h.dot(u),m=s*l-o*o;if(0===m)return r.set(-2,-1,-1);const p=1/m,f=(l*a-o*d)*p,g=(s*d-o*a)*p;return r.set(1-f-g,g,f)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,d),d.x>=0&&d.y>=0&&d.x+d.y<=1}static getUV(e,t,i,n,r,s,o,a){return!1===y&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),y=!0),this.getInterpolation(e,t,i,n,r,s,o,a)}static getInterpolation(e,t,i,n,r,s,o,a){return this.getBarycoord(e,t,i,n,d),a.setScalar(0),a.addScaledVector(r,d.x),a.addScaledVector(s,d.y),a.addScaledVector(o,d.z),a}static isFrontFacing(e,t,i,n){return c.subVectors(i,t),h.subVectors(e,t),c.cross(h).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return c.subVectors(this.c,this.b),h.subVectors(this.a,this.b),.5*c.cross(h).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return x.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return x.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return!1===y&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),y=!0),x.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}getInterpolation(e,t,i,n,r){return x.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return x.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return x.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let s,o;m.subVectors(n,i),p.subVectors(r,i),g.subVectors(e,i);const a=m.dot(g),l=p.dot(g);if(a<=0&&l<=0)return t.copy(i);v.subVectors(e,n);const c=m.dot(v),h=p.dot(v);if(c>=0&&h<=c)return t.copy(n);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(i).addScaledVector(m,s);_.subVectors(e,r);const d=m.dot(_),y=p.dot(_);if(y>=0&&d<=y)return t.copy(r);const x=d*l-a*y;if(x<=0&&l>=0&&y<=0)return o=l/(l-y),t.copy(i).addScaledVector(p,o);const S=c*y-d*h;if(S<=0&&h-c>=0&&d-y>=0)return f.subVectors(r,n),o=(h-c)/(h-c+(d-y)),t.copy(n).addScaledVector(f,o);const b=1/(S+x+u);return s=x*b,o=u*b,t.copy(i).addScaledVector(m,s).addScaledVector(p,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}var S=i(6271),b=i(977),T=i(3148);const M=new a.Matrix4,w=new o.Ray,E=new s.Sphere,C=new n.Vector3,A=new n.Vector3,P=new n.Vector3,R=new n.Vector3,L=new n.Vector3,D=new n.Vector3,I=new r.Vector2,O=new r.Vector2,F=new r.Vector2,U=new n.Vector3,V=new n.Vector3,N=new n.Vector3,B=new n.Vector3,k=new n.Vector3;class z extends l.Object3D{constructor(e=new T.BufferGeometry,t=new b.MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const o=this.morphTargetInfluences;if(r&&o){D.set(0,0,0);for(let i=0,n=r.length;i<n;i++){const n=o[i],a=r[i];0!==n&&(L.fromBufferAttribute(a,e),s?D.addScaledVector(L,n):D.addScaledVector(L.sub(t),n))}t.add(D)}return t}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),E.copy(i.boundingSphere),E.applyMatrix4(r),w.copy(e.ray).recast(e.near),!1===E.containsPoint(w.origin)){if(null===w.intersectSphere(E,C))return;if(w.origin.distanceToSquared(C)>(e.far-e.near)**2)return}M.copy(r).invert(),w.copy(e.ray).applyMatrix4(M),null!==i.boundingBox&&!1===w.intersectsBox(i.boundingBox)||this._computeIntersections(e,t)}}_computeIntersections(e,t){let i;const n=this.geometry,r=this.material,s=n.index,o=n.attributes.position,a=n.attributes.uv,l=n.attributes.uv1,c=n.attributes.normal,h=n.groups,u=n.drawRange;if(null!==s)if(Array.isArray(r))for(let n=0,o=h.length;n<o;n++){const o=h[n],d=r[o.materialIndex];for(let n=Math.max(o.start,u.start),r=Math.min(s.count,Math.min(o.start+o.count,u.start+u.count));n<r;n+=3){const r=s.getX(n),h=s.getX(n+1),u=s.getX(n+2);i=G(this,d,e,w,a,l,c,r,h,u),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=o.materialIndex,t.push(i))}}else for(let n=Math.max(0,u.start),o=Math.min(s.count,u.start+u.count);n<o;n+=3){const o=s.getX(n),h=s.getX(n+1),u=s.getX(n+2);i=G(this,r,e,w,a,l,c,o,h,u),i&&(i.faceIndex=Math.floor(n/3),t.push(i))}else if(void 0!==o)if(Array.isArray(r))for(let n=0,s=h.length;n<s;n++){const s=h[n],d=r[s.materialIndex];for(let n=Math.max(s.start,u.start),r=Math.min(o.count,Math.min(s.start+s.count,u.start+u.count));n<r;n+=3)i=G(this,d,e,w,a,l,c,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=s.materialIndex,t.push(i))}else for(let n=Math.max(0,u.start),s=Math.min(o.count,u.start+u.count);n<s;n+=3)i=G(this,r,e,w,a,l,c,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),t.push(i))}}function G(e,t,i,s,o,a,l,c,h,u){e.getVertexPosition(c,A),e.getVertexPosition(h,P),e.getVertexPosition(u,R);const d=function(e,t,i,n,r,s,o,a){let l;if(l=t.side===S.BackSide?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,t.side===S.FrontSide,a),null===l)return null;k.copy(a),k.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(k);return c<i.near||c>i.far?null:{distance:c,point:k.clone(),object:e}}(e,t,i,s,A,P,R,B);if(d){o&&(I.fromBufferAttribute(o,c),O.fromBufferAttribute(o,h),F.fromBufferAttribute(o,u),d.uv=x.getInterpolation(B,A,P,R,I,O,F,new r.Vector2)),a&&(I.fromBufferAttribute(a,c),O.fromBufferAttribute(a,h),F.fromBufferAttribute(a,u),d.uv1=x.getInterpolation(B,A,P,R,I,O,F,new r.Vector2),d.uv2=d.uv1),l&&(U.fromBufferAttribute(l,c),V.fromBufferAttribute(l,h),N.fromBufferAttribute(l,u),d.normal=x.getInterpolation(B,A,P,R,U,V,N,new n.Vector3),d.normal.dot(s.direction)>0&&d.normal.multiplyScalar(-1));const e={a:c,b:h,c:u,normal:new n.Vector3,materialIndex:0};x.getNormal(A,P,R,e.normal),d.face=e}return d}},4994:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Points:()=>p});var n=i(5381),r=i(2309),s=i(8333),o=i(2481),a=i(6815),l=i(3905),c=i(3148);const h=new s.Matrix4,u=new r.Ray,d=new n.Sphere,m=new a.Vector3;class p extends o.Object3D{constructor(e=new c.BufferGeometry,t=new l.PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),d.copy(i.boundingSphere),d.applyMatrix4(n),d.radius+=r,!1===e.ray.intersectsSphere(d))return;h.copy(n).invert(),u.copy(e.ray).applyMatrix4(h);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=i.index,c=i.attributes.position;if(null!==l)for(let i=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);i<r;i++){const r=l.getX(i);m.fromBufferAttribute(c,r),f(m,r,a,n,e,t,this)}else for(let i=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);i<r;i++)m.fromBufferAttribute(c,i),f(m,i,a,n,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function f(e,t,i,n,r,s,o){const l=u.distanceSqToPoint(e);if(l<i){const i=new a.Vector3;u.closestPointToPoint(e,i),i.applyMatrix4(n);const c=r.ray.origin.distanceTo(i);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(l),point:i,index:t,face:null,object:o})}}},4814:(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebGL1Renderer:()=>r});var n=i(5700);class r extends n.WebGLRenderer{}r.prototype.isWebGL1Renderer=!0},5117:(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebGLRenderTarget:()=>c});var n=i(2356),r=i(394),s=i(6271),o=i(6577),a=i(4791),l=i(1968);class c extends n.EventDispatcher{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new o.Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new o.Vector4(0,0,e,t);const n={width:e,height:t,depth:1};void 0!==i.encoding&&((0,l.O4)("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===s.sRGBEncoding?s.SRGBColorSpace:s.NoColorSpace),this.texture=new r.Texture(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:s.LinearFilter,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new a.H(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}},5700:(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebGLRenderer:()=>di});var n=i(6271),r=i(6084),s=i(8333),o=i(6815),a=i(6577);function l(){let e=null,t=!1,i=null,n=null;function r(t,s){i(t,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function c(e,t){const i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=n.get(t);void 0===s?n.set(t,function(t,n){const r=t.array,s=t.usage,o=e.createBuffer();let a;if(e.bindBuffer(n,o),e.bufferData(n,r,s),t.onUploadCallback(),r instanceof Float32Array)a=e.FLOAT;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=e.HALF_FLOAT}else a=e.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=e.SHORT;else if(r instanceof Uint32Array)a=e.UNSIGNED_INT;else if(r instanceof Int32Array)a=e.INT;else if(r instanceof Int8Array)a=e.BYTE;else if(r instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=e.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(function(t,n,r){const s=n.array,o=n.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,s):(i?e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1),n.onUploadCallback()}(s.buffer,t,r),s.version=t.version)}}}var h=i(3148),u=i(9365);class d extends h.BufferGeometry{constructor(e=1,t=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const l=[],c=[],h=[],d=[];let m=0,p=0;function f(e,t,i,n,r,s,u,f,g,v,_){const y=s/g,x=u/v,S=s/2,b=u/2,T=f/2,M=g+1,w=v+1;let E=0,C=0;const A=new o.Vector3;for(let s=0;s<w;s++){const o=s*x-b;for(let a=0;a<M;a++){const l=a*y-S;A[e]=l*n,A[t]=o*r,A[i]=T,c.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[i]=f>0?1:-1,h.push(A.x,A.y,A.z),d.push(a/g),d.push(1-s/v),E+=1}}for(let e=0;e<v;e++)for(let t=0;t<g;t++){const i=m+t+M*e,n=m+t+M*(e+1),r=m+(t+1)+M*(e+1),s=m+(t+1)+M*e;l.push(i,n,s),l.push(n,r,s),C+=6}a.addGroup(p,C,_),p+=C,m+=E}f("z","y","x",-1,-1,i,t,e,s,r,0),f("z","y","x",1,-1,i,t,-e,s,r,1),f("x","z","y",1,1,e,i,t,n,s,2),f("x","z","y",1,-1,e,i,-t,n,s,3),f("x","y","z",1,-1,e,t,i,n,r,4),f("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(l),this.setAttribute("position",new u.Float32BufferAttribute(c,3)),this.setAttribute("normal",new u.Float32BufferAttribute(h,3)),this.setAttribute("uv",new u.Float32BufferAttribute(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new d(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}var m=i(8817),p=i(1498),f=i(5971),g=i(5269),v=i(9984),_=i(5143);const y={r:0,b:0,g:0};function x(e,t,i,r,s,o,a){const l=new f.Color(0);let c,h,u=!0===o?0:1,x=null,S=0,b=null;function T(t,i){t.getRGB(y,(0,_.getUnlitUniformColorSpace)(e)),r.buffers.color.setClear(y.r,y.g,y.b,i,a)}return{getClearColor:function(){return l},setClearColor:function(e,t=1){l.set(e),u=t,T(l,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,T(l,u)},render:function(o,f){let y=!1,M=!0===f.isScene?f.background:null;switch(M&&M.isTexture&&(M=(f.backgroundBlurriness>0?i:t).get(M)),null===M?T(l,u):M&&M.isColor&&(T(M,1),y=!0),e.xr.getEnvironmentBlendMode()){case"opaque":y=!0;break;case"additive":r.buffers.color.setClear(0,0,0,1,a),y=!0;break;case"alpha-blend":r.buffers.color.setClear(0,0,0,0,a),y=!0}(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),M&&(M.isCubeTexture||M.mapping===n.CubeUVReflectionMapping)?(void 0===h&&(h=new g.Mesh(new d(1,1,1),new p.ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:(0,_.cloneUniforms)(v.ShaderLib.backgroundCube.uniforms),vertexShader:v.ShaderLib.backgroundCube.vertexShader,fragmentShader:v.ShaderLib.backgroundCube.fragmentShader,side:n.BackSide,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),h.material.uniforms.envMap.value=M,h.material.uniforms.flipEnvMap.value=M.isCubeTexture&&!1===M.isRenderTargetTexture?-1:1,h.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,h.material.toneMapped=M.colorSpace!==n.SRGBColorSpace,x===M&&S===M.version&&b===e.toneMapping||(h.material.needsUpdate=!0,x=M,S=M.version,b=e.toneMapping),h.layers.enableAll(),o.unshift(h,h.geometry,h.material,0,0,null)):M&&M.isTexture&&(void 0===c&&(c=new g.Mesh(new m.PlaneGeometry(2,2),new p.ShaderMaterial({name:"BackgroundMaterial",uniforms:(0,_.cloneUniforms)(v.ShaderLib.background.uniforms),vertexShader:v.ShaderLib.background.vertexShader,fragmentShader:v.ShaderLib.background.fragmentShader,side:n.FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=M,c.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,c.material.toneMapped=M.colorSpace!==n.SRGBColorSpace,!0===M.matrixAutoUpdate&&M.updateMatrix(),c.material.uniforms.uvTransform.value.copy(M.matrix),x===M&&S===M.version&&b===e.toneMapping||(c.material.needsUpdate=!0,x=M,S=M.version,b=e.toneMapping),c.layers.enableAll(),o.unshift(c,c.geometry,c.material,0,0,null))}}}function S(e,t,i,n){const r=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=m(null);let c=l,h=!1;function u(t){return n.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function d(t){return n.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function m(e){const t=[],i=[],n=[];for(let e=0;e<r;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function f(e){g(e,0)}function g(i,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[i]=1,0===o[i]&&(e.enableVertexAttribArray(i),o[i]=1),a[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r)}function v(){const t=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function _(t,i,r,s,o,a){!0!==n.isWebGL2||r!==e.INT&&r!==e.UNSIGNED_INT?e.vertexAttribPointer(t,i,r,s,o,a):e.vertexAttribIPointer(t,i,r,o,a)}function y(){x(),h=!0,c!==l&&(c=l,u(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,y,x){let S=!1;if(o){const t=function(t,i,r){const o=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[o];return void 0===h&&(h=m(n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[o]=h),h}(y,d,l);c!==t&&(c=t,u(c.object)),S=function(e,t,i,n){const r=c.attributes,s=t.attributes;let o=0;const a=i.getAttributes();for(const t in a)if(a[t].location>=0){const i=r[t];let n=s[t];if(void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;o++}return c.attributesNum!==o||c.index!==n}(r,y,d,x),S&&function(e,t,i,n){const r={},s=t.attributes;let o=0;const a=i.getAttributes();for(const t in a)if(a[t].location>=0){let i=s[t];void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[t]=n,o++}c.attributes=r,c.attributesNum=o,c.index=n}(r,y,d,x)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===e||(c.geometry=y.id,c.program=d.id,c.wireframe=e,S=!0)}null!==x&&i.update(x,e.ELEMENT_ARRAY_BUFFER),(S||h)&&(h=!1,function(r,s,o,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const t in c){const n=c[t];if(n.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const t=s.normalized,o=s.itemSize,l=i.get(s);if(void 0===l)continue;const c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)g(n.location+e,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<n.locationSize;e++)f(n.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<n.locationSize;e++)_(n.location+e,o/n.locationSize,h,t,l*u,(d+o/n.locationSize*e)*u)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)g(n.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<n.locationSize;e++)f(n.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<n.locationSize;e++)_(n.location+e,o/n.locationSize,h,t,o*u,o/n.locationSize*e*u)}}else if(void 0!==h){const i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n.location,i);break;case 3:e.vertexAttrib3fv(n.location,i);break;case 4:e.vertexAttrib4fv(n.location,i);break;default:e.vertexAttrib1fv(n.location,i)}}}}v()}(r,l,d,y),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)d(n[e].object),delete n[e];delete i[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:v}}function b(e,t,i,n){const r=n.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,n){e.drawArrays(s,t,n),i.update(n,s,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,o,a),i.update(o,s,a)}}function T(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let o=void 0!==i.precision?i.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),m=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),_=u>0,y=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:m,maxAttributes:p,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:y,floatVertexTextures:_&&y,maxSamples:s?e.getParameter(e.MAX_SAMPLES):0}}var M=i(8955),w=i(3850);function E(e){const t=this;let i=null,n=0,r=!1,s=!1;const o=new w.Plane,a=new M.Matrix3,l={value:null,needsUpdate:!1};function c(e,i,n,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==s;++t,i+=4)o.copy(e[t]).applyMatrix4(r,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const i=0!==e.length||t||0!==n||r;return r=t,n=e.length,i},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){i=c(e,t,0)},this.setState=function(o,a,h){const u=o.clippingPlanes,d=o.clipIntersection,m=o.clipShadows,p=e.get(o);if(!r||null===u||0===u.length||s&&!m)s?c(null):(l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0);else{const e=s?0:n,t=4*e;let r=p.clippingState||null;l.value=r,r=c(u,a,t,h);for(let e=0;e!==t;++e)r[e]=i[e];p.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}var C=i(5117),A=i(2481),P=i(2479);const R=-90;class L extends A.Object3D{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const n=new P.PerspectiveCamera(R,1,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(1,0,0),this.add(n);const r=new P.PerspectiveCamera(R,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);const s=new P.PerspectiveCamera(R,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);const o=new P.PerspectiveCamera(R,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);const a=new P.PerspectiveCamera(R,1,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(0,0,1),this.add(a);const l=new P.PerspectiveCamera(R,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[r,s,o,a,l,c]=this.children,h=e.getRenderTarget(),u=e.toneMapping,d=e.xr.enabled;e.toneMapping=n.NoToneMapping,e.xr.enabled=!1;const m=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=m,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(h),e.toneMapping=u,e.xr.enabled=d,i.texture.needsPMREMUpdate=!0}}var D=i(862),I=i(1968);class O extends C.WebGLRenderTarget{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];void 0!==t.encoding&&((0,I.O4)("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===n.sRGBEncoding?n.SRGBColorSpace:n.NoColorSpace),this.texture=new D.CubeTexture(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:n.LinearFilter}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",s="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new d(5,5,5),a=new p.ShaderMaterial({name:"CubemapFromEquirect",uniforms:(0,_.cloneUniforms)(i),vertexShader:r,fragmentShader:s,side:n.BackSide,blending:n.NoBlending});a.uniforms.tEquirect.value=t;const l=new g.Mesh(o,a),c=t.minFilter;return t.minFilter===n.LinearMipmapLinearFilter&&(t.minFilter=n.LinearFilter),new L(1,10,this).update(e,l),t.minFilter=c,l.geometry.dispose(),l.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,n);e.setRenderTarget(r)}}function F(e){let t=new WeakMap;function i(e,t){return t===n.EquirectangularReflectionMapping?e.mapping=n.CubeReflectionMapping:t===n.EquirectangularRefractionMapping&&(e.mapping=n.CubeRefractionMapping),e}function r(e){const i=e.target;i.removeEventListener("dispose",r);const n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}return{get:function(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){const o=s.mapping;if(o===n.EquirectangularReflectionMapping||o===n.EquirectangularRefractionMapping){if(t.has(s))return i(t.get(s).texture,s.mapping);{const n=s.image;if(n&&n.height>0){const o=new O(n.height/2);return o.fromEquirectangularTexture(e,s),t.set(s,o),s.addEventListener("dispose",r),i(o.texture,s.mapping)}return null}}}return s},dispose:function(){t=new WeakMap}}}var U=i(9896),V=i(977);const N=[.125,.215,.35,.446,.526,.582],B=new U.OrthographicCamera,k=new f.Color;let z=null;const G=(1+Math.sqrt(5))/2,j=1/G,H=[new o.Vector3(1,1,1),new o.Vector3(-1,1,1),new o.Vector3(1,1,-1),new o.Vector3(-1,1,-1),new o.Vector3(0,G,j),new o.Vector3(0,G,-j),new o.Vector3(j,0,G),new o.Vector3(-j,0,G),new o.Vector3(G,j,0),new o.Vector3(-G,j,0)];class W{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){z=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Y(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=K(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(z),e.scissorTest=!1,X(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===n.CubeReflectionMapping||e.mapping===n.CubeRefractionMapping?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),z=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:n.LinearFilter,minFilter:n.LinearFilter,generateMipmaps:!1,type:n.HalfFloatType,format:n.RGBAFormat,colorSpace:n.LinearSRGBColorSpace,depthBuffer:!1},r=q(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=q(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],i=[],n=[];let r=e;const s=e-4+1+N.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);i.push(s);let a=1/s;o>e-4?a=N[o-e+4-1]:0===o&&(a=0),n.push(a);const l=1/(s-2),c=-l,d=1+l,m=[c,c,d,c,d,d,c,c,d,d,c,d],p=6,f=6,g=3,v=2,_=1,y=new Float32Array(g*f*p),x=new Float32Array(v*f*p),S=new Float32Array(_*f*p);for(let e=0;e<p;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];y.set(n,g*f*e),x.set(m,v*f*e);const r=[e,e,e,e,e,e];S.set(r,_*f*e)}const b=new h.BufferGeometry;b.setAttribute("position",new u.BufferAttribute(y,g)),b.setAttribute("uv",new u.BufferAttribute(x,v)),b.setAttribute("faceIndex",new u.BufferAttribute(S,_)),t.push(b),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(r)),this._blurMaterial=function(e,t,i){const r=new Float32Array(20),s=new o.Vector3(0,1,0);return new p.ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:n.NoBlending,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new g.Mesh(this._lodPlanes[0],e);this._renderer.compile(t,B)}_sceneToCubeUV(e,t,i,r){const s=new P.PerspectiveCamera(90,1,t,i),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(k),l.toneMapping=n.NoToneMapping,l.autoClear=!1;const u=new V.MeshBasicMaterial({name:"PMREM.Background",side:n.BackSide,depthWrite:!1,depthTest:!1}),m=new g.Mesh(new d,u);let p=!1;const f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,p=!0):(u.color.copy(k),p=!0);for(let t=0;t<6;t++){const i=t%3;0===i?(s.up.set(0,o[t],0),s.lookAt(a[t],0,0)):1===i?(s.up.set(0,0,o[t]),s.lookAt(0,a[t],0)):(s.up.set(0,o[t],0),s.lookAt(0,0,a[t]));const n=this._cubeSize;X(r,i*n,t>2?n:0,n,n),l.setRenderTarget(r),p&&l.render(m,s),l.render(e,s)}m.geometry.dispose(),m.material.dispose(),l.toneMapping=h,l.autoClear=c,e.background=f}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===n.CubeReflectionMapping||e.mapping===n.CubeRefractionMapping;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Y()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=K());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new g.Mesh(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const a=this._cubeSize;X(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(o,B)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const i=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),n=H[(t-1)%H.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new g.Mesh(this._lodPlanes[n],l),h=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,m=r/d,p=isFinite(r)?1+Math.floor(3*m):20;p>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const f=[];let v=0;for(let e=0;e<20;++e){const t=e/m,i=Math.exp(-t*t/2);f.push(i),0===e?v+=i:e<p&&(v+=2*i)}for(let e=0;e<f.length;e++)f[e]=f[e]/v;h.envMap.value=e.texture,h.samples.value=p,h.weights.value=f,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o);const{_lodMax:_}=this;h.dTheta.value=d,h.mipInt.value=_-i;const y=this._sizeLods[n];X(t,3*y*(n>_-4?n-_+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(t),a.render(c,B)}}function q(e,t,i){const r=new C.WebGLRenderTarget(e,t,i);return r.texture.mapping=n.CubeUVReflectionMapping,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function X(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function K(){return new p.ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:n.NoBlending,depthTest:!1,depthWrite:!1})}function Y(){return new p.ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:n.NoBlending,depthTest:!1,depthWrite:!1})}function Z(e){let t=new WeakMap,i=null;function r(e){const i=e.target;i.removeEventListener("dispose",r);const n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}return{get:function(s){if(s&&s.isTexture){const o=s.mapping,a=o===n.EquirectangularReflectionMapping||o===n.EquirectangularRefractionMapping,l=o===n.CubeReflectionMapping||o===n.CubeRefractionMapping;if(a||l){if(s.isRenderTargetTexture&&!0===s.needsPMREMUpdate){s.needsPMREMUpdate=!1;let n=t.get(s);return null===i&&(i=new W(e)),n=a?i.fromEquirectangular(s,n):i.fromCubemap(s,n),t.set(s,n),n.texture}if(t.has(s))return t.get(s).texture;{const n=s.image;if(a&&n&&n.height>0||l&&n&&function(e){let t=0;for(let i=0;i<6;i++)void 0!==e[i]&&t++;return 6===t}(n)){null===i&&(i=new W(e));const n=a?i.fromEquirectangular(s):i.fromCubemap(s);return t.set(s,n),s.addEventListener("dispose",r),n.texture}return null}}}return s},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function $(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function J(e,t,i,n){const r={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],n=e.index,r=e.attributes.position;let o=0;if(null!==n){const e=n.array;o=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],r=e[t+1],s=e[t+2];i.push(n,r,r,s,s,n)}}else{const e=r.array;o=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}const a=new((0,I.H7)(i)?u.Uint32BufferAttribute:u.Uint16BufferAttribute)(i,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,i.memory.geometries++),t},update:function(i){const n=i.attributes;for(const i in n)t.update(n[i],e.ARRAY_BUFFER);const r=i.morphAttributes;for(const i in r){const n=r[i];for(let i=0,r=n.length;i<r;i++)t.update(n[i],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return s.get(e)}}}function Q(e,t,i,n){const r=n.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(s,n,o,t*a),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,u;if(r)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,n*a,c),i.update(l,s,c)}}function ee(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(i,n,r){switch(t.calls++,n){case e.TRIANGLES:t.triangles+=r*(i/3);break;case e.LINES:t.lines+=r*(i/2);break;case e.LINE_STRIP:t.lines+=r*(i-1);break;case e.LINE_LOOP:t.lines+=r*i;break;case e.POINTS:t.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}var te=i(394);class ie extends te.Texture{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=n.NearestFilter,this.minFilter=n.NearestFilter,this.wrapR=n.ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var ne=i(5448);function re(e,t){return e[0]-t[0]}function se(e,t){return Math.abs(t[1])-Math.abs(e[1])}function oe(e,t,i){const r={},s=new Float32Array(8),o=new WeakMap,l=new a.Vector4,c=[];for(let e=0;e<8;e++)c[e]=[e,0];return{update:function(a,h,u){const d=a.morphTargetInfluences;if(!0===t.isWebGL2){const m=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,p=void 0!==m?m.length:0;let f=o.get(h);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const _=void 0!==h.morphAttributes.position,y=void 0!==h.morphAttributes.normal,x=void 0!==h.morphAttributes.color,S=h.morphAttributes.position||[],b=h.morphAttributes.normal||[],T=h.morphAttributes.color||[];let M=0;!0===_&&(M=1),!0===y&&(M=2),!0===x&&(M=3);let w=h.attributes.position.count*M,E=1;w>t.maxTextureSize&&(E=Math.ceil(w/t.maxTextureSize),w=t.maxTextureSize);const C=new Float32Array(w*E*4*p),A=new ie(C,w,E,p);A.type=n.FloatType,A.needsUpdate=!0;const P=4*M;for(let L=0;L<p;L++){const D=S[L],I=b[L],O=T[L],F=w*E*4*L;for(let U=0;U<D.count;U++){const V=U*P;!0===_&&(l.fromBufferAttribute(D,U),C[F+V+0]=l.x,C[F+V+1]=l.y,C[F+V+2]=l.z,C[F+V+3]=0),!0===y&&(l.fromBufferAttribute(I,U),C[F+V+4]=l.x,C[F+V+5]=l.y,C[F+V+6]=l.z,C[F+V+7]=0),!0===x&&(l.fromBufferAttribute(O,U),C[F+V+8]=l.x,C[F+V+9]=l.y,C[F+V+10]=l.z,C[F+V+11]=4===O.itemSize?l.w:1)}}function R(){A.dispose(),o.delete(h),h.removeEventListener("dispose",R)}f={count:p,texture:A,size:new ne.Vector2(w,E)},o.set(h,f),h.addEventListener("dispose",R)}let g=0;for(let N=0;N<d.length;N++)g+=d[N];const v=h.morphTargetsRelative?1:1-g;u.getUniforms().setValue(e,"morphTargetBaseInfluence",v),u.getUniforms().setValue(e,"morphTargetInfluences",d),u.getUniforms().setValue(e,"morphTargetsTexture",f.texture,i),u.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const B=void 0===d?0:d.length;let k=r[h.id];if(void 0===k||k.length!==B){k=[];for(let W=0;W<B;W++)k[W]=[W,0];r[h.id]=k}for(let q=0;q<B;q++){const X=k[q];X[0]=q,X[1]=d[q]}k.sort(se);for(let K=0;K<8;K++)K<B&&k[K][1]?(c[K][0]=k[K][0],c[K][1]=k[K][1]):(c[K][0]=Number.MAX_SAFE_INTEGER,c[K][1]=0);c.sort(re);const z=h.morphAttributes.position,G=h.morphAttributes.normal;let j=0;for(let Y=0;Y<8;Y++){const Z=c[Y],$=Z[0],J=Z[1];$!==Number.MAX_SAFE_INTEGER&&J?(z&&h.getAttribute("morphTarget"+Y)!==z[$]&&h.setAttribute("morphTarget"+Y,z[$]),G&&h.getAttribute("morphNormal"+Y)!==G[$]&&h.setAttribute("morphNormal"+Y,G[$]),s[Y]=J,j+=J):(z&&!0===h.hasAttribute("morphTarget"+Y)&&h.deleteAttribute("morphTarget"+Y),G&&!0===h.hasAttribute("morphNormal"+Y)&&h.deleteAttribute("morphNormal"+Y),s[Y]=0)}const H=h.morphTargetsRelative?1:1-j;u.getUniforms().setValue(e,"morphTargetBaseInfluence",H),u.getUniforms().setValue(e,"morphTargetInfluences",s)}}}}function ae(e,t,i,n){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(o){const a=n.render.frame,l=o.geometry,c=t.get(o,l);return r.get(c)!==a&&(t.update(c),r.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),i.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&i.update(o.instanceColor,e.ARRAY_BUFFER)),c},dispose:function(){r=new WeakMap}}}var le=i(1389);class ce extends te.Texture{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=n.NearestFilter,this.minFilter=n.NearestFilter,this.wrapR=n.ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const he=new te.Texture,ue=new ie,de=new ce,me=new D.CubeTexture,pe=[],fe=[],ge=new Float32Array(16),ve=new Float32Array(9),_e=new Float32Array(4);function ye(e,t,i){const n=e[0];if(n<=0||n>0)return e;const r=t*i;let s=pe[r];if(void 0===s&&(s=new Float32Array(r),pe[r]=s),0!==t){n.toArray(s,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(s,r)}return s}function xe(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Se(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function be(e,t){let i=fe[t];void 0===i&&(i=new Int32Array(t),fe[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Te(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Me(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(xe(i,t))return;e.uniform2fv(this.addr,t),Se(i,t)}}function we(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(xe(i,t))return;e.uniform3fv(this.addr,t),Se(i,t)}}function Ee(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(xe(i,t))return;e.uniform4fv(this.addr,t),Se(i,t)}}function Ce(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(xe(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Se(i,t)}else{if(xe(i,n))return;_e.set(n),e.uniformMatrix2fv(this.addr,!1,_e),Se(i,n)}}function Ae(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(xe(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Se(i,t)}else{if(xe(i,n))return;ve.set(n),e.uniformMatrix3fv(this.addr,!1,ve),Se(i,n)}}function Pe(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(xe(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Se(i,t)}else{if(xe(i,n))return;ge.set(n),e.uniformMatrix4fv(this.addr,!1,ge),Se(i,n)}}function Re(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Le(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(xe(i,t))return;e.uniform2iv(this.addr,t),Se(i,t)}}function De(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(xe(i,t))return;e.uniform3iv(this.addr,t),Se(i,t)}}function Ie(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(xe(i,t))return;e.uniform4iv(this.addr,t),Se(i,t)}}function Oe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Fe(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(xe(i,t))return;e.uniform2uiv(this.addr,t),Se(i,t)}}function Ue(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(xe(i,t))return;e.uniform3uiv(this.addr,t),Se(i,t)}}function Ve(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(xe(i,t))return;e.uniform4uiv(this.addr,t),Se(i,t)}}function Ne(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||he,r)}function Be(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||de,r)}function ke(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||me,r)}function ze(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||ue,r)}function Ge(e,t){e.uniform1fv(this.addr,t)}function je(e,t){const i=ye(t,this.size,2);e.uniform2fv(this.addr,i)}function He(e,t){const i=ye(t,this.size,3);e.uniform3fv(this.addr,i)}function We(e,t){const i=ye(t,this.size,4);e.uniform4fv(this.addr,i)}function qe(e,t){const i=ye(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Xe(e,t){const i=ye(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Ke(e,t){const i=ye(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Ye(e,t){e.uniform1iv(this.addr,t)}function Ze(e,t){e.uniform2iv(this.addr,t)}function $e(e,t){e.uniform3iv(this.addr,t)}function Je(e,t){e.uniform4iv(this.addr,t)}function Qe(e,t){e.uniform1uiv(this.addr,t)}function et(e,t){e.uniform2uiv(this.addr,t)}function tt(e,t){e.uniform3uiv(this.addr,t)}function it(e,t){e.uniform4uiv(this.addr,t)}function nt(e,t,i){const n=this.cache,r=t.length,s=be(i,r);xe(n,s)||(e.uniform1iv(this.addr,s),Se(n,s));for(let e=0;e!==r;++e)i.setTexture2D(t[e]||he,s[e])}function rt(e,t,i){const n=this.cache,r=t.length,s=be(i,r);xe(n,s)||(e.uniform1iv(this.addr,s),Se(n,s));for(let e=0;e!==r;++e)i.setTexture3D(t[e]||de,s[e])}function st(e,t,i){const n=this.cache,r=t.length,s=be(i,r);xe(n,s)||(e.uniform1iv(this.addr,s),Se(n,s));for(let e=0;e!==r;++e)i.setTextureCube(t[e]||me,s[e])}function ot(e,t,i){const n=this.cache,r=t.length,s=be(i,r);xe(n,s)||(e.uniform1iv(this.addr,s),Se(n,s));for(let e=0;e!==r;++e)i.setTexture2DArray(t[e]||ue,s[e])}class at{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Te;case 35664:return Me;case 35665:return we;case 35666:return Ee;case 35674:return Ce;case 35675:return Ae;case 35676:return Pe;case 5124:case 35670:return Re;case 35667:case 35671:return Le;case 35668:case 35672:return De;case 35669:case 35673:return Ie;case 5125:return Oe;case 36294:return Fe;case 36295:return Ue;case 36296:return Ve;case 35678:case 36198:case 36298:case 36306:case 35682:return Ne;case 35679:case 36299:case 36307:return Be;case 35680:case 36300:case 36308:case 36293:return ke;case 36289:case 36303:case 36311:case 36292:return ze}}(t.type)}}class lt{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ge;case 35664:return je;case 35665:return He;case 35666:return We;case 35674:return qe;case 35675:return Xe;case 35676:return Ke;case 5124:case 35670:return Ye;case 35667:case 35671:return Ze;case 35668:case 35672:return $e;case 35669:case 35673:return Je;case 5125:return Qe;case 36294:return et;case 36295:return tt;case 36296:return it;case 35678:case 36198:case 36298:case 36306:case 35682:return nt;case 35679:case 36299:case 36307:return rt;case 35680:case 36300:case 36308:case 36293:return st;case 36289:case 36303:case 36311:case 36292:return ot}}(t.type)}}class ct{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(e,t[s.id],i)}}}const ht=/(\w+)(\])?(\[|\.)?/g;function ut(e,t){e.seq.push(t),e.map[t.id]=t}function dt(e,t,i){const n=e.name,r=n.length;for(ht.lastIndex=0;;){const s=ht.exec(n),o=ht.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){ut(i,void 0===c?new at(a,e,t):new lt(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new ct(a),ut(i,e)),i=e}}}class mt{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);dt(i,e.getUniformLocation(t,i.name),this)}}setValue(e,t,i,n){const r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){const s=t[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const r=e[n];r.id in t&&i.push(r)}return i}}function pt(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}var ft=i(576);let gt=0;function vt(e,t,i){const n=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const n=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const i=e.split("\n"),n=[],r=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let e=r;e<s;e++){const r=e+1;n.push(`${r===t?">":" "} ${r}: ${i[e]}`)}return n.join("\n")}(e.getShaderSource(t),n)}return r}function _t(e,t){const i=function(e){switch(e){case n.LinearSRGBColorSpace:return["Linear","( value )"];case n.SRGBColorSpace:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function yt(e,t){let i;switch(t){case n.LinearToneMapping:i="Linear";break;case n.ReinhardToneMapping:i="Reinhard";break;case n.CineonToneMapping:i="OptimizedCineon";break;case n.ACESFilmicToneMapping:i="ACESFilmic";break;case n.CustomToneMapping:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function xt(e){return""!==e}function St(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function bt(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Tt=/^[ \t]*#include +<([\w\d./]+)>/gm;function Mt(e){return e.replace(Tt,wt)}function wt(e,t){const i=ft.ShaderChunk[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Mt(i)}const Et=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ct(e){return e.replace(Et,At)}function At(e,t,i,n){let r="";for(let e=parseInt(t);e<parseInt(i);e++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function Pt(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Rt(e,t,i,r){const s=e.getContext(),o=i.defines;let a=i.vertexShader,l=i.fragmentShader;const c=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===n.PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===n.PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===n.VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}(i),h=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case n.CubeReflectionMapping:case n.CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case n.CubeUVReflectionMapping:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===n.CubeRefractionMapping&&(t="ENVMAP_MODE_REFRACTION"),t}(i),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case n.MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case n.MixOperation:t="ENVMAP_BLENDING_MIX";break;case n.AddOperation:t="ENVMAP_BLENDING_ADD"}return t}(i),m=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),p=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(xt).join("\n")}(i),f=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(o),g=s.createProgram();let v,_,y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(v=[f].filter(xt).join("\n"),v.length>0&&(v+="\n"),_=[p,f].filter(xt).join("\n"),_.length>0&&(_+="\n")):(v=[Pt(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(xt).join("\n"),_=[p,Pt(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",i.envMap?"#define "+d:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==n.NoToneMapping?"#define TONE_MAPPING":"",i.toneMapping!==n.NoToneMapping?ft.ShaderChunk.tonemapping_pars_fragment:"",i.toneMapping!==n.NoToneMapping?yt("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ft.ShaderChunk.encodings_pars_fragment,_t("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(xt).join("\n")),a=Mt(a),a=St(a,i),a=bt(a,i),l=Mt(l),l=St(l,i),l=bt(l,i),a=Ct(a),l=Ct(l),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,_=["#define varying in",i.glslVersion===n.GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===n.GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const x=y+v+a,S=y+_+l,b=pt(s,s.VERTEX_SHADER,x),T=pt(s,s.FRAGMENT_SHADER,S);if(s.attachShader(g,b),s.attachShader(g,T),void 0!==i.index0AttributeName?s.bindAttribLocation(g,0,i.index0AttributeName):!0===i.morphTargets&&s.bindAttribLocation(g,0,"position"),s.linkProgram(g),e.debug.checkShaderErrors){const t=s.getProgramInfoLog(g).trim(),i=s.getShaderInfoLog(b).trim(),n=s.getShaderInfoLog(T).trim();let r=!0,o=!0;if(!1===s.getProgramParameter(g,s.LINK_STATUS))if(r=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(s,g,b,T);else{const e=vt(s,b,"vertex"),i=vt(s,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(g,s.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==i&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:i,prefix:v},fragmentShader:{log:n,prefix:_}})}let M,w;return s.deleteShader(b),s.deleteShader(T),this.getUniforms=function(){return void 0===M&&(M=new mt(s,g)),M},this.getAttributes=function(){return void 0===w&&(w=function(e,t){const i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const n=e.getActiveAttrib(t,r),s=n.name;let o=1;n.type===e.FLOAT_MAT2&&(o=2),n.type===e.FLOAT_MAT3&&(o=3),n.type===e.FLOAT_MAT4&&(o=4),i[s]={type:n.type,location:e.getAttribLocation(t,s),locationSize:o}}return i}(s,g)),w},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=gt++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=b,this.fragmentShader=T,this}let Lt=0;class Dt{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new It(e),t.set(e,i)),i}}class It{constructor(e){this.id=Lt++,this.code=e,this.usedTimes=0}}function Ot(e,t,i,r,s,o,a){const l=new le.S,c=new Dt,h=[],u=s.isWebGL2,d=s.logarithmicDepthBuffer,m=s.vertexTextures;let p=s.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(e){return 1===e?"uv1":2===e?"uv2":3===e?"uv3":"uv"}return{getParameters:function(o,l,h,_,y){const x=_.fog,S=y.geometry,b=o.isMeshStandardMaterial?_.environment:null,T=(o.isMeshStandardMaterial?i:t).get(o.envMap||b),M=T&&T.mapping===n.CubeUVReflectionMapping?T.image.height:null,w=f[o.type];null!==o.precision&&(p=s.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const E=S.morphAttributes.position||S.morphAttributes.normal||S.morphAttributes.color,C=void 0!==E?E.length:0;let A,P,R,L,D=0;if(void 0!==S.morphAttributes.position&&(D=1),void 0!==S.morphAttributes.normal&&(D=2),void 0!==S.morphAttributes.color&&(D=3),w){const e=v.ShaderLib[w];A=e.vertexShader,P=e.fragmentShader}else A=o.vertexShader,P=o.fragmentShader,c.update(o),R=c.getVertexShaderID(o),L=c.getFragmentShaderID(o);const I=e.getRenderTarget(),O=!0===y.isInstancedMesh,F=!!o.map,U=!!o.matcap,V=!!T,N=!!o.aoMap,B=!!o.lightMap,k=!!o.bumpMap,z=!!o.normalMap,G=!!o.displacementMap,j=!!o.emissiveMap,H=!!o.metalnessMap,W=!!o.roughnessMap,q=o.clearcoat>0,X=o.iridescence>0,K=o.sheen>0,Y=o.transmission>0,Z=q&&!!o.clearcoatMap,$=q&&!!o.clearcoatNormalMap,J=q&&!!o.clearcoatRoughnessMap,Q=X&&!!o.iridescenceMap,ee=X&&!!o.iridescenceThicknessMap,te=K&&!!o.sheenColorMap,ie=K&&!!o.sheenRoughnessMap,ne=!!o.specularMap,re=!!o.specularColorMap,se=!!o.specularIntensityMap,oe=Y&&!!o.transmissionMap,ae=Y&&!!o.thicknessMap,le=!!o.gradientMap,ce=!!o.alphaMap,he=o.alphaTest>0,ue=!!o.extensions,de=!!S.attributes.uv1,me=!!S.attributes.uv2,pe=!!S.attributes.uv3;return{isWebGL2:u,shaderID:w,shaderName:o.type,vertexShader:A,fragmentShader:P,defines:o.defines,customVertexShaderID:R,customFragmentShaderID:L,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,instancing:O,instancingColor:O&&null!==y.instanceColor,supportsVertexTextures:m,outputColorSpace:null===I?e.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:n.LinearSRGBColorSpace,map:F,matcap:U,envMap:V,envMapMode:V&&T.mapping,envMapCubeUVHeight:M,aoMap:N,lightMap:B,bumpMap:k,normalMap:z,displacementMap:m&&G,emissiveMap:j,normalMapObjectSpace:z&&o.normalMapType===n.ObjectSpaceNormalMap,normalMapTangentSpace:z&&o.normalMapType===n.TangentSpaceNormalMap,metalnessMap:H,roughnessMap:W,clearcoat:q,clearcoatMap:Z,clearcoatNormalMap:$,clearcoatRoughnessMap:J,iridescence:X,iridescenceMap:Q,iridescenceThicknessMap:ee,sheen:K,sheenColorMap:te,sheenRoughnessMap:ie,specularMap:ne,specularColorMap:re,specularIntensityMap:se,transmission:Y,transmissionMap:oe,thicknessMap:ae,gradientMap:le,opaque:!1===o.transparent&&o.blending===n.NormalBlending,alphaMap:ce,alphaTest:he,combine:o.combine,mapUv:F&&g(o.map.channel),aoMapUv:N&&g(o.aoMap.channel),lightMapUv:B&&g(o.lightMap.channel),bumpMapUv:k&&g(o.bumpMap.channel),normalMapUv:z&&g(o.normalMap.channel),displacementMapUv:G&&g(o.displacementMap.channel),emissiveMapUv:j&&g(o.emissiveMap.channel),metalnessMapUv:H&&g(o.metalnessMap.channel),roughnessMapUv:W&&g(o.roughnessMap.channel),clearcoatMapUv:Z&&g(o.clearcoatMap.channel),clearcoatNormalMapUv:$&&g(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:J&&g(o.clearcoatRoughnessMap.channel),iridescenceMapUv:Q&&g(o.iridescenceMap.channel),iridescenceThicknessMapUv:ee&&g(o.iridescenceThicknessMap.channel),sheenColorMapUv:te&&g(o.sheenColorMap.channel),sheenRoughnessMapUv:ie&&g(o.sheenRoughnessMap.channel),specularMapUv:ne&&g(o.specularMap.channel),specularColorMapUv:re&&g(o.specularColorMap.channel),specularIntensityMapUv:se&&g(o.specularIntensityMap.channel),transmissionMapUv:oe&&g(o.transmissionMap.channel),thicknessMapUv:ae&&g(o.thicknessMap.channel),alphaMapUv:ce&&g(o.alphaMap.channel),vertexTangents:z&&!!S.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!S.attributes.color&&4===S.attributes.color.itemSize,vertexUv1s:de,vertexUv2s:me,vertexUv3s:pe,pointsUvs:!0===y.isPoints&&!!S.attributes.uv&&(F||ce),fog:!!x,useFog:!0===o.fog,fogExp2:x&&x.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==S.morphAttributes.position,morphNormals:void 0!==S.morphAttributes.normal,morphColors:void 0!==S.morphAttributes.color,morphTargetsCount:C,morphTextureStride:D,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:n.NoToneMapping,useLegacyLights:e.useLegacyLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===n.DoubleSide,flipSided:o.side===n.BackSide,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionDerivatives:ue&&!0===o.extensions.derivatives,extensionFragDepth:ue&&!0===o.extensions.fragDepth,extensionDrawBuffers:ue&&!0===o.extensions.drawBuffers,extensionShaderTextureLOD:ue&&!0===o.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.customVertexShaderID),i.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(i,t),function(e,t){l.disableAll(),t.isWebGL2&&l.enable(0),t.supportsVertexTextures&&l.enable(1),t.instancing&&l.enable(2),t.instancingColor&&l.enable(3),t.matcap&&l.enable(4),t.envMap&&l.enable(5),t.normalMapObjectSpace&&l.enable(6),t.normalMapTangentSpace&&l.enable(7),t.clearcoat&&l.enable(8),t.iridescence&&l.enable(9),t.alphaTest&&l.enable(10),t.vertexColors&&l.enable(11),t.vertexAlphas&&l.enable(12),t.vertexUv1s&&l.enable(13),t.vertexUv2s&&l.enable(14),t.vertexUv3s&&l.enable(15),t.vertexTangents&&l.enable(16),e.push(l.mask),l.disableAll(),t.fog&&l.enable(0),t.useFog&&l.enable(1),t.flatShading&&l.enable(2),t.logarithmicDepthBuffer&&l.enable(3),t.skinning&&l.enable(4),t.morphTargets&&l.enable(5),t.morphNormals&&l.enable(6),t.morphColors&&l.enable(7),t.premultipliedAlpha&&l.enable(8),t.shadowMapEnabled&&l.enable(9),t.useLegacyLights&&l.enable(10),t.doubleSided&&l.enable(11),t.flipSided&&l.enable(12),t.useDepthPacking&&l.enable(13),t.dithering&&l.enable(14),t.transmission&&l.enable(15),t.sheen&&l.enable(16),t.opaque&&l.enable(17),t.pointsUvs&&l.enable(18),e.push(l.mask)}(i,t),i.push(e.outputColorSpace)),i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=f[e.type];let i;if(t){const e=v.ShaderLib[t];i=_.UniformsUtils.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,t=h.length;e<t;e++){const t=h[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new Rt(e,i,t,o),h.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=h.indexOf(e);h[t]=h[h.length-1],h.pop(),e.destroy()}},releaseShaderCache:function(e){c.remove(e)},programs:h,dispose:function(){c.dispose()}}}function Ft(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function Ut(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Vt(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Nt(){const e=[];let t=0;const i=[],n=[],r=[];function s(i,n,r,s,o,a){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:o,group:a},e[t]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=o,l.group=a),t++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){t=0,i.length=0,n.length=0,r.length=0},push:function(e,t,o,a,l,c){const h=s(e,t,o,a,l,c);o.transmission>0?n.push(h):!0===o.transparent?r.push(h):i.push(h)},unshift:function(e,t,o,a,l,c){const h=s(e,t,o,a,l,c);o.transmission>0?n.unshift(h):!0===o.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=t,n=e.length;i<n;i++){const t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||Ut),n.length>1&&n.sort(t||Vt),r.length>1&&r.sort(t||Vt)}}}function Bt(){let e=new WeakMap;return{get:function(t,i){const n=e.get(t);let r;return void 0===n?(r=new Nt,e.set(t,[r])):i>=n.length?(r=new Nt,n.push(r)):r=n[i],r},dispose:function(){e=new WeakMap}}}var kt=i(6729);function zt(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new o.Vector3,color:new f.Color};break;case"SpotLight":i={position:new o.Vector3,direction:new o.Vector3,color:new f.Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new o.Vector3,color:new f.Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new o.Vector3,skyColor:new f.Color,groundColor:new f.Color};break;case"RectAreaLight":i={color:new f.Color,position:new o.Vector3,halfWidth:new o.Vector3,halfHeight:new o.Vector3}}return e[t.id]=i,i}}}let Gt=0;function jt(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Ht(e,t){const i=new zt,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne.Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne.Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)r.probe.push(new o.Vector3);const a=new o.Vector3,l=new s.Matrix4,c=new s.Matrix4;return{setup:function(s,o){let a=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let h=0,u=0,d=0,m=0,p=0,f=0,g=0,v=0,_=0,y=0;s.sort(jt);const x=!0===o?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],o=t.color,S=t.intensity,b=t.distance,T=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*S*x,l+=o.g*S*x,c+=o.b*S*x;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],S);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=T,r.directionalShadowMatrix[h]=t.shadow.matrix,f++}r.directional[h]=e,h++}else if(t.isSpotLight){const e=i.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(S*x),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[d]=e;const s=t.shadow;if(t.map&&(r.spotLightMap[_]=t.map,_++,s.updateMatrices(t),t.castShadow&&y++),r.spotLightMatrix[d]=s.matrix,t.castShadow){const e=n.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=T,v++}d++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(o).multiplyScalar(S),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[m]=e,m++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=T,r.pointShadowMatrix[u]=t.shadow.matrix,g++}r.point[u]=e,u++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(S*x),e.groundColor.copy(t.groundColor).multiplyScalar(S*x),r.hemi[p]=e,p++}}m>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=kt.UniformsLib.LTC_FLOAT_1,r.rectAreaLTC2=kt.UniformsLib.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=kt.UniformsLib.LTC_HALF_1,r.rectAreaLTC2=kt.UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const S=r.hash;S.directionalLength===h&&S.pointLength===u&&S.spotLength===d&&S.rectAreaLength===m&&S.hemiLength===p&&S.numDirectionalShadows===f&&S.numPointShadows===g&&S.numSpotShadows===v&&S.numSpotMaps===_||(r.directional.length=h,r.spot.length=d,r.rectArea.length=m,r.point.length=u,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+_-y,r.spotLightMap.length=_,r.numSpotLightShadowsWithMaps=y,S.directionalLength=h,S.pointLength=u,S.spotLength=d,S.rectAreaLength=m,S.hemiLength=p,S.numDirectionalShadows=f,S.numPointShadows=g,S.numSpotShadows=v,S.numSpotMaps=_,r.version=Gt++)},setupView:function(e,t){let i=0,n=0,s=0,o=0,h=0;const u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[i];e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(u),i++}else if(d.isSpotLight){const e=r.spot[s];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(u),s++}else if(d.isRectAreaLight){const e=r.rectArea[o];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),c.identity(),l.copy(d.matrixWorld),l.premultiply(u),c.extractRotation(l),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(c),e.halfHeight.applyMatrix4(c),o++}else if(d.isPointLight){const e=r.point[n];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const e=r.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),h++}}},state:r}}function Wt(e,t){const i=new Ht(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function qt(e,t){let i=new WeakMap;return{get:function(n,r=0){const s=i.get(n);let o;return void 0===s?(o=new Wt(e,t),i.set(n,[o])):r>=s.length?(o=new Wt(e,t),s.push(o)):o=s[r],o},dispose:function(){i=new WeakMap}}}var Xt=i(4127),Kt=i(7951);class Yt extends Kt.F{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Zt(e,t,i){let s=new r.Frustum;const o=new ne.Vector2,l=new ne.Vector2,c=new a.Vector4,d=new Xt.MeshDepthMaterial({depthPacking:n.RGBADepthPacking}),m=new Yt,f={},v=i.maxTextureSize,_={[n.FrontSide]:n.BackSide,[n.BackSide]:n.FrontSide,[n.DoubleSide]:n.DoubleSide},y=new p.ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ne.Vector2},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tconst float samples = float( VSM_SAMPLES );\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\n\t\t#ifdef HORIZONTAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),x=y.clone();x.defines.HORIZONTAL_PASS=1;const S=new h.BufferGeometry;S.setAttribute("position",new u.BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new g.Mesh(S,y),T=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=n.PCFShadowMap;let M=this.type;function w(i,n){const r=t.update(b);y.defines.VSM_SAMPLES!==i.blurSamples&&(y.defines.VSM_SAMPLES=i.blurSamples,x.defines.VSM_SAMPLES=i.blurSamples,y.needsUpdate=!0,x.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new C.WebGLRenderTarget(o.x,o.y)),y.uniforms.shadow_pass.value=i.map.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,r,y,b,null),x.uniforms.shadow_pass.value=i.mapPass.texture,x.uniforms.resolution.value=i.mapSize,x.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,r,x,b,null)}function E(t,i,r,s){let o=null;const a=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)o=a;else if(o=!0===r.isPointLight?m:d,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){const e=o.uuid,t=i.uuid;let n=f[e];void 0===n&&(n={},f[e]=n);let r=n[t];void 0===r&&(r=o.clone(),n[t]=r),o=r}return o.visible=i.visible,o.wireframe=i.wireframe,s===n.VSMShadowMap?o.side=null!==i.shadowSide?i.shadowSide:i.side:o.side=null!==i.shadowSide?i.shadowSide:_[i.side],o.alphaMap=i.alphaMap,o.alphaTest=i.alphaTest,o.map=i.map,o.clipShadows=i.clipShadows,o.clippingPlanes=i.clippingPlanes,o.clipIntersection=i.clipIntersection,o.displacementMap=i.displacementMap,o.displacementScale=i.displacementScale,o.displacementBias=i.displacementBias,o.wireframeLinewidth=i.wireframeLinewidth,o.linewidth=i.linewidth,!0===r.isPointLight&&!0===o.isMeshDistanceMaterial&&(e.properties.get(o).light=r),o}function A(i,r,o,a,l){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&l===n.VSMShadowMap)&&(!i.frustumCulled||s.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);const n=t.update(i),r=i.material;if(Array.isArray(r)){const t=n.groups;for(let s=0,c=t.length;s<c;s++){const c=t[s],h=r[c.materialIndex];if(h&&h.visible){const t=E(i,h,a,l);e.renderBufferDirect(o,null,n,t,i,c)}}}else if(r.visible){const t=E(i,r,a,l);e.renderBufferDirect(o,null,n,t,i,null)}}const c=i.children;for(let e=0,t=c.length;e<t;e++)A(c[e],r,o,a,l)}this.render=function(t,i,r){if(!1===T.enabled)return;if(!1===T.autoUpdate&&!1===T.needsUpdate)return;if(0===t.length)return;const a=e.getRenderTarget(),h=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(n.NoBlending),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const m=M!==n.VSMShadowMap&&this.type===n.VSMShadowMap,p=M===n.VSMShadowMap&&this.type!==n.VSMShadowMap;for(let a=0,h=t.length;a<h;a++){const h=t[a],u=h.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;o.copy(u.mapSize);const f=u.getFrameExtents();if(o.multiply(f),l.copy(u.mapSize),(o.x>v||o.y>v)&&(o.x>v&&(l.x=Math.floor(v/f.x),o.x=l.x*f.x,u.mapSize.x=l.x),o.y>v&&(l.y=Math.floor(v/f.y),o.y=l.y*f.y,u.mapSize.y=l.y)),null===u.map||!0===m||!0===p){const e=this.type!==n.VSMShadowMap?{minFilter:n.NearestFilter,magFilter:n.NearestFilter}:{};null!==u.map&&u.map.dispose(),u.map=new C.WebGLRenderTarget(o.x,o.y,e),u.map.texture.name=h.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const g=u.getViewportCount();for(let e=0;e<g;e++){const t=u.getViewport(e);c.set(l.x*t.x,l.y*t.y,l.x*t.z,l.y*t.w),d.viewport(c),u.updateMatrices(h,e),s=u.getFrustum(),A(i,r,u.camera,h,this.type)}!0!==u.isPointLightShadow&&this.type===n.VSMShadowMap&&w(u,r),u.needsUpdate=!1}M=this.type,T.needsUpdate=!1,e.setRenderTarget(a,h,u)}}function $t(e,t,i){const r=i.isWebGL2,s=new function(){let t=!1;const i=new a.Vector4;let n=null;const r=new a.Vector4(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,s,o,a){!0===a&&(t*=o,n*=o,s*=o),i.set(t,n,s,o),!1===r.equals(i)&&(e.clearColor(t,n,s,o),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},o=new function(){let t=!1,i=null,r=null,s=null;return{setTest:function(t){t?G(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(r!==t){switch(t){case n.NeverDepth:e.depthFunc(e.NEVER);break;case n.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case n.LessDepth:e.depthFunc(e.LESS);break;case n.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case n.EqualDepth:e.depthFunc(e.EQUAL);break;case n.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case n.GreaterDepth:e.depthFunc(e.GREATER);break;case n.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){s!==t&&(e.clearDepth(t),s=t)},reset:function(){t=!1,i=null,r=null,s=null}}},l=new function(){let t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(i){t||(i?G(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,o){n===t&&r===i&&s===o||(e.stencilFunc(t,i,o),n=t,r=i,s=o)},setOp:function(t,i,n){o===t&&a===i&&l===n||(e.stencilOp(t,i,n),o=t,a=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,c=null}}},c=new WeakMap,h=new WeakMap;let u={},d={},m=new WeakMap,p=[],f=null,g=!1,v=null,_=null,y=null,x=null,S=null,b=null,T=null,M=!1,w=null,E=null,C=null,A=null,P=null;const R=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let L=!1,D=0;const I=e.getParameter(e.VERSION);-1!==I.indexOf("WebGL")?(D=parseFloat(/^WebGL (\d)/.exec(I)[1]),L=D>=1):-1!==I.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),L=D>=2);let O=null,F={};const U=e.getParameter(e.SCISSOR_BOX),V=e.getParameter(e.VIEWPORT),N=(new a.Vector4).fromArray(U),B=(new a.Vector4).fromArray(V);function k(t,i,n,s){const o=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<n;a++)!r||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(i+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(i,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,o);return a}const z={};function G(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function j(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}z[e.TEXTURE_2D]=k(e.TEXTURE_2D,e.TEXTURE_2D,1),z[e.TEXTURE_CUBE_MAP]=k(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(z[e.TEXTURE_2D_ARRAY]=k(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),z[e.TEXTURE_3D]=k(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),s.setClear(0,0,0,1),o.setClear(1),l.setClear(0),G(e.DEPTH_TEST),o.setFunc(n.LessEqualDepth),X(!1),K(n.CullFaceBack),G(e.CULL_FACE),q(n.NoBlending);const H={[n.AddEquation]:e.FUNC_ADD,[n.SubtractEquation]:e.FUNC_SUBTRACT,[n.ReverseSubtractEquation]:e.FUNC_REVERSE_SUBTRACT};if(r)H[n.MinEquation]=e.MIN,H[n.MaxEquation]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(H[n.MinEquation]=e.MIN_EXT,H[n.MaxEquation]=e.MAX_EXT)}const W={[n.ZeroFactor]:e.ZERO,[n.OneFactor]:e.ONE,[n.SrcColorFactor]:e.SRC_COLOR,[n.SrcAlphaFactor]:e.SRC_ALPHA,[n.SrcAlphaSaturateFactor]:e.SRC_ALPHA_SATURATE,[n.DstColorFactor]:e.DST_COLOR,[n.DstAlphaFactor]:e.DST_ALPHA,[n.OneMinusSrcColorFactor]:e.ONE_MINUS_SRC_COLOR,[n.OneMinusSrcAlphaFactor]:e.ONE_MINUS_SRC_ALPHA,[n.OneMinusDstColorFactor]:e.ONE_MINUS_DST_COLOR,[n.OneMinusDstAlphaFactor]:e.ONE_MINUS_DST_ALPHA};function q(t,i,r,s,o,a,l,c){if(t!==n.NoBlending){if(!1===g&&(G(e.BLEND),g=!0),t===n.CustomBlending)o=o||i,a=a||r,l=l||s,i===_&&o===S||(e.blendEquationSeparate(H[i],H[o]),_=i,S=o),r===y&&s===x&&a===b&&l===T||(e.blendFuncSeparate(W[r],W[s],W[a],W[l]),y=r,x=s,b=a,T=l),v=t,M=!1;else if(t!==v||c!==M){if(_===n.AddEquation&&S===n.AddEquation||(e.blendEquation(e.FUNC_ADD),_=n.AddEquation,S=n.AddEquation),c)switch(t){case n.NormalBlending:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case n.AdditiveBlending:e.blendFunc(e.ONE,e.ONE);break;case n.SubtractiveBlending:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case n.MultiplyBlending:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case n.NormalBlending:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case n.AdditiveBlending:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case n.SubtractiveBlending:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case n.MultiplyBlending:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}y=null,x=null,b=null,T=null,v=t,M=c}}else!0===g&&(j(e.BLEND),g=!1)}function X(t){w!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),w=t)}function K(t){t!==n.CullFaceNone?(G(e.CULL_FACE),t!==E&&(t===n.CullFaceBack?e.cullFace(e.BACK):t===n.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),E=t}function Y(t,i,n){t?(G(e.POLYGON_OFFSET_FILL),A===i&&P===n||(e.polygonOffset(i,n),A=i,P=n)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:s,depth:o,stencil:l},enable:G,disable:j,bindFramebuffer:function(t,i){return d[t]!==i&&(e.bindFramebuffer(t,i),d[t]=i,r&&(t===e.DRAW_FRAMEBUFFER&&(d[e.FRAMEBUFFER]=i),t===e.FRAMEBUFFER&&(d[e.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(n,r){let s=p,o=!1;if(n)if(s=m.get(r),void 0===s&&(s=[],m.set(r,s)),n.isWebGLMultipleRenderTargets){const t=n.texture;if(s.length!==t.length||s[0]!==e.COLOR_ATTACHMENT0){for(let i=0,n=t.length;i<n;i++)s[i]=e.COLOR_ATTACHMENT0+i;s.length=t.length,o=!0}}else s[0]!==e.COLOR_ATTACHMENT0&&(s[0]=e.COLOR_ATTACHMENT0,o=!0);else s[0]!==e.BACK&&(s[0]=e.BACK,o=!0);o&&(i.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:q,setMaterial:function(t,i){t.side===n.DoubleSide?j(e.CULL_FACE):G(e.CULL_FACE);let r=t.side===n.BackSide;i&&(r=!r),X(r),t.blending===n.NormalBlending&&!1===t.transparent?q(n.NoBlending):q(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),s.setMask(t.colorWrite);const a=t.stencilWrite;l.setTest(a),a&&(l.setMask(t.stencilWriteMask),l.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),l.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Y(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?G(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:X,setCullFace:K,setLineWidth:function(t){t!==C&&(L&&e.lineWidth(t),C=t)},setPolygonOffset:Y,setScissorTest:function(t){t?G(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+R-1),O!==t&&(e.activeTexture(t),O=t)},bindTexture:function(t,i,n){void 0===n&&(n=null===O?e.TEXTURE0+R-1:O);let r=F[n];void 0===r&&(r={type:void 0,texture:void 0},F[n]=r),r.type===t&&r.texture===i||(O!==n&&(e.activeTexture(n),O=n),e.bindTexture(t,i||z[t]),r.type=t,r.texture=i)},unbindTexture:function(){const t=F[O];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,i){let n=h.get(i);void 0===n&&(n=new WeakMap,h.set(i,n));let r=n.get(t);void 0===r&&(r=e.getUniformBlockIndex(i,t.name),n.set(t,r))},uniformBlockBinding:function(t,i){const n=h.get(i).get(t);c.get(i)!==n&&(e.uniformBlockBinding(i,n,t.__bindingPointIndex),c.set(i,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===B.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),B.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===r&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},O=null,F={},d={},m=new WeakMap,p=[],f=null,g=!1,v=null,_=null,y=null,x=null,S=null,b=null,T=null,M=!1,w=null,E=null,C=null,A=null,P=null,N.set(0,0,e.canvas.width,e.canvas.height),B.set(0,0,e.canvas.width,e.canvas.height),s.reset(),o.reset(),l.reset()}}}var Jt=i(3334),Qt=i(7300);function ei(e,t,i,r,s,o,a){const l=s.isWebGL2,c=s.maxTextures,h=s.maxCubemapSize,u=s.maxTextureSize,d=s.maxSamples,m=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let g;const v=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function y(e,t){return _?new OffscreenCanvas(e,t):(0,I.c)("canvas")}function x(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?Jt.floorPowerOfTwo:Math.floor,s=n(r*e.width),o=n(r*e.height);void 0===g&&(g=y(s,o));const a=i?y(s,o):g;return a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function S(e){return Jt.isPowerOfTwo(e.width)&&Jt.isPowerOfTwo(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==n.NearestFilter&&e.minFilter!==n.LinearFilter}function T(t){e.generateMipmap(t)}function M(i,r,s,o,a=!1){if(!1===l)return r;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let c=r;return r===e.RED&&(s===e.FLOAT&&(c=e.R32F),s===e.HALF_FLOAT&&(c=e.R16F),s===e.UNSIGNED_BYTE&&(c=e.R8)),r===e.RG&&(s===e.FLOAT&&(c=e.RG32F),s===e.HALF_FLOAT&&(c=e.RG16F),s===e.UNSIGNED_BYTE&&(c=e.RG8)),r===e.RGBA&&(s===e.FLOAT&&(c=e.RGBA32F),s===e.HALF_FLOAT&&(c=e.RGBA16F),s===e.UNSIGNED_BYTE&&(c=o===n.SRGBColorSpace&&!1===a?e.SRGB8_ALPHA8:e.RGBA8),s===e.UNSIGNED_SHORT_4_4_4_4&&(c=e.RGBA4),s===e.UNSIGNED_SHORT_5_5_5_1&&(c=e.RGB5_A1)),c!==e.R16F&&c!==e.R32F&&c!==e.RG16F&&c!==e.RG32F&&c!==e.RGBA16F&&c!==e.RGBA32F||t.get("EXT_color_buffer_float"),c}function w(e,t,i){return!0===b(e,i)||e.isFramebufferTexture&&e.minFilter!==n.NearestFilter&&e.minFilter!==n.LinearFilter?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function E(t){return t===n.NearestFilter||t===n.NearestMipmapNearestFilter||t===n.NearestMipmapLinearFilter?e.NEAREST:e.LINEAR}function C(e){const t=e.target;t.removeEventListener("dispose",C),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const i=e.source,n=v.get(i);if(n){const r=n[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&P(e),0===Object.keys(n).length&&v.delete(i)}r.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function A(t){const i=t.target;i.removeEventListener("dispose",A),function(t){const i=t.texture,n=r.get(t),s=r.get(i);if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t]);else{if(e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,n=i.length;t<n;t++){const n=r.get(i[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),a.memory.textures--),r.remove(i[t])}r.remove(i),r.remove(t)}(i)}function P(t){const i=r.get(t);e.deleteTexture(i.__webglTexture);const n=t.source;delete v.get(n)[i.__cacheKey],a.memory.textures--}let R=0;function L(t,n){const s=r.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void V(s,t,n);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+n)}const D={[n.RepeatWrapping]:e.REPEAT,[n.ClampToEdgeWrapping]:e.CLAMP_TO_EDGE,[n.MirroredRepeatWrapping]:e.MIRRORED_REPEAT},O={[n.NearestFilter]:e.NEAREST,[n.NearestMipmapNearestFilter]:e.NEAREST_MIPMAP_NEAREST,[n.NearestMipmapLinearFilter]:e.NEAREST_MIPMAP_LINEAR,[n.LinearFilter]:e.LINEAR,[n.LinearMipmapNearestFilter]:e.LINEAR_MIPMAP_NEAREST,[n.LinearMipmapLinearFilter]:e.LINEAR_MIPMAP_LINEAR};function F(i,o,a){if(a?(e.texParameteri(i,e.TEXTURE_WRAP_S,D[o.wrapS]),e.texParameteri(i,e.TEXTURE_WRAP_T,D[o.wrapT]),i!==e.TEXTURE_3D&&i!==e.TEXTURE_2D_ARRAY||e.texParameteri(i,e.TEXTURE_WRAP_R,D[o.wrapR]),e.texParameteri(i,e.TEXTURE_MAG_FILTER,O[o.magFilter]),e.texParameteri(i,e.TEXTURE_MIN_FILTER,O[o.minFilter])):(e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i!==e.TEXTURE_3D&&i!==e.TEXTURE_2D_ARRAY||e.texParameteri(i,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),o.wrapS===n.ClampToEdgeWrapping&&o.wrapT===n.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,e.TEXTURE_MAG_FILTER,E(o.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,E(o.minFilter)),o.minFilter!==n.NearestFilter&&o.minFilter!==n.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(o.magFilter===n.NearestFilter)return;if(o.minFilter!==n.NearestMipmapLinearFilter&&o.minFilter!==n.LinearMipmapLinearFilter)return;if(o.type===n.FloatType&&!1===t.has("OES_texture_float_linear"))return;if(!1===l&&o.type===n.HalfFloatType&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,s.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function U(t,i){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",C));const r=i.source;let s=v.get(r);void 0===s&&(s={},v.set(r,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(i);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&P(i)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return n}function V(t,s,a){let c=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(c=e.TEXTURE_3D);const h=U(t,s),d=s.source;i.bindTexture(c,t.__webglTexture,e.TEXTURE0+a);const m=r.get(d);if(d.version!==m.__version||!0===h){i.activeTexture(e.TEXTURE0+a),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=function(e){return!l&&(e.wrapS!==n.ClampToEdgeWrapping||e.wrapT!==n.ClampToEdgeWrapping||e.minFilter!==n.NearestFilter&&e.minFilter!==n.LinearFilter)}(s)&&!1===S(s.image);let r=x(s.image,t,!1,u);r=j(s,r);const p=S(r)||l,f=o.convert(s.format,s.colorSpace);let g,v=o.convert(s.type),_=M(s.internalFormat,f,v,s.colorSpace);F(c,s,p);const y=s.mipmaps,E=l&&!0!==s.isVideoTexture,C=void 0===m.__version||!0===h,A=w(s,r,p);if(s.isDepthTexture)_=e.DEPTH_COMPONENT,l?_=s.type===n.FloatType?e.DEPTH_COMPONENT32F:s.type===n.UnsignedIntType?e.DEPTH_COMPONENT24:s.type===n.UnsignedInt248Type?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:s.type===n.FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),s.format===n.DepthFormat&&_===e.DEPTH_COMPONENT&&s.type!==n.UnsignedShortType&&s.type!==n.UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=n.UnsignedIntType,v=o.convert(s.type)),s.format===n.DepthStencilFormat&&_===e.DEPTH_COMPONENT&&(_=e.DEPTH_STENCIL,s.type!==n.UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=n.UnsignedInt248Type,v=o.convert(s.type))),C&&(E?i.texStorage2D(e.TEXTURE_2D,1,_,r.width,r.height):i.texImage2D(e.TEXTURE_2D,0,_,r.width,r.height,0,f,v,null));else if(s.isDataTexture)if(y.length>0&&p){E&&C&&i.texStorage2D(e.TEXTURE_2D,A,_,y[0].width,y[0].height);for(let t=0,n=y.length;t<n;t++)g=y[t],E?i.texSubImage2D(e.TEXTURE_2D,t,0,0,g.width,g.height,f,v,g.data):i.texImage2D(e.TEXTURE_2D,t,_,g.width,g.height,0,f,v,g.data);s.generateMipmaps=!1}else E?(C&&i.texStorage2D(e.TEXTURE_2D,A,_,r.width,r.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,f,v,r.data)):i.texImage2D(e.TEXTURE_2D,0,_,r.width,r.height,0,f,v,r.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){E&&C&&i.texStorage3D(e.TEXTURE_2D_ARRAY,A,_,y[0].width,y[0].height,r.depth);for(let t=0,o=y.length;t<o;t++)g=y[t],s.format!==n.RGBAFormat?null!==f?E?i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,g.width,g.height,r.depth,f,g.data,0,0):i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,_,g.width,g.height,r.depth,0,g.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?i.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,g.width,g.height,r.depth,f,v,g.data):i.texImage3D(e.TEXTURE_2D_ARRAY,t,_,g.width,g.height,r.depth,0,f,v,g.data)}else{E&&C&&i.texStorage2D(e.TEXTURE_2D,A,_,y[0].width,y[0].height);for(let t=0,r=y.length;t<r;t++)g=y[t],s.format!==n.RGBAFormat?null!==f?E?i.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,g.width,g.height,f,g.data):i.compressedTexImage2D(e.TEXTURE_2D,t,_,g.width,g.height,0,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?i.texSubImage2D(e.TEXTURE_2D,t,0,0,g.width,g.height,f,v,g.data):i.texImage2D(e.TEXTURE_2D,t,_,g.width,g.height,0,f,v,g.data)}else if(s.isDataArrayTexture)E?(C&&i.texStorage3D(e.TEXTURE_2D_ARRAY,A,_,r.width,r.height,r.depth),i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,r.width,r.height,r.depth,f,v,r.data)):i.texImage3D(e.TEXTURE_2D_ARRAY,0,_,r.width,r.height,r.depth,0,f,v,r.data);else if(s.isData3DTexture)E?(C&&i.texStorage3D(e.TEXTURE_3D,A,_,r.width,r.height,r.depth),i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,r.width,r.height,r.depth,f,v,r.data)):i.texImage3D(e.TEXTURE_3D,0,_,r.width,r.height,r.depth,0,f,v,r.data);else if(s.isFramebufferTexture){if(C)if(E)i.texStorage2D(e.TEXTURE_2D,A,_,r.width,r.height);else{let t=r.width,n=r.height;for(let r=0;r<A;r++)i.texImage2D(e.TEXTURE_2D,r,_,t,n,0,f,v,null),t>>=1,n>>=1}}else if(y.length>0&&p){E&&C&&i.texStorage2D(e.TEXTURE_2D,A,_,y[0].width,y[0].height);for(let t=0,n=y.length;t<n;t++)g=y[t],E?i.texSubImage2D(e.TEXTURE_2D,t,0,0,f,v,g):i.texImage2D(e.TEXTURE_2D,t,_,f,v,g);s.generateMipmaps=!1}else E?(C&&i.texStorage2D(e.TEXTURE_2D,A,_,r.width,r.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,f,v,r)):i.texImage2D(e.TEXTURE_2D,0,_,f,v,r);b(s,p)&&T(c),m.__version=d.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function N(t,n,s,a,l){const c=o.convert(s.format,s.colorSpace),h=o.convert(s.type),u=M(s.internalFormat,c,h,s.colorSpace);r.get(n).__hasExternalTextures||(l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?i.texImage3D(l,0,u,n.width,n.height,n.depth,0,c,h,null):i.texImage2D(l,0,u,n.width,n.height,0,c,h,null)),i.bindFramebuffer(e.FRAMEBUFFER,t),G(n)?m.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,a,l,r.get(s).__webglTexture,0,z(n)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,a,l,r.get(s).__webglTexture,0),i.bindFramebuffer(e.FRAMEBUFFER,null)}function B(t,i,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer){let s=e.DEPTH_COMPONENT16;if(r||G(i)){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===n.FloatType?s=e.DEPTH_COMPONENT32F:t.type===n.UnsignedIntType&&(s=e.DEPTH_COMPONENT24));const r=z(i);G(i)?m.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,s,i.width,i.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,r,s,i.width,i.height)}else e.renderbufferStorage(e.RENDERBUFFER,s,i.width,i.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(i.depthBuffer&&i.stencilBuffer){const n=z(i);r&&!1===G(i)?e.renderbufferStorageMultisample(e.RENDERBUFFER,n,e.DEPTH24_STENCIL8,i.width,i.height):G(i)?m.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,n,e.DEPTH24_STENCIL8,i.width,i.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let n=0;n<t.length;n++){const s=t[n],a=o.convert(s.format,s.colorSpace),l=o.convert(s.type),c=M(s.internalFormat,a,l,s.colorSpace),h=z(i);r&&!1===G(i)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,c,i.width,i.height):G(i)?m.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,c,i.width,i.height):e.renderbufferStorage(e.RENDERBUFFER,c,i.width,i.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function k(t){const s=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!s.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,t),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),L(s.depthTexture,0);const o=r.get(s.depthTexture).__webglTexture,a=z(s);if(s.depthTexture.format===n.DepthFormat)G(s)?m.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(s.depthTexture.format!==n.DepthStencilFormat)throw new Error("Unknown depthTexture format");G(s)?m.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(s.__webglFramebuffer,t)}else if(o){s.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer[n]),s.__webglDepthbuffer[n]=e.createRenderbuffer(),B(s.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer),s.__webglDepthbuffer=e.createRenderbuffer(),B(s.__webglDepthbuffer,t,!1);i.bindFramebuffer(e.FRAMEBUFFER,null)}function z(e){return Math.min(d,e.samples)}function G(e){const i=r.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function j(e,i){const r=e.colorSpace,s=e.format,o=e.type;return!0===e.isCompressedTexture||e.format===n._SRGBAFormat||r!==n.LinearSRGBColorSpace&&r!==n.NoColorSpace&&(r===n.SRGBColorSpace?!1===l?!0===t.has("EXT_sRGB")&&s===n.RGBAFormat?(e.format=n._SRGBAFormat,e.minFilter=n.LinearFilter,e.generateMipmaps=!1):i=Qt.P.sRGBToLinear(i):s===n.RGBAFormat&&o===n.UnsignedByteType||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),i}this.allocateTextureUnit=function(){const e=R;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),R+=1,e},this.resetTextureUnits=function(){R=0},this.setTexture2D=L,this.setTexture2DArray=function(t,n){const s=r.get(t);t.version>0&&s.__version!==t.version?V(s,t,n):i.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+n)},this.setTexture3D=function(t,n){const s=r.get(t);t.version>0&&s.__version!==t.version?V(s,t,n):i.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+n)},this.setTextureCube=function(t,s){const a=r.get(t);t.version>0&&a.__version!==t.version?function(t,s,a){if(6!==s.image.length)return;const c=U(t,s),u=s.source;i.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const d=r.get(u);if(u.version!==d.__version||!0===c){i.activeTexture(e.TEXTURE0+a),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=s.isCompressedTexture||s.image[0].isCompressedTexture,r=s.image[0]&&s.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=t||r?r?s.image[e].image:s.image[e]:x(s.image[e],!1,!0,h),m[e]=j(s,m[e]);const p=m[0],f=S(p)||l,g=o.convert(s.format,s.colorSpace),v=o.convert(s.type),_=M(s.internalFormat,g,v,s.colorSpace),y=l&&!0!==s.isVideoTexture,E=void 0===d.__version||!0===c;let C,A=w(s,p,f);if(F(e.TEXTURE_CUBE_MAP,s,f),t){y&&E&&i.texStorage2D(e.TEXTURE_CUBE_MAP,A,_,p.width,p.height);for(let t=0;t<6;t++){C=m[t].mipmaps;for(let r=0;r<C.length;r++){const o=C[r];s.format!==n.RGBAFormat?null!==g?y?i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,o.width,o.height,g,o.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):y?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,o.width,o.height,g,v,o.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,o.width,o.height,0,g,v,o.data)}}}else{C=s.mipmaps,y&&E&&(C.length>0&&A++,i.texStorage2D(e.TEXTURE_CUBE_MAP,A,_,m[0].width,m[0].height));for(let t=0;t<6;t++)if(r){y?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,g,v,m[t].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,m[t].width,m[t].height,0,g,v,m[t].data);for(let n=0;n<C.length;n++){const r=C[n].image[t].image;y?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,0,0,r.width,r.height,g,v,r.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,_,r.width,r.height,0,g,v,r.data)}}else{y?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,g,v,m[t]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,g,v,m[t]);for(let n=0;n<C.length;n++){const r=C[n];y?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,0,0,g,v,r.image[t]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,_,g,v,r.image[t])}}}b(s,f)&&T(e.TEXTURE_CUBE_MAP),d.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(a,t,s):i.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,i,n){const s=r.get(t);void 0!==i&&N(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),void 0!==n&&k(t)},this.setupRenderTarget=function(t){const n=t.texture,c=r.get(t),h=r.get(n);t.addEventListener("dispose",A),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=n.version,a.memory.textures++);const u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,m=S(t)||l;if(u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),d)if(s.drawBuffers){const i=t.texture;for(let t=0,n=i.length;t<n;t++){const n=r.get(i[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&t.samples>0&&!1===G(t)){const r=d?n:[n];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let i=0;i<r.length;i++){const n=r[i];c.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[i]);const s=o.convert(n.format,n.colorSpace),a=o.convert(n.type),l=M(n.internalFormat,s,a,n.colorSpace,!0===t.isXRRenderTarget),h=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,h,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,c.__webglColorRenderbuffer[i])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),B(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){i.bindTexture(e.TEXTURE_CUBE_MAP,h.__webglTexture),F(e.TEXTURE_CUBE_MAP,n,m);for(let i=0;i<6;i++)N(c.__webglFramebuffer[i],t,n,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i);b(n,m)&&T(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){const n=t.texture;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r.get(o);i.bindTexture(e.TEXTURE_2D,a.__webglTexture),F(e.TEXTURE_2D,o,m),N(c.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D),b(o,m)&&T(e.TEXTURE_2D)}i.unbindTexture()}else{let r=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(r,h.__webglTexture),F(r,n,m),N(c.__webglFramebuffer,t,n,e.COLOR_ATTACHMENT0,r),b(n,m)&&T(r),i.unbindTexture()}t.depthBuffer&&k(t)},this.updateRenderTargetMipmap=function(t){const n=S(t)||l,s=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let o=0,a=s.length;o<a;o++){const a=s[o];if(b(a,n)){const n=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=r.get(a).__webglTexture;i.bindTexture(n,s),T(n),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===G(t)){const n=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,o=t.height;let a=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=r.get(t),u=!0===t.isWebGLMultipleRenderTargets;if(u)for(let t=0;t<n.length;t++)i.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let i=0;i<n.length;i++){l.push(e.COLOR_ATTACHMENT0+i),t.depthBuffer&&l.push(c);const d=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),u&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer[i]),!0===d&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),u){const t=r.get(n[i]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,o,0,0,s,o,a,e.NEAREST),p&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),u)for(let t=0;t<n.length;t++){i.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,h.__webglColorRenderbuffer[t]);const s=r.get(n[t]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=k,this.setupFrameBufferTexture=N,this.useMultisampledRTT=G}function ti(e,t,i){const r=i.isWebGL2;return{convert:function(i,s=n.NoColorSpace){let o;if(i===n.UnsignedByteType)return e.UNSIGNED_BYTE;if(i===n.UnsignedShort4444Type)return e.UNSIGNED_SHORT_4_4_4_4;if(i===n.UnsignedShort5551Type)return e.UNSIGNED_SHORT_5_5_5_1;if(i===n.ByteType)return e.BYTE;if(i===n.ShortType)return e.SHORT;if(i===n.UnsignedShortType)return e.UNSIGNED_SHORT;if(i===n.IntType)return e.INT;if(i===n.UnsignedIntType)return e.UNSIGNED_INT;if(i===n.FloatType)return e.FLOAT;if(i===n.HalfFloatType)return r?e.HALF_FLOAT:(o=t.get("OES_texture_half_float"),null!==o?o.HALF_FLOAT_OES:null);if(i===n.AlphaFormat)return e.ALPHA;if(i===n.RGBAFormat)return e.RGBA;if(i===n.LuminanceFormat)return e.LUMINANCE;if(i===n.LuminanceAlphaFormat)return e.LUMINANCE_ALPHA;if(i===n.DepthFormat)return e.DEPTH_COMPONENT;if(i===n.DepthStencilFormat)return e.DEPTH_STENCIL;if(i===n._SRGBAFormat)return o=t.get("EXT_sRGB"),null!==o?o.SRGB_ALPHA_EXT:null;if(i===n.RedFormat)return e.RED;if(i===n.RedIntegerFormat)return e.RED_INTEGER;if(i===n.RGFormat)return e.RG;if(i===n.RGIntegerFormat)return e.RG_INTEGER;if(i===n.RGBAIntegerFormat)return e.RGBA_INTEGER;if(i===n.RGB_S3TC_DXT1_Format||i===n.RGBA_S3TC_DXT1_Format||i===n.RGBA_S3TC_DXT3_Format||i===n.RGBA_S3TC_DXT5_Format)if(s===n.SRGBColorSpace){if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===o)return null;if(i===n.RGB_S3TC_DXT1_Format)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===n.RGBA_S3TC_DXT1_Format)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===n.RGBA_S3TC_DXT3_Format)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===n.RGBA_S3TC_DXT5_Format)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(o=t.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(i===n.RGB_S3TC_DXT1_Format)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===n.RGBA_S3TC_DXT1_Format)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===n.RGBA_S3TC_DXT3_Format)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===n.RGBA_S3TC_DXT5_Format)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===n.RGB_PVRTC_4BPPV1_Format||i===n.RGB_PVRTC_2BPPV1_Format||i===n.RGBA_PVRTC_4BPPV1_Format||i===n.RGBA_PVRTC_2BPPV1_Format){if(o=t.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(i===n.RGB_PVRTC_4BPPV1_Format)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===n.RGB_PVRTC_2BPPV1_Format)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===n.RGBA_PVRTC_4BPPV1_Format)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===n.RGBA_PVRTC_2BPPV1_Format)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===n.RGB_ETC1_Format)return o=t.get("WEBGL_compressed_texture_etc1"),null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===n.RGB_ETC2_Format||i===n.RGBA_ETC2_EAC_Format){if(o=t.get("WEBGL_compressed_texture_etc"),null===o)return null;if(i===n.RGB_ETC2_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(i===n.RGBA_ETC2_EAC_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(i===n.RGBA_ASTC_4x4_Format||i===n.RGBA_ASTC_5x4_Format||i===n.RGBA_ASTC_5x5_Format||i===n.RGBA_ASTC_6x5_Format||i===n.RGBA_ASTC_6x6_Format||i===n.RGBA_ASTC_8x5_Format||i===n.RGBA_ASTC_8x6_Format||i===n.RGBA_ASTC_8x8_Format||i===n.RGBA_ASTC_10x5_Format||i===n.RGBA_ASTC_10x6_Format||i===n.RGBA_ASTC_10x8_Format||i===n.RGBA_ASTC_10x10_Format||i===n.RGBA_ASTC_12x10_Format||i===n.RGBA_ASTC_12x12_Format){if(o=t.get("WEBGL_compressed_texture_astc"),null===o)return null;if(i===n.RGBA_ASTC_4x4_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===n.RGBA_ASTC_5x4_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===n.RGBA_ASTC_5x5_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===n.RGBA_ASTC_6x5_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===n.RGBA_ASTC_6x6_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===n.RGBA_ASTC_8x5_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===n.RGBA_ASTC_8x6_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===n.RGBA_ASTC_8x8_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===n.RGBA_ASTC_10x5_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===n.RGBA_ASTC_10x6_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===n.RGBA_ASTC_10x8_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===n.RGBA_ASTC_10x10_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===n.RGBA_ASTC_12x10_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===n.RGBA_ASTC_12x12_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===n.RGBA_BPTC_Format){if(o=t.get("EXT_texture_compression_bptc"),null===o)return null;if(i===n.RGBA_BPTC_Format)return s===n.SRGBColorSpace?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(i===n.RED_RGTC1_Format||i===n.SIGNED_RED_RGTC1_Format||i===n.RED_GREEN_RGTC2_Format||i===n.SIGNED_RED_GREEN_RGTC2_Format){if(o=t.get("EXT_texture_compression_rgtc"),null===o)return null;if(i===n.RGBA_BPTC_Format)return o.COMPRESSED_RED_RGTC1_EXT;if(i===n.SIGNED_RED_RGTC1_Format)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===n.RED_GREEN_RGTC2_Format)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===n.SIGNED_RED_GREEN_RGTC2_Format)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===n.UnsignedInt248Type?r?e.UNSIGNED_INT_24_8:(o=t.get("WEBGL_depth_texture"),null!==o?o.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[i]?e[i]:null}}}class ii extends P.PerspectiveCamera{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}var ni=i(2356);class ri extends A.Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const si={type:"move"};class oi{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ri,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ri,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new o.Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new o.Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ri,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new o.Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new o.Vector3),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,i),r=this._getHandJoint(l,n);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(n=t.getPose(e.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(si)))}return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new ri;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class ai extends te.Texture{constructor(e,t,i,r,s,o,a,l,c,h){if((h=void 0!==h?h:n.DepthFormat)!==n.DepthFormat&&h!==n.DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===n.DepthFormat&&(i=n.UnsignedIntType),void 0===i&&h===n.DepthStencilFormat&&(i=n.UnsignedInt248Type),super(null,r,s,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:n.NearestFilter,this.minFilter=void 0!==l?l:n.NearestFilter,this.flipY=!1,this.generateMipmaps=!1}}class li extends ni.EventDispatcher{constructor(e,t){super();const i=this;let r=null,s=1,c=null,h="local-floor",u=1,d=null,m=null,p=null,f=null,g=null,v=null;const _=t.getContextAttributes();let y=null,x=null;const S=[],b=[],T=new Set,M=new Map,w=new P.PerspectiveCamera;w.layers.enable(1),w.viewport=new a.Vector4;const E=new P.PerspectiveCamera;E.layers.enable(2),E.viewport=new a.Vector4;const A=[w,E],R=new ii;R.layers.enable(1),R.layers.enable(2);let L=null,D=null;function I(e){const t=b.indexOf(e.inputSource);if(-1===t)return;const i=S[t];void 0!==i&&i.dispatchEvent({type:e.type,data:e.inputSource})}function O(){r.removeEventListener("select",I),r.removeEventListener("selectstart",I),r.removeEventListener("selectend",I),r.removeEventListener("squeeze",I),r.removeEventListener("squeezestart",I),r.removeEventListener("squeezeend",I),r.removeEventListener("end",O),r.removeEventListener("inputsourceschange",F);for(let e=0;e<S.length;e++){const t=b[e];null!==t&&(b[e]=null,S[e].disconnect(t))}L=null,D=null,e.setRenderTarget(y),g=null,f=null,p=null,r=null,x=null,k.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function F(e){for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=b.indexOf(i);n>=0&&(b[n]=null,S[n].disconnect(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t];let n=b.indexOf(i);if(-1===n){for(let e=0;e<S.length;e++){if(e>=b.length){b.push(i),n=e;break}if(null===b[e]){b[e]=i,n=e;break}}if(-1===n)break}const r=S[n];r&&r.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=S[e];return void 0===t&&(t=new oi,S[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=S[e];return void 0===t&&(t=new oi,S[e]=t),t.getGripSpace()},this.getHand=function(e){let t=S[e];return void 0===t&&(t=new oi,S[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){h=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||c},this.setReferenceSpace=function(e){d=e},this.getBaseLayer=function(){return null!==f?f:g},this.getBinding=function(){return p},this.getFrame=function(){return v},this.getSession=function(){return r},this.setSession=async function(o){if(r=o,null!==r){if(y=e.getRenderTarget(),r.addEventListener("select",I),r.addEventListener("selectstart",I),r.addEventListener("selectend",I),r.addEventListener("squeeze",I),r.addEventListener("squeezestart",I),r.addEventListener("squeezeend",I),r.addEventListener("end",O),r.addEventListener("inputsourceschange",F),!0!==_.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const i={antialias:void 0!==r.renderState.layers||_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};g=new XRWebGLLayer(r,t,i),r.updateRenderState({baseLayer:g}),x=new C.WebGLRenderTarget(g.framebufferWidth,g.framebufferHeight,{format:n.RGBAFormat,type:n.UnsignedByteType,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})}else{let i=null,o=null,a=null;_.depth&&(a=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,i=_.stencil?n.DepthStencilFormat:n.DepthFormat,o=_.stencil?n.UnsignedInt248Type:n.UnsignedIntType);const l={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:s};p=new XRWebGLBinding(r,t),f=p.createProjectionLayer(l),r.updateRenderState({layers:[f]}),x=new C.WebGLRenderTarget(f.textureWidth,f.textureHeight,{format:n.RGBAFormat,type:n.UnsignedByteType,depthTexture:new ai(f.textureWidth,f.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0}),e.properties.get(x).__ignoreDepthValues=f.ignoreDepthValues}x.isXRRenderTarget=!0,this.setFoveation(u),d=null,c=await r.requestReferenceSpace(h),k.setContext(r),k.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const U=new o.Vector3,V=new o.Vector3;function N(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;R.near=E.near=w.near=e.near,R.far=E.far=w.far=e.far,L===R.near&&D===R.far||(r.updateRenderState({depthNear:R.near,depthFar:R.far}),L=R.near,D=R.far);const t=e.parent,i=R.cameras;N(R,t);for(let e=0;e<i.length;e++)N(i[e],t);2===i.length?function(e,t,i){U.setFromMatrixPosition(t.matrixWorld),V.setFromMatrixPosition(i.matrixWorld);const n=U.distanceTo(V),r=t.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,m=o*u,p=n/(-h+u),f=p*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+p,v=a+p,_=d-f,y=m+(n-f),x=l*a/v*g,S=c*a/v*g;e.projectionMatrix.makePerspective(_,y,x,S,g,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(R,w,E):R.projectionMatrix.copy(w.projectionMatrix),function(e,t,i){null===i?e.matrix.copy(t.matrixWorld):(e.matrix.copy(i.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0);const n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Jt.RAD2DEG*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,R,t)},this.getCamera=function(){return R},this.getFoveation=function(){if(null!==f||null!==g)return u},this.setFoveation=function(e){u=e,null!==f&&(f.fixedFoveation=e),null!==g&&void 0!==g.fixedFoveation&&(g.fixedFoveation=e)},this.getPlanes=function(){return T};let B=null;const k=new l;k.setAnimationLoop((function(t,n){if(m=n.getViewerPose(d||c),v=n,null!==m){const t=m.views;null!==g&&(e.setRenderTargetFramebuffer(x,g.framebuffer),e.setRenderTarget(x));let i=!1;t.length!==R.cameras.length&&(R.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){const r=t[n];let s=null;if(null!==g)s=g.getViewport(r);else{const t=p.getViewSubImage(f,r);s=t.viewport,0===n&&(e.setRenderTargetTextures(x,t.colorTexture,f.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(x))}let o=A[n];void 0===o&&(o=new P.PerspectiveCamera,o.layers.enable(n),o.viewport=new a.Vector4,A[n]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===n&&(R.matrix.copy(o.matrix),R.matrix.decompose(R.position,R.quaternion,R.scale)),!0===i&&R.cameras.push(o)}}for(let e=0;e<S.length;e++){const t=b[e],i=S[e];null!==t&&void 0!==i&&i.update(t,n,d||c)}if(B&&B(t,n),n.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:n.detectedPlanes});let e=null;for(const t of T)n.detectedPlanes.has(t)||(null===e&&(e=[]),e.push(t));if(null!==e)for(const t of e)T.delete(t),M.delete(t),i.dispatchEvent({type:"planeremoved",data:t});for(const e of n.detectedPlanes)if(T.has(e)){const t=M.get(e);e.lastChangedTime>t&&(M.set(e,e.lastChangedTime),i.dispatchEvent({type:"planechanged",data:e}))}else T.add(e),M.set(e,n.lastChangedTime),i.dispatchEvent({type:"planeadded",data:e})}v=null})),this.setAnimationLoop=function(e){B=e},this.dispose=function(){}}}function ci(e,t){function i(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,s){r.opacity.value=s.opacity,s.color&&r.diffuse.value.copy(s.color),s.emissive&&r.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),s.map&&(r.map.value=s.map,i(s.map,r.mapTransform)),s.alphaMap&&(r.alphaMap.value=s.alphaMap,i(s.alphaMap,r.alphaMapTransform)),s.bumpMap&&(r.bumpMap.value=s.bumpMap,i(s.bumpMap,r.bumpMapTransform),r.bumpScale.value=s.bumpScale,s.side===n.BackSide&&(r.bumpScale.value*=-1)),s.normalMap&&(r.normalMap.value=s.normalMap,i(s.normalMap,r.normalMapTransform),r.normalScale.value.copy(s.normalScale),s.side===n.BackSide&&r.normalScale.value.negate()),s.displacementMap&&(r.displacementMap.value=s.displacementMap,i(s.displacementMap,r.displacementMapTransform),r.displacementScale.value=s.displacementScale,r.displacementBias.value=s.displacementBias),s.emissiveMap&&(r.emissiveMap.value=s.emissiveMap,i(s.emissiveMap,r.emissiveMapTransform)),s.specularMap&&(r.specularMap.value=s.specularMap,i(s.specularMap,r.specularMapTransform)),s.alphaTest>0&&(r.alphaTest.value=s.alphaTest);const o=t.get(s).envMap;if(o&&(r.envMap.value=o,r.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,r.reflectivity.value=s.reflectivity,r.ior.value=s.ior,r.refractionRatio.value=s.refractionRatio),s.lightMap){r.lightMap.value=s.lightMap;const t=!0===e.useLegacyLights?Math.PI:1;r.lightMapIntensity.value=s.lightMapIntensity*t,i(s.lightMap,r.lightMapTransform)}s.aoMap&&(r.aoMap.value=s.aoMap,r.aoMapIntensity.value=s.aoMapIntensity,i(s.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(t,i){i.color.getRGB(t.fogColor.value,(0,_.getUnlitUniformColorSpace)(e)),i.isFog?(t.fogNear.value=i.near,t.fogFar.value=i.far):i.isFogExp2&&(t.fogDensity.value=i.density)},refreshMaterialUniforms:function(e,s,o,a,l){s.isMeshBasicMaterial||s.isMeshLambertMaterial?r(e,s):s.isMeshToonMaterial?(r(e,s),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,s)):s.isMeshPhongMaterial?(r(e,s),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,s)):s.isMeshStandardMaterial?(r(e,s),function(e,n){e.metalness.value=n.metalness,n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap,i(n.metalnessMap,e.metalnessMapTransform)),e.roughness.value=n.roughness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap,i(n.roughnessMap,e.roughnessMapTransform));t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,s),s.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,i(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,i(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,i(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,i(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,i(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===n.BackSide&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,i(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,i(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,i(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,i(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,i(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,i(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,s,l)):s.isMeshMatcapMaterial?(r(e,s),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,s)):s.isMeshDepthMaterial?r(e,s):s.isMeshDistanceMaterial?(r(e,s),function(e,i){const n=t.get(i).light;e.referencePosition.value.setFromMatrixPosition(n.matrixWorld),e.nearDistance.value=n.shadow.camera.near,e.farDistance.value=n.shadow.camera.far}(e,s)):s.isMeshNormalMaterial?r(e,s):s.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,i(t.map,e.mapTransform))}(e,s),s.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,s)):s.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map,i(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,s,o,a):s.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,i(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,s):s.isShadowMaterial?(e.color.value.copy(s.color),e.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function hi(e,t,i,n){let r={},s={},o=[];const a=i.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,i){const n=e.value;if(void 0===i[t]){if("number"==typeof n)i[t]=n;else{const e=Array.isArray(n)?n:[n],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());i[t]=r}return!0}if("number"==typeof n){if(i[t]!==n)return i[t]=n,!0}else{const e=Array.isArray(i[t])?i[t]:[i[t]],r=Array.isArray(n)?n:[n];for(let t=0;t<e.length;t++){const i=e[t];if(!1===i.equals(r[t]))return i.copy(r[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function h(t){const i=t.target;i.removeEventListener("dispose",h);const n=o.indexOf(i.__bindingPointIndex);o.splice(n,1),e.deleteBuffer(r[i.id]),delete r[i.id],delete s[i.id]}return{bind:function(e,t){const i=t.program;n.uniformBlockBinding(e,i)},update:function(i,u){let d=r[i.id];void 0===d&&(function(e){const t=e.uniforms;let i=0;let n=0;for(let e=0,r=t.length;e<r;e++){const r=t[e],s={boundary:0,storage:0},o=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]);s.boundary+=t.boundary,s.storage+=t.storage}r.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=i,e>0&&(n=i%16,0!==n&&16-n-s.boundary<0&&(i+=16-n,r.__offset=i)),i+=s.storage}n=i%16,n>0&&(i+=16-n),e.__size=i,e.__cache={}}(i),d=function(t){const i=function(){for(let e=0;e<a;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=i;const n=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,r,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,i,n),n}(i),r[i.id]=d,i.addEventListener("dispose",h));const m=u.program;n.updateUBOMapping(i,m);const p=t.render.frame;s[i.id]!==p&&(function(t){const i=r[t.id],n=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,i);for(let t=0,i=n.length;t<i;t++){const i=n[t];if(!0===l(i,t,s)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let s=0;s<n.length;s++){const o=n[s],a=c(o);"number"==typeof o?(i.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=o.elements[0],i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=o.elements[0],i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=o.elements[0]):(o.toArray(i.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(i),s[i.id]=p)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);o=[],r={},s={}}}}function ui(){const e=(0,I.c)("canvas");return e.style.display="block",e}class di{constructor(e={}){const{canvas:t=ui(),context:i=null,depth:h=!0,stencil:u=!0,alpha:d=!1,antialias:m=!1,premultipliedAlpha:p=!0,preserveDrawingBuffer:f=!1,powerPreference:g="default",failIfMajorPerformanceCaveat:v=!1}=e;let _;this.isWebGLRenderer=!0,_=null!==i?i.getContextAttributes().alpha:d;let y=null,M=null;const w=[],A=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=n.SRGBColorSpace,this.useLegacyLights=!0,this.toneMapping=n.NoToneMapping,this.toneMappingExposure=1;const P=this;let R=!1,L=0,D=0,I=null,O=-1,U=null;const V=new a.Vector4,N=new a.Vector4;let B=null,k=t.width,z=t.height,G=1,j=null,H=null;const W=new a.Vector4(0,0,k,z),q=new a.Vector4(0,0,k,z);let X=!1;const K=new r.Frustum;let Y=!1,te=!1,ie=null;const ne=new s.Matrix4,re=new o.Vector3,se={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function le(){return null===I?G:1}let ce,he,ue,de,me,pe,fe,ge,ve,_e,ye,xe,Se,be,Te,Me,we,Ee,Ce,Ae,Pe,Re,Le,De,Ie=i;function Oe(e,i){for(let n=0;n<e.length;n++){const r=e[n],s=t.getContext(r,i);if(null!==s)return s}return null}try{const e={alpha:!0,depth:h,stencil:u,antialias:m,premultipliedAlpha:p,preserveDrawingBuffer:f,powerPreference:g,failIfMajorPerformanceCaveat:v};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${n.REVISION}`),t.addEventListener("webglcontextlost",Ve,!1),t.addEventListener("webglcontextrestored",Ne,!1),t.addEventListener("webglcontextcreationerror",Be,!1),null===Ie){const t=["webgl2","webgl","experimental-webgl"];if(!0===P.isWebGL1Renderer&&t.shift(),Ie=Oe(t,e),null===Ie)throw Oe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Ie.getShaderPrecisionFormat&&(Ie.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Fe(){ce=new $(Ie),he=new T(Ie,ce,e),ce.init(he),Re=new ti(Ie,ce,he),ue=new $t(Ie,ce,he),de=new ee(Ie),me=new Ft,pe=new ei(Ie,ce,ue,me,he,Re,de),fe=new F(P),ge=new Z(P),ve=new c(Ie,he),Le=new S(Ie,ce,ve,he),_e=new J(Ie,ve,de,Le),ye=new ae(Ie,_e,ve,de),Ce=new oe(Ie,he,pe),Me=new E(me),xe=new Ot(P,fe,ge,ce,he,Le,Me),Se=new ci(P,me),be=new Bt,Te=new qt(ce,he),Ee=new x(P,fe,ge,ue,ye,_,p),we=new Zt(P,ye,he),De=new hi(Ie,de,he,ue),Ae=new b(Ie,ce,de,he),Pe=new Q(Ie,ce,de,he),de.programs=xe.programs,P.capabilities=he,P.extensions=ce,P.properties=me,P.renderLists=be,P.shadowMap=we,P.state=ue,P.info=de}Fe();const Ue=new li(P,Ie);function Ve(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function Ne(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1;const e=de.autoReset,t=we.enabled,i=we.autoUpdate,n=we.needsUpdate,r=we.type;Fe(),de.autoReset=e,we.enabled=t,we.autoUpdate=i,we.needsUpdate=n,we.type=r}function Be(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function ke(e){const t=e.target;t.removeEventListener("dispose",ke),function(e){(function(e){const t=me.get(e).programs;void 0!==t&&(t.forEach((function(e){xe.releaseProgram(e)})),e.isShaderMaterial&&xe.releaseShaderCache(e))})(e),me.remove(e)}(t)}this.xr=Ue,this.getContext=function(){return Ie},this.getContextAttributes=function(){return Ie.getContextAttributes()},this.forceContextLoss=function(){const e=ce.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=ce.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(e){void 0!==e&&(G=e,this.setSize(k,z,!1))},this.getSize=function(e){return e.set(k,z)},this.setSize=function(e,i,n=!0){Ue.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(k=e,z=i,t.width=Math.floor(e*G),t.height=Math.floor(i*G),!0===n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return e.set(k*G,z*G).floor()},this.setDrawingBufferSize=function(e,i,n){k=e,z=i,G=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(V)},this.getViewport=function(e){return e.copy(W)},this.setViewport=function(e,t,i,n){e.isVector4?W.set(e.x,e.y,e.z,e.w):W.set(e,t,i,n),ue.viewport(V.copy(W).multiplyScalar(G).floor())},this.getScissor=function(e){return e.copy(q)},this.setScissor=function(e,t,i,n){e.isVector4?q.set(e.x,e.y,e.z,e.w):q.set(e,t,i,n),ue.scissor(N.copy(q).multiplyScalar(G).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(e){ue.setScissorTest(X=e)},this.setOpaqueSort=function(e){j=e},this.setTransparentSort=function(e){H=e},this.getClearColor=function(e){return e.copy(Ee.getClearColor())},this.setClearColor=function(){Ee.setClearColor.apply(Ee,arguments)},this.getClearAlpha=function(){return Ee.getClearAlpha()},this.setClearAlpha=function(){Ee.setClearAlpha.apply(Ee,arguments)},this.clear=function(e=!0,t=!0,i=!0){let n=0;e&&(n|=Ie.COLOR_BUFFER_BIT),t&&(n|=Ie.DEPTH_BUFFER_BIT),i&&(n|=Ie.STENCIL_BUFFER_BIT),Ie.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ve,!1),t.removeEventListener("webglcontextrestored",Ne,!1),t.removeEventListener("webglcontextcreationerror",Be,!1),be.dispose(),Te.dispose(),me.dispose(),fe.dispose(),ge.dispose(),ye.dispose(),Le.dispose(),De.dispose(),xe.dispose(),Ue.dispose(),Ue.removeEventListener("sessionstart",Ge),Ue.removeEventListener("sessionend",je),ie&&(ie.dispose(),ie=null),He.stop()},this.renderBufferDirect=function(e,t,i,r,s,o){null===t&&(t=se);const a=s.isMesh&&s.matrixWorld.determinant()<0,l=function(e,t,i,r,s){!0!==t.isScene&&(t=se),pe.resetTextureUnits();const o=t.fog,a=r.isMeshStandardMaterial?t.environment:null,l=null===I?P.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:n.LinearSRGBColorSpace,c=(r.isMeshStandardMaterial?ge:fe).get(r.envMap||a),h=!0===r.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,u=!!r.normalMap&&!!i.attributes.tangent,d=!!i.morphAttributes.position,m=!!i.morphAttributes.normal,p=!!i.morphAttributes.color,f=r.toneMapped?P.toneMapping:n.NoToneMapping,g=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,v=void 0!==g?g.length:0,_=me.get(r),y=M.state.lights;if(!0===Y&&(!0===te||e!==U)){const t=e===U&&r.id===O;Me.setState(r,e,t)}let x=!1;r.version===_.__version?_.needsLights&&_.lightsStateVersion!==y.state.version||_.outputColorSpace!==l||s.isInstancedMesh&&!1===_.instancing?x=!0:s.isInstancedMesh||!0!==_.instancing?s.isSkinnedMesh&&!1===_.skinning?x=!0:s.isSkinnedMesh||!0!==_.skinning?_.envMap!==c||!0===r.fog&&_.fog!==o?x=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===Me.numPlanes&&_.numIntersection===Me.numIntersection?(_.vertexAlphas!==h||_.vertexTangents!==u||_.morphTargets!==d||_.morphNormals!==m||_.morphColors!==p||_.toneMapping!==f||!0===he.isWebGL2&&_.morphTargetsCount!==v)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,_.__version=r.version);let S=_.currentProgram;!0===x&&(S=Ye(r,t,s));let b=!1,T=!1,w=!1;const E=S.getUniforms(),C=_.uniforms;if(ue.useProgram(S.program)&&(b=!0,T=!0,w=!0),r.id!==O&&(O=r.id,T=!0),b||U!==e){if(E.setValue(Ie,"projectionMatrix",e.projectionMatrix),he.logarithmicDepthBuffer&&E.setValue(Ie,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),U!==e&&(U=e,T=!0,w=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const t=E.map.cameraPosition;void 0!==t&&t.setValue(Ie,re.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&E.setValue(Ie,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||s.isSkinnedMesh)&&E.setValue(Ie,"viewMatrix",e.matrixWorldInverse)}if(s.isSkinnedMesh){E.setOptional(Ie,s,"bindMatrix"),E.setOptional(Ie,s,"bindMatrixInverse");const e=s.skeleton;e&&(he.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),E.setValue(Ie,"boneTexture",e.boneTexture,pe),E.setValue(Ie,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const A=i.morphAttributes;var R,L;if((void 0!==A.position||void 0!==A.normal||void 0!==A.color&&!0===he.isWebGL2)&&Ce.update(s,i,S),(T||_.receiveShadow!==s.receiveShadow)&&(_.receiveShadow=s.receiveShadow,E.setValue(Ie,"receiveShadow",s.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(C.envMap.value=c,C.flipEnvMap.value=c.isCubeTexture&&!1===c.isRenderTargetTexture?-1:1),T&&(E.setValue(Ie,"toneMappingExposure",P.toneMappingExposure),_.needsLights&&(L=w,(R=C).ambientLightColor.needsUpdate=L,R.lightProbe.needsUpdate=L,R.directionalLights.needsUpdate=L,R.directionalLightShadows.needsUpdate=L,R.pointLights.needsUpdate=L,R.pointLightShadows.needsUpdate=L,R.spotLights.needsUpdate=L,R.spotLightShadows.needsUpdate=L,R.rectAreaLights.needsUpdate=L,R.hemisphereLights.needsUpdate=L),o&&!0===r.fog&&Se.refreshFogUniforms(C,o),Se.refreshMaterialUniforms(C,r,G,z,ie),mt.upload(Ie,_.uniformsList,C,pe)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(mt.upload(Ie,_.uniformsList,C,pe),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&E.setValue(Ie,"center",s.center),E.setValue(Ie,"modelViewMatrix",s.modelViewMatrix),E.setValue(Ie,"normalMatrix",s.normalMatrix),E.setValue(Ie,"modelMatrix",s.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,i=e.length;t<i;t++)if(he.isWebGL2){const i=e[t];De.update(i,S),De.bind(i,S)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return S}(e,t,i,r,s);ue.setMaterial(r,a);let c=i.index,h=1;!0===r.wireframe&&(c=_e.getWireframeAttribute(i),h=2);const u=i.drawRange,d=i.attributes.position;let m=u.start*h,p=(u.start+u.count)*h;null!==o&&(m=Math.max(m,o.start*h),p=Math.min(p,(o.start+o.count)*h)),null!==c?(m=Math.max(m,0),p=Math.min(p,c.count)):null!=d&&(m=Math.max(m,0),p=Math.min(p,d.count));const f=p-m;if(f<0||f===1/0)return;let g;Le.setup(s,r,l,i,c);let v=Ae;if(null!==c&&(g=ve.get(c),v=Pe,v.setIndex(g)),s.isMesh)!0===r.wireframe?(ue.setLineWidth(r.wireframeLinewidth*le()),v.setMode(Ie.LINES)):v.setMode(Ie.TRIANGLES);else if(s.isLine){let e=r.linewidth;void 0===e&&(e=1),ue.setLineWidth(e*le()),s.isLineSegments?v.setMode(Ie.LINES):s.isLineLoop?v.setMode(Ie.LINE_LOOP):v.setMode(Ie.LINE_STRIP)}else s.isPoints?v.setMode(Ie.POINTS):s.isSprite&&v.setMode(Ie.TRIANGLES);if(s.isInstancedMesh)v.renderInstances(m,f,s.count);else if(i.isInstancedBufferGeometry){const e=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,t=Math.min(i.instanceCount,e);v.renderInstances(m,f,t)}else v.render(m,f)},this.compile=function(e,t){function i(e,t,i){!0===e.transparent&&e.side===n.DoubleSide&&!1===e.forceSinglePass?(e.side=n.BackSide,e.needsUpdate=!0,Ye(e,t,i),e.side=n.FrontSide,e.needsUpdate=!0,Ye(e,t,i),e.side=n.DoubleSide):Ye(e,t,i)}M=Te.get(e),M.init(),A.push(M),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(M.pushLight(e),e.castShadow&&M.pushShadow(e))})),M.setupLights(P.useLegacyLights),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++)i(n[r],e,t);else i(n,e,t)})),A.pop(),M=null};let ze=null;function Ge(){He.stop()}function je(){He.start()}const He=new l;function We(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)M.pushLight(e),e.castShadow&&M.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||K.intersectsSprite(e)){n&&re.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ne);const t=ye.update(e),r=e.material;r.visible&&y.push(e,t,r,i,re.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||K.intersectsObject(e))){e.isSkinnedMesh&&e.skeleton.frame!==de.render.frame&&(e.skeleton.update(),e.skeleton.frame=de.render.frame);const t=ye.update(e),r=e.material;if(n&&(null===t.boundingSphere&&t.computeBoundingSphere(),re.copy(t.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(ne)),Array.isArray(r)){const n=t.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&y.push(e,t,a,i,re.z,o)}}else r.visible&&y.push(e,t,r,i,re.z,null)}const r=e.children;for(let e=0,s=r.length;e<s;e++)We(r[e],t,i,n)}function qe(e,t,i,r){const s=e.opaque,o=e.transmissive,a=e.transparent;M.setupLightsView(i),!0===Y&&Me.setGlobalState(P.clippingPlanes,i),o.length>0&&function(e,t,i,r){if(null===ie){const e=he.isWebGL2;ie=new C.WebGLRenderTarget(1024,1024,{generateMipmaps:!0,type:ce.has("EXT_color_buffer_half_float")?n.HalfFloatType:n.UnsignedByteType,minFilter:n.LinearMipmapLinearFilter,samples:e&&!0===m?4:0})}const s=P.getRenderTarget();P.setRenderTarget(ie),P.clear();const o=P.toneMapping;P.toneMapping=n.NoToneMapping,Xe(e,i,r),pe.updateMultisampleRenderTarget(ie),pe.updateRenderTargetMipmap(ie);let a=!1;for(let e=0,s=t.length;e<s;e++){const s=t[e],o=s.object,l=s.geometry,c=s.material,h=s.group;if(c.side===n.DoubleSide&&o.layers.test(r.layers)){const e=c.side;c.side=n.BackSide,c.needsUpdate=!0,Ke(o,i,r,l,c,h),c.side=e,c.needsUpdate=!0,a=!0}}!0===a&&(pe.updateMultisampleRenderTarget(ie),pe.updateRenderTargetMipmap(ie)),P.setRenderTarget(s),P.toneMapping=o}(s,o,t,i),r&&ue.viewport(V.copy(r)),s.length>0&&Xe(s,t,i),o.length>0&&Xe(o,t,i),a.length>0&&Xe(a,t,i),ue.buffers.depth.setTest(!0),ue.buffers.depth.setMask(!0),ue.buffers.color.setMask(!0),ue.setPolygonOffset(!1)}function Xe(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,l=null===n?s.material:n,c=s.group;o.layers.test(i.layers)&&Ke(o,t,i,a,l,c)}}function Ke(e,t,i,r,s,o){e.onBeforeRender(P,t,i,r,s,o),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),s.onBeforeRender(P,t,i,r,e,o),!0===s.transparent&&s.side===n.DoubleSide&&!1===s.forceSinglePass?(s.side=n.BackSide,s.needsUpdate=!0,P.renderBufferDirect(i,t,r,s,e,o),s.side=n.FrontSide,s.needsUpdate=!0,P.renderBufferDirect(i,t,r,s,e,o),s.side=n.DoubleSide):P.renderBufferDirect(i,t,r,s,e,o),e.onAfterRender(P,t,i,r,s,o)}function Ye(e,t,i){!0!==t.isScene&&(t=se);const n=me.get(e),r=M.state.lights,s=M.state.shadowsArray,o=r.state.version,a=xe.getParameters(e,r.state,s,t,i),l=xe.getProgramCacheKey(a);let c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?ge:fe).get(e.envMap||n.environment),void 0===c&&(e.addEventListener("dispose",ke),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===o)return Ze(e,a),h}else a.uniforms=xe.getUniforms(e),e.onBuild(i,a,P),e.onBeforeCompile(a,P),h=xe.acquireProgram(a,l),c.set(l,h),n.uniforms=a.uniforms;const u=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=Me.uniform),Ze(e,a),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=h.getUniforms(),m=mt.seqWithValue(d.seq,u);return n.currentProgram=h,n.uniformsList=m,h}function Ze(e,t){const i=me.get(e);i.outputColorSpace=t.outputColorSpace,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}He.setAnimationLoop((function(e){ze&&ze(e)})),"undefined"!=typeof self&&He.setContext(self),this.setAnimationLoop=function(e){ze=e,Ue.setAnimationLoop(e),null===e?He.stop():He.start()},Ue.addEventListener("sessionstart",Ge),Ue.addEventListener("sessionend",je),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===R)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ue.enabled&&!0===Ue.isPresenting&&(!0===Ue.cameraAutoUpdate&&Ue.updateCamera(t),t=Ue.getCamera()),!0===e.isScene&&e.onBeforeRender(P,e,t,I),M=Te.get(e,A.length),M.init(),A.push(M),ne.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),K.setFromProjectionMatrix(ne),te=this.localClippingEnabled,Y=Me.init(this.clippingPlanes,te),y=be.get(e,w.length),y.init(),w.push(y),We(e,t,0,P.sortObjects),y.finish(),!0===P.sortObjects&&y.sort(j,H),!0===Y&&Me.beginShadows();const i=M.state.shadowsArray;if(we.render(i,e,t),!0===Y&&Me.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ee.render(y,e),M.setupLights(P.useLegacyLights),t.isArrayCamera){const i=t.cameras;for(let t=0,n=i.length;t<n;t++){const n=i[t];qe(y,e,n,n.viewport)}}else qe(y,e,t);null!==I&&(pe.updateMultisampleRenderTarget(I),pe.updateRenderTargetMipmap(I)),!0===e.isScene&&e.onAfterRender(P,e,t),Le.resetDefaultState(),O=-1,U=null,A.pop(),M=A.length>0?A[A.length-1]:null,w.pop(),y=w.length>0?w[w.length-1]:null},this.getActiveCubeFace=function(){return L},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(e,t,i){me.get(e.texture).__webglTexture=t,me.get(e.depthTexture).__webglTexture=i;const n=me.get(e);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===ce.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const i=me.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,i=0){I=e,L=t,D=i;let n=!0,r=null,s=!1,o=!1;if(e){const i=me.get(e);void 0!==i.__useDefaultFramebuffer?(ue.bindFramebuffer(Ie.FRAMEBUFFER,null),n=!1):void 0===i.__webglFramebuffer?pe.setupRenderTarget(e):i.__hasExternalTextures&&pe.rebindTextures(e,me.get(e.texture).__webglTexture,me.get(e.depthTexture).__webglTexture);const a=e.texture;(a.isData3DTexture||a.isDataArrayTexture||a.isCompressedArrayTexture)&&(o=!0);const l=me.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=l[t],s=!0):r=he.isWebGL2&&e.samples>0&&!1===pe.useMultisampledRTT(e)?me.get(e).__webglMultisampledFramebuffer:l,V.copy(e.viewport),N.copy(e.scissor),B=e.scissorTest}else V.copy(W).multiplyScalar(G).floor(),N.copy(q).multiplyScalar(G).floor(),B=X;if(ue.bindFramebuffer(Ie.FRAMEBUFFER,r)&&he.drawBuffers&&n&&ue.drawBuffers(e,r),ue.viewport(V),ue.scissor(N),ue.setScissorTest(B),s){const n=me.get(e.texture);Ie.framebufferTexture2D(Ie.FRAMEBUFFER,Ie.COLOR_ATTACHMENT0,Ie.TEXTURE_CUBE_MAP_POSITIVE_X+t,n.__webglTexture,i)}else if(o){const n=me.get(e.texture),r=t||0;Ie.framebufferTextureLayer(Ie.FRAMEBUFFER,Ie.COLOR_ATTACHMENT0,n.__webglTexture,i||0,r)}O=-1},this.readRenderTargetPixels=function(e,t,i,r,s,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=me.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(l=l[a]),l){ue.bindFramebuffer(Ie.FRAMEBUFFER,l);try{const a=e.texture,l=a.format,c=a.type;if(l!==n.RGBAFormat&&Re.convert(l)!==Ie.getParameter(Ie.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=c===n.HalfFloatType&&(ce.has("EXT_color_buffer_half_float")||he.isWebGL2&&ce.has("EXT_color_buffer_float"));if(!(c===n.UnsignedByteType||Re.convert(c)===Ie.getParameter(Ie.IMPLEMENTATION_COLOR_READ_TYPE)||c===n.FloatType&&(he.isWebGL2||ce.has("OES_texture_float")||ce.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&i>=0&&i<=e.height-s&&Ie.readPixels(t,i,r,s,Re.convert(l),Re.convert(c),o)}finally{const e=null!==I?me.get(I).__webglFramebuffer:null;ue.bindFramebuffer(Ie.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){const n=Math.pow(2,-i),r=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n);pe.setTexture2D(t,0),Ie.copyTexSubImage2D(Ie.TEXTURE_2D,i,0,0,e.x,e.y,r,s),ue.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const r=t.image.width,s=t.image.height,o=Re.convert(i.format),a=Re.convert(i.type);pe.setTexture2D(i,0),Ie.pixelStorei(Ie.UNPACK_FLIP_Y_WEBGL,i.flipY),Ie.pixelStorei(Ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Ie.pixelStorei(Ie.UNPACK_ALIGNMENT,i.unpackAlignment),t.isDataTexture?Ie.texSubImage2D(Ie.TEXTURE_2D,n,e.x,e.y,r,s,o,a,t.image.data):t.isCompressedTexture?Ie.compressedTexSubImage2D(Ie.TEXTURE_2D,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):Ie.texSubImage2D(Ie.TEXTURE_2D,n,e.x,e.y,o,a,t.image),0===n&&i.generateMipmaps&&Ie.generateMipmap(Ie.TEXTURE_2D),ue.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,r=0){if(P.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=Re.convert(n.format),c=Re.convert(n.type);let h;if(n.isData3DTexture)pe.setTexture3D(n,0),h=Ie.TEXTURE_3D;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");pe.setTexture2DArray(n,0),h=Ie.TEXTURE_2D_ARRAY}Ie.pixelStorei(Ie.UNPACK_FLIP_Y_WEBGL,n.flipY),Ie.pixelStorei(Ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Ie.pixelStorei(Ie.UNPACK_ALIGNMENT,n.unpackAlignment);const u=Ie.getParameter(Ie.UNPACK_ROW_LENGTH),d=Ie.getParameter(Ie.UNPACK_IMAGE_HEIGHT),m=Ie.getParameter(Ie.UNPACK_SKIP_PIXELS),p=Ie.getParameter(Ie.UNPACK_SKIP_ROWS),f=Ie.getParameter(Ie.UNPACK_SKIP_IMAGES),g=i.isCompressedTexture?i.mipmaps[0]:i.image;Ie.pixelStorei(Ie.UNPACK_ROW_LENGTH,g.width),Ie.pixelStorei(Ie.UNPACK_IMAGE_HEIGHT,g.height),Ie.pixelStorei(Ie.UNPACK_SKIP_PIXELS,e.min.x),Ie.pixelStorei(Ie.UNPACK_SKIP_ROWS,e.min.y),Ie.pixelStorei(Ie.UNPACK_SKIP_IMAGES,e.min.z),i.isDataTexture||i.isData3DTexture?Ie.texSubImage3D(h,r,t.x,t.y,t.z,s,o,a,l,c,g.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ie.compressedTexSubImage3D(h,r,t.x,t.y,t.z,s,o,a,l,g.data)):Ie.texSubImage3D(h,r,t.x,t.y,t.z,s,o,a,l,c,g),Ie.pixelStorei(Ie.UNPACK_ROW_LENGTH,u),Ie.pixelStorei(Ie.UNPACK_IMAGE_HEIGHT,d),Ie.pixelStorei(Ie.UNPACK_SKIP_PIXELS,m),Ie.pixelStorei(Ie.UNPACK_SKIP_ROWS,p),Ie.pixelStorei(Ie.UNPACK_SKIP_IMAGES,f),0===r&&n.generateMipmaps&&Ie.generateMipmap(h),ue.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?pe.setTextureCube(e,0):e.isData3DTexture?pe.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?pe.setTexture2DArray(e,0):pe.setTexture2D(e,0),ue.unbindTexture()},this.resetState=function(){L=0,D=0,I=null,ue.reset(),Le.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===n.SRGBColorSpace?n.sRGBEncoding:n.LinearEncoding}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===n.sRGBEncoding?n.SRGBColorSpace:n.LinearSRGBColorSpace}}},576:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ShaderChunk:()=>n});const n={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef USE_ALPHATEST\n\n\tif ( diffuseColor.a < alphaTest ) discard;\n\n#endif\n",alphatest_pars_fragment:"\n#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:"\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n",iridescence_fragment:"\n\n#ifdef USE_IRIDESCENCE\n\n\t// XYZ to linear-sRGB color space\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\n\t// Assume air interface for top\n\t// Note: We don't handle the case fresnel0 == 1\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\n\t}\n\n\t// Conversion FO/IOR\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\n\t}\n\n\t// ior is a value between 1.0 and 3.0. 1.0 is air interface\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\n\t}\n\n\t// Fresnel equations for dielectric/dielectric interfaces.\n\t// Ref: https://belcour.github.io/blog/research/2017/05/01/brdf-thin-film.html\n\t// Evaluation XYZ sensitivity curves in Fourier space\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\n\t}\n\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\n\t\tvec3 I;\n\n\t\t// Force iridescenceIOR -> outsideIOR when thinFilmThickness -> 0.0\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\t// Evaluate the cosTheta on the base layer (Snell law)\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\n\t\t// Handle TIR:\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\n\t\t\t return vec3( 1.0 );\n\n\t\t}\n\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\n\t\t// First interface\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\n\t\t// Second interface\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) ); // guard against 1.0\n\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\n\t\t// Phase shift\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\n\t\t// Compound terms\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\n\t\t// Reflectance term for m = 0 (DC term amplitude)\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\n\t\t// Reflectance term for m > 0 (pairs of diracs)\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\n\t\t}\n\n\t\t// Since out of gamut colors might be produced, negative color values are clamped to 0.\n\t\treturn max( I, vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n",bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm; // normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#if defined( USE_COLOR_ALPHA )\n\n\tdiffuseColor *= vColor;\n\n#elif defined( USE_COLOR )\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvarying vec4 vColor;\n\n#elif defined( USE_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvarying vec4 vColor;\n\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvColor = vec4( 1.0 );\n\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor *= color;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n\treturn fract( sin( sn ) * c );\n\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\nfloat luminance( const in vec3 rgb ) {\n\n\t// assumes rgb is in linear color space with sRGB primaries and D65 white point\n\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\n\treturn dot( weights, rgb );\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n\n} // validated\n\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n\n} // validated\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0; // #25071\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\n\t\t#ifdef texture2DGradEXT\n\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb; // disable anisotropic filtering\n\n\t\t#else\n\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\n\t\t#endif\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= cubeUV_r1 ) {\n\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t\t#else\n\n\t\t\treturn vec3( 0.0 );\n\n\t\t#endif\n\n\t}\n\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t\t#else\n\n\t\t\treturn vec3( 0.0 );\n\n\t\t#endif\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tvFogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float vFogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\n\t#else\n\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\n\t#endif\n\n}\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_fragment:"\nLambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;\n",lights_lambert_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct LambertMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\treturn irradiance;\n\n}\n\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n\t#if defined ( LEGACY_LIGHTS )\n\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t\t}\n\n\t\treturn 1.0;\n\n\t#else\n\n\t\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t\t// page 32, equation 26: E[window1]\n\t\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\t\tif ( cutoffDistance > 0.0 ) {\n\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t\t}\n\n\t\treturn distanceFalloff;\n\n\t#endif\n\n}\n\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// light is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\n\t\tlight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// light is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\n\t\tlight.direction = normalize( lVector );\n\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\tif ( spotAttenuation > 0.0 ) {\n\n\t\t\tfloat lightDistance = length( lVector );\n\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\n\t\t} else {\n\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\n\t\t}\n\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.roughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n\n#ifdef IOR\n\n\tmaterial.ior = ior;\n\n\t#ifdef USE_SPECULAR\n\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\n\t\t#endif\n\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\n\t\t#endif\n\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\n\t#else\n\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\n\t#endif\n\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n\n#endif\n\n#ifdef USE_CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_IRIDESCENCE\n\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\n\t#ifdef USE_IRIDESCENCEMAP\n\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\n\t#endif\n\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\n\t#else\n\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\n\t#endif\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheenColor;\n\n\t#ifdef USE_SHEEN_COLORMAP\n\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\n\t#endif\n\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\n\t#endif\n\n#endif\n",lights_physical_pars_fragment:'\n\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\n};\n\n// temporary\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\n\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n#ifdef USE_CLEARCOAT\n\n\t// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\n\t\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\t\tfloat D = D_GGX( alpha, dotNH );\n\n\t\treturn F * ( V * D );\n\n\t}\n\n#endif\n\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\n\t#endif\n\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( V * D );\n\n}\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nfloat D_Charlie( float roughness, float dotNH ) {\n\n\tfloat alpha = pow2( roughness );\n\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n\n}\n\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\n\treturn sheenColor * ( D * V );\n\n}\n\n#endif\n\n// This is a curve-fit approxmation to the "Charlie sheen" BRDF integrated over the hemisphere from \n// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF". The analysis can be found\n// in the Sheen section of https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tfloat r2 = roughness * roughness;\n\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\n\treturn saturate( DG * RECIPROCAL_PI );\n\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\n\treturn fab;\n\n}\n\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\n\treturn specularColor * fab.x + specularF90 * fab.y;\n\n}\n\n// Fdez-Agüera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\n\t#else\n\n\t\tvec3 Fr = specularColor;\n\n\t#endif\n\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\n\t#endif\n\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\n\t#endif\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\n\t#else\n\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\n\t#endif\n\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n',lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef USE_CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\n#ifdef USE_IRIDESCENCE\n\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\n\tif ( material.iridescenceThickness == 0.0 ) {\n\n\t\tmaterial.iridescence = 0.0;\n\n\t} else {\n\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\n\t}\n\n\tif ( material.iridescence > 0.0 ) {\n\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\n\t\t// Iridescence F0 approximation\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\n\t}\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\n\t\t// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vMapUv );\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\t#if defined( USE_POINTS_UV )\n\n\t\tvec2 uv = vUv;\n\n\t#else\n\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n\t#endif\n\n#endif\n\n#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, uv );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_POINTS_UV )\n\n\tvarying vec2 vUv;\n\n#else\n\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\t\tuniform mat3 uvTransform;\n\n\t#endif\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphcolor_vertex:"\n#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tvColor *= morphTargetBaseInfluence;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\t#if defined( USE_COLOR_ALPHA )\n\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\n\t\t#elif defined( USE_COLOR )\n\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\n\t\t#endif\n\n\t}\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\n\t#ifdef MORPHTARGETS_TEXTURE\n\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\n\t\t}\n\n\t#else\n\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n\t#endif\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifdef MORPHTARGETS_TEXTURE\n\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\n\t\t}\n\n\t#else\n\n\t\t#ifndef USE_MORPHNORMALS\n\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\n\t\t#else\n\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\n\t#ifdef MORPHTARGETS_TEXTURE\n\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\n\t\t}\n\n\t#else\n\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t\t#ifndef USE_MORPHNORMALS\n\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\nfloat faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n\n#ifdef FLAT_SHADED\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal *= faceDirection;\n\n\t#endif\n\n#endif\n\n#ifdef USE_NORMALMAP_TANGENTSPACE\n\n\t#ifdef USE_TANGENT\n\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\n\t#else\n\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );\n\n\t#endif\n\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\n\t#endif\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\t#ifdef USE_TANGENT\n\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\n\t#else\n\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\n\t#endif\n\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * faceDirection;\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\tnormal = normalize( tbn * mapN );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n\n#endif\n",normal_pars_fragment:"\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n",normal_pars_vertex:"\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n",normal_vertex:"\n#ifndef FLAT_SHADED // normal is computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Normal Mapping Without Precomputed Tangents\n\t// http://www.thetenthplanet.de/archives/1180\n\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\n\t\tvec3 N = surf_norm; // normalized\n\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\n\t\treturn mat3( T * scale, B * scale, N );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef USE_CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n",iridescence_pars_fragment:"\n\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform sampler2D iridescenceMap;\n\n#endif\n\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform sampler2D iridescenceThicknessMap;\n\n#endif\n",output_fragment:"\n#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n\n// https://github.com/mrdoob/three.js/pull/22425\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\n\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\n\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\n\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ, the z-coordinate in camera space, is negative for points in front of the camera\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\t// -near maps to 0; -far maps to 1\n\treturn ( viewZ + near ) / ( near - far );\n}\n\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\t// maps orthographic depth in [ 0, 1 ] to viewZ\n\treturn depth * ( near - far ) - near;\n}\n\n// NOTE: https://twitter.com/gonnavis/status/1377183786949959682\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\t// -near maps to 0; -far maps to 1\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\n\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\t// maps perspective depth in [ 0, 1 ] to viewZ\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift according to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n\n#endif\n\n#if NUM_SPOT_LIGHT_MAPS > 0\n\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n\n#endif\n\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n\n#endif\n\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n\n#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\n\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n\n#endif\n\n#if defined( USE_SHADOWMAP )\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n\n// spot lights can be evaluated without active shadow mapping (when SpotLight.map is used)\n\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\n\tmat4 getBoneMatrix( const in float i ) {\n\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\ty = dy * ( y + 0.5 );\n\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\treturn bone;\n\n\t}\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/docs/techreports/2002/pdf/UUCS-02-001.pdf\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmission_fragment:"\n#ifdef USE_TRANSMISSION\n\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\n\t#ifdef USE_TRANSMISSIONMAP\n\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\n\t#endif\n\n\t#ifdef USE_THICKNESSMAP\n\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\n\t#endif\n\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n\n#endif\n",transmission_pars_fragment:"\n#ifdef USE_TRANSMISSION\n\n\t// Transmission code is based on glTF-Sampler-Viewer\n\t// https://github.com/KhronosGroup/glTF-Sample-Viewer\n\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\n\t#ifdef USE_TRANSMISSIONMAP\n\n\t\tuniform sampler2D transmissionMap;\n\n\t#endif\n\n\t#ifdef USE_THICKNESSMAP\n\n\t\tuniform sampler2D thicknessMap;\n\n\t#endif\n\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\n\tvarying vec3 vWorldPosition;\n\n\t// Mipped Bicubic Texture Filtering by N8\n\t// https://www.shadertoy.com/view/Dl2SDW\n\n\tfloat w0( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\n\t}\n\n\tfloat w1( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\n\t}\n\n\tfloat w2( float a ){\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\n\t}\n\n\tfloat w3( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\n\t}\n\n\t// g0 and g1 are the two amplitude functions\n\tfloat g0( float a ) {\n\n\t\treturn w0( a ) + w1( a );\n\n\t}\n\n\tfloat g1( float a ) {\n\n\t\treturn w2( a ) + w3( a );\n\n\t}\n\n\t// h0 and h1 are the two offset functions\n\tfloat h0( float a ) {\n\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\n\t}\n\n\tfloat h1( float a ) {\n\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\n\t}\n\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\n\t\tuv = uv * texelSize.zw + 0.5;\n\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\n\t}\n\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\n\t}\n\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\n\t\t// Direction of refracted light.\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\n\t\t// Compute rotation-independant scaling of the model matrix.\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t// The thickness is specified in local space.\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\n\t}\n\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\n\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\n\t}\n\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\n\t}\n\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\n\t\tif ( isinf( attenuationDistance ) ) {\n\n\t\t\t// Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.\n\t\t\treturn radiance;\n\n\t\t} else {\n\n\t\t\t// Compute light attenuation using Beer's law.\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law\n\t\t\treturn transmittance * radiance;\n\n\t\t}\n\n\t}\n\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\n\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\n\t\t// Get the specular component.\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\n\t}\n#endif\n",uv_pars_fragment:"\n#ifdef USE_UV\n\n\tvarying vec2 vUv;\n\n#endif\n#ifdef USE_MAP\n\n\tvarying vec2 vMapUv;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\tvarying vec2 vUv;\n\n#endif\n#ifdef USE_MAP\n\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = vec3( uv, 1 ).xy;\n\n#endif\n#ifdef USE_MAP\n\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_AOMAP\n\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",background_frag:"\nuniform sampler2D t2D;\nuniform float backgroundIntensity;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\ttexColor.rgb *= backgroundIntensity;\n\n\tgl_FragColor = texColor;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",backgroundCube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",backgroundCube_frag:"\n\n#ifdef ENVMAP_TYPE_CUBE\n\n\tuniform samplerCube envMap;\n\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\tuniform sampler2D envMap;\n\n#endif\n\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\n\t#else\n\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t#endif\n\n\ttexColor.rgb *= backgroundIntensity;\n\n\tgl_FragColor = texColor;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",cube_frag:"\nuniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\nvoid main() {\n\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\n#define LAMBERT\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 ); // default if matcap is missing\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshnormal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",meshnormal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n\t#ifdef OPAQUE\n\n\t\tgl_FragColor.a = 1.0;\n\n\t#endif\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifdef USE_TRANSMISSION\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef USE_TRANSMISSION\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef IOR\n\tuniform float ior;\n#endif\n\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\n\t#include <transmission_fragment>\n\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\n\t#ifdef USE_SHEEN\n\n\t\t// Sheen energy compensation approximation calculation can be found at the end of\n\t\t// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\n\t#endif\n\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_POINTS_UV\n\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n\n#endif\n\nvoid main() {\n\n\t#ifdef USE_POINTS_UV\n\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\t#endif\n\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\t#include <logdepthbuf_fragment>\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n"}},9984:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ShaderLib:()=>h});var n=i(576),r=i(5143),s=i(5448),o=i(6815),a=i(6729),l=i(5971),c=i(8955);const h={basic:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.specularmap,a.UniformsLib.envmap,a.UniformsLib.aomap,a.UniformsLib.lightmap,a.UniformsLib.fog]),vertexShader:n.ShaderChunk.meshbasic_vert,fragmentShader:n.ShaderChunk.meshbasic_frag},lambert:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.specularmap,a.UniformsLib.envmap,a.UniformsLib.aomap,a.UniformsLib.lightmap,a.UniformsLib.emissivemap,a.UniformsLib.bumpmap,a.UniformsLib.normalmap,a.UniformsLib.displacementmap,a.UniformsLib.fog,a.UniformsLib.lights,{emissive:{value:new l.Color(0)}}]),vertexShader:n.ShaderChunk.meshlambert_vert,fragmentShader:n.ShaderChunk.meshlambert_frag},phong:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.specularmap,a.UniformsLib.envmap,a.UniformsLib.aomap,a.UniformsLib.lightmap,a.UniformsLib.emissivemap,a.UniformsLib.bumpmap,a.UniformsLib.normalmap,a.UniformsLib.displacementmap,a.UniformsLib.fog,a.UniformsLib.lights,{emissive:{value:new l.Color(0)},specular:{value:new l.Color(1118481)},shininess:{value:30}}]),vertexShader:n.ShaderChunk.meshphong_vert,fragmentShader:n.ShaderChunk.meshphong_frag},standard:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.envmap,a.UniformsLib.aomap,a.UniformsLib.lightmap,a.UniformsLib.emissivemap,a.UniformsLib.bumpmap,a.UniformsLib.normalmap,a.UniformsLib.displacementmap,a.UniformsLib.roughnessmap,a.UniformsLib.metalnessmap,a.UniformsLib.fog,a.UniformsLib.lights,{emissive:{value:new l.Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:n.ShaderChunk.meshphysical_vert,fragmentShader:n.ShaderChunk.meshphysical_frag},toon:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.aomap,a.UniformsLib.lightmap,a.UniformsLib.emissivemap,a.UniformsLib.bumpmap,a.UniformsLib.normalmap,a.UniformsLib.displacementmap,a.UniformsLib.gradientmap,a.UniformsLib.fog,a.UniformsLib.lights,{emissive:{value:new l.Color(0)}}]),vertexShader:n.ShaderChunk.meshtoon_vert,fragmentShader:n.ShaderChunk.meshtoon_frag},matcap:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.bumpmap,a.UniformsLib.normalmap,a.UniformsLib.displacementmap,a.UniformsLib.fog,{matcap:{value:null}}]),vertexShader:n.ShaderChunk.meshmatcap_vert,fragmentShader:n.ShaderChunk.meshmatcap_frag},points:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.points,a.UniformsLib.fog]),vertexShader:n.ShaderChunk.points_vert,fragmentShader:n.ShaderChunk.points_frag},dashed:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:n.ShaderChunk.linedashed_vert,fragmentShader:n.ShaderChunk.linedashed_frag},depth:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.displacementmap]),vertexShader:n.ShaderChunk.depth_vert,fragmentShader:n.ShaderChunk.depth_frag},normal:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.bumpmap,a.UniformsLib.normalmap,a.UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:n.ShaderChunk.meshnormal_vert,fragmentShader:n.ShaderChunk.meshnormal_frag},sprite:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.sprite,a.UniformsLib.fog]),vertexShader:n.ShaderChunk.sprite_vert,fragmentShader:n.ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new c.Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:n.ShaderChunk.background_vert,fragmentShader:n.ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:n.ShaderChunk.backgroundCube_vert,fragmentShader:n.ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:n.ShaderChunk.cube_vert,fragmentShader:n.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:n.ShaderChunk.equirect_vert,fragmentShader:n.ShaderChunk.equirect_frag},distanceRGBA:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.common,a.UniformsLib.displacementmap,{referencePosition:{value:new o.Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:n.ShaderChunk.distanceRGBA_vert,fragmentShader:n.ShaderChunk.distanceRGBA_frag},shadow:{uniforms:(0,r.mergeUniforms)([a.UniformsLib.lights,a.UniformsLib.fog,{color:{value:new l.Color(0)},opacity:{value:1}}]),vertexShader:n.ShaderChunk.shadow_vert,fragmentShader:n.ShaderChunk.shadow_frag}};h.physical={uniforms:(0,r.mergeUniforms)([h.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new c.Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new c.Matrix3},clearcoatNormalScale:{value:new s.Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new c.Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new c.Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new c.Matrix3},sheen:{value:0},sheenColor:{value:new l.Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new c.Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new c.Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new c.Matrix3},transmissionSamplerSize:{value:new s.Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new c.Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new l.Color(0)},specularColor:{value:new l.Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new c.Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new c.Matrix3}}]),vertexShader:n.ShaderChunk.meshphysical_vert,fragmentShader:n.ShaderChunk.meshphysical_frag}},6729:(e,t,i)=>{"use strict";i.r(t),i.d(t,{UniformsLib:()=>o});var n=i(5971),r=i(5448),s=i(8955);const o={common:{diffuse:{value:new n.Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new s.Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new s.Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new s.Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new s.Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new s.Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new s.Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new s.Matrix3},normalScale:{value:new r.Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new s.Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new s.Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new s.Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new s.Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new n.Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new n.Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new s.Matrix3}},sprite:{diffuse:{value:new n.Color(16777215)},opacity:{value:1},center:{value:new r.Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new s.Matrix3},alphaMap:{value:null},alphaTest:{value:0}}}},5143:(e,t,i)=>{"use strict";i.r(t),i.d(t,{UniformsUtils:()=>l,cloneUniforms:()=>r,cloneUniformsGroups:()=>o,getUnlitUniformColorSpace:()=>a,mergeUniforms:()=>s});var n=i(6271);function r(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][n]=null):t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function s(e){const t={};for(let i=0;i<e.length;i++){const n=r(e[i]);for(const e in n)t[e]=n[e]}return t}function o(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function a(e){return null===e.getRenderTarget()?e.outputColorSpace:n.LinearSRGBColorSpace}const l={clone:r,merge:s}},7436:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Fog:()=>r});var n=i(5971);class r{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new n.Color(e),this.near=t,this.far=i}clone(){return new r(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}},5808:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Scene:()=>r});var n=i(2481);class r extends n.Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}},862:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CubeTexture:()=>s});var n=i(394),r=i(6271);class s extends n.Texture{constructor(e,t,i,n,s,o,a,l,c,h){super(e=void 0!==e?e:[],t=void 0!==t?t:r.CubeReflectionMapping,i,n,s,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}},7941:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DataTexture:()=>s});var n=i(394),r=i(6271);class s extends n.Texture{constructor(e=null,t=1,i=1,n,s,o,a,l,c=r.NearestFilter,h=r.NearestFilter,u,d){super(null,o,a,l,c,h,n,s,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}},4791:(e,t,i)=>{"use strict";i.d(t,{H:()=>s});var n=i(7300),r=i(3334);class s{constructor(e=null){this.isSource=!0,this.uuid=r.generateUUID(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(o(n[t].image)):e.push(o(n[t]))}else e=o(n);i.url=e}return t||(e.images[this.uuid]=i),i}}function o(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?n.P.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}},394:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Texture:()=>u});var n=i(2356),r=i(6271),s=i(3334),o=i(5448),a=i(8955),l=i(4791),c=i(1968);let h=0;class u extends n.EventDispatcher{constructor(e=u.DEFAULT_IMAGE,t=u.DEFAULT_MAPPING,i=r.ClampToEdgeWrapping,n=r.ClampToEdgeWrapping,d=r.LinearFilter,m=r.LinearMipmapLinearFilter,p=r.RGBAFormat,f=r.UnsignedByteType,g=u.DEFAULT_ANISOTROPY,v=r.NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:h++}),this.uuid=s.generateUUID(),this.name="",this.source=new l.H(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=d,this.minFilter=m,this.anisotropy=g,this.format=p,this.internalFormat=null,this.type=f,this.offset=new o.Vector2(0,0),this.repeat=new o.Vector2(1,1),this.center=new o.Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new a.Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof v?this.colorSpace=v:((0,c.O4)("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=v===r.sRGBEncoding?r.SRGBColorSpace:r.NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==r.UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case r.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case r.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case r.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case r.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case r.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case r.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return(0,c.O4)("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===r.SRGBColorSpace?r.sRGBEncoding:r.LinearEncoding}set encoding(e){(0,c.O4)("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===r.sRGBEncoding?r.SRGBColorSpace:r.NoColorSpace}}u.DEFAULT_IMAGE=null,u.DEFAULT_MAPPING=r.UVMapping,u.DEFAULT_ANISOTROPY=1},1968:(e,t,i)=>{"use strict";function n(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function r(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}i.d(t,{H7:()=>n,O4:()=>o,c:()=>r}),Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const s={};function o(e){e in s||(s[e]=!0,console.warn(e))}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";const e=__webpack_require__(8935),t=__webpack_require__(9636),i=__webpack_require__(5234);self.H.map.render.harp={RenderEngine:e.RenderEngine,ProjectionType:i.ProjectionType,Style:t.Style}})()})();}).call(self);
export default H;